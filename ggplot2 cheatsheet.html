<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css" target=_blank>a {text-decoration: none}</style>
</head>
<body bgcolor="#000000" text="#109030" leftmargin="150" topmargin="10" marginwidth="150" link="#00CCCC" vlink="#CC66CC" alink="#FFFF00" target=_blank>
<FONT size=3>

<h1 class="entry-title">Beautiful plotting in R: A <code>ggplot2</code> cheatsheet</h1>

<p>Even the most experienced R users need help creating elegant graphics. The <code>ggplot2</code> library is a phenomenal tool for creating graphics in R but even after many years of near-daily use we still need to refer to our Cheat Sheet. Up until now, we&#8217;ve kept these key tidbits on a local PDF. But for our own benefit (and hopefully yours) we decided to post the most useful bits of code.</p>
<p>* Last updated January 20, 2016 (with ggplot2 2.0 replace vjust with margin for title text)</p>
<p>You may also be interested in these other <code>ggplot2</code>-related posts:</p>
<p><a href="http://zevross.com/blog/2014/11/20/under-the-hood-of-ggplot2-graphics-in-r/">Under the hood of ggplot2 graphics in R</a><br />
<a href="http://zevross.com/blog/2014/07/16/mapping-in-r-using-the-ggplot2-package/">Mapping in R using the ggplot2 package</a><br />
<a href="http://zevross.com/blog/2015/01/13/a-new-data-processing-workflow-for-r-dplyr-magrittr-tidyr-ggplot2/">A new data processing workflow for R: dplyr, magrittr, tidyr and ggplot2</a></p>
<p>We start with the the quick setup and a default plot followed by a range of adjustments below.</p>
<div id="TOC">
<ul>
<li><a class="toc" href="#quicksetup-the-dataset">Quick-setup: The dataset</a></li>
<li><a class="toc" href="#a-default-plot-in-ggplot2">A default plot in <code>ggplot2</code></a></li>
<li><a class="toc" href="#working-with-the-title">Working with the title</a>
<ul>
<li><a class="toc" href="#add-a-title-ggtitle-or-labs">Add a title (<code>ggtitle()</code> or <code>labs()</code>)</a></li>
<li><a class="toc" href="#make-title-bold-and-add-a-little-space-at-the-baseline-face-vjust">Make title bold and add a little space at the baseline (<code>face</code>, <code>margin</code>)</a></li>
<li><a class="toc" href="#use-a-non-traditional-font-in-your-title-family">Use a non-traditional font in your title (<code>family</code>)</a></li>
<li><a class="toc" href="#change-spacing-in-multi-line-text-lineheight">Change spacing in multi-line text (<code>lineheight</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-axes">Working with axes</a>
<ul>
<li><a class="toc" href="#add-x-and-y-axis-labels-labs-xlab">Add x and y axis labels (<code>labs()</code>, <code>xlab()</code>)</a></li>
<li><a class="toc" href="#get-rid-of-axis-tick-and-labels-theme-axis.ticks.y">Get rid of axis tick and labels (<code>theme()</code>, <code>axis.ticks.y</code>)</a></li>
<li><a class="toc" href="#change-size-of-tick-text-axis.text.x">Change size of and rotate tick text (<code>axis.text.x</code>)</a></li>
<li><a class="toc" href="#move-the-labels-away-from-the-plot-and-add-color-theme-axis.title.x">Move the labels away from the plot (and add color) (<code>theme()</code>, <code>axis.title.x</code>)</a></li>
<li><a class="toc" href="#limit-an-axis-to-a-range-ylim-scale_x_continuous-coord_cartesian">Limit an axis to a range (<code>ylim</code>, <code>scale_x_continuous()</code>, <code>coord_cartesian()</code>)</a></li>
<li><a class="toc" href="#if-you-want-the-axes-to-be-the-same-coord_equal">If you want the axes to be the same (<code>coord_equal()</code>)</a></li>
<li><a class="toc" href="#use-a-function-to-alter-labels">Use a function to alter labels (<code>label=function(x){}</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-the-legend">Working with the legend</a>
<ul>
<li><a class="toc" href="#turn-off-the-legend-title-legend.title">Turn off the legend title (<code>legend.title</code>)</a></li>
<li><a class="toc" href="#change-the-styling-of-the-legend-title-legend.title">Change the styling of the legend title (<code>legend.title</code>)</a></li>
<li><a class="toc" href="#change-the-title-of-the-legend-scale...">Change the title of the legend (<code>name</code>)</a></li>
<li><a class="toc" href="#change-the-background-boxes-in-the-legend-legend.key">Change the background boxes in the legend (<code>legend.key</code>)</a></li>
<li><a class="toc" href="#change-the-size-of-the-symbols-in-the-legend-only-guides-guide_legend">Change the size of the symbols in the legend only (<code>guides()</code>, <code>guide_legend</code>)</a></li>
<li><a class="toc" href="#leave-a-layer-off-the-legend-show_guide">Leave a layer off the legend (<code>show_guide</code>)</a></li>
<li><a class="toc" href="#manually-adding-legend-items-guides-override.aes">Manually adding legend items (<code>guides()</code>, <code>override.aes</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-the-background-colors">Working with the background colors</a>
<ul>
<li><a class="toc" href="#change-the-panel-color-panel.background">Change the panel color (<code>panel.background</code>)</a></li>
<li><a class="toc" href="#change-the-grid-lines-panel.grid.major">Change the grid lines (<code>panel.grid.major</code>)</a></li>
<li><a class="toc" href="#change-the-plot-background-not-the-panel-color-plot.background">Change the plot background (not the panel) color (<code>plot.background</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-margins">Working with margins</a>
<ul>
<li><a class="toc" href="#changing-the-plot-margin">Changing the plot margin (<code>plot.margin</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-multi-panel-plots">Working with multi-panel plots</a>
<ul>
<li><a class="toc" href="#create-a-single-row-of-plots-based-on-one-variable-facet_wrap">Create a single row of plots based on one variable (<code>facet_wrap()</code>)</a></li>
<li><a class="toc" href="#create-a-matrix-of-plots-based-on-one-variable-facet_wrap">Create a matrix of plots based on one variable (<code>facet_wrap()</code>)</a></li>
<li><a class="toc" href="#allow-scales-to-roam-free-scales">Allow scales to roam free (<code>scales</code>)</a></li>
<li><a class="toc" href="#create-a-grid-of-plots-using-two-variables-facet_grid">Create a grid of plots using two variables (<code>facet_grid()</code>)</a></li>
<li><a class="toc" href="#put-two-potentially-unrelated-plots-side-by-side-pushviewport">Put two (potentially unrelated) plots side by side (<code>pushViewport(), grid.arrange()</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-themes">Working with themes</a>
<ul>
<li><a class="toc" href="#use-a-new-theme-theme_xx">Use a new theme (<code>theme_XX()</code>)</a></li>
<li><a class="toc" href="#change-the-size-of-all-plot-elements-theme_set-base_size">Change the size of all plot text elements (<code>theme_set()</code>, <code>base_size</code>)</a></li>
<li><a class="toc" href="#tip-on-creating-a-custom-theme">Tip on creating a custom theme</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-colors">Working with colors</a>
<ul>
<li><a class="toc" href="#categorical-variables-manually-select-the-colors-scale_color_manual">Categorical variables: manually select the colors (<code>scale_color_manual</code>)</a></li>
<li><a class="toc" href="#categorical-variables-try-a-built-in-palette-based-on-colorbrewer2.org-scale_color_brewer">Categorical variables: try a built-in palette (based on colorbrewer2.org) (<code>scale_color_brewer</code>):</a></li>
<li><a class="toc" href="#color-choice-with-continuous-variables-scale_color_gradient-scale_color_gradient2">Color choice with continuous variables (<code>scale_color_gradient()</code>, <code>scale_color_gradient2()</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-annotation">Working with annotation</a>
<ul>
<li><a class="toc" href="#add-text-annotation-in-the-top-right-top-left-etc.-annotation_custom-and-friends">Add text annotation in the top-right, top-left etc. (<code>annotation_custom()</code> and <code>textGrob()</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-coordinates">Working with coordinates</a>
<ul>
<li><a class="toc" href="#flip-a-plot-on-its-side-coord_flip">Flip a plot on it’s side (<code>coord_flip()</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-plot-types">Working with plot types</a>
<ul>
<li><a class="toc" href="#alternatives-to-the-box-plot">Alternatives to the box plot (<code>geom_jitter()</code> and <code>geom_violin()</code>)</a></li>
<li><a class="toc" href="#create-a-ribbon-geom_ribbon">Create a ribbon (<code>geom_ribbon()</code>)</a></li>
<li><a class="toc" href="#create-a-tiled-correlation-plot">Create a tiled correlation plot (<code>geom_tile()</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#working-with-smooths">Working with smooths</a>
<ul>
<li><a class="toc" href="#default-adding-loess-or-gam">Default &#8211; adding LOESS or GAM (<code>stat_smooth()</code>)</a></li>
<li><a class="toc" href="#specifying-the-formula">Specifying the formula (<code>stat_smooth(formula=)</code>)</a></li>
<li><a class="toc" href="#adding-a-linear-fit">Adding a linear fit (<code>stat_smooth(method="lm")</code>)</a></li>
</ul>
</li>
<li><a class="toc" href="#put-viz-online-plotly">Create interactive, online versions of your plots (easier than you think)</a></li>
</ul>
</div>
<h1 id="quicksetup-the-dataset">Quick-setup: The dataset</h1>
<p>We&#8217;re using data from the National Morbidity and Mortality Air Pollution Study (NMMAPS). To make the plots manageable we&#8217;re limiting the data to Chicago and 1997-2000. For more detail on this dataset, consult Roger Peng&#8217;s book <a href="http://www.springer.com/statistics/life+sciences,+medicine+%26+health/book/978-0-387-78166-2" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.springer.com/statistics/life+sciences,+medicine+%26+health/book/978-0-387-78166-2', 'Statistical Methods in Environmental Epidemiology with R');">Statistical Methods in Environmental Epidemiology with R</a>.</p>
<p>You can also download the data we&#8217;re using in this post <a href="http://zevross.com/blog/wp-content/uploads/2014/08/chicago-nmmaps.csv">here</a>.</p>
<pre><code class="r">library(ggplot2)
nmmaps&lt;-read.csv("chicago-nmmaps.csv", as.is=T)
nmmaps$date&lt;-as.Date(nmmaps$date)
nmmaps&lt;-nmmaps[nmmaps$date&gt;as.Date("1996-12-31"),]
nmmaps$year&lt;-substring(nmmaps$date,1,4)
head(nmmaps)
##      city       date death temp dewpoint   pm10     o3 time season year
## 3654 chic 1997-01-01   137 36.0    37.50 13.052  5.659 3654 winter 1997
## 3655 chic 1997-01-02   123 45.0    47.25 41.949  5.525 3655 winter 1997
## 3656 chic 1997-01-03   127 40.0    38.00 27.042  6.289 3656 winter 1997
## 3657 chic 1997-01-04   146 51.5    45.50 25.073  7.538 3657 winter 1997
## 3658 chic 1997-01-05   102 27.0    11.25 15.343 20.761 3658 winter 1997
## 3659 chic 1997-01-06   127 17.0     5.75  9.365 14.941 3659 winter 1997
</code></pre>
<h1 id="a-default-plot-in-ggplot2">A default plot in <code>ggplot2</code></h1>
<pre><code class="r">g&lt;-ggplot(nmmaps, aes(date, temp))+geom_point(color="firebrick")
g
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image1sm.png" rel="attachment wp-att-1578"><img class="alignleft size-full wp-image-1578" src="http://zevross.com/blog/wp-content/uploads/2014/08/image1sm.png" alt="image1sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image1sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image1sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image1sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h1 id="working-with-the-title">Working with the title</h1>
<h3 id="add-a-title-ggtitle-or-labs">Add a title (<code class="inlinefunc">ggtitle()</code> or <code class="inlinefunc">labs()</code>)</h3>
<pre><code class="r">g&lt;-g+ggtitle('Temperature')
g
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image2sm.png" rel="attachment wp-att-1580"><img class="alignleft size-full wp-image-1580" src="http://zevross.com/blog/wp-content/uploads/2014/08/image2sm.png" alt="image2sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image2sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image2sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image2sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Alternatively, you can use <code>g+labs(title='Temperature')</code></p>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="make-title-bold-and-add-a-little-space-at-the-baseline-face-vjust">Make title bold and add a little space at the baseline (<code class="inlinefunc">face</code>, <code class="inlinefunc">margin</code>)</h3>
<p>In ggplot2 versions before 2.0 I used the <code>vjust</code> argument to move the title away from the plot. With 2.0 this no longer works and a blog comment (below) helped me identify an alternative using <a href="http://r.789695.n4.nabble.com/vjust-unresponsive-ggplot2-td4715828.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://r.789695.n4.nabble.com/vjust-unresponsive-ggplot2-td4715828.html', 'this link');">this link</a>. The <code>margin</code> argument uses the <code>margin</code> function and you provide the top, right, bottom and left margins (the default unit is points).</p>
<pre><code class="r">g+theme(plot.title = element_text(size=20, face="bold", 
    margin = margin(10, 0, 10, 0)))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image3sm.png" rel="attachment wp-att-1581"><img class="alignleft size-full wp-image-1581" src="http://zevross.com/blog/wp-content/uploads/2014/08/image3sm.png" alt="image3sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image3sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image3sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image3sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="use-a-non-traditional-font-in-your-title-family">Use a non-traditional font in your title (<code class="inlinefunc">family</code>)</h3>
<p>Note that you can also use different fonts. It&#8217;s not as easy as it seems here, check out <a href="http://zevross.com/blog/2014/07/30/tired-of-using-helvetica-in-your-r-graphics-heres-how-to-use-the-fonts-you-like-2/">this post</a> if you need to use different fonts. This may not work on a Mac (send me a note and let me know).</p>
<p>If you are having trouble with this you might take a look at this <a href="http://stackoverflow.com/questions/27542302/ggplot-embedded-fonts-in-pdf" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://stackoverflow.com/questions/27542302/ggplot-embedded-fonts-in-pdf', 'StackOverflow');">StackOverflow</a> discussion.</p>
<pre><code class="r">library(extrafont)
g+theme(plot.title = element_text(size=30,lineheight=.8, 
  vjust=1,family="Bauhaus 93"))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image4sm.png" rel="attachment wp-att-1582"><img class="alignleft size-full wp-image-1582" src="http://zevross.com/blog/wp-content/uploads/2014/08/image4sm.png" alt="image4sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image4sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image4sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image4sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="change-spacing-in-multi-line-text-lineheight">Change spacing in multi-line text (<code class="inlinefunc">lineheight</code>)</h3>
<p>You can use the <code>lineheight</code> argument to change the spacing between lines. In this example, I&#8217;ve squished the lines together a bit (lineheight &lt; 1).</p>
<pre><code class="r">g&lt;-g+ggtitle("This is a longer\ntitle than expected")
g+theme(plot.title = element_text(size=20, face="bold", vjust=1, lineheight=0.6))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image5sm.png" rel="attachment wp-att-1583"><img class="alignleft size-full wp-image-1583" src="http://zevross.com/blog/wp-content/uploads/2014/08/image5sm.png" alt="image5sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image5sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image5sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image5sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h1 id="working-with-axes">Working with axes</h1>
<h2 id="add-x-and-y-axis-labels-labs-xlab">Add x and y axis labels (<code class="inlinefunc">labs()</code>, <code class="inlinefunc">xlab()</code>)</h2>
<p>The easiest is:</p>
<pre><code class="r">g&lt;-g+labs(x="Date", y=expression(paste("Temperature ( ", degree ~ F, " )")), title="Temperature")
g
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image6sm.png" rel="attachment wp-att-1584"><img class="alignleft size-full wp-image-1584" src="http://zevross.com/blog/wp-content/uploads/2014/08/image6sm.png" alt="image6sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image6sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image6sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image6sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h2 id="get-rid-of-axis-tick-and-labels-theme-axis.ticks.y">Get rid of axis ticks and tick text (<code class="inlinefunc">theme()</code>, <code class="inlinefunc">axis.ticks.y</code>)</h2>
<p>I wouldn&#8217;t normally do this but demonstration purposes:</p>
<pre><code class="r">g + theme(axis.ticks.y = element_blank(),axis.text.y = element_blank())
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image7sm.png" rel="attachment wp-att-1586"><img class="alignleft size-full wp-image-1586" src="http://zevross.com/blog/wp-content/uploads/2014/08/image7sm.png" alt="image7sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image7sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image7sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image7sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h2 id="change-size-of-tick-text-axis.text.x">Change size of and rotate tick text (<code>axis.text.x</code>)</h2>
<p>Go ahead, try to say &#8216;tick text&#8217; three times fast.</p>
<pre><code class="r">g + theme(axis.text.x=element_text(angle=50, size=20, vjust=0.5))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image8sm.png" rel="attachment wp-att-1587"><img class="alignleft size-full wp-image-1587" src="http://zevross.com/blog/wp-content/uploads/2014/08/image8sm.png" alt="image8sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image8sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image8sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image8sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h2 id="move-the-labels-away-from-the-plot-and-add-color-theme-axis.title.x">Move the labels away from the plot (and add color) (<code class="inlinefunc">theme()</code>, <code class="inlinefunc">axis.title.x</code>)</h2>
<p>I find that the labels are too close to the plot in the default settings so, similar to with the title, I&#8217;m using the <code>vjust</code> argument.</p>
<pre><code class="r">g + theme(
      axis.title.x = element_text(color="forestgreen", vjust=-0.35),
      axis.title.y = element_text(color="cadetblue" , vjust=0.35)   
          )
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image9sm.png" rel="attachment wp-att-1588"><img class="alignleft size-full wp-image-1588" src="http://zevross.com/blog/wp-content/uploads/2014/08/image9sm.png" alt="image9sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image9sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image9sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image9sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h2 id="limit-an-axis-to-a-range-ylim-scale_x_continuous-coord_cartesian">Limit an axis to a range (<code class="inlinefunc">ylim()</code>, <code class="inlinefunc">scale_x_continuous()</code>, <code class="inlinefunc">coord_cartesian()</code>)</h2>
<p>Again, this plot is for demonstration purposes:</p>
<pre><code class="r">g + ylim(c(0,60))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image10sm.png" rel="attachment wp-att-1589"><img class="alignleft size-full wp-image-1589" src="http://zevross.com/blog/wp-content/uploads/2014/08/image10sm.png" alt="image10sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image10sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image10sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image10sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Alternatively: <code>g+scale_x_continuous(limits=c(0,35))</code> or <code>g+coord_cartesian(xlim=c(0,35))</code>. The former removes all data points outside the range and second adjusts the visible area.</p>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h2 id="if-you-want-the-axes-to-be-the-same-coord_equal">If you want the axes to be the same (<code class="inlinefunc">coord_equal()</code>)</h2>
<p>There must be a better way than this. In the example, I&#8217;m plotting temperature against temperature with some random noise (for demonstration purposes) and I want both axes to be the same scale/same range.</p>
<pre><code class="r">ggplot(nmmaps, aes(temp, temp+rnorm(nrow(nmmaps), sd=20)))+geom_point()+
  xlim(c(0,150))+ylim(c(0,150))+
  coord_equal()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image11sm.png" rel="attachment wp-att-1590"><img class="alignleft size-full wp-image-1590" src="http://zevross.com/blog/wp-content/uploads/2014/08/image11sm.png" alt="image11sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image11sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image11sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image11sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h2 id="use-a-function-to-alter-labels">Use a function to alter labels (<code>label=function(x){}</code>)</h2>
<p>Sometimes it&#8217;s handy to alter your labels a little, perhaps adding units or percent signs without adding them to your data. You can use a function in this case. Here is an example:</p>
<pre><code class="r">ggplot(nmmaps, aes(date, temp))+
  geom_point(color="grey")+
  labs(x="Month", y="Temp")+
  scale_y_continuous(label=function(x){return(paste("My value is", x, "degrees"))})
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image12sm.png" rel="attachment wp-att-1592"><img class="alignleft size-full wp-image-1592" src="http://zevross.com/blog/wp-content/uploads/2014/08/image12sm.png" alt="image12sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image12sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image12sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image12sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Not pretty here, but this can come in handy.</p>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h1 id="working-with-the-legend">Working with the legend</h1>
<p>We will color code the plot based on season. You can see that by default the legend title is what we specified in the <code>color</code> argument.</p>
<pre><code class="r">g&lt;-ggplot(nmmaps, aes(date, temp, color=factor(season)))+geom_point()
g
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image13sm.png" rel="attachment wp-att-1593"><img class="alignleft size-full wp-image-1593" src="http://zevross.com/blog/wp-content/uploads/2014/08/image13sm.png" alt="image13sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image13sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image13sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image13sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="turn-off-the-legend-title-legend.title">Turn off the legend title (<code class="inlinefunc">legend.title</code>)</h3>
<pre><code class="r">g+theme(legend.title=element_blank())
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image14sm.png" rel="attachment wp-att-1594"><img class="alignleft size-full wp-image-1594" src="http://zevross.com/blog/wp-content/uploads/2014/08/image14sm.png" alt="image14sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image14sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image14sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image14sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="change-the-styling-of-the-legend-title-legend.title">Change the styling of the legend title (<code class="inlinefunc">legend.title</code>)</h3>
<pre><code class="r">g+theme(legend.title = element_text(colour="chocolate", size=16, face="bold"))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image15sm.png" rel="attachment wp-att-1595"><img class="alignleft size-full wp-image-1595" src="http://zevross.com/blog/wp-content/uploads/2014/08/image15sm.png" alt="image15sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image15sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image15sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image15sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="change-the-title-of-the-legend-scale...">Change the title of the legend (<code class="inlinefunc">name</code>)</h3>
<p>To change the title of the legend you would use the <code>name</code> argument in your <code>scale</code> function. If you don&#8217;t use a `scale` function you will need to change the data itself so that it has the right format.</p>
<pre><code class="r">g+theme(legend.title = element_text(colour="chocolate", size=16, face="bold"))+
  scale_color_discrete(name="This color is\ncalled chocolate!?")
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image16sm.png" rel="attachment wp-att-1596"><img class="alignleft size-full wp-image-1596" src="http://zevross.com/blog/wp-content/uploads/2014/08/image16sm.png" alt="image16sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image16sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image16sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image16sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="change-the-background-boxes-in-the-legend-legend.key">Change the background boxes in the legend (<code class="inlinefunc">legend.key</code>)</h3>
<p>I have mixed feelings about those boxes. If you want to get rid of them entirely use <code>fill=NA</code>.</p>
<pre><code class="r">g+theme(legend.key=element_rect(fill='pink'))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image17sm.png" rel="attachment wp-att-1597"><img class="alignleft size-full wp-image-1597" src="http://zevross.com/blog/wp-content/uploads/2014/08/image17sm.png" alt="image17sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image17sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image17sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image17sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="change-the-size-of-the-symbols-in-the-legend-only-guides-guide_legend">Change the size of the symbols in the legend only (<code class="inlinefunc">guides()</code>, <code class="inlinefunc">guide_legend</code>)</h3>
<p>Points in the legend get a little lost, especially without the boxes. To override the default try:</p>
<pre><code class="r">g+guides(colour = guide_legend(override.aes = list(size=4)))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image18sm.png" rel="attachment wp-att-1600"><img class="alignleft size-full wp-image-1600" src="http://zevross.com/blog/wp-content/uploads/2014/08/image18sm.png" alt="image18sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image18sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image18sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image18sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="leave-a-layer-off-the-legend-show_guide">Leave a layer off the legend (<code class="inlinefunc">show_guide</code>)</h3>
<p>Let&#8217;s say you have a point layer and you add label text to it. By default, both the points and the label text end up in the legend like this (again, who would make a plot like this? It&#8217;s for demonstration purposes):</p>
<pre><code class="r">g+geom_text(data=nmmaps, aes(date, temp, label=round(temp)), size=4)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image19sm.png" rel="attachment wp-att-1601"><img class="alignleft size-full wp-image-1601" src="http://zevross.com/blog/wp-content/uploads/2014/08/image19sm.png" alt="image19sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image19sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image19sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image19sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>You can use <code>show_guide=FALSE</code> to turn a layer off in the legend. Useful!</p>
<pre><code class="r">g+geom_text(data=nmmaps, aes(date, temp, label=round(temp), size=4), show_guide=FALSE)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image20sm.png" rel="attachment wp-att-1602"><img class="alignleft size-full wp-image-1602" src="http://zevross.com/blog/wp-content/uploads/2014/08/image20sm.png" alt="image20sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image20sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image20sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image20sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="manually-adding-legend-items-guides-override.aes">Manually adding legend items (<code class="inlinefunc">guides()</code>, <code class="inlinefunc">override.aes</code>)</h3>
<p>ggplot2 will not add a legend automatically unless you map aethetics (color, size etc) to a variable. There are times, though, that I want to have a legend so that it&#8217;s clear what you&#8217;re plotting. Here is the default:</p>
<pre><code class="r"># here there is no legend automatically
ggplot(nmmaps, aes(x=date, y=o3))+geom_line(color="grey")+geom_point(color="red")
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image21sm.png" rel="attachment wp-att-1603"><img class="alignleft size-full wp-image-1603" src="http://zevross.com/blog/wp-content/uploads/2014/08/image21sm.png" alt="image21sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image21sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image21sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image21sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>We can force a legend by mapping to a “variable”. We are mapping the lines and the points using <code>aes</code> and we are mapping <b>not</b> to a variable in our dataset but to a single string (so that we get just one color for each).</p>
<pre><code class="r">ggplot(nmmaps, aes(x=date, y=o3))+geom_line(aes(color="Important line"))+
  geom_point(aes(color="My points"))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image22sm.png" rel="attachment wp-att-1604"><img class="alignleft size-full wp-image-1604" src="http://zevross.com/blog/wp-content/uploads/2014/08/image22sm.png" alt="image22sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image22sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image22sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image22sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>We&#8217;re getting close but this is not what I want. I wanted grey and red. To change the color, we use scale_colour_manual().</p>
<pre><code class="r">ggplot(nmmaps, aes(x=date, y=o3))+geom_line(aes(color="Important line"))+
   geom_point(aes(color="Point values"))+
  scale_colour_manual(name='', values=c('Important line'='grey', 'Point values'='red'))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image23sm.png" rel="attachment wp-att-1605"><img class="alignleft size-full wp-image-1605" src="http://zevross.com/blog/wp-content/uploads/2014/08/image23sm.png" alt="image23sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image23sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image23sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image23sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Tantalizingly close! But we don&#8217;t want a line with a point for both. Line=grey and point=red. The final step is to override the aesthetics in the legend. The guide() function allows us to control guides like the legend:</p>
<pre><code class="r">ggplot(nmmaps, aes(x=date, y=o3))+geom_line(aes(color="Important line"))+
   geom_point(aes(color="Point values"))+
  scale_colour_manual(name='', values=c('Important line'='grey', 'Point values'='red'), guide='legend') +
  guides(colour = guide_legend(override.aes = list(linetype=c(1,0)
                                                      , shape=c(NA, 16))))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image24sm.png" rel="attachment wp-att-1606"><img class="alignleft size-full wp-image-1606" src="http://zevross.com/blog/wp-content/uploads/2014/08/image24sm.png" alt="image24sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image24sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image24sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image24sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Voila!</p>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h1 id="working-with-the-background-colors">Working with the background colors</h1>
<p>There are ways to change the entire look of your plot with one function (see below) but if you want to simply change the background color of the panel you can use the following:</p>
<h3 id="change-the-panel-color-panel.background">Change the panel color (<code class="inlinefunc">panel.background</code>)</h3>
<pre><code class="r">ggplot(nmmaps, aes(date, temp))+geom_point(color="firebrick")+
  theme(panel.background = element_rect(fill = 'grey75'))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image25sm.png" rel="attachment wp-att-1608"><img class="alignleft size-full wp-image-1608" src="http://zevross.com/blog/wp-content/uploads/2014/08/image25sm.png" alt="image25sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image25sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image25sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image25sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="change-the-grid-lines-panel.grid.major">Change the grid lines (<code class="inlinefunc">panel.grid.major</code>)</h3>
<pre><code class="r">ggplot(nmmaps, aes(date, temp))+geom_point(color="firebrick")+
  theme(panel.background = element_rect(fill = 'grey75'),
  panel.grid.major = element_line(colour = "orange", size=2),
  panel.grid.minor = element_line(colour = "blue"))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image26sm.png" rel="attachment wp-att-1609"><img class="alignleft size-full wp-image-1609" src="http://zevross.com/blog/wp-content/uploads/2014/08/image26sm.png" alt="image26sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image26sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image26sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image26sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="change-the-plot-background-not-the-panel-color-plot.background">Change the plot background (not the panel) color (<code class="inlinefunc">plot.background</code>)</h3>
<pre><code class="r">ggplot(nmmaps, aes(date, temp))+geom_point(color="firebrick")+
  theme(plot.background = element_rect(fill = 'grey'))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image27sm.png" rel="attachment wp-att-1610"><img class="alignleft size-full wp-image-1610" src="http://zevross.com/blog/wp-content/uploads/2014/08/image27sm.png" alt="image27sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image27sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image27sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image27sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h1 id="working-with-margins">Working with margins</h1>
<h3 id="changing-the-plot-margin">Changing the plot margin (<code>plot.margin</code>)</h3>
<p>I sometimes find that I need to add a little space to one margin of my plot. Similar to the previous examples we can use an argument to the <code>theme()</code> function. In this case the argument is <code>plot.margin</code>. In order to illustrate I&#8217;m going to add a background color using <code>plot.background</code> so you can see the default:</p>
<pre><code class="r"># the default
ggplot(nmmaps, aes(date, temp))+
  geom_point(color="darkorange3")+
  labs(x="Month", y="Temp")+
  theme(plot.background=element_rect(fill="darkseagreen"))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image28sm.png" rel="attachment wp-att-1611"><img class="alignleft size-full wp-image-1611" src="http://zevross.com/blog/wp-content/uploads/2014/08/image28sm.png" alt="image28sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image28sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image28sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image28sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Now let&#8217;s add extra space to both the left and right. The argument, <code>plot.margin</code>, can handle a variety of different units (cm, inches etc) but it requires the use of the function <code>unit</code> from the package <code>grid</code> to specify the units. Here I&#8217;m using a 6 cm margin on the right and left.</p>
<pre><code class="r">library(grid)
ggplot(nmmaps, aes(date, temp))+
  geom_point(color="darkorange3")+
  labs(x="Month", y="Temp")+
  theme(plot.background=element_rect(fill="darkseagreen"),
        plot.margin = unit(c(1, 6, 1, 6), "cm")) #top, right, bottom, left
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image29sm.png" rel="attachment wp-att-1612"><img class="alignleft size-full wp-image-1612" src="http://zevross.com/blog/wp-content/uploads/2014/08/image29sm.png" alt="image29sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image29sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image29sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image29sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Again, not a pretty plot!</p>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h1 id="working-with-multi-panel-plots">Creating multi-panel plots</h1>
<p>The <code>ggplot2</code> package has two nice functions for creating multi-panel plots. They are related but a little different <code>facet_wrap</code> creates essentially a ribbon of plots based on a single variable while <code>facet_grid</code> can take two variables.</p>
<h3 id="create-a-single-row-of-plots-based-on-one-variable-facet_wrap">Create a single row of plots based on one variable (<code class="inlinefunc">facet_wrap()</code>)</h3>
<pre><code class="r">ggplot(nmmaps, aes(date,temp))+geom_point(color="aquamarine4")+facet_wrap(~year, nrow=1)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image30sm.png" rel="attachment wp-att-1613"><img class="alignleft size-full wp-image-1613" src="http://zevross.com/blog/wp-content/uploads/2014/08/image30sm.png" alt="image30sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image30sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image30sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image30sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="create-a-matrix-of-plots-based-on-one-variable-facet_wrap">Create a matrix of plots based on one variable (<code class="inlinefunc">facet_wrap()</code>)</h3>
<pre><code class="r">ggplot(nmmaps, aes(date,temp))+geom_point(color="chartreuse4")+
    facet_wrap(~year, ncol=2)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image31sm.png" rel="attachment wp-att-1615"><img class="alignleft size-full wp-image-1615" src="http://zevross.com/blog/wp-content/uploads/2014/08/image31sm.png" alt="image31sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image31sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image31sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image31sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="allow-scales-to-roam-free-scales">Allow scales to roam free (<code class="inlinefunc">scales</code>)</h3>
<p>The default for multi-panel plots in <code>ggplot2</code> is to use equivalent scales in each panel. But sometimes you want to allow a panel&#8217;s own data to determine the scale. This is not often a good idea since it may give your user the wrong impression about the data but to do this you can set <code>scales="free"</code> like this:</p>
<pre><code class="r">ggplot(nmmaps, aes(date,temp))+geom_point(color="chartreuse4")+
  facet_wrap(~year, ncol=2, scales="free")
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image32sm.png" rel="attachment wp-att-1616"><img class="alignleft size-full wp-image-1616" src="http://zevross.com/blog/wp-content/uploads/2014/08/image32sm.png" alt="image32sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image32sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image32sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image32sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="create-a-grid-of-plots-using-two-variables-facet_grid">Create a grid of plots using two variables (<code class="inlinefunc">facet_grid()</code>)</h3>
<pre><code class="r">ggplot(nmmaps, aes(date,temp))+geom_point(color="darkgoldenrod4")+
    facet_grid(year~season)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image33sm.png" rel="attachment wp-att-1617"><img class="alignleft size-full wp-image-1617" src="http://zevross.com/blog/wp-content/uploads/2014/08/image33sm.png" alt="image33sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image33sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image33sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image33sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="put-two-potentially-unrelated-plots-side-by-side-pushviewport">Put two (potentially unrelated) plots side by side (<code class="inlinefunc">pushViewport(), grid.arrange()</code>)</h3>
<p>I find that doing this is not nearly as straightforward as traditional (base) graphics. Here are two approaches:</p>
<pre><code class="r">myplot1&lt;-ggplot(nmmaps, aes(date, temp))+geom_point(color="firebrick")
myplot2&lt;-ggplot(nmmaps, aes(temp, o3))+geom_point(color="olivedrab")

library(grid)
pushViewport(viewport(layout = grid.layout(1, 2)))
print(myplot1, vp = viewport(layout.pos.row = 1, layout.pos.col = 1))
print(myplot2, vp = viewport(layout.pos.row = 1, layout.pos.col = 2))

# alternative, a little easier
library(gridExtra)
grid.arrange(myplot1, myplot2, ncol=2)

</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image34sm.png" rel="attachment wp-att-1618"><img class="alignleft size-full wp-image-1618" src="http://zevross.com/blog/wp-content/uploads/2014/08/image34sm.png" alt="image34sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image34sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image34sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image34sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>To change from row to column arrangement you can change <code>facet_grid(season~year)</code> to <code>facet_grid(year~season)</code>.</p>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h1 id="working-with-themes">Working with themes</h1>
<p>You can change the entire look of the plots by using custom theme. As an example, Jeffrey Arnold has put together the library <code>ggthemes</code> with several custom themes. For a list you can visit <a href="https://github.com/jrnold/ggthemes" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://github.com/jrnold/ggthemes', 'the ggthemes site');">the ggthemes site</a>. Here is an example:</p>
<h3 id="use-a-new-theme-theme_xx">Use a new theme (<code class="inlinefunc">theme_XX()</code>)</h3>
<pre><code class="r">library(ggthemes)
ggplot(nmmaps, aes(date, temp, color=factor(season)))+
  geom_point()+ggtitle("This plot looks a lot different from the default")+
  theme_economist()+scale_colour_economist()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image35sm.png" rel="attachment wp-att-1619"><img class="alignleft size-full wp-image-1619" src="http://zevross.com/blog/wp-content/uploads/2014/08/image35sm.png" alt="image35sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image35sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image35sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image35sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="change-the-size-of-all-plot-elements-theme_set-base_size">Change the size of all plot text elements</h3>
<p>Personally, I find default size of the tick text, legends and other elements to be a little too small. Luckily it’s incredibly easy to change the size of all the text elements at once. If you look below at the <a href="#tip-on-creating-a-custom-theme">section on creating a custom theme</a> you’ll notice that the sizes of all the elements are relative (<code>rel()</code>) to the <code>base_size</code>. As a result, you can simply change the <code>base_size</code> and you’re done. Here is the code:</p>
<pre class="r"><code>theme_set(theme_gray(base_size = 30))
ggplot(nmmaps, aes(x=date, y=o3))+geom_point(color="red")</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image36sm.png" rel="attachment wp-att-1620"><img class="alignleft size-full wp-image-1620" src="http://zevross.com/blog/wp-content/uploads/2014/08/image36sm.png" alt="image36sm" width="1344" height="960" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image36sm-300x214.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image36sm-768x549.png 768w, http://zevross.com/blog/wp-content/uploads/2014/08/image36sm-1024x731.png 1024w, http://zevross.com/blog/wp-content/uploads/2014/08/image36sm-800x571.png 800w, http://zevross.com/blog/wp-content/uploads/2014/08/image36sm.png 1344w" sizes="(max-width: 1344px) 100vw, 1344px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="tip-on-creating-a-custom-theme">Tip on creating a custom theme</h3>
<p>If you want to change the theme for an entire session you can use <code>theme_set</code> as in <code>theme_set(theme_bw())</code>. The default is called <code>theme_gray</code>. If you wanted to create your own custom theme, you could extract the code directly from the gray theme and modify. Note that the <code>rel()</code> function change the sizes relative to the <code>base_size</code>.</p>
<pre><code class="r">theme_gray

function (base_size = 12, base_family = "") 
{
  theme(
    line = element_line(colour = "black", size = 0.5, linetype = 1, lineend = "butt"), 
    rect = element_rect(fill = "white", colour = "black", size = 0.5, linetype = 1), 
    text = element_text(family = base_family, face = "plain", colour = "black", size = base_size, hjust = 0.5, vjust = 0.5, angle = 0, lineheight = 0.9), 
    
    axis.text = element_text(size = rel(0.8), colour = "grey50"), 
    strip.text = element_text(size = rel(0.8)), 
    axis.line = element_blank(), 
    axis.text.x = element_text(vjust = 1), 
    axis.text.y = element_text(hjust = 1), 
    axis.ticks = element_line(colour = "grey50"), 
    axis.title.x = element_text(), 
    axis.title.y = element_text(angle = 90), 
    axis.ticks.length = unit(0.15, "cm"), 
    axis.ticks.margin = unit(0.1, "cm"), 
    
    legend.background = element_rect(colour = NA), 
    legend.margin = unit(0.2, "cm"), 
    legend.key = element_rect(fill = "grey95", colour = "white"), 
    legend.key.size = unit(1.2, "lines"), 
    legend.key.height = NULL, 
    legend.key.width = NULL, 
    legend.text = element_text(size = rel(0.8)), 
    legend.text.align = NULL, 
    legend.title = element_text(size = rel(0.8), face = "bold", hjust = 0), 
    legend.title.align = NULL, 
    legend.position = "right", 
    legend.direction = NULL, 
    legend.justification = "center", 
    legend.box = NULL, 

    panel.background = element_rect(fill = "grey90", colour = NA), 
    panel.border = element_blank(), 
    panel.grid.major = element_line(colour = "white"), 
    panel.grid.minor = element_line(colour = "grey95", size = 0.25), 
    panel.margin = unit(0.25, "lines"), 
    panel.margin.x = NULL, 
    panel.margin.y = NULL, 

    strip.background = element_rect(fill = "grey80", colour = NA), 
    strip.text.x = element_text(), 
    strip.text.y = element_text(angle = -90), 
    
    plot.background = element_rect(colour = "white"), 
    plot.title = element_text(size = rel(1.2)), 
    plot.margin = unit(c(1, 1, 0.5, 0.5), "lines"), complete = TRUE)
}
</code></pre>
<h1 id="working-with-colors">Working with colors</h1>
<p>For simple applications working with colors is straightforward in <code>ggplot2</code> but when you have more advanced needs it can be a challenge. For a more advaned treatment of the topic you should probably get your hands on <a href="http://www.springer.com/statistics/computational+statistics/book/978-0-387-98140-6" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.springer.com/statistics/computational+statistics/book/978-0-387-98140-6', 'Hadley&#8217;s book');">Hadley&#8217;s book</a> which has nice coverage. There are a few other good sources including the <a href="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.cookbook-r.com/Graphs/Colors_(ggplot2)', 'R Cookbook');">R Cookbook</a> and the <a href="http://docs.ggplot2.org/current/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://docs.ggplot2.org/current/', 'ggplot2 online docs');">ggplot2 online docs</a>. Tian Zheng at Columbia has created a useful <a href="http://www.stat.columbia.edu/%7Etzheng/files/Rcolor.pdf" onclick="__gaTracker('send', 'event', 'download', 'http://www.stat.columbia.edu/%7Etzheng/files/Rcolor.pdf');">PDF of R colors</a>.</p>
<p>In order to use color with your data, most importantly, you need to know if you&#8217;re dealing with a categorical or continuous variable.</p>
<h3 id="categorical-variables-manually-select-the-colors-scale_color_manual">Categorical variables: manually select the colors (<code class="inlinefunc">scale_color_manual()</code>)</h3>
<pre><code class="r">ggplot(nmmaps, aes(date, temp, color=factor(season)))+
  geom_point() + 
  scale_color_manual(values=c("dodgerblue4", "darkolivegreen4",
                              "darkorchid3", "goldenrod1"))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image37sm.png" rel="attachment wp-att-1621"><img class="alignleft size-full wp-image-1621" src="http://zevross.com/blog/wp-content/uploads/2014/08/image37sm.png" alt="image37sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image37sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image37sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image37sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="categorical-variables-try-a-built-in-palette-based-on-colorbrewer2.org-scale_color_brewer">Categorical variables: try a built-in palette (based on colorbrewer2.org) (<code class="inlinefunc">scale_color_brewer()</code>):</h3>
<pre><code class="r">ggplot(nmmaps, aes(date, temp, color=factor(season)))+
  geom_point() + 
  scale_color_brewer(palette="Set1")
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image38sm.png" rel="attachment wp-att-1622"><img class="alignleft size-full wp-image-1622" src="http://zevross.com/blog/wp-content/uploads/2014/08/image38sm.png" alt="image38sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image38sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image38sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image38sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>How about using the Tableau colors (but you need the library <code>ggthemes</code>):</p>
<pre><code class="r">library(ggthemes)
ggplot(nmmaps, aes(date, temp, color=factor(season)))+
  geom_point() + 
  scale_colour_tableau()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image39sm.png" rel="attachment wp-att-1623"><img class="alignleft size-full wp-image-1623" src="http://zevross.com/blog/wp-content/uploads/2014/08/image39sm.png" alt="image39sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image39sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image39sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image39sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<h3 id="color-choice-with-continuous-variables-scale_color_gradient-scale_color_gradient2">Color choice with continuous variables (<code class="inlinefunc">scale_color_gradient()</code>, <code class="inlinefunc">scale_color_gradient2()</code>)</h3>
<p>In our example we will change the color variable to ozone, a continuous variable that is strongly related to temperature (higher temperature = higher ozone). The function <code>scale_color_gradient()</code> is a sequential gradient while <code>scale_color_gradient2()</code> is diverging.</p>
<p>Here is a default continuous color scheme (sequential color scheme):</p>
<pre><code class="r">ggplot(nmmaps, aes(date, temp, color=o3))+geom_point()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image40sm.png" rel="attachment wp-att-1624"><img class="alignleft size-full wp-image-1624" src="http://zevross.com/blog/wp-content/uploads/2014/08/image40sm.png" alt="image40sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image40sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image40sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image40sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<pre><code class="r"># this code produces an identical plot
#ggplot(nmmaps, aes(date, temp, color=o3))+geom_point()+scale_color_gradient()
</code></pre>
<p>Manually change the low and high colors (sequential color scheme):</p>
<pre><code class="r">ggplot(nmmaps, aes(date, temp, color=o3))+geom_point()+
  scale_color_gradient(low="darkkhaki", high="darkgreen")
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image41sm.png" rel="attachment wp-att-1626"><img class="alignleft size-full wp-image-1626" src="http://zevross.com/blog/wp-content/uploads/2014/08/image41sm.png" alt="image41sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image41sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image41sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image41sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>The temperature data is normally distributed so how about a diverging color scheme (rather than sequential). For diverging color you can use the <code>scale_color_gradient2</code> function.</p>
<pre><code class="r">mid&lt;-mean(nmmaps$o3)
ggplot(nmmaps, aes(date, temp, color=o3))+geom_point()+
scale_color_gradient2(midpoint=mid,
                      low="blue", mid="white", high="red" )
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image42sm.png" rel="attachment wp-att-1627"><img class="alignleft size-full wp-image-1627" src="http://zevross.com/blog/wp-content/uploads/2014/08/image42sm.png" alt="image42sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image42sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image42sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image42sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<div id="working-with-annotation">
<h1>Working with annotation</h1>
<div id="add-text-annotation-in-the-top-right-top-left-etc.-annotation_custom-and-friends">
<h3>Add text annotation in the top-right, top-left etc. (<code class="inlinefunc">annotation_custom()</code> and <code class="inlinefunc">textGrob()</code>)</h3>
<p>I often have trouble figuring out the best way to add text to a plot in say, the top left corner, without using hard-coded coordinates. With <code>ggplot2</code> you can set annotation coordinates to <code>Inf</code> but I find this only moderately useful. Here is an example (based on code from <a href="https://groups.google.com/forum/#!topic/ggplot2/X7pD7LNdY2Y" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://groups.google.com/forum/#!topic/ggplot2/X7pD7LNdY2Y', 'here');">here</a>) using the library <code>grid</code> that allows you to specify the location based on scaled coordinates where 0 is low and 1 is high.</p>
<p>The <code>grobTree</code> function (from <code>grid</code>) creates a grid graphical object and <code>textGrob</code> creates the text graphical object. The annotation_custom() function comes from <code>ggplot2</code> and is designed to use a grob as input.</p>
<pre><code class="r">library(grid)

my_grob = grobTree(textGrob("This text stays in place!", x=0.1,  y=0.95, hjust=0,
  gp=gpar(col="blue", fontsize=15, fontface="italic")))

ggplot(nmmaps, aes(temp, o3))+geom_point(color="firebrick")+
  annotation_custom(my_grob)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image43sm.png" rel="attachment wp-att-1628"><img class="alignleft size-full wp-image-1628" src="http://zevross.com/blog/wp-content/uploads/2014/08/image43sm.png" alt="image43sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image43sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image43sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image43sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>&#8216;Big deal&#8217; you say!? It is a big deal. The value here is particularly evident when you have multiple plots with <strong>different scales</strong>. In the plot below you see that the axis scales vary yet the same code as above can be used to put the annotation is the same place on each facet. Nice!</p>
<pre><code class="r">library(grid)

my_grob = grobTree(textGrob("This text stays in place!", x=0.1,  y=0.95, hjust=0,
  gp=gpar(col="blue", fontsize=12, fontface="italic")))

ggplot(nmmaps, aes(temp, o3))+geom_point(color="firebrick")+facet_wrap(~season, scales="free")+
  annotation_custom(my_grob)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image44sm.png" rel="attachment wp-att-1629"><img class="alignleft size-full wp-image-1629" src="http://zevross.com/blog/wp-content/uploads/2014/08/image44sm.png" alt="image44sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image44sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image44sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image44sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<h1 id="working-with-coordinates">Working with coordinates</h1>
<h3 id="flip-a-plot-on-its-side-coord_flip">Flip a plot on it&#8217;s side (<code class="inlinefunc">coord_flip()</code>)</h3>
<p>It is incredibly easy to flip your plot on it&#8217;s side. Here I&#8217;ve added the coord_flip() which is all you need to flip the plot.</p>
<pre><code class="r">ggplot(nmmaps, aes(x=season, y=o3))+geom_boxplot(fill="chartreuse4")+coord_flip()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image45sm.png" rel="attachment wp-att-1630"><img class="alignleft size-full wp-image-1630" src="http://zevross.com/blog/wp-content/uploads/2014/08/image45sm.png" alt="image45sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image45sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image45sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image45sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<h1 id="working-with-plot-types">Working with plot types</h1>
<h3 id="alternatives-to-the-box-plot">Alternatives to the box plot (<code class="inlinefunc">geom_jitter()</code> and <code class="inlinefunc">geom_violin()</code>)</h3>
<h4>Start with a box plot</h4>
<p>Box plots are great, but they can be so incredibly boring. There are alternatives, first &#8211; a box plot:</p>
<pre><code class="r">g&lt;-ggplot(nmmaps, aes(x=season, y=o3))
g+geom_boxplot(fill="darkseagreen4")
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image46sm.png" rel="attachment wp-att-1631"><img class="alignleft size-full wp-image-1631" src="http://zevross.com/blog/wp-content/uploads/2014/08/image46sm.png" alt="image46sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image46sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image46sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image46sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Effective, yes. Interesting, no.</p>
<h4>Alternative to a box plot: plot of points</h4>
<p>What if we plot the points themselves?</p>
<pre><code class="r">g+geom_point()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image47sm.png" rel="attachment wp-att-1632"><img class="alignleft size-full wp-image-1632" src="http://zevross.com/blog/wp-content/uploads/2014/08/image47sm.png" alt="image47sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image47sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image47sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image47sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Not only boring but uninformative, you could add transparency to deal with overplotting, but this is not good either. Let&#8217;s try something else.</p>
<h4>Alternative to a box plot: jitter the points (<code class="inlinefunc">geom_jitter()</code>)</h4>
<p>Try adding a little jitter to the data. I like this for in-house visualization but be careful using jittering because you&#8217;re purposely adding noise to your data and this can result in misinterpretation of your data.</p>
<pre><code class="r">g+geom_jitter(alpha=0.5, aes(color=season),position = position_jitter(width = .2))
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image48sm.png" rel="attachment wp-att-1633"><img class="alignleft size-full wp-image-1633" src="http://zevross.com/blog/wp-content/uploads/2014/08/image48sm.png" alt="image48sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image48sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image48sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image48sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>This is better and I think since we&#8217;re working with season, a variable everyone will be familiar with, the extra noise will not likely lead to confusion.</p>
<h4>Alternative to a box plot: violin plot perhaps (<code class="inlinefunc">geom_violin()</code>)</h4>
<p>Violin plots, similar to box plots except you&#8217;re using a kernel density to show where you have the most data, are a useful visualization.</p>
<pre><code class="r">g+geom_violin(alpha=0.5, color="gray")
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image49sm.png" rel="attachment wp-att-1634"><img class="alignleft size-full wp-image-1634" src="http://zevross.com/blog/wp-content/uploads/2014/08/image49sm.png" alt="image49sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image49sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image49sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image49sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>What if we rotated and added the jittered points.</p>
<pre><code class="r">g+geom_violin(alpha=0.5, color="gray")+geom_jitter(alpha=0.5, aes(color=season),
      position = position_jitter(width = 0.1))+coord_flip()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image50sm.png" rel="attachment wp-att-1635"><img class="alignleft size-full wp-image-1635" src="http://zevross.com/blog/wp-content/uploads/2014/08/image50sm.png" alt="image50sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image50sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image50sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image50sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>This is nice and I like it. But be wary of using unusual plot types, they take more time for your users to understand. Sometimes the simplest and most conventional plot type is your best bet when sharing with others. Box plots may be boring but people know how to interpret them immediately.</p>
<h3 id="create-a-ribbon-geom_ribbon">Add a ribbon to your plot (<code class="inlinefunc">geom_ribbon()</code>)</h3>
<p>This is not the perfect dataset for this, but using ribbon can be useful. In this example we will create a 30-day running average using the <code>filter()</code> function so that our ribbon is not too noisy.</p>
<pre><code class="r"># add a filter
nmmaps$o3run&lt;-as.numeric(filter(nmmaps$o3, rep(1/30,30), sides=2))
ggplot(nmmaps, aes(date, o3run))+geom_line(color="lightpink4", lwd=1)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image51sm.png" rel="attachment wp-att-1637"><img class="alignleft size-full wp-image-1637" src="http://zevross.com/blog/wp-content/uploads/2014/08/image51sm.png" alt="image51sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image51sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image51sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image51sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>How does it look if we fill in the area below the curve using the <code>geom_ribbon()</code> function?</p>
<pre><code class="r"># add a filter

ggplot(nmmaps, aes(date, o3run))+geom_ribbon(aes(ymin=0, ymax=o3run), fill="lightpink3", color="lightpink3")+
  geom_line(color="lightpink4", lwd=1)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image52sm.png" rel="attachment wp-att-1638"><img class="alignleft size-full wp-image-1638" src="http://zevross.com/blog/wp-content/uploads/2014/08/image52sm.png" alt="image52sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image52sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image52sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image52sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Above is not really the conventional way to use <code>geom_ribbon()</code>. Instead, why don&#8217;t we draw a ribbon that gives us one standard deviation above and below our data:</p>
<pre><code class="r">nmmaps$mino3&lt;-nmmaps$o3run-sd(nmmaps$o3run, na.rm=T)
nmmaps$maxo3&lt;-nmmaps$o3run+sd(nmmaps$o3run, na.rm=T)

ggplot(nmmaps, aes(date, o3run))+geom_ribbon(aes(ymin=mino3, ymax=maxo3), fill="steelblue2", color="steelblue2")+
  geom_line(color="steelblue4", lwd=1)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image53sm.png" rel="attachment wp-att-1639"><img class="alignleft size-full wp-image-1639" src="http://zevross.com/blog/wp-content/uploads/2014/08/image53sm.png" alt="image53sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image53sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image53sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image53sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<h3 id="create-a-tiled-correlation-plot">Create a tiled correlation plot (<code>geom_tile()</code>)</h3>
<p>I&#8217;ll admit that I find creating tiled correlation plots a bit cumbersome, I always have to copy and paste code from a previous project. Nevertheless, it&#8217;s a useful plot type so I&#8217;m posting the code here.</p>
<p>First step is to create the correlation matrix. I&#8217;m using Pearson because all the variables are fairly normally distributed – you may want to consider Spearman if your variables follow a different pattern. Note that since a correlation matrix has redundant information I&#8217;m setting half of it to NA.</p>
<pre><code class="r">#careful, I'm sorting the field names so that the ordering in the final plot is correct
thecor&lt;-round(cor(nmmaps[,sort(c("death", "temp", "dewpoint", "pm10", "o3"))], method="pearson", use="pairwise.complete.obs"),2)
thecor[lower.tri(thecor)]&lt;-NA
thecor
##          death dewpoint    o3 pm10  temp
## death        1    -0.47 -0.24 0.00 -0.49
## dewpoint    NA     1.00  0.45 0.33  0.96
## o3          NA       NA  1.00 0.21  0.53
## pm10        NA       NA    NA 1.00  0.37
## temp        NA       NA    NA   NA  1.00
</code></pre>
<p>Now I&#8217;m going to put it in “long” format using the melt function from the <code>reshape2</code> package and I&#8217;ll drop the records with NA values.</p>
<pre><code class="r">library(reshape2)

thecor&lt;-melt(thecor)
thecor$Var1&lt;-as.character(thecor$Var1)
thecor$Var2&lt;-as.character(thecor$Var2)
thecor&lt;-na.omit(thecor)
head(thecor)
##        Var1     Var2 value
## 1     death    death  1.00
## 6     death dewpoint -0.47
## 7  dewpoint dewpoint  1.00
## 11    death       o3 -0.24
## 12 dewpoint       o3  0.45
## 13       o3       o3  1.00
</code></pre>
<p>Now for the plot. I&#8217;m using <code>geom_tile</code> but if you have a lot of data you might consider <code>geom_raster</code> which can be much faster.</p>
<pre><code class="r">ggplot(thecor, aes(Var2, Var1))+
 geom_tile(data=thecor, aes(fill=value), color="white")+
 scale_fill_gradient2(low="blue", high="red", mid="white", 
  midpoint=0, limit=c(-1,1),name="Correlation\n(Pearson)")+
 theme(axis.text.x = element_text(angle=45, vjust=1, size=11, hjust=1))+
 coord_equal()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image54sm.png" rel="attachment wp-att-1640"><img class="alignleft size-full wp-image-1640" src="http://zevross.com/blog/wp-content/uploads/2014/08/image54sm.png" alt="image54sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image54sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image54sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image54sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p><a class="toc" href="#TOC">Back to table of contents</a></p>
<div id="working-with-smooths">
<h1>Working with smooths</h1>
<p>You&#8217;ve likely already learned how amazingly easy it is to add a smooth to your data using <code>ggplot2</code>. You can simply use <code>stat_smooth()</code> which will add a LOESS smooth if you have fewer than 1000 points or a GAM otherwise. Since we have more than 1000 points the smooth is a GAM.</p>
<h3 id="default-adding-loess-or-gam">Default &#8211; adding LOESS or GAM (<code>stat_smooth()</code>)</h3>
<p>Here it is at its simplest – no formula required:</p>
<pre><code class="r">ggplot(nmmaps, aes(date, temp))+geom_point(color="firebrick")+
  stat_smooth()
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image55sm.png" rel="attachment wp-att-1641"><img class="alignleft size-full wp-image-1641" src="http://zevross.com/blog/wp-content/uploads/2014/08/image55sm.png" alt="image55sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image55sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image55sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image55sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<h3 id="specifying-the-formula">Specifying the formula (<code>stat_smooth(formula=)</code>)</h3>
<p>But <code>ggplot2</code> allows you to specify the model you want it to use. For example, let&#8217;s say you want to increase the GAM dimension (add some additional wiggles to the smooth):</p>
<pre><code class="r">ggplot(nmmaps, aes(date, temp))+
  geom_point(color="grey")+
  stat_smooth(method="gam", formula=y~s(x,k=10), col="darkolivegreen2", se=FALSE, size=1)+
  stat_smooth(method="gam", formula=y~s(x,k=30), col="red", se=FALSE, size=1)+
  stat_smooth(method="gam", formula=y~s(x,k=500), col="dodgerblue4", se=FALSE, size=1)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image56sm.png" rel="attachment wp-att-1642"><img class="alignleft size-full wp-image-1642" src="http://zevross.com/blog/wp-content/uploads/2014/08/image56sm.png" alt="image56sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image56sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image56sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image56sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<h3 id="adding-a-linear-fit">Adding a linear fit (<code>stat_smooth(method="lm")</code>)</h3>
<p>Though the default is a smooth, it is also easy to add a standard linear fit:</p>
<pre><code class="r">ggplot(nmmaps, aes(temp, death))+geom_point(color="firebrick")+
  stat_smooth(method="lm", se=FALSE)
</code></pre>
<div class="img-wrapper"><a href="http://zevross.com/blog/wp-content/uploads/2014/08/image57sm.png" rel="attachment wp-att-1643"><img class="alignleft size-full wp-image-1643" src="http://zevross.com/blog/wp-content/uploads/2014/08/image57sm.png" alt="image57sm" width="504" height="504" srcset="http://zevross.com/blog/wp-content/uploads/2014/08/image57sm-150x150.png 150w, http://zevross.com/blog/wp-content/uploads/2014/08/image57sm-300x300.png 300w, http://zevross.com/blog/wp-content/uploads/2014/08/image57sm.png 504w" sizes="(max-width: 504px) 100vw, 504px" /></a></div>
<p>Note that the same could be achieved using the more cumbersome:</p>
<pre><code class="r">lmTemp&lt;-lm(death~temp, data=nmmaps)
ggplot(nmmaps, aes(temp, death))+geom_point(col="firebrick")+
  geom_abline(intercept=lmTemp$coef[1], slope=lmTemp$coef[2])
</code></pre>
<div id="put-viz-online-plotly">
<h1>Convert your plots to online, interactive graphics using Plot.ly</h1>
<p>Plot.ly is a great tool for easily creating online, interactive graphics directly from your ggplot2 plots. The process is surprisingly easy, and can be done from within R, but there are enough steps that I describe how to create graphics like the one below in a <a href="http://zevross.com/blog/2014/09/10/quickly-create-online-and-interactive-plots-using-plot-ly/">separate post</a>.</p>
<p><em>If this plot is not visible it is being throttled by plot.ly which limits free plot hosting to 500 views per day.</em></p>
<p><iframe src="https://plot.ly/~zevross/15.embed?width=640&amp;height=480" width="640" height="480" frameborder="0" scrolling="no" seamless="seamless"></iframe></p>
<hr />
