
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
  a {text-decoration: none}
  A:hover { color: yellow }
</STYLE>
</head>
<body bgcolor="#000000" text="#109030" leftmargin="10" topmargin="10" marginwidth="100" link="#00C0A0" vlink="#309090" alink="#20B0B0" target=_blank>
<FONT size=3>


<div class="content">

    <div class="field field-type-text field-field-sub-title">
    <div class="field-items">
            <div class="field-item odd">
                    Find matching nodes in an internal XML tree/DOM        </div>
        </div>
</div>

    <div class="rdoc-content">
<div class="rdoc-description">
<h3>Description</h3>
<p>These functions provide a way to find XML nodes that match a particular   criterion. It uses the XPath syntax and allows very powerful   expressions to identify nodes of interest within a document both   clearly and efficiently.  The XPath language requires some   knowledge, but tutorials are available on the Web and in books.   XPath queries can result in different types of values such as numbers,   strings, and node sets. It allows simple identification of nodes   by name, by path (i.e. hierarchies or sequences of   node-child-child...), with a particular attribute  or matching   a particular attribute with a given value. It also supports   functionality for navigating nodes in the tree within a query   (e.g. <span class="geshifilter"><code class="r geshifilter-r">ancestor<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, <span class="geshifilter"><code class="r geshifilter-r">child<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, <span class="geshifilter"><code class="r geshifilter-r">self<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>),   and also for manipulating the content of one or more nodes   (e.g. <span class="geshifilter"><code class="r geshifilter-r"><a href="http://inside-r.org/r-doc/graphics/text"><span style="color: #003399; font-weight: bold;">text</span></a></code></span>).   And it allows for criteria identifying nodes by position, etc.   using some counting operations.  Combining  XPath with R   allows for quite flexible node identification and manipulation.   XPath offers an alternative way to find nodes of interest    than recursively or iteratively navigating the entire tree in R   and performing the navigation explicitly.</p>
<p>  One can search an entire document or start the search from a   particular node.  Such node-based searches can even search up the tree   as well as within the sub-tree that the node parents.  Node specific   XPath expressions are typically started with a "." to indicate the   search is relative to that node.   </p>
<p>  The set of matching nodes corresponding to an XPath expression   are returned in R as a list.  One can then  iterate over these elements to process the    nodes in whatever way one wants. Unfortunately, this involves two loops -   one in the XPath query over the entire tree, and another in R.   Typically, this is fine as the number of matching nodes is reasonably small.   However, if repeating this on numerous files, speed may become an issue.   We can avoid the second loop (i.e. the one in R) by applying a function to each node   before it is returned to R as part of the node set.  The result of the function   call is then returned, rather than the node itself.</p>
<p>  One can provide an R expression rather than an R function for <span class="geshifilter"><code class="r geshifilter-r">fun</code></span>. This is expected to be a call   and the first argument of the call will be replaced with the node.</p>
<p>  Dealing with expressions that relate to the default namespaces in the   XML document can be confusing. </p>
<p>  <span class="geshifilter"><code class="r geshifilter-r">xpathSApply</code></span> is a version of <span class="geshifilter"><code class="r geshifilter-r">xpathApply</code></span>   which attempts to simplify the result if it can be converted   to a vector or matrix rather than left as a list.   In this way, it has the same relationship to  <span class="geshifilter"><code class="r geshifilter-r">xpathApply</code></span>   as <span class="geshifilter"><code class="r geshifilter-r"><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a></code></span> has to  <span class="geshifilter"><code class="r geshifilter-r"><a href="http://inside-r.org/r-doc/base/lapply"><span style="color: #003399; font-weight: bold;">lapply</span></a></code></span>.</p>
<p>  <span class="geshifilter"><code class="r geshifilter-r">matchNamespaces</code></span> is a separate function that is used to   facilitate   specifying the mappings from namespace prefix  used in the   XPath expression and their definitions, i.e. URIs,   and connecting these with the namespace definitions in the   target XML document in which the XPath expression will be evaluated.</p>
<p>  <span class="geshifilter"><code class="r geshifilter-r">matchNamespaces</code></span> uses rules that are very slightly awkard or   specifically involve a special case. This is because this mapping of   namespaces from  XPath to XML targets is difficult, involving    prefixes in the XPath expression, definitions in the XPath evaluation    context and matches of URIs with those in the XML document.    The function aims to avoid having to specify all the prefix=uri pairs    by using "sensible" defaults and also matching the prefixes in the    XPath expression to the  corresponding definitions in the XML    document.</p>
<p>   The rules are as follows.    <span class="geshifilter"><code class="r geshifilter-r">namespaces</code></span> is a character vector. Any element that has a    non-trivial name (i.e. other than "") is left as is and the name    and value define the prefix = uri mapping.    Any elements that have a trivial name (i.e. no name at all or "")    are resolved by first matching the prefix to those of the defined    namespaces anywhere within the target document, i.e. in any node and    not just the root one.    If there is no match for the first element of the <span class="geshifilter"><code class="r geshifilter-r">namespaces</code></span>    vector, this is treated specially and is mapped to the    default namespace of the target document. If there is no default    namespace defined, an error occurs.</p>
<p>   It is best to give explicit the argument in the form    <span class="geshifilter"><code class="r geshifilter-r"><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>prefix = uri<span style="color: #225544;">,</span> prefix = uri<span style="color: #009900;">&#41;</span></code></span>.    However, one can use the same namespace prefixes as in the document    if one wants.  And one can use an arbitrary namespace prefix    for the default namespace URI of the target document provided it is    the first element of <span class="geshifilter"><code class="r geshifilter-r">namespaces</code></span>.</p>
<p>   See the 'Details' section below for some more information.
</p></div>
<div class="rdoc-usage">
<h3>Usage</h3>
<pre class="rdoc-monospace">
getNodeSet(doc, path, namespaces = xmlNamespaceDefinitions(doc, simplify = TRUE), 
                    fun = NULL, sessionEncoding = CE_NATIVE, addFinalizer = NA, ...)
xpathApply(doc, path, fun, ... ,
            namespaces =  xmlNamespaceDefinitions(doc, simplify = TRUE),
              resolveNamespaces = TRUE, addFinalizer = NA)
xpathSApply(doc, path, fun = NULL, ... ,
             namespaces = xmlNamespaceDefinitions(doc, simplify = TRUE),
               resolveNamespaces = TRUE, simplify = TRUE, addFinalizer = NA)
matchNamespaces(doc, namespaces,
      nsDefs = xmlNamespaceDefinitions(doc, recursive = TRUE, simplify = FALSE),
      defaultNs = getDefaultNamespace(doc, simplify = TRUE))
</pre></div>
<div class="rdoc-arg-list">
<h3>Arguments</h3>
<dl class="rdoc-args">
<dt>doc</dt>
<dd>an object of class <span class="geshifilter"><code class="r geshifilter-r">XMLInternalDocument</code></span></dd>
<dt>path</dt>
<dd>a string (character vector of length 1) giving the     XPath expression to evaluate.</dd>
<dt>namespaces</dt>
<dd>a named character vector giving the     namespace prefix and URI pairs that are to be used     in the XPath expression and matching of nodes.    The prefix is just a simple string that acts as a short-hand     or alias for the URI that is the unique identifier for the    namespace.    The URI is the element in this vector and the prefix is the    corresponding element name.     One only needs to specify the namespaces in the XPath expression and     for the nodes of interest rather than requiring all the     namespaces for the entire document.     Also note that the prefix used in this vector is local only to the     path. It does not have to be the same as the prefix used in the     document to identify the namespace. However, the URI in this     argument must be identical to the target namespace URI in the     document.  It is the namespace URIs that are matched (exactly)     to find correspondence. The prefixes are used only to refer to     that URI.</dd>
<dt>fun</dt>
<dd>a function object, or an expression or call, which is used when the result is a node set      and evaluated for each node element in the node set.  If this is a call, the first argument is replaced       with the current node.</dd>
<dt>...</dt>
<dd>any additional arguments to be passed to <span class="geshifilter"><code class="r geshifilter-r">fun</code></span> for each    node in the node set.</dd>
<dt>resolveNamespaces</dt>
<dd>a logical value indicating whether    to process the collection of namespaces and resolve those that have    no name by looking in the default namespace and the namespace    definitions within the target document to match by prefix.</dd>
<dt>nsDefs</dt>
<dd>a list giving the namespace definitions in which to match   any prefixes. This is typically computed directly from the target   document and the default value is most appropriate.</dd>
<dt>defaultNs</dt>
<dd>the default namespace prefix-URI mapping given as a   named character vector. This is not a namespace definition object.   This is used when matching a simple prefix that has no corresponding   entry in <span class="geshifilter"><code class="r geshifilter-r">nsDefs</code></span> and is the first element in the   <span class="geshifilter"><code class="r geshifilter-r">namespaces</code></span> vector.</dd>
<dt>simplify</dt>
<dd>a logical value indicating whether the function    should attempt to perform the simplification of the result    into a vector rather  than leaving it as a list.    This is the same as <span class="geshifilter"><code class="r geshifilter-r"><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a></code></span> does    in comparison to <span class="geshifilter"><code class="r geshifilter-r"><a href="http://inside-r.org/r-doc/base/lapply"><span style="color: #003399; font-weight: bold;">lapply</span></a></code></span>.</dd>
<dt>sessionEncoding</dt>
<dd>experimental functionality and parameter related   to encoding.</dd>
<dt>addFinalizer</dt>
<dd>a logical value or identifier for a C routine         that controls whether we register finalizers on the intenal node.</dd>
</dl>
</div>
<div class="rdoc-details">
<h3>Details</h3>
<p>When a namespace is defined on a node in the XML document,   an XPath expressions must use a namespace, even if it is the default   namespace for the XML document/node.   For example, suppose we have an XML document <span class="geshifilter"><code class="r geshifilter-r"><span style="">&lt;</span>help xmlns=<span style="color: #225544;">&quot;http://www.r-project.org/Rd&quot;</span><span style="">&gt;&lt;</span>topic<span style="">&gt;</span>...<span style="">&lt;/</span>topic<span style="">&gt;&lt;/</span>help<span style="">&gt;</span></code></span>   To find all the topic nodes, we might want to use the XPath expression <span class="geshifilter"><code class="r geshifilter-r"><span style="color: #225544;">&quot;/help/topic&quot;</span></code></span>. However, we must use an explicit namespace prefix that is associated with the URI <span class="geshifilter"><code class="r geshifilter-r">http<span style="">://</span>www.r<span style="">-</span>project.org<span style="">/</span>Rd</code></span> corresponding to the one in the XML document. So we would use    <span class="geshifilter"><code class="r geshifilter-r">getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/r:help/r:topic&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>r = <span style="color: #225544;">&quot;http://www.r-project.org/Rd&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span></code></span>.</p>
<p>   As described above, the functions attempt to allow    the namespaces to be specified easily by the R user    and matched to the namespace definitions in the    target document.           This calls the libxml routine <span class="geshifilter"><code class="r geshifilter-r">xmlXPathEval</code></span>.
</p></div>
<div class="rdoc-arg-list">
<h3>Values</h3>
<p>The results can currently be different   based on the returned value from the XPath expression evaluation:            </p>
<p>  If <span class="geshifilter"><code class="r geshifilter-r">fun</code></span> is supplied and the result of the XPath query is a node set,    the result in R is a list.</p>
<dl class="rdoc-args">
<dt>list</dt>
<dd>a node set</dd>
<dt>numeric</dt>
<dd>a number</dd>
<dt>logical</dt>
<dd>a boolean</dd>
<dt>character</dt>
<dd>a string, i.e. a single character element.</dd>
</dl>
</div>
<div class="rdoc-references">
<h3>References</h3>
<p><a href="http://xmlsoft.org">http://xmlsoft.org</a>,    <a href="http://www.w3.org/xml">http://www.w3.org/xml</a>   <a href="http://www.w3.org/TR/xpath">http://www.w3.org/TR/xpath</a>   <a href="http://www.omegahat.net/RSXML">http://www.omegahat.net/RSXML</a>
</p></div>
<div class="rdoc-note">
<h3>Note</h3>
<p>In order to match nodes in the default name space for  documents with a non-trivial default namespace, e.g. given as   <span class="geshifilter"><code class="r geshifilter-r">xmlns=<span style="color: #225544;">&quot;http://www.omegahat.net&quot;</span></code></span>, you will need to use a prefix   for the default namespace in this call.   When specifying the namespaces, give a name - any name - to the   default namespace URI and then use this as the prefix in the   XPath expression, e.g.   <span class="geshifilter"><code class="r geshifilter-r">getNodeSet<span style="color: #009900;">&#40;</span>d<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//d:myNode&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>d = <span style="color: #225544;">&quot;http://www.omegahat.net&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span></code></span>   to match myNode in the default name space   <span class="geshifilter"><code class="r geshifilter-r">http<span style="">://</span>www.omegahat.net</code></span>.      This default namespace of the document is now computed for us and   is the default value for the namespaces argument.   It can be referenced using the prefix 'd',   standing for default but sufficiently short to be   easily used within the XPath expression.</p>
<p>     More of the XPath functionality provided by libxml can and may be   made available to the R package.   Facilities such as compiled XPath expressions, functions, ordered node   information are examples.       Please send requests to the package maintainer.
</p></div>
<div class="rdoc-seealso">
<h3>See Also</h3>
<p><span class="geshifilter"><code class="r geshifilter-r">xmlTreeParse</code></span> with <span class="geshifilter"><code class="r geshifilter-r">useInternalNodes</code></span> as <span class="geshifilter"><code class="r geshifilter-r"><span style="color: #000000; font-weight: bold;">TRUE</span></code></span>.
</p></div>
<div class="rdoc-examples">
<h3>Examples</h3>
<p><div class="geshifilter"><pre class="r geshifilter-r" style="font-family:monospace;">doc = xmlParse<span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/system.file"><span style="color: #003399; font-weight: bold;">system.file</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;exampleData&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;tagnames.xml&quot;</span><span style="color: #225544;">,</span> package = <span style="color: #225544;">&quot;XML&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
 els = getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/doc//a[@status]&quot;</span><span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>els<span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>el<span style="color: #009900;">&#41;</span> xmlGetAttr<span style="color: #009900;">&#40;</span>el<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;status&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;"># use of namespaces on an attribute.</span>
 getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/doc//b[@x:status]&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>x = <span style="color: #225544;">&quot;http://www.omegahat.net&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
 getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/doc//b[@x:status='foo']&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>x = <span style="color: #225544;">&quot;http://www.omegahat.net&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;"># Because we know the namespace definitions are on /doc/a</span>
   <span style="color: #666666; font-style: italic;"># we can compute them directly and use them.</span>
 nsDefs = xmlNamespaceDefinitions<span style="color: #009900;">&#40;</span>getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/doc/a&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/splines/ns"><span style="color: #003399; font-weight: bold;">ns</span></a> = <a href="http://inside-r.org/r-doc/base/structure"><span style="color: #003399; font-weight: bold;">structure</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>nsDefs<span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> x<span style="">$</span>uri<span style="color: #009900;">&#41;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a> = <a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">&#40;</span>nsDefs<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
 getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/doc//b[@omegahat:status='foo']&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/splines/ns"><span style="color: #003399; font-weight: bold;">ns</span></a><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span>
&nbsp;
 <span style="color: #666666; font-style: italic;"># free(doc) </span>
&nbsp;
 <span style="color: #666666; font-style: italic;">#####</span>
 f = <a href="http://inside-r.org/r-doc/base/system.file"><span style="color: #003399; font-weight: bold;">system.file</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;exampleData&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;eurofxref-hist.xml.gz&quot;</span><span style="color: #225544;">,</span> package = <span style="color: #225544;">&quot;XML&quot;</span><span style="color: #009900;">&#41;</span> 
 e = xmlParse<span style="color: #009900;">&#40;</span>f<span style="color: #009900;">&#41;</span>
 ans = getNodeSet<span style="color: #009900;">&#40;</span>e<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//o:Cube[@currency='USD']&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;o&quot;</span><span style="color: #009900;">&#41;</span>
 <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>ans<span style="color: #225544;">,</span> xmlGetAttr<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;rate&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;"># or equivalently</span>
 ans = xpathApply<span style="color: #009900;">&#40;</span>e<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//o:Cube[@currency='USD']&quot;</span><span style="color: #225544;">,</span> xmlGetAttr<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;rate&quot;</span><span style="color: #225544;">,</span> namespaces = <span style="color: #225544;">&quot;o&quot;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #666666; font-style: italic;"># free(e)</span>
&nbsp;
&nbsp;
&nbsp;
  <span style="color: #666666; font-style: italic;"># Using a namespace</span>
 f = <a href="http://inside-r.org/r-doc/base/system.file"><span style="color: #003399; font-weight: bold;">system.file</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;exampleData&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;SOAPNamespaces.xml&quot;</span><span style="color: #225544;">,</span> package = <span style="color: #225544;">&quot;XML&quot;</span><span style="color: #009900;">&#41;</span> 
 z = xmlParse<span style="color: #009900;">&#40;</span>f<span style="color: #009900;">&#41;</span>
 getNodeSet<span style="color: #009900;">&#40;</span>z<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/a:Envelope/a:Body&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;a&quot;</span> = <span style="color: #225544;">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
 getNodeSet<span style="color: #009900;">&#40;</span>z<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//a:Body&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;a&quot;</span> = <span style="color: #225544;">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #666666; font-style: italic;"># free(z)</span>
&nbsp;
&nbsp;
  <span style="color: #666666; font-style: italic;"># Get two items back with namespaces</span>
 f = <a href="http://inside-r.org/r-doc/base/system.file"><span style="color: #003399; font-weight: bold;">system.file</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;exampleData&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;gnumeric.xml&quot;</span><span style="color: #225544;">,</span> package = <span style="color: #225544;">&quot;XML&quot;</span><span style="color: #009900;">&#41;</span> 
 z = xmlParse<span style="color: #009900;">&#40;</span>f<span style="color: #009900;">&#41;</span>
 getNodeSet<span style="color: #009900;">&#40;</span>z<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//gmr:Item/gmr:name&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>gmr=<span style="color: #225544;">&quot;http://www.gnome.org/gnumeric/v2&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
 <span style="color: #666666; font-style: italic;">#free(z)</span>
&nbsp;
 <span style="color: #666666; font-style: italic;">#####</span>
 <span style="color: #666666; font-style: italic;"># European Central Bank (ECB) exchange rate data</span>
&nbsp;
  <span style="color: #666666; font-style: italic;"># Data is available from &quot;http://www.ecb.int/stats/eurofxref/eurofxref-hist.xml&quot;</span>
  <span style="color: #666666; font-style: italic;"># or locally.</span>
&nbsp;
 uri = <a href="http://inside-r.org/r-doc/base/system.file"><span style="color: #003399; font-weight: bold;">system.file</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;exampleData&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;eurofxref-hist.xml.gz&quot;</span><span style="color: #225544;">,</span> package = <span style="color: #225544;">&quot;XML&quot;</span><span style="color: #009900;">&#41;</span>
 doc = xmlParse<span style="color: #009900;">&#40;</span>uri<span style="color: #009900;">&#41;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;"># The default namespace for all elements is given by</span>
 namespaces <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/splines/ns"><span style="color: #003399; font-weight: bold;">ns</span></a>=<span style="color: #225544;">&quot;http://www.ecb.int/vocabulary/2002-08-01/eurofxref&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
&nbsp;
     <span style="color: #666666; font-style: italic;"># Get the data for Slovenian currency for all time periods.</span>
     <span style="color: #666666; font-style: italic;"># Find all the nodes of the form &lt;Cube currency=&quot;SIT&quot;...&gt;</span>
&nbsp;
 slovenia = getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//ns:Cube[@currency='SIT']&quot;</span><span style="color: #225544;">,</span> namespaces <span style="color: #009900;">&#41;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;"># Now we have a list of such nodes, loop over them </span>
    <span style="color: #666666; font-style: italic;"># and get the rate attribute</span>
 rates = <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span> <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>slovenia<span style="color: #225544;">,</span> xmlGetAttr<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;rate&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span>
    <span style="color: #666666; font-style: italic;"># Now put the date on each element</span>
    <span style="color: #666666; font-style: italic;"># find nodes of the form &lt;Cube time=&quot;..&quot; ... &gt;</span>
    <span style="color: #666666; font-style: italic;"># and extract the time attribute</span>
 <a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">&#40;</span>rates<span style="color: #009900;">&#41;</span> = <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//ns:Cube[@time]&quot;</span><span style="color: #225544;">,</span> namespaces <span style="color: #009900;">&#41;</span><span style="color: #225544;">,</span> 
                      xmlGetAttr<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;time&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;">#  Or we could turn these into dates with strptime()</span>
 strptime<span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">&#40;</span>rates<span style="color: #009900;">&#41;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;%Y-%m-%d&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
&nbsp;
   <span style="color: #666666; font-style: italic;">#  Using xpathApply, we can do</span>
 rates = xpathApply<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//ns:Cube[@currency='SIT']&quot;</span><span style="color: #225544;">,</span> xmlGetAttr<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;rate&quot;</span><span style="color: #225544;">,</span> namespaces = namespaces <span style="color: #009900;">&#41;</span>
 rates = <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/unlist"><span style="color: #003399; font-weight: bold;">unlist</span></a><span style="color: #009900;">&#40;</span>rates<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;"># Using an expression rather than  a function and ...</span>
 rates = xpathApply<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//ns:Cube[@currency='SIT']&quot;</span><span style="color: #225544;">,</span>
                   <a href="http://inside-r.org/r-doc/base/quote"><span style="color: #003399; font-weight: bold;">quote</span></a><span style="color: #009900;">&#40;</span>xmlGetAttr<span style="color: #009900;">&#40;</span>x<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;rate&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #225544;">,</span> namespaces = namespaces <span style="color: #009900;">&#41;</span>
&nbsp;
 <span style="color: #666666; font-style: italic;">#free(doc)</span>
&nbsp;
   <span style="color: #666666; font-style: italic;">#</span>
  uri = <a href="http://inside-r.org/r-doc/base/system.file"><span style="color: #003399; font-weight: bold;">system.file</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;exampleData&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;namespaces.xml&quot;</span><span style="color: #225544;">,</span> package = <span style="color: #225544;">&quot;XML&quot;</span><span style="color: #009900;">&#41;</span>
  d = xmlParse<span style="color: #009900;">&#40;</span>uri<span style="color: #009900;">&#41;</span>
  getNodeSet<span style="color: #009900;">&#40;</span>d<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//c:c&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a>=<span style="color: #225544;">&quot;http://www.c.org&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
  getNodeSet<span style="color: #009900;">&#40;</span>d<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/o:a//c:c&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;o&quot;</span> = <span style="color: #225544;">&quot;http://www.omegahat.net&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;c&quot;</span> = <span style="color: #225544;">&quot;http://www.c.org&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;"># since &lt;a href=&quot;http://www.omegahat.net&quot; title=&quot;http://www.omegahat.net&quot;&gt;http://www.omegahat.net&lt;/a&gt; is the default namespace, we can</span>
   <span style="color: #666666; font-style: italic;"># just the prefix &quot;o&quot; to map to that.</span>
  getNodeSet<span style="color: #009900;">&#40;</span>d<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/o:a//c:c&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;o&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;c&quot;</span> = <span style="color: #225544;">&quot;http://www.c.org&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
&nbsp;
   <span style="color: #666666; font-style: italic;"># the following, perhaps unexpectedly but correctly, returns an empty</span>
   <span style="color: #666666; font-style: italic;"># with no matches</span>
&nbsp;
  getNodeSet<span style="color: #009900;">&#40;</span>d<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//defaultNs&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;http://www.omegahat.net&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;"># But if we create our own prefix for the evaluation of the XPath</span>
   <span style="color: #666666; font-style: italic;"># expression and use this in the expression, things work as one</span>
   <span style="color: #666666; font-style: italic;"># might hope.</span>
  getNodeSet<span style="color: #009900;">&#40;</span>d<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//dummy:defaultNs&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>dummy = <span style="color: #225544;">&quot;http://www.omegahat.net&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;"># And since the default value for the namespaces argument is the</span>
   <span style="color: #666666; font-style: italic;"># default namespace of the document, we can refer to it with our own</span>
   <span style="color: #666666; font-style: italic;"># prefix given as </span>
  getNodeSet<span style="color: #009900;">&#40;</span>d<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//d:defaultNs&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;d&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;"># And the syntactic sugar is </span>
  d<span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;//d:defaultNs&quot;</span><span style="color: #225544;">,</span> namespace = <span style="color: #225544;">&quot;d&quot;</span><span style="color: #009900;">&#93;</span>
&nbsp;
&nbsp;
   <span style="color: #666666; font-style: italic;"># this illustrates how we can use the prefixes in the XML document</span>
   <span style="color: #666666; font-style: italic;"># in our query and let getNodeSet() and friends map them to the</span>
   <span style="color: #666666; font-style: italic;"># actual namespace definitions.</span>
   <span style="color: #666666; font-style: italic;"># &quot;o&quot; is used to represent the default namespace for the document</span>
   <span style="color: #666666; font-style: italic;"># i.e. &lt;a href=&quot;http://www.omegahat.net&quot; title=&quot;http://www.omegahat.net&quot;&gt;http://www.omegahat.net&lt;/a&gt;, and &quot;r&quot; is mapped to the same</span>
   <span style="color: #666666; font-style: italic;"># definition that has the prefix &quot;r&quot; in the XML document.</span>
&nbsp;
  tmp = getNodeSet<span style="color: #009900;">&#40;</span>d<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;/o:a/r:b/o:defaultNs&quot;</span><span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;o&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;r&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
  xmlName<span style="color: #009900;">&#40;</span>tmp<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
&nbsp;
&nbsp;
  <span style="color: #666666; font-style: italic;">#free(d)</span>
&nbsp;
&nbsp;
   <span style="color: #666666; font-style: italic;"># Work with the nodes and their content (not just attributes) from the node set.</span>
   <span style="color: #666666; font-style: italic;"># From bondsTables.R in examples/</span>
&nbsp;
  doc =
 htmlTreeParse<span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;http://finance.yahoo.com/bonds/composite_bond_rates&quot;</span><span style="color: #225544;">,</span>
               useInternalNodes = <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #009900;">&#41;</span>
  <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/is.null"><span style="color: #003399; font-weight: bold;">is.null</span></a><span style="color: #009900;">&#40;</span>xmlRoot<span style="color: #009900;">&#40;</span>doc<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> 
     doc = htmlTreeParse<span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;http://finance.yahoo.com/bonds&quot;</span><span style="color: #225544;">,</span> useInternalNodes = <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #009900;">&#41;</span>
&nbsp;
     <span style="color: #666666; font-style: italic;"># Use XPath expression to find the nodes </span>
     <span style="color: #666666; font-style: italic;">#  &lt;div&gt;&lt;table class=&quot;yfirttbl&quot;&gt;..</span>
     <span style="color: #666666; font-style: italic;"># as these are the ones we want.</span>
&nbsp;
  <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span><span style="">!</span><a href="http://inside-r.org/r-doc/base/is.null"><span style="color: #003399; font-weight: bold;">is.null</span></a><span style="color: #009900;">&#40;</span>xmlRoot<span style="color: #009900;">&#40;</span>doc<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
   o = getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//div/table[@class='yfirttbl']&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;"># Write a function that will extract the information out of a given table node.</span>
   readHTMLTable =
   <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>tb<span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
          <span style="color: #666666; font-style: italic;"># get the header information.</span>
      colNames = <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>tb<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;thead&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;tr&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;th&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #225544;">,</span> xmlValue<span style="color: #009900;">&#41;</span>
      vals = <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>tb<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;tbody&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;tr&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #225544;">,</span>  <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;td&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #225544;">,</span> xmlValue<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
      <a href="http://inside-r.org/r-doc/base/matrix"><span style="color: #003399; font-weight: bold;">matrix</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">&#40;</span>vals<span style="color: #009900;">&#91;</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #225544;">,</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #225544;">,</span>
              <a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a> = <a href="http://inside-r.org/r-doc/base/ncol"><span style="color: #003399; font-weight: bold;">ncol</span></a><span style="color: #009900;">&#40;</span>vals<span style="color: #009900;">&#41;</span><span style="color: #225544;">,</span>
              <a href="http://inside-r.org/r-doc/base/dimnames"><span style="color: #003399; font-weight: bold;">dimnames</span></a> = <a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">&#40;</span>vals<span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #225544;">,</span><span style="color: #009900;">&#93;</span><span style="color: #225544;">,</span> colNames<span style="color: #009900;">&#91;</span><span style="">-</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #225544;">,</span>
              byrow = <span style="color: #000000; font-weight: bold;">TRUE</span>
            <span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#125;</span>  
&nbsp;
&nbsp;
     <span style="color: #666666; font-style: italic;"># Now process each of the table nodes in the o list.</span>
    tables = <a href="http://inside-r.org/r-doc/base/lapply"><span style="color: #003399; font-weight: bold;">lapply</span></a><span style="color: #009900;">&#40;</span>o<span style="color: #225544;">,</span> readHTMLTable<span style="color: #009900;">&#41;</span>
    <a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">&#40;</span>tables<span style="color: #009900;">&#41;</span> = <a href="http://inside-r.org/r-doc/base/lapply"><span style="color: #003399; font-weight: bold;">lapply</span></a><span style="color: #009900;">&#40;</span>o<span style="color: #225544;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#41;</span> xmlValue<span style="color: #009900;">&#40;</span>x<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;caption&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
  <span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
     <span style="color: #666666; font-style: italic;"># this illustrates an approach to doing queries on a sub tree</span>
     <span style="color: #666666; font-style: italic;"># within the document.</span>
     <span style="color: #666666; font-style: italic;"># Note that there is a memory leak incurred here as we create a new</span>
     <span style="color: #666666; font-style: italic;"># XMLInternalDocument in the getNodeSet().</span>
&nbsp;
    f = <a href="http://inside-r.org/r-doc/base/system.file"><span style="color: #003399; font-weight: bold;">system.file</span></a><span style="color: #009900;">&#40;</span><span style="color: #225544;">&quot;exampleData&quot;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;book.xml&quot;</span><span style="color: #225544;">,</span> package = <span style="color: #225544;">&quot;XML&quot;</span><span style="color: #009900;">&#41;</span>
    doc = xmlParse<span style="color: #009900;">&#40;</span>f<span style="color: #009900;">&#41;</span>
    ch = getNodeSet<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//chapter&quot;</span><span style="color: #009900;">&#41;</span>
    xpathApply<span style="color: #009900;">&#40;</span>ch<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//section/title&quot;</span><span style="color: #225544;">,</span> xmlValue<span style="color: #009900;">&#41;</span>
&nbsp;
      <span style="color: #666666; font-style: italic;"># To fix the memory leak, we explicitly create a new document for</span>
      <span style="color: #666666; font-style: italic;"># the subtree, perform the query and then free it _when_ we are done</span>
      <span style="color: #666666; font-style: italic;"># with the resulting nodes.</span>
    subDoc = xmlDoc<span style="color: #009900;">&#40;</span>ch<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span>
    xpathApply<span style="color: #009900;">&#40;</span>subDoc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//section/title&quot;</span><span style="color: #225544;">,</span> xmlValue<span style="color: #009900;">&#41;</span>
    free<span style="color: #009900;">&#40;</span>subDoc<span style="color: #009900;">&#41;</span>
&nbsp;
&nbsp;
    txt =
<span style="color: #225544;">'&lt;top xmlns=&quot;http://www.r-project.org&quot; xmlns:r=&quot;http://www.r-project.org&quot;&gt;&lt;r:a&gt;&lt;b/&gt;&lt;/r:a&gt;&lt;/top&gt;'</span>
    doc = xmlInternalTreeParse<span style="color: #009900;">&#40;</span>txt<span style="color: #225544;">,</span> asText = <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #009900;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #666666; font-style: italic;">## Not run:</span>
     <span style="color: #666666; font-style: italic;"># Will fail because it doesn't know what the namespace x is</span>
     <span style="color: #666666; font-style: italic;"># and we have to have one eventhough it has no prefix in the document.</span>
    xpathApply<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//x:b&quot;</span><span style="color: #009900;">&#41;</span>
<span style="color: #666666; font-style: italic;">## End(Not run)</span>
&nbsp;
      <span style="color: #666666; font-style: italic;"># So this is how we do it - just  say x is to be mapped to the</span>
      <span style="color: #666666; font-style: italic;"># default unprefixed namespace which we shall call x!</span>
    xpathApply<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//x:b&quot;</span><span style="color: #225544;">,</span> namespaces = <span style="color: #225544;">&quot;x&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
       <span style="color: #666666; font-style: italic;"># Here r is mapped to the the corresponding definition in the document.</span>
    xpathApply<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//r:a&quot;</span><span style="color: #225544;">,</span> namespaces = <span style="color: #225544;">&quot;r&quot;</span><span style="color: #009900;">&#41;</span>
       <span style="color: #666666; font-style: italic;"># Here, xpathApply figures this out for us, but will raise a warning.</span>
    xpathApply<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//r:a&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
       <span style="color: #666666; font-style: italic;"># And here we use our own binding.</span>
    xpathApply<span style="color: #009900;">&#40;</span>doc<span style="color: #225544;">,</span> <span style="color: #225544;">&quot;//x:a&quot;</span><span style="color: #225544;">,</span> namespaces = <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span>x = <span style="color: #225544;">&quot;http://www.r-project.org&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
&nbsp;
&nbsp;
       <span style="color: #666666; font-style: italic;"># Get all the nodes in the entire tree.</span>
    <a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/unlist"><span style="color: #003399; font-weight: bold;">unlist</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">&#40;</span>doc<span style="color: #009900;">&#91;</span><span style="color: #225544;">&quot;//*|//text()|//comment()|//processing-instruction()&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #225544;">,</span>
    <a href="http://inside-r.org/r-doc/base/class"><span style="color: #003399; font-weight: bold;">class</span></a><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span></pre></div>
</p></div>
