<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width"/>
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, strong,  div.title').click(function(){
    parent.history.back();
    return false;
    });
});
</script>
<style>
body{width:80%;margin-left: 10%}
strong, h1, h2 {color: gold;}
</style>
</head><body>
<center><h1>mshta usage</h1>
<div id="toc"></div></center>
<br>
http://www.voidcn.com/article/p-bhilyzkf-bpx.html<br>
<br>

<ul> 
 <li>mshta is short for MicroSoft Html Application. It could run html file or html string as a parameter. </li> 
 <li>what is interesting is you can use it in a batch command or batch file and you can use some functions like in the browser such as show a dialog and so on.</li> 
 <li>with mshta you can run javascript code and vbscipt code in windows command line or batch file.</li> 
</ul> 
<p class="topic">Example 1, show a message box in many different ways.</p> 
<pre class="prettyprint">mshta javascript:window<span class="hljs-preprocessor">.execScript</span>(<span class="hljs-string">"msgBox('hello world!'):window.close"</span>,<span class="hljs-string">"vbs"</span>) 
mshta vbscript:window<span class="hljs-preprocessor">.execScript</span>(<span class="hljs-string">"alert('hello world!');close()"</span>,<span class="hljs-string">"javascript"</span>) 
mshta vbscript:window<span class="hljs-preprocessor">.execScript</span>(<span class="hljs-string">"msgBox('hello world!'):window.close"</span>,<span class="hljs-string">"vbs"</span>)
mshta javascript:alert(<span class="hljs-string">"hello world!"</span>)<span class="hljs-comment">;close()</span>
mshta vbscript:msgbox(<span class="hljs-string">"hello world!"</span>,<span class="hljs-number">64</span>,<span class="hljs-string">"Title"</span>)(window<span class="hljs-preprocessor">.close</span>)
mshta vbscript:CreateObject(<span class="hljs-string">"Wscript.Shell"</span>)<span class="hljs-preprocessor">.popup</span>(<span class="hljs-string">"hello world!"</span>,<span class="hljs-number">7</span>,<span class="hljs-string">"Title"</span>,<span class="hljs-number">64</span>)(window<span class="hljs-preprocessor">.close</span>)</pre> 
<p class="topic">Example 2, execute more than one commands in one line.(In fact this already shows in Example 1, you must find it, it is the close command.)</p> 
<pre class="prettyprint">mshta vbscript:<span class="hljs-keyword">execute</span>(<span class="hljs-string">"msgbox ""BOX one"":msgbox ""BOX two"":window.close"</span>) 
mshta vbscript:(<span class="hljs-built_in">msgbox</span>(<span class="hljs-string">"BOX one"</span>))(<span class="hljs-built_in">msgbox</span>(<span class="hljs-string">"BOX two"</span>)(window.close))
mshta javascript:alert(<span class="hljs-string">"BOX one"</span>,);alert(<span class="hljs-string">"BOX two"</span>);close()
mshta javascript:execScript(<span class="hljs-string">"msgBox('BOX one'):msgBox('BOX two'):window.close"</span>,<span class="hljs-string">"vbs"</span>)</pre> 
<p class="topic">Example 3, use ActiveXObject in script to use more sophisticated functions of the OS.</p> 
<pre class="prettyprint">mshta vbscript:createobject("sapi.spvoice").speak("Hello, I am tom, let's <span class="hljs-operator"><span class="hljs-keyword">do</span> something fun.<span class="hljs-string">")(window.close) mshta "</span>javascript:<span class="hljs-keyword">close</span>((V=(v=new ActiveXObject(<span class="hljs-string">'SAPI.SpVoice'</span>)).GetVoices()).<span class="hljs-aggregate">count</span>&amp;&amp;v.Speak(<span class="hljs-string">'Hello! I am '</span>+V(<span class="hljs-number">0</span>).GetAttribute(<span class="hljs-string">'Gender'</span>)))<span class="hljs-string">"</span></span></pre> 
<p class="topic">Example 4, javascript is much more easy to use, because you do not have to add so many double qoutes like in vbscript.</p> 
<pre class="prettyprint">mshta <span class="hljs-string">"javascript:var objFSO=new ActiveXObject('</span><span class="hljs-transposed_variable">Scripting.</span><span class="hljs-transposed_variable">FileSystemObject'</span>); var objFile = <span class="hljs-transposed_variable">objFSO.</span>CreateTextFile(<span class="hljs-string">'test.txt'</span>,true); <span class="hljs-transposed_variable">objFile.</span>Write(<span class="hljs-string">'Hello World.'</span>);<span class="hljs-transposed_variable">objFile.</span>Close();close();<span class="hljs-string">" mshta "</span>javascript:var sh=new ActiveXObject( <span class="hljs-string">'WScript.Shell'</span> ); <span class="hljs-transposed_variable">sh.</span>Popup( <span class="hljs-string">'hello world!'</span>, <span class="hljs-number">10</span>, <span class="hljs-string">'Title!'</span>, <span class="hljs-number">64</span> );close()<span class="hljs-string">"</span></pre> 
<p class="topic">Example 5, several ways to calculate the free memory of your computer.</p> 
<pre class="prettyprint">mshta <span class="hljs-string">"javascript:close(new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1).Write(GetObject('winmgmts:').ExecQuery('Select * from Win32_PerfFormattedData_PerfOS_Memory').ItemIndex(0).AvailableBytes));"</span>|more
<span class="hljs-keyword">for</span>  /f <span class="hljs-string">"usebackq"</span> %a <span class="hljs-keyword">in</span> (`mshta ^<span class="hljs-string">"javascript^:close^(new ActiveXObject^(^'Scripting.FileSystemObject^'^).GetStandardStream^(1^).Write^(GetObject^(^'winmgmts:^'^).ExecQuery^(^'Select * from Win32_PerfFormattedData_PerfOS_Memory^'^).ItemIndex^(0^).AvailableBytes^)^);^"</span>^|more`) <span class="hljs-keyword">do</span> set free_mem=%a
mshta <span class="hljs-string">"javascript:close(new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1).Write(GetObject('winmgmts:').ExecQuery('Select * from Win32_PerfFormattedData_PerfOS_Memory').ItemIndex(0).AvailableMBytes));"</span>|<span class="hljs-keyword">for</span> /f <span class="hljs-string">%%a in ('more') do set free_mem=%</span>%a</pre> 
<p class="topic">Example 6, another way to calculate free memory.</p> 
<pre class="prettyprint"><span class="hljs-variable">@echo</span> off
setlocal
<span class="hljs-symbol">:</span><span class="hljs-symbol">:</span> <span class="hljs-constant">Define</span> simple macros to support <span class="hljs-constant">JavaScript</span> within batch
set <span class="hljs-string">"beginJS=mshta "</span><span class="hljs-symbol">javascript:</span>close(new <span class="hljs-constant">ActiveXObject</span>(<span class="hljs-string">'Scripting.FileSystemObject'</span>).<span class="hljs-constant">GetStandardStream</span>(<span class="hljs-number">1</span>).<span class="hljs-constant">Write</span>(<span class="hljs-string">" set "</span>endJS=));<span class="hljs-string">""</span>
<span class="hljs-symbol">:</span><span class="hljs-symbol">:</span> <span class="hljs-constant">Direct</span> instantiation requires that output is piped
%beginJS% <span class="hljs-constant">GetObject</span>(<span class="hljs-string">'winmgmts:'</span>).<span class="hljs-constant">ExecQuery</span>(<span class="hljs-string">'Select * from Win32_PerfFormattedData_PerfOS_Memory'</span>).<span class="hljs-constant">ItemIndex</span>(<span class="hljs-number">0</span>).<span class="hljs-constant">AvailableBytes</span> %endJS% | findstr <span class="hljs-string">"^"</span>
<span class="hljs-symbol">:</span><span class="hljs-symbol">:</span> <span class="hljs-constant">FOR</span> /<span class="hljs-constant">F</span> does <span class="hljs-keyword">not</span> need pipe
<span class="hljs-keyword">for</span> /f <span class="hljs-string">%%N in ( '%</span>beginJS% <span class="hljs-constant">GetObject</span>(<span class="hljs-string">'winmgmts:'</span>).<span class="hljs-constant">ExecQuery</span>(<span class="hljs-string">'Select * from Win32_PerfFormattedData_PerfOS_Memory'</span>).<span class="hljs-constant">ItemIndex</span>(<span class="hljs-number">0</span>).<span class="hljs-constant">AvailableBytes</span> %endJS%<span class="hljs-string">' ) do set free_mem=%%N echo free_mem=%free_mem%</span></pre> 
<p class="topic">Example 7, show color pallets dialog.</p> 
<pre class="prettyprint">mshta "about:<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b</span><span class="hljs-params">()</span>{</span><span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">'Scripting.FileSystemObject'</span>).GetStandardStream(<span class="hljs-number">1</span>).Write(d.ChooseColorDlg().toString(<span class="hljs-number">16</span>));close();}</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">body</span> <span class="hljs-attribute">onload</span>=<span class="hljs-value">'b()'</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">'d'</span> <span class="hljs-attribute">classid</span>=<span class="hljs-value">'clsid:3050f819-98b5-11cf-bb82-00aa00bdce0b'</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>"|more</pre> 
<p class="topic">Example 8, show screen resolution.</p> 
<pre class="prettyprint">mshta <span class="hljs-string">"javascript:res=screen.width+'x'+screen.height;alert(res);close();"</span> <span class="hljs-number">1</span> <span class="hljs-string">| more</span></pre> 
<p class="topic">Example 9, use clipboard data.</p> 
<pre class="prettyprint">for /f "usebackq tokens=1,* delims=[]" %i in (<span class="hljs-smartquote">`mshta "javascript:close(new ActiveXObject('</span>Scripting.FileSystemObject').GetStandardStream(1).Write(clipboardData.getData(<span class="hljs-emphasis">'Text'</span>)));"^|find /v /n ""`) do @set "c[%i]=%j"</pre> 
<p class="topic">Example 10, use javascript setTimeout to delay some time interval to execute a command.</p> 
<pre class="prettyprint">mshta javascript:<span class="hljs-keyword">set</span>Timeout(<span class="hljs-string">'close()'</span>,<span class="hljs-number">10000</span>)</pre> 
<p class="topic">Example 11, show File Open Select Dialog, you can redirect your output to the command window or to a file or to a variable.</p> 
<pre class="prettyprint">mshta "about:<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">file</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">FILE</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">FILE.click();<span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">'Scripting.FileSystemObject'</span>).GetStandardStream(<span class="hljs-number">1</span>).WriteLine(FILE.value);close();resizeTo(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>"|more

mshta "about:<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">file</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">FILE</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">FILE.click();<span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">'Scripting.FileSystemObject'</span>).GetStandardStream(<span class="hljs-number">1</span>).WriteLine(FILE.value);close();</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>"&gt;test.txt

mshta "about:<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">file</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">FILE</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">FILE.click();<span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">'Scripting.FileSystemObject'</span>).GetStandardStream(<span class="hljs-number">1</span>).WriteLine(FILE.value);close();</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>"&gt;temp &amp;&amp; set /p a=<span class="hljs-tag">&lt;<span class="hljs-title">temp for</span> /<span class="hljs-attribute">f</span> "<span class="hljs-attribute">delims</span>=<span class="hljs-value">" %%i in ('mshta "</span><span class="hljs-value">about:&lt;input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">file</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">FILE</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">FILE.click();<span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">'Scripting.FileSystemObject'</span>).GetStandardStream(<span class="hljs-number">1</span>).WriteLine(FILE.value);close();</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>"') do set a=%%i</pre> 
<p class="topic">Example 12, show Open For Folder Dialog to select a directory, and you can assign it to a variable.</p> 
<pre class="prettyprint"><span class="hljs-keyword">for</span> /f <span class="hljs-string">"delims="</span> <span class="hljs-string">%%i in ('mshta "javascript:var folder=new ActiveXObject("Shell.Application").BrowseForFolder(0,'选择要处理的文件夹', 0, '').self.path;new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1).WriteLine(folder);close();"') do set input=%</span>%i</pre> 
<p class="topic">Example 13, execute batch command with parameters which has spaces.</p> 
<pre class="prettyprint">::a.bat
<span class="hljs-decorator">@echo off</span>
set text=Hello World
mshta vbscript:createobject(<span class="hljs-string">"WScript.Shell"</span>).Run(<span class="hljs-string">"b.bat "</span>+<span class="hljs-string">"""%text%"""</span>,<span class="hljs-number">0</span>)(window.close)
::b.bat
<span class="hljs-decorator">@echo off</span>
mshta <span class="hljs-string">"javascript:var sh=new ActiveXObject( 'WScript.Shell' ); sh.Popup( '%~1', 10, 'Title!', 64 ); close()"</span></pre> 
<p class="topic">Example 14, ultimate function, run a html file.</p> 
<pre class="prettyprint"><span class="hljs-comment">&lt;!-- :: Batch section @echo off setlocal echo Select an option: for /F "delims=" %%a in ('mshta.exe "%~F0"') do set "HTAreply=%%a" echo End of HTA window, reply: "%HTAreply%" goto :EOF --&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">HTML</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">HEAD</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">HTA:APPLICATION</span> <span class="hljs-attribute">SCROLL</span>=<span class="hljs-value">"no"</span> <span class="hljs-attribute">SYSMENU</span>=<span class="hljs-value">"no"</span> &gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">TITLE</span>&gt;</span>HTA Radio Buttons<span class="hljs-tag">&lt;/<span class="hljs-title">TITLE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">SCRIPT</span> <span class="hljs-attribute">language</span>=<span class="hljs-value">"JavaScript"</span>&gt;</span><span class="javascript"> window.resizeTo(<span class="hljs-number">440</span>,<span class="hljs-number">170</span>); <span class="hljs-keyword">var</span> reply = <span class="hljs-string">"No button selected"</span>; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeHTA</span><span class="hljs-params">()</span>{</span> <span class="hljs-keyword">var</span> fso = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Scripting.FileSystemObject"</span>); fso.GetStandardStream(<span class="hljs-number">1</span>).WriteLine(reply); window.close(); } </span><span class="hljs-tag">&lt;/<span class="hljs-title">SCRIPT</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">HEAD</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">BODY</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Which prize do you prefer?<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"radio"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"prize"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"reply=this.value"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"House"</span>&gt;</span>House<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"radio"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"prize"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"reply=this.value"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Money"</span>&gt;</span>$1 million<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"radio"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"prize"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"reply=this.value"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"None"</span>&gt;</span>No prize thanks, I'm already happy <span class="hljs-tag">&lt;<span class="hljs-title">b</span>&gt;</span>:)<span class="hljs-tag">&lt;/<span class="hljs-title">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"closeHTA();"</span>&gt;</span>Submit<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">BODY</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">HTML</span>&gt;</span></pre> 
<br>
<br>
<br>
<br>

<script>
	var toc = $('#toc');
	$('.topic').each(function(i) {
		var topic = $(this), topicNumber = i + 1;
		toc.append('<a href="#topic-'+topicNumber+'" target="_self">'+topic.text()+'</a><br>');
		topic.attr('id', 'topic-' + topicNumber);
	});
</script>

</body>
</html>
