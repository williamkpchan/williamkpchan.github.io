<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width"/>
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .topic, strong,  div.title').click(function(){
    parent.history.back();
    return false;
    });
});
</script>
<style>
body{width:80%;margin-left: 10%; font-size:24px;}
strong, h1, h2, .topic {color: gold;}
</style>
</head><body>
<center><h1>mshta usage</h1>
<div id="toc"></div></center>
<br>
http://www.voidcn.com/article/p-bhilyzkf-bpx.html<br>
<br>

<ul> 
 <li>mshta is short for MicroSoft Html Application. It could run html file or html string as a parameter. </li> 
 <li>what is interesting is you can use it in a batch command or batch file and you can use some functions like in the browser such as show a dialog and so on.</li> 
 <li>with mshta you can run javascript code and vbscipt code in windows command line or batch file.</li> 
</ul> 
<pre>
Notes: 
mshta cannot link local file

followings works in cmd mode but not in windows run mode and so not in R mode
mshta "about:&lt;img src='http://charts.aastocks.com/servlet/Charts?fontsize=12&15MinDelay=F&lang=1&titlestyle=1&vol=1&Indicator=3&indpara1=3&indpara2=6&indpara3=9&indpara4=12&indpara5=15&subChart2=3&ref2para1=12&ref2para2=26&ref2para3=9&subChart3=12&ref3para1=0&ref3para2=0&ref3para3=0&scheme=3&com=100&chartwidth=680&chartheight=400&stockid=110000&period=7&type=1&logoStyle=1'&gt;"
</pre>
<p class="topic">Example 1, show a message box in many different ways.</p> 
<pre>
mshta javascript:window<span>.execScript("msgBox('hello world!'):window.close","vbs"</span>) 
mshta javascript:alert(<span>"hello world!");close()</span>

mshta vbscript:window<span>.execScript("alert('hello world!');close()","javascript"</span>) 
mshta vbscript:window<span>.execScript("msgBox('hello world!'):window.close","vbs"</span>)
mshta vbscript:msgbox(<span>"hello world!",64,"Title"</span>)(window.close)
mshta vbscript:CreateObject(<span>"Wscript.Shell").popup("hello world!",7,"Title",64</span>)(window.close)
</pre> 

<p class="topic">Example 2, execute more than one commands in one line.</p> 
(In fact this already shows in Example 1, you must find it, it is the close command.)
<pre>

mshta javascript:alert(<span>"BOX one"</span>);alert(<span>"BOX two"</span>);close()
mshta javascript:execScript(<span>"msgBox('BOX one'):msgBox('BOX two'):window.close","vbs"</span>)

mshta vbscript:<span>execute("msgbox ""BOX one"":msgbox ""BOX two"":window.close"</span>) 
mshta vbscript:(<span>msgbox("BOX one"</span>))(<span>msgbox("BOX two"</span>)(window.close))

</pre> 
<p class="topic">Example 3, use ActiveXObject in script to use more sophisticated functions of the OS.</p> 
<pre>

mshta vbscript:createobject("sapi.spvoice").speak("Hello, I am tom, let's do something fun.")(window.close)

mshta "javascript:close((V=(v=new ActiveXObject('SAPI.SpVoice')).GetVoices()).count&amp;&amp;v.Speak('Hello! I am '+V(0).GetAttribute('Gender')))"
</pre> 
<p class="topic">Example 4, javascript is much more easy to use,</p> because you do not have to add so many double qoutes like in vbscript. 
<pre>
mshta <span>"javascript:var objFSO=new ActiveXObject('Scripting.FileSystemObject'</span>); var objFile = <span>objFSO.</span>CreateTextFile(<span>'test.txt'</span>,true); <span>objFile.</span>Write(<span>'Hello World.');objFile.</span>Close();close();<span>" 

mshta "</span>javascript:var sh=new ActiveXObject( <span>'WScript.Shell'</span> ); <span>sh.</span>Popup( <span>'hello world!'</span>, <span>10</span>, <span>'Title!'</span>, <span>64</span> );close()"
</pre> 
<p class="topic">Example 5, several ways to calculate the free memory of your computer.</p> 
<pre>
mshta "javascript:close(new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1).Write(GetObject('winmgmts:').ExecQuery('Select * from Win32_PerfFormattedData_PerfOS_Memory').ItemIndex(0).AvailableBytes));"|more
for /f "usebackq" %a in (`mshta ^"javascript^:close^(new ActiveXObject^(^'Scripting.FileSystemObject^'^).GetStandardStream^(1^).Write^(GetObject^(^'winmgmts:^'^).ExecQuery^(^'Select * from Win32_PerfFormattedData_PerfOS_Memory^'^).ItemIndex^(0^).AvailableBytes^)^);^"^|more`) do set free_mem=%a

mshta "javascript:close(new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1).Write(GetObject('winmgmts:').ExecQuery('Select * from Win32_PerfFormattedData_PerfOS_Memory').ItemIndex(0).AvailableMBytes));"|for /f %%a in ('more') do set free_mem=%%a
</pre> 
<p class="topic">Example 6, another way to calculate free memory.</p> 
<pre>
<span>@echo</span> off
setlocal
<span>
:: Define</span> simple macros to support <span>JavaScript</span> within batch
set <span>"beginJS=mshta "javascript:</span>close(new <span>ActiveXObject('Scripting.FileSystemObject'.GetStandardStream(1.Write(" set "</span>endJS=));""

:: Direct instantiation requires that output is piped
%beginJS% GetObject('winmgmts:'.ExecQuery('Select * from Win32_PerfFormattedData_PerfOS_Memory'.ItemIndex(0.AvailableBytes%endJS% | findstr "^"

:: FOR /F does not need pipe
for /f %%N in ( '%beginJS% GetObject('winmgmts:'.ExecQuery('Select * from Win32_PerfFormattedData_PerfOS_Memory'.ItemIndex(0.AvailableBytes %endJS%' ) do set free_mem=%%N echo free_mem=%free_mem%
</pre> 
<p class="topic">Example 7, show color pallets dialog.</p> 
<pre>
mshta "about:&lt;script&gt;function b(){new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1).Write(d.ChooseColorDlg().toString(16));close();}&lt;script&gt;&lt;body onload='b()'&gt;&lt;object id='d' classid='clsid:3050f819-98b5-11cf-bb82-00aa00bdce0b'&gt;&lt;/object&gt;&lt;/body&gt;"|more
</pre> 
<p class="topic">Example 8, show screen resolution.</p> 
<pre>
mshta <span>"javascript:res=screen.width+'x'+screen.height;alert(res);close();" 1 | more</span>
</pre> 
<p class="topic">Example 9, use clipboard data.</p> 
<pre>
for /f "usebackq tokens=1,* delims=[]" %i in (<span class="hljs-smartquote">`mshta "javascript:close(new ActiveXObject('</span>Scripting.FileSystemObject').GetStandardStream(1).Write(clipboardData.getData(<span class="hljs-emphasis">'Text'</span>)));"^|find /v /n ""`) do @set "c[%i]=%j"
</pre> 
<p class="topic">Example 10, use javascript setTimeout to delay some time interval to execute a command.</p> 
<pre>
mshta javascript:<span>set</span>Timeout(<span>'close()',10000</span>)
</pre> 
<p class="topic">Example 11, show File Open Select Dialog,</p> you can redirect your output to the command window or to a file or to a variable.
<pre>
mshta "about:&lt;input type=file id=FILE&gt;&lt;script</span>&gt;FILE.click();<span>new</span> ActiveXObject(<span>'Scripting.FileSystemObject'</span>).GetStandardStream(1).WriteLine(FILE.value);close();resizeTo(<span>0,0</span>);&lt;/<span>script&gt;"|more

mshta "about:&lt;input type=file id=FILE&gt;&lt;script</span>&gt;FILE.click();<span>new</span> ActiveXObject(<span>'Scripting.FileSystemObject'</span>).GetStandardStream(1).WriteLine(FILE.value);close();&lt;/<span>script&gt;"&gt;test.txt

mshta "about:&lt;input type=file id=FILE&gt;&lt;script</span>&gt;FILE.click();<span>new</span> ActiveXObject(<span>'Scripting.FileSystemObject'</span>).GetStandardStream(1).WriteLine(FILE.value);close();&lt;/<span>script&gt;"&gt;temp &amp;&amp; set /p a=&lt;temp for</span> /<span>f</span> "<span>delims=" %%i in ('mshta "about:&lt;input type=file id=FILE&gt;&lt;script</span>&gt;FILE.click();<span>new</span> ActiveXObject(<span>'Scripting.FileSystemObject'</span>).GetStandardStream(1).WriteLine(FILE.value);close();&lt;/<span>script&gt;"') do set a=%%i
</pre> 
<p class="topic">Example 12,</p> show Open For Folder Dialog to select a directory, and you can assign it to a variable.
<pre>
for /f "delims=" %%i in ('mshta "javascript:var folder=new ActiveXObject("Shell.Application").BrowseForFolder(0,'选择要处理的文件夹', 0, '').self.path;new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1).WriteLine(folder);close();"') do set input=%%i
</pre> 
<p class="topic">Example 13, execute batch command with parameters which has spaces.</p> 
<pre>
::a.bat
<span class="hljs-decorator">@echo off</span>
set text=Hello World
mshta vbscript:createobject(<span>"WScript.Shell"</span>).Run(<span>"b.bat "</span>+<span>"""%text%""",0</span>)(window.close)
::b.bat
<span class="hljs-decorator">@echo off</span>
mshta <span>"javascript:var sh=new ActiveXObject( 'WScript.Shell' ); sh.Popup( '%~1', 10, 'Title!', 64 ); close()"</span>
</pre> 
<p class="topic">Example 14, ultimate function, run a html file.</p> 
<pre>
<span>&lt;!-- 
:: Batch section @echo off setlocal echo Select an option: for /F "delims=" %%a in ('mshta.exe "%~F0"') do set "HTAreply=%%a" echo End of HTA window, reply: "%HTAreply%" goto :EOF --&gt;</span>

&lt;HTML&gt;
&lt;HEAD&gt;
&lt;HTA:APPLICATION SCROLL="no" SYSMENU="no"</span> &gt;</span>

&lt;TITLE&gt;HTA Radio Buttons<span>&lt;/<span>TITLE&gt;
&lt;SCRIPT language="JavaScript"</span>&gt; window.resizeTo(<span>440,170</span>); <span>var</span> reply = <span>"No button selected"</span>; <span><span>function closeHTA()</span>{ var</span> fso = <span>new</span> ActiveXObject(<span>"Scripting.FileSystemObject"</span>); fso.GetStandardStream(1).WriteLine(reply); window.close(); } &lt;/<span>SCRIPT&gt;
<span>&lt;/<span>HEAD&gt;
&lt;BODY&gt;
&lt;p&gt;Which prize do you prefer?<span>&lt;/<span>p&gt;
&lt;label&gt;&lt;input type="radio" name="prize" onclick="reply=this.value" value="House"&gt;House<span>&lt;/<span>label&gt;
&lt;label&gt;&lt;input type="radio" name="prize" onclick="reply=this.value" value="Money"&gt;$1 million<span>&lt;/<span>label&gt;
&lt;label&gt;&lt;input type="radio" name="prize" onclick="reply=this.value" value="None"&gt;No prize thanks, I'm already happy &lt;b&gt;:)<span>&lt;/<span>b&gt;&lt;/label&gt;
&lt;br&gt;&lt;br&gt;
&lt;button onclick="closeHTA();"&gt;Submit<span>&lt;/<span>button&gt;
<span>&lt;/<span>BODY&gt;
<span>&lt;/<span>HTML&gt;
</pre> 
<br>
<br>
<br>
<br>

<script>
	var toc = $('#toc');
	$('.topic').each(function(i) {
		var topic = $(this), topicNumber = i + 1;
		toc.append('<a href="#topic-'+topicNumber+'" target="_self">'+topic.text()+'</a><br>');
		topic.attr('id', 'topic-' + topicNumber);
	});
</script>

</body>
</html>
