<base target="_blank"><html><head><title>machine Learning</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script src="https://williamkpchan.github.io/lazyload.min.js"></script>
<script src='https://williamkpchan.github.io/mainscript.js'></script>
<script src="https://williamkpchan.github.io/commonfunctions.js"></script>

<script src="https://unpkg.com/brain.js@2.0.0-beta.2/dist/brain-browser.min.js"></script>


<script>
  var showTopicNumber = true;
  var bookid = "machine Learning"
  var markerName = "h2"
</script>
<style>
body{width:80%;margin-left: 10%; font-size:24px;}
h1, h2 {color: gold;}
strong {color: orange;}
img {max-width:90%; display: inline-block; margin-top: 2%;margin-bottom: 1%; border-radius:3px;}
input{width:100;height:100;}
#example {
  padding: 100px; background: #001144; color: white; font-size: 36px;
}
</style>

</head><body onkeypress="chkKey()"><center>
<h1>machine Learning</h1>

</head>
<body>
<a href="https://brain.js.org/#/getting-started" class="whitebut ">brain.js</a>

<input type="color" value="#ff0000"/>
<div id="example">Example Text</div>

<pre>
Example
<a href="https://stackabuse.com/neural-networks-in-javascript-with-brain-js/" class="whitebut ">javascript with brain.js</a>

In this example, I created a NN that can recognize a single handwritten digit (0-9). 
The dataset I'm using is the popular MNIST dataset, which contains over 50,000 samples of handwritten digits. 
This kind of problem is known as Optical Character Recognition (OCR), which is a popular application of NNs.

The recognition works by taking in a 28x28 greyscale image of a handwritten digit, and outputting the digit that the network thinks it "saw". 

This means we'll have 784 inputs (one for each pixel) with values between 0-255, and there will be 10 outputs (one for each digit). 
Each output will have a value of 0-1, essentially acting as the confidence level that that particular digit is the correct answer. (probability)
The highest confidence value is then our answer.

On to the code:


var brain = require('brain');
var fs = require('fs');

var getMnistData = function(content) {
	var lines = content.toString().split('\n');

	var data = [];
	for (var i = 0; i < lines.length; i++) {
		var input = lines[i].split(',').map(Number);

		var output = Array.apply(null, Array(10)).map(Number.prototype.valueOf, 0);
		output[input.shift()] = 1;

		data.push({
			input: input,
			output: output
		});
	}

	return data;
};

fs.readFile(__dirname + '/train.csv', function (err, trainContent) {
	if (err) {
		console.log('Error:', err);
	}

	var trainData = getMnistData(trainContent);

	console.log('Got ' + trainData.length + ' samples');

	var net = new brain.NeuralNetwork({hiddenLayers: [784, 392, 196]});

	net.train(trainData, {
		errorThresh: 0.025,
		log: true,
		logPeriod: 1,
		learningRate: 0.1
	});
});
The train.csv file is just a CSV with one image per line. 
The first value is the digit shown in the image, and the next 784 values are the pixel data.

The number of layers and nodes I chose was a bit arbitrary, and probably unnecessarily high for this OCR application. 
However, when you can't take advantage of things like softmaxes or pooling, you might have better luck upping the number of layers and node count.

Training took easily over an hour to get some decent results. 
While this was expected, I was still a bit disappointed to have to wait so long to test out a new network structure or new learning parameters. 
A simple application like this shouldn't take so long, but that's the price you pay for an all-JavaScript implementation.

To test the network, I loaded another file, test.csv, and used that as a baseline to compare networks. 
That way we get a better idea of performance since we're testing out inputs that the network hasn't already been trained on.

Here is how I tested the network (I'm only showing the relevant parts):

// Require packages...

fs.readFile(__dirname + '/test.csv', function (err, testContent) {
	if (err) {
		console.log('Error:', err);
	}

	// Load training data...

	// Train network...

	// Test it out
	var testData = getMnistData(testContent);

	var numRight = 0;

	console.log('Neural Network tests:');
	for (i = 0; i < testData.length; i++) {
		var resultArr = net.run(testData[i].input);
		var result = resultArr.indexOf(Math.max.apply(Math, resultArr));
		var actual = testData[i].output.indexOf(Math.max.apply(Math, testData[i].output));

		var str = '(' + i + ') GOT: ' + result + ', ACTUAL: ' + actual;
		str += result === actual ? '' : ' -- WRONG!';

		numRight += result === actual ? 1 : 0;

		console.log(str);
	}

	console.log('Got', numRight, 'out of 350, or ' + String(100*(numRight/350)) + '%');
});
Conclusion
While there are some shortcomings, overall I think Brain.js can be very useful and add a lot of value to JavaScript/Node applications. 
Its ease-of-use should allow just about anyone to get started with neural networks.

In case you want something with more flexibility, or you're bothered by the lack of support for Brain.js, take a look at Synaptic, which allows for much more customization in your network architecture. 
It doesn't have quite the popularity/attention that Brain has, but it seems to be the next best choice for neural networks in JavaScript.

</pre>

<script>
const input = document.querySelector("input")
const example = document.querySelector("#example")

const network = new brain.NeuralNetwork()
 network.train([
    { input: { r: 0.62, g: 0.72, b: 0.88 }, output: { light: 1 } },
    { input: { r: 0.1, g: 0.84, b: 0.72 }, output: { light: 1 } },
    { input: { r: 0.33, g: 0.24, b: 0.29 }, output: { dark: 1 } },
    { input: { r: 0.74, g: 0.78, b: 0.86 }, output: { light: 1 } },
    { input: { r: 0.31, g: 0.35, b: 0.41 }, output: { dark: 1 } },
    { input: { r: 1, g: 0.99, b: 0}, output: { light: 1 } },
    { input: { r: 1, g: 0.42, b: 0.52}, output: { dark: 1 } },
    { input: { r: 0.18,g:0.52,b:0.31}, output: { dark: 1 } },
    { input: {r:0.6,g:0.59,b:0.2}, output: { dark: 1 } },
    { input: {r:0.56,g:0.27,b:0.14}, output: { dark: 1 } },

  ])

input.addEventListener("change", (e) => {
  const rgb = getRgb(e.target.value);
  console.log(e.target.value);
  console.log(rgb);
 
  const result = brain.likely(rgb, network)
  console.log(result);
  example.append(JSON.stringify(rgb));
  example.style.background = e.target.value
  example.style.color = result === "dark" ? "white" : "black"
})

function getRgb(hex) {
  var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
  hex = hex.replace(shorthandRegex, function(m, r, g, b) {
      return r + r + g + g + b + b;
  });

  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
      r: Math.round(parseInt(result[1], 16) / 2.55) / 100,
      g: Math.round(parseInt(result[2], 16) / 2.55) / 100,
      b: Math.round(parseInt(result[3], 16) / 2.55) / 100,
  } : null;
}
</script>
</body>
</html>
