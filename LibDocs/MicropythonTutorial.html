<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width"/>
<link rel="stylesheet" href="..\maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, .apply, div.title').click(function(){
    parent.history.back();
    return false;
    });
});
</script>
<style>
body{font-size: x-large;width:80%;margin-left: 10%}
h1, h2 {color: gold;}
</style>
</head><body>
<center><h3>MicroPython tutorial for ESP8266</h3>
<div id="toc"></div></center>
<br>
<br>
<br>

<div class="section" id="micropython-tutorial-for-esp8266">
<span id="tutorial-index"></span>
<h1>MicroPython tutorial for ESP8266</h1>
<p>This tutorial is intended to get you started using MicroPython on the ESP8266
system-on-a-chip.  If it is your first time it is recommended to follow the
tutorial through in the order below.  Otherwise the sections are mostly self
contained, so feel free to skip to those that interest you.</p>
<p>The tutorial does not assume that you know Python, but it also does not attempt
to explain any of the details of the Python language.  Instead it provides you
with commands that are ready to run, and hopes that you will gain a bit of
Python knowledge along the way.  To learn more about Python itself please refer
to <a class="reference external" href="https://www.python.org">https://www.python.org</a>.</p>

<span id="intro"></span>
<h1>1. Getting started with MicroPython on the ESP8266</h1>
<p>Using MicroPython is a great way to get the most of your ESP8266 board.  And
vice versa, the ESP8266 chip is a great platform for using MicroPython.  This
tutorial will guide you through setting up MicroPython, getting a prompt, using
WebREPL, connecting to the network and communicating with the Internet, using
the hardware peripherals, and controlling some external components.</p>
<p>Let&#8217;s get started!</p>
<div class="section" id="requirements">
<h2>1.1. Requirements</h2>
<p>The first thing you need is a board with an ESP8266 chip.  The MicroPython
software supports the ESP8266 chip itself and any board should work.  The main
characteristic of a board is how much flash it has, how the GPIO pins are
connected to the outside world, and whether it includes a built-in USB-serial
convertor to make the UART available to your PC.</p>
<p>The minimum requirement for flash size is 1Mbyte. There is also a special
build for boards with 512KB, but it is highly limited comparing to the
normal build: there is no support for filesystem, and thus features which
depend on it won&#8217;t work (WebREPL, upip, etc.). As such, 512KB build will
be more interesting for users who build from source and fine-tune parameters
for their particular application.</p>
<p>Names of pins will be given in this tutorial using the chip names (eg GPIO0)
and it should be straightforward to find which pin this corresponds to on your
particular board.</p>
</div>
<div class="section" id="powering-the-board">
<h2>1.2. Powering the board</h2>
<p>If your board has a USB connector on it then most likely it is powered through
this when connected to your PC.  Otherwise you will need to power it directly.
Please refer to the documentation for your board for further details.</p>
</div>
<div class="section" id="getting-the-firmware">
<h2>1.3. Getting the firmware</h2>
<p>The first thing you need to do is download the most recent MicroPython firmware
.bin file to load onto your ESP8266 device. You can download it from the
<a class="reference external" href="http://micropython.org/download#esp8266">MicroPython downloads page</a>.
From here, you have 3 main choices</p>
<ul class="simple">
<li>Stable firmware builds for 1024kb modules and above.</li>
<li>Daily firmware builds for 1024kb modules and above.</li>
<li>Daily firmware builds for 512kb modules.</li>
</ul>
<p>If you are just starting with MicroPython, the best bet is to go for the Stable
firmware builds. If you are an advanced, experienced MicroPython ESP8266 user
who would like to follow development closely and help with testing new
features, there are daily builds (note: you actually may need some
development experience, e.g. being ready to follow git history to know
what new changes and features were introduced).</p>
<p>Support for 512kb modules is provided on a feature preview basis. For end
users, it&#8217;s recommended to use modules with flash of 1024kb or more. As
such, only daily builds for 512kb modules are provided.</p>
</div>
<div class="section" id="deploying-the-firmware">
<h2>1.4. Deploying the firmware</h2>
<p>Once you have the MicroPython firmware (compiled code), you need to load it onto
your ESP8266 device.  There are two main steps to do this: first you
need to put your device in boot-loader mode, and second you need to copy across
the firmware.  The exact procedure for these steps is highly dependent on the
particular board and you will need to refer to its documentation for details.</p>
<p>If you have a board that has a USB connector, a USB-serial convertor, and has
the DTR and RTS pins wired in a special way then deploying the firmware should
be easy as all steps can be done automatically.  Boards that have such features
include the Adafruit Feather HUZZAH and NodeMCU boards.</p>
<p>For best results it is recommended to first erase the entire flash of your
device before putting on new MicroPython firmware.</p>
<p>Currently we only support esptool.py to copy across the firmware.  You can find
this tool here: <a class="reference external" href="https://github.com/espressif/esptool/">https://github.com/espressif/esptool/</a>, or install it
using pip:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pip install esptool
</pre></div>
</div>
<p>Versions starting with 1.3 support both Python 2.7 and Python 3.4 (or newer).
An older version (at least 1.2.1 is needed) works fine but will require Python
2.7.</p>
<p>Any other flashing program should work, so feel free to try them out or refer
to the documentation for your board to see its recommendations.</p>
<p>Using esptool.py you can erase the flash with the command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>esptool.py --port /dev/ttyUSB0 erase_flash
</pre></div>
</div>
<p>And then deploy the new firmware using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>esptool.py --port /dev/ttyUSB0 --baud 460800 write_flash --flash_size=detect 0 esp8266-20170108-v1.8.7.bin
</pre></div>
</div>
<p>You might need to change the &#8220;port&#8221; setting to something else relevant for your
PC.  You may also need to reduce the baudrate if you get errors when flashing
(eg down to 115200).  The filename of the firmware should also match the file
that you have.</p>
<p>For some boards with a particular FlashROM configuration (e.g. some variants of
a NodeMCU board) you may need to use the following command to deploy
the firmware (note the <code class="docutils literal"><span class="pre">-fm</span> <span class="pre">dio</span></code> option):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>esptool.py --port /dev/ttyUSB0 --baud 460800 write_flash --flash_size=detect -fm dio 0 esp8266-20170108-v1.8.7.bin
</pre></div>
</div>
<p>If the above commands run without error then MicroPython should be installed on
your board!</p>
</div>
<div class="section" id="serial-prompt">
<h2>1.5. Serial prompt</h2>
<p>Once you have the firmware on the device you can access the REPL (Python prompt)
over UART0 (GPIO1=TX, GPIO3=RX), which might be connected to a USB-serial
convertor, depending on your board.  The baudrate is 115200.  The next part of
the tutorial will discuss the prompt in more detail.</p>
</div>
<div class="section" id="wifi">
<h2>1.6. WiFi</h2>
<p>After a fresh install and boot the device configures itself as a WiFi access
point (AP) that you can connect to.  The ESSID is of the form MicroPython-xxxxxx
where the x&#8217;s are replaced with part of the MAC address of your device (so will
be the same everytime, and most likely different for all ESP8266 chips).  The
password for the WiFi is micropythoN (note the upper-case N).  Its IP address
will be 192.168.4.1 once you connect to its network.  WiFi configuration will
be discussed in more detail later in the tutorial.</p>
</div>
<div class="section" id="troubleshooting-installation-problems">
<h2>1.7. Troubleshooting installation problems</h2>
<p>If you experience problems during flashing or with running firmware immediately
after it, here are troubleshooting recommendations:</p>
<ul>
<li><p class="first">Be aware of and try to exclude hardware problems. There are 2 common problems:
bad power source quality and worn-out/defective FlashROM. Speaking of power
source, not just raw amperage is important, but also low ripple and noise/EMI
in general. If you experience issues with self-made or wall-wart style power
supply, try USB power from a computer. Unearthed power supplies are also known
to cause problems as they source of increased EMI (electromagnetic interference)
- at the very least, and may lead to electrical devices breakdown. So, you are
advised to avoid using unearthed power connections when working with ESP8266
and other boards. In regard to FlashROM hardware problems, there are independent
(not related to MicroPython in any way) reports
<a class="reference external" href="http://internetofhomethings.com/homethings/?p=538">(e.g.)</a>
that on some ESP8266 modules, FlashROM can be programmed as little as 20 times
before programming errors occur. This is <em>much</em> less than 100,000 programming
cycles cited for FlashROM chips of a type used with ESP8266 by reputable
vendors, which points to either production rejects, or second-hand worn-out
flash chips to be used on some (apparently cheap) modules/boards. You may want
to use your best judgement about source, price, documentation, warranty,
post-sales support for the modules/boards you purchase.</p>
</li>
<li><p class="first">The flashing instructions above use flashing speed of 460800 baud, which is
good compromise between speed and stability. However, depending on your
module/board, USB-UART convertor, cables, host OS, etc., the above baud
rate may be too high and lead to errors. Try a more common 115200 baud
rate instead in such cases.</p>
</li>
<li><p class="first">If lower baud rate didn&#8217;t help, you may want to try older version of
esptool.py, which had a different programming algorithm:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pip install esptool==1.0.1
</pre></div>
</div>
<p>This version doesn&#8217;t support <code class="docutils literal"><span class="pre">--flash_size=detect</span></code> option, so you will
need to specify FlashROM size explicitly (in megabits). It also requires
Python 2.7, so you may need to use <code class="docutils literal"><span class="pre">pip2</span></code> instead of <code class="docutils literal"><span class="pre">pip</span></code> in the
command above.</p>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">--flash_size</span></code> option in the commands above is mandatory. Omitting
it will lead to a corrupted firmware.</p>
</li>
<li><p class="first">To catch incorrect flash content (e.g. from a defective sector on a chip),
add <code class="docutils literal"><span class="pre">--verify</span></code> switch to the commands above.</p>
</li>
<li><p class="first">Additionally, you can check the firmware integrity from a MicroPython REPL
prompt (assuming you were able to flash it and <code class="docutils literal"><span class="pre">--verify</span></code> option doesn&#8217;t
report errors):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">esp</span>
<span class="n">esp</span><span class="o">.</span><span class="n">check_fw</span><span class="p">()</span>
</pre></div>
</div>
<p>If the last output value is True, the firmware is OK. Otherwise, it&#8217;s
corrupted and need to be reflashed correctly.</p>
</li>
<li><p class="first">If you experience any issues with another flashing application (not
esptool.py), try esptool.py, it is a generally accepted flashing
application in the ESP8266 community.</p>
</li>
<li><p class="first">If you still experience problems with even flashing the firmware, please
refer to esptool.py project page, <a class="reference external" href="https://github.com/espressif/esptool">https://github.com/espressif/esptool</a>
for additional documentation and bug tracker where you can report problems.</p>
</li>
<li><p class="first">If you are able to flash firmware, but <code class="docutils literal"><span class="pre">--verify</span></code> option or
<code class="docutils literal"><span class="pre">esp.check_fw()</span></code> return errors even after multiple retries, you
may have a defective FlashROM chip, as explained above.</p>
</li>
</ul>

<div class="section" id="getting-a-micropython-repl-prompt">

<h1>2. Getting a MicroPython REPL prompt</h1>
<p>REPL stands for Read Evaluate Print Loop, and is the name given to the
interactive MicroPython prompt that you can access on the ESP8266.  Using the
REPL is by far the easiest way to test out your code and run commands.</p>
<p>There are two ways to access the REPL: either via a wired connection through the
UART serial port, or via WiFi.</p>
<div class="section" id="repl-over-the-serial-port">
<h2>2.1. REPL over the serial port</h2>
<p>The REPL is always available on the UART0 serial peripheral, which is connected
to the pins GPIO1 for TX and GPIO3 for RX.  The baudrate of the REPL is 115200.
If your board has a USB-serial convertor on it then you should be able to access
the REPL directly from your PC.  Otherwise you will need to have a way of
communicating with the UART.</p>
<p>To access the prompt over USB-serial you need to use a terminal emulator program.
On Windows TeraTerm is a good choice, on Mac you can use the built-in screen
program, and Linux has picocom and minicom.  Of course, there are many other
terminal programs that will work, so pick your favourite!</p>
<p>For example, on Linux you can try running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">picocom</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyUSB0</span> <span class="o">-</span><span class="n">b115200</span>
</pre></div>
</div>
<p>Once you have made the connection over the serial port you can test if it is
working by hitting enter a few times.  You should see the Python REPL prompt,
indicated by <code class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></code>.</p>
</div>
<div class="section" id="webrepl-a-prompt-over-wifi">
<h2>2.2. WebREPL - a prompt over WiFi</h2>
<p>WebREPL allows you to use the Python prompt over WiFi, connecting through a
browser. The latest versions of Firefox and Chrome are supported.</p>
<p>For your convenience, WebREPL client is hosted at
<a class="reference external" href="http://micropython.org/webrepl">http://micropython.org/webrepl</a> . Alternatively, you can install it
locally from the the GitHub repository
<a class="reference external" href="https://github.com/micropython/webrepl">https://github.com/micropython/webrepl</a> .</p>
<p>Before connecting to WebREPL, you should set a password and enable it via
a normal serial connection. Initial versions of MicroPython for ESP8266
came with WebREPL automatically enabled on the boot and with the
ability to set a password via WiFi on the first connection, but as WebREPL
was becoming more widely known and popular, the initial setup has switched
to a wired connection for improved security:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">webrepl_setup</span>
</pre></div>
</div>
<p>Follow the on-screen instructions and prompts. To make any changes active,
you will need to reboot your device.</p>
<p>To use WebREPL connect your computer to the ESP8266&#8217;s access point
(MicroPython-xxxxxx, see the previous section about this).  If you have
already reconfigured your ESP8266 to connect to a router then you can
skip this part.</p>
<p>Once you are on the same network as the ESP8266 you click the &#8220;Connect&#8221; button
(if you are connecting via a router then you may need to change the IP address,
by default the IP address is correct when connected to the ESP8266&#8217;s access
point).  If the connection succeeds then you should see a password prompt.</p>
<p>Once you type the password configured at the setup step above, press Enter once
more and you should get a prompt looking like <code class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></code>.  You can now start
typing Python commands!</p>
</div>
<div class="section" id="using-the-repl">
<h2>2.3. Using the REPL</h2>
<p>Once you have a prompt you can start experimenting!  Anything you type at the
prompt will be executed after you press the Enter key.  MicroPython will run
the code that you enter and print the result (if there is one).  If there is an
error with the text that you enter then an error message is printed.</p>
<p>Try typing the following at the prompt:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;hello esp8266!&#39;</span><span class="p">)</span>
<span class="go">hello esp8266!</span>
</pre></div>
</div>
<p>Note that you shouldn&#8217;t type the <code class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></code> arrows, they are there to indicate that
you should type the text after it at the prompt.  And then the line following is
what the device should respond with.  In the end, once you have entered the text
<code class="docutils literal"><span class="pre">print(&quot;hello</span> <span class="pre">esp8266!&quot;)</span></code> and pressed the Enter key, the output on your screen
should look exactly like it does above.</p>
<p>If you already know some python you can now try some basic commands here.   For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>
<span class="go">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">12</span><span class="o">**</span><span class="mi">34</span>
<span class="go">4922235242952026704037113243122008064</span>
</pre></div>
</div>
<p>If your board has an LED attached to GPIO2 (the ESP-12 modules do) then you can
turn it on and off using the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">machine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">on</span></code> method of a Pin might turn the LED off and <code class="docutils literal"><span class="pre">off</span></code> might
turn it on (or vice versa), depending on how the LED is wired on your board.
To resolve this, machine.Signal class is provided.</p>
<div class="section" id="line-editing">
<h3>2.3.1. Line editing</h3>
<p>You can edit the current line that you are entering using the left and right
arrow keys to move the cursor, as well as the delete and backspace keys.  Also,
pressing Home or ctrl-A moves the cursor to the start of the line, and pressing
End or ctrl-E moves to the end of the line.</p>
</div>
<div class="section" id="input-history">
<h3>2.3.2. Input history</h3>
<p>The REPL remembers a certain number of previous lines of text that you entered
(up to 8 on the ESP8266).  To recall previous lines use the up and down arrow
keys.</p>
</div>
<div class="section" id="tab-completion">
<h3>2.3.3. Tab completion</h3>
<p>Pressing the Tab key will do an auto-completion of the current word that you are
entering.  This can be very useful to find out functions and methods that a
module or object has.  Try it out by typing &#8220;ma&#8221; and then pressing Tab.  It
should complete to &#8220;machine&#8221; (assuming you imported machine in the above
example).  Then type &#8221;.&#8221; and press Tab again to see a list of all the functions
that the machine module has.</p>
</div>
<div class="section" id="line-continuation-and-auto-indent">
<h3>2.3.4. Line continuation and auto-indent</h3>
<p>Certain things that you type will need &#8220;continuing&#8221;, that is, will need more
lines of text to make a proper Python statement.  In this case the prompt will
change to <code class="docutils literal"><span class="pre">...</span></code> and the cursor will auto-indent the correct amount so you can
start typing the next line straight away.  Try this by defining the following
function:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">toggle</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>In the above, you needed to press the Enter key three times in a row to finish
the compound statement (that&#8217;s the three lines with just dots on them).  The
other way to finish a compound statement is to press backspace to get to the
start of the line, then press the Enter key.  (If you did something wrong and
want to escape the continuation mode then press ctrl-C; all lines will be
ignored.)</p>
<p>The function you just defined allows you to toggle a pin.  The pin object you
created earlier should still exist (recreate it if it doesn&#8217;t) and you can
toggle the LED using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">toggle</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
</pre></div>
</div>
<p>Let&#8217;s now toggle the LED in a loop (if you don&#8217;t have an LED then you can just
print some text instead of calling toggle, to see the effect):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">toggle</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>This will toggle the LED at 1Hz (half a second on, half a second off).  To stop
the toggling press ctrl-C, which will raise a KeyboardInterrupt exception and
break out of the loop.</p>
<p>The time module provides some useful functions for making delays and doing
timing.  Use tab completion to find out what they are and play around with them!</p>
</div>
<div class="section" id="paste-mode">
<h3>2.3.5. Paste mode</h3>
<p>Pressing ctrl-E will enter a special paste mode.  This allows you to copy and
paste a chunk of text into the REPL.  If you press ctrl-E you will see the
paste-mode prompt:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>paste mode; Ctrl-C to cancel, Ctrl-D to finish
===
</pre></div>
</div>
<p>You can then paste (or type) your text in.  Note that none of the special keys
or commands work in paste mode (eg Tab or backspace), they are just accepted
as-is.  Press ctrl-D to finish entering the text and execute it.</p>
</div>
<div class="section" id="other-control-commands">
<h3>2.3.6. Other control commands</h3>
<p>There are four other control commands:</p>
<ul class="simple">
<li>Ctrl-A on a blank line will enter raw REPL mode.  This is like a permanent
paste mode, except that characters are not echoed back.</li>
<li>Ctrl-B on a blank like goes to normal REPL mode.</li>
<li>Ctrl-C cancels any input, or interrupts the currently running code.</li>
<li>Ctrl-D on a blank line will do a soft reset.</li>
</ul>
<p>Note that ctrl-A and ctrl-D do not work with WebREPL.</p>
</div>

<div class="section" id="the-internal-filesystem">

<h1>3. The internal filesystem</h1>
<p>If your devices has 1Mbyte or more of storage then it will be set up (upon first
boot) to contain a filesystem.  This filesystem uses the FAT format and is
stored in the flash after the MicroPython firmware.</p>
<div class="section" id="creating-and-reading-files">
<h2>3.1. Creating and reading files</h2>
<p>MicroPython on the ESP8266 supports the standard way of accessing files in
Python, using the built-in <code class="docutils literal"><span class="pre">open()</span></code> function.</p>
<p>To create a file try:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;some data&#39;</span><span class="p">)</span>
<span class="go">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The &#8220;9&#8221; is the number of bytes that were written with the <code class="docutils literal"><span class="pre">write()</span></code> method.
Then you can read back the contents of this new file using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;some data&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that the default mode when opening a file is to open it in read-only mode,
and as a text file.  Specify <code class="docutils literal"><span class="pre">'wb'</span></code> as the second argument to <code class="docutils literal"><span class="pre">open()</span></code> to
open for writing in binary mode, and <code class="docutils literal"><span class="pre">'rb'</span></code> to open for reading in binary
mode.</p>
</div>
<div class="section" id="listing-file-and-more">
<h2>3.2. Listing file and more</h2>
<p>The os module can be used for further control over the filesystem.  First
import the module:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
<p>Then try listing the contents of the filesystem:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
<span class="go">[&#39;boot.py&#39;, &#39;port_config.py&#39;, &#39;data.txt&#39;]</span>
</pre></div>
</div>
<p>You can make directories:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;dir&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And remove entries:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;data.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="start-up-scripts">
<h2>3.3. Start up scripts</h2>
<p>There are two files that are treated specially by the ESP8266 when it starts up:
boot.py and main.py.  The boot.py script is executed first (if it exists) and
then once it completes the main.py script is executed.  You can create these
files yourself and populate them with the code that you want to run when the
device starts up.</p>
</div>
<div class="section" id="accessing-the-filesystem-via-webrepl">
<h2>3.4. Accessing the filesystem via WebREPL</h2>
<p>You can access the filesystem over WebREPL using the web client in a browser
or via the command-line tool. Please refer to Quick Reference and Tutorial
sections for more information about WebREPL.</p>

<div class="section" id="network-basics">

<h1>4. Network basics</h1>
<p>The network module is used to configure the WiFi connection.  There are two WiFi
interfaces, one for the station (when the ESP8266 connects to a router) and one
for the access point (for other devices to connect to the ESP8266).  Create
instances of these objects using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">network</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sta_if</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ap_if</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">AP_IF</span><span class="p">)</span>
</pre></div>
</div>
<p>You can check if the interfaces are active by:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sta_if</span><span class="o">.</span><span class="n">active</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ap_if</span><span class="o">.</span><span class="n">active</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>You can also check the network settings of the interface by:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ap_if</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">()</span>
<span class="go">(&#39;192.168.4.1&#39;, &#39;255.255.255.0&#39;, &#39;192.168.4.1&#39;, &#39;8.8.8.8&#39;)</span>
</pre></div>
</div>
<p>The returned values are: IP address, netmask, gateway, DNS.</p>
<div class="section" id="configuration-of-the-wifi">
<h2>4.1. Configuration of the WiFi</h2>
<p>Upon a fresh install the ESP8266 is configured in access point mode, so the
AP_IF interface is active and the STA_IF interface is inactive.  You can
configure the module to connect to your own network using the STA_IF interface.</p>
<p>First activate the station interface:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sta_if</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Then connect to your WiFi network:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sta_if</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;&lt;your ESSID&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;your password&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To check if the connection is established use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sta_if</span><span class="o">.</span><span class="n">isconnected</span><span class="p">()</span>
</pre></div>
</div>
<p>Once established you can check the IP address:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sta_if</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">()</span>
<span class="go">(&#39;192.168.0.2&#39;, &#39;255.255.255.0&#39;, &#39;192.168.0.1&#39;, &#39;8.8.8.8&#39;)</span>
</pre></div>
</div>
<p>You can then disable the access-point interface if you no longer need it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ap_if</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is a function you can run (or put in your boot.py file) to automatically
connect to your WiFi network:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_connect</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">network</span>
    <span class="n">sta_if</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sta_if</span><span class="o">.</span><span class="n">isconnected</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;connecting to network...&#39;</span><span class="p">)</span>
        <span class="n">sta_if</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sta_if</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;&lt;essid&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;password&gt;&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">sta_if</span><span class="o">.</span><span class="n">isconnected</span><span class="p">():</span>
            <span class="k">pass</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;network config:&#39;</span><span class="p">,</span> <span class="n">sta_if</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="sockets">
<h2>4.2. Sockets</h2>
<p>Once the WiFi is set up the way to access the network is by using sockets.
A socket represents an endpoint on a network device, and when two sockets are
connected together communication can proceed.
Internet protocols are built on top of sockets, such as email (SMTP), the web
(HTTP), telnet, ssh, among many others.  Each of these protocols is assigned
a specific port, which is just an integer.  Given an IP address and a port
number you can connect to a remote device and start talking with it.</p>
<p>The next part of the tutorial discusses how to use sockets to do some common
and useful network tasks.</p>

<div class="section" id="network-tcp-sockets">

<h1>5. Network - TCP sockets</h1>
<p>The building block of most of the internet is the TCP socket.  These sockets
provide a reliable stream of bytes between the connected network devices.
This part of the tutorial will show how to use TCP sockets in a few different
cases.</p>
<div class="section" id="star-wars-asciimation">
<h2>5.1. Star Wars Asciimation</h2>
<p>The simplest thing to do is to download data from the internet.  In this case
we will use the Star Wars Asciimation service provided by the blinkenlights.nl
website.  It uses the telnet protocol on port 23 to stream data to anyone that
connects.  It&#8217;s very simple to use because it doesn&#8217;t require you to
authenticate (give a username or password), you can just start downloading data
straight away.</p>
<p>The first thing to do is make sure we have the socket module available:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">socket</span>
</pre></div>
</div>
<p>Then get the IP address of the server:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">addr_info</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s2">&quot;towel.blinkenlights.nl&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">getaddrinfo</span></code> function actually returns a list of addresses, and each
address has more information than we need.  We want to get just the first valid
address, and then just the IP address and port of the server.  To do this use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">addr</span> <span class="o">=</span> <span class="n">addr_info</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>If you type <code class="docutils literal"><span class="pre">addr_info</span></code> and <code class="docutils literal"><span class="pre">addr</span></code> at the prompt you will see exactly what
information they hold.</p>
<p>Using the IP address we can make a socket and connect to the server:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we are connected we can download and display the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>When this loop executes it should start showing the animation (use ctrl-C to
interrupt it).</p>
<p>You should also be able to run this same code on your PC using normal Python if
you want to try it out there.</p>
</div>
<div class="section" id="http-get-request">
<h2>5.2. HTTP GET request</h2>
<p>The next example shows how to download a webpage.  HTTP uses port 80 and you
first need to send a &#8220;GET&#8221; request before you can download anything.  As part
of the request you need to specify the page to retrieve.</p>
<p>Let&#8217;s define a function that can download and print a URL:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">http_get</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="mi">80</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s1">&#39;GET /</span><span class="si">%s</span><span class="s1"> HTTP/1.0</span><span class="se">\r\n</span><span class="s1">Host: </span><span class="si">%s</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">host</span><span class="p">),</span> <span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Make sure that you import the socket module before running this function.  Then
you can try:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">http_get</span><span class="p">(</span><span class="s1">&#39;http://micropython.org/ks/test.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This should retrieve the webpage and print the HTML to the console.</p>
</div>
<div class="section" id="simple-http-server">
<h2>5.3. Simple HTTP server</h2>
<p>The following code creates an simple HTTP server which serves a single webpage
that contains a table with the state of all the GPIO pins:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">machine</span>
<span class="n">pins</span> <span class="o">=</span> <span class="p">[</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">)]</span>

<span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">    &lt;head&gt; &lt;title&gt;ESP8266 Pins&lt;/title&gt; &lt;/head&gt;</span>
<span class="s2">    &lt;body&gt; &lt;h1&gt;ESP8266 Pins&lt;/h1&gt;</span>
<span class="s2">        &lt;table border=&quot;1&quot;&gt; &lt;tr&gt;&lt;th&gt;Pin&lt;/th&gt;&lt;th&gt;Value&lt;/th&gt;&lt;/tr&gt; </span><span class="si">%s</span><span class="s2"> &lt;/table&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">addr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;listening on&#39;</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">cl</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;client connected from&#39;</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
    <span class="n">cl_file</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">makefile</span><span class="p">(</span><span class="s1">&#39;rwb&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">cl_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">line</span> <span class="o">==</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;tr&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s1">&lt;/td&gt;&lt;td&gt;</span><span class="si">%d</span><span class="s1">&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pins</span><span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">html</span> <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>

<div class="section" id="gpio-pins">

<h1>6. GPIO Pins</h1>
<p>The way to connect your board to the external world, and control other
components, is through the GPIO pins.  Not all pins are available to use,
in most cases only pins 0, 2, 4, 5, 12, 13, 14, 15, and 16 can be used.</p>
<p>The pins are available in the machine module, so make sure you import that
first.  Then you can create a pin using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the &#8220;0&#8221; is the pin that you want to access.  Usually you want to
configure the pin to be input or output, and you do this when constructing
it.  To make an input pin use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="o">.</span><span class="n">PULL_UP</span><span class="p">)</span>
</pre></div>
</div>
<p>You can either use PULL_UP or None for the input pull-mode.  If it&#8217;s
not specified then it defaults to None, which is no pull resistor.
You can read the value on the pin using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
<span class="go">0</span>
</pre></div>
</div>
<p>The pin on your board may return 0 or 1 here, depending on what it&#8217;s connected
to.  To make an output pin use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
</pre></div>
</div>
<p>Then set its value using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pin</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="external-interrupts">
<h2>6.1. External interrupts</h2>
<p>All pins except number 16 can be configured to trigger a hard interrupt if their
input changes.  You can set code (a callback function) to be executed on the
trigger.</p>
<p>Let&#8217;s first define a callback function, which must take a single argument,
being the pin that triggered the function.  We will make the function just print
the pin:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;pin change&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Next we will create two pins and configure them as inputs:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">Pin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p0</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>
</pre></div>
</div>
<p>An finally we need to tell the pins when to trigger, and the function to call
when they detect an event:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p0</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IRQ_FALLING</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IRQ_RISING</span> <span class="o">|</span> <span class="n">Pin</span><span class="o">.</span><span class="n">IRQ_FALLING</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
</div>
<p>We set pin 0 to trigger only on a falling edge of the input (when it goes from
high to low), and set pin 2 to trigger on both a rising and falling edge.  After
entering this code you can apply high and low voltages to pins 0 and 2 to see
the interrupt being executed.</p>
<p>A hard interrupt will trigger as soon as the event occurs and will interrupt any
running code, including Python code.  As such your callback functions are
limited in what they can do (they cannot allocate memory, for example) and
should be as short and simple as possible.</p>

<div class="section" id="pulse-width-modulation">

<h1>7. Pulse Width Modulation</h1>
<p>Pulse width modulation (PWM) is a way to get an artificial analog output on a
digital pin.  It achieves this by rapidly toggling the pin from low to high.
There are two parameters associated with this: the frequency of the toggling,
and the duty cycle.  The duty cycle is defined to be how long the pin is high
compared with the length of a single period (low plus high time).  Maximum
duty cycle is when the pin is high all of the time, and minimum is when it is
low all of the time.</p>
<p>On the ESP8266 the pins 0, 2, 4, 5, 12, 13, 14 and 15 all support PWM.  The
limitation is that they must all be at the same frequency, and the frequency
must be between 1Hz and 1kHz.</p>
<p>To use PWM on a pin you must first create the pin object, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">machine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p12</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>Then create the PWM object using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pwm12</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="n">p12</span><span class="p">)</span>
</pre></div>
</div>
<p>You can set the frequency and duty cycle using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pwm12</span><span class="o">.</span><span class="n">freq</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pwm12</span><span class="o">.</span><span class="n">duty</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the duty cycle is between 0 (all off) and 1023 (all on), with 512
being a 50% duty.  If you print the PWM object then it will tell you its current
configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pwm12</span>
<span class="go">PWM(12, freq=500, duty=512)</span>
</pre></div>
</div>
<p>You can also call the <code class="docutils literal"><span class="pre">freq()</span></code> and <code class="docutils literal"><span class="pre">duty()</span></code> methods with no arguments to
get their current values.</p>
<p>The pin will continue to be in PWM mode until you deinitialise it using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pwm12</span><span class="o">.</span><span class="n">deinit</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="fading-an-led">
<h2>7.1. Fading an LED</h2>
<p>Let&#8217;s use the PWM feature to fade an LED.  Assuming your board has an LED
connected to pin 2 (ESP-12 modules do) we can create an LED-PWM object using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">led</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that we can set the frequency in the PWM constructor.</p>
<p>For the next part we will use timing and some math, so import these modules:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">math</span>
</pre></div>
</div>
<p>Then create a function to pulse the LED:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">pulse</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">l</span><span class="o">.</span><span class="n">duty</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="mi">500</span> <span class="o">+</span> <span class="mi">500</span><span class="p">))</span>
<span class="gp">... </span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>You can try this function out using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pulse</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>For a nice effect you can pulse many times in a row:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">pulse</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>Remember you can use ctrl-C to interrupt the code.</p>
</div>
<div class="section" id="control-a-hobby-servo">
<h2>7.2. Control a hobby servo</h2>
<p>Hobby servo motors can be controlled using PWM.  They require a frequency of
50Hz and then a duty between about 40 and 115, with 77 being the centre value.
If you connect a servo to the power and ground pins, and then the signal line
to pin 12 (other pins will work just as well), you can control the motor using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">servo</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servo</span><span class="o">.</span><span class="n">duty</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servo</span><span class="o">.</span><span class="n">duty</span><span class="p">(</span><span class="mi">115</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servo</span><span class="o">.</span><span class="n">duty</span><span class="p">(</span><span class="mi">77</span><span class="p">)</span>
</pre></div>
</div>

<div class="section" id="analog-to-digital-conversion">

<h1>8. Analog to Digital Conversion</h1>
<p>The ESP8266 has a single pin (separate to the GPIO pins) which can be used to
read analog voltages and convert them to a digital value.  You can construct
such an ADC pin object using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">machine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adc</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Then read its value with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">adc</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">58</span>
</pre></div>
</div>
<p>The values returned from the <code class="docutils literal"><span class="pre">read()</span></code> function are between 0 (for 0.0 volts)
and 1024 (for 1.0 volts).  Please note that this input can only tolerate a
maximum of 1.0 volts and you must use a voltage divider circuit to measure
larger voltages.</p>
</div>
  <div class="section" id="power-control">

<h1>9. Power control</h1>
<p>The ESP8266 provides the ability to change the CPU frequency on the fly, and
enter a deep-sleep state.  Both can be used to manage power consumption.</p>
<div class="section" id="changing-the-cpu-frequency">
<h2>9.1. Changing the CPU frequency</h2>
<p>The machine module has a function to get and set the CPU frequency.  To get the
current frequency use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">machine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">machine</span><span class="o">.</span><span class="n">freq</span><span class="p">()</span>
<span class="go">80000000</span>
</pre></div>
</div>
<p>By default the CPU runs at 80MHz.  It can be change to 160MHz if you need more
processing power, at the expense of current consumption:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">machine</span><span class="o">.</span><span class="n">freq</span><span class="p">(</span><span class="mi">160000000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">machine</span><span class="o">.</span><span class="n">freq</span><span class="p">()</span>
<span class="go">160000000</span>
</pre></div>
</div>
<p>You can change to the higher frequency just while your code does the heavy
processing and then change back when it&#8217;s finished.</p>
</div>
<div class="section" id="deep-sleep-mode">
<h2>9.2. Deep-sleep mode</h2>
<p>The deep-sleep mode will shut down the ESP8266 and all its peripherals,
including the WiFi (but not including the real-time-clock, which is used to wake
the chip).  This drastically reduces current consumption and is a good way to
make devices that can run for a while on a battery.</p>
<p>To be able to use the deep-sleep feature you must connect GPIO16 to the reset
pin (RST on the Adafruit Feather HUZZAH board).  Then the following code can be
used to sleep and wake the device:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">machine</span>

<span class="c1"># configure RTC.ALARM0 to be able to wake the device</span>
<span class="n">rtc</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span>
<span class="n">rtc</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="n">rtc</span><span class="o">.</span><span class="n">ALARM0</span><span class="p">,</span> <span class="n">wake</span><span class="o">=</span><span class="n">machine</span><span class="o">.</span><span class="n">DEEPSLEEP</span><span class="p">)</span>

<span class="c1"># set RTC.ALARM0 to fire after 10 seconds (waking the device)</span>
<span class="n">rtc</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">rtc</span><span class="o">.</span><span class="n">ALARM0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="c1"># put the device to sleep</span>
<span class="n">machine</span><span class="o">.</span><span class="n">deepsleep</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that when the chip wakes from a deep-sleep it is completely reset,
including all of the memory.  The boot scripts will run as usual and you can
put code in them to check the reset cause to perhaps do something different if
the device just woke from a deep-sleep.  For example, to print the reset cause
you can use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">machine</span><span class="o">.</span><span class="n">reset_cause</span><span class="p">()</span> <span class="o">==</span> <span class="n">machine</span><span class="o">.</span><span class="n">DEEPSLEEP_RESET</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;woke from a deep sleep&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;power on or hard reset&#39;</span><span class="p">)</span>
</pre></div>
</div>

<div class="section" id="controlling-1-wire-devices">

<h1>10. Controlling 1-wire devices</h1>
<p>The 1-wire bus is a serial bus that uses just a single wire for communication
(in addition to wires for ground and power).  The DS18B20 temperature sensor
is a very popular 1-wire device, and here we show how to use the onewire module
to read from such a device.</p>
<p>For the following code to work you need to have at least one DS18S20 or DS18B20 temperature
sensor with its data line connected to GPIO12.  You must also power the sensors
and connect a 4.7k Ohm resistor between the data pin and the power pin.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">machine</span>
<span class="kn">import</span> <span class="nn">onewire</span><span class="o">,</span> <span class="nn">ds18x20</span>

<span class="c1"># the device is on GPIO12</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># create the onewire object</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">ds18x20</span><span class="o">.</span><span class="n">DS18X20</span><span class="p">(</span><span class="n">onewire</span><span class="o">.</span><span class="n">OneWire</span><span class="p">(</span><span class="n">dat</span><span class="p">))</span>

<span class="c1"># scan for devices on the bus</span>
<span class="n">roms</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;found devices:&#39;</span><span class="p">,</span> <span class="n">roms</span><span class="p">)</span>

<span class="c1"># loop 10 times and print all temperatures</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;temperatures:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">convert_temp</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">750</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rom</span> <span class="ow">in</span> <span class="n">roms</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">read_temp</span><span class="p">(</span><span class="n">rom</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that you must execute the <code class="docutils literal"><span class="pre">convert_temp()</span></code> function to initiate a
temperature reading, then wait at least 750ms before reading the value.</p>
</div>
  <div class="section" id="controlling-neopixels">

<h1>11. Controlling NeoPixels</h1>
<p>NeoPixels, also known as WS2812 LEDs, are full-colour LEDs that are connected in
serial, are individually addressable, and can have their red, green and blue
components set between 0 and 255.  They require precise timing to control them
and there is a special neopixel module to do just this.</p>
<p>To create a NeoPixel object do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">machine</span><span class="o">,</span> <span class="nn">neopixel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span> <span class="o">=</span> <span class="n">neopixel</span><span class="o">.</span><span class="n">NeoPixel</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>This configures a NeoPixel strip on GPIO4 with 8 pixels.  You can adjust the
&#8220;4&#8221; (pin number) and the &#8220;8&#8221; (number of pixel) to suit your set up.</p>
<p>To set the colour of pixels use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># set to red, full brightness</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># set to green, half brightness</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>  <span class="c1"># set to blue, quarter brightness</span>
</pre></div>
</div>
<p>Then use the <code class="docutils literal"><span class="pre">write()</span></code> method to output the colours to the LEDs:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
<p>The following demo function makes a fancy show on the LEDs:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">demo</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">n</span>

    <span class="c1"># cycle</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">np</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">np</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

    <span class="c1"># bounce</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">np</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">//</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">np</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">np</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

    <span class="c1"># fade in/out</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">//</span> <span class="mi">256</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span>
            <span class="n">np</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

    <span class="c1"># clear</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">np</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
<p>Execute it using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">demo</span><span class="p">(</span><span class="n">np</span><span class="p">)</span>
</pre></div>

<div class="section" id="temperature-and-humidity">

<h1>12. Temperature and Humidity</h1>
<p>DHT (Digital Humidity &amp; Temperature) sensors are low cost digital sensors with
capacitive humidity sensors and thermistors to measure the surrounding air.
They feature a chip that handles analog to digital conversion and provide a
1-wire interface. Newer sensors additionally provide an I2C interface.</p>
<p>The DHT11 (blue) and DHT22 (white) sensors provide the same 1-wire interface,
however, the DHT22 requires a separate object as it has more complex
calculation. DHT22 have 1 decimal place resolution for both humidity and
temperature readings. DHT11 have whole number for both.</p>
<p>A custom 1-wire protocol, which is different to Dallas 1-wire, is used to get
the measurements from the sensor. The payload consists of a humidity value,
a temperature value and a checksum.</p>
<p>To use the 1-wire interface, construct the objects referring to their data pin:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dht</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">machine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">dht</span><span class="o">.</span><span class="n">DHT11</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dht</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">machine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">dht</span><span class="o">.</span><span class="n">DHT22</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>Then measure and read their values with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">temperature</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">humidity</span><span class="p">()</span>
</pre></div>
</div>
<p>Values returned from <code class="docutils literal"><span class="pre">temperature()</span></code> are in degrees Celsius and values
returned from <code class="docutils literal"><span class="pre">humidity()</span></code> are a percentage of relative humidity.</p>
<p>The DHT11 can be called no more than once per second and the DHT22 once every
two seconds for most accurate results. Sensor accuracy will degrade over time.
Each sensor supports a different operating range. Refer to the product
datasheets for specifics.</p>
<p>In 1-wire mode, only three of the four pins are used and in I2C mode, all four
pins are used. Older sensors may still have 4 pins even though they do not
support I2C. The 3rd pin is simply not connected.</p>
<p>Pin configurations:</p>
<p>Sensor without I2C in 1-wire mode (eg. DHT11, DHT22, AM2301, AM2302):</p>
<blockquote>
<div>1=VDD, 2=Data, 3=NC, 4=GND</div></blockquote>
<p>Sensor with I2C in 1-wire mode (eg. DHT12, AM2320, AM2321, AM2322):</p>
<blockquote>
<div>1=VDD, 2=Data, 3=GND, 4=GND</div></blockquote>
<p>Sensor with I2C in I2C mode (eg. DHT12, AM2320, AM2321, AM2322):</p>
<blockquote>
<div>1=VDD, 2=SDA, 3=GND, 4=SCL</div></blockquote>
<p>You should use pull-up resistors for the Data, SDA and SCL pins.</p>
<p>To make newer I2C sensors work in backwards compatible 1-wire mode, you must
connect both pins 3 and 4 to GND. This disables the I2C interface.</p>
<p>DHT22 sensors are now sold under the name AM2302 and are otherwise identical.</p>
</div>
  <div class="section" id="next-steps">

<h1>13. Next steps</h1>
<p>That brings us to the end of the tutorial!  Hopefully by now you have a good
feel for the capabilities of MicroPython on the ESP8266 and understand how to
control both the WiFi and IO aspects of the chip.</p>
<p>There are many features that were not covered in this tutorial.  The best way
to learn about them is to read the full documentation of the modules, and to
experiment!</p>
<p>Good luck creating your Internet of Things devices!</p>

<br>
<br>
<br>
<br>

<script>
  $(function() {
    var toc = $('#toc');

    function makeLi(text, href) {
      return $('<a href="' + href + '" target="_self">' + text + '</a><br>');
    }

    $('h1,h2').each(function(i) {
      var chapter = $(this), chapterNumber = i + 1;
      toc.append(
        makeLi(chapter.text(), '#chapter-' + chapterNumber)
      );
      chapter.attr('id', 'chapter-' + chapterNumber);
    });

  });
</script>
</body>
</html>
