<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, strong,  div.title').click(function(){
    parent.history.back();
    return false;
    });
});
</script>
<style>
body{width:80%;margin-left: 10%;font-size: 22px;color:grey}
strong, h1 {color: gold;}
#problem, #solution, #notes{color:red}
code,pre{width: 100%; margin-left: 0px;background-color:#0a0000;}
h2 {color: #FF1493;}
h3 {color: #4682B4;}
</style>

</head><body>
<center><h1>R cookbook</h1>
<a href="http://www.cookbook-r.com">cookbook-r</a>
<br>
<div id="toc">
Basics<br>
R environment<br>
<a href="#topic-1" target="_self">Installing and using packages</a><br>
R language basics<br>
<a href="#topic-2" target="_self">Indexing into a data structure</a><br>
<a href="#topic-3" target="_self">Getting a subset of a data structure</a><br>
<a href="#topic-4" target="_self">Making a vector filled with values</a><br>
<a href="#topic-5" target="_self">Information about variables</a><br>
<a href="#topic-6" target="_self">Working with NULL, NA, and NaN</a><br>
Numbers<br>
<a href="#topic-7" target="_self">Generating random numbers</a><br>
<a href="#topic-8" target="_self">Generating repeatable sequences of random numbers</a><br>
<a href="#topic-9" target="_self">Saving the state of the random number generator</a><br>
<a href="#topic-10" target="_self">Rounding numbers</a><br>
<a href="#topic-11" target="_self">Comparing floating point numbers</a><br>
Strings<br>
<a href="#topic-12" target="_self">Creating strings from variables</a><br>
Formulas<br>
<a href="#topic-13" target="_self">Creating a formula from a string</a><br>
<a href="#topic-14" target="_self">Extracting components from a formula</a><br>
Data input and output<br>
<a href="#topic-15" target="_self">Loading data from a file</a><br>
<a href="#topic-16" target="_self">Loading and storing data with the keyboard and clipboard</a><br>
<a href="#topic-17" target="_self">Data input</a><br>
<a href="#topic-18" target="_self">Data output</a><br>
<a href="#topic-19" target="_self">Running a script</a><br>
<a href="#topic-20" target="_self">Writing data to a file</a><br>
<a href="#topic-21" target="_self">Writing text and output from analyses to a file</a><br>
Manipulating Data<br>
General<br>
<a href="#topic-22" target="_self">Sorting</a><br>
<a href="#topic-23" target="_self">Randomizing order</a><br>
<a href="#topic-24" target="_self">Converting between vector types</a><br>
<a href="#topic-25" target="_self">Finding and removing duplicate records</a><br>
<a href="#topic-26" target="_self">Comparing vectors or factors with NA</a><br>
<a href="#topic-27" target="_self">Recoding data</a><br>
<a href="#topic-28" target="_self">Mapping vector values</a><br>
Factors<br>
<a href="#topic-30" target="_self">Renaming levels of a factor</a><br>
<a href="#topic-32" target="_self">Re-computing the levels of factor</a><br>
<a href="#topic-34" target="_self">Changing the order of levels of a factor</a><br>
Data Frames<br>
<a href="#topic-35" target="_self">Renaming columns in a data frame</a><br>
<a href="#topic-36" target="_self">Adding and removing columns from a data frame</a><br>
<a href="#topic-37" target="_self">Reordering the columns in a data frame</a><br>
<a href="#topic-38" target="_self">Merging data frames</a><br>
<a href="#topic-39" target="_self">Comparing data frames</a><br>
<a href="#topic-40" target="_self">Re-computing the levels of all factor columns in a data frame</a><br>
Restructuring data<br>
<a href="#topic-42" target="_self">Converting data between wide and long format</a><br>
<a href="#topic-43" target="_self">Summarizing data</a><br>
<a href="#topic-44" target="_self">Converting between data frames and contingency tables</a><br>
Sequential data<br>
<a href="#topic-45" target="_self">Calculating a moving average</a><br>
<a href="#topic-46" target="_self">Averaging a sequence in blocks</a><br>
<a href="#topic-47" target="_self">Finding sequences of identical values</a><br>
<a href="#topic-48" target="_self">Filling in NAs with last non-NA value</a><br>
Statistical analysis<br>
<a href="#topic-49" target="_self">Regression and correlation</a><br>
<a href="#topic-50" target="_self">t-test</a><br>
<a href="#topic-51" target="_self">Frequency tests</a><br>
<a href="#topic-52" target="_self">ANOVA</a><br>
<a href="#topic-53" target="_self">ANOVAs with within-subjects variables</a><br>
<a href="#topic-54" target="_self">Logistic regression</a><br>
<a href="#topic-55" target="_self">Homogeneity of variance</a><br>
<a href="#topic-56" target="_self">Inter-rater reliability</a><br>
Graphs<br>
Graphs with ggplot2<br>
<a href="#topic-57" target="_self">Bar and line graphs (ggplot2)</a><br>
<a href="#topic-58" target="_self">Plotting means and error bars (ggplot2)</a><br>
<a href="#topic-59" target="_self">Plotting distributions (ggplot2)</a><br>
<a href="#topic-60" target="_self">Scatterplots (ggplot2)</a><br>
<a href="#topic-61" target="_self">Titles (ggplot2)</a><br>
<a href="#topic-62" target="_self">Axes (ggplot2)</a><br>
<a href="#topic-63" target="_self">Legends (ggplot2)</a><br>
<a href="#topic-64" target="_self">Lines (ggplot2)</a><br>
<a href="#topic-65" target="_self">Facets (ggplot2)</a><br>
<a href="#topic-66" target="_self">Multiple graphs on one page (ggplot2)</a><br>
<a href="#topic-67" target="_self">Colors (ggplot2)</a><br>
<a href="#topic-68" target="_self">Color charts</a><br>
Miscellaneous<br>
<a href="#topic-69" target="_self">Output to a file</a><br>
<a href="#topic-70" target="_self">Shapes and line types</a><br>
<a href="#topic-71" target="_self">Fonts</a><br>
Basic graphs with standard graphics<br>
<a href="#topic-72" target="_self">Histogram and density plot</a><br>
<a href="#topic-73" target="_self">Scatterplot</a><br>
<a href="#topic-74" target="_self">Box plot</a><br>
<a href="#topic-75" target="_self">Q-Q plot</a><br>
Other interesting graphs<br>
<a href="#topic-76" target="_self">Correlation matrix</a><br>
Scripts and functions<br>
<a href="#topic-77" target="_self">Debugging a script or function</a><br>
<a href="#topic-78" target="_self">Measuring elapsed time</a><br>
<a href="#topic-79" target="_self">Getting a list of functions and objects in a package</a><br>
Tools for experiments<br>
<a href="#topic-80" target="_self">Generating counterbalanced orders</a><br></div></center>
<br>
<br>
<br>

<h2 class="post-title" id="topic-1">Installing and using packages</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to do install and use a package.</p>

<h3 id="solution">Solution</h3>

<p>If you are using a GUI for R, there is likely a menu-driven way of installing packages. This is how to do it from the command line:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s1">'reshape2'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>In each new R session where you use the package, you will have to load it:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>If you use the package in a script, put this line in the script.</p>

<p>To update all your installed packages to the latest versions available:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">update.packages</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>If you are using R on Linux, some of the R packages may be installed at the system level by the root user, and can’t be updated this way, since you won’t haver permission to overwrite them.</p>

</article>
<h2 class="post-title" id="topic-2">Indexing into a data structure</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to get part of a data structure.</p>

<h3 id="solution">Solution</h3>

<p>Elements from a vector, matrix, or data frame can be extracted using numeric indexing, or by using a boolean vector of the appropriate length.</p>

<p>In many of the examples, below, there are multiple ways of doing the same thing.</p>

<h3 id="indexing-with-numbers-and-names">Indexing with numbers and names</h3>
<p>With a vector:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A sample vector
</span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span><span class="w">

</span><span class="n">v</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt; [1] 4 4 3
</span><span class="n">v</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] 4 4 3
</span><span class="w">
</span><span class="n">v</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt; [1] 4 3 4
</span></code></pre>
</div>

<p>With a data frame:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create a sample data frame
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject sex size
 1   M    7
 2   F    6
 3   F    9
 4   M   11
 '</span><span class="p">)</span><span class="w">

</span><span class="c1"># Get the element at row 1, column 3
</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] 7
</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="s2">"size"</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] 7
</span><span class="w">

</span><span class="c1"># Get rows 1 and 2, and all columns
</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">   
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 2       2   F    6
</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 2       2   F    6
</span><span class="w">

</span><span class="c1"># Get rows 1 and 2, and only column 2
</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] M F
#&gt; Levels: F M
</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] M F
#&gt; Levels: F M
</span><span class="w">
</span><span class="c1"># Get rows 1 and 2, and only the columns named "sex" and "size"
</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"size"</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt;   sex size
#&gt; 1   M    7
#&gt; 2   F    6
</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt;   sex size
#&gt; 1   M    7
#&gt; 2   F    6
</span></code></pre>
</div>

<h3 id="indexing-with-a-boolean-vector">Indexing with a boolean vector</h3>
<p>With the vector <code class="highlighter-rouge">v</code> from above:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="c1">#&gt; [1] FALSE  TRUE  TRUE  TRUE FALSE FALSE  TRUE
</span><span class="w">
</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="o">&gt;</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] 4 4 3 3
</span><span class="n">v</span><span class="p">[</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nb">F</span><span class="p">,</span><span class="nb">T</span><span class="p">,</span><span class="nb">T</span><span class="p">,</span><span class="nb">T</span><span class="p">,</span><span class="nb">F</span><span class="p">,</span><span class="nb">F</span><span class="p">,</span><span class="nb">T</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt; [1] 4 4 3 3
</span></code></pre>
</div>

<p>With the data frame from above:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A boolean vector   
</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="c1">#&gt; [1]  TRUE  TRUE FALSE FALSE
</span><span class="w">    
</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 2       2   F    6
</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 2       2   F    6
</span><span class="w">
</span><span class="c1"># It is also possible to get the numeric indices of the TRUEs
</span><span class="n">which</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 1 2
</span></code></pre>
</div>

<h3 id="negative-indexing">Negative indexing</h3>
<p>Unlike in some other programming languages, when you use negative numbers for indexing in R, it doesn’t mean to index backward from the end. Instead, it means to <strong>drop</strong> the element at that index, counting the usual way, from the beginning.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Here's the vector again.
</span><span class="n">v</span><span class="w">
</span><span class="c1">#&gt; [1] 1 4 4 3 2 2 3
</span><span class="w">
</span><span class="c1"># Drop the first element
</span><span class="n">v</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] 4 4 3 2 2 3
</span><span class="w">
</span><span class="c1"># Drop first three
</span><span class="n">v</span><span class="p">[</span><span class="m">-1</span><span class="o">:</span><span class="m">-3</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] 3 2 2 3
</span><span class="w">
</span><span class="c1"># Drop just the last element
</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="nf">length</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt; [1] 1 4 4 3 2 2
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-3">Getting a subset of a data structure</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to do get a subset of the elements of a vector, matrix, or data frame.</p>

<h3 id="solution">Solution</h3>

<p>To get a subset based on some conditional criterion, the <code class="highlighter-rouge">subset()</code> function or indexing using square brackets can be used. In the examples here, both ways are shown.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A sample vector
</span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span><span class="w">

</span><span class="n">subset</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">&lt;</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 1 2 2
</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="o">&lt;</span><span class="m">3</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] 1 2 2
</span><span class="w">

</span><span class="c1"># Another vector
</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Remove "small" entries
</span><span class="n">subset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">!=</span><span class="s2">"small"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "large"  "medium"
</span><span class="n">t</span><span class="p">[</span><span class="n">t</span><span class="o">!=</span><span class="s2">"small"</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] "large"  "medium"
</span></code></pre>
</div>

<p>One important difference between the two methods is that you can assign values to elements with square bracket indexing, but you cannot with <code class="highlighter-rouge">subset()</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="o">&lt;</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">9</span><span class="w">

</span><span class="n">subset</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">&lt;</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">9</span><span class="w">
</span><span class="c1">#&gt; Error in subset(v, v &lt; 3) &lt;- 9: could not find function "subset&lt;-"
</span></code></pre>
</div>

<p>With data frames:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A sample data frame
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject sex size
 1   M    7
 2   F    6
 3   F    9
 4   M   11
 '</span><span class="p">)</span><span class="w">


</span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 2       2   F    6
</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 2       2   F    6
</span><span class="w">

</span><span class="c1"># Subset of particular rows and columns
</span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">subject</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   sex size
#&gt; 1   M    7
#&gt; 2   F    6
</span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">sex</span><span class="p">,</span><span class="n">size</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;   sex size
#&gt; 1   M    7
#&gt; 2   F    6
</span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="o">:</span><span class="n">size</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   sex size
#&gt; 1   M    7
#&gt; 2   F    6
</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"size"</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt;   sex size
#&gt; 1   M    7
#&gt; 2   F    6
</span><span class="w">

</span><span class="c1"># Logical AND of two conditions
</span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="o">&amp;</span><span class="w">  </span><span class="n">sex</span><span class="o">==</span><span class="s2">"M"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="o">&amp;</span><span class="w">  </span><span class="n">data</span><span class="o">$</span><span class="n">sex</span><span class="o">==</span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
</span><span class="w">

</span><span class="c1"># Logical OR of two conditions
</span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="n">sex</span><span class="o">==</span><span class="s2">"M"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 2       2   F    6
#&gt; 4       4   M   11
</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="n">data</span><span class="o">$</span><span class="n">sex</span><span class="o">==</span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 2       2   F    6
#&gt; 4       4   M   11
</span><span class="w">

</span><span class="c1"># Condition based on transformed data
</span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">log2</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 3       3   F    9
#&gt; 4       4   M   11
</span><span class="n">data</span><span class="p">[</span><span class="n">log2</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 3       3   F    9
#&gt; 4       4   M   11
</span><span class="w">

</span><span class="c1"># Subset if elements are in another vector
</span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 3       3   F    9
</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   subject sex size
#&gt; 1       1   M    7
#&gt; 3       3   F    9
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-4">Making a vector filled with values</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to create a vector with values already filled in.</p>

<h3 id="solution">Solution</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">)</span><span class="w">
</span><span class="c1">#  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
# [39] 1 1 1 1 1 1 1 1 1 1 1 1
</span><span class="w">
</span><span class="nf">rep</span><span class="p">(</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="c1">#  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
# [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
</span><span class="w">

</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="c1"># 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5
</span><span class="w">
</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="c1"># 1 1 1 1 2 2 2 2 3 3 3 3 4 4 4 4 5 5 5 5
</span><span class="w">


</span><span class="c1"># Use it on a factor
</span><span class="nf">rep</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="nb">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]),</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="c1"># A B C A B C A B C A B C A B C
# Levels: A B C
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-5">Information about variables</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to find information about variables.</p>

<h3 id="solution">Solution</h3>

<p>Here are some sample variables to work with in the examples below:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="w">
</span><span class="n">let</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nb">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">let</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="information-about-existence">Information about existence</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># List currently defined variables
</span><span class="n">ls</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] "df"       "filename" "let"      "n"        "old_dir"  "x"
</span><span class="w">

</span><span class="c1"># Check if a variable named "x" exists
</span><span class="n">exists</span><span class="p">(</span><span class="s2">"x"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] TRUE
</span><span class="w">
</span><span class="c1"># Check if "y" exists
</span><span class="n">exists</span><span class="p">(</span><span class="s2">"y"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] FALSE
</span><span class="w">

</span><span class="c1"># Delete variable x
</span><span class="n">rm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; Error in eval(expr, envir, enclos): object 'x' not found
</span></code></pre>
</div>

<h3 id="information-about-sizestructure">Information about size/structure</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Get information about structure
</span><span class="n">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  int [1:4] 1 2 3 4
</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 'data.frame':	4 obs. of  2 variables:
#&gt;  $ n  : int  1 2 3 4
#&gt;  $ let: Factor w/ 4 levels "A","B","C","D": 1 2 3 4
</span><span class="w">

</span><span class="c1"># Get the length of a vector
</span><span class="nf">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 4
</span><span class="w">
</span><span class="c1"># Length probably doesn't give us what we want here:
</span><span class="nf">length</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 2
</span><span class="w">
</span><span class="c1"># Number of rows
</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 4
</span><span class="w">
</span><span class="c1"># Number of columns
</span><span class="n">ncol</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 2
</span><span class="w">
</span><span class="c1"># Get rows and columns
</span><span class="nf">dim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 4 2
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-6">Working with NULL, NA, and NaN</h2>
<article class="post-content">
<p>[TOC]</p>

<h3 id="problem">Problem</h3>

<p>You want to properly handle <code class="highlighter-rouge">NULL</code>, <code class="highlighter-rouge">NA</code>, or <code class="highlighter-rouge">NaN</code> values.</p>

<h3 id="solution">Solution</h3>

<p>Sometimes your data will include <code class="highlighter-rouge">NULL</code>, <code class="highlighter-rouge">NA</code>, or <code class="highlighter-rouge">NaN</code>. These work somewhat differently from “normal” values, and may require explicit testing.</p>

<p>Here are some examples of comparisons with these values:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="c1"># logical(0)
</span><span class="w">

</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="c1"># NA
</span><span class="w">

</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NaN</span><span class="w">
</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="c1"># NA
</span></code></pre>
</div>

<p>Here’s how to test whether a variable has one of these values:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">is.null</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1"># TRUE
</span><span class="w">
</span><span class="nf">is.na</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="c1"># TRUE
</span><span class="w">
</span><span class="nf">is.nan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w">
</span><span class="c1"># TRUE
</span></code></pre>
</div>

<p>Note that <code class="highlighter-rouge">NULL</code> is different from the other two. <code class="highlighter-rouge">NULL</code> means that there is no value, while <code class="highlighter-rouge">NA</code> and <code class="highlighter-rouge">NaN</code> mean that there is some value, although one that is perhaps not usable. Here’s an illustration of the difference:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Is y null?
</span><span class="nf">is.null</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="c1"># FALSE
</span><span class="w">
</span><span class="c1"># Is x NA?
</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1"># logical(0)
# Warning message:
# In is.na(x) : is.na() applied to non-(list or vector) of type 'NULL'
</span></code></pre>
</div>

<p>In the first case, it checks if <code class="highlighter-rouge">y</code> is <code class="highlighter-rouge">NULL</code>, and the answer is no. In the second case, it tries to check if <code class="highlighter-rouge">x</code> is `NA, but there is no value to be checked.</p>

<h3 id="ignoring-bad-values-in-vector-summary-functions">Ignoring “bad” values in vector summary functions</h3>

<p>If you run functions like <code class="highlighter-rouge">mean()</code> or <code class="highlighter-rouge">sum()</code> on a vector containing <code class="highlighter-rouge">NA</code> or <code class="highlighter-rouge">NaN</code>, they will return <code class="highlighter-rouge">NA</code> and <code class="highlighter-rouge">NaN</code>, which is generally unhelpful, though this will alert you to the presence of the bad value. Many of these functions take the flag <code class="highlighter-rouge">na.rm</code>, which tells them to ignore these values.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">vy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="c1"># 1  2  3 NA  5
</span><span class="n">mean</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span><span class="w">
</span><span class="c1"># NA
</span><span class="n">mean</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># 2.75
</span><span class="w">

</span><span class="n">vz</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="kc">NaN</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="c1"># 1   2   3 NaN   5
</span><span class="nf">sum</span><span class="p">(</span><span class="n">vz</span><span class="p">)</span><span class="w">
</span><span class="c1"># NaN
</span><span class="nf">sum</span><span class="p">(</span><span class="n">vz</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># 11
</span><span class="w">

</span><span class="c1"># NULL isn't a problem, because it doesn't exist
</span><span class="n">vx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="c1"># 1 2 3 5
</span><span class="nf">sum</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span><span class="w">
</span><span class="c1"># 11
</span></code></pre>
</div>

<h3 id="removing-bad-values-from-a-vector">Removing bad values from a vector</h3>

<p>These values can be removed from a vector by filtering using <code class="highlighter-rouge">is.na()</code> or <code class="highlighter-rouge">is.nan()</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">vy</span><span class="w">
</span><span class="c1"># 1  2  3 NA  5
</span><span class="n">vy</span><span class="p">[</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1"># 1  2  3  5
</span><span class="w">
</span><span class="n">vz</span><span class="w">
</span><span class="c1"># 1   2   3 NaN   5
</span><span class="n">vz</span><span class="p">[</span><span class="w"> </span><span class="o">!</span><span class="nf">is.nan</span><span class="p">(</span><span class="n">vz</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1"># 1  2  3  5
</span></code></pre>
</div>

<h3 id="notes">Notes</h3>

<p>There are also the infinite numerical values <code class="highlighter-rouge">Inf</code> and <code class="highlighter-rouge">-Inf</code>, and the associated functions <code class="highlighter-rouge">is.finite()</code> and <code class="highlighter-rouge">is.infinite()</code>.</p>

</article>
<h2 class="post-title" id="topic-7">Generating random numbers</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>
<p>You want to generate random numbers.</p>

<h3 id="solution">Solution</h3>
<p>For uniformly distributed (flat) random numbers, use <code class="highlighter-rouge">runif()</code>. By default, its range is from 0 to 1.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 0.09006613
</span><span class="w">
</span><span class="c1"># Get a vector of 4 numbers
</span><span class="n">runif</span><span class="p">(</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 0.6972299 0.9505426 0.8297167 0.9779939
</span><span class="w">
</span><span class="c1"># Get a vector of 3 numbers from 0 to 100
</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="o">=</span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 83.702278  3.062253  5.388360
</span><span class="w">
</span><span class="c1"># Get 3 integers from 0 to 100
# Use max=101 because it will never actually equal 101
</span><span class="nf">floor</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="o">=</span><span class="m">101</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] 11 67  1
</span><span class="w">
</span><span class="c1"># This will do the same thing
</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1]  8 63 64
</span><span class="w">
</span><span class="c1"># To generate integers WITHOUT replacement:
</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 76 25 52
</span></code></pre>
</div>

<p>To generate numbers from a normal distribution, use <code class="highlighter-rouge">rnorm()</code>. By default the mean is 0 and the standard deviation is 1.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">rnorm</span><span class="p">(</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] -2.3308287 -0.9073857 -0.7638332 -0.2193786
</span><span class="w">
</span><span class="c1"># Use a different mean and standard deviation
</span><span class="n">rnorm</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 59.20927 40.12440 44.58840 41.97056
</span><span class="w">
</span><span class="c1"># To check that the distribution looks right, make a histogram of the numbers
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">400</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Numbers/Generating_random_numbers/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>

</article>
<h2 class="post-title" id="topic-8">Generating repeatable sequences of random numbers</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to generate a sequence of random numbers, and then generate that same sequence again later.</p>

<h3 id="solution">Solution</h3>

<p>Use <code class="highlighter-rouge">set.seed()</code>, and pass in a number as the seed.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">423</span><span class="p">)</span><span class="w">
</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 0.1089715 0.5973455 0.9726307
</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">423</span><span class="p">)</span><span class="w">
</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 0.1089715 0.5973455 0.9726307
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-9">Saving the state of the random number generator</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to save and restore the state of the random number generator</p>

<h3 id="solution">Solution</h3>

<p>Save <code class="highlighter-rouge">.Random.seed</code> to another variable and then later restore that value to <code class="highlighter-rouge">.Random.seed</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># For this example, set the random seed
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">423</span><span class="p">)</span><span class="w">
</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 0.1089715 0.5973455 0.9726307
</span><span class="w">
</span><span class="c1"># Save the seed
</span><span class="n">oldseed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">.Random.seed</span><span class="w">

</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 0.7973768 0.2278427 0.5189830
</span><span class="w">
</span><span class="c1"># Do some other stuff with RNG here, such as:
# runif(30)
# ...
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Restore the seed
</span><span class="n">.Random.seed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oldseed</span><span class="w">

</span><span class="c1"># Get the same random numbers as before, after saving the seed
</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 0.7973768 0.2278427 0.5189830
</span></code></pre>
</div>

<p>If no random number generator has been used in your R session, the variable <code class="highlighter-rouge">.Random.seed</code> will not exist. If you cannot be certain that an RNG has been used before attempting to save, the seed, you should check for it before saving and restoring:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="w">
</span><span class="n">oldseed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exists</span><span class="p">(</span><span class="s2">".Random.seed"</span><span class="p">))</span><span class="w">
</span><span class="n">oldseed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">.Random.seed</span><span class="w">

</span><span class="c1"># Do some other stuff with RNG here, such as:
# runif(30)
# ...
</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">oldseed</span><span class="p">))</span><span class="w">
</span><span class="n">.Random.seed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oldseed</span><span class="w">
</span></code></pre>
</div>

<h3 id="saving-and-restoring-the-state-of-the-rng-in-functions">Saving and restoring the state of the RNG in functions</h3>

<p>If you attempt to restore the state of the random number generator within a function by using <code class="highlighter-rouge">.Random.seed &lt;- x</code>, it will not work, because this operation changes a <em>local</em> variable named <code class="highlighter-rouge">.Random.seed</code>, instead of the variable in the <em>global</em> envrionment.</p>

<p>Here are two examples. What these functions are supposed to do is generate some random numbers, while leaving the state of the RNG unchanged.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># This is the bad version
</span><span class="n">bad_rand_restore</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exists</span><span class="p">(</span><span class="s2">".Random.seed"</span><span class="p">))</span><span class="w">
  </span><span class="n">oldseed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">.Random.seed</span><span class="w">
</span><span class="k">else</span><span class="w">
  </span><span class="n">oldseed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">))</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">oldseed</span><span class="p">))</span><span class="w">
  </span><span class="n">.Random.seed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oldseed</span><span class="w">
</span><span class="k">else</span><span class="w">
  </span><span class="n">rm</span><span class="p">(</span><span class="s2">".Random.seed"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="c1"># This is the good version
</span><span class="n">rand_restore</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exists</span><span class="p">(</span><span class="s2">".Random.seed"</span><span class="p">,</span><span class="w"> </span><span class="n">.GlobalEnv</span><span class="p">))</span><span class="w">
  </span><span class="n">oldseed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">.GlobalEnv</span><span class="o">$</span><span class="n">.Random.seed</span><span class="w">
</span><span class="k">else</span><span class="w">
  </span><span class="n">oldseed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">3</span><span class="p">))</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">oldseed</span><span class="p">))</span><span class="w"> 
  </span><span class="n">.GlobalEnv</span><span class="o">$</span><span class="n">.Random.seed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oldseed</span><span class="w">
</span><span class="k">else</span><span class="w">
  </span><span class="n">rm</span><span class="p">(</span><span class="s2">".Random.seed"</span><span class="p">,</span><span class="w"> </span><span class="n">envir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.GlobalEnv</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="c1"># The bad version doesn't properly reset the RNG state, so random numbers keep
# changing.
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">423</span><span class="p">)</span><span class="w">
</span><span class="n">bad_rand_restore</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] 0.1089715 0.5973455 0.9726307
</span><span class="n">bad_rand_restore</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] 0.7973768 0.2278427 0.5189830
</span><span class="n">bad_rand_restore</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] 0.6929255 0.8104453 0.1019465
</span><span class="w">
</span><span class="c1"># The good version correctly resets the RNG state each time, so random numbers
# stay the same.
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">423</span><span class="p">)</span><span class="w">
</span><span class="n">rand_restore</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] 0.1089715 0.5973455 0.9726307
</span><span class="n">rand_restore</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] 0.1089715 0.5973455 0.9726307
</span><span class="n">rand_restore</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] 0.1089715 0.5973455 0.9726307
</span></code></pre>
</div>

<h3 id="notes">Notes</h3>

<p><code class="highlighter-rouge">.Random.seed</code> should not be modified by the user.</p>


</article>
<h2 class="post-title" id="topic-10">Rounding numbers</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to round numbers.</p>

<h3 id="solution">Solution</h3>

<p>There are many ways of rounding: to the nearest integer, up, down, or toward zero.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">-2.5</span><span class="p">,</span><span class="w"> </span><span class="m">2.5</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">.5</span><span class="p">)</span><span class="w">

</span><span class="c1"># Round to nearest, with .5 values rounded to even number.
</span><span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] -2 -2 -2 -1  0  0  0  1  2  2  2
</span><span class="w">
</span><span class="c1"># Round up
</span><span class="nf">ceiling</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] -2 -2 -1 -1  0  0  1  1  2  2  3
</span><span class="w">
</span><span class="c1"># Round down
</span><span class="nf">floor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] -3 -2 -2 -1 -1  0  0  1  1  2  2
</span><span class="w">
</span><span class="c1"># Round toward zero
</span><span class="nf">trunc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] -2 -2 -1 -1  0  0  0  1  1  2  2
</span></code></pre>
</div>

<p>It is also possible to round to other decimal places:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.001</span><span class="p">,</span><span class="w"> </span><span class="m">.07</span><span class="p">,</span><span class="w"> </span><span class="m">1.2</span><span class="p">,</span><span class="w"> </span><span class="m">44.02</span><span class="p">,</span><span class="w"> </span><span class="m">738</span><span class="p">,</span><span class="w"> </span><span class="m">9927</span><span class="p">)</span><span class="w"> 

</span><span class="c1"># Round to one decimal place
</span><span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1]    0.0    0.1    1.2   44.0  738.0 9927.0
</span><span class="w">
</span><span class="c1"># Round to tens place
</span><span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1]    0    0    0   40  740 9930
</span><span class="w">
</span><span class="c1"># Round to nearest 5
</span><span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="m">5</span><span class="p">)</span><span class="o">*</span><span class="m">5</span><span class="w">
</span><span class="c1">#&gt; [1]    0    0    0   45  740 9925
</span><span class="w">
</span><span class="c1"># Round to nearest .02
</span><span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="m">.02</span><span class="p">)</span><span class="o">*</span><span class="m">.02</span><span class="w">
</span><span class="c1">#&gt; [1]    0.00    0.08    1.20   44.02  738.00 9927.00
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-11">Comparing floating point numbers</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>Comparing floating point numbers does not always work as you expect. For example:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="m">0.3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="o">*</span><span class="m">.1</span><span class="w">
</span><span class="c1">#&gt; [1] FALSE
</span><span class="w">
</span><span class="p">(</span><span class="m">0.1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.3</span><span class="w">
</span><span class="c1">#&gt; [1] 5.551115e-17
</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">.1</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt;  [1] 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0
</span><span class="w">
</span><span class="m">10</span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="m">10</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] 0.000000e+00 0.000000e+00 0.000000e+00 4.440892e-16 0.000000e+00 0.000000e+00
#&gt;  [7] 8.881784e-16 8.881784e-16 0.000000e+00 0.000000e+00 0.000000e+00
</span></code></pre>
</div>

<h3 id="solution">Solution</h3>

<p>There is no universal solution, because this issue is inherent to the storage format for non-integer (floating point) numbers, in R and computers in general.</p>

<p>See this page for more information and workarounds:
<a href="http://www.mathworks.com/support/tech-notes/1100/1108.html">http://www.mathworks.com/support/tech-notes/1100/1108.html</a>. This is written for Matlab, but much of it will be relevant for R as well.</p>

</article>
<h2 class="post-title" id="topic-12">Creating strings from variables</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to do create a string from variables.</p>

<h3 id="solution">Solution</h3>

<p>The two common ways of creating strings from variables are the <code class="highlighter-rouge">paste</code> function and the <code class="highlighter-rouge">sprintf</code> function. <code class="highlighter-rouge">paste</code> is more useful for vectors, and <code class="highlighter-rouge">sprintf</code> is more useful for precise control of the output.</p>

<h3 id="using-paste">Using paste()</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"apple"</span><span class="w">
</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"banana"</span><span class="w">

</span><span class="c1"># Put a and b together, with a space in between:
</span><span class="n">paste</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "apple banana"
</span><span class="w">
</span><span class="c1"># With no space, use sep="", or use paste0():
</span><span class="n">paste</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "applebanana"
</span><span class="n">paste0</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "applebanana"
</span><span class="w">
</span><span class="c1"># With a comma and space:
</span><span class="n">paste</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "apple, banana"
</span><span class="w">

</span><span class="c1"># With a vector
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"fig"</span><span class="p">,</span><span class="w"> </span><span class="s2">"grapefruit"</span><span class="p">,</span><span class="w"> </span><span class="s2">"honeydew"</span><span class="p">)</span><span class="w">

</span><span class="c1"># If the input is a vector, use collapse to put the elements together:
</span><span class="n">paste</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "fig, grapefruit, honeydew"
</span><span class="w">
</span><span class="c1"># If the input is a scalar and a vector, it puts the scalar with each
# element of the vector, and returns a vector:
</span><span class="n">paste</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "apple fig"        "apple grapefruit" "apple honeydew"
</span><span class="w">
</span><span class="c1"># Use sep and collapse:
</span><span class="n">paste</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"-"</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "apple-fig, apple-grapefruit, apple-honeydew"
</span></code></pre>
</div>

<h3 id="using-sprintf">Using sprintf()</h3>

<p>Another way is to use <code class="highlighter-rouge">sprintf</code> function. This is derived from the function of the same name in the C programming language.</p>

<p>To substitute in a string or string variable, use <code class="highlighter-rouge">%s</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"This is where a %s goes."</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "This is where a string goes."
</span></code></pre>
</div>

<p>For integers, use <code class="highlighter-rouge">%d</code> or a variant:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"Regular:%d"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "Regular:8"
</span><span class="w">
</span><span class="c1"># Can print to take some number of characters, leading with spaces.
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"Leading spaces:%4d"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "Leading spaces:   8"
</span><span class="w">
</span><span class="c1"># Can also lead with zeros instead.
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"Leading zeros:%04d"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "Leading zeros:0008"
</span></code></pre>
</div>

<p>For floating-point numbers, use <code class="highlighter-rouge">%f</code> for standard notation, and <code class="highlighter-rouge">%e</code> or <code class="highlighter-rouge">%E</code> for exponential notation. You can also use <code class="highlighter-rouge">%g</code> or <code class="highlighter-rouge">%G</code> for a “smart” formatter that automatically switches between the two formats, depending on where the significant digits are. The following examples are taken from the R help page for sprintf:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%f"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">         </span><span class="c1"># "3.141593"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%.3f"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">       </span><span class="c1"># "3.142"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%1.0f"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">      </span><span class="c1"># "3"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%5.1f"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">      </span><span class="c1"># "  3.1"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%05.1f"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">     </span><span class="c1"># "003.1"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%+f"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">        </span><span class="c1"># "+3.141593"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"% f"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">        </span><span class="c1"># " 3.141593"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%-10f"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">      </span><span class="c1"># "3.141593  "   (left justified)
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%e"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">         </span><span class="c1">#"3.141593e+00"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%E"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">         </span><span class="c1"># "3.141593E+00"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%g"</span><span class="p">,</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">         </span><span class="c1"># "3.14159"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%g"</span><span class="p">,</span><span class="w">   </span><span class="m">1e6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w"> </span><span class="c1"># "3.14159e+06"  (exponential)
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%.9g"</span><span class="p">,</span><span class="w"> </span><span class="m">1e6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w"> </span><span class="c1"># "3141592.65"   ("fixed")
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%G"</span><span class="p">,</span><span class="w"> </span><span class="m">1e-6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="p">)</span><span class="w">  </span><span class="c1"># "3.14159E-06"
</span></code></pre>
</div>

<p>In the <code class="highlighter-rouge">%m.nf</code> format specification: The <code class="highlighter-rouge">m</code> represents the field width, which is the <strong>minimum</strong> number of characters in the output string, and can be padded with leading spaces, or zeros if there is a zero in front of <code class="highlighter-rouge">m</code>. The <code class="highlighter-rouge">n</code> represents precision, which the number of digits after the decimal.</p>

<p>Other miscellaneous things:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"Substitute in multiple strings: %s %s"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s2">"string2"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "Substitute in multiple strings: string string2"
</span><span class="w">
</span><span class="c1"># To print a percent sign, use "%%"
</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"A single percent sign here %%"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "A single percent sign here %"
</span></code></pre>
</div>


</article>
<h2 class="post-title" id="topic-13">Creating a formula from a string</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to create a formula from a string.</p>

<h3 id="solution">Solution</h3>

<p>It can be useful to create a formula from a string. This often occurs in functions where the formula arguments are passed in as strings.</p>

<p>In the most basic case, use <code class="highlighter-rouge">as.formula()</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># This returns a string:
</span><span class="s2">"y ~ x1 + x2"</span><span class="w">
</span><span class="c1">#&gt; [1] "y ~ x1 + x2"
</span><span class="w">
</span><span class="c1"># This returns a formula:
</span><span class="n">as.formula</span><span class="p">(</span><span class="s2">"y ~ x1 + x2"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; y ~ x1 + x2
#&gt; &lt;environment: 0x3361710&gt;
</span></code></pre>
</div>

<p>Here is an example of how it might be used:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># These are the variable names:
</span><span class="n">measurevar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"y"</span><span class="w">
</span><span class="n">groupvars</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="s2">"x2"</span><span class="p">,</span><span class="s2">"x3"</span><span class="p">)</span><span class="w">

</span><span class="c1"># This creates the appropriate string:
</span><span class="n">paste</span><span class="p">(</span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">groupvars</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">" + "</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">" ~ "</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "y ~ x1 + x2 + x3"
</span><span class="w">
</span><span class="c1"># This returns the formula:
</span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">groupvars</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">" + "</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">" ~ "</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; y ~ x1 + x2 + x3
#&gt; &lt;environment: 0x3361710&gt;
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-14">Extracting components from a formula</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to extract parts of a formula for further use.</p>

<h3 id="solution">Solution</h3>

<p>You can index into the formula object as though it were a list, using the <code class="highlighter-rouge">[[</code> operator.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="m">2</span><span class="w">

</span><span class="c1"># Take a look at f
</span><span class="n">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Class 'formula'  language y ~ x1 + x2
#&gt;   ..- attr(*, ".Environment")=&lt;environment: 0x1e46710&gt;
</span><span class="w">
</span><span class="c1"># Get each part
</span><span class="n">f</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="c1">#&gt; `~`
</span><span class="n">f</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w">
</span><span class="c1">#&gt; y
</span><span class="n">f</span><span class="p">[[</span><span class="m">3</span><span class="p">]]</span><span class="w">
</span><span class="c1">#&gt; x1 + x2
</span><span class="w">
</span><span class="c1"># Or view the whole thing as a list
</span><span class="n">as.list</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [[1]]
#&gt; `~`
#&gt; 
#&gt; [[2]]
#&gt; y
#&gt; 
#&gt; [[3]]
#&gt; x1 + x2
#&gt; 
#&gt; &lt;environment: 0x1e46710&gt;
</span></code></pre>
</div>

<p>For formulas that have nothing on the left side, there are only two elements:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">f</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="m">2</span><span class="w">
</span><span class="n">as.list</span><span class="p">(</span><span class="n">f</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [[1]]
#&gt; `~`
#&gt; 
#&gt; [[2]]
#&gt; x1 + x2
#&gt; 
#&gt; &lt;environment: 0x1e46710&gt;
</span></code></pre>
</div>

<p>Each of the elements of the formula is an symbol or language object (which consists of multiple symbols:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt;  symbol ~
</span><span class="n">str</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">2</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt;  symbol y
</span><span class="n">str</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">3</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt;  language x1 + x2
</span><span class="w">
</span><span class="c1"># Look at parts of the langage object
</span><span class="n">str</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">3</span><span class="p">]][[</span><span class="m">1</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt;  symbol +
</span><span class="n">str</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">3</span><span class="p">]][[</span><span class="m">2</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt;  symbol x1
</span><span class="n">str</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">3</span><span class="p">]][[</span><span class="m">3</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt;  symbol x2
</span></code></pre>
</div>

<p>You can use <code class="highlighter-rouge">as.character()</code> or <code class="highlighter-rouge">deparse()</code> to convert any of these to strings. <code class="highlighter-rouge">deparse()</code> can give a more natural-looking result:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">as.character</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt; [1] "~"
</span><span class="nf">as.character</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">2</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt; [1] "y"
</span><span class="w">
</span><span class="c1"># The language object gets coerced into a string that represents the parse tree:
</span><span class="nf">as.character</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">3</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt; [1] "+"  "x1" "x2"
</span><span class="w">
</span><span class="c1"># You can use deparse() to get a more natural looking string
</span><span class="n">deparse</span><span class="p">(</span><span class="n">f</span><span class="p">[[</span><span class="m">3</span><span class="p">]])</span><span class="w">
</span><span class="c1">#&gt; [1] "x1 + x2"
</span><span class="n">deparse</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "y ~ x1 + x2"
</span></code></pre>
</div>

<p>The formula object also captures the environment in which it was called, as we saw earlier when we ran <code class="highlighter-rouge">str(f)</code>. To extract it, use <code class="highlighter-rouge">environment()</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">environment</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; &lt;environment: 0x1e46710&gt;
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-15">Loading data from a file</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>
<p>You want to load data from a file.</p>

<h3 id="solution">Solution</h3>

<h3 id="delimited-text-files">Delimited text files</h3>
<p>The simplest way to import data is to save it as a text file with delimiters such as tabs or commas (CSV).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"datafile.csv"</span><span class="p">)</span><span class="w">


</span><span class="c1"># Load a CSV file that doesn't have headers
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"datafile-noheader.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>The function <code class="highlighter-rouge">read.table()</code> is a more general function which allows you to set the delimiter, whether or not there are headers, whether strings are set off with quotes, and more. See <code class="highlighter-rouge">?read.table</code> for more information on the details.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"datafile-noheader.csv"</span><span class="p">,</span><span class="w">
             </span><span class="n">header</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
             </span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="w">         </span><span class="c1"># use "\t" for tab-delimited files
</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="loading-a-file-with-a-file-chooser">Loading a file with a file chooser</h3>

<p>On some platforms, using <code class="highlighter-rouge">file.choose()</code> will open a file chooser dialog window. On others, it will simply prompt the user to type in a filename.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file.choose</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<h3 id="treating-strings-as-factors-or-characters">Treating strings as factors or characters</h3>

<p>By default, strings in the data are converted to factors. If you load the data below with <code class="highlighter-rouge">read.csv</code>, then all the text columns will be treated as factors, even though it might make more sense to treat some of them as strings. To do
this, use <code class="highlighter-rouge">stringsAsFactors=FALSE</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"datafile.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># You might have to convert some columns to factors
</span><span class="n">data</span><span class="o">$</span><span class="n">Sex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Sex</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Another alternative is to load them as factors and convert some columns to 
characters:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"datafile.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="o">$</span><span class="n">First</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">First</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">Last</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Last</span><span class="p">)</span><span class="w">

</span><span class="c1"># Another method: convert columns named "First" and "Last"
</span><span class="n">stringcols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"First"</span><span class="p">,</span><span class="s2">"Last"</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">[</span><span class="n">stringcols</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">stringcols</span><span class="p">],</span><span class="w"> </span><span class="n">as.character</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="loading-a-file-from-the-internet">Loading a file from the Internet</h3>

<p>Data can also be loaded from a URL. These (very long) URLs will load the files linked to below.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"http://www.cookbook-r.com/Data_input_and_output/Loading_data_from_a_file/datafile.csv"</span><span class="p">)</span><span class="w">


</span><span class="c1"># Read in a CSV file without headers
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"http://www.cookbook-r.com/Data_input_and_output/Loading_data_from_a_file/datafile-noheader.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Manually assign the header names
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"First"</span><span class="p">,</span><span class="s2">"Last"</span><span class="p">,</span><span class="s2">"Sex"</span><span class="p">,</span><span class="s2">"Number"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>The data files used above:</p>

<p><a href="datafile.csv">datafile.csv</a>:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>"First","Last","Sex","Number"
"Currer","Bell","F",2
"Dr.","Seuss","M",49
"","Student",NA,21
</code></pre>
</div>

<p><a href="datafile-noheader.csv">datafile-noheader.csv</a>:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>"Currer","Bell","F",2
"Dr.","Seuss","M",49
"","Student",NA,21
</code></pre>
</div>

<h3 id="fixed-width-text-files">Fixed-width text files</h3>

<p>Suppose your data has fixed-width columns, like this:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>
First	Last  Sex Number
Currer   Bell    F      2
Dr.     Seuss    M     49
""    Student   NA     21
</code></pre>
</div>

<p>One way to read it in is to simply use <code class="highlighter-rouge">read.table()</code> with <code class="highlighter-rouge">strip.white=TRUE</code>, which will remove extra spaces.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">read.table</span><span class="p">(</span><span class="s2">"clipboard"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">strip.white</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>However, your data file may have columns containing spaces, or columns with no spaces separating them, like this, where the scores column represents six different measurements, each from 0 to 3.</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>subject  sex  scores
 N  1    M  113311
 NE 2    F  112231
 S  3    F  111221
 W  4    M  011002
</code></pre>
</div>

<p>In this case, you may need to use the <code class="highlighter-rouge">read.fwf()</code> function. If you read the column names from the file, it requires that they be separated with a delimiter like a single tab, space, or comma. If they are separated with multiple spaces, as in this example, you will have to assign the column names directly.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Assign the column names manually
</span><span class="n">read.fwf</span><span class="p">(</span><span class="s2">"myfile.txt"</span><span class="p">,</span><span class="w"> 
   </span><span class="nf">c</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">-2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="c1"># Width of the columns. -2 means drop those columns
</span><span class="w">         </span><span class="n">skip</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">                </span><span class="c1"># Skip the first line (contains header here)
</span><span class="w">         </span><span class="n">col.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"subject"</span><span class="p">,</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"s1"</span><span class="p">,</span><span class="s2">"s2"</span><span class="p">,</span><span class="s2">"s3"</span><span class="p">,</span><span class="s2">"s4"</span><span class="p">,</span><span class="s2">"s5"</span><span class="p">,</span><span class="s2">"s6"</span><span class="p">),</span><span class="w">
   </span><span class="n">strip.white</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">      </span><span class="c1"># Strip out leading and trailing whitespace when reading each
#&gt;   subject sex s1 s2 s3 s4 s5 s6
#&gt; 1    N  1   M  1  1  3  3  1  1
#&gt; 2    NE 2   F  1  1  2  2  3  1
#&gt; 3    S  3   F  1  1  1  2  2  1
#&gt; 4    W  4   M  0  1  1  0  0  2
# subject sex s1 s2 s3 s4 s5 s6
#    N  1   M  1  1  3  3  1  1
#    NE 2   F  1  1  2  2  3  1
#    S  3   F  1  1  1  2  2  1
#    W  4   M  0  1  1  0  0  2
</span><span class="w">

</span><span class="c1"># If the first row looked like this:
# subject,sex,scores
# Then we could use header=TRUE:
</span><span class="n">read.fwf</span><span class="p">(</span><span class="s2">"myfile.txt"</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">-2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">strip.white</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Error in read.table(file = FILE, header = header, sep = sep, row.names = row.names, : more columns than column names
</span></code></pre>
</div>

<h3 id="excel-files">Excel files</h3>

<p>The <code class="highlighter-rouge">read.xls</code> function in the <code class="highlighter-rouge">gdata</code> package can read in Excel files.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">gdata</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.xls</span><span class="p">(</span><span class="s2">"data.xls"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>See <a href="http://cran.r-project.org/doc/manuals/R-data.html#Reading-Excel-spreadsheets">http://cran.r-project.org/doc/manuals/R-data.html#Reading-Excel-spreadsheets</a>.</p>

<h3 id="spss-data-files">SPSS data files</h3>

<p>The <code class="highlighter-rouge">read.spss</code> function in the <code class="highlighter-rouge">foreign</code> package can read in SPSS files.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">foreign</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.spss</span><span class="p">(</span><span class="s2">"data.sav"</span><span class="p">,</span><span class="w"> </span><span class="n">to.data.frame</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>


</article>
<h2 class="post-title" id="topic-16">Loading and storing data with the keyboard and clipboard</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to enter data using input from the keyboard (not a file).</p>

<h3 id="solution">Solution</h3>

<h2 id="topic-17">Data input</h2>
<p>Suppose this is your data:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>size   weight  cost
small      5    6
medium     8   10
large     11    9
</code></pre>
</div>

<h3 id="loading-data-from-keyboard-input-or-clipboard">Loading data from keyboard input or clipboard</h3>

<p>One way enter from the keyboard is to read from standard input (<code class="highlighter-rouge">stdin()</code>).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Cutting and pasting using read.table and stdin()
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">stdin</span><span class="p">(),</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># You will be prompted for input; copy and paste text here
</span><span class="w">
</span><span class="c1"># Or:
# data &lt;- read.csv(stdin())
</span></code></pre>
</div>

<p>You can also load directly from the clipboard:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># First copy the data to the clipboard
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s1">'clipboard'</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Or:
# data &lt;- read.csv('clipboard')
</span></code></pre>
</div>

<h3 id="loading-data-in-a-script">Loading data in a script</h3>

<p>The previous method can’t be used to load data in a script file because the input must be typed (or pasted) after running the command.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Using read.table()
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
size weight cost
 small      5    6
medium      8   10
 large     11    9
 '</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>For different data formats (e.g., comma-delimited, no headers, etc.), options to <code class="highlighter-rouge">read.table()</code> can be set. See <a href="../Loading_data_from_a_file">../Loading data from a file</a> for more information.</p>

<h2 id="topic-18">Data output</h2>

<p>By default, R prints row names. If you want to print the table in a format that can be copied and pasted, it may be useful to suppress them.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    size weight cost
#&gt;   small      5    6
#&gt;  medium      8   10
#&gt;   large     11    9
</span></code></pre>
</div>

<h3 id="writing-data-for-copying-and-pasting-or-to-the-clipboard">Writing data for copying and pasting, or to the clipboard</h3>

<p>It is possible to write delimited data to terminal (<code class="highlighter-rouge">stdout()</code>), so that it can be copied and pasted elsewhere. Or it can be written directly to the clipboard.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">write.csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">stdout</span><span class="p">(),</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1"># "size","weight","cost"
# "small",5,6
# "medium",8,10
# "large",11,9
</span><span class="w">

</span><span class="c1"># Write to the clipboard (does not work on Mac or Unix)
</span><span class="n">write.csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s1">'clipboard'</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="output-for-loading-in-r">Output for loading in R</h3>

<p>If the data has already been loaded into R, the data structure can be saved using <code class="highlighter-rouge">dput()</code>. The output from <code class="highlighter-rouge">dput()</code> is a command which will recreate the data structure. The advantage of this method is that it will keep any modifications to data types; for example, if one column consists of numbers and you have converted it to a factor, this method will preserve that type, whereas simply loading the text table (as shown above) will treat it as numeric.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Suppose you have already loaded data
</span><span class="w">
</span><span class="n">dput</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; structure(list(size = structure(c(3L, 2L, 1L), .Label = c("large", 
#&gt; "medium", "small"), class = "factor"), weight = c(5L, 8L, 11L
#&gt; ), cost = c(6L, 10L, 9L)), .Names = c("size", "weight", "cost"
#&gt; ), class = "data.frame", row.names = c(NA, -3L))
</span><span class="w">

</span><span class="c1"># Later, we can use the output from dput to recreate the data structure
</span><span class="n">newdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">structure</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">structure</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">3L</span><span class="p">,</span><span class="w"> </span><span class="m">2L</span><span class="p">,</span><span class="w"> </span><span class="m">1L</span><span class="p">),</span><span class="w"> </span><span class="n">.Label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"large"</span><span class="p">,</span><span class="w"> 
</span><span class="s2">"medium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">),</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"factor"</span><span class="p">),</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5L</span><span class="p">,</span><span class="w"> </span><span class="m">8L</span><span class="p">,</span><span class="w"> </span><span class="m">11L</span><span class="w">
</span><span class="p">),</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6L</span><span class="p">,</span><span class="w"> </span><span class="m">10L</span><span class="p">,</span><span class="w"> </span><span class="m">9L</span><span class="p">)),</span><span class="w"> </span><span class="n">.Names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"weight"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cost"</span><span class="w">
</span><span class="p">),</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data.frame"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">-3L</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-19">Running a script</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to run R code from a text file.</p>

<h3 id="solution">Solution</h3>

<p>Use the <code class="highlighter-rouge">source()</code> function.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># First, go to the proper directory
</span><span class="n">setwd</span><span class="p">(</span><span class="s1">'/home/username/desktop/rcode'</span><span class="p">)</span><span class="w">

</span><span class="n">source</span><span class="p">(</span><span class="s1">'analyze.r'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Note that if you want your script to produce text output, you must use the <code class="highlighter-rouge">print()</code> or <code class="highlighter-rouge">cat()</code> function.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="w">

</span><span class="c1"># In a script, this will do nothing
</span><span class="n">x</span><span class="w">

</span><span class="c1"># Use the print function:
</span><span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1]  1  2  3  4  5  6  7  8  9 10
</span><span class="w">

</span><span class="c1"># Simpler output: no row/column numbers, no text wrapping
</span><span class="n">cat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 1  2  3  4  5  6  7  8  9 10
</span></code></pre>
</div>

<p>Another alternative is to run <code class="highlighter-rouge">source()</code> with the <code class="highlighter-rouge">print.eval=TRUE</code> option.</p>

</article>
<h2 class="post-title" id="topic-20">Writing data to a file</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to write data to a file.</p>

<h3 id="solution">Solution</h3>

<h3 id="writing-to-a-delimited-text-file">Writing to a delimited text file</h3>

<p>The easiest way to do this is to use <code class="highlighter-rouge">write.csv()</code>. By default, <code class="highlighter-rouge">write.csv()</code> includes row names, but these are usually unnecessary and may cause confusion.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A sample data frame
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject sex size
 1   M    7
 2   F    NA
 3   F    9
 4   M   11
 '</span><span class="p">)</span><span class="w">


</span><span class="c1"># Write to a file, suppress row names
</span><span class="n">write.csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Same, except that instead of "NA", output blank cells
</span><span class="n">write.csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">na</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">

</span><span class="c1"># Use tabs, suppress row names and column names
</span><span class="n">write.table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">col.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<h3 id="saving-in-r-data-format">Saving in R data format</h3>

<p><code class="highlighter-rouge">write.csv()</code> and <code class="highlighter-rouge">write.table()</code> are best for interoperability with other data analysis programs. They will not, however, preserve special attributes of the data structures, such as whether a column is a character type or factor, or the order of levels in factors. In order to do that, it should be written out in a special format for R.</p>

<p>Below are are three primary ways of doing this:</p>

<p>The first method is to output R source code which, when run, will re-create the object. This should work for most data objects, but it may not be able to faithfully re-create some more complicated data objects.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Save in a text format that can be easily loaded in R
</span><span class="n">dump</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.Rdmpd"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Can save multiple objects:
</span><span class="n">dump</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span><span class="w"> </span><span class="s2">"data1"</span><span class="p">),</span><span class="w"> </span><span class="s2">"data.Rdmpd"</span><span class="p">)</span><span class="w">

</span><span class="c1"># To load the data again: 
</span><span class="n">source</span><span class="p">(</span><span class="s2">"data.Rdmpd"</span><span class="p">)</span><span class="w">
</span><span class="c1"># When loaded, the original data names will automatically be used.
</span></code></pre>
</div>

<p>The next method is to write out individual data objects in RDS format. This format can be binary or ASCII. Binary is more compact, while ASCII will be more efficient with version control systems like Git.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Save a single object in binary RDS format
</span><span class="n">saveRDS</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.rds"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Or, using ASCII format
</span><span class="n">saveRDS</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.rds"</span><span class="p">,</span><span class="w"> </span><span class="n">ascii</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># To load the data again:
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readRDS</span><span class="p">(</span><span class="s2">"data.rds"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>It’s also possible to save multiple objects into an single file, using the RData format.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Saving multiple objects in binary RData format
</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">=</span><span class="s2">"data.RData"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Or, using ASCII format
</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">=</span><span class="s2">"data.RData"</span><span class="p">,</span><span class="w"> </span><span class="n">ascii</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># Can save multiple objects
</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">data1</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">=</span><span class="s2">"data.RData"</span><span class="p">)</span><span class="w">

</span><span class="c1"># To load the data again:
</span><span class="n">load</span><span class="p">(</span><span class="s2">"data.RData"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>An important difference between <code class="highlighter-rouge">saveRDS()</code> and <code class="highlighter-rouge">save()</code> is that, with the former, when you <code class="highlighter-rouge">readRDS()</code> the data, you specify the name of the object, and with the latter, when you <code class="highlighter-rouge">load()</code> the data, the original object names are automatically used. Automatically using the original object names can sometimes simplify a workflow, but it can also be a drawback if the data object is meant to be distributed to others for use in a different environment.</p>

</article>
<h2 class="post-title" id="topic-21">Writing text and output from analyses to a file</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to write output to a file.</p>

<h3 id="solution">Solution</h3>

<p>The <code class="highlighter-rouge">sink()</code> function will redirect output to a file instead of to the R terminal. Note that if you use <code class="highlighter-rouge">sink()</code> in a script and it crashes before output is returned to the terminal, then you will not see any response to your commands. Call <code class="highlighter-rouge">sink()</code> without any arguments to return output to the terminal.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Start writing to an output file
</span><span class="n">sink</span><span class="p">(</span><span class="s1">'analysis-output.txt'</span><span class="p">)</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">12345</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="c1"># Do some stuff here
</span><span class="n">cat</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"x has %d elements:\n"</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"y ="</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"=============================\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"T-test between x and y\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"=============================\n"</span><span class="p">)</span><span class="w">
</span><span class="n">t.test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w">

</span><span class="c1"># Stop writing to the file
</span><span class="n">sink</span><span class="p">()</span><span class="w">


</span><span class="c1"># Append to the file
</span><span class="n">sink</span><span class="p">(</span><span class="s1">'analysis-output.txt'</span><span class="p">,</span><span class="w"> </span><span class="n">append</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"Some more stuff here...\n"</span><span class="p">)</span><span class="w">
</span><span class="n">sink</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>The contents of the output file:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>x has 10 elements:
 [1] 10.585529 10.709466  9.890697  9.546503 10.605887  8.182044 10.630099  9.723816
 [9]  9.715840  9.080678
y = 10.88375 12.81731 11.37063 11.52022 10.24947 11.8169 10.11364 10.66842 12.12071 11.29872 
=============================
T-test between x and y
=============================

Welch Two Sample t-test

data:  x and y
t = -3.8326, df = 17.979, p-value = 0.001222
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -2.196802 -0.641042
sample estimates:
mean of x mean of y 
 9.867056 11.285978 

Some more stuff here...
</code></pre>
</div>

</article>
<h2 class="post-title" id="topic-22">Sorting</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>
<p>You want to sort a vector, matrix, or data frame.</p>

<h3 id="solution">Solution</h3>

<h3 id="vectors">Vectors</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make up a randomly ordered vector
</span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">101</span><span class="o">:</span><span class="m">110</span><span class="p">)</span><span class="w">

</span><span class="c1"># Sort the vector
</span><span class="n">sort</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] 101 102 103 104 105 106 107 108 109 110
</span><span class="w">
</span><span class="c1"># Reverse sort
</span><span class="n">sort</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] 110 109 108 107 106 105 104 103 102 101
</span></code></pre>
</div>

<h3 id="data-frames">Data frames</h3>
<p>To sort a data frame on one or more columns, you can use the <code class="highlighter-rouge">arrange</code> function from <code class="highlighter-rouge">plyr</code> package, or use R’s built-in functions. The <code class="highlighter-rouge">arrange</code> function is much easier to use, but does require the external package to be installed.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make a data frame
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w">
      </span><span class="n">weight</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="m">27</span><span class="p">,</span><span class="m">24</span><span class="p">,</span><span class="m">22</span><span class="p">),</span><span class="w">
      </span><span class="n">size</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># Sort by weight column. These have the same result.
</span><span class="n">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="p">)</span><span class="w">       </span><span class="c1"># Use arrange from plyr package
</span><span class="n">df</span><span class="p">[</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">weight</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">   </span><span class="c1"># Use built-in R functions
#&gt;   id weight   size
#&gt; 1  1     20  small
#&gt; 2  4     22  large
#&gt; 3  3     24 medium
#&gt; 4  2     27  large
</span><span class="w">

</span><span class="c1"># Sort by size, then by weight
</span><span class="n">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="p">)</span><span class="w">         </span><span class="c1"># Use arrange from plyr package
</span><span class="n">df</span><span class="p">[</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">weight</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># Use built-in R functions
#&gt;   id weight   size
#&gt; 4  4     22  large
#&gt; 2  2     27  large
#&gt; 3  3     24 medium
#&gt; 1  1     20  small
</span><span class="w">

</span><span class="c1"># Sort by all columns in the data frame, from left to right
</span><span class="n">df</span><span class="p">[</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">as.list</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span><span class="w"> </span><span class="p">]</span><span class="w"> 
</span><span class="c1"># In this particular example, the order will be unchanged
</span></code></pre>
</div>

<p>Note that the <code class="highlighter-rouge">size</code> column is a factor and is sorted by the order of the factor levels. In this case, the levels were automatically assigned alphabetically (when creating the data frame), so <strong>large</strong> is first and <strong>small</strong> is last.</p>

<h4 id="reverse-sort">Reverse sort</h4>

<p>The overall order of the sort can be reversed with the argument <code class="highlighter-rouge">decreasing=TRUE</code>.</p>

<p>To reverse the direction of a particular column, the method depends on the data type:</p>

<ul>
<li>Numbers: put a <code class="highlighter-rouge">-</code> in front of the variable name, e.g. <code class="highlighter-rouge">df[ order(-df$weight), ]</code>.</li>
<li>Factors: convert to integer and put a <code class="highlighter-rouge">-</code> in front of the variable name, e.g. <code class="highlighter-rouge">df[ order(-xtfrm(df$size)), ]</code>.</li>
<li>Characters: there isn’t a simple way to do this. One method is to convert to a factor first and then sort as above.</li>
</ul>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Reverse sort by weight column. These all have the same effect:
</span><span class="n">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">weight</span><span class="p">)</span><span class="w">                      </span><span class="c1"># Use arrange from plyr package
</span><span class="n">df</span><span class="p">[</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">weight</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># Use built-in R functions
</span><span class="n">df</span><span class="p">[</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="n">df</span><span class="o">$</span><span class="n">weight</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">                  </span><span class="c1"># Use built-in R functions
#&gt;   id weight   size
#&gt; 2  2     27  large
#&gt; 3  3     24 medium
#&gt; 4  4     22  large
#&gt; 1  1     20  small
</span><span class="w">

</span><span class="c1"># Sort by size (increasing), then by weight (decreasing)
</span><span class="n">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">weight</span><span class="p">)</span><span class="w">         </span><span class="c1"># Use arrange from plyr package
</span><span class="n">df</span><span class="p">[</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">df</span><span class="o">$</span><span class="n">weight</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># Use built-in R functions
#&gt;   id weight   size
#&gt; 2  2     27  large
#&gt; 4  4     22  large
#&gt; 3  3     24 medium
#&gt; 1  1     20  small
</span><span class="w">

</span><span class="c1"># Sort by size (decreasing), then by weight (increasing)
# The call to xtfrm() is needed for factors
</span><span class="n">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nf">xtfrm</span><span class="p">(</span><span class="n">size</span><span class="p">),</span><span class="w"> </span><span class="n">weight</span><span class="p">)</span><span class="w">         </span><span class="c1"># Use arrange from plyr package
</span><span class="n">df</span><span class="p">[</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="nf">xtfrm</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">size</span><span class="p">),</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">weight</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># Use built-in R functions
#&gt;   id weight   size
#&gt; 1  1     20  small
#&gt; 3  3     24 medium
#&gt; 4  4     22  large
#&gt; 2  2     27  large
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-23">Randomizing order</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to randomize the order of a data structure.</p>

<h3 id="solution">Solution</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create a vector
</span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">11</span><span class="o">:</span><span class="m">20</span><span class="w">

</span><span class="c1"># Randomize the order of the vector
</span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create a data frame
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="nb">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="n">number</span><span class="o">=</span><span class="m">11</span><span class="o">:</span><span class="m">15</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;   label number
#&gt; 1     a     11
#&gt; 2     b     12
#&gt; 3     c     13
#&gt; 4     d     14
#&gt; 5     e     15
</span><span class="w">
</span><span class="c1"># Randomize the order of the data frame
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;   label number
#&gt; 5     e     15
#&gt; 2     b     12
#&gt; 4     d     14
#&gt; 3     c     13
#&gt; 1     a     11
</span></code></pre>
</div>

<h3 id="notes">Notes</h3>
<p>To make a randomization repeatable, you should set the seed for the random number generator.

</article>
<h2 class="post-title" id="topic-24">Converting between vector types</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to convert between numeric vectors, character vectors, and factors.</p>

<h3 id="solution">Solution</h3>

<p>Suppose you start with this numeric vector <code class="highlighter-rouge">n</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="o">:</span><span class="m">14</span><span class="w">
</span><span class="n">n</span><span class="w">
</span><span class="c1">#&gt; [1] 10 11 12 13 14
</span></code></pre>
</div>

<p>To convert the numeric vector to the other two types (we’ll also save these results in <code class="highlighter-rouge">c</code> and  <code class="highlighter-rouge">f</code>):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Numeric to Character
</span><span class="n">c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">

</span><span class="c1"># Numeric to Factor
</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="c1"># 10 11 12 13 14
</span></code></pre>
</div>

<p>To convert the character vector to the other two:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Character to Numeric
</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 10 11 12 13 14
</span><span class="w">
</span><span class="c1"># Character to Factor
</span><span class="n">factor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 10 11 12 13 14
#&gt; Levels: 10 11 12 13 14
</span></code></pre>
</div>

<p>Converting a factor to a character vector is straightforward:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Factor to Character
</span><span class="nf">as.character</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "10" "11" "12" "13" "14"
</span></code></pre>
</div>

<p>However, converting a factor to a numeric vector is a little trickier. If you just convert it with <code class="highlighter-rouge">as.numeric</code>, it will give you the numeric coding of the factor, which probably isn’t what you want.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">as.numeric</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 1 2 3 4 5
</span><span class="w">
</span><span class="c1"># Another way to get the numeric coding, if that's what you want:
</span><span class="nf">unclass</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 1 2 3 4 5
#&gt; attr(,"levels")
#&gt; [1] "10" "11" "12" "13" "14"
</span></code></pre>
</div>

<p>The way to get the text values converted to numbers is to first convert it to a character, then a numeric vector.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Factor to Numeric
</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] 10 11 12 13 14
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-25">Finding and removing duplicate records</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to find and/or remove duplicate entries from a vector or data frame.</p>

<h3 id="solution">Solution</h3>

<p>With vectors:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Generate a vector 
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">158</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt;  [1] 14 11  8  4 12  5 10 10  3  3 11  6  0 16  8 10  8  5  6  6
</span><span class="w">
</span><span class="c1"># For each element: is this one a duplicate (first instance of a particular value
# not counted)
</span><span class="n">duplicated</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE  TRUE FALSE FALSE FALSE
#&gt; [15]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
</span><span class="w">
</span><span class="c1"># The values of the duplicated entries
# Note that '6' appears in the original vector three times, and so it has two
# entries here.
</span><span class="n">x</span><span class="p">[</span><span class="n">duplicated</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt; [1] 10  3 11  8 10  8  5  6  6
</span><span class="w">
</span><span class="c1"># Duplicated entries, without repeats
</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">duplicated</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span><span class="w">
</span><span class="c1">#&gt; [1] 10  3 11  8  5  6
</span><span class="w">
</span><span class="c1"># The original vector with all duplicates removed. These do the same:
</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] 14 11  8  4 12  5 10  3  6  0 16
</span><span class="n">x</span><span class="p">[</span><span class="o">!</span><span class="n">duplicated</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt;  [1] 14 11  8  4 12  5 10  3  6  0 16
</span></code></pre>
</div>

<p>With data frames:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A sample data frame:
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 label value
 A     4
 B     3
 C     6
 B     3
 B     1
 A     2
 A     4
 A     4
'</span><span class="p">)</span><span class="w">


</span><span class="c1"># Is each row a repeat?
</span><span class="n">duplicated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] FALSE FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE
</span><span class="w">
</span><span class="c1"># Show the repeat entries
</span><span class="n">df</span><span class="p">[</span><span class="n">duplicated</span><span class="p">(</span><span class="n">df</span><span class="p">),]</span><span class="w">
</span><span class="c1">#&gt;   label value
#&gt; 4     B     3
#&gt; 7     A     4
#&gt; 8     A     4
</span><span class="w">
</span><span class="c1"># Show unique repeat entries (row names may differ, but values are the same)
</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">duplicated</span><span class="p">(</span><span class="n">df</span><span class="p">),])</span><span class="w">
</span><span class="c1">#&gt;   label value
#&gt; 4     B     3
#&gt; 7     A     4
</span><span class="w">
</span><span class="c1"># Original data with repeats removed. These do the same:
</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   label value
#&gt; 1     A     4
#&gt; 2     B     3
#&gt; 3     C     6
#&gt; 5     B     1
#&gt; 6     A     2
</span><span class="n">df</span><span class="p">[</span><span class="o">!</span><span class="n">duplicated</span><span class="p">(</span><span class="n">df</span><span class="p">),]</span><span class="w">
</span><span class="c1">#&gt;   label value
#&gt; 1     A     4
#&gt; 2     B     3
#&gt; 3     C     6
#&gt; 5     B     1
#&gt; 6     A     2
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-26">Comparing vectors or factors with NA</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to compare two vectors or factors but want comparisons with <code class="highlighter-rouge">NA</code>’s to be reported as <code class="highlighter-rouge">TRUE</code> or <code class="highlighter-rouge">FALSE</code> (instead of <code class="highlighter-rouge">NA</code>).</p>

<h3 id="solution">Solution</h3>

<p>Suppose you have this data frame with two columns which consist of boolean vectors:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">),</span><span class="w">
            </span><span class="n">b</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">NA</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w">
</span><span class="c1">#&gt;       a     b
#&gt; 1  TRUE  TRUE
#&gt; 2  TRUE FALSE
#&gt; 3  TRUE    NA
#&gt; 4 FALSE  TRUE
#&gt; 5 FALSE FALSE
#&gt; 6 FALSE    NA
#&gt; 7    NA  TRUE
#&gt; 8    NA FALSE
#&gt; 9    NA    NA
</span></code></pre>
</div>

<p>Normally, when you compare two vectors or factors containing <code class="highlighter-rouge">NA</code> values, the vector of results will have <code class="highlighter-rouge">NA</code>s where either of the original items was <code class="highlighter-rouge">NA</code>. Depending on your purposes, this may or not be desirable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">df</span><span class="o">$</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">b</span><span class="w">
</span><span class="c1">#&gt; [1]  TRUE FALSE    NA FALSE  TRUE    NA    NA    NA    NA
</span><span class="w">
</span><span class="c1"># The same comparison, but presented as another column in the data frame:
</span><span class="n">data.frame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">isSame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">a</span><span class="o">==</span><span class="n">df</span><span class="o">$</span><span class="n">b</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;       a     b isSame
#&gt; 1  TRUE  TRUE   TRUE
#&gt; 2  TRUE FALSE  FALSE
#&gt; 3  TRUE    NA     NA
#&gt; 4 FALSE  TRUE  FALSE
#&gt; 5 FALSE FALSE   TRUE
#&gt; 6 FALSE    NA     NA
#&gt; 7    NA  TRUE     NA
#&gt; 8    NA FALSE     NA
#&gt; 9    NA    NA     NA
</span></code></pre>
</div>

<h3 id="a-function-for-comparing-with-nas">A function for comparing with NA’s</h3>

<p>This comparison function will essentially treat NA’s as just another value. If an item in both vectors is NA, then it reports TRUE for that item; if the item is NA in just one vector, it reports FALSE; all other comparisons (between non-NA items) behaves the same.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># This function returns TRUE wherever elements are the same, including NA's,
# and FALSE everywhere else.
</span><span class="n">compareNA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">v</span><span class="m">1</span><span class="p">,</span><span class="n">v</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">same</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="m">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">v</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">v</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">v</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">same</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">same</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="nf">return</span><span class="p">(</span><span class="n">same</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="examples-of-the-function-in-use">Examples of the function in use</h3>

<p>Comparing boolean vectors:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">compareNA</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">b</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1]  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE
</span><span class="w">
</span><span class="c1"># Same comparison, presented as another column
</span><span class="n">data.frame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">isSame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compareNA</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">a</span><span class="p">,</span><span class="n">df</span><span class="o">$</span><span class="n">b</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;       a     b isSame
#&gt; 1  TRUE  TRUE   TRUE
#&gt; 2  TRUE FALSE  FALSE
#&gt; 3  TRUE    NA  FALSE
#&gt; 4 FALSE  TRUE  FALSE
#&gt; 5 FALSE FALSE   TRUE
#&gt; 6 FALSE    NA  FALSE
#&gt; 7    NA  TRUE  FALSE
#&gt; 8    NA FALSE  FALSE
#&gt; 9    NA    NA   TRUE
</span></code></pre>
</div>

<p>It also works with factors, even if the levels of the factors are in different orders:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create sample data frame with factors.
</span><span class="n">df1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)),</span><span class="w">
            </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)))</span><span class="w">

</span><span class="c1"># Do the comparison
</span><span class="n">data.frame</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="w"> </span><span class="n">isSame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compareNA</span><span class="p">(</span><span class="n">df1</span><span class="o">$</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">df1</span><span class="o">$</span><span class="n">b</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;      a    b isSame
#&gt; 1    x    x   TRUE
#&gt; 2    x    y  FALSE
#&gt; 3    x &lt;NA&gt;  FALSE
#&gt; 4    y    x  FALSE
#&gt; 5    y    y   TRUE
#&gt; 6    y &lt;NA&gt;  FALSE
#&gt; 7 &lt;NA&gt;    x  FALSE
#&gt; 8 &lt;NA&gt;    y  FALSE
#&gt; 9 &lt;NA&gt; &lt;NA&gt;   TRUE
</span><span class="w">

</span><span class="c1"># It still works if the factor levels are arranged in a different order
</span><span class="n">df1</span><span class="o">$</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">df1</span><span class="o">$</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,</span><span class="s1">'x'</span><span class="p">))</span><span class="w">
</span><span class="n">data.frame</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="w"> </span><span class="n">isSame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compareNA</span><span class="p">(</span><span class="n">df1</span><span class="o">$</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">df1</span><span class="o">$</span><span class="n">b</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;      a    b isSame
#&gt; 1    x    x   TRUE
#&gt; 2    x    y  FALSE
#&gt; 3    x &lt;NA&gt;  FALSE
#&gt; 4    y    x  FALSE
#&gt; 5    y    y   TRUE
#&gt; 6    y &lt;NA&gt;  FALSE
#&gt; 7 &lt;NA&gt;    x  FALSE
#&gt; 8 &lt;NA&gt;    y  FALSE
#&gt; 9 &lt;NA&gt; &lt;NA&gt;   TRUE
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-27">Recoding data</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to recode data or calculate new data columns from existing ones.</p>

<h3 id="solution">Solution</h3>

<p>The examples below will use this data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject sex control cond1 cond2
 1   M     7.9  12.3  10.7
 2   F     6.3  10.6  11.1
 3   F     9.5  13.1  13.8
 4   M    11.5  13.4  12.9
'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="recoding-a-categorical-variable">Recoding a categorical variable</h3>

<p>The easiest way is to use <code class="highlighter-rouge">revalue()</code> or <code class="highlighter-rouge">mapvalues()</code> from the plyr package.
This will code <code class="highlighter-rouge">M</code> as <code class="highlighter-rouge">1</code> and <code class="highlighter-rouge">F</code> as <code class="highlighter-rouge">2</code>, and put it in a new column.
Note that these functions preserves the type: if the input is a factor, the output will be a factor; and if the input is a character vector, the output will be a character vector.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># The following two lines are equivalent:
</span><span class="n">data</span><span class="o">$</span><span class="n">scode</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">revalue</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"M"</span><span class="o">=</span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"F"</span><span class="o">=</span><span class="s2">"2"</span><span class="p">))</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">scode</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mapvalues</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="s2">"F"</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">))</span><span class="w">
</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;   subject sex control cond1 cond2 scode
#&gt; 1       1   M     7.9  12.3  10.7     1
#&gt; 2       2   F     6.3  10.6  11.1     2
#&gt; 3       3   F     9.5  13.1  13.8     2
#&gt; 4       4   M    11.5  13.4  12.9     1
</span><span class="w">
</span><span class="c1"># data$sex is a factor, so data$scode is also a factor
</span></code></pre>
</div>

<p>See <a href="../Mapping_vector_values">../Mapping vector values</a> and <a href="../Renaming_levels_of_a_factor">../Renaming levels of a factor</a> for more information about these functions.</p>

<p>If you don’t want to rely on plyr, you can do the following with R’s built-in functions:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">$</span><span class="n">scode</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">sex</span><span class="o">==</span><span class="s2">"M"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">scode</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">sex</span><span class="o">==</span><span class="s2">"F"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"2"</span><span class="w">

</span><span class="c1"># Convert the column to a factor
</span><span class="n">data</span><span class="o">$</span><span class="n">scode</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">scode</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;   subject sex control cond1 cond2 scode
#&gt; 1       1   M     7.9  12.3  10.7     1
#&gt; 2       2   F     6.3  10.6  11.1     2
#&gt; 3       3   F     9.5  13.1  13.8     2
#&gt; 4       4   M    11.5  13.4  12.9     1
</span></code></pre>
</div>

<p>Another way to do it is to use the <code class="highlighter-rouge">match</code> function:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">oldvalues</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="s2">"F"</span><span class="p">)</span><span class="w">
</span><span class="n">newvalues</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"g1"</span><span class="p">,</span><span class="s2">"g2"</span><span class="p">))</span><span class="w">  </span><span class="c1"># Make this a factor
</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">scode</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">newvalues</span><span class="p">[</span><span class="w"> </span><span class="n">match</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">oldvalues</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;   subject sex control cond1 cond2 scode
#&gt; 1       1   M     7.9  12.3  10.7    g1
#&gt; 2       2   F     6.3  10.6  11.1    g2
#&gt; 3       3   F     9.5  13.1  13.8    g2
#&gt; 4       4   M    11.5  13.4  12.9    g1
</span></code></pre>
</div>

<h3 id="recoding-a-continuous-variable-into-categorical-variable">Recoding a continuous variable into categorical variable</h3>

<p>Mark those whose control measurement is &lt;7 as “low”, and those with &gt;=7 as “high”:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">$</span><span class="n">category</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">control</span><span class="o">&lt;</span><span class="w"> </span><span class="m">7</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"low"</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">category</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">control</span><span class="o">&gt;=</span><span class="m">7</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"high"</span><span class="w">

</span><span class="c1"># Convert the column to a factor
</span><span class="n">data</span><span class="o">$</span><span class="n">category</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">category</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;   subject sex control cond1 cond2 scode category
#&gt; 1       1   M     7.9  12.3  10.7    g1     high
#&gt; 2       2   F     6.3  10.6  11.1    g2      low
#&gt; 3       3   F     9.5  13.1  13.8    g2     high
#&gt; 4       4   M    11.5  13.4  12.9    g1     high
</span></code></pre>
</div>

<p>With the <code class="highlighter-rouge">cut</code> function, you specify boundaries and the resulting values:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">$</span><span class="n">category</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">control</span><span class="p">,</span><span class="w">
               </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="kc">Inf</span><span class="p">),</span><span class="w">
               </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"low"</span><span class="p">,</span><span class="s2">"medium"</span><span class="p">,</span><span class="s2">"high"</span><span class="p">))</span><span class="w">
</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;   subject sex control cond1 cond2 scode category
#&gt; 1       1   M     7.9  12.3  10.7    g1   medium
#&gt; 2       2   F     6.3  10.6  11.1    g2      low
#&gt; 3       3   F     9.5  13.1  13.8    g2     high
#&gt; 4       4   M    11.5  13.4  12.9    g1     high
</span></code></pre>
</div>

<p>By default, the ranges are open on the left, and closed on the right, as in (7,9]. To set it so that ranges are closed on the left and open on the right, like [7,9), use <code class="highlighter-rouge">right=FALSE</code>.</p>

<h3 id="calculating-a-new-continuous-variable">Calculating a new continuous variable</h3>

<p>Suppose you want to add a new column with the sum of the three measurements.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">$</span><span class="n">total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">control</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">cond1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">cond2</span><span class="w">
</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;   subject sex control cond1 cond2 scode category total
#&gt; 1       1   M     7.9  12.3  10.7    g1   medium  30.9
#&gt; 2       2   F     6.3  10.6  11.1    g2      low  28.0
#&gt; 3       3   F     9.5  13.1  13.8    g2     high  36.4
#&gt; 4       4   M    11.5  13.4  12.9    g1     high  37.8
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-28">Mapping vector values</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to change all instances of value <code class="highlighter-rouge">x</code> to value <code class="highlighter-rouge">y</code> in a vector.</p>

<h3 id="solution">Solution</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create some example data
</span><span class="n">str</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="w"> </span><span class="s2">"beta"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gamma"</span><span class="p">)</span><span class="w">
</span><span class="n">num</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>The easiest way is to use <code class="highlighter-rouge">revalue()</code> or <code class="highlighter-rouge">mapvalues()</code> from the plyr package:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">revalue</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"beta"</span><span class="o">=</span><span class="s2">"two"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gamma"</span><span class="o">=</span><span class="s2">"three"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] "alpha" "two"   "three"
</span><span class="w">
</span><span class="n">mapvalues</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"beta"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gamma"</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"two"</span><span class="p">,</span><span class="w"> </span><span class="s2">"three"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] "alpha" "two"   "three"
</span><span class="w">

</span><span class="c1"># For numeric vectors, revalue() won't work, since it uses a named vector, and
# the names are always strings, not numbers. mapvalues() will work, though:
</span><span class="n">mapvalues</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] 1 5 6
</span></code></pre>
</div>

<p>If you don’t want to rely on plyr, you can do the following with R’s built-in functions.
Note that these methods will modify the vectors directly; that is, you don’t have to save the result back into the variable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Rename by name: change "beta" to "two"
</span><span class="n">str</span><span class="p">[</span><span class="n">str</span><span class="o">==</span><span class="s2">"beta"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"two"</span><span class="w">
</span><span class="n">str</span><span class="w">
</span><span class="c1">#&gt; [1] "alpha" "two"   "gamma"
</span><span class="w">
</span><span class="n">num</span><span class="p">[</span><span class="n">num</span><span class="o">==</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="n">num</span><span class="w">
</span><span class="c1">#&gt; [1] 1 5 3
</span></code></pre>
</div>

<p>It’s also possible to use R’s string search-and-replace functions to remap values in character vectors.
Note that the <code class="highlighter-rouge">^</code> and <code class="highlighter-rouge">$</code> surrounding <code class="highlighter-rouge">alpha</code> are there to ensure that the entire string matches.
Without them, if there were a value named <code class="highlighter-rouge">alphabet</code>, it would also match, and the replacement would be <code class="highlighter-rouge">onebet</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">str</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="w"> </span><span class="s2">"beta"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gamma"</span><span class="p">)</span><span class="w">

</span><span class="n">sub</span><span class="p">(</span><span class="s2">"^alpha$"</span><span class="p">,</span><span class="w"> </span><span class="s2">"one"</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "one"   "beta"  "gamma"
</span><span class="w">
</span><span class="c1"># Across all columns, replace all instances of "a" with "X"
</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"X"</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "XlphX" "betX"  "gXmmX"
</span><span class="w">

</span><span class="c1"># gsub() replaces all instances of the pattern in each element
# sub() replaces only the first instance in each element
</span></code></pre>
</div>

<h2 id="topic-29">See also</h2>

<p>Changing the name of factor levels works much the same. See <a href="../Renaming_levels_of_a_factor">../Renaming levels of a factor</a> for more information.</p>

</article>
<h2 class="post-title" id="topic-30">Renaming levels of a factor</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to rename the levels in a factor.</p>

<h3 id="solution">Solution</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A sample factor to work with.
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">,</span><span class="s2">"gamma"</span><span class="p">,</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] alpha beta  gamma alpha beta 
#&gt; Levels: alpha beta gamma
</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "alpha" "beta"  "gamma"
</span></code></pre>
</div>

<p>The easiest way is to use <code class="highlighter-rouge">revalue()</code> or <code class="highlighter-rouge">mapvalues()</code> from the plyr package:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">revalue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"beta"</span><span class="o">=</span><span class="s2">"two"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gamma"</span><span class="o">=</span><span class="s2">"three"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] alpha two   three alpha two  
#&gt; Levels: alpha two three
</span><span class="w">
</span><span class="n">mapvalues</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"beta"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gamma"</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"two"</span><span class="p">,</span><span class="w"> </span><span class="s2">"three"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] alpha two   three alpha two  
#&gt; Levels: alpha two three
</span></code></pre>
</div>

<p>If you don’t want to rely on plyr, you can do the following with R’s built-in functions.
Note that these methods will modify <code class="highlighter-rouge">x</code> directly; that is, you don’t have to save the result back into <code class="highlighter-rouge">x</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Rename by name: change "beta" to "two"
</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="s2">"beta"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"two"</span><span class="w">


</span><span class="c1"># You can also rename by position, but this is a bit dangerous if your data
# can change in the future. If there is a change in the number or positions of
# factor levels, then this can result in wrong data.
</span><span class="w">
</span><span class="c1"># Rename by index in levels list: change third item, "gamma", to "three".
</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"three"</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] alpha two   three alpha two  
#&gt; Levels: alpha two three
</span><span class="w">
</span><span class="c1"># Rename all levels
</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"one"</span><span class="p">,</span><span class="s2">"two"</span><span class="p">,</span><span class="s2">"three"</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] one   two   three one   two  
#&gt; Levels: one two three
</span></code></pre>
</div>

<p>It’s possible to rename factor levels by name (without plyr), but keep in mind that this works only if ALL levels are present in the list; if any are not in the list, they will be replaced with <code class="highlighter-rouge">NA</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Rename all levels, by name
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">,</span><span class="s2">"gamma"</span><span class="p">,</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">))</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="s2">"alpha"</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">=</span><span class="s2">"beta"</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">=</span><span class="s2">"gamma"</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] A B C A B
#&gt; Levels: A B C
</span></code></pre>
</div>

<p>It’s also possible to use R’s string search-and-replace functions to rename factor levels. Note that the <code class="highlighter-rouge">^</code> and <code class="highlighter-rouge">$</code> surrounding <code class="highlighter-rouge">alpha</code> are there to ensure that the entire string matches. Without them, if there were a level named <code class="highlighter-rouge">alphabet</code>, it would also match, and the replacement would be <code class="highlighter-rouge">onebet</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A sample factor to work with.
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">,</span><span class="s2">"gamma"</span><span class="p">,</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] alpha beta  gamma alpha beta 
#&gt; Levels: alpha beta gamma
</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="s2">"^alpha$"</span><span class="p">,</span><span class="w"> </span><span class="s2">"one"</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] one   beta  gamma one   beta 
#&gt; Levels: one beta gamma
</span><span class="w">

</span><span class="c1"># Across all columns, replace all instances of "a" with "X"
</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"X"</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] one   betX  gXmmX one   betX 
#&gt; Levels: one betX gXmmX
</span><span class="w">
</span><span class="c1"># gsub() replaces all instances of the pattern in each factor level.
# sub() replaces only the first instance in each factor level.
</span></code></pre>
</div>

<h2 id="topic-31">See also</h2>

<p>Mapping values in a vector to new values works much the same. See <a href="../Mapping_vector_values">../Mapping vector values</a> for more information.</p>

</article>
<h2 class="post-title" id="topic-32">Re-computing the levels of factor</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to do re-compute the levels of a factor. This is useful when a factor contains levels that aren’t actually present in the data. This can happen during data import, or when you remove some rows.</p>

<h3 id="solution">Solution</h3>

<p>For a single factor object:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create a factor with an extra level (gamma)
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">,</span><span class="s2">"alpha"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">,</span><span class="s2">"gamma"</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] alpha beta  alpha
#&gt; Levels: alpha beta gamma
</span><span class="w">
</span><span class="c1"># Remove the extra level
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] alpha beta  alpha
#&gt; Levels: alpha beta
</span></code></pre>
</div>

<p>After importing data, you may have a data frame with a mix of factors and other kinds vectors, and want to re-compute the levels of all the factors. You can use the <code class="highlighter-rouge">droplevels()</code> function to do this.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create a data frame with some factors (with extra levels)
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">,</span><span class="s2">"alpha"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"alpha"</span><span class="p">,</span><span class="s2">"beta"</span><span class="p">,</span><span class="s2">"gamma"</span><span class="p">)),</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w">
</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Display the factors (with extra levels)
</span><span class="n">df</span><span class="o">$</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] alpha beta  alpha
#&gt; Levels: alpha beta gamma
</span><span class="n">df</span><span class="o">$</span><span class="n">z</span><span class="w">
</span><span class="c1">#&gt; [1] red   green green
#&gt; Levels: red green blue
</span><span class="w">

</span><span class="c1"># Drop the extra levels
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">droplevels</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">

</span><span class="c1"># Show the factors again, now without extra levels
</span><span class="n">df</span><span class="o">$</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt; [1] alpha beta  alpha
#&gt; Levels: alpha beta
</span><span class="n">df</span><span class="o">$</span><span class="n">z</span><span class="w">
</span><span class="c1">#&gt; [1] red   green green
#&gt; Levels: red green
</span></code></pre>
</div>

<h2 id="topic-33">See also</h2>

<p>To re-compute the levels of all the factor columns in a data frame, see <a href="../Re-computing_the_levels_of_all_factor_columns_in_a_data_frame">../Re-computing_the_levels_of_all_factor_columns_in_a_data_frame</a>.</p>

</article>
<h2 class="post-title" id="topic-34">Changing the order of levels of a factor</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>
<p>You want to change the order in which the levels of a factor appear.</p>

<h3 id="solution">Solution</h3>

<p>Factors in R come in two varieties: <strong>ordered</strong> and <strong>unordered</strong>, e.g., {small, medium, large} and {pen, brush, pencil}. For most analyses, it will not matter whether a factor is ordered or unordered. If the factor is <strong>ordered</strong>, then the specific order of the levels matters (small &lt; medium &lt; large). If the factor is <strong>unordered</strong>, then the levels will still appear in some order, but the specific order of the levels matters only for convenience (pen,  pencil, brush) – it will determine, for example, how output will be printed, or the arrangement of items on a graph.</p>

<p>One way to change the level order is to use <code class="highlighter-rouge">factor()</code> on the factor and specify the order directly. In this example, the function <code class="highlighter-rouge">ordered()</code> could be used instead of <code class="highlighter-rouge">factor()</code>.</p>

<p>Here’s the sample data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create a factor with the wrong order of levels
</span><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">))</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: large medium small
</span></code></pre>
</div>

<p>The levels can be specified explicitly:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">))</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: small medium large
</span></code></pre>
</div>

<p>We can do the same with an ordered factor:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ordered</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">))</span><span class="w">
</span><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ordered</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">))</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: small &lt; medium &lt; large
</span></code></pre>
</div>

<p>Another way to change the order is to use <code class="highlighter-rouge">relevel()</code> to make a particular level first in the list. (This will not work for ordered factors.)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create a factor with the wrong order of levels
</span><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">))</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: large medium small
</span><span class="w">
</span><span class="c1"># Make medium first
</span><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">relevel</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">)</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: medium large small
</span><span class="w">
</span><span class="c1"># Make small first
</span><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">relevel</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">)</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: small medium large
</span></code></pre>
</div>

<p>You can also specify the proper order when the factor is created.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">),</span><span class="w">
          </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">))</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: small medium large
</span></code></pre>
</div>

<p>To <strong>reverse</strong> the order of levels in a factor:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create a factor with the wrong order of levels
</span><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">))</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: large medium small
</span><span class="w">
</span><span class="n">sizes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">sizes</span><span class="p">)))</span><span class="w">
</span><span class="n">sizes</span><span class="w">
</span><span class="c1">#&gt; [1] small  large  large  small  medium
#&gt; Levels: small medium large
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-35">Renaming columns in a data frame</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>
<p>You want to rename the columns in a data frame.</p>

<h3 id="solution">Solution</h3>
<p>Start with a sample data frame with three columns:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="o">=</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">gamma</span><span class="o">=</span><span class="m">7</span><span class="o">:</span><span class="m">9</span><span class="p">)</span><span class="w">
</span><span class="n">d</span><span class="w">
</span><span class="c1">#&gt;   alpha beta gamma
#&gt; 1     1    4     7
#&gt; 2     2    5     8
#&gt; 3     3    6     9
</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w">  
</span><span class="c1">#&gt; [1] "alpha" "beta"  "gamma"
</span></code></pre>
</div>

<p>The simplest way is to use <code class="highlighter-rouge">rename()</code> from the plyr package:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">rename</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"beta"</span><span class="o">=</span><span class="s2">"two"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gamma"</span><span class="o">=</span><span class="s2">"three"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;   alpha two three
#&gt; 1     1   4     7
#&gt; 2     2   5     8
#&gt; 3     3   6     9
</span></code></pre>
</div>

<p>If you don’t want to rely on plyr, you can do the following with R’s built-in functions. Note that these modify <code class="highlighter-rouge">d</code> directly; that is, you don’t have to save the result back into <code class="highlighter-rouge">d</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Rename column by name: change "beta" to "two"
</span><span class="nf">names</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">==</span><span class="s2">"beta"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"two"</span><span class="w">
</span><span class="n">d</span><span class="w">
</span><span class="c1">#&gt;   alpha two gamma
#&gt; 1     1   4     7
#&gt; 2     2   5     8
#&gt; 3     3   6     9
</span><span class="w">
</span><span class="c1"># You can also rename by position, but this is a bit dangerous if your data
# can change in the future. If there is a change in the number or positions of
# columns, then this can result in wrong data.
</span><span class="w">
</span><span class="c1"># Rename by index in names vector: change third item, "gamma", to "three"
</span><span class="nf">names</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"three"</span><span class="w">
</span><span class="n">d</span><span class="w">
</span><span class="c1">#&gt;   alpha two three
#&gt; 1     1   4     7
#&gt; 2     2   5     8
#&gt; 3     3   6     9
</span></code></pre>
</div>

<p>It’s also possible to use R’s string search-and-replace functions to rename columns. Note that the <code class="highlighter-rouge">^</code> and <code class="highlighter-rouge">$</code> surrounding <code class="highlighter-rouge">alpha</code> are there to ensure that the entire string matches. Without them, if there were a column named <code class="highlighter-rouge">alphabet</code>, it would also match, and the replacement would be <code class="highlighter-rouge">onebet</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="s2">"^alpha$"</span><span class="p">,</span><span class="w"> </span><span class="s2">"one"</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="w">
</span><span class="n">d</span><span class="w">
</span><span class="c1">#&gt;   one two three
#&gt; 1   1   4     7
#&gt; 2   2   5     8
#&gt; 3   3   6     9
</span><span class="w">
</span><span class="c1"># Across all columns, replace all instances of "t" with "X"
</span><span class="nf">names</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"t"</span><span class="p">,</span><span class="w"> </span><span class="s2">"X"</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="w">
</span><span class="n">d</span><span class="w">
</span><span class="c1">#&gt;   one Xwo Xhree
#&gt; 1   1   4     7
#&gt; 2   2   5     8
#&gt; 3   3   6     9
</span><span class="w">
</span><span class="c1"># gsub() replaces all instances of the pattern in each column name.
# sub() replaces only the first instance in each column name.
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-36">Adding and removing columns from a data frame</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to add or remove columns from a data frame.</p>

<h3 id="solution">Solution</h3>

<p>There are many different ways of adding and removing columns from a data frame.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 id weight
1     20
2     27
3     24
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Ways to add a column
</span><span class="n">data</span><span class="o">$</span><span class="n">size</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">[[</span><span class="s2">"size"</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">[,</span><span class="s2">"size"</span><span class="p">]</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"small"</span><span class="p">,</span><span class="w"> </span><span class="s2">"large"</span><span class="p">,</span><span class="w"> </span><span class="s2">"medium"</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">size</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">   </span><span class="c1"># Use the same value (0) for all rows
</span><span class="w">

</span><span class="c1"># Ways to remove the column
</span><span class="n">data</span><span class="o">$</span><span class="n">size</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">data</span><span class="p">[[</span><span class="s2">"size"</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">data</span><span class="p">[,</span><span class="s2">"size"</span><span class="p">]</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">data</span><span class="p">[[</span><span class="m">3</span><span class="p">]]</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">data</span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="w">       </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">data</span><span class="w">           </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="o">=-</span><span class="n">size</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-37">Reordering the columns in a data frame</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>
<p>You want to do reorder the columns in a data frame.</p>

<h3 id="solution">Solution</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A sample data frame
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
id weight   size
 1     20  small
 2     27  large
 3     24 medium
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Reorder by column number
</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt;   id   size weight
#&gt; 1  1  small     20
#&gt; 2  2  large     27
#&gt; 3  3 medium     24
</span><span class="w">
</span><span class="c1"># To actually change `data`, you need to save it back into `data`:
# data &lt;- data[c(1,3,2)]
</span><span class="w">

</span><span class="c1"># Reorder by column name
</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="s2">"weight"</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt;     size id weight
#&gt; 1  small  1     20
#&gt; 2  large  2     27
#&gt; 3 medium  3     24
</span></code></pre>
</div>

<p>The above examples index into the data frame by treating it as a list (a data frame is essentially a list of vectors). You can also use matrix-style indexing, as in <code class="highlighter-rouge">data[row, col]</code>, where <code class="highlighter-rouge">row</code> is left blank.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">)]</span><span class="w">
</span><span class="c1">#&gt;   id   size weight
#&gt; 1  1  small     20
#&gt; 2  2  large     27
#&gt; 3  3 medium     24
</span></code></pre>
</div>

<p>The drawback to matrix indexing is that it gives different results when you specify just one column. In these cases, the returned object is a <em>vector</em>, not a data frame. Because the returned data type isn’t always consistent with matrix indexing, it’s generally safer to use list-style indexing, or the <code class="highlighter-rouge">drop=FALSE</code> option:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># List-style indexing of one column
</span><span class="n">data</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   weight
#&gt; 1     20
#&gt; 2     27
#&gt; 3     24
</span><span class="w">
</span><span class="c1"># Matrix-style indexing of one column - drops dimension to become a vector
</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] 20 27 24
</span><span class="w">
</span><span class="c1"># Matrix-style indexing with drop=FALSE - preserves dimension to remain data frame
</span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;   weight
#&gt; 1     20
#&gt; 2     27
#&gt; 3     24
</span></code></pre>
</div>


</article>
<h2 class="post-title" id="topic-38">Merging data frames</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>
<p>You want to merge two data frames on a given column from each (like a <strong>join</strong> in SQL).</p>

<h3 id="solution">Solution</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make a data frame mapping story numbers to titles
</span><span class="n">stories</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 storyid  title
1       lions
2      tigers
3       bears
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make another data frame with the data and story numbers (no titles)
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
subject storyid rating
    1       1    6.7
    1       2    4.5
    1       3    3.7
    2       2    3.3
    2       3    4.1
    2       1    5.2
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Merge the two data frames
</span><span class="n">merge</span><span class="p">(</span><span class="n">stories</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s2">"storyid"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   storyid  title subject rating
#&gt; 1       1  lions       1    6.7
#&gt; 2       1  lions       2    5.2
#&gt; 3       2 tigers       1    4.5
#&gt; 4       2 tigers       2    3.3
#&gt; 5       3  bears       1    3.7
#&gt; 6       3  bears       2    4.1
</span></code></pre>
</div>

<p>If the two data frames have different names for the columns you want to match on, the names can be specified:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># In this case, the column is named 'id' instead of storyid
</span><span class="n">stories2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 id       title
1       lions
2      tigers
3       bears
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Merge on stories2$id and data$storyid.
</span><span class="n">merge</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">stories2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">by.x</span><span class="o">=</span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">by.y</span><span class="o">=</span><span class="s2">"storyid"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   id  title subject rating
#&gt; 1  1  lions       1    6.7
#&gt; 2  1  lions       2    5.2
#&gt; 3  2 tigers       1    4.5
#&gt; 4  2 tigers       2    3.3
#&gt; 5  3  bears       1    3.7
#&gt; 6  3  bears       2    4.1
</span><span class="w">
</span><span class="c1"># Note that the column name is inherited from the first data frame (x=stories2).
</span></code></pre>
</div>

<p>It is possible to merge on multiple columns:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make up more data
</span><span class="n">animals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 size type         name
small  cat         lynx
big  cat        tiger
small  dog    chihuahua
big  dog "great dane"
'</span><span class="p">)</span><span class="w">

</span><span class="n">observations</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 number  size type
  1   big  cat
  2 small  dog
  3 small  dog
  4   big  dog
'</span><span class="p">)</span><span class="w">

</span><span class="n">merge</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span><span class="w"> </span><span class="n">animals</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"size"</span><span class="p">,</span><span class="s2">"type"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;    size type number       name
#&gt; 1   big  cat      1      tiger
#&gt; 2   big  dog      4 great dane
#&gt; 3 small  dog      2  chihuahua
#&gt; 4 small  dog      3  chihuahua
</span></code></pre>
</div>

<h3 id="notes">Notes</h3>
<p>After merging, it may be useful to change the order of the columns.
</p>

</article>
<h2 class="post-title" id="topic-39">Comparing data frames</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to do compare two or more data frames and find rows that appear in more than one data frame, or rows that appear only in one data frame.</p>

<h3 id="solution">Solution</h3>

<h3 id="an-example">An example</h3>
<p>Suppose you have the following three data frames, and you want to know whether each row from each data frame appears in at least one of the other data frames.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dfA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Subject</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">Response</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"X"</span><span class="p">,</span><span class="s2">"X"</span><span class="p">,</span><span class="s2">"X"</span><span class="p">,</span><span class="s2">"X"</span><span class="p">))</span><span class="w">
</span><span class="n">dfA</span><span class="w">
</span><span class="c1">#&gt;   Subject Response
#&gt; 1       1        X
#&gt; 2       1        X
#&gt; 3       2        X
#&gt; 4       2        X
</span><span class="w">
</span><span class="n">dfB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Subject</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">Response</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"X"</span><span class="p">,</span><span class="s2">"Y"</span><span class="p">,</span><span class="s2">"X"</span><span class="p">))</span><span class="w">
</span><span class="n">dfB</span><span class="w">
</span><span class="c1">#&gt;   Subject Response
#&gt; 1       1        X
#&gt; 2       2        Y
#&gt; 3       3        X
</span><span class="w">
</span><span class="n">dfC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Subject</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">Response</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Z"</span><span class="p">,</span><span class="s2">"Y"</span><span class="p">,</span><span class="s2">"Z"</span><span class="p">))</span><span class="w">
</span><span class="n">dfC</span><span class="w">
</span><span class="c1">#&gt;   Subject Response
#&gt; 1       1        Z
#&gt; 2       2        Y
#&gt; 3       3        Z
</span></code></pre>
</div>

<p>In dfA, the rows containing (1,X) also appear in dfB, but the rows containing (2,X) do not appear in any of the other data frames.  Similarly, dfB contains (1,X) which appears in dfA, and (2,Y), which appears in dfC, but (3,X) does not appear in any other data frame.</p>

<p>You might wish to mark the rows which are duplicated in another data frame, or which are unique to each data frame.</p>

<h4 id="joining-the-data-frames">Joining the data frames</h4>

<p>To proceed, first join the three data frames with a column identifying which source each row came from. It’s called <code class="highlighter-rouge">Coder</code> here because this could be data coded by three different people. In this case, you might wish to find where the coders agreed, or where they disagreed.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dfA</span><span class="o">$</span><span class="n">Coder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"A"</span><span class="w">
</span><span class="n">dfB</span><span class="o">$</span><span class="n">Coder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"B"</span><span class="w">
</span><span class="n">dfC</span><span class="o">$</span><span class="n">Coder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"C"</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">dfA</span><span class="p">,</span><span class="w"> </span><span class="n">dfB</span><span class="p">,</span><span class="w"> </span><span class="n">dfC</span><span class="p">)</span><span class="w">                    </span><span class="c1"># Stick them together
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Coder"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Subject"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Response"</span><span class="p">)]</span><span class="w">  </span><span class="c1"># Reorder the columns to look nice
</span><span class="n">df</span><span class="w">
</span><span class="c1">#&gt;    Coder Subject Response
#&gt; 1      A       1        X
#&gt; 2      A       1        X
#&gt; 3      A       2        X
#&gt; 4      A       2        X
#&gt; 5      B       1        X
#&gt; 6      B       2        Y
#&gt; 7      B       3        X
#&gt; 8      C       1        Z
#&gt; 9      C       2        Y
#&gt; 10     C       3        Z
</span></code></pre>
</div>

<p>If your data starts out in this format, then there’s obviously no need to join it together.</p>

<h4 id="finding-duplicated-rows">Finding duplicated rows</h4>

<p>Using the function <code class="highlighter-rouge">dupsBetweenGroups</code> (defined below), we can find which rows are duplicated between different groups:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Find the rows which have duplicates in a different group.
</span><span class="n">dupRows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dupsBetweenGroups</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="s2">"Coder"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Print it alongside the data frame
</span><span class="n">cbind</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">dup</span><span class="o">=</span><span class="n">dupRows</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    Coder Subject Response   dup
#&gt; 1      A       1        X  TRUE
#&gt; 2      A       1        X  TRUE
#&gt; 3      A       2        X FALSE
#&gt; 4      A       2        X FALSE
#&gt; 5      B       1        X  TRUE
#&gt; 6      B       2        Y  TRUE
#&gt; 7      B       3        X FALSE
#&gt; 8      C       1        Z FALSE
#&gt; 9      C       2        Y  TRUE
#&gt; 10     C       3        Z FALSE
</span></code></pre>
</div>

<p>Note that this does not mark duplicated rows <strong>within</strong> a group. With Coder=A, there are two rows with Subject=1 and Response=X, but these are not marked as duplicates.</p>

<h4 id="finding-unique-rows">Finding unique rows</h4>

<p>It’s also possible to find the rows that are unique within each group:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">cbind</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="o">=!</span><span class="n">dupRows</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    Coder Subject Response unique
#&gt; 1      A       1        X  FALSE
#&gt; 2      A       1        X  FALSE
#&gt; 3      A       2        X   TRUE
#&gt; 4      A       2        X   TRUE
#&gt; 5      B       1        X  FALSE
#&gt; 6      B       2        Y  FALSE
#&gt; 7      B       3        X   TRUE
#&gt; 8      C       1        Z   TRUE
#&gt; 9      C       2        Y  FALSE
#&gt; 10     C       3        Z   TRUE
</span></code></pre>
</div>

<h4 id="splitting-apart-the-data-frame">Splitting apart the data frame</h4>

<p>If you wish to split the joined data frame into the three original data frames</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Store the results in df
</span><span class="n">dfDup</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">dup</span><span class="o">=</span><span class="n">dupRows</span><span class="p">)</span><span class="w">

</span><span class="n">dfA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">dfDup</span><span class="p">,</span><span class="w"> </span><span class="n">Coder</span><span class="o">==</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="o">=-</span><span class="n">Coder</span><span class="p">)</span><span class="w">
</span><span class="n">dfA</span><span class="w">
</span><span class="c1">#&gt;   Subject Response   dup
#&gt; 1       1        X  TRUE
#&gt; 2       1        X  TRUE
#&gt; 3       2        X FALSE
#&gt; 4       2        X FALSE
</span><span class="w">
</span><span class="n">dfB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">dfDup</span><span class="p">,</span><span class="w"> </span><span class="n">Coder</span><span class="o">==</span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="o">=-</span><span class="n">Coder</span><span class="p">)</span><span class="w">
</span><span class="n">dfB</span><span class="w">
</span><span class="c1">#&gt;   Subject Response   dup
#&gt; 5       1        X  TRUE
#&gt; 6       2        Y  TRUE
#&gt; 7       3        X FALSE
</span><span class="w">
</span><span class="n">dfC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">dfDup</span><span class="p">,</span><span class="w"> </span><span class="n">Coder</span><span class="o">==</span><span class="s2">"C"</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="o">=-</span><span class="n">Coder</span><span class="p">)</span><span class="w">
</span><span class="n">dfC</span><span class="w">
</span><span class="c1">#&gt;    Subject Response   dup
#&gt; 8        1        Z FALSE
#&gt; 9        2        Y  TRUE
#&gt; 10       3        Z FALSE
</span></code></pre>
</div>

<h4 id="ignoring-columns">Ignoring columns</h4>

<p>It is also possible to ignore one or more columns, by removing that column from the data frame that is passed to the function. The results can be joined to the original complete data frame if desired.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Ignore the Subject column -- only use Response
</span><span class="n">dfNoSub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="o">=-</span><span class="n">Subject</span><span class="p">)</span><span class="w">
</span><span class="n">dfNoSub</span><span class="w">
</span><span class="c1">#&gt;    Coder Response
#&gt; 1      A        X
#&gt; 2      A        X
#&gt; 3      A        X
#&gt; 4      A        X
#&gt; 5      B        X
#&gt; 6      B        Y
#&gt; 7      B        X
#&gt; 8      C        Z
#&gt; 9      C        Y
#&gt; 10     C        Z
</span><span class="w">
</span><span class="c1"># Check for duplicates
</span><span class="n">dupRows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dupsBetweenGroups</span><span class="p">(</span><span class="n">dfNoSub</span><span class="p">,</span><span class="w"> </span><span class="s2">"Coder"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Join the result to the original data frame
</span><span class="n">cbind</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">dup</span><span class="o">=</span><span class="n">dupRows</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    Coder Subject Response   dup
#&gt; 1      A       1        X  TRUE
#&gt; 2      A       1        X  TRUE
#&gt; 3      A       2        X  TRUE
#&gt; 4      A       2        X  TRUE
#&gt; 5      B       1        X  TRUE
#&gt; 6      B       2        Y  TRUE
#&gt; 7      B       3        X  TRUE
#&gt; 8      C       1        Z FALSE
#&gt; 9      C       2        Y  TRUE
#&gt; 10     C       3        Z FALSE
</span></code></pre>
</div>

<h3 id="dupsbetweengroups-function">dupsBetweenGroups function</h3>

<p>This is the function that does all the work:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dupsBetweenGroups</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">idcol</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="c1"># df: the data frame
</span><span class="w">    </span><span class="c1"># idcol: the column which identifies the group each row belongs to
</span><span class="w">
</span><span class="c1"># Get the data columns to use for finding matches
</span><span class="w">    </span><span class="n">datacols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">setdiff</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="w"> </span><span class="n">idcol</span><span class="p">)</span><span class="w">

</span><span class="c1"># Sort by idcol, then datacols. Save order so we can undo the sorting later.
</span><span class="w">    </span><span class="n">sortorder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">sortorder</span><span class="p">,]</span><span class="w">

</span><span class="c1"># Find duplicates within each id group (first copy not marked)
</span><span class="w">    </span><span class="n">dupWithin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">duplicated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">

</span><span class="c1"># With duplicates within each group filtered out, find duplicates between groups. 
</span><span class="w">    </span><span class="c1"># Need to scan up and down with duplicated() because first copy is not marked.
</span><span class="w">    </span><span class="n">dupBetween</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="w">
</span><span class="n">dupBetween</span><span class="p">[</span><span class="o">!</span><span class="n">dupWithin</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">duplicated</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="o">!</span><span class="n">dupWithin</span><span class="p">,</span><span class="n">datacols</span><span class="p">])</span><span class="w">
</span><span class="n">dupBetween</span><span class="p">[</span><span class="o">!</span><span class="n">dupWithin</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">duplicated</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="o">!</span><span class="n">dupWithin</span><span class="p">,</span><span class="n">datacols</span><span class="p">],</span><span class="w"> </span><span class="n">fromLast</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dupBetween</span><span class="p">[</span><span class="o">!</span><span class="n">dupWithin</span><span class="p">]</span><span class="w">

</span><span class="c1"># ============= Replace NA's with previous non-NA value ==============
</span><span class="w">    </span><span class="c1"># This is why we sorted earlier - it was necessary to do this part efficiently
</span><span class="w">
</span><span class="c1"># Get indexes of non-NA's
</span><span class="w">    </span><span class="n">goodIdx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">dupBetween</span><span class="p">)</span><span class="w">

</span><span class="c1"># These are the non-NA values from x only
</span><span class="w">    </span><span class="c1"># Add a leading NA for later use when we index into this vector
</span><span class="w">    </span><span class="n">goodVals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">dupBetween</span><span class="p">[</span><span class="n">goodIdx</span><span class="p">])</span><span class="w">

</span><span class="c1"># Fill the indices of the output vector with the indices pulled from
</span><span class="w">    </span><span class="c1"># these offsets of goodVals. Add 1 to avoid indexing to zero.
</span><span class="w">    </span><span class="n">fillIdx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">goodIdx</span><span class="p">)</span><span class="m">+1</span><span class="w">

</span><span class="c1"># The original vector, now with gaps filled
</span><span class="w">    </span><span class="n">dupBetween</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">goodVals</span><span class="p">[</span><span class="n">fillIdx</span><span class="p">]</span><span class="w">

</span><span class="c1"># Undo the original sort
</span><span class="w">    </span><span class="n">dupBetween</span><span class="p">[</span><span class="n">sortorder</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dupBetween</span><span class="w">

</span><span class="c1"># Return the vector of which entries are duplicated across groups
</span><span class="w">    </span><span class="nf">return</span><span class="p">(</span><span class="n">dupBetween</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
</article>
<h2 class="post-title" id="topic-40">Re-computing the levels of all factor columns in a data frame</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>
<p>You want to re-compute factor levels of all factor columns in a data frame.</p>

<h3 id="solution">Solution</h3>

<p>Sometimes after reading in data and cleaning it, you will end up with factor columns that have levels that should no longer be there.</p>

<p>For example, <code class="highlighter-rouge">d</code> below has one blank row. When it’s read in, the factor columns have a level <code class="highlighter-rouge">""</code>, which shouldn’t be part of the data.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
x,y,value
a,one,1
,,5
b,two,4
c,three,10
'</span><span class="p">)</span><span class="w">

</span><span class="n">d</span><span class="w">
</span><span class="c1">#&gt;   x     y value
#&gt; 1 a   one     1
#&gt; 2             5
#&gt; 3 b   two     4
#&gt; 4 c three    10
</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 'data.frame':	4 obs. of  3 variables:
#&gt;  $ x    : Factor w/ 4 levels "","a","b","c": 2 1 3 4
#&gt;  $ y    : Factor w/ 4 levels "","one","three",..: 2 1 4 3
#&gt;  $ value: int  1 5 4 10
</span></code></pre>
</div>

<p>Even after removing the empty row, the factors still have the blank string <code class="highlighter-rouge">""</code> as a level:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Remove second row
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="p">[</span><span class="m">-2</span><span class="p">,]</span><span class="w">
</span><span class="n">d</span><span class="w">
</span><span class="c1">#&gt;   x     y value
#&gt; 1 a   one     1
#&gt; 3 b   two     4
#&gt; 4 c three    10
</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 'data.frame':	3 obs. of  3 variables:
#&gt;  $ x    : Factor w/ 4 levels "","a","b","c": 2 3 4
#&gt;  $ y    : Factor w/ 4 levels "","one","three",..: 2 4 3
#&gt;  $ value: int  1 4 10
</span></code></pre>
</div>

<h3 id="with-droplevels">With <code class="highlighter-rouge">droplevels</code></h3>

<p>The simplest way is to use the <code class="highlighter-rouge">droplevels()</code> function:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">d</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">droplevels</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">d</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 'data.frame':	3 obs. of  3 variables:
#&gt;  $ x    : Factor w/ 3 levels "a","b","c": 1 2 3
#&gt;  $ y    : Factor w/ 3 levels "one","three",..: 1 3 2
#&gt;  $ value: int  1 4 10
</span></code></pre>
</div>

<h3 id="with-vapply-and-lapply">With <code class="highlighter-rouge">vapply</code> and <code class="highlighter-rouge">lapply</code></h3>

<p>To re-compute the levels for all factor columns, we can use <code class="highlighter-rouge">vapply()</code> with <code class="highlighter-rouge">is.factor()</code> to find out which of columns are factors, and then use that information with <code class="highlighter-rouge">lapply</code> to apply the <code class="highlighter-rouge">factor()</code> function to those columns.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Find which columns are factors
</span><span class="n">factor_cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vapply</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">is.factor</span><span class="p">,</span><span class="w"> </span><span class="n">logical</span><span class="p">(</span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="c1"># Apply the factor() function to those columns, and assign then back into d
</span><span class="n">d</span><span class="p">[</span><span class="n">factor_cols</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">factor_cols</span><span class="p">],</span><span class="w"> </span><span class="n">factor</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 'data.frame':	3 obs. of  3 variables:
#&gt;  $ x    : Factor w/ 3 levels "a","b","c": 1 2 3
#&gt;  $ y    : Factor w/ 3 levels "one","three",..: 1 3 2
#&gt;  $ value: int  1 4 10
</span></code></pre>
</div>

<h2 id="topic-41">See also</h2>

<p>For information about re-computing the levels of a factor, see <a href="../Re-computing_the_levels_of_factor">../Re-computing_the_levels_of_factor</a>.</p>

</article>
<h2 class="post-title" id="topic-42">Converting data between wide and long format</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to do convert data from a wide format to a long format.</p>

<p>Many functions in R expect data to be in a long format rather than a wide format. Programs like SPSS, however, often use wide-formatted data.</p>

<h3 id="solution">Solution</h3>

<p>There are two sets of methods that are explained below:</p>

<ul>
<li><code class="highlighter-rouge">gather()</code> and <code class="highlighter-rouge">spread()</code> from the <strong>tidyr</strong> package. This is a newer interface to the <strong>reshape2</strong> package.</li>
<li><code class="highlighter-rouge">melt()</code> and <code class="highlighter-rouge">dcast()</code> from the <strong>reshape2</strong> package.</li>
</ul>

<p>There are a number of other methods which aren’t covered here, since they are not as easy to use:</p>

<ul>
<li>The <code class="highlighter-rouge">reshape()</code> function, which is confusingly not part of the reshape2 package; it is part of the base install of R.</li>
<li><code class="highlighter-rouge">stack()</code> and <code class="highlighter-rouge">unstack()</code></li>
</ul>

<h3 id="sample-data">Sample data</h3>

<p>These data frames hold the same data, but in wide and long formats. They will each be converted to the other format below.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">olddata_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject sex control cond1 cond2
 1   M     7.9  12.3  10.7
 2   F     6.3  10.6  11.1
 3   F     9.5  13.1  13.8
 4   M    11.5  13.4  12.9
'</span><span class="p">)</span><span class="w">
</span><span class="c1"># Make sure the subject column is a factor
</span><span class="n">olddata_wide</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">olddata_wide</span><span class="o">$</span><span class="n">subject</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">olddata_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject sex condition measurement
 1   M   control         7.9
 1   M     cond1        12.3
 1   M     cond2        10.7
 2   F   control         6.3
 2   F     cond1        10.6
 2   F     cond2        11.1
 3   F   control         9.5
 3   F     cond1        13.1
 3   F     cond2        13.8
 4   M   control        11.5
 4   M     cond1        13.4
 4   M     cond2        12.9
'</span><span class="p">)</span><span class="w">
</span><span class="c1"># Make sure the subject column is a factor
</span><span class="n">olddata_long</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">olddata_long</span><span class="o">$</span><span class="n">subject</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="tidyr">tidyr</h3>

<h4 id="from-wide-to-long">From wide to long</h4>

<p>Use <code class="highlighter-rouge">gather</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">olddata_wide</span><span class="w">
</span><span class="c1">#&gt;   subject sex control cond1 cond2
#&gt; 1       1   M     7.9  12.3  10.7
#&gt; 2       2   F     6.3  10.6  11.1
#&gt; 3       3   F     9.5  13.1  13.8
#&gt; 4       4   M    11.5  13.4  12.9
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># The arguments to gather():
# - data: Data object
# - key: Name of new key column (made from names of data columns)
# - value: Name of new value column
# - ...: Names of source columns that contain values
# - factor_key: Treat the new key column as a factor (instead of character vector)
</span><span class="n">data_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gather</span><span class="p">(</span><span class="n">olddata_wide</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">measurement</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="o">:</span><span class="n">cond2</span><span class="p">,</span><span class="w"> </span><span class="n">factor_key</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">data_long</span><span class="w">
</span><span class="c1">#&gt;    subject sex condition measurement
#&gt; 1        1   M   control         7.9
#&gt; 2        2   F   control         6.3
#&gt; 3        3   F   control         9.5
#&gt; 4        4   M   control        11.5
#&gt; 5        1   M     cond1        12.3
#&gt; 6        2   F     cond1        10.6
#&gt; 7        3   F     cond1        13.1
#&gt; 8        4   M     cond1        13.4
#&gt; 9        1   M     cond2        10.7
#&gt; 10       2   F     cond2        11.1
#&gt; 11       3   F     cond2        13.8
#&gt; 12       4   M     cond2        12.9
</span></code></pre>
</div>

<p>In this example, the source columns that are gathered are specified with <code class="highlighter-rouge">control:cond2</code>. This means to use all the columns, positionally, between <code class="highlighter-rouge">control</code> and <code class="highlighter-rouge">cond2</code>. Another way of doing it is to name the columns individually, as in:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">gather</span><span class="p">(</span><span class="n">olddata_wide</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">measurement</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="p">,</span><span class="w"> </span><span class="n">cond1</span><span class="p">,</span><span class="w"> </span><span class="n">cond2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>If you need to use <code class="highlighter-rouge">gather()</code> programmatically, you may need to use variables containing column names. To do this, you should use the <code class="highlighter-rouge">gather_()</code> function instead, which takes strings instead of bare (unquoted) column names.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">keycol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"condition"</span><span class="w">
</span><span class="n">valuecol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"measurement"</span><span class="w">
</span><span class="n">gathercols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"control"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cond1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cond2"</span><span class="p">)</span><span class="w">

</span><span class="n">gather_</span><span class="p">(</span><span class="n">olddata_wide</span><span class="p">,</span><span class="w"> </span><span class="n">keycol</span><span class="p">,</span><span class="w"> </span><span class="n">valuecol</span><span class="p">,</span><span class="w"> </span><span class="n">gathercols</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Optional: Rename the factor levels of the <em>variable</em> column, and sort.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Rename factor names from "cond1" and "cond2" to "first" and "second"
</span><span class="n">levels</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span><span class="o">==</span><span class="s2">"cond1"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"first"</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span><span class="o">==</span><span class="s2">"cond2"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"second"</span><span class="w">

</span><span class="c1"># Sort by subject first, then by condition
</span><span class="n">data_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_long</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">data_long</span><span class="w">
</span><span class="c1">#&gt;    subject sex condition measurement
#&gt; 1        1   M   control         7.9
#&gt; 5        1   M     first        12.3
#&gt; 9        1   M    second        10.7
#&gt; 2        2   F   control         6.3
#&gt; 6        2   F     first        10.6
#&gt; 10       2   F    second        11.1
#&gt; 3        3   F   control         9.5
#&gt; 7        3   F     first        13.1
#&gt; 11       3   F    second        13.8
#&gt; 4        4   M   control        11.5
#&gt; 8        4   M     first        13.4
#&gt; 12       4   M    second        12.9
</span></code></pre>
</div>

<h4 id="from-long-to-wide">From long to wide</h4>

<p>Use <code class="highlighter-rouge">spread</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">olddata_long</span><span class="w">
</span><span class="c1">#&gt;    subject sex condition measurement
#&gt; 1        1   M   control         7.9
#&gt; 2        1   M     cond1        12.3
#&gt; 3        1   M     cond2        10.7
#&gt; 4        2   F   control         6.3
#&gt; 5        2   F     cond1        10.6
#&gt; 6        2   F     cond2        11.1
#&gt; 7        3   F   control         9.5
#&gt; 8        3   F     cond1        13.1
#&gt; 9        3   F     cond2        13.8
#&gt; 10       4   M   control        11.5
#&gt; 11       4   M     cond1        13.4
#&gt; 12       4   M     cond2        12.9
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># The arguments to spread():
# - data: Data object
# - key: Name of column containing the new column names
# - value: Name of column containing values
</span><span class="n">data_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spread</span><span class="p">(</span><span class="n">olddata_long</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">measurement</span><span class="p">)</span><span class="w">
</span><span class="n">data_wide</span><span class="w">
</span><span class="c1">#&gt;   subject sex cond1 cond2 control
#&gt; 1       1   M  12.3  10.7     7.9
#&gt; 2       2   F  10.6  11.1     6.3
#&gt; 3       3   F  13.1  13.8     9.5
#&gt; 4       4   M  13.4  12.9    11.5
</span></code></pre>
</div>

<p>Optional: A few things to make the data look nicer.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Rename cond1 to first, and cond2 to second
</span><span class="nf">names</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)</span><span class="o">==</span><span class="s2">"cond1"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"first"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)</span><span class="o">==</span><span class="s2">"cond2"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"second"</span><span class="w">

</span><span class="c1"># Reorder the columns
</span><span class="n">data_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_wide</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]</span><span class="w">
</span><span class="n">data_wide</span><span class="w">
</span><span class="c1">#&gt;   subject sex control first second
#&gt; 1       1   M     7.9  12.3   10.7
#&gt; 2       2   F     6.3  10.6   11.1
#&gt; 3       3   F     9.5  13.1   13.8
#&gt; 4       4   M    11.5  13.4   12.9
</span></code></pre>
</div>

<p>The order of factor levels determines the order of the columns. The level order can be <a href="../Changing_the_order_of_levels_of_a_factor">changed</a> before reshaping, or the columns can be <a href="../Reordering_the_columns_in_a_data_frame">re-ordered</a> afterward.</p>

<h3 id="reshape2">reshape2</h3>

<h4 id="from-wide-to-long-1">From wide to long</h4>

<p>Use <code class="highlighter-rouge">melt</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">olddata_wide</span><span class="w">
</span><span class="c1">#&gt;   subject sex control cond1 cond2
#&gt; 1       1   M     7.9  12.3  10.7
#&gt; 2       2   F     6.3  10.6  11.1
#&gt; 3       3   F     9.5  13.1  13.8
#&gt; 4       4   M    11.5  13.4  12.9
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">

</span><span class="c1"># Specify id.vars: the variables to keep but not split apart on
</span><span class="n">melt</span><span class="p">(</span><span class="n">olddata_wide</span><span class="p">,</span><span class="w"> </span><span class="n">id.vars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"subject"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sex"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;    subject sex variable value
#&gt; 1        1   M  control   7.9
#&gt; 2        2   F  control   6.3
#&gt; 3        3   F  control   9.5
#&gt; 4        4   M  control  11.5
#&gt; 5        1   M    cond1  12.3
#&gt; 6        2   F    cond1  10.6
#&gt; 7        3   F    cond1  13.1
#&gt; 8        4   M    cond1  13.4
#&gt; 9        1   M    cond2  10.7
#&gt; 10       2   F    cond2  11.1
#&gt; 11       3   F    cond2  13.8
#&gt; 12       4   M    cond2  12.9
</span></code></pre>
</div>

<p>There are options for <code class="highlighter-rouge">melt</code> that can make the output a little easier to work with:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">olddata_wide</span><span class="p">,</span><span class="w">
  </span><span class="c1"># ID variables - all the variables to keep but not split apart on
</span><span class="w">    </span><span class="n">id.vars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"subject"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sex"</span><span class="p">),</span><span class="w">
  </span><span class="c1"># The source columns
</span><span class="w">    </span><span class="n">measure.vars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"control"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cond1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cond2"</span><span class="w"> </span><span class="p">),</span><span class="w">
  </span><span class="c1"># Name of the destination column that will identify the original
</span><span class="w">        </span><span class="c1"># column that the measurement came from
</span><span class="w">    </span><span class="n">variable.name</span><span class="o">=</span><span class="s2">"condition"</span><span class="p">,</span><span class="w">
</span><span class="n">value.name</span><span class="o">=</span><span class="s2">"measurement"</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">data_long</span><span class="w">
</span><span class="c1">#&gt;    subject sex condition measurement
#&gt; 1        1   M   control         7.9
#&gt; 2        2   F   control         6.3
#&gt; 3        3   F   control         9.5
#&gt; 4        4   M   control        11.5
#&gt; 5        1   M     cond1        12.3
#&gt; 6        2   F     cond1        10.6
#&gt; 7        3   F     cond1        13.1
#&gt; 8        4   M     cond1        13.4
#&gt; 9        1   M     cond2        10.7
#&gt; 10       2   F     cond2        11.1
#&gt; 11       3   F     cond2        13.8
#&gt; 12       4   M     cond2        12.9
</span></code></pre>
</div>

<p>If you leave out the <code class="highlighter-rouge">measure.vars</code>, <code class="highlighter-rouge">melt</code> will automatically use all the other variables as the <code class="highlighter-rouge">id.vars</code>. The reverse is true if you leave out <code class="highlighter-rouge">id.vars</code>.</p>

<p>If you don’t specify <code class="highlighter-rouge">variable.name</code>, it will name that column <code class="highlighter-rouge">"variable"</code>, and if you leave out <code class="highlighter-rouge">value.name</code>, it will name that column <code class="highlighter-rouge">"measurement"</code>.</p>

<p>Optional: Rename the factor levels of the <em>variable</em> column.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Rename factor names from "cond1" and "cond2" to "first" and "second"
</span><span class="n">levels</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span><span class="o">==</span><span class="s2">"cond1"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"first"</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">)</span><span class="o">==</span><span class="s2">"cond2"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"second"</span><span class="w">

</span><span class="c1"># Sort by subject first, then by condition
</span><span class="n">data_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_long</span><span class="p">[</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="n">data_long</span><span class="o">$</span><span class="n">condition</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">data_long</span><span class="w">
</span><span class="c1">#&gt;    subject sex condition measurement
#&gt; 1        1   M   control         7.9
#&gt; 5        1   M     first        12.3
#&gt; 9        1   M    second        10.7
#&gt; 2        2   F   control         6.3
#&gt; 6        2   F     first        10.6
#&gt; 10       2   F    second        11.1
#&gt; 3        3   F   control         9.5
#&gt; 7        3   F     first        13.1
#&gt; 11       3   F    second        13.8
#&gt; 4        4   M   control        11.5
#&gt; 8        4   M     first        13.4
#&gt; 12       4   M    second        12.9
</span></code></pre>
</div>

<h4 id="from-long-to-wide-1">From long to wide</h4>

<p>The following code uses <code class="highlighter-rouge">dcast</code> to reshape the data. This function is meant for data frames; if you are working with arrays or matrices, use <code class="highlighter-rouge">acast</code> instead.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">olddata_long</span><span class="w">
</span><span class="c1">#&gt;    subject sex condition measurement
#&gt; 1        1   M   control         7.9
#&gt; 2        1   M     cond1        12.3
#&gt; 3        1   M     cond2        10.7
#&gt; 4        2   F   control         6.3
#&gt; 5        2   F     cond1        10.6
#&gt; 6        2   F     cond2        11.1
#&gt; 7        3   F   control         9.5
#&gt; 8        3   F     cond1        13.1
#&gt; 9        3   F     cond2        13.8
#&gt; 10       4   M   control        11.5
#&gt; 11       4   M     cond1        13.4
#&gt; 12       4   M     cond2        12.9
</span><span class="w">
</span><span class="c1"># From the source:
# "subject" and "sex" are columns we want to keep the same
# "condition" is the column that contains the names of the new column to put things in
# "measurement" holds the measurements
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">

</span><span class="n">data_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dcast</span><span class="p">(</span><span class="n">olddata_long</span><span class="p">,</span><span class="w"> </span><span class="n">subject</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">value.var</span><span class="o">=</span><span class="s2">"measurement"</span><span class="p">)</span><span class="w">
</span><span class="n">data_wide</span><span class="w">
</span><span class="c1">#&gt;   subject sex cond1 cond2 control
#&gt; 1       1   M  12.3  10.7     7.9
#&gt; 2       2   F  10.6  11.1     6.3
#&gt; 3       3   F  13.1  13.8     9.5
#&gt; 4       4   M  13.4  12.9    11.5
</span></code></pre>
</div>

<p>Optional: A few things to make the data look nicer.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Rename cond1 to first, and cond2 to second
</span><span class="nf">names</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)</span><span class="o">==</span><span class="s2">"cond1"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"first"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)</span><span class="o">==</span><span class="s2">"cond2"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"second"</span><span class="w">

</span><span class="c1"># Reorder the columns
</span><span class="n">data_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_wide</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]</span><span class="w">
</span><span class="n">data_wide</span><span class="w">
</span><span class="c1">#&gt;   subject sex control first second
#&gt; 1       1   M     7.9  12.3   10.7
#&gt; 2       2   F     6.3  10.6   11.1
#&gt; 3       3   F     9.5  13.1   13.8
#&gt; 4       4   M    11.5  13.4   12.9
</span></code></pre>
</div>

<p>The order of factor levels determines the order of the columns. The level order can be <a href="../Changing_the_order_of_levels_of_a_factor">changed</a> before reshaping, or the columns can be <a href="../Reordering_the_columns_in_a_data_frame">re-ordered</a> afterward.</p>

</article>
<h2 class="post-title" id="topic-43">Summarizing data</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to do summarize your data (with mean, standard deviation, etc.), broken down by group.</p>

<h3 id="solution">Solution</h3>
<p>There are three ways described here to group data based on some specified variables, and apply a summary function (like mean, standard deviation, etc.) to each group.</p>

<ul>
<li>The <code class="highlighter-rouge">ddply()</code> function. It is the easiest to use, though it requires the <code class="highlighter-rouge">plyr</code> package. This is probably what you want to use.</li>
<li>The <code class="highlighter-rouge">summarizeBy()</code> function. It is easier to use, though it requires the <code class="highlighter-rouge">doBy</code> package.</li>
<li>The <code class="highlighter-rouge">aggregate()</code> function. It is more difficult to use but is included in the base install of R.</li>
</ul>

<p>Suppose you have this data and want to find the N, mean of <strong>change</strong>, standard deviation, and standard error of the mean for each group, where the groups are specified by each combination of sex and condition: <strong><em>F-placebo</em></strong>, <strong><em>F-aspirin</em></strong>, <strong><em>M-placebo</em></strong>, and <strong><em>M-aspirin</em></strong>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject sex condition before after change
 1   F   placebo   10.1   6.9   -3.2
 2   F   placebo    6.3   4.2   -2.1
 3   M   aspirin   12.4   6.3   -6.1
 4   F   placebo    8.1   6.1   -2.0
 5   M   aspirin   15.2   9.9   -5.3
 6   F   aspirin   10.9   7.0   -3.9
 7   F   aspirin   11.6   8.5   -3.1
 8   M   aspirin    9.5   3.0   -6.5
 9   F   placebo   11.5   9.0   -2.5
10   M   placebo   11.9  11.0   -0.9
11   F   aspirin   11.4   8.0   -3.4
12   M   aspirin   10.0   4.4   -5.6
13   M   aspirin   12.5   5.4   -7.1
14   M   placebo   10.6  10.6    0.0
15   M   aspirin    9.1   4.3   -4.8
16   F   placebo   12.1  10.2   -1.9
17   F   placebo   11.0   8.8   -2.2
18   F   placebo   11.9  10.2   -1.7
19   M   aspirin    9.1   3.6   -5.5
20   M   placebo   13.5  12.4   -1.1
21   M   aspirin   12.0   7.5   -4.5
22   F   placebo    9.1   7.6   -1.5
23   M   placebo    9.9   8.0   -1.9
24   F   placebo    7.6   5.2   -2.4
25   F   placebo   11.8   9.7   -2.1
26   F   placebo   11.8  10.7   -1.1
27   F   aspirin   10.1   7.9   -2.2
28   M   aspirin   11.6   8.3   -3.3
29   F   aspirin   11.3   6.8   -4.5
30   F   placebo   10.3   8.3   -2.0
 '</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="using-ddply">Using ddply</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># Run the functions length, mean, and sd on the value of "change" for each group, 
# broken down by sex + condition
</span><span class="n">cdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="w"> </span><span class="s2">"condition"</span><span class="p">),</span><span class="w"> </span><span class="n">summarise</span><span class="p">,</span><span class="w">
         </span><span class="n">N</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">change</span><span class="p">),</span><span class="w">
         </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">change</span><span class="p">),</span><span class="w">
         </span><span class="n">sd</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">change</span><span class="p">),</span><span class="w">
         </span><span class="n">se</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N      mean        sd        se
#&gt; 1   F   aspirin  5 -3.420000 0.8642916 0.3865230
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867
#&gt; 3   M   aspirin  9 -5.411111 1.1307569 0.3769190
#&gt; 4   M   placebo  4 -0.975000 0.7804913 0.3902456
</span></code></pre>
</div>

<h4 id="handling-missing-data">Handling missing data</h4>

<p>If there are NA’s in the data, you need to pass the flag <code class="highlighter-rouge">na.rm=TRUE</code> to each of the functions. <code class="highlighter-rouge">length()</code> doesn’t take <code class="highlighter-rouge">na.rm</code> as an option, so one way to work around it is to use <code class="highlighter-rouge">sum(!is.na(...))</code> to count how many non-NA’s there are.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Put some NA's in the data
</span><span class="n">dataNA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w">
</span><span class="n">dataNA</span><span class="o">$</span><span class="n">change</span><span class="p">[</span><span class="m">11</span><span class="o">:</span><span class="m">14</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">

</span><span class="n">cdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">dataNA</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="w"> </span><span class="s2">"condition"</span><span class="p">),</span><span class="w"> </span><span class="n">summarise</span><span class="p">,</span><span class="w">
         </span><span class="n">N</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">change</span><span class="p">)),</span><span class="w">
         </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">change</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
         </span><span class="n">sd</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">change</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
         </span><span class="n">se</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N      mean        sd        se
#&gt; 1   F   aspirin  4 -3.425000 0.9979145 0.4989572
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867
#&gt; 3   M   aspirin  7 -5.142857 1.0674848 0.4034713
#&gt; 4   M   placebo  3 -1.300000 0.5291503 0.3055050
</span></code></pre>
</div>

<h4 id="a-function-for-mean-count-standard-deviation-standard-error-of-the-mean-and-confidence-interval">A function for mean, count, standard deviation, standard error of the mean, and confidence interval</h4>

<p>Instead of manually specifying all the values you want and then calculating the standard error, as shown above, this function will handle all of those details. It will do all the things described here:</p>

<ul>
<li>Find the mean, standard deviation, and count (N)</li>
<li>Find the standard error of the mean (<strong><em>again, this may not be what you want if you are collapsing over a within-subject variable.</em></strong></li>
<li>Find a 95% confidence interval (or other value, if desired)</li>
<li>Rename the columns so that the resulting data frame is easier to work with</li>
</ul>

<p>To use, put this function in your code and call it as demonstrated below.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## Summarizes data.
## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
</span><span class="n">summarySE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                </span><span class="n">conf.interval</span><span class="o">=</span><span class="m">.95</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># New version of length which can handle NA's: if na.rm==T, don't count them
</span><span class="w">    </span><span class="n">length2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">na.rm</span><span class="p">)</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
  </span><span class="k">else</span><span class="w">       </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># This does the summary. For each group's data frame, return a vector with
</span><span class="w">    </span><span class="c1"># N, mean, and sd
</span><span class="w">    </span><span class="n">datac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="n">.drop</span><span class="p">,</span><span class="w">
</span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="n">N</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">length2</span><span class="p">(</span><span class="n">xx</span><span class="p">[[</span><span class="n">col</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">),</span><span class="w">
    </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="w">   </span><span class="p">(</span><span class="n">xx</span><span class="p">[[</span><span class="n">col</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">),</span><span class="w">
    </span><span class="n">sd</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="w">     </span><span class="p">(</span><span class="n">xx</span><span class="p">[[</span><span class="n">col</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="n">measurevar</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Rename the "mean" column    
</span><span class="w">    </span><span class="n">datac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rename</span><span class="p">(</span><span class="n">datac</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mean"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measurevar</span><span class="p">))</span><span class="w">

</span><span class="n">datac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">sd</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">datac</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w">  </span><span class="c1"># Calculate standard error of the mean
</span><span class="w">
</span><span class="c1"># Confidence interval multiplier for standard error
</span><span class="w">    </span><span class="c1"># Calculate t-statistic for confidence interval: 
</span><span class="w">    </span><span class="c1"># e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
</span><span class="w">    </span><span class="n">ciMult</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="n">conf.interval</span><span class="o">/</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">N</span><span class="m">-1</span><span class="p">)</span><span class="w">
</span><span class="n">datac</span><span class="o">$</span><span class="n">ci</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ciMult</span><span class="w">

</span><span class="nf">return</span><span class="p">(</span><span class="n">datac</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Example usage (with 95% confidence interval). Instead of doing all the steps manually, as done previously, the <code class="highlighter-rouge">summarySE</code> function does it all in one step:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">summarySE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"change"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="w"> </span><span class="s2">"condition"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N    change        sd        se        ci
#&gt; 1   F   aspirin  5 -3.420000 0.8642916 0.3865230 1.0731598
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867 0.3334201
#&gt; 3   M   aspirin  9 -5.411111 1.1307569 0.3769190 0.8691767
#&gt; 4   M   placebo  4 -0.975000 0.7804913 0.3902456 1.2419358
</span><span class="w">
</span><span class="c1"># With a data set with NA's, use na.rm=TRUE
</span><span class="n">summarySE</span><span class="p">(</span><span class="n">dataNA</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"change"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="w"> </span><span class="s2">"condition"</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N    change        sd        se        ci
#&gt; 1   F   aspirin  4 -3.425000 0.9979145 0.4989572 1.5879046
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867 0.3334201
#&gt; 3   M   aspirin  7 -5.142857 1.0674848 0.4034713 0.9872588
#&gt; 4   M   placebo  3 -1.300000 0.5291503 0.3055050 1.3144821
</span></code></pre>
</div>

<h4 id="filling-empty-combinations-with-zeros">Filling empty combinations with zeros</h4>
<p>Sometimes there will be empty combinations of factors in the summary data frame – that is, combinations of factors that are possible, but don’t actually occur in the original data frame. It is often useful to automatically fill in those combinations in the summary data frame with NA’s. To do this, set <code class="highlighter-rouge">.drop=FALSE</code> in the call to <code class="highlighter-rouge">ddply</code> or <code class="highlighter-rouge">summarySE</code>.</p>

<p>Example usage:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># First remove some all Male+Placebo entries from the data
</span><span class="n">dataSub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">sex</span><span class="o">==</span><span class="s2">"M"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">condition</span><span class="o">==</span><span class="s2">"placebo"</span><span class="p">))</span><span class="w">

</span><span class="c1"># If we summarize the data, there will be a missing row for Male+Placebo,
# since there were no cases with this combination.
</span><span class="n">summarySE</span><span class="p">(</span><span class="n">dataSub</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"change"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="w"> </span><span class="s2">"condition"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N    change        sd        se        ci
#&gt; 1   F   aspirin  5 -3.420000 0.8642916 0.3865230 1.0731598
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867 0.3334201
#&gt; 3   M   aspirin  9 -5.411111 1.1307569 0.3769190 0.8691767
</span><span class="w">
</span><span class="c1"># Set .drop=FALSE to NOT drop those combinations
</span><span class="n">summarySE</span><span class="p">(</span><span class="n">dataSub</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"change"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="w"> </span><span class="s2">"condition"</span><span class="p">),</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Warning in qt(conf.interval/2 + 0.5, datac$N - 1): NaNs produced
#&gt;   sex condition  N    change        sd        se        ci
#&gt; 1   F   aspirin  5 -3.420000 0.8642916 0.3865230 1.0731598
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867 0.3334201
#&gt; 3   M   aspirin  9 -5.411111 1.1307569 0.3769190 0.8691767
#&gt; 4   M   placebo  0       NaN        NA        NA        NA
</span></code></pre>
</div>

<h3 id="using-summaryby">Using summaryBy</h3>
<p>To collapse the data using the <code class="highlighter-rouge">summarizeBy()</code> function:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">doBy</span><span class="p">)</span><span class="w">

</span><span class="c1"># Run the functions length, mean, and sd on the value of "change" for each group, 
# broken down by sex + condition
</span><span class="n">cdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summaryBy</span><span class="p">(</span><span class="n">change</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="n">mean</span><span class="p">,</span><span class="n">sd</span><span class="p">))</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition change.length change.mean change.sd
#&gt; 1   F   aspirin             5   -3.420000 0.8642916
#&gt; 2   F   placebo            12   -2.058333 0.5247655
#&gt; 3   M   aspirin             9   -5.411111 1.1307569
#&gt; 4   M   placebo             4   -0.975000 0.7804913
</span><span class="w">
</span><span class="c1"># Rename column change.length to just N
</span><span class="nf">names</span><span class="p">(</span><span class="n">cdata</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">cdata</span><span class="p">)</span><span class="o">==</span><span class="s2">"change.length"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"N"</span><span class="w">

</span><span class="c1"># Calculate standard error of the mean
</span><span class="n">cdata</span><span class="o">$</span><span class="n">change.se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cdata</span><span class="o">$</span><span class="n">change.sd</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">cdata</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N change.mean change.sd change.se
#&gt; 1   F   aspirin  5   -3.420000 0.8642916 0.3865230
#&gt; 2   F   placebo 12   -2.058333 0.5247655 0.1514867
#&gt; 3   M   aspirin  9   -5.411111 1.1307569 0.3769190
#&gt; 4   M   placebo  4   -0.975000 0.7804913 0.3902456
</span></code></pre>
</div>

<p><strong><em>Note that if you have any within-subjects variables, these standard error values may not be useful for comparing groups.</em></strong></p>

<h4 id="handling-missing-data-1">Handling missing data</h4>

<p>If there are NA’s in the data, you need to pass the flag <code class="highlighter-rouge">na.rm=TRUE</code> to the functions. Normally you could pass it to <code class="highlighter-rouge">summaryBy()</code> and it would get passed to each of the functions called, but <code class="highlighter-rouge">length()</code> does not recognize it and so it won’t work. One way around it is to define a new length function that handles the NA’s.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># New version of length which can handle NA's: if na.rm==T, don't count them
</span><span class="n">length2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">na.rm</span><span class="p">)</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="k">else</span><span class="w">       </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Put some NA's in the data
</span><span class="n">dataNA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w">
</span><span class="n">dataNA</span><span class="o">$</span><span class="n">change</span><span class="p">[</span><span class="m">11</span><span class="o">:</span><span class="m">14</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">

</span><span class="n">cdataNA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summaryBy</span><span class="p">(</span><span class="n">change</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dataNA</span><span class="p">,</span><span class="w">
               </span><span class="n">FUN</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">length2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">cdataNA</span><span class="w">
</span><span class="c1">#&gt;   sex condition change.length2 change.mean change.sd
#&gt; 1   F   aspirin              4   -3.425000 0.9979145
#&gt; 2   F   placebo             12   -2.058333 0.5247655
#&gt; 3   M   aspirin              7   -5.142857 1.0674848
#&gt; 4   M   placebo              3   -1.300000 0.5291503
</span><span class="w">
</span><span class="c1"># Now, do the same as before
</span></code></pre>
</div>

<h4 id="a-function-for-mean-count-standard-deviation-standard-error-of-the-mean-and-confidence-interval-1">A function for mean, count, standard deviation, standard error of the mean, and confidence interval</h4>

<p>Instead of manually specifying all the values you want and then calculating the standard error, as shown above, this function will handle all of those details. It will do all the things described here:</p>

<ul>
<li>Find the mean, standard deviation, and count (N)</li>
<li>Find the standard error of the mean (<strong><em>again, this may not be what you want if you are collapsing over a within-subject variable.</em></strong></li>
<li>Find a 95% confidence interval (or other value, if desired)</li>
<li>Rename the columns so that the resulting data frame is easier to work with</li>
</ul>

<p>To use, put this function in your code and call it as demonstrated below.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## Summarizes data.
## Gives count, mean, standard deviation, standard error of the mean, and confidence 
## interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
</span><span class="n">summarySE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">conf.interval</span><span class="o">=</span><span class="m">.95</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">doBy</span><span class="p">)</span><span class="w">

</span><span class="c1"># New version of length which can handle NA's: if na.rm==T, don't count them
</span><span class="w">    </span><span class="n">length2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">na.rm</span><span class="p">)</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
  </span><span class="k">else</span><span class="w">       </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Collapse the data
</span><span class="w">    </span><span class="n">formula</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">groupvars</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">" + "</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">" ~ "</span><span class="p">))</span><span class="w">
</span><span class="n">datac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summaryBy</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">length2</span><span class="p">,</span><span class="n">mean</span><span class="p">,</span><span class="n">sd</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">)</span><span class="w">

</span><span class="c1"># Rename columns
</span><span class="w">    </span><span class="nf">names</span><span class="p">(</span><span class="n">datac</span><span class="p">)[</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">datac</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="s2">".mean"</span><span class="p">,</span><span class="w">    </span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">measurevar</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">datac</span><span class="p">)[</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">datac</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="s2">".sd"</span><span class="p">,</span><span class="w">      </span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"sd"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">datac</span><span class="p">)[</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">datac</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="s2">".length2"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"N"</span><span class="w">

</span><span class="n">datac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">sd</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">datac</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w">  </span><span class="c1"># Calculate standard error of the mean
</span><span class="w">    
</span><span class="c1"># Confidence interval multiplier for standard error
</span><span class="w">    </span><span class="c1"># Calculate t-statistic for confidence interval: 
</span><span class="w">    </span><span class="c1"># e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
</span><span class="w">    </span><span class="n">ciMult</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="n">conf.interval</span><span class="o">/</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">N</span><span class="m">-1</span><span class="p">)</span><span class="w">
</span><span class="n">datac</span><span class="o">$</span><span class="n">ci</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ciMult</span><span class="w">

</span><span class="nf">return</span><span class="p">(</span><span class="n">datac</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Example usage (with 95% confidence interval). Instead of doing all the steps manually, as done previously, the <code class="highlighter-rouge">summarySE</code> function does it all in one step:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">summarySE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"change"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"condition"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N    change        sd        se        ci
#&gt; 1   F   aspirin  5 -3.420000 0.8642916 0.3865230 1.0731598
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867 0.3334201
#&gt; 3   M   aspirin  9 -5.411111 1.1307569 0.3769190 0.8691767
#&gt; 4   M   placebo  4 -0.975000 0.7804913 0.3902456 1.2419358
</span><span class="w">
</span><span class="c1"># With a data set with NA's, use na.rm=TRUE
</span><span class="n">summarySE</span><span class="p">(</span><span class="n">dataNA</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"change"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"condition"</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N    change        sd        se        ci
#&gt; 1   F   aspirin  4 -3.425000 0.9979145 0.4989572 1.5879046
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867 0.3334201
#&gt; 3   M   aspirin  7 -5.142857 1.0674848 0.4034713 0.9872588
#&gt; 4   M   placebo  3 -1.300000 0.5291503 0.3055050 1.3144821
</span></code></pre>
</div>

<h4 id="filling-empty-combinations-with-zeros-1">Filling empty combinations with zeros</h4>

<p>Sometimes there will be empty combinations of factors in the summary data frame – that is, combinations of factors that are possible, but don’t actually occur in the original data frame. It is often useful to automatically fill in those combinations in the summary data frame with zeros.</p>

<p>This function will fill in those missing combinations with zeros:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fillMissingCombs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">factors</span><span class="p">,</span><span class="w"> </span><span class="n">measures</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

</span><span class="c1"># Make a list of the combinations of factor levels
</span><span class="w">    </span><span class="n">levelList</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">factors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="n">levelList</span><span class="p">[[</span><span class="n">f</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="n">f</span><span class="p">])</span><span class="w">  </span><span class="p">}</span><span class="w">

</span><span class="n">fullFactors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">expand.grid</span><span class="p">(</span><span class="n">levelList</span><span class="p">)</span><span class="w">

</span><span class="n">dfFull</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">fullFactors</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">all.x</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Wherever there is an NA in the measure vars, replace with 0
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">measures</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">dfFull</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">dfFull</span><span class="p">[,</span><span class="n">m</span><span class="p">]),</span><span class="w"> </span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nf">return</span><span class="p">(</span><span class="n">dfFull</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Example usage:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># First remove some all Male+Placebo entries from the data
</span><span class="n">dataSub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">sex</span><span class="o">==</span><span class="s2">"M"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">condition</span><span class="o">==</span><span class="s2">"placebo"</span><span class="p">))</span><span class="w">

</span><span class="c1"># If we summarize the data, there will be a missing row for Male+Placebo,
# since there were no cases with this combination.
</span><span class="n">cdataSub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarySE</span><span class="p">(</span><span class="n">dataSub</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"change"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="w"> </span><span class="s2">"condition"</span><span class="p">))</span><span class="w">
</span><span class="n">cdataSub</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N    change        sd        se        ci
#&gt; 1   F   aspirin  5 -3.420000 0.8642916 0.3865230 1.0731598
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867 0.3334201
#&gt; 3   M   aspirin  9 -5.411111 1.1307569 0.3769190 0.8691767
</span><span class="w">
</span><span class="c1"># This will fill in the missing combinations with zeros
</span><span class="n">fillMissingCombs</span><span class="p">(</span><span class="n">cdataSub</span><span class="p">,</span><span class="w"> </span><span class="n">factors</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"condition"</span><span class="p">),</span><span class="w"> </span><span class="n">measures</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"N"</span><span class="p">,</span><span class="s2">"change"</span><span class="p">,</span><span class="s2">"sd"</span><span class="p">,</span><span class="s2">"se"</span><span class="p">,</span><span class="s2">"ci"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N    change        sd        se        ci
#&gt; 1   F   aspirin  5 -3.420000 0.8642916 0.3865230 1.0731598
#&gt; 2   F   placebo 12 -2.058333 0.5247655 0.1514867 0.3334201
#&gt; 3   M   aspirin  9 -5.411111 1.1307569 0.3769190 0.8691767
#&gt; 4   M   placebo  0  0.000000 0.0000000 0.0000000 0.0000000
</span></code></pre>
</div>

<h3 id="using-aggregate">Using aggregate</h3>

<p>The <code class="highlighter-rouge">aggregate</code> function is more difficult to use, but it is included in the base R installation and does not require the installation of another package.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Get a count of number of subjects in each category (sex*condition)
</span><span class="n">cdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"subject"</span><span class="p">],</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"condition"</span><span class="p">)],</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">length</span><span class="p">)</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition subject
#&gt; 1   F   aspirin       5
#&gt; 2   M   aspirin       9
#&gt; 3   F   placebo      12
#&gt; 4   M   placebo       4
</span><span class="w">
</span><span class="c1"># Rename "subject" column to "N"
</span><span class="nf">names</span><span class="p">(</span><span class="n">cdata</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">cdata</span><span class="p">)</span><span class="o">==</span><span class="s2">"subject"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"N"</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N
#&gt; 1   F   aspirin  5
#&gt; 2   M   aspirin  9
#&gt; 3   F   placebo 12
#&gt; 4   M   placebo  4
</span><span class="w">
</span><span class="c1"># Sort by sex first
</span><span class="n">cdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cdata</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">cdata</span><span class="o">$</span><span class="n">sex</span><span class="p">),]</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N
#&gt; 1   F   aspirin  5
#&gt; 3   F   placebo 12
#&gt; 2   M   aspirin  9
#&gt; 4   M   placebo  4
</span><span class="w">
</span><span class="c1"># We also keep the __before__ and __after__ columns:
# Get the average effect size by sex and condition
</span><span class="n">cdata.means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"before"</span><span class="p">,</span><span class="s2">"after"</span><span class="p">,</span><span class="s2">"change"</span><span class="p">)],</span><span class="w"> 
                   </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"condition"</span><span class="p">)],</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">cdata.means</span><span class="w">
</span><span class="c1">#&gt;   sex condition   before     after    change
#&gt; 1   F   aspirin 11.06000  7.640000 -3.420000
#&gt; 2   M   aspirin 11.26667  5.855556 -5.411111
#&gt; 3   F   placebo 10.13333  8.075000 -2.058333
#&gt; 4   M   placebo 11.47500 10.500000 -0.975000
</span><span class="w">
</span><span class="c1"># Merge the data frames
</span><span class="n">cdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">cdata</span><span class="p">,</span><span class="w"> </span><span class="n">cdata.means</span><span class="p">)</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N   before     after    change
#&gt; 1   F   aspirin  5 11.06000  7.640000 -3.420000
#&gt; 2   F   placebo 12 10.13333  8.075000 -2.058333
#&gt; 3   M   aspirin  9 11.26667  5.855556 -5.411111
#&gt; 4   M   placebo  4 11.47500 10.500000 -0.975000
</span><span class="w">
</span><span class="c1"># Get the sample (n-1) standard deviation for "change"
</span><span class="n">cdata.sd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"change"</span><span class="p">],</span><span class="w">
                </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"condition"</span><span class="p">)],</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">sd</span><span class="p">)</span><span class="w">
</span><span class="c1"># Rename the column to change.sd
</span><span class="nf">names</span><span class="p">(</span><span class="n">cdata.sd</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">cdata.sd</span><span class="p">)</span><span class="o">==</span><span class="s2">"change"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"change.sd"</span><span class="w">
</span><span class="n">cdata.sd</span><span class="w">
</span><span class="c1">#&gt;   sex condition change.sd
#&gt; 1   F   aspirin 0.8642916
#&gt; 2   M   aspirin 1.1307569
#&gt; 3   F   placebo 0.5247655
#&gt; 4   M   placebo 0.7804913
</span><span class="w">
</span><span class="c1"># Merge
</span><span class="n">cdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">cdata</span><span class="p">,</span><span class="w"> </span><span class="n">cdata.sd</span><span class="p">)</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N   before     after    change change.sd
#&gt; 1   F   aspirin  5 11.06000  7.640000 -3.420000 0.8642916
#&gt; 2   F   placebo 12 10.13333  8.075000 -2.058333 0.5247655
#&gt; 3   M   aspirin  9 11.26667  5.855556 -5.411111 1.1307569
#&gt; 4   M   placebo  4 11.47500 10.500000 -0.975000 0.7804913
</span><span class="w">
</span><span class="c1"># Calculate standard error of the mean
</span><span class="n">cdata</span><span class="o">$</span><span class="n">change.se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cdata</span><span class="o">$</span><span class="n">change.sd</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">cdata</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w">
</span><span class="n">cdata</span><span class="w">
</span><span class="c1">#&gt;   sex condition  N   before     after    change change.sd change.se
#&gt; 1   F   aspirin  5 11.06000  7.640000 -3.420000 0.8642916 0.3865230
#&gt; 2   F   placebo 12 10.13333  8.075000 -2.058333 0.5247655 0.1514867
#&gt; 3   M   aspirin  9 11.26667  5.855556 -5.411111 1.1307569 0.3769190
#&gt; 4   M   placebo  4 11.47500 10.500000 -0.975000 0.7804913 0.3902456
</span></code></pre>
</div>

<p>If you have <code class="highlighter-rouge">NA</code>’s in your data and wish to skip them, use <code class="highlighter-rouge">na.rm=TRUE</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">cdata.means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aggregate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"before"</span><span class="p">,</span><span class="s2">"after"</span><span class="p">,</span><span class="s2">"change"</span><span class="p">)],</span><span class="w"> 
                   </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span><span class="s2">"condition"</span><span class="p">)],</span><span class="w">
                   </span><span class="n">FUN</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">cdata.means</span><span class="w">
</span><span class="c1">#&gt;   sex condition   before     after    change
#&gt; 1   F   aspirin 11.06000  7.640000 -3.420000
#&gt; 2   M   aspirin 11.26667  5.855556 -5.411111
#&gt; 3   F   placebo 10.13333  8.075000 -2.058333
#&gt; 4   M   placebo 11.47500 10.500000 -0.975000
</span></code></pre>
</div>


</article>
<h2 class="post-title" id="topic-44">Converting between data frames and contingency tables</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to do convert between a data frame of cases, a data frame of counts of each <strong>type</strong> of case, and a contingency table.</p>

<h3 id="solution">Solution</h3>

<p>These three data structures represent the same information, but in different formats:</p>

<ul>
<li><code class="highlighter-rouge">cases</code>: A data frame where each row represents one <strong><em>case</em></strong>.</li>
<li><code class="highlighter-rouge">ctable</code>: A <strong><em>contingency table</em></strong>.</li>
<li><code class="highlighter-rouge">counts</code> A data frame of counts, where each row represents the count of each <strong><em>combination</em></strong>.</li>
</ul>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Each row represents one case
</span><span class="n">cases</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">Sex</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w"> </span><span class="s2">"F"</span><span class="p">),</span><span class="w"> 
</span><span class="n">Color</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"brown"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"brown"</span><span class="p">,</span><span class="w"> </span><span class="s2">"brown"</span><span class="p">,</span><span class="w"> </span><span class="s2">"brown"</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">cases</span><span class="w">
</span><span class="c1">#&gt;   Sex Color
#&gt; 1   M brown
#&gt; 2   M  blue
#&gt; 3   F brown
#&gt; 4   F brown
#&gt; 5   F brown
</span><span class="w">
</span><span class="c1"># A contingency table
</span><span class="n">ctable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">cases</span><span class="p">)</span><span class="w">
</span><span class="n">ctable</span><span class="w">
</span><span class="c1">#&gt;    Color
#&gt; Sex blue brown
#&gt;   F    0     3
#&gt;   M    1     1
</span><span class="w">
</span><span class="c1"># A table with counts of each combination
</span><span class="n">counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">Sex</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"F"</span><span class="p">,</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w"> </span><span class="s2">"M"</span><span class="p">),</span><span class="w"> 
</span><span class="n">Color</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"brown"</span><span class="p">,</span><span class="w"> </span><span class="s2">"brown"</span><span class="p">),</span><span class="w">
</span><span class="n">Freq</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">counts</span><span class="w">
</span><span class="c1">#&gt;   Sex Color Freq
#&gt; 1   F  blue    0
#&gt; 2   M  blue    1
#&gt; 3   F brown    3
#&gt; 4   M brown    1
</span></code></pre>
</div>

<h3 id="cases-to-contingency-table">Cases to contingency table</h3>

<p>To convert from cases to contingency table (this is already shown above):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Cases to Table
</span><span class="n">ctable</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">cases</span><span class="p">)</span><span class="w">
</span><span class="n">ctable</span><span class="w">
</span><span class="c1">#&gt;    Color
#&gt; Sex blue brown
#&gt;   F    0     3
#&gt;   M    1     1
</span><span class="w">
</span><span class="c1"># If you call table using two vectors, it will not add names (Sex and Color) to
# the dimensions.
</span><span class="n">table</span><span class="p">(</span><span class="n">cases</span><span class="o">$</span><span class="n">Sex</span><span class="p">,</span><span class="w"> </span><span class="n">cases</span><span class="o">$</span><span class="n">Color</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    
#&gt;     blue brown
#&gt;   F    0     3
#&gt;   M    1     1
</span><span class="w">
</span><span class="c1"># The dimension names can be specified manually with `dnn`, or by using a subset
# of the data frame that contains only the desired columns.
</span><span class="n">table</span><span class="p">(</span><span class="n">cases</span><span class="o">$</span><span class="n">Sex</span><span class="p">,</span><span class="w"> </span><span class="n">cases</span><span class="o">$</span><span class="n">Color</span><span class="p">,</span><span class="w"> </span><span class="n">dnn</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Sex"</span><span class="p">,</span><span class="s2">"Color"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;    Color
#&gt; Sex blue brown
#&gt;   F    0     3
#&gt;   M    1     1
</span><span class="n">table</span><span class="p">(</span><span class="n">cases</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Sex"</span><span class="p">,</span><span class="s2">"Color"</span><span class="p">)])</span><span class="w">
</span><span class="c1">#&gt;    Color
#&gt; Sex blue brown
#&gt;   F    0     3
#&gt;   M    1     1
</span></code></pre>
</div>

<h3 id="cases-to-counts">Cases to counts</h3>

<p>It can also be represented as a data frame of <strong><em>counts</em></strong> of each combination. Note that it’s converted here and stored in <code class="highlighter-rouge">countdf</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Cases to Counts
</span><span class="n">countdf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">cases</span><span class="p">))</span><span class="w">
</span><span class="n">countdf</span><span class="w">
</span><span class="c1">#&gt;   Sex Color Freq
#&gt; 1   F  blue    0
#&gt; 2   M  blue    1
#&gt; 3   F brown    3
#&gt; 4   M brown    1
</span></code></pre>
</div>

<h3 id="contingency-table-to-cases">Contingency table to cases</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">countsToCases</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">ctable</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;     Sex Color
#&gt; 2     M  blue
#&gt; 3     F brown
#&gt; 3.1   F brown
#&gt; 3.2   F brown
#&gt; 4     M brown
</span></code></pre>
</div>

<p>Note that the expand.dft function is defined below.</p>

<h3 id="contingency-table-to-counts">Contingency table to counts</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">as.data.frame</span><span class="p">(</span><span class="n">ctable</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   Sex Color Freq
#&gt; 1   F  blue    0
#&gt; 2   M  blue    1
#&gt; 3   F brown    3
#&gt; 4   M brown    1
</span></code></pre>
</div>

<h3 id="counts-to-cases">Counts to cases</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">countsToCases</span><span class="p">(</span><span class="n">countdf</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;     Sex Color
#&gt; 2     M  blue
#&gt; 3     F brown
#&gt; 3.1   F brown
#&gt; 3.2   F brown
#&gt; 4     M brown
</span></code></pre>
</div>

<p>Note that the <code class="highlighter-rouge">countsToCases</code> function is defined below.</p>

<h3 id="counts-to-contingency-table">Counts to contingency table</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">xtabs</span><span class="p">(</span><span class="n">Freq</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Sex</span><span class="o">+</span><span class="n">Color</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">countdf</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    Color
#&gt; Sex blue brown
#&gt;   F    0     3
#&gt;   M    1     1
</span></code></pre>
</div>

<h3 id="countstocases-function"><code class="highlighter-rouge">countsToCases()</code> function</h3>

<p>This function is used in the examples above:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Convert from data frame of counts to data frame of cases.
# `countcol` is the name of the column containing the counts
</span><span class="n">countsToCases</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">countcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Freq"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="c1"># Get the row indices to pull from x
</span><span class="w">    </span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rep.int</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="w"> </span><span class="n">x</span><span class="p">[[</span><span class="n">countcol</span><span class="p">]])</span><span class="w">

</span><span class="c1"># Drop count column
</span><span class="w">    </span><span class="n">x</span><span class="p">[[</span><span class="n">countcol</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">

</span><span class="c1"># Get the rows from x
</span><span class="w">    </span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>


</article>
<h2 class="post-title" id="topic-45">Calculating a moving average</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to calculate a moving average.</p>

<h3 id="solution">Solution</h3>

<p>Suppose your data is a noisy sine wave with some missing values:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">993</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">300</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">300</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">.1</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="p">[</span><span class="m">251</span><span class="o">:</span><span class="m">255</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span></code></pre>
</div>

<p>The <code class="highlighter-rouge">filter()</code> function can be used to calculate a moving average.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Plot the unsmoothed data (gray)
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">grey</span><span class="p">(</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span><span class="c1"># Draw gridlines
</span><span class="n">grid</span><span class="p">()</span><span class="w">

</span><span class="c1"># Smoothed with lag:
# average of current sample and 19 previous samples (red)
</span><span class="n">f</span><span class="m">20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="n">f</span><span class="m">20</span><span class="w">
</span><span class="c1">#&gt;  [1] 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05
#&gt; [18] 0.05 0.05 0.05
</span><span class="n">y_lag</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y_lag</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Smoothed symmetrically:
# average of current sample, 10 future samples, and 10 past samples (blue)
</span><span class="n">f</span><span class="m">21</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">21</span><span class="p">,</span><span class="m">21</span><span class="p">)</span><span class="w">
</span><span class="n">f</span><span class="m">21</span><span class="w">
</span><span class="c1">#&gt;  [1] 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905
#&gt;  [8] 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905
#&gt; [15] 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905 0.04761905
</span><span class="n">y_sym</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y_sym</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Manipulating_data/Calculating_a_moving_average/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2"></p>

<p><code class="highlighter-rouge">filter()</code> will leave holes wherever it encounters missing values, as shown in the graph above.</p>

<p>A different way to handle missing data is to simply ignore it, and not include it in the average. The function defined here will do that.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># x: the vector
# n: the number of samples
# centered: if FALSE, then average current sample and previous (n-1) samples
#           if TRUE, then average symmetrically in past and future. (If n is even, use one more sample from future.)
</span><span class="n">movingAverage</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">centered</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">centered</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">before</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">floor</span><span class="w">  </span><span class="p">((</span><span class="n">n</span><span class="m">-1</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">after</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">((</span><span class="n">n</span><span class="m">-1</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">before</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n</span><span class="m">-1</span><span class="w">
  </span><span class="n">after</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Track the sum and count of number of non-NA items
</span><span class="w">    </span><span class="n">s</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">

</span><span class="c1"># Add the centered data 
</span><span class="w">    </span><span class="n">new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w">
</span><span class="c1"># Add to count list wherever there isn't a 
</span><span class="w">    </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="w">
</span><span class="c1"># Now replace NA_s with 0_s and add to total
</span><span class="w">    </span><span class="n">new</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">new</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">new</span><span class="w">

</span><span class="c1"># Add the data from before
</span><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">before</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># This is the vector with offset values to add
</span><span class="w">        </span><span class="n">new</span><span class="w">   </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">i</span><span class="p">)])</span><span class="w">

  </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="w">
  </span><span class="n">new</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">new</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">new</span><span class="w">
  
  </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="m">+1</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Add the data from after
</span><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">after</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># This is the vector with offset values to add
</span><span class="w">        </span><span class="n">new</span><span class="w">   </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="p">[(</span><span class="n">i</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)],</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">))</span><span class="w">
 
  </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="w">
  </span><span class="n">new</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">new</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">new</span><span class="w">
  
  </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="m">+1</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># return sum divided by count
</span><span class="w">    </span><span class="n">s</span><span class="o">/</span><span class="n">count</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="c1"># Make same plots from before, with thicker lines
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">grey</span><span class="p">(</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span><span class="n">grid</span><span class="p">()</span><span class="w">
</span><span class="n">y_lag</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">),</span><span class="w"> </span><span class="n">sides</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y_lag</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">         </span><span class="c1"># Lagged average in red
</span><span class="n">y_sym</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="m">21</span><span class="p">,</span><span class="m">21</span><span class="p">),</span><span class="w"> </span><span class="n">sides</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y_sym</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">        </span><span class="c1"># Symmetrical average in blue
</span><span class="w">
</span><span class="c1"># Calculate lagged moving average with new method and overplot with green
</span><span class="n">y_lag_na.rm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">movingAverage</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y_lag_na.rm</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="c1"># Calculate symmetrical moving average  with new method and overplot with green
</span><span class="n">y_sym_na.rm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">movingAverage</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y_sym_na.rm</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Manipulating_data/Calculating_a_moving_average/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>

</article>
<h2 class="post-title" id="topic-46">Averaging a sequence in blocks</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to chop a sequence of data into blocks of a given length, and find the average of each block. This is one way of smoothing data.</p>

<h3 id="solution">Solution</h3>

<p>Suppose you have a numeric vector and want to find the average of the first four numbers, the second four, and so on.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Generate a vector with 22 random numbers from 0-99
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">22</span><span class="p">)</span><span class="o">*</span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt;  [1] 28 78 40 88 94  4 52 89 55 45 95 45 67 57 10 89 24  4 32 95 88 69
</span><span class="w">
</span><span class="c1"># Round up the length of vector the to the nearest 4
</span><span class="n">newlength</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="m">4</span><span class="p">)</span><span class="o">*</span><span class="m">4</span><span class="w">
</span><span class="n">newlength</span><span class="w">
</span><span class="c1">#&gt; [1] 24
</span><span class="w">
</span><span class="c1"># Pad x with NA's up to the new length
</span><span class="n">x</span><span class="p">[</span><span class="n">newlength</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt;  [1] 28 78 40 88 94  4 52 89 55 45 95 45 67 57 10 89 24  4 32 95 88 69 NA NA
</span><span class="w">
</span><span class="c1"># Convert to a matrix with 4 rows
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6]
#&gt; [1,]   28   94   55   67   24   88
#&gt; [2,]   78    4   45   57    4   69
#&gt; [3,]   40   52   95   10   32   NA
#&gt; [4,]   88   89   45   89   95   NA
</span><span class="w">
</span><span class="c1"># Take the means of the columns, and ignore any NA's
</span><span class="n">colMeans</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 58.50 59.75 60.00 55.75 38.75 78.50
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-47">Finding sequences of identical values</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to find sequences of identical values in a vector or factor.</p>

<h3 id="solution">Solution</h3>

<p>It is possible to search for sequences of identical values by simply iterating over a vector, but this is very slow in R. A much faster way to find sequences is to use the <code class="highlighter-rouge">rle()</code> function.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Example data
</span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="s2">"C"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="s2">"C"</span><span class="p">,</span><span class="s2">"C"</span><span class="p">)</span><span class="w">
</span><span class="n">v</span><span class="w">
</span><span class="c1">#&gt;  [1] "A" "A" "A" "B" "B" "B" "B" NA  NA  "C" "C" "B" "C" "C" "C"
</span><span class="w">
</span><span class="n">vr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rle</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w">
</span><span class="n">vr</span><span class="w">
</span><span class="c1">#&gt; Run Length Encoding
#&gt;   lengths: int [1:7] 3 4 1 1 2 1 3
#&gt;   values : chr [1:7] "A" "B" NA NA "C" "B" "C"
</span></code></pre>
</div>

<p>The RLE coded data can be converted back to a vector with <code class="highlighter-rouge">inverse.rle()</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">inverse.rle</span><span class="p">(</span><span class="n">vr</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] "A" "A" "A" "B" "B" "B" "B" NA  NA  "C" "C" "B" "C" "C" "C"
</span></code></pre>
</div>

<p>One issue that might be problematic is that each <code class="highlighter-rouge">NA</code> is treated as a run of length 1, even if the <code class="highlighter-rouge">NA</code>’s are next to each other. It is possible to work around this by replacing the <code class="highlighter-rouge">NA</code>’s with some special designated value. For numeric vectors, <code class="highlighter-rouge">Inf</code> or some other number can be used; for character vectors, any string may be used. Of course, the special value must not appear otherwise in the vector.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">w</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">v</span><span class="w">
</span><span class="n">w</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">w</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"ZZZ"</span><span class="w">
</span><span class="n">w</span><span class="w">
</span><span class="c1">#&gt;  [1] "A"   "A"   "A"   "B"   "B"   "B"   "B"   "ZZZ" "ZZZ" "C"   "C"   "B"   "C"   "C"  
#&gt; [15] "C"
</span><span class="w">
</span><span class="n">wr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rle</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
</span><span class="n">wr</span><span class="w">
</span><span class="c1">#&gt; Run Length Encoding
#&gt;   lengths: int [1:6] 3 4 2 2 1 3
#&gt;   values : chr [1:6] "A" "B" "ZZZ" "C" "B" "C"
</span><span class="w">
</span><span class="c1"># Replace the ZZZ's with NA in the RLE-coded data
</span><span class="n">wr</span><span class="o">$</span><span class="n">values</span><span class="p">[</span><span class="w"> </span><span class="n">wr</span><span class="o">$</span><span class="n">values</span><span class="o">==</span><span class="s2">"ZZZ"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">wr</span><span class="w">
</span><span class="c1">#&gt; Run Length Encoding
#&gt;   lengths: int [1:6] 3 4 2 2 1 3
#&gt;   values : chr [1:6] "A" "B" NA "C" "B" "C"
</span><span class="w">
</span><span class="n">w</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inverse.rle</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span><span class="w">
</span><span class="n">w</span><span class="m">2</span><span class="w">
</span><span class="c1">#&gt;  [1] "A" "A" "A" "B" "B" "B" "B" NA  NA  "C" "C" "B" "C" "C" "C"
</span></code></pre>
</div>

<h3 id="working-with-factors">Working with factors</h3>

<p>Even though factors are basically just integer vectors with some information about levels attached, the <code class="highlighter-rouge">rle()</code> function doesn’t work with factors. The solution is to manually convert the factor to an integer vector or a character vector. Using an integer vector is fast and memory-efficient, which may matter for large data sets, but it is difficult to interpret. Using a character vector is slower and requires more memory, but can be much easier to interpret.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Suppose this is the factor we have to work with
</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w">
</span><span class="n">f</span><span class="w">
</span><span class="c1">#&gt;  [1] A    A    A    B    B    B    B    &lt;NA&gt; &lt;NA&gt; C    C    B    C    C    C   
#&gt; Levels: A B C
</span><span class="w">
</span><span class="c1"># Store the levels in the factor.
# This isn't strictly necessary, but it is useful for preserving order of levels
</span><span class="n">f_levels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="n">f_levels</span><span class="w">
</span><span class="c1">#&gt; [1] "A" "B" "C"
</span><span class="w">
</span><span class="n">fc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">
</span><span class="n">fc</span><span class="p">[</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"ZZZ"</span><span class="w">
</span><span class="n">fc</span><span class="w">
</span><span class="c1">#&gt;  [1] "A"   "A"   "A"   "B"   "B"   "B"   "B"   "ZZZ" "ZZZ" "C"   "C"   "B"   "C"   "C"  
#&gt; [15] "C"
</span><span class="w">
</span><span class="n">fr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rle</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span><span class="w">
</span><span class="n">fr</span><span class="w">
</span><span class="c1">#&gt; Run Length Encoding
#&gt;   lengths: int [1:6] 3 4 2 2 1 3
#&gt;   values : chr [1:6] "A" "B" "ZZZ" "C" "B" "C"
</span><span class="w">
</span><span class="c1"># Replace the ZZZ's with NA in the RLE-coded data
</span><span class="n">fr</span><span class="o">$</span><span class="n">values</span><span class="p">[</span><span class="w"> </span><span class="n">fr</span><span class="o">$</span><span class="n">values</span><span class="o">==</span><span class="s2">"ZZZ"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">fr</span><span class="w">
</span><span class="c1">#&gt; Run Length Encoding
#&gt;   lengths: int [1:6] 3 4 2 2 1 3
#&gt;   values : chr [1:6] "A" "B" NA "C" "B" "C"
</span><span class="w">
</span><span class="c1"># Invert RLE coding and convert back to a factor
</span><span class="n">f</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inverse.rle</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span><span class="w">
</span><span class="n">f</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">f_levels</span><span class="p">)</span><span class="w">
</span><span class="n">f</span><span class="m">2</span><span class="w">
</span><span class="c1">#&gt;  [1] A    A    A    B    B    B    B    &lt;NA&gt; &lt;NA&gt; C    C    B    C    C    C   
#&gt; Levels: A B C
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-48">Filling in NAs with last non-NA value</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to replace <code class="highlighter-rouge">NA</code>’s in a vector or factor with the last non-NA value.</p>

<h3 id="solution">Solution</h3>

<p>This code shows how to fill gaps in a vector. If you need to do this repeatedly, see the function below. The function also can fill in leading <code class="highlighter-rouge">NA</code>’s with the first good value and handle factors properly.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Sample data
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">)</span><span class="w">

</span><span class="n">goodIdx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">goodIdx</span><span class="w">
</span><span class="c1">#&gt;  [1] FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE
#&gt; [15]  TRUE  TRUE FALSE FALSE
</span><span class="w">
</span><span class="c1"># These are the non-NA values from x only
# Add a leading NA for later use when we index into this vector
</span><span class="n">goodVals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">goodIdx</span><span class="p">])</span><span class="w">
</span><span class="n">goodVals</span><span class="w">
</span><span class="c1">#&gt;  [1] NA  "A" "A" "B" "B" "B" "C" "A" "A" "B"
</span><span class="w">
</span><span class="c1"># Fill the indices of the output vector with the indices pulled from
# these offsets of goodVals. Add 1 to avoid indexing to zero.
</span><span class="n">fillIdx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">goodIdx</span><span class="p">)</span><span class="m">+1</span><span class="w">
</span><span class="n">fillIdx</span><span class="w">
</span><span class="c1">#&gt;  [1]  1  1  2  3  4  5  6  6  6  7  7  7  7  8  9 10 10 10
</span><span class="w">
</span><span class="c1"># The original vector with gaps filled
</span><span class="n">goodVals</span><span class="p">[</span><span class="n">fillIdx</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt;  [1] NA  NA  "A" "A" "B" "B" "B" "B" "B" "C" "C" "C" "C" "A" "A" "B" "B" "B"
</span></code></pre>
</div>

<h3 id="a-function-for-filling-gaps">A function for filling gaps</h3>

<p>This function does the same as the code above. It can also fill leading <code class="highlighter-rouge">NA</code>’s with the first good value, and handle factors properly.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fillNAgaps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">firstBack</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="c1">## NA's in a vector or factor are replaced with last non-NA values
</span><span class="w">    </span><span class="c1">## If firstBack is TRUE, it will fill in leading NA's with the first
</span><span class="w">    </span><span class="c1">## non-NA value. If FALSE, it will not change leading NA's.
</span><span class="w">    
</span><span class="c1"># If it's a factor, store the level labels and convert to integer
</span><span class="w">    </span><span class="n">lvls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is.factor</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">lvls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
  </span><span class="n">x</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
 
</span><span class="n">goodIdx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
 
</span><span class="c1"># These are the non-NA values from x only
</span><span class="w">    </span><span class="c1"># Add a leading NA or take the first good value, depending on firstBack   
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstBack</span><span class="p">)</span><span class="w">   </span><span class="n">goodVals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">goodIdx</span><span class="p">][</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">goodIdx</span><span class="p">])</span><span class="w">
</span><span class="k">else</span><span class="w">             </span><span class="n">goodVals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w">            </span><span class="n">x</span><span class="p">[</span><span class="n">goodIdx</span><span class="p">])</span><span class="w">

</span><span class="c1"># Fill the indices of the output vector with the indices pulled from
</span><span class="w">    </span><span class="c1"># these offsets of goodVals. Add 1 to avoid indexing to zero.
</span><span class="w">    </span><span class="n">fillIdx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">goodIdx</span><span class="p">)</span><span class="m">+1</span><span class="w">

</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">goodVals</span><span class="p">[</span><span class="n">fillIdx</span><span class="p">]</span><span class="w">

</span><span class="c1"># If it was originally a factor, convert it back
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">lvls</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">seq_along</span><span class="p">(</span><span class="n">lvls</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="n">lvls</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">x</span><span class="w">
</span><span class="p">}</span><span class="w">



</span><span class="c1"># Sample data
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="kc">NA</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span><span class="c1">#&gt;  [1] NA  NA  "A" "A" "B" "B" "B" NA  NA  "C" NA  NA  NA  "A" "A" "B" NA  NA
</span><span class="w">
</span><span class="n">fillNAgaps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] NA  NA  "A" "A" "B" "B" "B" "B" "B" "C" "C" "C" "C" "A" "A" "B" "B" "B"
</span><span class="w">
</span><span class="c1"># Fill the leading NA's with the first good value
</span><span class="n">fillNAgaps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">firstBack</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] "A" "A" "A" "A" "B" "B" "B" "B" "B" "C" "C" "C" "C" "A" "A" "B" "B" "B"
</span><span class="w">
</span><span class="c1"># It also works on factors
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w">
</span><span class="c1">#&gt;  [1] &lt;NA&gt; &lt;NA&gt; A    A    B    B    B    &lt;NA&gt; &lt;NA&gt; C    &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; A    A    B    &lt;NA&gt;
#&gt; [18] &lt;NA&gt;
#&gt; Levels: A B C
</span><span class="w">
</span><span class="n">fillNAgaps</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] &lt;NA&gt; &lt;NA&gt; A    A    B    B    B    B    B    C    C    C    C    A    A    B    B   
#&gt; [18] B   
#&gt; Levels: A B C
</span></code></pre>
</div>

<h3 id="notes">Notes</h3>

<p>This is adapted from <code class="highlighter-rouge">na.locf()</code> in the <strong>zoo</strong> library.</p>

</article>
<h2 class="post-title" id="topic-49">Regression and correlation</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to perform linear regressions and/or correlations.</p>

<h3 id="solution">Solution</h3>

<p>Some sample data to work with:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make some data
# X increases (noisily)
# Z increases slowly
# Y is constructed so it is inversely related to xvar and positively related to xvar*zvar
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">955</span><span class="p">)</span><span class="w">
</span><span class="n">xvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">zvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="o">/</span><span class="m">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">yvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-2</span><span class="o">*</span><span class="n">xvar</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xvar</span><span class="o">*</span><span class="n">zvar</span><span class="o">/</span><span class="m">5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make a data frame with the variables
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="o">=</span><span class="n">zvar</span><span class="p">)</span><span class="w">
</span><span class="c1"># Show first few rows
</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;           x           y           z
#&gt; 1 -4.252354   4.5857688  1.89877152
#&gt; 2  1.702318  -4.9027824 -0.82937359
#&gt; 3  4.323054  -4.3076433 -1.31283495
#&gt; 4  1.780628   0.2050367 -0.28479448
#&gt; 5 11.537348 -29.7670502 -1.27303976
#&gt; 6  6.672130 -10.1458220 -0.09459239
</span></code></pre>
</div>

<h3 id="correlation">Correlation</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Correlation coefficient
</span><span class="n">cor</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] -0.7695378
</span></code></pre>
</div>

<h3 id="correlation-matrices-for-multiple-variables">Correlation matrices (for multiple variables)</h3>
<p>It is also possible to run correlations between many pairs of variables, using a matrix or data frame.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A correlation matrix of the variables
</span><span class="n">cor</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;            x            y           z
#&gt; x  1.0000000 -0.769537849 0.491698938
#&gt; y -0.7695378  1.000000000 0.004172295
#&gt; z  0.4916989  0.004172295 1.000000000
</span><span class="w">

</span><span class="c1"># Print with only two decimal places
</span><span class="nf">round</span><span class="p">(</span><span class="n">cor</span><span class="p">(</span><span class="n">dat</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;       x     y    z
#&gt; x  1.00 -0.77 0.49
#&gt; y -0.77  1.00 0.00
#&gt; z  0.49  0.00 1.00
</span></code></pre>
</div>

</p>

<h3 id="linear-regression">Linear regression</h3>

<p>Linear regressions, where <code class="highlighter-rouge">dat$x</code> is the predictor, and <code class="highlighter-rouge">dat$y</code> is the outcome. This can be done using two columns from a data frame, or with numeric vectors directly.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># These two commands will have the same outcome:
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">)</span><span class="w">  </span><span class="c1"># Using the columns x and y from the data frame
</span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">x</span><span class="p">)</span><span class="w">     </span><span class="c1"># Using the vectors dat$x and dat$y
</span><span class="n">fit</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; lm(formula = dat$y ~ dat$x)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)        dat$x  
#&gt;     -0.2278      -1.1829
</span><span class="w">
</span><span class="c1"># This means that the predicted y = -0.2278 - 1.1829*x
</span><span class="w">

</span><span class="c1"># Get more detailed information:
</span><span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; lm(formula = dat$y ~ dat$x)
#&gt; 
#&gt; Residuals:
#&gt;      Min       1Q   Median       3Q      Max 
#&gt; -15.8922  -2.5114   0.2866   4.4646   9.3285 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  -0.2278     2.6323  -0.087    0.932    
#&gt; dat$x        -1.1829     0.2314  -5.113 7.28e-05 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 6.506 on 18 degrees of freedom
#&gt; Multiple R-squared:  0.5922,	Adjusted R-squared:  0.5695 
#&gt; F-statistic: 26.14 on 1 and 18 DF,  p-value: 7.282e-05
</span></code></pre>
</div>


<h3 id="linear-regression-with-multiple-predictors">Linear regression with multiple predictors</h3>

<p>Linear regression with <code class="highlighter-rouge">y</code> as the outcome, and <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">z</code> as predictors.</p>

<p>Note that the formula specified below does <strong>not</strong> test for interactions between x and z.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># These have the same result
</span><span class="n">fit2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">)</span><span class="w">    </span><span class="c1"># Using the columns x, y, and z from the data frame
</span><span class="n">fit2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">z</span><span class="p">)</span><span class="w">  </span><span class="c1"># Using the vectors x, y, z
</span><span class="n">fit2</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; lm(formula = dat$y ~ dat$x + dat$z)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)        dat$x        dat$z  
#&gt;      -1.382       -1.564        1.858
</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">fit2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; lm(formula = dat$y ~ dat$x + dat$z)
#&gt; 
#&gt; Residuals:
#&gt;    Min     1Q Median     3Q    Max 
#&gt; -7.974 -3.187 -1.205  3.847  7.524 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  -1.3816     1.9878  -0.695  0.49644    
#&gt; dat$x        -1.5642     0.1984  -7.883 4.46e-07 ***
#&gt; dat$z         1.8578     0.4753   3.908  0.00113 ** 
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 4.859 on 17 degrees of freedom
#&gt; Multiple R-squared:  0.7852,	Adjusted R-squared:  0.7599 
#&gt; F-statistic: 31.07 on 2 and 17 DF,  p-value: 2.1e-06
</span></code></pre>
</div>

<h4 id="interactions">Interactions</h4>

<p>The topic of how to properly do multiple regression and test for interactions can be quite complex and is not covered here. Here we just fit a model with x, z, and the interaction between the two.</p>

<p>To model interactions between <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">z</code>, a <code class="highlighter-rouge">x:z</code> term must be added. Alternatively, the formula <code class="highlighter-rouge">x*z</code> expands to <code class="highlighter-rouge">x+z+x:z</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># These are equivalent; the x*z expands to x + z + x:z
</span><span class="n">fit3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">)</span><span class="w"> 
</span><span class="n">fit3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">)</span><span class="w"> 
</span><span class="n">fit3</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; lm(formula = y ~ x + z + x:z, data = dat)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)            x            z          x:z  
#&gt;      2.2820      -2.1311      -0.1068       0.2081
</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">fit3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; lm(formula = y ~ x + z + x:z, data = dat)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -5.3045 -3.5998  0.3926  2.1376  8.3957 
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  2.28204    2.20064   1.037   0.3152    
#&gt; x           -2.13110    0.27406  -7.776    8e-07 ***
#&gt; z           -0.10682    0.84820  -0.126   0.9013    
#&gt; x:z          0.20814    0.07874   2.643   0.0177 *  
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; Residual standard error: 4.178 on 16 degrees of freedom
#&gt; Multiple R-squared:  0.8505,	Adjusted R-squared:  0.8225 
#&gt; F-statistic: 30.34 on 3 and 16 DF,  p-value: 7.759e-07
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-50">t-test</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to test whether two samples are drawn from populations with different means, or test whether one sample is drawn from a population with a mean different from some theoretical mean.</p>

<h3 id="solution">Solution</h3>

<h3 id="sample-data">Sample data</h3>

<p>We will use the built-in <code class="highlighter-rouge">sleep</code> data set.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sleep</span><span class="w">
</span><span class="c1">#&gt;    extra group ID
#&gt; 1    0.7     1  1
#&gt; 2   -1.6     1  2
#&gt; 3   -0.2     1  3
#&gt; 4   -1.2     1  4
#&gt; 5   -0.1     1  5
#&gt; 6    3.4     1  6
#&gt; 7    3.7     1  7
#&gt; 8    0.8     1  8
#&gt; 9    0.0     1  9
#&gt; 10   2.0     1 10
#&gt; 11   1.9     2  1
#&gt; 12   0.8     2  2
#&gt; 13   1.1     2  3
#&gt; 14   0.1     2  4
#&gt; 15  -0.1     2  5
#&gt; 16   4.4     2  6
#&gt; 17   5.5     2  7
#&gt; 18   1.6     2  8
#&gt; 19   4.6     2  9
#&gt; 20   3.4     2 10
</span></code></pre>
</div>

<p>We’ll also make a wide version of the <code class="highlighter-rouge">sleep</code> data; below we’ll see how to work with data in both long and wide formats.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sleep_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">ID</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w">
</span><span class="n">group1</span><span class="o">=</span><span class="n">sleep</span><span class="o">$</span><span class="n">extra</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">],</span><span class="w">
</span><span class="n">group2</span><span class="o">=</span><span class="n">sleep</span><span class="o">$</span><span class="n">extra</span><span class="p">[</span><span class="m">11</span><span class="o">:</span><span class="m">20</span><span class="p">]</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">sleep_wide</span><span class="w">
</span><span class="c1">#&gt;    ID group1 group2
#&gt; 1   1    0.7    1.9
#&gt; 2   2   -1.6    0.8
#&gt; 3   3   -0.2    1.1
#&gt; 4   4   -1.2    0.1
#&gt; 5   5   -0.1   -0.1
#&gt; 6   6    3.4    4.4
#&gt; 7   7    3.7    5.5
#&gt; 8   8    0.8    1.6
#&gt; 9   9    0.0    4.6
#&gt; 10 10    2.0    3.4
</span></code></pre>
</div>

<h3 id="comparing-two-groups-independent-two-sample-t-test">Comparing two groups: independent two-sample t-test</h3>

<p>Suppose the two groups are independently sampled; we’ll ignore the ID variable for the purposes here.</p>

<p>The <code class="highlighter-rouge">t.test</code> function can operate on long-format data like <code class="highlighter-rouge">sleep</code>, where one column (<code class="highlighter-rouge">extra</code>) records the measurement, and the other column (<code class="highlighter-rouge">group</code>) specifies the grouping; or it can operate on two separate vectors.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Welch t-test
</span><span class="n">t.test</span><span class="p">(</span><span class="n">extra</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">sleep</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Welch Two Sample t-test
#&gt; 
#&gt; data:  extra by group
#&gt; t = -1.8608, df = 17.776, p-value = 0.07939
#&gt; alternative hypothesis: true difference in means is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  -3.3654832  0.2054832
#&gt; sample estimates:
#&gt; mean in group 1 mean in group 2 
#&gt;            0.75            2.33
</span><span class="w">
</span><span class="c1"># Same for wide data (two separate vectors)
# t.test(sleep_wide$group1, sleep_wide$group2)
</span></code></pre>
</div>

<p>By default, <code class="highlighter-rouge">t.test</code> does <strong><em>not</em></strong> assume equal variances; instead of Student’s t-test, it uses the Welch t-test by default. Note that in the Welch t-test, df=17.776, because of the adjustment for unequal variances. To use Student’s t-test, set <code class="highlighter-rouge">var.equal=TRUE</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Student t-test
</span><span class="n">t.test</span><span class="p">(</span><span class="n">extra</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">sleep</span><span class="p">,</span><span class="w"> </span><span class="n">var.equal</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Two Sample t-test
#&gt; 
#&gt; data:  extra by group
#&gt; t = -1.8608, df = 18, p-value = 0.07919
#&gt; alternative hypothesis: true difference in means is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  -3.363874  0.203874
#&gt; sample estimates:
#&gt; mean in group 1 mean in group 2 
#&gt;            0.75            2.33
</span><span class="w">
</span><span class="c1"># Same for wide data (two separate vectors)
# t.test(sleep_wide$group1, sleep_wide$group2, var.equal=TRUE)
</span></code></pre>
</div>

<h3 id="paired-sample-t-test">Paired-sample t-test</h3>

<p>You can also compare paired data, using a paired-sample t-test. You might have observations before and after a treatment, or of two matched subjects with different treatments.</p>

<p>Again, the <code class="highlighter-rouge">t-test</code> function can be used on a data frame with a grouping variable, or on two vectors. It relies the relative position to determine the pairing. If you are using long-format data with a grouping variable, the first row with group=1 is paired with the first row with group=2. It is important to make sure that the data is sorted and there are not missing observations; otherwise the pairing can be thrown off. In this case, we can sort by the <code class="highlighter-rouge">group</code> and <code class="highlighter-rouge">ID</code> variables to ensure that the order is the same. For more on sorting see <a href="../../Manipulating_data/Sorting">Sorting</a>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Sort by group then ID
</span><span class="n">sleep</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sleep</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">sleep</span><span class="o">$</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">sleep</span><span class="o">$</span><span class="n">ID</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># Paired t-test
</span><span class="n">t.test</span><span class="p">(</span><span class="n">extra</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">sleep</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Paired t-test
#&gt; 
#&gt; data:  extra by group
#&gt; t = -4.0621, df = 9, p-value = 0.002833
#&gt; alternative hypothesis: true difference in means is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  -2.4598858 -0.7001142
#&gt; sample estimates:
#&gt; mean of the differences 
#&gt;                   -1.58
</span><span class="w">
</span><span class="c1"># Same for wide data (two separate vectors)
# t.test(sleep.wide$group1, sleep.wide$group2, paired=TRUE)
</span></code></pre>
</div>

<p>The paired t-test is equivalent to testing whether <strong>difference</strong> between each pair of observations has a population mean of 0. (See below for comparing a single group to a population mean.)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">t.test</span><span class="p">(</span><span class="n">sleep.wide</span><span class="o">$</span><span class="n">group1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sleep.wide</span><span class="o">$</span><span class="n">group2</span><span class="p">,</span><span class="w"> </span><span class="n">mu</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">var.equal</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Error in t.test(sleep.wide$group1 - sleep.wide$group2, mu = 0, var.equal = TRUE): object 'sleep.wide' not found
</span></code></pre>
</div>

<h3 id="comparing-a-group-against-an-expected-population-mean-one-sample-t-test">Comparing a group against an expected population mean: one-sample t-test</h3>

<p>Suppose that you want to test whether the data in column <code class="highlighter-rouge">extra</code> is drawn from a population whose true mean is 0. In this case, the <code class="highlighter-rouge">group</code> and <code class="highlighter-rouge">ID</code> columns are ignored.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">t.test</span><span class="p">(</span><span class="n">sleep</span><span class="o">$</span><span class="n">extra</span><span class="p">,</span><span class="w"> </span><span class="n">mu</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	One Sample t-test
#&gt; 
#&gt; data:  sleep$extra
#&gt; t = 3.413, df = 19, p-value = 0.002918
#&gt; alternative hypothesis: true mean is not equal to 0
#&gt; 95 percent confidence interval:
#&gt;  0.5955845 2.4844155
#&gt; sample estimates:
#&gt; mean of x 
#&gt;      1.54
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-51">Frequency tests</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You have categorical data and want test whether the frequency distribution of values differs from an expected frequency, or if the distribution differs between groups.</p>

<h3 id="solution">Solution</h3>

<p>There are two general questions that frequency tests address:</p>

<ol>
<li>Does the frequency distribution differ from an expected, or theoretical, distribution (e.g., expect 50% yes, 50% no)? (Goodness-of-fit test)</li>
<li>Does the frequency distribution differ between two or more groups? (Independence test)</li>
</ol>

<p>Of the statistical tests commonly used to address these questions, there are <strong>exact</strong> tests and <strong>approximate</strong> tests.</p>

<table>
<thead>
<tr>
<th>&nbsp;</th>
<th><strong><em>Expected distribution</em></strong></th>
<th><strong><em>Comparing groups</em></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Exact</em></strong></td>
<td>Exact binomial</td>
<td>Fisher’s exact</td>
</tr>
<tr>
<td><strong><em>Approximate</em></strong></td>
<td>Chi-square goodness of fit</td>
<td>Chi-square test of independence</td>
</tr>
</tbody>
</table>

<p>Note: The exact binomial test can only be used on one variable that has two levels. Fisher’s exact test can only be used with two-dimensional contingency tables (for example, it can be used when there is one independent variable and one dependent variable, but not when there are 2 IVs and 1 DV).</p>

<p>To test for paired or within-subjects effects, McNemar’s test can be used. To use it, there must be one IV with two levels, and one DV with two levels.</p>

<p>To test for the independence of two variables with repeated measurements, the Cochran-Mantel-Haenszel test can be used.</p>

<p>Suppose this is your data, where each row represents one case:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 condition result
 control      0
 control      0
 control      0
 control      0
 treatment      1
 control      0
 control      0
 treatment      0
 treatment      1
 control      1
 treatment      1
 treatment      1
 treatment      1
 treatment      1
 treatment      0
 control      0
 control      1
 control      0
 control      1
 treatment      0
 treatment      1
 treatment      0
 treatment      0
 control      0
 treatment      1
 control      0
 control      0
 treatment      1
 treatment      0
 treatment      1
'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Instead of a data frame of <strong>cases</strong>, your data might be stored as a data frame of <strong>counts</strong>, or as a contingency table. For the analyses here, your data must be in a contingency table. See <a href="../../Manipulating_data/Converting_between_data_frames_and_contingency_tables">this page</a> for more information.</p>

<h3 id="tests-of-goodness-of-fit-expected-frequency">Tests of goodness-of-fit (expected frequency)</h3>

<h4 id="chi-square-test">Chi-square test</h4>

<p>To test the hypothesis that the two values in the result column (ignoring condition) are equally likely (50%-50%) in the population:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create contingency table for result, which contains values 0 and 1
# The column names are "0" and "1" (they're not actually values in the table)
</span><span class="n">ct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="n">ct</span><span class="w">
</span><span class="c1">#&gt; 
#&gt;  0  1 
#&gt; 17 13
</span><span class="w">
</span><span class="c1"># An alternative is to manually create the table
#ct &lt;- matrix(c(17,13), ncol=2)
#colnames(ct1) &lt;- c("0", "1")
</span><span class="w">
</span><span class="c1"># Perform Chi-square test
</span><span class="n">chisq.test</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Chi-squared test for given probabilities
#&gt; 
#&gt; data:  ct
#&gt; X-squared = 0.53333, df = 1, p-value = 0.4652
</span></code></pre>
</div>

<p>To test the sample with  different expected frequencies (in this case 0.75 and 0.25):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Probability table - must sum to 1
</span><span class="n">pt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.75</span><span class="p">,</span><span class="w"> </span><span class="m">.25</span><span class="p">)</span><span class="w">
</span><span class="n">chisq.test</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="n">pt</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Chi-squared test for given probabilities
#&gt; 
#&gt; data:  ct
#&gt; X-squared = 5.3778, df = 1, p-value = 0.02039
</span></code></pre>
</div>

<p>If you want to extract information out of the test result, you can save the result into a variable, examine the variable with <code class="highlighter-rouge">str()</code>, and pull out the parts you want. For example:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">chi_res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">chisq.test</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="n">pt</span><span class="p">)</span><span class="w">
</span><span class="c1"># View all the parts that can be extracted
</span><span class="n">str</span><span class="p">(</span><span class="n">chi_res</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; List of 9
#&gt;  $ statistic: Named num 5.38
#&gt;   ..- attr(*, "names")= chr "X-squared"
#&gt;  $ parameter: Named num 1
#&gt;   ..- attr(*, "names")= chr "df"
#&gt;  $ p.value  : num 0.0204
#&gt;  $ method   : chr "Chi-squared test for given probabilities"
#&gt;  $ data.name: chr "ct"
#&gt;  $ observed : 'table' int [1:2(1d)] 17 13
#&gt;   ..- attr(*, "dimnames")=List of 1
#&gt;   .. ..$ : chr [1:2] "0" "1"
#&gt;  $ expected : Named num [1:2] 22.5 7.5
#&gt;   ..- attr(*, "names")= chr [1:2] "0" "1"
#&gt;  $ residuals: table [1:2(1d)] -1.16 2.01
#&gt;   ..- attr(*, "dimnames")=List of 1
#&gt;   .. ..$ : chr [1:2] "0" "1"
#&gt;  $ stdres   : table [1:2(1d)] -2.32 2.32
#&gt;   ..- attr(*, "dimnames")=List of 1
#&gt;   .. ..$ : chr [1:2] "0" "1"
#&gt;  - attr(*, "class")= chr "htest"
</span><span class="w">
</span><span class="c1"># Get the Chi-squared value
</span><span class="n">chi_res</span><span class="o">$</span><span class="n">statistic</span><span class="w">
</span><span class="c1">#&gt; X-squared 
#&gt;  5.377778
</span><span class="w">
</span><span class="c1"># Get the p-value
</span><span class="n">chi_res</span><span class="o">$</span><span class="n">p.value</span><span class="w">
</span><span class="c1">#&gt; [1] 0.02039484
</span></code></pre>
</div>

<h4 id="exact-binomial-test">Exact binomial test</h4>

<p>The exact binomial test is used only with data where there is one variable with two possible values.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="n">ct</span><span class="w">
</span><span class="c1">#&gt; 
#&gt;  0  1 
#&gt; 17 13
</span><span class="w">
</span><span class="n">binom.test</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Exact binomial test
#&gt; 
#&gt; data:  ct
#&gt; number of successes = 17, number of trials = 30, p-value = 0.5847
#&gt; alternative hypothesis: true probability of success is not equal to 0.5
#&gt; 95 percent confidence interval:
#&gt;  0.3742735 0.7453925
#&gt; sample estimates:
#&gt; probability of success 
#&gt;              0.5666667
</span><span class="w">

</span><span class="c1"># Using expected probability of 75% -- notice that 1 is in the second column of
# the table so need to use p=.25
</span><span class="n">binom.test</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="m">0.25</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Exact binomial test
#&gt; 
#&gt; data:  ct
#&gt; number of successes = 17, number of trials = 30, p-value = 0.0002157
#&gt; alternative hypothesis: true probability of success is not equal to 0.25
#&gt; 95 percent confidence interval:
#&gt;  0.3742735 0.7453925
#&gt; sample estimates:
#&gt; probability of success 
#&gt;              0.5666667
</span></code></pre>
</div>

<p>If you want to extract information out of the test result, you can save the result into a variable, examine the variable with <code class="highlighter-rouge">str()</code>, and pull out the parts you want. For example:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bin_res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">binom.test</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="m">0.25</span><span class="p">)</span><span class="w">
</span><span class="c1"># View all the parts that can be extracted
</span><span class="n">str</span><span class="p">(</span><span class="n">bin_res</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; List of 9
#&gt;  $ statistic  : Named num 17
#&gt;   ..- attr(*, "names")= chr "number of successes"
#&gt;  $ parameter  : Named num 30
#&gt;   ..- attr(*, "names")= chr "number of trials"
#&gt;  $ p.value    : Named num 0.000216
#&gt;   ..- attr(*, "names")= chr "0"
#&gt;  $ conf.int   : atomic [1:2] 0.374 0.745
#&gt;   ..- attr(*, "conf.level")= num 0.95
#&gt;  $ estimate   : Named num 0.567
#&gt;   ..- attr(*, "names")= chr "probability of success"
#&gt;  $ null.value : Named num 0.25
#&gt;   ..- attr(*, "names")= chr "probability of success"
#&gt;  $ alternative: chr "two.sided"
#&gt;  $ method     : chr "Exact binomial test"
#&gt;  $ data.name  : chr "ct"
#&gt;  - attr(*, "class")= chr "htest"
</span><span class="w">
</span><span class="c1"># Get the p-value
</span><span class="n">bin_res</span><span class="o">$</span><span class="n">p.value</span><span class="w">
</span><span class="c1">#&gt;            0 
#&gt; 0.0002156938
</span><span class="w">
</span><span class="c1"># Get the 95% confidence interval
</span><span class="n">bin_res</span><span class="o">$</span><span class="n">conf.int</span><span class="w">
</span><span class="c1">#&gt; [1] 0.3742735 0.7453925
#&gt; attr(,"conf.level")
#&gt; [1] 0.95
</span></code></pre>
</div>

<h3 id="tests-of-independence-comparing-groups">Tests of independence (comparing groups)</h3>

<h4 id="chi-square-test-1">Chi-square test</h4>

<p>To test whether the control and treatment conditions result in different frequencies, use a 2D contingency table.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="n">ct</span><span class="w">
</span><span class="c1">#&gt;            
#&gt;              0  1
#&gt;   control   11  3
#&gt;   treatment  6 10
</span><span class="w">
</span><span class="n">chisq.test</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Pearson's Chi-squared test with Yates' continuity correction
#&gt; 
#&gt; data:  ct
#&gt; X-squared = 3.593, df = 1, p-value = 0.05802
</span><span class="w">
</span><span class="n">chisq.test</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">correct</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Pearson's Chi-squared test
#&gt; 
#&gt; data:  ct
#&gt; X-squared = 5.1293, df = 1, p-value = 0.02353
</span></code></pre>
</div>

<p>For 2x2 tables, it uses <a href="http://en.wikipedia.org/wiki/Yates's_correction_for_continuity">Yates’s continuity correction</a> by default. This test is more conservative for small sample sizes.
The flag <code class="highlighter-rouge">correct=FALSE</code>, tells it to use Pearson’s chi-square test without the correction.</p>

<h4 id="fishers-exact-test">Fisher’s exact test</h4>
<p>For small sample sizes, Fisher’s exact test may be more appropriate. It is typically used for 2x2 tables with relatively small sample sizes because it is computationally intensive for more complicated (e.g., 2x3) tables, and those with larger sample sizes. However, the implementation in R seems to handle larger cases without trouble.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="n">ct</span><span class="w">
</span><span class="c1">#&gt;            
#&gt;              0  1
#&gt;   control   11  3
#&gt;   treatment  6 10
</span><span class="w">
</span><span class="n">fisher.test</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Fisher's Exact Test for Count Data
#&gt; 
#&gt; data:  ct
#&gt; p-value = 0.03293
#&gt; alternative hypothesis: true odds ratio is not equal to 1
#&gt; 95 percent confidence interval:
#&gt;   0.966861 45.555016
#&gt; sample estimates:
#&gt; odds ratio 
#&gt;   5.714369
</span></code></pre>
</div>

<h4 id="cochran-mantel-haenszel-test">Cochran-Mantel-Haenszel test</h4>

<p>The Cochran-Mantel-Haenszel test (or Mantel-Haenszel test) is used for testing the independence of two dichotomous variables with repeated measurements. It is most commonly used with 2x2xK tables, where K is the number of measurement conditions. For example, you may want to know whether a treatment (C vs. D) affects the likelihood of recovery (yes or no). Suppose, though, that the treatments were administered at three different times of day, morning, afternoon, and night – and that you want your test to control for this. The CMH test would then operate on a 2x2x3 contingency table, where the third variable is the one you wish to control for.</p>

<p>The implementation of the CMH test in R can handle dimensions greater than 2x2xK. For example, you could use it for a 3x3xK contingency table.</p>

<p>In the following example (borrowed from McDonald’s <a href="http://udel.edu/~mcdonald/statcmh.html">Handbook of Biological Statistics</a>), there are three variables: Location, Allele, and Habitat. The question is whether Allele (94 or non-94) and Habitat (marine or estuarine) are independent, when location is controlled for.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fish</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
Location Allele   Habitat Count
 tillamook     94    marine    56
 tillamook     94 estuarine    69
 tillamook non-94    marine    40
 tillamook non-94 estuarine    77
 yaquina     94    marine    61
 yaquina     94 estuarine   257
 yaquina non-94    marine    57
 yaquina non-94 estuarine   301
 alsea     94    marine    73
 alsea     94 estuarine    65
 alsea non-94    marine    71
 alsea non-94 estuarine    79
umpqua     94    marine    71
umpqua     94 estuarine    48
umpqua non-94    marine    55
umpqua non-94 estuarine    48
'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Note that the data above is entered as a data frame of <strong>counts</strong>, instead of a data frame of <strong>cases</strong> as in previous examples. Instead of using <code class="highlighter-rouge">table()</code> to convert it to a contingency table, use <code class="highlighter-rouge">xtabs()</code> instead. For more information, see <a href="../../Manipulating_data/Converting_between_data_frames_and_contingency_tables">this page</a>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="w">
</span><span class="c1"># Make a 3D contingency table, where the last variable, Location, is the one to 
# control for. If you use table() for case data, the last variable is also the 
# one to control for.
</span><span class="n">ct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Allele</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Habitat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">fish</span><span class="p">)</span><span class="w">
</span><span class="n">ct</span><span class="w">
</span><span class="c1">#&gt; , , Location = alsea
#&gt; 
#&gt;         Habitat
#&gt; Allele   estuarine marine
#&gt;   94            65     73
#&gt;   non-94        79     71
#&gt; 
#&gt; , , Location = tillamook
#&gt; 
#&gt;         Habitat
#&gt; Allele   estuarine marine
#&gt;   94            69     56
#&gt;   non-94        77     40
#&gt; 
#&gt; , , Location = umpqua
#&gt; 
#&gt;         Habitat
#&gt; Allele   estuarine marine
#&gt;   94            48     71
#&gt;   non-94        48     55
#&gt; 
#&gt; , , Location = yaquina
#&gt; 
#&gt;         Habitat
#&gt; Allele   estuarine marine
#&gt;   94           257     61
#&gt;   non-94       301     57
</span><span class="w">
</span><span class="c1"># This prints ct in a "flat" format
</span><span class="n">ftable</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;                  Location alsea tillamook umpqua yaquina
#&gt; Allele Habitat                                          
#&gt; 94     estuarine             65        69     48     257
#&gt;        marine                73        56     71      61
#&gt; non-94 estuarine             79        77     48     301
#&gt;        marine                71        40     55      57
</span><span class="w">
</span><span class="c1"># Print with different arrangement of variables
</span><span class="n">ftable</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">row.vars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">,</span><span class="s2">"Allele"</span><span class="p">),</span><span class="w"> </span><span class="n">col.vars</span><span class="o">=</span><span class="s2">"Habitat"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;                  Habitat estuarine marine
#&gt; Location  Allele                         
#&gt; alsea     94                    65     73
#&gt;           non-94                79     71
#&gt; tillamook 94                    69     56
#&gt;           non-94                77     40
#&gt; umpqua    94                    48     71
#&gt;           non-94                48     55
#&gt; yaquina   94                   257     61
#&gt;           non-94               301     57
</span><span class="w">

</span><span class="n">mantelhaen.test</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Mantel-Haenszel chi-squared test with continuity correction
#&gt; 
#&gt; data:  ct
#&gt; Mantel-Haenszel X-squared = 5.0497, df = 1, p-value = 0.02463
#&gt; alternative hypothesis: true common odds ratio is not equal to 1
#&gt; 95 percent confidence interval:
#&gt;  0.6005522 0.9593077
#&gt; sample estimates:
#&gt; common odds ratio 
#&gt;          0.759022
</span></code></pre>
</div>

<p>According to this test, there is a relationship between Allele and Habitat, controlling for Location, p=.025.</p>

<p>Note that the first two dimensions of the contingency table are treated the same (so their order can be swapped without affecting the test result), the highest-order dimension in the contingency table is different. This is illustrated below.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># The following two create different contingency tables, but have the same result
# with the CMH test
</span><span class="n">ct.1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Habitat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Allele</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">fish</span><span class="p">)</span><span class="w">
</span><span class="n">ct.2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Allele</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Habitat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">fish</span><span class="p">)</span><span class="w">
</span><span class="n">mantelhaen.test</span><span class="p">(</span><span class="n">ct.1</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Mantel-Haenszel chi-squared test with continuity correction
#&gt; 
#&gt; data:  ct.1
#&gt; Mantel-Haenszel X-squared = 5.0497, df = 1, p-value = 0.02463
#&gt; alternative hypothesis: true common odds ratio is not equal to 1
#&gt; 95 percent confidence interval:
#&gt;  0.6005522 0.9593077
#&gt; sample estimates:
#&gt; common odds ratio 
#&gt;          0.759022
</span><span class="n">mantelhaen.test</span><span class="p">(</span><span class="n">ct.2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Mantel-Haenszel chi-squared test with continuity correction
#&gt; 
#&gt; data:  ct.2
#&gt; Mantel-Haenszel X-squared = 5.0497, df = 1, p-value = 0.02463
#&gt; alternative hypothesis: true common odds ratio is not equal to 1
#&gt; 95 percent confidence interval:
#&gt;  0.6005522 0.9593077
#&gt; sample estimates:
#&gt; common odds ratio 
#&gt;          0.759022
</span><span class="w">

</span><span class="c1"># With Allele last, we get a different result
</span><span class="n">ct.3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Habitat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Allele</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">fish</span><span class="p">)</span><span class="w">
</span><span class="n">ct.4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Habitat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Allele</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">fish</span><span class="p">)</span><span class="w">
</span><span class="n">mantelhaen.test</span><span class="p">(</span><span class="n">ct.3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Cochran-Mantel-Haenszel test
#&gt; 
#&gt; data:  ct.3
#&gt; Cochran-Mantel-Haenszel M^2 = 168.47, df = 3, p-value &lt; 2.2e-16
</span><span class="n">mantelhaen.test</span><span class="p">(</span><span class="n">ct.4</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Cochran-Mantel-Haenszel test
#&gt; 
#&gt; data:  ct.4
#&gt; Cochran-Mantel-Haenszel M^2 = 168.47, df = 3, p-value &lt; 2.2e-16
</span><span class="w">

</span><span class="c1"># With Habitat last, we get a different result
</span><span class="n">ct.5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Allele</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Habitat</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">fish</span><span class="p">)</span><span class="w">
</span><span class="n">ct.6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xtabs</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Allele</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Habitat</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">fish</span><span class="p">)</span><span class="w">
</span><span class="n">mantelhaen.test</span><span class="p">(</span><span class="n">ct.5</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Cochran-Mantel-Haenszel test
#&gt; 
#&gt; data:  ct.5
#&gt; Cochran-Mantel-Haenszel M^2 = 2.0168, df = 3, p-value = 0.5689
</span><span class="n">mantelhaen.test</span><span class="p">(</span><span class="n">ct.6</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Cochran-Mantel-Haenszel test
#&gt; 
#&gt; data:  ct.6
#&gt; Cochran-Mantel-Haenszel M^2 = 2.0168, df = 3, p-value = 0.5689
</span></code></pre>
</div>

<h3 id="mcnemars-test">McNemar’s test</h3>

<p>McNemar’s test is conceptually like a within-subjects test for frequency data. For example, suppose you want to test whether a treatment increases the probability that a person will respond “yes” to a question, and that you get just one pre-treatment and one post-treatment response per person. A standard chi-square test would be inappropriate, because it assumes that the groups are independent. Instead, McNemar’s test can be used. This test can only be used when there are two measurements of a dichotomous variable. The 2x2 contingency table used for McNemar’s test bears a superficial resemblance to those used for “normal” chi-square tests, but it is different in structure.</p>

<p>Suppose this is your data. Each subject has a pre-treatment and post-treatment response.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject time result
 1  pre      0
 1 post      1
 2  pre      1
 2 post      1
 3  pre      0
 3 post      1
 4  pre      1
 4 post      0
 5  pre      1
 5 post      1
 6  pre      0
 6 post      1
 7  pre      0
 7 post      1
 8  pre      0
 8 post      1
 9  pre      0
 9 post      1
10  pre      1
10 post      1
11  pre      0
11 post      0
12  pre      1
12 post      1
13  pre      0
13 post      1
14  pre      0
14 post      0
15  pre      0
15 post      1
'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>If your data is not already in wide format, it must be converted (see <a href="../../Manipulating_data/Converting_data_between_wide_and_long_format">this page</a> for more information):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">

</span><span class="n">data_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spread</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="n">data_wide</span><span class="w">
</span><span class="c1">#&gt;    subject post pre
#&gt; 1        1    1   0
#&gt; 2        2    1   1
#&gt; 3        3    1   0
#&gt; 4        4    0   1
#&gt; 5        5    1   1
#&gt; 6        6    1   0
#&gt; 7        7    1   0
#&gt; 8        8    1   0
#&gt; 9        9    1   0
#&gt; 10      10    1   1
#&gt; 11      11    0   0
#&gt; 12      12    1   1
#&gt; 13      13    1   0
#&gt; 14      14    0   0
#&gt; 15      15    1   0
</span></code></pre>
</div>

<p>Next, generate the contingency table from just the pre and post columns from the data frame:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="w"> </span><span class="n">data_wide</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"pre"</span><span class="p">,</span><span class="s2">"post"</span><span class="p">)]</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">ct</span><span class="w">
</span><span class="c1">#&gt;    post
#&gt; pre 0 1
#&gt;   0 2 8
#&gt;   1 1 4
</span><span class="w">
</span><span class="c1"># The contingency table above puts each subject into one of four cells, depending
# on their pre- and post-treatment response. Note that it it is different from
# the contingency table used for a "normal" chi-square test, shown below. The table
# below does not account for repeated measurements, and so it is not useful for
# the purposes here.
</span><span class="w">
</span><span class="c1"># table(data[,c("time","result")])
#       result
# time    0  1
#   post  3 12
#   pre  10  5
</span></code></pre>
</div>

<p>After creating the appropriate contingency table, run the test:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">mcnemar.test</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	McNemar's Chi-squared test with continuity correction
#&gt; 
#&gt; data:  ct
#&gt; McNemar's chi-squared = 4, df = 1, p-value = 0.0455
</span></code></pre>
</div>

<p>For small sample sizes, it uses a continuity correction. Instead of using this correction, you can use an <strong>exact</strong> version of McNemar’s test, which is more accurate. It is available in the package <code class="highlighter-rouge">exact2x2</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">exact2x2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Loading required package: exactci
#&gt; Loading required package: ssanv
</span><span class="n">mcnemar.exact</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Exact McNemar test (with central confidence intervals)
#&gt; 
#&gt; data:  ct
#&gt; b = 8, c = 1, p-value = 0.03906
#&gt; alternative hypothesis: true odds ratio is not equal to 1
#&gt; 95 percent confidence interval:
#&gt;    1.072554 354.981246
#&gt; sample estimates:
#&gt; odds ratio 
#&gt;          8
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-52">ANOVA</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to compare multiple groups using an ANOVA.</p>

<h3 id="solution">Solution</h3>

<p>Suppose this is your data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject sex   age before after
 1   F   old    9.5   7.1
 2   M   old   10.3  11.0
 3   M   old    7.5   5.8
 4   F   old   12.4   8.8
 5   M   old   10.2   8.6
 6   M   old   11.0   8.0
 7   M young    9.1   3.0
 8   F young    7.9   5.2
 9   F   old    6.6   3.4
10   M young    7.7   4.0
11   M young    9.4   5.3
12   M   old   11.6  11.3
13   M young    9.9   4.6
14   F young    8.6   6.4
15   F young   14.3  13.5
16   F   old    9.2   4.7
17   M young    9.8   5.1
18   F   old    9.9   7.3
19   F young   13.0   9.5
20   M young   10.2   5.4
21   M young    9.0   3.7
22   F young    7.9   6.2
23   M   old   10.1  10.0
24   M young    9.0   1.7
25   M young    8.6   2.9
26   M young    9.4   3.2
27   M young    9.7   4.7
28   M young    9.3   4.9
29   F young   10.7   9.8
30   M   old    9.3   9.4
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make sure subject column is a factor, so that it's not treated as a continuous
# variable.
</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">subject</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="one-way-between-anova">One way between ANOVA</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># One way between:
# IV: sex
# DV: before
</span><span class="n">aov1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">before</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov1</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)
#&gt; sex          1   1.53   1.529   0.573  0.455
#&gt; Residuals   28  74.70   2.668
</span><span class="w">
</span><span class="c1"># Show the means
</span><span class="n">model.tables</span><span class="p">(</span><span class="n">aov1</span><span class="p">,</span><span class="w"> </span><span class="s2">"means"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Tables of means
#&gt; Grand mean
#&gt;          
#&gt; 9.703333 
#&gt; 
#&gt;  sex 
#&gt;      F      M
#&gt;     10  9.532
#&gt; rep 11 19.000
</span></code></pre>
</div>

<h3 id="two-way-between-anova">Two way between ANOVA</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># 2x2 between:
# IV: sex
# IV: age
# DV: after
# These two calls are equivalent
</span><span class="n">aov2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">after</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="o">*</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">aov2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">after</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sex</span><span class="o">:</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;             Df Sum Sq Mean Sq F value  Pr(&gt;F)    
#&gt; sex          1  16.08   16.08   4.038  0.0550 .  
#&gt; age          1  38.96   38.96   9.786  0.0043 ** 
#&gt; sex:age      1  89.61   89.61  22.509 6.6e-05 ***
#&gt; Residuals   26 103.51    3.98                    
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</span><span class="w">
</span><span class="c1"># Show the means
</span><span class="n">model.tables</span><span class="p">(</span><span class="n">aov2</span><span class="p">,</span><span class="w"> </span><span class="s2">"means"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Tables of means
#&gt; Grand mean
#&gt;          
#&gt; 6.483333 
#&gt; 
#&gt;  sex 
#&gt;          F      M
#&gt;      7.445  5.926
#&gt; rep 11.000 19.000
#&gt; 
#&gt;  age 
#&gt;        old  young
#&gt;      7.874  5.556
#&gt; rep 12.000 18.000
#&gt; 
#&gt;  sex:age 
#&gt;      age
#&gt; sex   old    young 
#&gt;   F    6.260  8.433
#&gt;   rep  5.000  6.000
#&gt;   M    9.157  4.042
#&gt;   rep  7.000 12.000
</span></code></pre>
</div>

<h3 id="tukey-hsd-post-hoc-test">Tukey HSD post-hoc test</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">TukeyHSD</span><span class="p">(</span><span class="n">aov2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   Tukey multiple comparisons of means
#&gt;     95% family-wise confidence level
#&gt; 
#&gt; Fit: aov(formula = after ~ sex + age + sex:age, data = data)
#&gt; 
#&gt; $sex
#&gt;          diff       lwr        upr     p adj
#&gt; M-F -1.519139 -3.073025 0.03474709 0.0549625
#&gt; 
#&gt; $age
#&gt;               diff       lwr        upr     p adj
#&gt; young-old -2.31785 -3.846349 -0.7893498 0.0044215
#&gt; 
#&gt; $`sex:age`
#&gt;                       diff        lwr        upr     p adj
#&gt; M:old-F:old      2.8971429 -0.3079526  6.1022384 0.0869856
#&gt; F:young-F:old    2.1733333 -1.1411824  5.4878491 0.2966111
#&gt; M:young-F:old   -2.2183333 -5.1319553  0.6952887 0.1832890
#&gt; F:young-M:old   -0.7238095 -3.7691188  2.3214997 0.9138789
#&gt; M:young-M:old   -5.1154762 -7.7187601 -2.5121923 0.0000676
#&gt; M:young-F:young -4.3916667 -7.1285380 -1.6547953 0.0008841
</span></code></pre>
</div>

<h2 id="topic-53">ANOVAs with within-subjects variables</h2>

<p>For ANOVAs with within-subjects variables, the data must be in long format. The data supplied above is in wide format, so we have to convert it first. (See <a href="../../Manipulating_data/Converting_data_between_wide_and_long_format">../../Manipulating data/Converting data between wide and long format</a> for more information.)</p>

<p>Also, for ANOVAs with a within-subjects variable, there must be an identifier column. In this case, it is <code class="highlighter-rouge">subject</code>. <strong><em>This identifier variable must be a factor.</em></strong> If it is a numeric type, the function will interpret it incorrectly and it won’t work properly.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># This is what the original (wide) data looks like
# subject sex   age before after
#       1   F   old    9.5   7.1
#       2   M   old   10.3  11.0
#       3   M   old    7.5   5.8
</span><span class="w">
</span><span class="c1"># Convert it to long format
</span><span class="n">data_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gather</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">before</span><span class="o">:</span><span class="n">after</span><span class="p">)</span><span class="w">
</span><span class="c1"># Look at first few rows
</span><span class="n">head</span><span class="p">(</span><span class="n">data_long</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   subject sex age   time value
#&gt; 1       1   F old before   9.5
#&gt; 2       2   M old before  10.3
#&gt; 3       3   M old before   7.5
#&gt; 4       4   F old before  12.4
#&gt; 5       5   M old before  10.2
#&gt; 6       6   M old before  11.0
</span><span class="w">

</span><span class="c1"># Make sure subject column is a factor
</span><span class="n">data_long</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">subject</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="one-way-within-anova">One-way within ANOVA</h3>
<p>First, convert the data to long format and make sure <code class="highlighter-rouge">subject</code> is a factor, as shown above. If subject is a numeric column, and not a factor, your results will be wrong!</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># IV (within): time
# DV:          value
</span><span class="n">aov_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">subject</span><span class="o">/</span><span class="n">time</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov_time</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Error: subject
#&gt;           Df Sum Sq Mean Sq F value Pr(&gt;F)
#&gt; Residuals 29  261.2   9.009               
#&gt; 
#&gt; Error: subject:time
#&gt;           Df Sum Sq Mean Sq F value   Pr(&gt;F)    
#&gt; time       1 155.53  155.53   71.43 2.59e-09 ***
#&gt; Residuals 29  63.14    2.18                     
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</span><span class="w">

</span><span class="c1"># This won't work here for some reason (?)
</span><span class="n">model.tables</span><span class="p">(</span><span class="n">aov_time</span><span class="p">,</span><span class="w"> </span><span class="s2">"means"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Tables of means
#&gt; Grand mean
#&gt;          
#&gt; 8.093333 
#&gt; 
#&gt;  time 
#&gt; time
#&gt;  after before 
#&gt;  6.483  9.703
</span></code></pre>
</div>

<h3 id="mixed-design-anova">Mixed design ANOVA</h3>

<p>First, convert the data to long format and make sure <code class="highlighter-rouge">subject</code> is a factor, as shown above.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># 2x2 mixed:
# IV between: age
# IV within:  time
# DV:         value
</span><span class="n">aov_age_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="o">*</span><span class="n">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">subject</span><span class="o">/</span><span class="n">time</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov_age_time</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Error: subject
#&gt;           Df Sum Sq Mean Sq F value Pr(&gt;F)
#&gt; age        1  24.44  24.440    2.89    0.1
#&gt; Residuals 28 236.81   8.457               
#&gt; 
#&gt; Error: subject:time
#&gt;           Df Sum Sq Mean Sq F value   Pr(&gt;F)    
#&gt; time       1 155.53  155.53   98.14 1.18e-10 ***
#&gt; age:time   1  18.77   18.77   11.84  0.00184 ** 
#&gt; Residuals 28  44.37    1.58                     
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</span><span class="w">
</span><span class="c1"># This won't work here because the data is unbalanced
</span><span class="n">model.tables</span><span class="p">(</span><span class="n">aov_age_time</span><span class="p">,</span><span class="w"> </span><span class="s2">"means"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Tables of means
#&gt; Grand mean
#&gt;          
#&gt; 8.093333 
#&gt; 
#&gt;  age 
#&gt;        old  young
#&gt;      8.875  7.572
#&gt; rep 24.000 36.000
#&gt; 
#&gt;  time 
#&gt;      after before
#&gt;      6.483  9.703
#&gt; rep 30.000 30.000
#&gt; 
#&gt;  age:time 
#&gt;        time
#&gt; age     after  before
#&gt;   old    7.950  9.800
#&gt;   rep   12.000 12.000
#&gt;   young  5.506  9.639
#&gt;   rep   18.000 18.000
</span></code></pre>
</div>

<h3 id="more-anovas-with-within-subjects-variables">More ANOVAs with within-subjects variables</h3>

<p>These examples don’t operate on the data above, but they should illustrate how to do things.
First, convert the data to long format and make sure <code class="highlighter-rouge">subject</code> is a factor, as shown above.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Two within variables
</span><span class="n">aov.ww</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">w</span><span class="m">1</span><span class="o">*</span><span class="n">w</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">subject</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="m">1</span><span class="o">*</span><span class="n">w</span><span class="m">2</span><span class="p">)),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">)</span><span class="w">

</span><span class="c1"># One between variable and two within variables
</span><span class="n">aov.bww</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">b</span><span class="m">1</span><span class="o">*</span><span class="n">w</span><span class="m">1</span><span class="o">*</span><span class="n">w</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">subject</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="m">1</span><span class="o">*</span><span class="n">w</span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">)</span><span class="w">

</span><span class="c1"># Two between variables and one within variables
</span><span class="n">aov.bww</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">b</span><span class="m">1</span><span class="o">*</span><span class="n">b</span><span class="m">2</span><span class="o">*</span><span class="n">w</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">subject</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="m">1</span><span class="o">*</span><span class="n">b</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">data_long</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>For more information on ANOVA in R, see:</p>

<ul>
<li><a href="http://www.personality-project.org/r/r.anova.html">http://www.personality-project.org/r/r.anova.html</a></li>
<li><a href="http://www.agr.kuleuven.ac.be/vakken/statisticsbyR/ANOVAbyRr/indexANOVA.htm">http://www.agr.kuleuven.ac.be/vakken/statisticsbyR/ANOVAbyRr/indexANOVA.htm</a></li>
<li><a href="http://www.statmethods.net/stats/anova.html">http://www.statmethods.net/stats/anova.html</a></li>
</ul>

</article>
<h2 class="post-title" id="topic-54">Logistic regression</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to perform a logistic regression.</p>

<h3 id="solution">Solution</h3>

<p>A logistic regression is typically used when there is one dichotomous outcome variable (such as winning or losing), and a continuous predictor variable which is related to the probability or odds of the outcome variable. It can also be used with categorical predictors, and with multiple predictors.</p>

<p>Suppose we start with part of the built-in <code class="highlighter-rouge">mtcars</code> dataset. In the examples below, we’ll use <code class="highlighter-rouge">vs</code> as the outcome variable, <code class="highlighter-rouge">mpg</code> as a continuous predictor, and <code class="highlighter-rouge">am</code> as a categorical (dichotomous) predictor.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">,</span><span class="w"> </span><span class="n">vs</span><span class="p">))</span><span class="w">
</span><span class="n">dat</span><span class="w">
</span><span class="c1">#&gt;                      mpg am vs
#&gt; Mazda RX4           21.0  1  0
#&gt; Mazda RX4 Wag       21.0  1  0
#&gt; Datsun 710          22.8  1  1
#&gt; Hornet 4 Drive      21.4  0  1
#&gt; Hornet Sportabout   18.7  0  0
#&gt; Valiant             18.1  0  1
#&gt; Duster 360          14.3  0  0
#&gt; Merc 240D           24.4  0  1
#&gt; Merc 230            22.8  0  1
#&gt; Merc 280            19.2  0  1
#&gt; Merc 280C           17.8  0  1
#&gt; Merc 450SE          16.4  0  0
#&gt; Merc 450SL          17.3  0  0
#&gt; Merc 450SLC         15.2  0  0
#&gt; Cadillac Fleetwood  10.4  0  0
#&gt; Lincoln Continental 10.4  0  0
#&gt; Chrysler Imperial   14.7  0  0
#&gt; Fiat 128            32.4  1  1
#&gt; Honda Civic         30.4  1  1
#&gt; Toyota Corolla      33.9  1  1
#&gt; Toyota Corona       21.5  0  1
#&gt; Dodge Challenger    15.5  0  0
#&gt; AMC Javelin         15.2  0  0
#&gt; Camaro Z28          13.3  0  0
#&gt; Pontiac Firebird    19.2  0  0
#&gt; Fiat X1-9           27.3  1  1
#&gt; Porsche 914-2       26.0  1  0
#&gt; Lotus Europa        30.4  1  1
#&gt; Ford Pantera L      15.8  1  0
#&gt; Ferrari Dino        19.7  1  0
#&gt; Maserati Bora       15.0  1  0
#&gt; Volvo 142E          21.4  1  1
</span></code></pre>
</div>

<h3 id="continuous-predictor-dichotomous-outcome">Continuous predictor, dichotomous outcome</h3>

<p>If the data set has one dichotomous and one continuous variable, and the continuous variable is a predictor of the <strong>probability</strong> the dichotomous variable, then a logistic regression might be appropriate.</p>

<p>In this example, <code class="highlighter-rouge">mpg</code> is the continuous predictor variable, and <code class="highlighter-rouge">vs</code> is the dichotomous outcome variable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Do the logistic regression - both of these have the same effect.
# ("logit" is the default model when family is binomial.)
</span><span class="n">logr_vm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">vs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">)</span><span class="w">
</span><span class="n">logr_vm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">vs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="s2">"logit"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>To view the model and information about it:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Print information about the model
</span><span class="n">logr_vm</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:  glm(formula = vs ~ mpg, family = binomial(link = "logit"), data = dat)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)          mpg  
#&gt;     -8.8331       0.4304  
#&gt; 
#&gt; Degrees of Freedom: 31 Total (i.e. Null);  30 Residual
#&gt; Null Deviance:	    43.86 
#&gt; Residual Deviance: 25.53 	AIC: 29.53
</span><span class="w">
</span><span class="c1"># More information about the model
</span><span class="n">summary</span><span class="p">(</span><span class="n">logr_vm</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; glm(formula = vs ~ mpg, family = binomial(link = "logit"), data = dat)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -2.2127  -0.5121  -0.2276   0.6402   1.6980  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)   
#&gt; (Intercept)  -8.8331     3.1623  -2.793  0.00522 **
#&gt; mpg           0.4304     0.1584   2.717  0.00659 **
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 43.860  on 31  degrees of freedom
#&gt; Residual deviance: 25.533  on 30  degrees of freedom
#&gt; AIC: 29.533
#&gt; 
#&gt; Number of Fisher Scoring iterations: 6
</span></code></pre>
</div>

<h4 id="plotting">Plotting</h4>

<p>The data and logistic regression model can be plotted with ggplot2 or base graphics:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">vs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">stat_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"glm"</span><span class="p">,</span><span class="w"> </span><span class="n">method.args</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">),</span><span class="w"> </span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="c1"># Reduce some of the margins so that the plot fits better
</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">vs</span><span class="p">)</span><span class="w">
</span><span class="n">curve</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">logr_vm</span><span class="p">,</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">mpg</span><span class="o">=</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"response"</span><span class="p">),</span><span class="w"> </span><span class="n">add</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Statistical_analysis/Logistic_regression/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Statistical_analysis/Logistic_regression/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"></p>

<h3 id="dichotomous-predictor-dichotomous-outcome">Dichotomous predictor, dichotomous outcome</h3>
<p>This proceeds in much the same way as above. In this example, <code class="highlighter-rouge">am</code> is the dichotomous predictor variable, and <code class="highlighter-rouge">vs</code> is the dichotomous outcome variable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Do the logistic regression
</span><span class="n">logr_va</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">vs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">am</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">)</span><span class="w">

</span><span class="c1"># Print information about the model
</span><span class="n">logr_va</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:  glm(formula = vs ~ am, family = binomial, data = dat)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)           am  
#&gt;     -0.5390       0.6931  
#&gt; 
#&gt; Degrees of Freedom: 31 Total (i.e. Null);  30 Residual
#&gt; Null Deviance:	    43.86 
#&gt; Residual Deviance: 42.95 	AIC: 46.95
</span><span class="w">
</span><span class="c1"># More information about the model
</span><span class="n">summary</span><span class="p">(</span><span class="n">logr_va</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; glm(formula = vs ~ am, family = binomial, data = dat)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -1.2435  -0.9587  -0.9587   1.1127   1.4132  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)
#&gt; (Intercept)  -0.5390     0.4756  -1.133    0.257
#&gt; am            0.6931     0.7319   0.947    0.344
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 43.860  on 31  degrees of freedom
#&gt; Residual deviance: 42.953  on 30  degrees of freedom
#&gt; AIC: 46.953
#&gt; 
#&gt; Number of Fisher Scoring iterations: 4
</span></code></pre>
</div>

<h4 id="plotting-1">Plotting</h4>

<p>The data and logistic regression model can be plotted with ggplot2 or base graphics, although the plots are probably less informative than those with a continuous variable. Because there are only 4 locations for the points to go, it will help to jitter the points so they do not all get overplotted.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">am</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">vs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">position_jitter</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">.05</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">.05</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">stat_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"glm"</span><span class="p">,</span><span class="w"> </span><span class="n">method.args</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">),</span><span class="w"> </span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">


</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="c1"># Reduce some of the margins so that the plot fits better
</span><span class="n">plot</span><span class="p">(</span><span class="n">jitter</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">am</span><span class="p">,</span><span class="w"> </span><span class="m">.2</span><span class="p">),</span><span class="w"> </span><span class="n">jitter</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">vs</span><span class="p">,</span><span class="w"> </span><span class="m">.2</span><span class="p">))</span><span class="w">
</span><span class="n">curve</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">logr_va</span><span class="p">,</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">am</span><span class="o">=</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"response"</span><span class="p">),</span><span class="w"> </span><span class="n">add</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Statistical_analysis/Logistic_regression/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"><img src="http://www.cookbook-r.com/Statistical_analysis/Logistic_regression/figure/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7"></p>

<h3 id="continuous-and-dichotomous-predictors-dichotomous-outcome">Continuous and dichotomous predictors, dichotomous outcome</h3>

<p>This is similar to the previous examples. In this example, <code class="highlighter-rouge">mpg</code> is the continuous predictor, <code class="highlighter-rouge">am</code> is the dichotomous predictor variable, and <code class="highlighter-rouge">vs</code> is the dichotomous outcome variable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">logr_vma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">vs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mpg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">am</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">)</span><span class="w">
</span><span class="n">logr_vma</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:  glm(formula = vs ~ mpg + am, family = binomial, data = dat)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)          mpg           am  
#&gt;    -12.7051       0.6809      -3.0073  
#&gt; 
#&gt; Degrees of Freedom: 31 Total (i.e. Null);  29 Residual
#&gt; Null Deviance:	    43.86 
#&gt; Residual Deviance: 20.65 	AIC: 26.65
</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">logr_vma</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; glm(formula = vs ~ mpg + am, family = binomial, data = dat)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;      Min        1Q    Median        3Q       Max  
#&gt; -2.05888  -0.44544  -0.08765   0.33335   1.68405  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)   
#&gt; (Intercept) -12.7051     4.6252  -2.747  0.00602 **
#&gt; mpg           0.6809     0.2524   2.698  0.00697 **
#&gt; am           -3.0073     1.5995  -1.880  0.06009 . 
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 43.860  on 31  degrees of freedom
#&gt; Residual deviance: 20.646  on 29  degrees of freedom
#&gt; AIC: 26.646
#&gt; 
#&gt; Number of Fisher Scoring iterations: 6
</span></code></pre>
</div>

<h3 id="multiple-predictors-with-interactions">Multiple predictors with interactions</h3>

<p>It is possible to test for interactions when there are multiple predictors. The interactions can be specified individually, as with <code class="highlighter-rouge">a + b + c + a:b + b:c + a:b:c</code>, or they can be expanded automatically, with <code class="highlighter-rouge">a * b * c</code>. It is possible to specify only a subset of the possible interactions, such as <code class="highlighter-rouge">a + b + c + a:c</code>.</p>

<p>This case proceeds as above, but with a slight change: instead of the formula being <code class="highlighter-rouge">vs ~ mpg + am</code>, it is <code class="highlighter-rouge">vs ~ mpg * am</code>, which is equivalent to <code class="highlighter-rouge">vs ~ mpg + am + mpg:am</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Do the logistic regression - both of these have the same effect.
</span><span class="n">logr_vmai</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">vs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mpg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">am</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">)</span><span class="w">
</span><span class="n">logr_vmai</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glm</span><span class="p">(</span><span class="n">vs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">mpg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">am</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mpg</span><span class="o">:</span><span class="n">am</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">)</span><span class="w">

</span><span class="n">logr_vmai</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:  glm(formula = vs ~ mpg + am + mpg:am, family = binomial, data = dat)
#&gt; 
#&gt; Coefficients:
#&gt; (Intercept)          mpg           am       mpg:am  
#&gt;    -20.4784       1.1084      10.1055      -0.6637  
#&gt; 
#&gt; Degrees of Freedom: 31 Total (i.e. Null);  28 Residual
#&gt; Null Deviance:	    43.86 
#&gt; Residual Deviance: 19.12 	AIC: 27.12
</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">logr_vmai</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Call:
#&gt; glm(formula = vs ~ mpg + am + mpg:am, family = binomial, data = dat)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;      Min        1Q    Median        3Q       Max  
#&gt; -1.70566  -0.31124  -0.04817   0.28038   1.55603  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)  
#&gt; (Intercept) -20.4784    10.5525  -1.941   0.0523 .
#&gt; mpg           1.1084     0.5770   1.921   0.0547 .
#&gt; am           10.1055    11.9104   0.848   0.3962  
#&gt; mpg:am       -0.6637     0.6242  -1.063   0.2877  
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 43.860  on 31  degrees of freedom
#&gt; Residual deviance: 19.125  on 28  degrees of freedom
#&gt; AIC: 27.125
#&gt; 
#&gt; Number of Fisher Scoring iterations: 7
</span></code></pre>
</div>

<p>TODO: Add comparison between interaction and non-interaction models.</p>

</article>
<h2 class="post-title" id="topic-55">Homogeneity of variance</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want test samples to see for homogeneity of variance (homoscedasticity) – or more accurately. Many statistical tests assume that the populations are homoscedastic.</p>

<h3 id="solution">Solution</h3>

<p>There are many ways of testing data for homogeneity of variance. Three methods are shown here.</p>

<ul>
<li><strong><em>Bartlett’s test</em></strong> - If the data is normally distributed, this is the best test to use. It is sensitive to data which is not non-normally distribution; it is more likely to return a “false positive” when the data is non-normal.</li>
<li><strong><em>Levene’s test</em></strong> - this is more robust to departures from normality than Bartlett’s test. It is in the <code class="highlighter-rouge">car</code> package.</li>
<li><strong><em>Fligner-Killeen test</em></strong> - this is a non-parametric test which is very robust against departures from normality.</li>
</ul>

<p>For all these tests, the null hypothesis is that all populations variances are equal; the alternative hypothesis is that at least two of them differ.</p>

<h3 id="sample-data">Sample data</h3>

<p>The examples here will use the <code class="highlighter-rouge">InsectSprays</code> and <code class="highlighter-rouge">ToothGrowth</code> data sets. The <code class="highlighter-rouge">InsectSprays</code> data set has one independent variable, while the <code class="highlighter-rouge">ToothGrowth</code> data set has two independent variables.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">InsectSprays</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   count spray
#&gt; 1    10     A
#&gt; 2     7     A
#&gt; 3    20     A
#&gt; 4    14     A
#&gt; 5    14     A
#&gt; 6    12     A
</span><span class="w">
</span><span class="n">tg</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ToothGrowth</span><span class="w">
</span><span class="n">tg</span><span class="o">$</span><span class="n">dose</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">tg</span><span class="o">$</span><span class="n">dose</span><span class="p">)</span><span class="w"> </span><span class="c1"># Treat this column as a factor, not numeric
</span><span class="n">head</span><span class="p">(</span><span class="n">tg</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    len supp dose
#&gt; 1  4.2   VC  0.5
#&gt; 2 11.5   VC  0.5
#&gt; 3  7.3   VC  0.5
#&gt; 4  5.8   VC  0.5
#&gt; 5  6.4   VC  0.5
#&gt; 6 10.0   VC  0.5
</span></code></pre>
</div>

<p>Quick boxplots of these data sets:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">spray</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InsectSprays</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Statistical_analysis/Homogeneity_of_variance/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2"></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">interaction</span><span class="p">(</span><span class="n">dose</span><span class="p">,</span><span class="n">supp</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Statistical_analysis/Homogeneity_of_variance/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>

<p>On a first glance, it appears that both data sets are heteroscedastic, but this needs to be properly tested, which we’ll do below.</p>

<h3 id="bartletts-test">Bartlett’s test</h3>

<p>With one independent variable:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bartlett.test</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">spray</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">InsectSprays</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Bartlett test of homogeneity of variances
#&gt; 
#&gt; data:  count by spray
#&gt; Bartlett's K-squared = 25.96, df = 5, p-value = 9.085e-05
</span><span class="w">
</span><span class="c1"># Same effect, but with two vectors, instead of two columns from a data frame
# bartlett.test(InsectSprays$count ~ InsectSprays$spray)
</span></code></pre>
</div>

<p>With multiple independent variables, the <code class="highlighter-rouge">interaction()</code> function must be used to collapse the IV’s into a single variable with all combinations of the factors. If it is not used, then the will be the wrong degrees of freedom, and the p-value will be wrong.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bartlett.test</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">interaction</span><span class="p">(</span><span class="n">supp</span><span class="p">,</span><span class="n">dose</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Bartlett test of homogeneity of variances
#&gt; 
#&gt; data:  len by interaction(supp, dose)
#&gt; Bartlett's K-squared = 6.9273, df = 5, p-value = 0.2261
</span><span class="w">
</span><span class="c1"># The above gives the same result as testing len vs. dose alone, without supp
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Bartlett test of homogeneity of variances
#&gt; 
#&gt; data:  len by dose
#&gt; Bartlett's K-squared = 0.66547, df = 2, p-value = 0.717
</span></code></pre>
</div>

<h3 id="levenes-test">Levene’s test</h3>

<p>The <code class="highlighter-rouge">leveneTest</code> function is part of the <code class="highlighter-rouge">car</code> package.</p>

<p>With one independent variable:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span><span class="w">

</span><span class="n">leveneTest</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">spray</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">InsectSprays</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Levene's Test for Homogeneity of Variance (center = median)
#&gt;       Df F value   Pr(&gt;F)   
#&gt; group  5  3.8214 0.004223 **
#&gt;       66                    
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</span></code></pre>
</div>

<p>With two independent variables. Note that the <code class="highlighter-rouge">interaction</code> function is not needed, as it is for the other two tests.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">leveneTest</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">supp</span><span class="o">*</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tg</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Levene's Test for Homogeneity of Variance (center = median)
#&gt;       Df F value Pr(&gt;F)
#&gt; group  5  1.7086 0.1484
#&gt;       54
</span></code></pre>
</div>

<h3 id="fligner-killeen-test">Fligner-Killeen test</h3>

<p>With one independent variable:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fligner.test</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">spray</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">InsectSprays</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Fligner-Killeen test of homogeneity of variances
#&gt; 
#&gt; data:  count by spray
#&gt; Fligner-Killeen:med chi-squared = 14.483, df = 5, p-value = 0.01282
</span><span class="w">
</span><span class="c1"># Same effect, but with two vectors, instead of two columns from a data frame
# fligner.test(InsectSprays$count ~ InsectSprays$spray)
</span></code></pre>
</div>

<p>The <code class="highlighter-rouge">fligner.test</code> function has the same quirks as <code class="highlighter-rouge">bartlett.test</code> when working with multiple IV’s. With multiple independent variables, the <code class="highlighter-rouge">interaction()</code> function must be used.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fligner.test</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">interaction</span><span class="p">(</span><span class="n">supp</span><span class="p">,</span><span class="n">dose</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Fligner-Killeen test of homogeneity of variances
#&gt; 
#&gt; data:  len by interaction(supp, dose)
#&gt; Fligner-Killeen:med chi-squared = 7.7488, df = 5, p-value = 0.1706
</span><span class="w">

</span><span class="c1"># The above gives the same result as testing len vs. dose alone, without supp
</span><span class="n">fligner.test</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; 	Fligner-Killeen test of homogeneity of variances
#&gt; 
#&gt; data:  len by dose
#&gt; Fligner-Killeen:med chi-squared = 1.3879, df = 2, p-value = 0.4996
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-56">Inter-rater reliability</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to calculate inter-rater reliability.</p>

<h3 id="solution">Solution</h3>

<p>The method for calculating inter-rater reliability will depend on the type of data (categorical, ordinal, or continuous) and the number of coders.</p>

<h3 id="categorical-data">Categorical data</h3>

<p>Suppose this is your data set. It consists of 30 cases, rated by three coders. It is a subset of the <code class="highlighter-rouge">diagnoses</code> data set in the irr package.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">irr</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Loading required package: lpSolve
</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">diagnoses</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diagnoses</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="w">
</span><span class="c1">#                  rater1                  rater2                  rater3
#             4. Neurosis             4. Neurosis             4. Neurosis
# 2. Personality Disorder 2. Personality Disorder 2. Personality Disorder
# 2. Personality Disorder        3. Schizophrenia        3. Schizophrenia
#                5. Other                5. Other                5. Other
# 2. Personality Disorder 2. Personality Disorder 2. Personality Disorder
#           1. Depression           1. Depression        3. Schizophrenia
#        3. Schizophrenia        3. Schizophrenia        3. Schizophrenia
#           1. Depression           1. Depression        3. Schizophrenia
#           1. Depression           1. Depression             4. Neurosis
#                5. Other                5. Other                5. Other
#           1. Depression             4. Neurosis             4. Neurosis
#           1. Depression 2. Personality Disorder             4. Neurosis
# 2. Personality Disorder 2. Personality Disorder 2. Personality Disorder
#           1. Depression             4. Neurosis             4. Neurosis
# 2. Personality Disorder 2. Personality Disorder             4. Neurosis
#        3. Schizophrenia        3. Schizophrenia        3. Schizophrenia
#           1. Depression           1. Depression           1. Depression
#           1. Depression           1. Depression           1. Depression
# 2. Personality Disorder 2. Personality Disorder             4. Neurosis
#           1. Depression        3. Schizophrenia        3. Schizophrenia
#                5. Other                5. Other                5. Other
# 2. Personality Disorder             4. Neurosis             4. Neurosis
# 2. Personality Disorder 2. Personality Disorder             4. Neurosis
#           1. Depression           1. Depression             4. Neurosis
#           1. Depression             4. Neurosis             4. Neurosis
# 2. Personality Disorder 2. Personality Disorder 2. Personality Disorder
#           1. Depression           1. Depression           1. Depression
# 2. Personality Disorder 2. Personality Disorder             4. Neurosis
#           1. Depression        3. Schizophrenia        3. Schizophrenia
#                5. Other                5. Other                5. Other
</span></code></pre>
</div>

<h4 id="two-raters-cohens-kappa">Two raters: Cohen’s Kappa</h4>

<p>This will calculate Cohen’s Kappa for two coders – In this case, raters 1 and 2.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">kappa2</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)],</span><span class="w"> </span><span class="s2">"unweighted"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Cohen's Kappa for 2 Raters (Weights: unweighted)
#&gt; 
#&gt;  Subjects = 30 
#&gt;    Raters = 2 
#&gt;     Kappa = 0.651 
#&gt; 
#&gt;         z = 7 
#&gt;   p-value = 2.63e-12
</span></code></pre>
</div>

<h4 id="n-raters-fleisss-kappa-congers-kappa">N raters: Fleiss’s Kappa, Conger’s Kappa</h4>

<p>If there are more than two raters, use Fleiss’s Kappa.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">kappam.fleiss</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Fleiss' Kappa for m Raters
#&gt; 
#&gt;  Subjects = 30 
#&gt;    Raters = 3 
#&gt;     Kappa = 0.534 
#&gt; 
#&gt;         z = 9.89 
#&gt;   p-value = 0
</span></code></pre>
</div>

<p>It is also possible to use Conger’s (1980) exact Kappa. (Note that it is not clear to me when it is better or worse to use the exact method.)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">kappam.fleiss</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">exact</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Fleiss' Kappa for m Raters (exact value)
#&gt; 
#&gt;  Subjects = 30 
#&gt;    Raters = 3 
#&gt;     Kappa = 0.55
</span></code></pre>
</div>

<h3 id="ordinal-data-weighted-kappa">Ordinal data: weighted Kappa</h3>

<p>If the data is ordinal, then it may be appropriate to use a <strong>weighted</strong> Kappa. For example, if the possible values are low, medium, and high, then if a case were rated medium and high by the two coders, they would be in better agreement than if the ratings were low and high.</p>

<p>We will use a subset of the <code class="highlighter-rouge">anxiety</code> data set from the irr package.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">irr</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">anxiety</span><span class="p">)</span><span class="w">

</span><span class="n">dfa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">anxiety</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)]</span><span class="w">
</span><span class="n">dfa</span><span class="w">
</span><span class="c1">#&gt;    rater1 rater2
#&gt; 1       3      3
#&gt; 2       3      6
#&gt; 3       3      4
#&gt; 4       4      6
#&gt; 5       5      2
#&gt; 6       5      4
#&gt; 7       2      2
#&gt; 8       3      4
#&gt; 9       5      3
#&gt; 10      2      3
#&gt; 11      2      2
#&gt; 12      6      3
#&gt; 13      1      3
#&gt; 14      5      3
#&gt; 15      2      2
#&gt; 16      2      2
#&gt; 17      1      1
#&gt; 18      2      3
#&gt; 19      4      3
#&gt; 20      3      4
</span></code></pre>
</div>

<p>The weighted Kappa calculation must be made with 2 raters, and can use either <strong>linear</strong> or <strong>squared</strong> weights of the differences.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Compare raters 1 and 2 with squared weights
</span><span class="n">kappa2</span><span class="p">(</span><span class="n">dfa</span><span class="p">,</span><span class="w"> </span><span class="s2">"squared"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Cohen's Kappa for 2 Raters (Weights: squared)
#&gt; 
#&gt;  Subjects = 20 
#&gt;    Raters = 2 
#&gt;     Kappa = 0.297 
#&gt; 
#&gt;         z = 1.34 
#&gt;   p-value = 0.18
</span><span class="w">

</span><span class="c1"># Use linear weights
</span><span class="n">kappa2</span><span class="p">(</span><span class="n">dfa</span><span class="p">,</span><span class="w"> </span><span class="s2">"equal"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Cohen's Kappa for 2 Raters (Weights: equal)
#&gt; 
#&gt;  Subjects = 20 
#&gt;    Raters = 2 
#&gt;     Kappa = 0.189 
#&gt; 
#&gt;         z = 1.42 
#&gt;   p-value = 0.157
</span></code></pre>
</div>

<p>Compare the results above to the <strong>unweighted</strong> calculation (used in the tests for non-ordinal data above), which treats all differences as the same:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">kappa2</span><span class="p">(</span><span class="n">dfa</span><span class="p">,</span><span class="w"> </span><span class="s2">"unweighted"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Cohen's Kappa for 2 Raters (Weights: unweighted)
#&gt; 
#&gt;  Subjects = 20 
#&gt;    Raters = 2 
#&gt;     Kappa = 0.119 
#&gt; 
#&gt;         z = 1.16 
#&gt;   p-value = 0.245
</span></code></pre>
</div>

<h4 id="weighted-kappa-with-factors">Weighted Kappa with factors</h4>

<p>The data above is numeric, but a weighted Kappa can also be calculated for factors. Note that the factor levels must be in the correct order, or results will be wrong.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make a factor-ized version of the data
</span><span class="n">dfa2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dfa</span><span class="w">
</span><span class="n">dfa2</span><span class="o">$</span><span class="n">rater1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">dfa2</span><span class="o">$</span><span class="n">rater1</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nb">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">])</span><span class="w">
</span><span class="n">dfa2</span><span class="o">$</span><span class="n">rater2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">dfa2</span><span class="o">$</span><span class="n">rater2</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nb">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">])</span><span class="w">
</span><span class="n">dfa2</span><span class="w">
</span><span class="c1">#&gt;    rater1 rater2
#&gt; 1       C      C
#&gt; 2       C      F
#&gt; 3       C      D
#&gt; 4       D      F
#&gt; 5       E      B
#&gt; 6       E      D
#&gt; 7       B      B
#&gt; 8       C      D
#&gt; 9       E      C
#&gt; 10      B      C
#&gt; 11      B      B
#&gt; 12      F      C
#&gt; 13      A      C
#&gt; 14      E      C
#&gt; 15      B      B
#&gt; 16      B      B
#&gt; 17      A      A
#&gt; 18      B      C
#&gt; 19      D      C
#&gt; 20      C      D
</span><span class="w">
</span><span class="c1"># The factor levels must be in the correct order:
</span><span class="n">levels</span><span class="p">(</span><span class="n">dfa2</span><span class="o">$</span><span class="n">rater1</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "A" "B" "C" "D" "E" "F"
</span><span class="n">levels</span><span class="p">(</span><span class="n">dfa2</span><span class="o">$</span><span class="n">rater2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "A" "B" "C" "D" "E" "F"
</span><span class="w">

</span><span class="c1"># The results are the same as with the numeric data, above
</span><span class="n">kappa2</span><span class="p">(</span><span class="n">dfa2</span><span class="p">,</span><span class="w"> </span><span class="s2">"squared"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Cohen's Kappa for 2 Raters (Weights: squared)
#&gt; 
#&gt;  Subjects = 20 
#&gt;    Raters = 2 
#&gt;     Kappa = 0.297 
#&gt; 
#&gt;         z = 1.34 
#&gt;   p-value = 0.18
</span><span class="w">

</span><span class="c1"># Use linear weights
</span><span class="n">kappa2</span><span class="p">(</span><span class="n">dfa2</span><span class="p">,</span><span class="w"> </span><span class="s2">"equal"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Cohen's Kappa for 2 Raters (Weights: equal)
#&gt; 
#&gt;  Subjects = 20 
#&gt;    Raters = 2 
#&gt;     Kappa = 0.189 
#&gt; 
#&gt;         z = 1.42 
#&gt;   p-value = 0.157
</span></code></pre>
</div>

<h3 id="continuous-data-intraclass-correlation-coefficient">Continuous data: Intraclass correlation coefficient</h3>

<p>When the variable is continuous, the intraclass correlation coefficient should be computed. From the documentation for <code class="highlighter-rouge">icc</code>:</p>

<p>When considering which form of ICC is appropriate for an actual set of data, one has take several decisions (Shrout &amp; Fleiss, 1979):</p>
<ol>
<li>Should only the subjects be considered as random effects (<code class="highlighter-rouge">"oneway"</code> model, default) or are subjects and raters randomly chosen from a bigger pool of persons (<code class="highlighter-rouge">"twoway"</code> model).</li>
<li>If differences in judges’ mean ratings are of interest, interrater <code class="highlighter-rouge">"agreement"</code> instead of <code class="highlighter-rouge">"consistency"</code> (default) should be computed.</li>
<li>If the unit of analysis is a mean of several ratings, <code class="highlighter-rouge">unit</code> should be changed to <code class="highlighter-rouge">"average"</code>. In most cases, however, single values (<code class="highlighter-rouge">unit="single"</code>, default) are regarded.</li>
</ol>

<p>We will use the <code class="highlighter-rouge">anxiety</code> data set from the irr package.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">irr</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">anxiety</span><span class="p">)</span><span class="w">
</span><span class="n">anxiety</span><span class="w">
</span><span class="c1">#&gt;    rater1 rater2 rater3
#&gt; 1       3      3      2
#&gt; 2       3      6      1
#&gt; 3       3      4      4
#&gt; 4       4      6      4
#&gt; 5       5      2      3
#&gt; 6       5      4      2
#&gt; 7       2      2      1
#&gt; 8       3      4      6
#&gt; 9       5      3      1
#&gt; 10      2      3      1
#&gt; 11      2      2      1
#&gt; 12      6      3      2
#&gt; 13      1      3      3
#&gt; 14      5      3      3
#&gt; 15      2      2      1
#&gt; 16      2      2      1
#&gt; 17      1      1      3
#&gt; 18      2      3      3
#&gt; 19      4      3      2
#&gt; 20      3      4      2
</span><span class="w">
</span><span class="c1"># Just one of the many possible ICC coefficients
</span><span class="n">icc</span><span class="p">(</span><span class="n">anxiety</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="o">=</span><span class="s2">"twoway"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"agreement"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  Single Score Intraclass Correlation
#&gt; 
#&gt;    Model: twoway 
#&gt;    Type : agreement 
#&gt; 
#&gt;    Subjects = 20 
#&gt;      Raters = 3 
#&gt;    ICC(A,1) = 0.198
#&gt; 
#&gt;  F-Test, H0: r0 = 0 ; H1: r0 &gt; 0 
#&gt;  F(19,39.7) = 1.83 , p = 0.0543 
#&gt; 
#&gt;  95%-Confidence Interval for ICC Population Values:
#&gt;   -0.039 &lt; ICC &lt; 0.494
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-57">Bar and line graphs (ggplot2)</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to do make basic bar or line graphs.</p>

<h3 id="solution">Solution</h3>

<p>To make graphs with ggplot2, the data must be in a data frame, and in “long” (as opposed to wide) format. If your data needs to be restructured, see <a href="../../Manipulating_data/Converting_data_between_wide_and_long_format">this page</a> for more information.</p>

<h3 id="basic-graphs-with-discrete-x-axis">Basic graphs with discrete x-axis</h3>

<p>With bar graphs, there are two different things that the heights of bars commonly represent:</p>

<ul>
<li>The <em>count</em> of cases for each group – typically, each x value represents one group. This is done with <code class="highlighter-rouge">stat_bin</code>, which calculates the number of cases in each group (if x is discrete, then each x value is a group; if x is continuous, then all the data is automatically in one group, unless you specifiy grouping with <code class="highlighter-rouge">group=xx</code>).</li>
<li>The <em>value</em> of a column in the data set. This is done with <code class="highlighter-rouge">stat_identity</code>, which leaves the y values unchanged.</li>
</ul>

<table>
<thead>
<tr>
<th>x axis is</th>
<th>Height of bar represents</th>
<th>Common name</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Continuous</em></strong></td>
<td><strong><em>Count</em></strong></td>
<td>Histogram</td>
</tr>
<tr>
<td><strong><em>Discrete</em></strong></td>
<td><strong><em>Count</em></strong></td>
<td>Bar graph</td>
</tr>
<tr>
<td><strong><em>Continuous</em></strong></td>
<td><strong><em>Value</em></strong></td>
<td>Bar graph</td>
</tr>
<tr>
<td><strong><em>Discrete</em></strong></td>
<td><strong><em>Value</em></strong></td>
<td>Bar graph</td>
</tr>
</tbody>
</table>

<p>In ggplot2, the default is to use <code class="highlighter-rouge">stat_bin</code>, so that the bar height represents the count of cases.</p>

<h5 id="bar-graphs-of-values">Bar graphs of values</h5>

<p>Here is some sample data (derived from the <code class="highlighter-rouge">tips</code> dataset in the reshape2 package):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Lunch"</span><span class="p">,</span><span class="s2">"Dinner"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Lunch"</span><span class="p">,</span><span class="s2">"Dinner"</span><span class="p">)),</span><span class="w">
</span><span class="n">total_bill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">14.89</span><span class="p">,</span><span class="w"> </span><span class="m">17.23</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="w">
</span><span class="c1">#&gt;     time total_bill
#&gt; 1  Lunch      14.89
#&gt; 2 Dinner      17.23
</span><span class="w">
</span><span class="c1"># Load the ggplot2 package
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>In these examples, the height of the bar will represent the <em>value</em> in a column of the data frame. This is done by using <code class="highlighter-rouge">stat="identity"</code> instead of the default, <code class="highlighter-rouge">stat="bin"</code>.</p>

<p>These are the variable mappings used here:</p>

<ul>
<li><code class="highlighter-rouge">time</code>: x-axis and sometimes color fill</li>
<li><code class="highlighter-rouge">total_bill</code>: y-axis</li>
</ul>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Very basic bar graph
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">


</span><span class="c1"># Map the time of day to different fill colors
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">time</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">

</span><span class="c1">## This would have the same result as above
# ggplot(data=dat, aes(x=time, y=total_bill)) +
#    geom_bar(aes(fill=time), stat="identity")
</span><span class="w">

</span><span class="c1"># Add a black outline
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">time</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">


</span><span class="c1"># No legend, since the information is redundant
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">time</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-3-4.png" alt="plot of chunk unnamed-chunk-3"></p>

<p>The desired bar graph might look something like this:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Add title, narrower bars, fill color, and change axis labels
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">time</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"#DD8888"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">.8</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Time of day"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Total bill"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Average bill for 2 people"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"></p>

<p>See <a href="../Colors_(ggplot2)">../Colors (ggplot2)</a> for more information on colors.</p>

<h5 id="bar-graphs-of-counts">Bar graphs of counts</h5>

<p>In these examples, the height of the bar will represent the <em>count</em> of cases.
This is done by using <code class="highlighter-rouge">stat="bin"</code> (which is the default).</p>

<p>We’ll start with the <code class="highlighter-rouge">tips</code> data from the reshape2 package:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="c1"># Look at fist several rows
</span><span class="n">head</span><span class="p">(</span><span class="n">tips</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   total_bill  tip    sex smoker day   time size
#&gt; 1      16.99 1.01 Female     No Sun Dinner    2
#&gt; 2      10.34 1.66   Male     No Sun Dinner    3
#&gt; 3      21.01 3.50   Male     No Sun Dinner    3
#&gt; 4      23.68 3.31   Male     No Sun Dinner    2
#&gt; 5      24.59 3.61 Female     No Sun Dinner    4
#&gt; 6      25.29 4.71   Male     No Sun Dinner    4
</span></code></pre>
</div>

<p>To get a bar graph of counts, don’t map a variable to <code class="highlighter-rouge">y</code>, and use <code class="highlighter-rouge">stat="bin"</code> (which is the default) instead of <code class="highlighter-rouge">stat="identity"</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Bar graph of counts
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tips</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">day</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"count"</span><span class="p">)</span><span class="w">
</span><span class="c1">## Equivalent to this, since stat="bin" is the default:
# ggplot(data=tips, aes(x=day)) +
#    geom_bar()
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"></p>

<h4 id="line-graphs">Line graphs</h4>

<p>For line graphs, the data points must be grouped so that it knows which points to connect. In this case, it is simple – all points should be connected, so <code class="highlighter-rouge">group=1</code>. When more variables are used and multiple lines are drawn, the grouping for lines is usually done by variable (this is seen in later examples).</p>

<p>These are the variable mappings used here:</p>

<ul>
<li><code class="highlighter-rouge">time</code>: x-axis</li>
<li><code class="highlighter-rouge">total_bill</code>: y-axis</li>
</ul>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Basic line graph
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w">
</span><span class="c1">## This would have the same result as above
# ggplot(data=dat, aes(x=time, y=total_bill)) +
#     geom_line(aes(group=1))
</span><span class="w">
</span><span class="c1"># Add points
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Change color of both line and points
# Change line type and point type, and use thicker line and larger points
# Change points to circles with white fill
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-7-3.png" alt="plot of chunk unnamed-chunk-7"></p>

<p>The desired line graph might look something like this:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Change the y-range to go from 0 to the maximum value in the total_bill column,
# and change axis labels
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">expand_limits</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Time of day"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Total bill"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Average bill for 2 people"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8"></p>

<p>See <a href="../Colors_(ggplot2)">../Colors (ggplot2)</a> for more information on colors, and <a href="../Shapes_and_line_types">../Shapes and line types</a> for information on shapes and line types.</p>

<h3 id="graphs-with-more-variables">Graphs with more variables</h3>

<p>This data will be used for the examples below:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Female"</span><span class="p">,</span><span class="s2">"Female"</span><span class="p">,</span><span class="s2">"Male"</span><span class="p">,</span><span class="s2">"Male"</span><span class="p">)),</span><span class="w">
</span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Lunch"</span><span class="p">,</span><span class="s2">"Dinner"</span><span class="p">,</span><span class="s2">"Lunch"</span><span class="p">,</span><span class="s2">"Dinner"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Lunch"</span><span class="p">,</span><span class="s2">"Dinner"</span><span class="p">)),</span><span class="w">
</span><span class="n">total_bill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">13.53</span><span class="p">,</span><span class="w"> </span><span class="m">16.81</span><span class="p">,</span><span class="w"> </span><span class="m">16.24</span><span class="p">,</span><span class="w"> </span><span class="m">17.42</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">dat1</span><span class="w">
</span><span class="c1">#&gt;      sex   time total_bill
#&gt; 1 Female  Lunch      13.53
#&gt; 2 Female Dinner      16.81
#&gt; 3   Male  Lunch      16.24
#&gt; 4   Male Dinner      17.42
</span></code></pre>
</div>
<p>This is derived from the <code class="highlighter-rouge">tips</code> dataset in the reshape2 package.</p>

<h4 id="bar-graphs">Bar graphs</h4>

<p>These are the variable mappings used here:</p>

<ul>
<li><code class="highlighter-rouge">time</code>: x-axis</li>
<li><code class="highlighter-rouge">sex</code>: color fill</li>
<li><code class="highlighter-rouge">total_bill</code>: y-axis.</li>
</ul>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Stacked bar graph -- this is probably not what you want
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Bar graph, time on x-axis, color fill grouped by sex -- use position_dodge()
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Change colors
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#999999"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#E69F00"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-10-2.png" alt="plot of chunk unnamed-chunk-10"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-10-3.png" alt="plot of chunk unnamed-chunk-10"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-10-4.png" alt="plot of chunk unnamed-chunk-10"></p>

<p>It’s easy to change which variable is mapped the x-axis and which is mapped to the fill.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Bar graph, time on x-axis, color fill grouped by sex -- use position_dodge()
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">time</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"></p>

<p>See <a href="../Colors_(ggplot2)">../Colors (ggplot2)</a> for more information on colors.</p>

<h4 id="line-graphs-1">Line graphs</h4>

<p>These are the variable mappings used here:</p>

<ul>
<li><code class="highlighter-rouge">time</code>: x-axis</li>
<li><code class="highlighter-rouge">sex</code>: line color</li>
<li><code class="highlighter-rouge">total_bill</code>: y-axis.</li>
</ul>

<p>To draw multiple lines, the points must be grouped by a variable; otherwise all points will be connected by a single line. In this case, we want them to be grouped by sex.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Basic line graph with points
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Map sex to color
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Map sex to different point shape, and use larger points
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">


</span><span class="c1"># Use thicker lines and larger points, and hollow white-filled points
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_shape_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">22</span><span class="p">,</span><span class="m">21</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-12-3.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-12-4.png" alt="plot of chunk unnamed-chunk-12"></p>

<p>It’s easy to change which variable is mapped the x-axis and which is mapped to the color or shape.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">time</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13"></p>

<p>See <a href="../Colors_(ggplot2)">../Colors (ggplot2)</a> for more information on colors, and <a href="../Shapes_and_line_types">../Shapes and line types</a> for information on shapes and line types.</p>

<h4 id="finished-examples">Finished examples</h4>

<p>The finished graphs might look like these:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A bar graph
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
       </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w">
       </span><span class="n">size</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                        </span><span class="c1"># Thinner lines
</span><span class="w">    </span><span class="n">scale_fill_hue</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Sex of payer"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">      </span><span class="c1"># Set legend title
</span><span class="w">    </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Time of day"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Total bill"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># Set axis labels
</span><span class="w">    </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Average bill for 2 people"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">     </span><span class="c1"># Set title
</span><span class="w">    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w">


</span><span class="c1"># A line graph
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="n">sex</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">     </span><span class="c1"># Set linetype by sex
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">         </span><span class="c1"># Use larger points, fill with white
</span><span class="w">    </span><span class="n">expand_limits</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                       </span><span class="c1"># Set y range to include 0
</span><span class="w">    </span><span class="n">scale_colour_hue</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Sex of payer"</span><span class="p">,</span><span class="w">      </span><span class="c1"># Set legend title
</span><span class="w">                     </span><span class="n">l</span><span class="o">=</span><span class="m">30</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">                  </span><span class="c1"># Use darker colors (lightness=30)
</span><span class="w">    </span><span class="n">scale_shape_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Sex of payer"</span><span class="p">,</span><span class="w">
                 </span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">22</span><span class="p">,</span><span class="m">21</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">      </span><span class="c1"># Use points with a fill color
</span><span class="w">    </span><span class="n">scale_linetype_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Sex of payer"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Time of day"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Total bill"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># Set axis labels
</span><span class="w">    </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Average bill for 2 people"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">     </span><span class="c1"># Set title
</span><span class="w">    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">.7</span><span class="p">,</span><span class="w"> </span><span class="m">.4</span><span class="p">))</span><span class="w">           </span><span class="c1"># Position legend inside
</span><span class="w">                                               </span><span class="c1"># This must go after theme_bw
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-14-2.png" alt="plot of chunk unnamed-chunk-14"></p>

<p>In the line graph, the reason that the legend title, “Sex of payer”, must be specified three times is so that there is only one legend. The issue is explained <a href="../Legends_(ggplot2)#With_lines_and_points">here</a>.</p>

<h3 id="with-a-numeric-x-axis">With a numeric x-axis</h3>

<p>When the variable on the x-axis is numeric, it is sometimes useful to treat it as continuous, and sometimes useful to treat it as categorical. In this data set, the dose is a numeric variable with values 0.5, 1.0, and 2.0. It might be useful to treat these values as equal categories when making a graph.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">datn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
supp dose length
OJ  0.5  13.23
OJ  1.0  22.70
OJ  2.0  26.06
VC  0.5   7.98
VC  1.0  16.77
VC  2.0  26.14
'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p>This is derived from the <code class="highlighter-rouge">ToothGrowth</code> dataset included with R.</p>

<h4 id="with-x-axis-treated-as-continuous">With x-axis treated as continuous</h4>

<p>A simple graph might put dose on the x-axis as a numeric value. It is possible to make a line graph this way, but not a bar graph.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">datn</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">supp</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16"></p>

<h4 id="with-x-axis-treated-as-categorical">With x-axis treated as categorical</h4>

<p>If you wish to treat it as a categorical variable instead of a numeric one, it must be converted to a factor. This can be done by modifying the data frame, or by changing the specification of the graph.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Copy the data frame and convert dose to a factor
</span><span class="n">datn2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">datn</span><span class="w">
</span><span class="n">datn2</span><span class="o">$</span><span class="n">dose</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">datn2</span><span class="o">$</span><span class="n">dose</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">datn2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">supp</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Use the original data frame, but put factor() directly in the plot specification
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">datn</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">dose</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">supp</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-17-2.png" alt="plot of chunk unnamed-chunk-17"></p>

<p>It is also possible to make a bar graph when the variable is treated as categorical rather than numeric.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Use datn2 from above
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">datn2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w">

</span><span class="c1"># Use the original data frame, but put factor() directly in the plot specification
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">datn</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">dose</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18"><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-18-2.png" alt="plot of chunk unnamed-chunk-18"></p>

</article>
<h2 class="post-title" id="topic-58">Plotting means and error bars (ggplot2)</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to plot means and error bars for a dataset.</p>

<h3 id="solution">Solution</h3>

<p>To make graphs with ggplot2, the data must be in a data frame, and in “long” (as opposed to wide) format. If your data needs to be restructured, see <a href="../../Manipulating_data/Converting_data_between_wide_and_long_format">this page</a> for more information.</p>

<h3 id="sample-data">Sample data</h3>

<p>The examples below will the <code class="highlighter-rouge">ToothGrowth</code> dataset. Note that <code class="highlighter-rouge">dose</code> is a numeric column here; in some situations it may be useful to convert it to a factor.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">tg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ToothGrowth</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">tg</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    len supp dose
#&gt; 1  4.2   VC  0.5
#&gt; 2 11.5   VC  0.5
#&gt; 3  7.3   VC  0.5
#&gt; 4  5.8   VC  0.5
#&gt; 5  6.4   VC  0.5
#&gt; 6 10.0   VC  0.5
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>First, it is necessary to summarize the data. This can be done in a number of ways, as described on <a href="../../Manipulating_data/Summarizing_data">this page</a>. In this case, we’ll use the <code class="highlighter-rouge">summarySE()</code> function defined on that page, and also at the <a href="#Helper functions">bottom</a> of this page. (The code for the <code class="highlighter-rouge">summarySE</code> function must be entered before it is called here).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># summarySE provides the standard deviation, standard error of the mean, and a (default 95%) confidence interval
</span><span class="n">tgc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarySE</span><span class="p">(</span><span class="n">tg</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"len"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"supp"</span><span class="p">,</span><span class="s2">"dose"</span><span class="p">))</span><span class="w">
</span><span class="n">tgc</span><span class="w">
</span><span class="c1">#&gt;   supp dose  N   len       sd        se       ci
#&gt; 1   OJ  0.5 10 13.23 4.459709 1.4102837 3.190283
#&gt; 2   OJ  1.0 10 22.70 3.910953 1.2367520 2.797727
#&gt; 3   OJ  2.0 10 26.06 2.655058 0.8396031 1.899314
#&gt; 4   VC  0.5 10  7.98 2.746634 0.8685620 1.964824
#&gt; 5   VC  1.0 10 16.77 2.515309 0.7954104 1.799343
#&gt; 6   VC  2.0 10 26.14 4.797731 1.5171757 3.432090
</span></code></pre>
</div>

<h3 id="line-graphs">Line graphs</h3>

<p>After the data is summarized, we can make the graph. These are basic line and point graph with error bars representing either the standard error of the mean, or 95% confidence interval.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Standard error of the mean
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">tgc</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">len</span><span class="o">-</span><span class="n">se</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">len</span><span class="o">+</span><span class="n">se</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">


</span><span class="c1"># The errorbars overlapped, so use position_dodge to move them horizontally
</span><span class="n">pd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">(</span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="c1"># move them .05 to the left and right
</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">tgc</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">len</span><span class="o">-</span><span class="n">se</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">len</span><span class="o">+</span><span class="n">se</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">.1</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w">


</span><span class="c1"># Use 95% confidence interval instead of SEM
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">tgc</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">len</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">len</span><span class="o">+</span><span class="n">ci</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">.1</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w">

</span><span class="c1"># Black error bars - notice the mapping of 'group=supp' -- without it, the error
# bars won't be dodged!
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">tgc</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">supp</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">len</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">len</span><span class="o">+</span><span class="n">ci</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">.1</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-4-4.png" alt="plot of chunk unnamed-chunk-4"></p>

<p>A finished graph with error bars representing the standard error of the mean might look like this. The points are drawn last so that the white fill goes on top of the lines and error bars.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">tgc</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">supp</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">len</span><span class="o">-</span><span class="n">se</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">len</span><span class="o">+</span><span class="n">se</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">.1</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pd</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># 21 is filled circle
</span><span class="w">    </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Dose (mg)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Tooth length"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_colour_hue</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Supplement type"</span><span class="p">,</span><span class="w">    </span><span class="c1"># Legend label, use darker colors
</span><span class="w">                     </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"OJ"</span><span class="p">,</span><span class="w"> </span><span class="s2">"VC"</span><span class="p">),</span><span class="w">
               </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Orange juice"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ascorbic acid"</span><span class="p">),</span><span class="w">
               </span><span class="n">l</span><span class="o">=</span><span class="m">40</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                    </span><span class="c1"># Use darker colors, lightness=40
</span><span class="w">    </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"The Effect of Vitamin C on\nTooth Growth in Guinea Pigs"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">expand_limits</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                        </span><span class="c1"># Expand y range
</span><span class="w">    </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="m">0</span><span class="o">:</span><span class="m">20</span><span class="o">*</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">         </span><span class="c1"># Set tick every 4
</span><span class="w">    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="w">
    </span><span class="n">legend.position</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">))</span><span class="w">               </span><span class="c1"># Position legend in bottom right
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"></p>

<h3 id="bar-graphs">Bar graphs</h3>

<p>The procedure is similar for bar graphs. Note that <code class="highlighter-rouge">tgc$size</code> must be a factor. If it is a numeric vector, then it will not work.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Use dose as a factor rather than numeric
</span><span class="n">tgc2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tgc</span><span class="w">
</span><span class="n">tgc2</span><span class="o">$</span><span class="n">dose</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">tgc2</span><span class="o">$</span><span class="n">dose</span><span class="p">)</span><span class="w">

</span><span class="c1"># Error bars represent standard error of the mean
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">tgc2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">len</span><span class="o">-</span><span class="n">se</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">len</span><span class="o">+</span><span class="n">se</span><span class="p">),</span><span class="w">
            </span><span class="n">width</span><span class="o">=</span><span class="m">.2</span><span class="p">,</span><span class="w">                    </span><span class="c1"># Width of the error bars
</span><span class="w">                  </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="m">.9</span><span class="p">))</span><span class="w">


</span><span class="c1"># Use 95% confidence intervals instead of SEM
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">tgc2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">len</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">len</span><span class="o">+</span><span class="n">ci</span><span class="p">),</span><span class="w">
            </span><span class="n">width</span><span class="o">=</span><span class="m">.2</span><span class="p">,</span><span class="w">                    </span><span class="c1"># Width of the error bars
</span><span class="w">                  </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="m">.9</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-6-2.png" alt="plot of chunk unnamed-chunk-6"></p>

<p>A finished graph might look like this.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">tgc2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">supp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
       </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Use black outlines,
</span><span class="w">             </span><span class="n">size</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">      </span><span class="c1"># Thinner lines
</span><span class="w">    </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">len</span><span class="o">-</span><span class="n">se</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">len</span><span class="o">+</span><span class="n">se</span><span class="p">),</span><span class="w">
            </span><span class="n">size</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="w">    </span><span class="c1"># Thinner lines
</span><span class="w">                  </span><span class="n">width</span><span class="o">=</span><span class="m">.2</span><span class="p">,</span><span class="w">
            </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="m">.9</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Dose (mg)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Tooth length"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_fill_hue</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Supplement type"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Legend label, use darker colors
</span><span class="w">                   </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"OJ"</span><span class="p">,</span><span class="w"> </span><span class="s2">"VC"</span><span class="p">),</span><span class="w">
             </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Orange juice"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ascorbic acid"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"The Effect of Vitamin C on\nTooth Growth in Guinea Pigs"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="m">0</span><span class="o">:</span><span class="m">20</span><span class="o">*</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme_bw</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"></p>

<h3 id="error-bars-for-within-subjects-variables">Error bars for within-subjects variables</h3>

<p>When all variables are between-subjects, it is straightforward to plot standard error or confidence intervals. However, when there are within-subjects variables (repeated measures), plotting the standard error or regular confidence intervals may be misleading for making inferences about differences between conditions.</p>

<p>The method below is from <a href="http://tqmp.org/Content/vol04-2/p061/p061.html">Morey (2008)</a>, which is a correction to <a href="http://tqmp.org/Content/vol01-1/p042/p042.html">Cousineau (2005)</a>, which in turn is meant to be a simpler method of that in <a href="http://www.springerlink.com/content/n2r2t04244246k68/">Loftus and Masson (1994)</a>. See these papers for a more detailed treatment of the issues involved in error bars with within-subjects variables.</p>

<h4 id="one-within-subjects-variable">One within-subjects variable</h4>
<p>Here is a data set (from Morey 2008) with one within-subjects variable: pre/post-test.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dfw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 subject pretest posttest
 1    59.4     64.5
 2    46.4     52.4
 3    46.0     49.7
 4    49.0     48.7
 5    32.5     37.4
 6    45.2     49.5
 7    60.3     59.9
 8    54.3     54.1
 9    45.4     49.6
10    38.9     48.5
 '</span><span class="p">)</span><span class="w">

</span><span class="c1"># Treat subject ID as a factor
</span><span class="n">dfw</span><span class="o">$</span><span class="n">subject</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">dfw</span><span class="o">$</span><span class="n">subject</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>The first step is to convert it to long format. See <a href="../../Manipulating_data/Converting_data_between_wide_and_long_format">this page</a> for more information about the conversion.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Convert to long format
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">dfw_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">dfw</span><span class="p">,</span><span class="w">
           </span><span class="n">id.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"subject"</span><span class="p">,</span><span class="w">
           </span><span class="n">measure.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"pretest"</span><span class="p">,</span><span class="s2">"posttest"</span><span class="p">),</span><span class="w">
           </span><span class="n">variable.name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"condition"</span><span class="p">)</span><span class="w">

</span><span class="n">dfw_long</span><span class="w">
</span><span class="c1">#&gt;    subject condition value
#&gt; 1        1   pretest  59.4
#&gt; 2        2   pretest  46.4
#&gt; 3        3   pretest  46.0
#&gt; 4        4   pretest  49.0
#&gt; 5        5   pretest  32.5
#&gt; 6        6   pretest  45.2
#&gt; 7        7   pretest  60.3
#&gt; 8        8   pretest  54.3
#&gt; 9        9   pretest  45.4
#&gt; 10      10   pretest  38.9
#&gt; 11       1  posttest  64.5
#&gt; 12       2  posttest  52.4
#&gt; 13       3  posttest  49.7
#&gt; 14       4  posttest  48.7
#&gt; 15       5  posttest  37.4
#&gt; 16       6  posttest  49.5
#&gt; 17       7  posttest  59.9
#&gt; 18       8  posttest  54.1
#&gt; 19       9  posttest  49.6
#&gt; 20      10  posttest  48.5
</span></code></pre>
</div>

<p>Collapse the data using <code class="highlighter-rouge">summarySEwithin</code> (defined at the <a href="#Helper functions">bottom</a> of this page; both of the helper functions below must be entered before the function is called here).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dfwc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarySEwithin</span><span class="p">(</span><span class="n">dfw_long</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="n">withinvars</span><span class="o">=</span><span class="s2">"condition"</span><span class="p">,</span><span class="w">
                  </span><span class="n">idvar</span><span class="o">=</span><span class="s2">"subject"</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">conf.interval</span><span class="o">=</span><span class="m">.95</span><span class="p">)</span><span class="w">

</span><span class="n">dfwc</span><span class="w">
</span><span class="c1">#&gt;   condition  N value value_norm       sd        se       ci
#&gt; 1  posttest 10 51.43      51.43 2.262361 0.7154214 1.618396
#&gt; 2   pretest 10 47.74      47.74 2.262361 0.7154214 1.618396
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="c1"># Make the graph with the 95% confidence interval
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dfwc</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">.1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">value</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">value</span><span class="o">+</span><span class="n">ci</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ylim</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="m">60</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10"></p>

<p>The <code class="highlighter-rouge">value</code> and <code class="highlighter-rouge">value_norm</code> columns represent the un-normed and normed means. See the section below on normed means for more information.</p>

<h4 id="understanding-within-subjects-error-bars">Understanding within-subjects error bars</h4>

<p>This section explains how the within-subjects error bar values are calculated. The steps here are for explanation purposes only; they are not necessary for <strong>making</strong> the error bars.</p>

<p>The graph of individual data shows that there is a consistent trend for the within-subjects variable <code class="highlighter-rouge">condition</code>, but this would not necessarily be revealed by taking the regular standard errors (or confidence intervals) for each group. The method in Morey (2008) and Cousineau (2005) essentially normalizes the data to remove the between-subject variability and calculates the variance from this normalized data.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Use a consistent y range
</span><span class="n">ymax</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">dfw_long</span><span class="o">$</span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="n">ymin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">dfw_long</span><span class="o">$</span><span class="n">value</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot the individuals
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dfw_long</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">subject</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span><span class="w">


</span><span class="c1"># Create the normed version of the data
</span><span class="n">dfwNorm.long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">normDataWithin</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dfw_long</span><span class="p">,</span><span class="w"> </span><span class="n">idvar</span><span class="o">=</span><span class="s2">"subject"</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"value"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot the normed individuals
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dfwNorm.long</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">value_norm</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">subject</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11"></p>

<p>The differences in the error bars for the regular (between-subject) method and the within-subject method are shown here. The regular error bars are in red, and the within-subject error bars are in black.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Instead of summarySEwithin, use summarySE, which treats condition as though it were a between-subjects variable
</span><span class="n">dfwc_between</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarySE</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dfw_long</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="s2">"condition"</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">conf.interval</span><span class="o">=</span><span class="m">.95</span><span class="p">)</span><span class="w">
</span><span class="n">dfwc_between</span><span class="w">
</span><span class="c1">#&gt;   condition  N value       sd       se       ci
#&gt; 1   pretest 10 47.74 8.598992 2.719240 6.151348
#&gt; 2  posttest 10 51.43 7.253972 2.293907 5.189179
</span><span class="w">
</span><span class="c1"># Show the between-S CI's in red, and the within-S CI's in black
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dfwc_between</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">.1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">value</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">value</span><span class="o">+</span><span class="n">ci</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">.1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">value</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">value</span><span class="o">+</span><span class="n">ci</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dfwc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"></p>

<h4 id="two-within-subjects-variables">Two within-subjects variables</h4>

<p>If there is more than one within-subjects variable, the same function, <code class="highlighter-rouge">summarySEwithin</code>, can be used. This data set is taken from <a href="http://books.google.com/books?id=zSi2AAAAIAAJ">Hays (1994)</a>, and used for making this type of within-subject error bar in <a href="http://www.jstor.org/pss/40064075">Rouder and Morey (2005)</a>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 Subject RoundMono SquareMono RoundColor SquareColor
 1        41         40         41          37
 2        57         56         56          53
 3        52         53         53          50
 4        49         47         47          47
 5        47         48         48          47
 6        37         34         35          36
 7        47         50         47          46
 8        41         40         38          40
 9        48         47         49          45
10        37         35         36          35
11        32         31         31          33
12        47         42         42          42
'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>The data must first be converted to long format. In this case, the column names indicate two variables, shape (round/square) and color scheme (monochromatic/colored).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Convert it to long format
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">data_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">id.var</span><span class="o">=</span><span class="s2">"Subject"</span><span class="p">,</span><span class="w">
            </span><span class="n">measure.vars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"RoundMono"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SquareMono"</span><span class="p">,</span><span class="w"> </span><span class="s2">"RoundColor"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SquareColor"</span><span class="p">),</span><span class="w">
            </span><span class="n">variable.name</span><span class="o">=</span><span class="s2">"Condition"</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data_long</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">data_long</span><span class="p">)</span><span class="o">==</span><span class="s2">"value"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Time"</span><span class="w">

</span><span class="c1"># Split Condition column into Shape and ColorScheme
</span><span class="n">data_long</span><span class="o">$</span><span class="n">Shape</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">data_long</span><span class="o">$</span><span class="n">Shape</span><span class="p">[</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^Round"</span><span class="p">,</span><span class="w">  </span><span class="n">data_long</span><span class="o">$</span><span class="n">Condition</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Round"</span><span class="w">
</span><span class="n">data_long</span><span class="o">$</span><span class="n">Shape</span><span class="p">[</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^Square"</span><span class="p">,</span><span class="w"> </span><span class="n">data_long</span><span class="o">$</span><span class="n">Condition</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Square"</span><span class="w">
</span><span class="n">data_long</span><span class="o">$</span><span class="n">Shape</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">Shape</span><span class="p">)</span><span class="w">

</span><span class="n">data_long</span><span class="o">$</span><span class="n">ColorScheme</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">data_long</span><span class="o">$</span><span class="n">ColorScheme</span><span class="p">[</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"Mono$"</span><span class="p">,</span><span class="w">  </span><span class="n">data_long</span><span class="o">$</span><span class="n">Condition</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Monochromatic"</span><span class="w">
</span><span class="n">data_long</span><span class="o">$</span><span class="n">ColorScheme</span><span class="p">[</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"Color$"</span><span class="p">,</span><span class="w"> </span><span class="n">data_long</span><span class="o">$</span><span class="n">Condition</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Colored"</span><span class="w">
</span><span class="n">data_long</span><span class="o">$</span><span class="n">ColorScheme</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">ColorScheme</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Monochromatic"</span><span class="p">,</span><span class="s2">"Colored"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Remove the Condition column now
</span><span class="n">data_long</span><span class="o">$</span><span class="n">Condition</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">

</span><span class="c1"># Look at first few rows 
</span><span class="n">head</span><span class="p">(</span><span class="n">data_long</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   Subject Time Shape   ColorScheme
#&gt; 1       1   41 Round Monochromatic
#&gt; 2       2   57 Round Monochromatic
#&gt; 3       3   52 Round Monochromatic
#&gt; 4       4   49 Round Monochromatic
#&gt; 5       5   47 Round Monochromatic
#&gt; 6       6   37 Round Monochromatic
</span></code></pre>
</div>

<p>Now it can be summarized and graphed.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">datac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarySEwithin</span><span class="p">(</span><span class="n">data_long</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"Time"</span><span class="p">,</span><span class="w"> </span><span class="n">withinvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Shape"</span><span class="p">,</span><span class="s2">"ColorScheme"</span><span class="p">),</span><span class="w"> </span><span class="n">idvar</span><span class="o">=</span><span class="s2">"Subject"</span><span class="p">)</span><span class="w">
</span><span class="n">datac</span><span class="w">
</span><span class="c1">#&gt;    Shape   ColorScheme  N     Time Time_norm       sd        se        ci
#&gt; 1  Round       Colored 12 43.58333  43.58333 1.212311 0.3499639 0.7702654
#&gt; 2  Round Monochromatic 12 44.58333  44.58333 1.331438 0.3843531 0.8459554
#&gt; 3 Square       Colored 12 42.58333  42.58333 1.461630 0.4219364 0.9286757
#&gt; 4 Square Monochromatic 12 43.58333  43.58333 1.261312 0.3641095 0.8013997
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">datac</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Shape</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">ColorScheme</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="m">.9</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="m">.9</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">.25</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">Time</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">Time</span><span class="o">+</span><span class="n">ci</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="m">46</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#CCCCCC"</span><span class="p">,</span><span class="s2">"#FFFFFF"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">38</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/figure/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15"></p>

<h3 id="note-about-normed-means">Note about normed means</h3>

<p>The <code class="highlighter-rouge">summarySEWithin</code> function returns both normed and un-normed means. The un-normed means are simply the mean of each group. The normed means are calculated so that means of each between-subject group are the same. These values can diverge when there are between-subject variables.</p>

<p>For example:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
id trial gender dv
 A     0   male  2
 A     1   male  4
 B     0   male  6
 B     1   male  8
 C     0 female 22
 C     1 female 24
 D     0 female 26
 D     1 female 28
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># normed and un-normed means are different
</span><span class="n">summarySEwithin</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="o">=</span><span class="s2">"dv"</span><span class="p">,</span><span class="w"> </span><span class="n">withinvars</span><span class="o">=</span><span class="s2">"trial"</span><span class="p">,</span><span class="w"> </span><span class="n">betweenvars</span><span class="o">=</span><span class="s2">"gender"</span><span class="p">,</span><span class="w">
          </span><span class="n">idvar</span><span class="o">=</span><span class="s2">"id"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Automatically converting the following non-factors to factors: trial
#&gt;   gender trial N dv dv_norm sd se ci
#&gt; 1 female     0 2 24      14  0  0  0
#&gt; 2 female     1 2 26      16  0  0  0
#&gt; 3   male     0 2  4      14  0  0  0
#&gt; 4   male     1 2  6      16  0  0  0
</span></code></pre>
</div>

<h3 id="helper-functions">Helper functions</h3>

<p>The <code class="highlighter-rouge">summarySE</code> function is also defined on <a href="../../Manipulating_data/Converting_data_between_wide_and_long_format">this page</a>. If you only are working with between-subjects variables, that is the only function you will need in your code. If you have within-subjects variables <strong><em>and</em></strong> want to adjust the error bars so that inter-subject variability is removed as in Loftus and Masson (1994), then the other two functions, <code class="highlighter-rouge">normDataWithin</code> and <code class="highlighter-rouge">summarySEwithin</code> must also be added to your code; <code class="highlighter-rouge">summarySEwithin</code> will then be the function that you call.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
</span><span class="n">summarySE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                </span><span class="n">conf.interval</span><span class="o">=</span><span class="m">.95</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># New version of length which can handle NA's: if na.rm==T, don't count them
</span><span class="w">    </span><span class="n">length2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">na.rm</span><span class="p">)</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
  </span><span class="k">else</span><span class="w">       </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># This does the summary. For each group's data frame, return a vector with
</span><span class="w">    </span><span class="c1"># N, mean, and sd
</span><span class="w">    </span><span class="n">datac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="n">.drop</span><span class="p">,</span><span class="w">
</span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="n">N</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">length2</span><span class="p">(</span><span class="n">xx</span><span class="p">[[</span><span class="n">col</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">),</span><span class="w">
    </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="w">   </span><span class="p">(</span><span class="n">xx</span><span class="p">[[</span><span class="n">col</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">),</span><span class="w">
    </span><span class="n">sd</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="w">     </span><span class="p">(</span><span class="n">xx</span><span class="p">[[</span><span class="n">col</span><span class="p">]],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="n">measurevar</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Rename the "mean" column    
</span><span class="w">    </span><span class="n">datac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rename</span><span class="p">(</span><span class="n">datac</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mean"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measurevar</span><span class="p">))</span><span class="w">

</span><span class="n">datac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">sd</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">datac</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w">  </span><span class="c1"># Calculate standard error of the mean
</span><span class="w">
</span><span class="c1"># Confidence interval multiplier for standard error
</span><span class="w">    </span><span class="c1"># Calculate t-statistic for confidence interval: 
</span><span class="w">    </span><span class="c1"># e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
</span><span class="w">    </span><span class="n">ciMult</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qt</span><span class="p">(</span><span class="n">conf.interval</span><span class="o">/</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">N</span><span class="m">-1</span><span class="p">)</span><span class="w">
</span><span class="n">datac</span><span class="o">$</span><span class="n">ci</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">datac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ciMult</span><span class="w">

</span><span class="nf">return</span><span class="p">(</span><span class="n">datac</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## Norms the data within specified groups in a data frame; it normalizes each
## subject (identified by idvar) so that they have the same mean, within each group
## specified by betweenvars.
##   data: a data frame.
##   idvar: the name of a column that identifies each subject (or matched subjects)
##   measurevar: the name of a column that contains the variable to be summariezed
##   betweenvars: a vector containing names of columns that are between-subjects variables
##   na.rm: a boolean that indicates whether to ignore NA's
</span><span class="n">normDataWithin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">idvar</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">betweenvars</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                     </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">

</span><span class="c1"># Measure var on left, idvar + between vars on right of formula.
</span><span class="w">    </span><span class="n">data.subjMean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">idvar</span><span class="p">,</span><span class="w"> </span><span class="n">betweenvars</span><span class="p">),</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="n">.drop</span><span class="p">,</span><span class="w">
 </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="n">subjMean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">xx</span><span class="p">[,</span><span class="n">col</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">))</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="n">measurevar</span><span class="p">,</span><span class="w">
</span><span class="n">na.rm</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Put the subject means with original data
</span><span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">data.subjMean</span><span class="p">)</span><span class="w">

</span><span class="c1"># Get the normalized data in a new column
</span><span class="w">    </span><span class="n">measureNormedVar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="s2">"_norm"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">[,</span><span class="n">measureNormedVar</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="n">measurevar</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="s2">"subjMean"</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w">
                         </span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="n">measurevar</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">)</span><span class="w">

</span><span class="c1"># Remove this subject mean column
</span><span class="w">    </span><span class="n">data</span><span class="o">$</span><span class="n">subjMean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">

</span><span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## Summarizes data, handling within-subjects variables by removing inter-subject variability.
## It will still work if there are no within-S variables.
## Gives count, un-normed mean, normed mean (with same between-group mean),
##   standard deviation, standard error of the mean, and confidence interval.
## If there are within-subject variables, calculate adjusted values using method from Morey (2008).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   betweenvars: a vector containing names of columns that are between-subjects variables
##   withinvars: a vector containing names of columns that are within-subjects variables
##   idvar: the name of a column that identifies each subject (or matched subjects)
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
</span><span class="n">summarySEwithin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">betweenvars</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">withinvars</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                      </span><span class="n">idvar</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">conf.interval</span><span class="o">=</span><span class="m">.95</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

</span><span class="c1"># Ensure that the betweenvars and withinvars are factors
</span><span class="w">  </span><span class="n">factorvars</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vapply</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">betweenvars</span><span class="p">,</span><span class="w"> </span><span class="n">withinvars</span><span class="p">),</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">],</span><span class="w">
</span><span class="n">FUN</span><span class="o">=</span><span class="n">is.factor</span><span class="p">,</span><span class="w"> </span><span class="n">FUN.VALUE</span><span class="o">=</span><span class="n">logical</span><span class="p">(</span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">all</span><span class="p">(</span><span class="n">factorvars</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">nonfactorvars</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">factorvars</span><span class="p">)[</span><span class="o">!</span><span class="n">factorvars</span><span class="p">]</span><span class="w">
</span><span class="n">message</span><span class="p">(</span><span class="s2">"Automatically converting the following non-factors to factors: "</span><span class="p">,</span><span class="w">
      </span><span class="n">paste</span><span class="p">(</span><span class="n">nonfactorvars</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">", "</span><span class="p">))</span><span class="w">
</span><span class="n">data</span><span class="p">[</span><span class="n">nonfactorvars</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">nonfactorvars</span><span class="p">],</span><span class="w"> </span><span class="n">factor</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Get the means from the un-normed data
</span><span class="w">  </span><span class="n">datac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarySE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">betweenvars</span><span class="p">,</span><span class="w"> </span><span class="n">withinvars</span><span class="p">),</span><span class="w">
               </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">,</span><span class="w"> </span><span class="n">conf.interval</span><span class="o">=</span><span class="n">conf.interval</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="n">.drop</span><span class="p">)</span><span class="w">

</span><span class="c1"># Drop all the unused columns (these will be calculated with normed data)
</span><span class="w">  </span><span class="n">datac</span><span class="o">$</span><span class="n">sd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">datac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">datac</span><span class="o">$</span><span class="n">ci</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">

</span><span class="c1"># Norm each subject's data
</span><span class="w">  </span><span class="n">ndata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">normDataWithin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">idvar</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="n">betweenvars</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="n">.drop</span><span class="p">)</span><span class="w">

</span><span class="c1"># This is the name of the new column
</span><span class="w">  </span><span class="n">measurevar_n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">measurevar</span><span class="p">,</span><span class="w"> </span><span class="s2">"_norm"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">

</span><span class="c1"># Collapse the normed data - now we can treat between and within vars the same
</span><span class="w">  </span><span class="n">ndatac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarySE</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span><span class="w"> </span><span class="n">measurevar_n</span><span class="p">,</span><span class="w"> </span><span class="n">groupvars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">betweenvars</span><span class="p">,</span><span class="w"> </span><span class="n">withinvars</span><span class="p">),</span><span class="w">
                </span><span class="n">na.rm</span><span class="o">=</span><span class="n">na.rm</span><span class="p">,</span><span class="w"> </span><span class="n">conf.interval</span><span class="o">=</span><span class="n">conf.interval</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="o">=</span><span class="n">.drop</span><span class="p">)</span><span class="w">

</span><span class="c1"># Apply correction from Morey (2008) to the standard error and confidence interval
</span><span class="w">  </span><span class="c1">#  Get the product of the number of conditions of within-S variables
</span><span class="w">  </span><span class="n">nWithinGroups</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">prod</span><span class="p">(</span><span class="n">vapply</span><span class="p">(</span><span class="n">ndatac</span><span class="p">[,</span><span class="n">withinvars</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">],</span><span class="w"> </span><span class="n">FUN</span><span class="o">=</span><span class="n">nlevels</span><span class="p">,</span><span class="w">
                     </span><span class="n">FUN.VALUE</span><span class="o">=</span><span class="n">numeric</span><span class="p">(</span><span class="m">1</span><span class="p">)))</span><span class="w">
</span><span class="n">correctionFactor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="w"> </span><span class="n">nWithinGroups</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">nWithinGroups</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">

</span><span class="c1"># Apply the correction factor
</span><span class="w">  </span><span class="n">ndatac</span><span class="o">$</span><span class="n">sd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ndatac</span><span class="o">$</span><span class="n">sd</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">correctionFactor</span><span class="w">
</span><span class="n">ndatac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ndatac</span><span class="o">$</span><span class="n">se</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">correctionFactor</span><span class="w">
</span><span class="n">ndatac</span><span class="o">$</span><span class="n">ci</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ndatac</span><span class="o">$</span><span class="n">ci</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">correctionFactor</span><span class="w">

</span><span class="c1"># Combine the un-normed means with the normed results
</span><span class="w">  </span><span class="n">merge</span><span class="p">(</span><span class="n">datac</span><span class="p">,</span><span class="w"> </span><span class="n">ndatac</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>


</article>
<h2 class="post-title" id="topic-59">Plotting distributions (ggplot2)</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to plot a distribution of data.</p>

<h3 id="solution">Solution</h3>

<p>This sample data will be used for the examples below:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="o">=</span><span class="m">200</span><span class="p">)),</span><span class="w"> 
             </span><span class="n">rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">200</span><span class="p">),</span><span class="n">rnorm</span><span class="p">(</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="m">.8</span><span class="p">)))</span><span class="w">
</span><span class="c1"># View first few rows
</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   cond     rating
#&gt; 1    A -1.2070657
#&gt; 2    A  0.2774292
#&gt; 3    A  1.0844412
#&gt; 4    A -2.3456977
#&gt; 5    A  0.4291247
#&gt; 6    A  0.5060559
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="histogram-and-density-plots">Histogram and density plots</h3>

<p>The <code class="highlighter-rouge">qplot</code> function is supposed make the same graphs as <code class="highlighter-rouge">ggplot</code>, but with a simpler syntax. However, in practice, it’s often easier to just use <code class="highlighter-rouge">ggplot</code> because the options for <code class="highlighter-rouge">qplot</code> can be more confusing to use.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## Basic histogram from the vector "rating". Each bin is .5 wide.
## These both result in the same output:
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">)</span><span class="w">
</span><span class="c1"># qplot(dat$rating, binwidth=.5)
</span><span class="w">
</span><span class="c1"># Draw with black outline, white fill
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Density curve
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_density</span><span class="p">()</span><span class="w">

</span><span class="c1"># Histogram overlaid with kernel density curve
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">..density..</span><span class="p">),</span><span class="w">      </span><span class="c1"># Histogram with density instead of count on y-axis
</span><span class="w">                   </span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w">
             </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_density</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"#FF6666"</span><span class="p">)</span><span class="w">  </span><span class="c1"># Overlay with transparent density plot
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-3-4.png" alt="plot of chunk unnamed-chunk-3"></p>

<p>Add a line for the mean:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)),</span><span class="w">   </span><span class="c1"># Ignore NA values for mean
</span><span class="w">               </span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"></p>

<h3 id="histogram-and-density-plots-with-multiple-groups">Histogram and density plots with multiple groups</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Overlaid histograms
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Interleaved histograms
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="s2">"dodge"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Density plots
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_density</span><span class="p">()</span><span class="w">

</span><span class="c1"># Density plots with semi-transparent fill
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_density</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-5-3.png" alt="plot of chunk unnamed-chunk-5"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-5-4.png" alt="plot of chunk unnamed-chunk-5"></p>

<p>Add lines for each mean requires first creating a separate data frame with the means:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Find the mean of each group
</span><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">cdat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="s2">"cond"</span><span class="p">,</span><span class="w"> </span><span class="n">summarise</span><span class="p">,</span><span class="w"> </span><span class="n">rating.mean</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">rating</span><span class="p">))</span><span class="w">
</span><span class="n">cdat</span><span class="w">
</span><span class="c1">#&gt;   cond rating.mean
#&gt; 1    A -0.05775928
#&gt; 2    B  0.87324927
</span><span class="w">
</span><span class="c1"># Overlaid histograms with means
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_vline</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cdat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">rating.mean</span><span class="p">,</span><span class="w">  </span><span class="n">colour</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w">
         </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="c1"># Density plots with means
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_density</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_vline</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cdat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">rating.mean</span><span class="p">,</span><span class="w">  </span><span class="n">colour</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w">
         </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-6-2.png" alt="plot of chunk unnamed-chunk-6"></p>

<p>Using facets:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">facet_grid</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w">

</span><span class="c1"># With mean lines, using cdat from above
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">facet_grid</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_vline</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cdat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">rating.mean</span><span class="p">),</span><span class="w">
         </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7"></p>

<p>See <a href="../Facets_(ggplot2)">Facets (ggplot2)</a> for more details.</p>

<h3 id="box-plots">Box plots</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A basic box plot
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">

</span><span class="c1"># A basic box with the conditions colored
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">

</span><span class="c1"># The above adds a redundant legend. With the legend removed:
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># With flipped axes
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-8-2.png" alt="plot of chunk unnamed-chunk-8"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-8-3.png" alt="plot of chunk unnamed-chunk-8"><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-8-4.png" alt="plot of chunk unnamed-chunk-8"></p>

<p>It’s also possible to add the mean by using <code class="highlighter-rouge">stat_summary</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Add a diamond at the mean, and make it larger
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">rating</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">stat_summary</span><span class="p">(</span><span class="n">fun.y</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="o">=</span><span class="s2">"point"</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9"></p>

</article>
<h2 class="post-title" id="topic-60">Scatterplots (ggplot2)</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to make a scatterplot.</p>

<h3 id="solution">Solution</h3>

<p>Suppose this is your data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">955</span><span class="p">)</span><span class="w">
</span><span class="c1"># Make some noisily increasing data
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="o">=</span><span class="m">10</span><span class="p">),</span><span class="w">
            </span><span class="n">xvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">3</span><span class="p">),</span><span class="w">
            </span><span class="n">yvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   cond      xvar         yvar
#&gt; 1    A -4.252354  3.473157275
#&gt; 2    A  1.702318  0.005939612
#&gt; 3    A  4.323054 -0.094252427
#&gt; 4    A  1.780628  2.072808278
#&gt; 5    A 11.537348  1.215440358
#&gt; 6    A  6.672130  3.608111411
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="basic-scatterplots-with-regression-lines">Basic scatterplots with regression lines</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">      </span><span class="c1"># Use hollow circles
</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">    </span><span class="c1"># Use hollow circles
</span><span class="w">    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">lm</span><span class="p">)</span><span class="w">   </span><span class="c1"># Add linear regression line 
</span><span class="w">                             </span><span class="c1">#  (by default includes 95% confidence region)
</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">    </span><span class="c1"># Use hollow circles
</span><span class="w">    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">lm</span><span class="p">,</span><span class="w">   </span><span class="c1"># Add linear regression line
</span><span class="w">                </span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">    </span><span class="c1"># Don't add shaded confidence region
</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">    </span><span class="c1"># Use hollow circles
</span><span class="w">    </span><span class="n">geom_smooth</span><span class="p">()</span><span class="w">            </span><span class="c1"># Add a loess smoothed fit curve with confidence region
#&gt; `geom_smooth()` using method = 'loess'
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-3-4.png" alt="plot of chunk unnamed-chunk-3"></p>
<h3 id="set-colorshape-by-another-variable">Set color/shape by another variable</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Set color by cond
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="c1"># Same, but with different colors and add regression lines
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_colour_hue</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="m">50</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># Use a slightly darker palette than normal
</span><span class="w">    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">lm</span><span class="p">,</span><span class="w">   </span><span class="c1"># Add linear regression lines
</span><span class="w">                </span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">    </span><span class="c1"># Don't add shaded confidence region
</span><span class="w">
</span><span class="c1"># Extend the regression lines beyond the domain of the data
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_colour_hue</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="m">50</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># Use a slightly darker palette than normal
</span><span class="w">    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">lm</span><span class="p">,</span><span class="w">   </span><span class="c1"># Add linear regression lines
</span><span class="w">                </span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">    </span><span class="c1"># Don't add shaded confidence region
</span><span class="w">                </span><span class="n">fullrange</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="c1"># Extend regression lines
</span><span class="w">

</span><span class="c1"># Set shape by cond
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Same, but with different shapes
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yvar</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_shape_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">  </span><span class="c1"># Use a hollow circle and triangle
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-4.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-5.png" alt="plot of chunk unnamed-chunk-4"></p>

<p>See <a href="../Colors_(ggplot2)">Colors (ggplot2)</a> and <a href="../Shapes_and_line_types">Shapes and line types</a> for more information about colors and shapes.</p>

<h3 id="handling-overplotting">Handling overplotting</h3>

<p>If you have many data points, or if your data scales are discrete, then the data points might overlap and it will be impossible to see if there are many points at the same location.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Round xvar and yvar to the nearest 5
</span><span class="n">dat</span><span class="o">$</span><span class="n">xrnd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">xvar</span><span class="o">/</span><span class="m">5</span><span class="p">)</span><span class="o">*</span><span class="m">5</span><span class="w">
</span><span class="n">dat</span><span class="o">$</span><span class="n">yrnd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">yvar</span><span class="o">/</span><span class="m">5</span><span class="p">)</span><span class="o">*</span><span class="m">5</span><span class="w">

</span><span class="c1"># Make each dot partially transparent, with 1/4 opacity
# For heavy overplotting, try using smaller values
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xrnd</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yrnd</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w">      </span><span class="c1"># Use solid circles
</span><span class="w">               </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="o">/</span><span class="m">4</span><span class="p">)</span><span class="w">     </span><span class="c1"># 1/4 opacity
</span><span class="w">

</span><span class="c1"># Jitter the points
# Jitter range is 1 on the x-axis, .5 on the y-axis
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xrnd</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yrnd</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">      </span><span class="c1"># Use hollow circles
</span><span class="w">               </span><span class="n">position</span><span class="o">=</span><span class="n">position_jitter</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5"></p>

</article>
<h2 class="post-title" id="topic-61">Titles (ggplot2)</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to set the title of your graph.</p>

<h3 id="solution">Solution</h3>

<p>An example graph without a title:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">bp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">PlantGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">weight</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">
</span><span class="n">bp</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Titles_(ggplot2)/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2"></p>

<p>With a title:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Plant growth"</span><span class="p">)</span><span class="w">
</span><span class="c1">## Equivalent to
# bp + labs(title="Plant growth")
</span><span class="w">
</span><span class="c1"># If the title is long, it can be split into multiple lines with \n
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Plant growth with\ndifferent treatments"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Reduce line spacing and use bold text
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Plant growth with\ndifferent treatments"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
 </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">lineheight</span><span class="o">=</span><span class="m">.8</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Titles_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Titles_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Titles_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3"></p>

</article>
<h2 class="post-title" id="topic-62">Axes (ggplot2)</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to change the order or direction of the axes.</p>

<h3 id="solution">Solution</h3>

<p>Note: In the examples below, where it says something like scale_y_continuous, scale_x_continuous, or ylim, the <em>y</em> can be replaced with <em>x</em> if you want to operate on the other axis.</p>

<p>This is the basic boxplot that we will work with, using the built-in <code class="highlighter-rouge">PlantGrowth</code> data set.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="n">bp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">PlantGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">weight</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">
</span><span class="n">bp</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2"></p>

<h3 id="swapping-x-and-y-axes">Swapping X and Y axes</h3>

<p>Swap x and y axes (make x vertical, y horizontal):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>

<h3 id="discrete-axis">Discrete axis</h3>

<h4 id="changing-the-order-of-items">Changing the order of items</h4>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Manually set the order of a discrete-valued axis
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"trt1"</span><span class="p">,</span><span class="s2">"trt2"</span><span class="p">,</span><span class="s2">"ctrl"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Reverse the order of a discrete-valued axis
# Get the levels of the factor
</span><span class="n">flevels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">PlantGrowth</span><span class="o">$</span><span class="n">group</span><span class="p">)</span><span class="w">
</span><span class="n">flevels</span><span class="w">
</span><span class="c1">#&gt; [1] "ctrl" "trt1" "trt2"
</span><span class="w">
</span><span class="c1"># Reverse the order
</span><span class="n">flevels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">flevels</span><span class="p">)</span><span class="w">
</span><span class="n">flevels</span><span class="w">
</span><span class="c1">#&gt; [1] "trt2" "trt1" "ctrl"
</span><span class="w">
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">flevels</span><span class="p">)</span><span class="w">

</span><span class="c1"># Or it can be done in one line:
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">PlantGrowth</span><span class="o">$</span><span class="n">group</span><span class="p">)))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4"></p>

<h4 id="setting-tick-mark-labels">Setting tick mark labels</h4>

<p>For discrete variables, the tick mark labels are taken directly from levels of the factor. However, sometimes the factor levels have short names that aren’t suitable for presentation.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"ctrl"</span><span class="p">,</span><span class="w"> </span><span class="s2">"trt1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"trt2"</span><span class="p">),</span><span class="w">
                </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Control"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Treat 1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Treat 2"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Hide x tick marks, labels, and grid lines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">

</span><span class="c1"># Hide all tick marks and labels (on X axis), but keep the gridlines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-6-2.png" alt="plot of chunk unnamed-chunk-6"></p>

<h3 id="continuous-axis">Continuous axis</h3>

<h4 id="setting-range-and-reversing-direction-of-an-axis">Setting range and reversing direction of an axis</h4>

<p>If you simply want to make sure that an axis includes a particular value in the range, use <code class="highlighter-rouge">expand_limits()</code>. This can only expand the range of an axis; it can’t shrink the range.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make sure to include 0 in the y axis
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">expand_limits</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make sure to include 0 and 8 in the y axis
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">expand_limits</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">8</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7"></p>

<p>You can also explicitly set the y limits. Note that if <strong>any</strong> <code class="highlighter-rouge">scale_y_continuous</code> command is used, it overrides any <code class="highlighter-rouge">ylim</code> command, and the <code class="highlighter-rouge">ylim</code> will be ignored.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Set the range of a continuous-valued axis
# These are equivalent
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylim</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w">
</span><span class="c1"># bp + scale_y_continuous(limits=c(0, 8))
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8"></p>

<p>If the y range is reduced using the method above, the data outside the range is ignored. This might be OK for a scatterplot, but it can be problematic for the box plots used here. For bar graphs, if the range does not include 0, the bars will not show at all!</p>

<p>To avoid this problem, you can use <code class="highlighter-rouge">coord_cartesian</code> instead. Instead of setting the limits of the data, it sets the viewing area of the data.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># These two do the same thing; all data points outside the graphing range are
# dropped, resulting in a misleading box plot
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ylim</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">7.5</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Warning: Removed 13 rows containing non-finite values (stat_boxplot).
# bp + scale_y_continuous(limits=c(5, 7.5))
</span><span class="w">
</span><span class="c1"># Using coord_cartesian "zooms" into the area
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">7.5</span><span class="p">))</span><span class="w">

</span><span class="c1"># Specify tick marks directly
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">7.5</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">))</span><span class="w">  </span><span class="c1"># Ticks from 0-10, every .25
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-9-2.png" alt="plot of chunk unnamed-chunk-9"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-9-3.png" alt="plot of chunk unnamed-chunk-9"></p>

<h4 id="reversing-the-direction-of-an-axis">Reversing the direction of an axis</h4>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Reverse order of a continuous-valued axis
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_reverse</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10"></p>

<h4 id="setting-and-hiding-tick-markers">Setting and hiding tick markers</h4>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Setting the tick marks on an axis
# This will show tick marks on every 0.25 from 1 to 10
# The scale will show only the ones that are within range (3.50-6.25 in this case)
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">1</span><span class="o">/</span><span class="m">4</span><span class="p">))</span><span class="w">

</span><span class="c1"># The breaks can be spaced unevenly
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4.25</span><span class="p">,</span><span class="w"> </span><span class="m">4.5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="m">8</span><span class="p">))</span><span class="w">

</span><span class="c1"># Suppress ticks and gridlines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">

</span><span class="c1"># Hide tick marks and labels (on Y axis), but keep the gridlines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-11-3.png" alt="plot of chunk unnamed-chunk-11"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-11-4.png" alt="plot of chunk unnamed-chunk-11"></p>

<h4 id="axis-transformations-log-sqrt-etc">Axis transformations: log, sqrt, etc.</h4>

<p>By default, the axes are linearly scaled. It is possible to transform the axes with log, power, roots, and so on.</p>

<p>There are two ways of transforming an axis. One is to use a <em>scale</em> transform, and the other is to use a <em>coordinate</em> transform. With a scale transform, the data is transformed before properties such as breaks (the tick locations) and range of the axis are decided. With a coordinate transform, the transformation happens <em>after</em> the breaks and scale range are decided. This results in different appearances, as shown below.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Create some noisy exponentially-distributed data
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">201</span><span class="p">)</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">xval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="o">+</span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">5</span><span class="p">))</span><span class="o">/</span><span class="m">20</span><span class="p">,</span><span class="w">
</span><span class="n">yval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="o">*</span><span class="m">2</span><span class="o">^</span><span class="p">((</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="o">+</span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">5</span><span class="p">))</span><span class="o">/</span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># A scatterplot with regular (linear) axis scaling
</span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span><span class="n">sp</span><span class="w">

</span><span class="c1"># log2 scaling of the y axis (with visually-equal spacing)
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">     </span><span class="c1"># Need the scales package
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="n">log2_trans</span><span class="p">())</span><span class="w">

</span><span class="c1"># log2 coordinate transformation (with visually-diminishing spacing)
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_trans</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"log2"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-12-3.png" alt="plot of chunk unnamed-chunk-12"></p>

<p>With a scale transformation, you can also set the axis tick marks to show exponents.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">trans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log2_trans</span><span class="p">(),</span><span class="w">
                  </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans_breaks</span><span class="p">(</span><span class="s2">"log2"</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="m">2</span><span class="o">^</span><span class="n">x</span><span class="p">),</span><span class="w">
                  </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans_format</span><span class="p">(</span><span class="s2">"log2"</span><span class="p">,</span><span class="w"> </span><span class="n">math_format</span><span class="p">(</span><span class="m">2</span><span class="o">^</span><span class="n">.x</span><span class="p">)))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13"></p>

<p>Many transformations are available. See <code class="highlighter-rouge">?trans_new</code> for a full list. If the transformation you need isn’t on the list, it is possible to write your own transformation function.</p>

<p>A couple scale transformations have convenience functions: <code class="highlighter-rouge">scale_y_log10</code> and <code class="highlighter-rouge">scale_y_sqrt</code> (with corresponding versions for x).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">205</span><span class="p">)</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">dat10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">xval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="o">+</span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">5</span><span class="p">))</span><span class="o">/</span><span class="m">20</span><span class="p">,</span><span class="w">
</span><span class="n">yval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="o">*</span><span class="m">10</span><span class="o">^</span><span class="p">((</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="o">+</span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">5</span><span class="p">))</span><span class="o">/</span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">sp10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat10</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># log10
</span><span class="n">sp10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="w">

</span><span class="c1"># log10 with exponents on tick labels
</span><span class="n">sp10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_log10</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans_breaks</span><span class="p">(</span><span class="s2">"log10"</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="m">10</span><span class="o">^</span><span class="n">x</span><span class="p">),</span><span class="w">
               </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trans_format</span><span class="p">(</span><span class="s2">"log10"</span><span class="p">,</span><span class="w"> </span><span class="n">math_format</span><span class="p">(</span><span class="m">10</span><span class="o">^</span><span class="n">.x</span><span class="p">)))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-14-2.png" alt="plot of chunk unnamed-chunk-14"></p>

<h4 id="fixed-ratio-between-x-and-y-axes">Fixed ratio between x and y axes</h4>

<p>It is possible to set the scaling of the axes to an equal ratio, with one visual unit being representing the same numeric unit on both axes. It is also possible to set them to ratios other than 1:1.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Data where x ranges from 0-10, y ranges from 0-30
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">202</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">xval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">),</span><span class="w">
</span><span class="n">yval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">30</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Force equal scaling
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_fixed</span><span class="p">()</span><span class="w">

</span><span class="c1"># Equal scaling, with each 1 on the x axis the same length as y on x axis
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_fixed</span><span class="p">(</span><span class="n">ratio</span><span class="o">=</span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-15-2.png" alt="plot of chunk unnamed-chunk-15"></p>

<h3 id="axis-labels-and-text-formatting">Axis labels and text formatting</h3>

<p>To set and hide the axis labels:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w">   </span><span class="c1"># Remove x-axis label
</span><span class="w">     </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Weight (Kg)"</span><span class="p">)</span><span class="w">                       </span><span class="c1"># Set y-axis label
</span><span class="w">
</span><span class="c1"># Also possible to set the axis label with the scale
# Note that vertical space is still reserved for x's label
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Weight (Kg)"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-16-2.png" alt="plot of chunk unnamed-chunk-16"></p>

<p>To change the fonts, and rotate tick mark labels:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Change font options:
# X-axis label: bold, red, and 20 points
# X-axis tick marks: rotate 90 degrees CCW, move to the left a bit (using vjust,
#   since the labels are rotated), and 16 points
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#990000"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">),</span><span class="w">
     </span><span class="n">axis.text.x</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">16</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17"></p>

<h3 id="tick-mark-label-text-formatters">Tick mark label text formatters</h3>

<p>You may want to display your values as percents, or dollars, or in scientific notation. To do this you can use a <strong>formatter</strong>, which is a function that changes the text:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Label formatters
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">   </span><span class="c1"># Need the scales package
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">abbreviate</span><span class="p">)</span><span class="w">  </span><span class="c1"># In this particular case, it has no effect
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18"></p>

<p>Other useful formatters for continuous scales include <code class="highlighter-rouge">comma</code>, <code class="highlighter-rouge">percent</code>, <code class="highlighter-rouge">dollar</code>, and <code class="highlighter-rouge">scientific</code>. For discrete scales, <code class="highlighter-rouge">abbreviate</code> will remove vowels and spaces and shorten to four characters. For dates, use <code class="highlighter-rouge">date_format</code>.</p>

<p>Sometimes you may need to create your own formatting function. This one will display numeric minutes in HH:MM:SS format.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Self-defined formatting function for times.
</span><span class="n">timeHMS_formatter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="m">60</span><span class="p">)</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">60</span><span class="p">)</span><span class="w">
</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="m">60</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">                   </span><span class="c1"># Round to nearest second
</span><span class="w">    </span><span class="n">lab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s1">'%02d:%02d:%02d'</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="c1"># Format the strings as HH:MM:SS
</span><span class="w">    </span><span class="n">lab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s1">'^00:'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">lab</span><span class="p">)</span><span class="w">              </span><span class="c1"># Remove leading 00: if present
</span><span class="w">    </span><span class="n">lab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s1">'^0'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">lab</span><span class="p">)</span><span class="w">                </span><span class="c1"># Remove leading 0 if present
</span><span class="p">}</span><span class="w">

</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">timeHMS_formatter</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19"></p>

<h3 id="hiding-gridlines">Hiding gridlines</h3>

<p>To hide all gridlines, both vertical and horizontal:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Hide all the gridlines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.minor</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
     </span><span class="n">panel.grid.major</span><span class="o">=</span><span class="n">element_blank</span><span class="p">())</span><span class="w">

</span><span class="c1"># Hide just the minor gridlines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.minor</span><span class="o">=</span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-20-1.png" alt="plot of chunk unnamed-chunk-20"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-20-2.png" alt="plot of chunk unnamed-chunk-20"></p>

<p>It’s also possible to hide just the vertical or horizontal gridlines:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Hide all the vertical gridlines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.minor.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
     </span><span class="n">panel.grid.major.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">())</span><span class="w">

</span><span class="c1"># Hide all the horizontal gridlines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.minor.y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
     </span><span class="n">panel.grid.major.y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-21-1.png" alt="plot of chunk unnamed-chunk-21"><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-21-2.png" alt="plot of chunk unnamed-chunk-21"></p>

</article>
<h2 class="post-title" id="topic-63">Legends (ggplot2)</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to modify the legend of a graph made with ggplot2.</p>

<h3 id="solution">Solution</h3>

<p>Start with an example graph with the default options:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">bp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">PlantGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">
</span><span class="n">bp</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2"></p>

<h3 id="removing-the-legend">Removing the legend</h3>

<p>Use <code class="highlighter-rouge">guides(fill=FALSE)</code>, replacing <code class="highlighter-rouge">fill</code> with the desired aesthetic.</p>

<p>You can also remove all the legends in a graph, using <code class="highlighter-rouge">theme</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Remove legend for a particular aesthetic (fill)
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># It can also be done when specifying the scale
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_discrete</span><span class="p">(</span><span class="n">guide</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># This removes all legends
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"></p>

<h3 id="changing-the-order-of-items-in-the-legend">Changing the order of items in the legend</h3>

<p>This changes the order of items to trt1, ctrl, trt2:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_discrete</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"trt1"</span><span class="p">,</span><span class="s2">"ctrl"</span><span class="p">,</span><span class="s2">"trt2"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"></p>

<p>Depending on how the colors are specified, you may have to use a different scale, such as <code class="highlighter-rouge">scale_fill_manual</code>, <code class="highlighter-rouge">scale_colour_hue</code>, <code class="highlighter-rouge">scale_colour_manual</code>, <code class="highlighter-rouge">scale_shape_discrete</code>, <code class="highlighter-rouge">scale_linetype_discrete</code>, and so on.</p>

<h3 id="reversing-the-order-of-items-in-the-legend">Reversing the order of items in the legend</h3>

<p>To reverse the legend order:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># These two methods are equivalent:
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_discrete</span><span class="p">(</span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w">

</span><span class="c1"># You can also modify the scale directly:
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_discrete</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">PlantGrowth</span><span class="o">$</span><span class="n">group</span><span class="p">)))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"></p>

<p>Instead of <code class="highlighter-rouge">scale_fill_discrete</code>, you may need to use a different scale, such as <code class="highlighter-rouge">scale_fill_manual</code>, <code class="highlighter-rouge">scale_colour_hue</code>, <code class="highlighter-rouge">scale_colour_manual</code>, <code class="highlighter-rouge">scale_shape_discrete</code>, <code class="highlighter-rouge">scale_linetype_discrete</code>, and so on.</p>

<h3 id="hiding-the-legend-title">Hiding the legend title</h3>
<p>This will hide the legend title:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Remove title for fill legend
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">NULL</span><span class="p">))</span><span class="w">

</span><span class="c1"># Remove title for all legends
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.title</span><span class="o">=</span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9"></p>

<h3 id="modifying-the-text-of-legend-titles-and-labels">Modifying the text of legend titles and labels</h3>

<p>There are two ways of changing the legend title and labels. The first way is to  tell the <em>scale</em> to use have a different title and labels. The second way is to change data frame so that the factor has the desired form.</p>

<h4 id="using-scales">Using scales</h4>

<p>The legend can be a guide for <code class="highlighter-rouge">fill</code>, <code class="highlighter-rouge">colour</code>, <code class="highlighter-rouge">linetype</code>, <code class="highlighter-rouge">shape</code>, or other aesthetics.</p>

<h5 id="with-fill-and-color">With fill and color</h5>

<p>Because <code class="highlighter-rouge">group</code>, the variable in the legend, is mapped to the color <code class="highlighter-rouge">fill</code>, it is necessary to use <code class="highlighter-rouge">scale_fill_xxx</code>, where <code class="highlighter-rouge">xxx</code> is a method of mapping each factor level of <code class="highlighter-rouge">group</code> to different colors. The default is to use a different hue on the color wheel for each factor level, but it is also possible to manually specify the colors for each level.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Experimental\nCondition"</span><span class="p">)</span><span class="w">

</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Experimental\nCondition"</span><span class="p">,</span><span class="w">
                   </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"ctrl"</span><span class="p">,</span><span class="w"> </span><span class="s2">"trt1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"trt2"</span><span class="p">),</span><span class="w">
                   </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Control"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Treatment 1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Treatment 2"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Using a manual scale instead of hue
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#999999"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#E69F00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#56B4E9"</span><span class="p">),</span><span class="w"> 
                 </span><span class="n">name</span><span class="o">=</span><span class="s2">"Experimental\nCondition"</span><span class="p">,</span><span class="w">
                 </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"ctrl"</span><span class="p">,</span><span class="w"> </span><span class="s2">"trt1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"trt2"</span><span class="p">),</span><span class="w">
                 </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Control"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Treatment 1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Treatment 2"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-10-2.png" alt="plot of chunk unnamed-chunk-10"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-10-3.png" alt="plot of chunk unnamed-chunk-10"></p>

<p>Note that this didn’t change the x axis labels. See <a href="../Axes_(ggplot2)">Axes (ggplot2)</a> for information on how to modify the axis labels.</p>

<p>If you use a line graph, you will probably need to use <code class="highlighter-rouge">scale_colour_xxx</code> and/or <code class="highlighter-rouge">scale_shape_xxx</code> instead of <code class="highlighter-rouge">scale_fill_xxx</code>. <strong><em>colour</em></strong> maps to the colors of lines and points, while <strong><em>fill</em></strong> maps to the color of area fills. <strong><em>shape</em></strong> maps to the shapes of points.</p>

<p>We’ll use a different data set for the line graphs here because the PlantGrowth data set does not work well with a line graph.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A different data set
</span><span class="n">df1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Female"</span><span class="p">,</span><span class="s2">"Female"</span><span class="p">,</span><span class="s2">"Male"</span><span class="p">,</span><span class="s2">"Male"</span><span class="p">)),</span><span class="w">
</span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Lunch"</span><span class="p">,</span><span class="s2">"Dinner"</span><span class="p">,</span><span class="s2">"Lunch"</span><span class="p">,</span><span class="s2">"Dinner"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Lunch"</span><span class="p">,</span><span class="s2">"Dinner"</span><span class="p">)),</span><span class="w">
</span><span class="n">total_bill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">13.53</span><span class="p">,</span><span class="w"> </span><span class="m">16.81</span><span class="p">,</span><span class="w"> </span><span class="m">16.24</span><span class="p">,</span><span class="w"> </span><span class="m">17.42</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># A basic graph
</span><span class="n">lp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span><span class="n">lp</span><span class="w">

</span><span class="c1"># Change the legend
</span><span class="n">lp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_shape_discrete</span><span class="p">(</span><span class="n">name</span><span class="w">  </span><span class="o">=</span><span class="s2">"Payer"</span><span class="p">,</span><span class="w">
                    </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Female"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Male"</span><span class="p">),</span><span class="w">
                    </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Woman"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Man"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11"></p>

<p>If you use both <code class="highlighter-rouge">colour</code> and <code class="highlighter-rouge">shape</code>, they both need to be given scale specifications. Otherwise there will be two two separate legends.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Specify colour and shape
</span><span class="n">lp1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span><span class="n">lp1</span><span class="w">

</span><span class="c1"># Here's what happens if you just specify colour
</span><span class="n">lp1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="w">  </span><span class="o">=</span><span class="s2">"Payer"</span><span class="p">,</span><span class="w">
                      </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Female"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Male"</span><span class="p">),</span><span class="w">
                      </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Woman"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Man"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Specify both colour and shape
</span><span class="n">lp1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="w">  </span><span class="o">=</span><span class="s2">"Payer"</span><span class="p">,</span><span class="w">
                      </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Female"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Male"</span><span class="p">),</span><span class="w">
                      </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Woman"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Man"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_shape_discrete</span><span class="p">(</span><span class="n">name</span><span class="w">  </span><span class="o">=</span><span class="s2">"Payer"</span><span class="p">,</span><span class="w">
                     </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Female"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Male"</span><span class="p">),</span><span class="w">
                     </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Woman"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Man"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-12-3.png" alt="plot of chunk unnamed-chunk-12"></p>

<h5 id="kinds-of-scales">Kinds of scales</h5>

<p>There are many kinds of scales. They take the form <code class="highlighter-rouge">scale_xxx_yyy</code>. Here are some commonly-used values of <code class="highlighter-rouge">xxx</code> and <code class="highlighter-rouge">yyy</code>:</p>

<table>
<thead>
<tr>
<th><strong><em>xxx</em></strong></th>
<th><strong><em>Description</em></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>colour</td>
<td>Color of lines and points</td>
</tr>
<tr>
<td>fill</td>
<td>Color of area fills (e.g. bar graph)</td>
</tr>
<tr>
<td>linetype</td>
<td>Solid/dashed/dotted lines</td>
</tr>
<tr>
<td>shape</td>
<td>Shape of points</td>
</tr>
<tr>
<td>size</td>
<td>Size of points</td>
</tr>
<tr>
<td>alpha</td>
<td>Opacity/transparency</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th><strong><em>yyy</em></strong></th>
<th><strong><em>Description</em></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>hue</td>
<td>Equally-spaced colors from the color wheel</td>
</tr>
<tr>
<td>manual</td>
<td>Manually-specified values (e.g., colors, point shapes, line types)</td>
</tr>
<tr>
<td>gradient</td>
<td>Color gradient</td>
</tr>
<tr>
<td>grey</td>
<td>Shades of grey</td>
</tr>
<tr>
<td>discrete</td>
<td>Discrete values (e.g., colors, point shapes, line types, point sizes)</td>
</tr>
<tr>
<td>continuous</td>
<td>Continuous values (e.g., alpha, colors, point sizes)</td>
</tr>
</tbody>
</table>

<h4 id="changing-the-factor-in-the-data-frame">Changing the factor in the data frame</h4>

<p>Another way to change the legend title and labels is to directly modify the data frame.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">pg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">PlantGrowth</span><span class="w">    </span><span class="c1"># Copy data into new data frame
# Rename the column and the values in the factor
</span><span class="n">levels</span><span class="p">(</span><span class="n">pg</span><span class="o">$</span><span class="n">group</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">pg</span><span class="o">$</span><span class="n">group</span><span class="p">)</span><span class="o">==</span><span class="s2">"ctrl"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Control"</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">pg</span><span class="o">$</span><span class="n">group</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">pg</span><span class="o">$</span><span class="n">group</span><span class="p">)</span><span class="o">==</span><span class="s2">"trt1"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Treatment 1"</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">pg</span><span class="o">$</span><span class="n">group</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">pg</span><span class="o">$</span><span class="n">group</span><span class="p">)</span><span class="o">==</span><span class="s2">"trt2"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Treatment 2"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">pg</span><span class="p">)[</span><span class="nf">names</span><span class="p">(</span><span class="n">pg</span><span class="p">)</span><span class="o">==</span><span class="s2">"group"</span><span class="p">]</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Experimental Condition"</span><span class="w">

</span><span class="c1"># View a few rows from the end product
</span><span class="n">head</span><span class="p">(</span><span class="n">pg</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   weight Experimental Condition
#&gt; 1   4.17                Control
#&gt; 2   5.58                Control
#&gt; 3   5.18                Control
#&gt; 4   6.11                Control
#&gt; 5   4.50                Control
#&gt; 6   4.61                Control
</span><span class="w">
</span><span class="c1"># Make the plot 
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pg</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">`Experimental Condition`</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">`Experimental Condition`</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13"></p>

<p>The legend title “Experimental Condtion” is long and it might look better if it were broken into two lines, but this doesn’t work very well with this method, since you would have to put a newline character in the name of the column. The other method, with scales, is generally a better way to do this.</p>

<p>Also note the use of backticks instead of quotes. They are necessary because of the spaces in the variable name.</p>

<h3 id="modifying-the-appearance-of-the-legend-title-and-labels">Modifying the appearance of the legend title and labels</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Title appearance
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Label appearance
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-14-2.png" alt="plot of chunk unnamed-chunk-14"></p>

<h3 id="modifying-the-legend-box">Modifying the legend box</h3>

<p>By default, the legend will not have a box around it. To add a box and modify its properties:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">())</span><span class="w">
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s2">"gray90"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dotted"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-15-2.png" alt="plot of chunk unnamed-chunk-15"></p>

<h3 id="changing-the-position-of-the-legend">Changing the position of the legend</h3>
<p>Position legend outside the plotting area (left/right/top/bottom):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16"></p>

<p>It is also possible to position the legend inside the plotting area. Note that the numeric position below is relative to the entire area, including titles and labels, not just the plotting area.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Position legend in graph, where x,y is 0,0 (bottom left) to 1,1 (top right)
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="m">.5</span><span class="p">))</span><span class="w">

</span><span class="c1"># Set the "anchoring point" of the legend (bottom-left is 0,0; top-right is 1,1)
# Put bottom-left corner of legend box in bottom-left corner of graph
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">legend.position</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">))</span><span class="w">

</span><span class="c1"># Put bottom-right corner of legend box in bottom-right corner of graph
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">legend.position</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-17-2.png" alt="plot of chunk unnamed-chunk-17"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-17-3.png" alt="plot of chunk unnamed-chunk-17"></p>

<h3 id="hiding-slashes-in-the-legend">Hiding slashes in the legend</h3>

<p>If you make bar graphs with an outline (by setting colour=”black”), it will draw a slash through the colors in the legend. There is not a built-in way to remove the slashes, but it is possible to cover them up.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># No outline
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">PlantGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">()</span><span class="w">

</span><span class="c1"># Add outline, but slashes appear in legend
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">PlantGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="w">

</span><span class="c1"># A hack to hide the slashes: first graph the bars with no outline and add the legend,
# then graph the bars again with outline, but with a blank legend.
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">PlantGrowth</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">show.legend</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-18-2.png" alt="plot of chunk unnamed-chunk-18"><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-18-3.png" alt="plot of chunk unnamed-chunk-18"></p>

</article>
<h2 class="post-title" id="topic-64">Lines (ggplot2)</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to do add lines to a plot.</p>

<h3 id="solution">Solution</h3>

<h3 id="with-one-continuous-and-one-categorical-axis">With one continuous and one categorical axis</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Some sample data
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 cond result
control     10
treatment   11.5
'</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h4 id="lines-that-go-all-the-way-across">Lines that go all the way across</h4>

<p>These use <code class="highlighter-rouge">geom_hline</code> because the y-axis is the continuous one, but it is also possible to use <code class="highlighter-rouge">geom_vline</code> (with <code class="highlighter-rouge">xintercept</code>) if the x-axis is continuous.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Basic bar plot
</span><span class="n">bp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">result</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">
</span><span class="n">bp</span><span class="w">

</span><span class="c1"># Add a horizontal line
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">12</span><span class="p">))</span><span class="w">

</span><span class="c1"># Make the line red and dashed
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#990000"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3"></p>

<h4 id="separate-lines-for-each-categorical-value">Separate lines for each categorical value</h4>

<p>To make separate lines for each bar, use <code class="highlighter-rouge">geom_errorbar</code>. The error bars have no height – <code class="highlighter-rouge">ymin</code>=<code class="highlighter-rouge">ymax</code>. It also seems necessary to specify <code class="highlighter-rouge">y</code> for some reason, even though it doesn’t do anything.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Draw separate hlines for each bar. First add another column to dat
</span><span class="n">dat</span><span class="o">$</span><span class="n">hline</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="m">12</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="w">
</span><span class="c1">#&gt;        cond result hline
#&gt; 1   control   10.0     9
#&gt; 2 treatment   11.5    12
</span><span class="w">
</span><span class="c1"># Need to re-specify bp, because the data has changed
</span><span class="n">bp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">result</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Draw with separate lines for each bar
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">hline</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="o">=</span><span class="n">hline</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#AA0000"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make the lines narrower
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">hline</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="o">=</span><span class="n">hline</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#AA0000"</span><span class="p">)</span><span class="w">


</span><span class="c1"># Can get the same result, even if we get the hline values from a second data frame
# Define data frame with hline
</span><span class="n">dat_hlines</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"control"</span><span class="p">,</span><span class="s2">"treatment"</span><span class="p">),</span><span class="w"> </span><span class="n">hline</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">dat_hlines</span><span class="w">
</span><span class="c1">#&gt;        cond hline
#&gt; 1   control     9
#&gt; 2 treatment    12
</span><span class="w">
</span><span class="c1"># The bars are from dat, but the lines are from dat_hlines
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat_hlines</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">hline</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="o">=</span><span class="n">hline</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#AA0000"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Warning: Ignoring unknown aesthetics: y
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4"></p>

<h4 id="lines-over-grouped-bars">Lines over grouped bars</h4>
<p>It is possible to add lines over grouped bars. In this example, there are actually four lines (one for each entry for <code class="highlighter-rouge">hline</code>), but it looks like two, because they are drawn on top of each other. I don’t think it’s possible to avoid this, but it doesn’t cause any problems.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 cond group result hline
control     A     10     9
treatment     A   11.5    12
control     B     12     9
treatment     B     14    12
'</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="w">
</span><span class="c1">#&gt;        cond group result hline
#&gt; 1   control     A   10.0     9
#&gt; 2 treatment     A   11.5    12
#&gt; 3   control     B   12.0     9
#&gt; 4 treatment     B   14.0    12
</span><span class="w">
</span><span class="c1"># Define basic bar plot
</span><span class="n">bp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">
</span><span class="n">bp</span><span class="w">

</span><span class="c1"># The error bars get plotted over one another -- there are four but it looks
# like two
</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">hline</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="o">=</span><span class="n">hline</span><span class="p">),</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5"></p>

<h4 id="lines-over-individual-grouped-bars">Lines over individual grouped bars</h4>

<p>It is also possible to have lines over each individual bar, even when grouped.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 cond group result hline
control     A     10    11
treatment     A   11.5    12
control     B     12  12.5
treatment     B     14    15
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Define basic bar plot
</span><span class="n">bp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(),</span><span class="w"> </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">
</span><span class="n">bp</span><span class="w">

</span><span class="n">bp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">hline</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="o">=</span><span class="n">hline</span><span class="p">),</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w">
             </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-6-2.png" alt="plot of chunk unnamed-chunk-6"></p>

<h3 id="with-two-continuous-axes">With two continuous axes</h3>

<p>Sample data used here:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
cond xval yval
 control 11.5 10.8
 control  9.3 12.9
 control  8.0  9.9
 control 11.5 10.1
 control  8.6  8.3
 control  9.9  9.5
 control  8.8  8.7
 control 11.7 10.1
 control  9.7  9.3
 control  9.8 12.0
 treatment 10.4 10.6
 treatment 12.1  8.6
 treatment 11.2 11.0
 treatment 10.0  8.8
 treatment 12.9  9.5
 treatment  9.1 10.0
 treatment 13.4  9.6
 treatment 11.6  9.8
 treatment 11.5  9.8
 treatment 12.0 10.6
'</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h4 id="basic-lines">Basic lines</h4>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># The basic scatterplot
</span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Add a horizontal line
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">10</span><span class="p">))</span><span class="w">

</span><span class="c1"># Add a red dashed vertical line
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="m">11.5</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#BB0000"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-9-2.png" alt="plot of chunk unnamed-chunk-9"></p>

<h4 id="drawing-lines-for-the-mean">Drawing lines for the mean</h4>

<p>It is also possible to compute a mean value for each subset of data, grouped by some variable. The group means would have to be computed and stored in a separate data frame, and the easiest way to do this is to use the dplyr package. Note that the y range of the line is determined by the data.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span><span class="n">group_by</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
</span><span class="n">summarise</span><span class="p">(</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">xval</span><span class="p">),</span><span class="w">
</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">yval</span><span class="p">),</span><span class="w">
</span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">yval</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Add colored lines for the mean xval of each group
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_linerange</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Warning: Ignoring unknown aesthetics: y
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10"></p>

<h4 id="using-lines-with-facets">Using lines with facets</h4>

<p>Normally, if you add a line, it will appear in all facets.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Facet, based on cond
</span><span class="n">spf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">cond</span><span class="p">)</span><span class="w">
</span><span class="n">spf</span><span class="w">

</span><span class="c1"># Draw a horizontal line in all of the facets at the same value
</span><span class="n">spf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">10</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11"></p>

<p>If you want the different lines to appear in the different facets, there are two options. One is to create a new data frame with the desired values for the lines. Another option (with more limited control) is to use <code class="highlighter-rouge">stat</code> and <code class="highlighter-rouge">xintercept</code> in <code class="highlighter-rouge">geom_line()</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat_vlines</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cond</span><span class="o">=</span><span class="n">levels</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">cond</span><span class="p">),</span><span class="w"> </span><span class="n">xval</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">11.5</span><span class="p">))</span><span class="w">
</span><span class="n">dat_vlines</span><span class="w">
</span><span class="c1">#&gt;        cond xval
#&gt; 1   control 10.0
#&gt; 2 treatment 11.5
</span><span class="w">
</span><span class="n">spf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">xval</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dat_vlines</span><span class="p">,</span><span class="w">
              </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#990000"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span><span class="w">

</span><span class="n">spf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_linerange</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Warning: Ignoring unknown aesthetics: y
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12"></p>

</article>
<h2 class="post-title" id="topic-65">Facets (ggplot2)</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to do split up your data by one or more variables and plot the subsets of data together.</p>

<h3 id="solution">Solution</h3>

<h3 id="sample-data">Sample data</h3>
<p>We will use the <code class="highlighter-rouge">tips</code> dataset from the <code class="highlighter-rouge">reshape2</code> package.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="c1"># Look at first few rows
</span><span class="n">head</span><span class="p">(</span><span class="n">tips</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   total_bill  tip    sex smoker day   time size
#&gt; 1      16.99 1.01 Female     No Sun Dinner    2
#&gt; 2      10.34 1.66   Male     No Sun Dinner    3
#&gt; 3      21.01 3.50   Male     No Sun Dinner    3
#&gt; 4      23.68 3.31   Male     No Sun Dinner    2
#&gt; 5      24.59 3.61 Female     No Sun Dinner    4
#&gt; 6      25.29 4.71   Male     No Sun Dinner    4
</span></code></pre>
</div>

<p>This is a scatterplot of the tip percentage by total bill size.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">sp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">tips</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">tip</span><span class="o">/</span><span class="n">total_bill</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">sp</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>

<h3 id="facetgrid">facet_grid</h3>

<p>The data can be split up by one or two variables that vary on the horizontal and/or vertical direction.</p>

<p>This is done by giving a formula to <code class="highlighter-rouge">facet_grid()</code>, of the form <code class="highlighter-rouge">vertical ~ horizontal</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Divide by levels of "sex", in the vertical direction
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Divide by levels of "sex", in the horizontal direction
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Divide with "sex" vertical, "day" horizontal
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">day</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"></p>

<h3 id="facetwrap">facet_wrap</h3>

<p>Instead of faceting with a variable in the horizontal or vertical direction, facets can be placed next to each other, wrapping with a certain number of columns or rows. The label for each plot will be at the top of the plot.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Divide by day, going horizontally and wrapping with 2 columns
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_wrap</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"></p>

<h3 id="modifying-facet-label-appearance">Modifying facet label appearance</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">day</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme</span><span class="p">(</span><span class="n">strip.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="o">=</span><span class="m">75</span><span class="p">),</span><span class="w">
    </span><span class="n">strip.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">),</span><span class="w">
    </span><span class="n">strip.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"#CCCCFF"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8"></p>

<h3 id="modifying-facet-label-text">Modifying facet label text</h3>

<p>There are a few different ways of modifying facet labels. The simplest way is to provide a named vector that maps original names to new names. To map the levels of <code class="highlighter-rouge">sex</code> from Female==&gt;Women, and Male==&gt;Men:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">Female</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Women"</span><span class="p">,</span><span class="w"> </span><span class="n">Male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Men"</span><span class="p">)</span><span class="w">
</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">labeller</span><span class="o">=</span><span class="n">labeller</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labels</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>Another way is to modify the data frame so that the data contains the desired labels:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">tips2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tips</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">tips2</span><span class="o">$</span><span class="n">sex</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">tips2</span><span class="o">$</span><span class="n">sex</span><span class="p">)</span><span class="o">==</span><span class="s2">"Female"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Women"</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">tips2</span><span class="o">$</span><span class="n">sex</span><span class="p">)[</span><span class="n">levels</span><span class="p">(</span><span class="n">tips2</span><span class="o">$</span><span class="n">sex</span><span class="p">)</span><span class="o">==</span><span class="s2">"Male"</span><span class="p">]</span><span class="w">   </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Men"</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">tips2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   total_bill  tip   sex smoker day   time size
#&gt; 1      16.99 1.01 Women     No Sun Dinner    2
#&gt; 2      10.34 1.66   Men     No Sun Dinner    3
#&gt; 3      21.01 3.50   Men     No Sun Dinner    3
</span><span class="w">
</span><span class="c1"># Both of these will give the same output:
</span><span class="n">sp2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">tips2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">total_bill</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">tip</span><span class="o">/</span><span class="n">total_bill</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">sp2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Both of these will give the same result:</p>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"></p>

<p><code class="highlighter-rouge">labeller()</code> can use any function that takes a character vector as input and returns a character vector as output. For example, the <code class="highlighter-rouge">capitalize</code> function from the Hmisc package will capitalize the first letters of strings. We can also define our own custom functions, like this one, which reverses strings:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Reverse each strings in a character vector
</span><span class="n">reverse</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">strings</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">strsplit</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">vapply</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">paste</span><span class="p">(</span><span class="n">rev</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="n">FUN.VALUE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">character</span><span class="p">(</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">sp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">labeller</span><span class="o">=</span><span class="n">labeller</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reverse</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"></p>

<h3 id="free-scales">Free scales</h3>

<p>Normally, the axis scales on each graph are <strong>fixed</strong>, which means that they have the same size and range. They can be made independent, by setting <code class="highlighter-rouge">scales</code> to <code class="highlighter-rouge">free</code>, <code class="highlighter-rouge">free_x</code>, or <code class="highlighter-rouge">free_y</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A histogram of bill sizes
</span><span class="n">hp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">tips</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">total_bill</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">colour</span><span class="o">=</span><span class="s2">"white"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Histogram of total_bill, divided by sex and smoker
</span><span class="n">hp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">smoker</span><span class="p">)</span><span class="w">

</span><span class="c1"># Same as above, with scales="free_y"
</span><span class="n">hp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">smoker</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="o">=</span><span class="s2">"free_y"</span><span class="p">)</span><span class="w">

</span><span class="c1"># With panels that have the same scaling, but different range (and therefore different physical sizes)
</span><span class="n">hp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">smoker</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="o">=</span><span class="s2">"free"</span><span class="p">,</span><span class="w"> </span><span class="n">space</span><span class="o">=</span><span class="s2">"free"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13"><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-13-2.png" alt="plot of chunk unnamed-chunk-13"><img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-13-3.png" alt="plot of chunk unnamed-chunk-13"></p>

</article>
<h2 class="post-title" id="topic-66">Multiple graphs on one page (ggplot2)</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to put multiple graphs on one page.</p>

<h3 id="solution">Solution</h3>

<p>The easy way is to use the <code class="highlighter-rouge">multiplot</code> function, defined at the bottom of this page. If it isn’t suitable for your needs, you can copy and modify it.</p>

<p>First, set up the plots and store them, but don’t render them yet. The details of these plots aren’t important; all you need to do is store the plot objects in variables.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="c1"># This example uses the ChickWeight dataset, which comes with ggplot2
# First plot
</span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">ChickWeight</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Diet</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">Chick</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Growth curve for individual chicks"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Second plot
</span><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">ChickWeight</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Diet</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Fitted growth curve per diet"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Third plot
</span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">ChickWeight</span><span class="p">,</span><span class="w"> </span><span class="n">Time</span><span class="o">==</span><span class="m">21</span><span class="p">),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Diet</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_density</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Final weight, by diet"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Fourth plot
</span><span class="n">p</span><span class="m">4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">ChickWeight</span><span class="p">,</span><span class="w"> </span><span class="n">Time</span><span class="o">==</span><span class="m">21</span><span class="p">),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">Diet</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">binwidth</span><span class="o">=</span><span class="m">50</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">facet_grid</span><span class="p">(</span><span class="n">Diet</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Final weight, by diet"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="w">        </span><span class="c1"># No legend (redundant in this graph)    
</span></code></pre>
</div>

<p>Once the plot objects are set up, we can render them with <code class="highlighter-rouge">multiplot</code>. This will make two columns of graphs:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">multiplot</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; `geom_smooth()` using method = 'loess'
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>

<h3 id="multiplot-function">multiplot function</h3>

<p>This is the definition of <code class="highlighter-rouge">multiplot</code>. It can take any number of plot objects as arguments, or if it can take a list of plot objects passed to <code class="highlighter-rouge">plotlist</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
</span><span class="n">multiplot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="n">plotlist</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make a list from the ... arguments and plotlist
</span><span class="w">  </span><span class="n">plots</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">...</span><span class="p">),</span><span class="w"> </span><span class="n">plotlist</span><span class="p">)</span><span class="w">

</span><span class="n">numPlots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span><span class="w">

</span><span class="c1"># If layout is NULL, then use 'cols' to determine layout
</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">layout</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="c1"># Make the panel
</span><span class="w">    </span><span class="c1"># ncol: Number of columns of plots
</span><span class="w">    </span><span class="c1"># nrow: Number of rows needed, calculated from # of cols
</span><span class="w">    </span><span class="n">layout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span><span class="n">numPlots</span><span class="o">/</span><span class="n">cols</span><span class="p">)),</span><span class="w">
              </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span><span class="n">numPlots</span><span class="o">/</span><span class="n">cols</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">numPlots</span><span class="o">==</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">plots</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span><span class="w">

</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="c1"># Set up the page
</span><span class="w">    </span><span class="n">grid.newpage</span><span class="p">()</span><span class="w">
</span><span class="n">pushViewport</span><span class="p">(</span><span class="n">viewport</span><span class="p">(</span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid.layout</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">layout</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="p">(</span><span class="n">layout</span><span class="p">))))</span><span class="w">

</span><span class="c1"># Make each plot, in the correct location
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">numPlots</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="c1"># Get the i,j matrix positions of the regions that contain this subplot
</span><span class="w">      </span><span class="n">matchidx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">layout</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">arr.ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">plots</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="n">vp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewport</span><span class="p">(</span><span class="n">layout.pos.row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matchidx</span><span class="o">$</span><span class="n">row</span><span class="p">,</span><span class="w">
                                </span><span class="n">layout.pos.col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matchidx</span><span class="o">$</span><span class="n">col</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-67">Colors (ggplot2)</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to use colors in a graph with ggplot2.</p>

<h3 id="solution">Solution</h3>

<p>The default colors in ggplot2 can be difficult to distinguish from one another because they have equal luminance. They are also not friendly for colorblind viewers.</p>

<p>A good general-purpose solution is to just use the <a href="#a-colorblind-friendly-palette">colorblind-friendly palette</a> below.</p>

<h3 id="sample-data">Sample data</h3>

<p>These two data sets will be used to generate the graphs below.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Two variables
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 cond yval
A 2
B 2.5
C 1.6
'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Three variables
</span><span class="n">df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
 cond1 cond2 yval
A      I 2
A      J 2.5
A      K 1.6
B      I 2.2
B      J 2.4
B      K 1.2
C      I 1.7
C      J 2.3
C      K 1.9
'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="simple-color-assignment">Simple color assignment</h3>

<p>The colors of lines and points can be set directly using <code class="highlighter-rouge">colour="red"</code>, replacing “red” with a color name. The colors of filled objects, like bars, can be set using <code class="highlighter-rouge">fill="red"</code>.</p>

<p>If you want to use anything other than very basic colors, it may be easier to use hexadecimal codes for colors, like <code class="highlighter-rouge">"#FF6699"</code>. (See the hexadecimal color chart below.)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="c1"># Default: dark bars
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Bars with red outlines
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#FF9999"</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># Red fill, black outlines
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"#FF9999"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="w">


</span><span class="c1"># Standard black lines and points
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">     </span><span class="c1"># Group all points; otherwise no line will show
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="c1"># Dark blue lines, red dots
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#000099"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Blue lines
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#CC0000"</span><span class="p">)</span><span class="w">         </span><span class="c1"># Red dots
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-4.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-5.png" alt="plot of chunk unnamed-chunk-3"></p>

<h3 id="mapping-variable-values-to-colors">Mapping variable values to colors</h3>

<p>Instead of changing colors globally, you can map variables to colors – in other words, make the color conditional on a variable, by putting it inside an <code class="highlighter-rouge">aes()</code> statement.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Bars: x and fill both depend on cond2
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Bars with other dataset; fill depends on cond2
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">cond2</span><span class="p">),</span><span class="w">   </span><span class="c1"># fill depends on cond2
</span><span class="w">             </span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
       </span><span class="n">colour</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="w">    </span><span class="c1"># Black outline for all
</span><span class="w">             </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">())</span><span class="w"> </span><span class="c1"># Put bars side-by-side instead of stacked
</span><span class="w">
</span><span class="c1"># Lines and points; colour depends on cond2
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">cond2</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">cond2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># colour, group both depend on cond2
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">cond2</span><span class="p">),</span><span class="w">               </span><span class="c1"># colour depends on cond2
</span><span class="w">               </span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">                          </span><span class="c1"># larger points, different shape
## Equivalent to above; but move "colour=cond2" into the global aes() mapping
# ggplot(df2, aes(x=cond1, y=yval, colour=cond2)) + 
#    geom_line(aes(group=cond2)) +
#    geom_point(size=3)
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4"></p>

<h3 id="a-colorblind-friendly-palette">A colorblind-friendly palette</h3>

<p>These are color-blind-friendly palettes, one with gray, and one with black.</p>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5"></p>

<p>To use with ggplot2, it is possible to store the palette in a variable, then use it later.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># The palette with grey:
</span><span class="n">cbPalette</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#999999"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#E69F00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#56B4E9"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#009E73"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#F0E442"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#0072B2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#D55E00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#CC79A7"</span><span class="p">)</span><span class="w">

</span><span class="c1"># The palette with black:
</span><span class="n">cbbPalette</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#000000"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#E69F00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#56B4E9"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#009E73"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#F0E442"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#0072B2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#D55E00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#CC79A7"</span><span class="p">)</span><span class="w">

</span><span class="c1"># To use for fills, add
</span><span class="w">  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">cbPalette</span><span class="p">)</span><span class="w">

</span><span class="c1"># To use for line and point colors, add
</span><span class="w">  </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">cbPalette</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>This palette is from <a href="http://jfly.iam.u-tokyo.ac.jp/color/">http://jfly.iam.u-tokyo.ac.jp/color/</a>:</p>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/colorblind_palette.jpg" alt="Colorblind palette"></p>

<h3 id="color-selection">Color selection</h3>

<p>By default, the colors for discrete scales are evenly spaced around a HSL color circle. For example, if there are two colors, then they will be selected from opposite points on the circle; if there are three colors, they will be 120° apart on the color circle; and so on.
The colors used for different numbers of levels are shown here:</p>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"></p>

<p>The default color selection uses <code class="highlighter-rouge">scale_fill_hue()</code> and <code class="highlighter-rouge">scale_colour_hue()</code>. For example, adding those commands is redundant in these cases:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># These two are equivalent; by default scale_fill_hue() is used
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w">
</span><span class="c1"># ggplot(df, aes(x=cond, y=yval, fill=cond)) + geom_bar(stat="identity") + scale_fill_hue()
</span><span class="w">
</span><span class="c1"># These two are equivalent; by default scale_colour_hue() is used
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1"># ggplot(df, aes(x=cond, y=yval, colour=cond)) + geom_point(size=2) + scale_colour_hue()
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-8-2.png" alt="plot of chunk unnamed-chunk-8"></p>

<h3 id="setting-luminance-and-saturation-chromaticity">Setting luminance and saturation (chromaticity)</h3>

<p>Although <code class="highlighter-rouge">scale_fill_hue()</code> and <code class="highlighter-rouge">scale_colour_hue()</code> were redundant above, they can be used when you want to make changes from the default, like changing the luminance or chromaticity.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Use luminance=45, instead of default 65
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_fill_hue</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="m">40</span><span class="p">)</span><span class="w">

</span><span class="c1"># Reduce saturation (chromaticity) from 100 to 50, and increase luminance
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_fill_hue</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="o">=</span><span class="m">80</span><span class="p">)</span><span class="w">

</span><span class="c1"># Note: use scale_colour_hue() for lines and points
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-9-2.png" alt="plot of chunk unnamed-chunk-9"></p>

<p>This is a chart of colors with luminance=45:</p>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10"></p>

<h3 id="palettes-color-brewer">Palettes: Color Brewer</h3>

<p>You can also use other color scales, such as ones taken from the RColorBrewer package. See the chart of RColorBrewer palettes below. See the scale section <a href="http://had.co.nz/ggplot2/">here</a> for more information.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_fill_brewer</span><span class="p">()</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="s2">"Set1"</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="s2">"Spectral"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Note: use scale_colour_brewer() for lines and points
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-11-3.png" alt="plot of chunk unnamed-chunk-11"></p>

<h3 id="palettes-manually-defined">Palettes: manually-defined</h3>

<p>Finally, you can define your own set of colors with <code class="highlighter-rouge">scale_fill_manual()</code>. See the hexadecimal code chart below for help choosing specific colors.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"green"</span><span class="p">))</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#CC6666"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#9999CC"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#66CC99"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Note: use scale_colour_manual() for lines and points
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12"></p>

<h3 id="continuous-colors">Continuous colors</h3>

<p>[Not complete]</p>

<p>See the scale section <a href="http://had.co.nz/ggplot2/">here</a> for more information.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Generate some data
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">133</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">xval</span><span class="o">=</span><span class="n">rnorm</span><span class="p">(</span><span class="m">50</span><span class="p">),</span><span class="w"> </span><span class="n">yval</span><span class="o">=</span><span class="n">rnorm</span><span class="p">(</span><span class="m">50</span><span class="p">))</span><span class="w">

</span><span class="c1"># Make color depend on yval
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Use a different gradient
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">yval</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
</span><span class="n">scale_colour_gradientn</span><span class="p">(</span><span class="n">colours</span><span class="o">=</span><span class="n">rainbow</span><span class="p">(</span><span class="m">4</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13"><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-13-2.png" alt="plot of chunk unnamed-chunk-13"></p>

<h2 id="topic-68">Color charts</h2>

<h3 id="hexadecimal-color-code-chart">Hexadecimal color code chart</h3>

<p>Colors can specified as a hexadecimal RGB triplet, such as <code class="highlighter-rouge">"#0066CC"</code>. The first two digits are the level of red, the next two green, and the last two blue. The value for each ranges from 00 to FF in hexadecimal (base-16) notation, which is equivalent to 0 and 255 in base-10. For example, in the table below, “#FFFFFF” is white and “#990000” is a deep red.</p>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/hextable.png" alt=""></p>

<p>(Color chart is from <a href="http://www.visibone.com">http://www.visibone.com</a>)</p>

<h3 id="rcolorbrewer-palette-chart">RColorBrewer palette chart</h3>

<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14"></p>

</article>
<h2 class="post-title" id="topic-69">Output to a file</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to save your graph(s) to a file.</p>

<h3 id="solution">Solution</h3>

<p>There are several commands which will direct output to a file instead of the screen. You must use the <code class="highlighter-rouge">dev.off()</code> command to tell R that you are finished plotting; otherwise your graph will not show up.</p>

<h3 id="pdf">PDF</h3>

<p>PDF is a vector file format. Vector files are generally preferred for print output because the resulting output can be scaled to any size without pixelation. The size of a vector file is usually smaller than the corresponding bitmap file, except in cases where there are many objects. (For example, a scatter plot with thousands of points may result in a very large vector file, but a smaller bitmap file.)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">pdf</span><span class="p">(</span><span class="s2">"plots.pdf"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>PDF’s are 7x7 inches by default, and each new plot is on a new page. The size can be changed:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># 6x3 inches
</span><span class="n">pdf</span><span class="p">(</span><span class="s2">"plots.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">

</span><span class="c1"># 10x6 cm
</span><span class="n">pdf</span><span class="p">(</span><span class="s2">"plots.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">10</span><span class="o">/</span><span class="m">2.54</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">6</span><span class="o">/</span><span class="m">2.54</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>If you want to edit your file in a vector editor like Inkscape or Illustrator, some of the plotting point objects might look like letters instead of circles, squares, etc. To avoid this problem:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">pdf</span><span class="p">(</span><span class="s2">"plots.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">useDingbats</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="svg">SVG</h3>

<p>SVG is another vector format. The default settings for <code class="highlighter-rouge">svg()</code> doesn’t allow for multiple pages in a single file, since most SVG viewers can’t handle multi-page SVG files. See the PNG section below for outputting to multiple files.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">svg</span><span class="p">(</span><span class="s2">"plots.svg"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>SVG files may work better with vector-editing programs than PDF files.</p>

<h3 id="pngtiff">PNG/TIFF</h3>

<p>PNG and TIFF are bitmap (or raster) formats. If they are magnified, the pixels may be visible.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">png</span><span class="p">(</span><span class="s2">"plot.png"</span><span class="p">)</span><span class="w">
</span><span class="c1"># or tiff("plot.tiff")
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>By default, the graphs are 480x480 pixels in size, at a resolution of 72 dpi (6.66x6.66 inches).</p>

<p>Increasing the resolution will increase the size (in pixels) of the text and graph elements. This occurs because the size of these elements is relative to the physical dimension of the graph (e.g., 4x4 inches), not the pixel dimension of the graph. For example, a 12 point font is 12/72 = 1/6 inch tall; at 72 dpi, this is 12 pixels, but at 120dpi, it is 20 pixels.</p>

<p>This would create a graph that is 480x240 pixels at 120dpi, equivalent to 4x2 inches.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">png</span><span class="p">(</span><span class="s2">"plot.png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">480</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">240</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="m">120</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>If you want to make more than one graph, you must either execute a new <code class="highlighter-rouge">png()</code> command for each one, or put <code class="highlighter-rouge">%d</code> in the filename:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">png</span><span class="p">(</span><span class="s2">"plot-%d.png"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>This will generate plot-1.png, plot2.png, and so on.</p>

<h3 id="for-import-into-pdf-incapable-programs-ms-office">For import into PDF-incapable programs (MS Office)</h3>

<p>Some programs which cannot import PDF files may work with high-resolution PNG or TIFF files. For example, Microsoft Office cannot import PDF files. For print publications, you may be required to use 300dpi images.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make a 6x6 inch image at 300dpi
</span><span class="n">ppi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">300</span><span class="w">
</span><span class="n">png</span><span class="p">(</span><span class="s2">"plot.png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">6</span><span class="o">*</span><span class="n">ppi</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">6</span><span class="o">*</span><span class="n">ppi</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="n">ppi</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<h3 id="ggplot2">ggplot2</h3>

<p>If you make plots with ggplot2 in a script or function, you must use the <code class="highlighter-rouge">print()</code> command to make the graphs actually get rendered.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># This will do nothing
</span><span class="n">pdf</span><span class="p">(</span><span class="s2">"plots.pdf"</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">

</span><span class="c1"># This will do the right thing
</span><span class="n">pdf</span><span class="p">(</span><span class="s2">"plots.pdf"</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">qplot</span><span class="p">(</span><span class="n">...</span><span class="p">))</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>To save a ggplot2 graph from the screen to a file, you can use <code class="highlighter-rouge">ggsave()</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggsave</span><span class="p">(</span><span class="s2">"plot.pdf"</span><span class="p">)</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="s2">"plot.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">

</span><span class="c1"># This will save a 400x400 file at 100 ppi
</span><span class="n">ggsave</span><span class="p">(</span><span class="s2">"plot.png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="o">=</span><span class="m">100</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="saving-a-graph-from-the-screen">Saving a graph from the screen</h3>

<p>If you have a graph on the screen, you can save it to a bitmap file.</p>

<p>This will save an exact pixel-for-pixel copy of what’s on screen, but it will probably only work in Linux and on Macs that use X11 for R graphing:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make a plot on screen
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">

</span><span class="n">savePlot</span><span class="p">(</span><span class="s2">"myplot.png"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>This will save the current graph from the screen, but it re-renders it for the device, which may have different dimensions, so it won’t look exactly the same unless you specify the exact same size in pixels.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make a plot on screen
</span><span class="n">plot</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w">

</span><span class="n">dev.copy</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span><span class="s2">"myplot.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span><span class="c1"># Same as doing:
# pdf("myplot.pdf", width=4, height=4)
# plot(...)
# dev.off()
</span><span class="w">
</span><span class="n">dev.copy</span><span class="p">(</span><span class="n">png</span><span class="p">,</span><span class="s2">"myplot.png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">400</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">400</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-70">Shapes and line types</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to use different shapes and line types in your graph.</p>

<h3 id="solution">Solution</h3>

<p><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2"></p>

<p><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/line_types-1.png" alt="plot of chunk line_types"></p>

<p>Note that with bitmap output, the filled symbols 15-18 may render without proper anti-aliasing; they can appear jagged, pixelated, and not properly centered, though this varies among platforms. Symbols 19 and 21-25 have an outline around the filled area, and will render with smoothed edges on most platforms. For symbols 21-25 to appear solid, you will also need to specify a fill (bg) color that is the same as the outline color (col); otherwise they will be hollow.</p>

<h3 id="standard-graphics">Standard graphics</h3>

<p>Use the <code class="highlighter-rouge">pch</code> option to set the shape, and use <code class="highlighter-rouge">lty</code> and <code class="highlighter-rouge">lwd</code> to set the line type and width. The line type can be specified by name or by number.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">331</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot some points with lines
# Set up the plotting area
</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="c1"># Plot solid circles with solid lines
</span><span class="n">points</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="c1"># Add open squares with dashed line, with heavier line width
</span><span class="n">points</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w">  </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">

</span><span class="n">points</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">23</span><span class="p">,</span><span class="w">   </span><span class="c1"># Diamond shape
</span><span class="w">       </span><span class="n">lty</span><span class="o">=</span><span class="s2">"dotted"</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w">               </span><span class="c1"># Dotted line, double-size shapes
</span><span class="w">       </span><span class="n">col</span><span class="o">=</span><span class="s2">"#000099"</span><span class="p">,</span><span class="w"> </span><span class="n">bg</span><span class="o">=</span><span class="s2">"#FF6666"</span><span class="p">)</span><span class="w">       </span><span class="c1"># blue line, red fill
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>

<h3 id="ggplot2">ggplot2</h3>
<p>With ggplot2, shapes and line types can be assigned overall (e.g., if you want all points to be squares, or all lines to be dashed), or they can be conditioned on a variable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Sample data
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">=</span><span class="s1">'
cond xval yval
 A    1  2.0
 A    2  2.5
 B    1  3.0
 B    2  2.0
'</span><span class="p">)</span><span class="w">


</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot with standard lines and points
# group = cond tells it which points to connect with lines
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_point</span><span class="p">()</span><span class="w">

</span><span class="c1"># Set overall shapes and line type
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w">  </span><span class="c1"># Dashed line
</span><span class="w">              </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">       </span><span class="c1"># Thicker line
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">         </span><span class="c1"># Hollow squares
</span><span class="w">               </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">          </span><span class="c1"># Large points
</span><span class="w">
</span><span class="c1"># Condition shapes and line type on variable cond
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w"> </span><span class="c1"># Line type depends on cond
</span><span class="w">              </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">       </span><span class="c1"># Thicker line
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w">   </span><span class="c1"># Shape depends on cond
</span><span class="w">               </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">          </span><span class="c1"># Large points
</span><span class="w">

</span><span class="c1"># Same as previous, but also change the specific linetypes and
# shapes that are used
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w"> </span><span class="c1"># Line type depends on cond
</span><span class="w">              </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">       </span><span class="c1"># Thicker line
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w">   </span><span class="c1"># Shape depends on cond
</span><span class="w">               </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">        </span><span class="c1"># Large points
</span><span class="w">    </span><span class="n">scale_shape_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">5</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">                  </span><span class="c1"># Change shapes
</span><span class="w">    </span><span class="n">scale_linetype_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"dotdash"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dotted"</span><span class="p">))</span><span class="w"> </span><span class="c1"># Change linetypes
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-4-4.png" alt="plot of chunk unnamed-chunk-4"></p>

<p>By default, ggplot2 uses solid shapes. If you want to use hollow shapes, without manually declaring each shape, you can use <code class="highlighter-rouge">scale_shape(solid=FALSE)</code>. Note, however, that the lines will visible inside the shape. To avoid this, you can use shapes 21-25 and specify a white fill.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Hollow shapes
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w"> </span><span class="c1"># Line type depends on cond
</span><span class="w">              </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">       </span><span class="c1"># Thicker line
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w">   </span><span class="c1"># Shape depends on cond
</span><span class="w">               </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">       </span><span class="c1"># Large points
</span><span class="w">    </span><span class="n">scale_shape</span><span class="p">(</span><span class="n">solid</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Shapes with white fill
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xval</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">yval</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w"> </span><span class="c1"># Line type depends on cond
</span><span class="w">              </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">       </span><span class="c1"># Thicker line
</span><span class="w">    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">cond</span><span class="p">),</span><span class="w">   </span><span class="c1"># Shape depends on cond
</span><span class="w">               </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w">    </span><span class="c1"># White fill
</span><span class="w">               </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">       </span><span class="c1"># Large points
</span><span class="w">    </span><span class="n">scale_shape_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">21</span><span class="p">,</span><span class="m">24</span><span class="p">))</span><span class="w">  </span><span class="c1"># Shapes: Filled circle, triangle
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5"></p>

<h3 id="note">Note</h3>

<p>This code will generate the chart of line types seen at the top.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">))</span><span class="w">

</span><span class="c1"># Set up the plotting area
</span><span class="n">plot</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">6.5</span><span class="p">,</span><span class="w"> </span><span class="m">-0.5</span><span class="p">),</span><span class="w">
</span><span class="n">xaxt</span><span class="o">=</span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">yaxt</span><span class="o">=</span><span class="s2">"n"</span><span class="p">,</span><span class="w">
</span><span class="n">xlab</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="kc">NA</span><span class="w"> </span><span class="p">)</span><span class="w">

</span><span class="c1"># Draw the lines
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># Add labels
</span><span class="n">text</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="s2">"0. 'blank'"</span><span class="w">   </span><span class="p">,</span><span class="w">  </span><span class="n">adj</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"1. 'solid'"</span><span class="w">   </span><span class="p">,</span><span class="w">  </span><span class="n">adj</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"2. 'dashed'"</span><span class="w">  </span><span class="p">,</span><span class="w">  </span><span class="n">adj</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="s2">"3. 'dotted'"</span><span class="w">  </span><span class="p">,</span><span class="w">  </span><span class="n">adj</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="s2">"4. 'dotdash'"</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="n">adj</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="s2">"5. 'longdash'"</span><span class="p">,</span><span class="w">  </span><span class="n">adj</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="s2">"6. 'twodash'"</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="n">adj</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-71">Fonts</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to use different fonts in your graphs.</p>

<h3 id="solution">Solution</h3>

<p><strong>Update: Also see the <a href="https://github.com/wch/extrafont">extrafont</a> package for much better support of fonts for PDF and Windows bitmap output.</strong></p>

<p>Font support in R is generally not very good. It varies between systems, and between output formats.</p>

<h3 id="geomtext">geom_text</h3>

<p>With <code class="highlighter-rouge">geom_text</code> or <code class="highlighter-rouge">annotate</code> in ggplot2, you can set a number of properties of the text. <code class="highlighter-rouge">geom_text</code> is used to add text from the data frame, and <code class="highlighter-rouge">annotate</code> is used to add a single text element.</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="highlighter-rouge">size</code></td>
<td>5</td>
</tr>
<tr>
<td><code class="highlighter-rouge">family</code></td>
<td><code class="highlighter-rouge">""</code> (sans)</td>
</tr>
<tr>
<td><code class="highlighter-rouge">fontface</code></td>
<td><code class="highlighter-rouge">plain</code></td>
</tr>
<tr>
<td><code class="highlighter-rouge">lineheight</code></td>
<td>1.2</td>
</tr>
<tr>
<td><code class="highlighter-rouge">angle</code></td>
<td>0</td>
</tr>
<tr>
<td><code class="highlighter-rouge">hjust</code></td>
<td>0.5</td>
</tr>
<tr>
<td><code class="highlighter-rouge">vjust</code></td>
<td>0.5</td>
</tr>
</tbody>
</table>

<p>Note that <code class="highlighter-rouge">size</code> is in mm, not points.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w">
</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"This is text"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Text with\nmultiple lines"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Some more text"</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
 </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">3.5</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">

</span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">text</span><span class="p">))</span><span class="w">

</span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">text</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s2">"Times"</span><span class="p">,</span><span class="w"> </span><span class="n">fontface</span><span class="o">=</span><span class="s2">"italic"</span><span class="p">,</span><span class="w"> </span><span class="n">lineheight</span><span class="o">=</span><span class="m">.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">annotate</span><span class="p">(</span><span class="n">geom</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s2">"Annotation text"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w">
       </span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s2">"Courier"</span><span class="p">,</span><span class="w"> </span><span class="n">fontface</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="o">=</span><span class="m">30</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Fonts/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2"><img src="http://www.cookbook-r.com/Graphs/Fonts/figure/unnamed-chunk-2-2.png" alt="plot of chunk unnamed-chunk-2"></p>

<h3 id="themes-and-elementtext">themes and element_text</h3>

<p>When controlling elements such as the title, legend, axis labels, and so on, you use <code class="highlighter-rouge">element_text</code>, which has the same parameters, except that <code class="highlighter-rouge">size</code> is <strong>points</strong> (not mm), and instead of <code class="highlighter-rouge">fontface</code>, it uses <code class="highlighter-rouge">face</code>. The default value of <code class="highlighter-rouge">size</code> depends on the element; for example, titles are larger than tick labels.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"This is a Title"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span><span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">"Times"</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Fonts/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>

<h3 id="table-of-fonts">Table of fonts</h3>

<p>You can use this code to generate a graphical table of fonts. Fonts have <em>short</em> names and <em>canonical</em> family names. You can use either one when specifying the family.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fonttable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                  </span><span class="n">text</span><span class="o">=</span><span class="s1">'
Short,Canonical
mono,Courier
sans,Helvetica
serif,Times
,AvantGarde
,Bookman
,Helvetica-Narrow
,NewCenturySchoolbook
,Palatino
,URWGothic
,URWBookman
,NimbusMon
URWHelvetica,NimbusSan
,NimbusSanCond
,CenturySch
,URWPalladio
URWTimes,NimbusRom
'</span><span class="p">)</span><span class="w">

</span><span class="n">fonttable</span><span class="o">$</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">fonttable</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">fonttable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">fonttable</span><span class="p">,</span><span class="w"> </span><span class="n">id.vars</span><span class="o">=</span><span class="s2">"pos"</span><span class="p">,</span><span class="w"> </span><span class="n">measure.vars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Short"</span><span class="p">,</span><span class="s2">"Canonical"</span><span class="p">),</span><span class="w">
            </span><span class="n">variable.name</span><span class="o">=</span><span class="s2">"NameType"</span><span class="p">,</span><span class="w"> </span><span class="n">value.name</span><span class="o">=</span><span class="s2">"Font"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make a table of faces. Make sure factors are ordered correctly
</span><span class="n">facetable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"plain"</span><span class="p">,</span><span class="s2">"bold"</span><span class="p">,</span><span class="s2">"italic"</span><span class="p">,</span><span class="s2">"bold.italic"</span><span class="p">),</span><span class="w">
                                </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"plain"</span><span class="p">,</span><span class="s2">"bold"</span><span class="p">,</span><span class="s2">"italic"</span><span class="p">,</span><span class="s2">"bold.italic"</span><span class="p">)))</span><span class="w">

</span><span class="n">fullfonts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">fonttable</span><span class="p">,</span><span class="w"> </span><span class="n">facetable</span><span class="p">)</span><span class="w">


</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">pf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">fullfonts</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">NameType</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">pos</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
       </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">Font</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">Font</span><span class="p">,</span><span class="w"> </span><span class="n">fontface</span><span class="o">=</span><span class="n">Face</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
       </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">Face</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>To view it on screen:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">pf</span><span class="w">
</span></code></pre>
</div>

<p>What you see on the screen isn’t necessarily the same as what you get when you output to PNG or PDF. To see PNG output:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">png</span><span class="p">(</span><span class="s1">'fonttable.png'</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">720</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">720</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="m">72</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">pf</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>Notice that on the system that generated this picture, most of the fonts (at the top) don’t really work. Only the basic fonts (at the bottom) work.</p>

<p><img src="http://www.cookbook-r.com/Graphs/Fonts/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7"></p>

<hr>

<p>And PDF output (the image below has been converted from PDF to PNG):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">pdf</span><span class="p">(</span><span class="s1">'fonttable.pdf'</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">pf</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">

</span><span class="c1"># Convert to PNG using GraphicsMagick:
# system("gm convert -resize 720x720 -background white fonttable.pdf fonttable-pdf.png")
</span></code></pre>
</div>

<p>The PDF device has better font support than the PNG device. All the fonts work (though they’re not necessarily pretty):</p>

<p><img src="http://www.cookbook-r.com/Graphs/Fonts/fonttable-pdf.png" alt="PDF font table, converted to PNG"></p>

</article>
<h2 class="post-title" id="topic-72">Histogram and density plot</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to make a histogram or density plot.</p>

<h3 id="solution">Solution</h3>

<p>Some sample data: these two vectors contain 200 data points each:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span><span class="w">
</span><span class="n">rating</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">200</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] -1.2070657  0.2774292  1.0844412 -2.3456977  0.4291247  0.5060559
</span><span class="w">
</span><span class="n">rating2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="m">.8</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">rating2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] 1.2852268 1.4967688 0.9855139 1.5007335 1.1116810 1.5604624
</span></code></pre>
</div>

<p>When plotting multiple groups of data, some graphing routines require a data frame with one column for the grouping variable and one for the measure variable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Make a column to indicate which group each value is in
</span><span class="n">cond</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="s2">"B"</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="o">=</span><span class="m">200</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span><span class="w"> </span><span class="n">rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span><span class="n">rating2</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   cond     rating
#&gt; 1    A -1.2070657
#&gt; 2    A  0.2774292
#&gt; 3    A  1.0844412
#&gt; 4    A -2.3456977
#&gt; 5    A  0.4291247
#&gt; 6    A  0.5060559
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Histogram
</span><span class="n">hist</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span><span class="w">

</span><span class="c1"># Use 8 bins (this is only approximate - it places boundaries on nice round numbers)
# Make it light blue #CCCCFF
# Instead of showing count, make area sum to 1, (freq=FALSE)
</span><span class="n">hist</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"#CCCCFF"</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Put breaks at every 0.6
</span><span class="n">boundaries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="w"> </span><span class="m">3.6</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">.6</span><span class="p">)</span><span class="w">
</span><span class="n">boundaries</span><span class="w">
</span><span class="c1">#&gt;  [1] -3.0 -2.4 -1.8 -1.2 -0.6  0.0  0.6  1.2  1.8  2.4  3.0  3.6
</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="n">boundaries</span><span class="p">)</span><span class="w">


</span><span class="c1"># Kernel density plot
</span><span class="n">plot</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">rating</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Histogram_and_density_plot/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Histogram_and_density_plot/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Histogram_and_density_plot/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Histogram_and_density_plot/figure/unnamed-chunk-4-4.png" alt="plot of chunk unnamed-chunk-4"></p>

<p>Multiple groups with kernel density plots.</p>

<p>This code is from: <a href="http://onertipaday.blogspot.com/2007/09/plotting-two-or-more-overlapping.html">http://onertipaday.blogspot.com/2007/09/plotting-two-or-more-overlapping.html</a></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plot.multi.dens</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="n">junk.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">junk.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">junk.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">junk.x</span><span class="p">,</span><span class="w"> </span><span class="n">density</span><span class="p">(</span><span class="n">s</span><span class="p">[[</span><span class="n">i</span><span class="p">]])</span><span class="o">$</span><span class="n">x</span><span class="p">)</span><span class="w">
  </span><span class="n">junk.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">junk.y</span><span class="p">,</span><span class="w"> </span><span class="n">density</span><span class="p">(</span><span class="n">s</span><span class="p">[[</span><span class="n">i</span><span class="p">]])</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">xr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">junk.x</span><span class="p">)</span><span class="w">
</span><span class="n">yr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">junk.y</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">s</span><span class="p">[[</span><span class="m">1</span><span class="p">]]),</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xr</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">s</span><span class="p">[[</span><span class="n">i</span><span class="p">]]),</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xr</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># the input of the following function MUST be a numeric list
</span><span class="n">plot.multi.dens</span><span class="p">(</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">rating2</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Histogram_and_density_plot/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"></p>

<p>The <code class="highlighter-rouge">sm</code> package also includes a way of doing multiple density plots. The data must be in a data frame.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span><span class="w">
</span><span class="n">sm.density.compare</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">cond</span><span class="p">)</span><span class="w">
</span><span class="c1"># Add a legend (the color numbers start from 2 and go up)
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">cond</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="m">2</span><span class="o">+</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="n">nlevels</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">cond</span><span class="p">)))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Histogram_and_density_plot/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"></p>

</article>
<h2 class="post-title" id="topic-73">Scatterplot</h2>
<article class="post-content">

<h3 id="problem">Problem</h3>

<p>You want to make a scatterplot.</p>

<h3 id="solution">Solution</h3>

<p>Suppose this is your data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">955</span><span class="p">)</span><span class="w">
</span><span class="c1"># Make some noisily increasing data
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">xvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">3</span><span class="p">),</span><span class="w">
            </span><span class="n">yvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">3</span><span class="p">),</span><span class="w">
            </span><span class="n">zvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">3</span><span class="p">))</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;        xvar         yvar        zvar
#&gt; 1 -4.252354  3.473157275 -2.97806724
#&gt; 2  1.702318  0.005939612 -1.16183118
#&gt; 3  4.323054 -0.094252427  4.85516658
#&gt; 4  1.780628  2.072808278  4.65078709
#&gt; 5 11.537348  1.215440358 -0.06613962
#&gt; 6  6.672130  3.608111411  6.24349897
</span></code></pre>
</div>

<h3 id="basic-scatterplots">Basic scatterplots</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Plot the points using the vectors xvar and yvar
</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">yvar</span><span class="p">)</span><span class="w">

</span><span class="c1"># Same as previous, but with formula interface
</span><span class="n">plot</span><span class="p">(</span><span class="n">yvar</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">dat</span><span class="p">)</span><span class="w">

</span><span class="c1"># Add a regression line
</span><span class="n">fitline</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">yvar</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">xvar</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">fitline</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Scatterplot/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Scatterplot/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"></p>

<h3 id="scatterplot-matrices">Scatterplot matrices</h3>

<p>It is also possible to make a matrix of scatterplots if you would like to compare several variables.</p>

<p>See <a href="http://addictedtor.free.fr/graphiques/graphcode.php?graph=137">this</a> for a way to make a scatterplot matrix with r values.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># A scatterplot matrix
</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">])</span><span class="w">

</span><span class="c1"># Another way of making a scatterplot matrix, with regression lines
# and histogram/boxplot/density/qqplot/none along the diagonal
</span><span class="n">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span><span class="w">
</span><span class="n">scatterplotMatrix</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="w">
             </span><span class="n">diagonal</span><span class="o">=</span><span class="s2">"histogram"</span><span class="p">,</span><span class="w">
             </span><span class="n">smooth</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Scatterplot/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><img src="http://www.cookbook-r.com/Graphs/Scatterplot/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4"></p>

<p>To calculate the corresponding correlation matrix, see <a href="../../Statistical_analysis/Regression_and_correlation">../../Statistical analysis/Regression and correlation</a>.</p>

<p>To visualize the correlation matrix, see <a href="../Correlation_matrix">../Correlation matrix</a>.</p>

</article>
<h2 class="post-title" id="topic-74">Box plot</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to make a box plot.</p>

<h3 id="solution">Solution</h3>

<p>This page shows how to make quick, simple box plots with base graphics. For more sophisticated ones, see <a href="../Plotting_distributions_(ggplot2)">Plotting distributions (ggplot2)</a>.</p>

<h3 id="sample-data">Sample data</h3>

<p>The examples here will use the <code class="highlighter-rouge">ToothGrowth</code> data set, which has two independent variables, and one dependent variable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;    len supp dose
#&gt; 1  4.2   VC  0.5
#&gt; 2 11.5   VC  0.5
#&gt; 3  7.3   VC  0.5
#&gt; 4  5.8   VC  0.5
#&gt; 5  6.4   VC  0.5
#&gt; 6 10.0   VC  0.5
</span></code></pre>
</div>

<p>Simple box plots of <code class="highlighter-rouge">len</code> against <code class="highlighter-rouge">supp</code> and <code class="highlighter-rouge">dose</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">boxplot</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">supp</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">

</span><span class="c1"># Even though `dose` is a numeric variable, `boxplot` will convert it to a factor
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Box_plot/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Box_plot/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"></p>

<p>A boxplot of <code class="highlighter-rouge">len</code> against <code class="highlighter-rouge">supp</code> and <code class="highlighter-rouge">dose</code> together.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">boxplot</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">interaction</span><span class="p">(</span><span class="n">dose</span><span class="p">,</span><span class="n">supp</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Box_plot/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"></p>

<p>Note that <code class="highlighter-rouge">boxplot</code> and <code class="highlighter-rouge">plot</code> have much the same output, except that <code class="highlighter-rouge">plot</code> puts in axis labels, and doesn’t automatically convert numeric variables to factors, as was done with <code class="highlighter-rouge">dose</code> above.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">interaction</span><span class="p">(</span><span class="n">dose</span><span class="p">,</span><span class="n">supp</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ToothGrowth</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Box_plot/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"></p>

</article>
<h2 class="post-title" id="topic-75">Q-Q plot</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to compare the distribution of your data to another distribution. This is often used to check whether a sample follows a normal distribution, to check whether two samples are drawn from the same distribution.</p>

<h3 id="solution">Solution</h3>

<p>Suppose this is your data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">183</span><span class="p">)</span><span class="w">
</span><span class="c1"># Normally distributed numbers
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">80</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="w">

</span><span class="c1"># Uniformly distributed numbers
</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">80</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Compare the numbers sampled with rnorm() against normal distribution
</span><span class="n">qqnorm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">

</span><span class="c1"># The same numbers to the 4th power, compared to the normal distribution
</span><span class="n">qqnorm</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="m">4</span><span class="p">)</span><span class="w">


</span><span class="c1"># Numbers sampled from the flat distribution, compared to normal
</span><span class="n">qqnorm</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w">
</span><span class="n">qqline</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Q-Q_plot/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Q-Q_plot/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Q-Q_plot/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3"></p>

</article>
<h2 class="post-title" id="topic-76">Correlation matrix</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to visualize the strength of correlations among many variables.</p>

<h3 id="solution">Solution</h3>

<p>Suppose this is your data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">955</span><span class="p">)</span><span class="w">
</span><span class="n">vvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">wvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">xvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">20</span><span class="o">:</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">yvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">zvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">6</span><span class="p">)</span><span class="w">


</span><span class="c1"># A data frame with multiple variables
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">vvar</span><span class="p">,</span><span class="w"> </span><span class="n">wvar</span><span class="p">,</span><span class="w"> </span><span class="n">xvar</span><span class="p">,</span><span class="w"> </span><span class="n">yvar</span><span class="p">,</span><span class="w"> </span><span class="n">zvar</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;        vvar       wvar     xvar       yvar      zvar
#&gt; 1 -4.252354  5.1219288 16.02193 -15.156368 -4.086904
#&gt; 2  1.702318 -1.3234340 15.83817 -24.063902  3.468423
#&gt; 3  4.323054 -2.1570874 19.85517   2.306770 -3.044931
#&gt; 4  1.780628  0.7880138 17.65079   2.564663  1.449081
#&gt; 5 11.537348 -1.3075994 10.93386   9.600835  2.761963
#&gt; 6  6.672130  2.0135190 15.24350  -3.465695  5.749642
</span></code></pre>
</div>

<p>To make the graph:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make the correlation table
</span><span class="n">ctab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">ctab</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;       vvar  wvar  xvar  yvar  zvar
#&gt; vvar  1.00  0.61 -0.85  0.75 -0.21
#&gt; wvar  0.61  1.00 -0.81  0.54 -0.31
#&gt; xvar -0.85 -0.81  1.00 -0.63  0.24
#&gt; yvar  0.75  0.54 -0.63  1.00 -0.30
#&gt; zvar -0.21 -0.31  0.24 -0.30  1.00
</span><span class="w">
</span><span class="c1"># Make the graph, with reduced margins
</span><span class="n">plotcorr</span><span class="p">(</span><span class="n">ctab</span><span class="p">,</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span><span class="w">

</span><span class="c1"># Do the same, but with colors corresponding to value
</span><span class="n">colorfun</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colorRamp</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#CC0000"</span><span class="p">,</span><span class="s2">"white"</span><span class="p">,</span><span class="s2">"#3366CC"</span><span class="p">),</span><span class="w"> </span><span class="n">space</span><span class="o">=</span><span class="s2">"Lab"</span><span class="p">)</span><span class="w">
</span><span class="n">plotcorr</span><span class="p">(</span><span class="n">ctab</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">rgb</span><span class="p">(</span><span class="n">colorfun</span><span class="p">((</span><span class="n">ctab</span><span class="m">+1</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">maxColorValue</span><span class="o">=</span><span class="m">255</span><span class="p">),</span><span class="w">
   </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Graphs/Correlation_matrix/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"><img src="http://www.cookbook-r.com/Graphs/Correlation_matrix/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3"></p>

</article>
<h2 class="post-title" id="topic-77">Debugging a script or function</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to debug a script or function.</p>

<h3 id="solution">Solution</h3>

<p>Insert this into your code at the place where you want to start debugging:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">browser</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>When the R interpreter reaches that line, it will pause your code and you will be able to look at and change variables.</p>

<p>In the browser, typing these letters will do things:</p>

<table>
<thead>
<tr>
<th>&nbsp;</th>
<th>&nbsp;</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>Continue</td>
</tr>
<tr>
<td>n (or Return)</td>
<td>Next step</td>
</tr>
<tr>
<td>Q</td>
<td>quit</td>
</tr>
<tr>
<td>Ctrl-C</td>
<td>go to top level</td>
</tr>
</tbody>
</table>

<p>When in the browser, you can see what variables are in the current scope.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ls</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>To pause and start a browser for every line in your function:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">debug</span><span class="p">(</span><span class="n">myfunction</span><span class="p">)</span><span class="w">
</span><span class="n">myfunction</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="useful-options">Useful options</h3>

<p>By default, every time you press Enter at the browser prompt, it runs the next step. This is equivalent to pressing <code class="highlighter-rouge">n</code> and then Enter. This can be annoying. To disable it use:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">options</span><span class="p">(</span><span class="n">browserNLdisabled</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>To start debugging whenever an error is thrown, run this before your function which throws an error:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">options</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="n">recover</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>If you want these options to be set every time you start R, you can put them in your <code class="highlighter-rouge">~/.Rprofile</code> file.</p>

</article>
<h2 class="post-title" id="topic-78">Measuring elapsed time</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to measure how much time it takes to run a particular block of code.</p>

<h3 id="solution">Solution</h3>

<p>The <code class="highlighter-rouge">system.time()</code> function will measure how long it takes to run something in R.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">system.time</span><span class="p">({</span><span class="w">
</span><span class="c1"># Do something that takes time
</span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100000</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">  </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="m">+1</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="c1">#&gt;    user  system elapsed 
#&gt;   0.144   0.002   0.153
</span></code></pre>
</div>

<p>The output means it took 0.153 seconds to run the block of code.</p>

</article>
<h2 class="post-title" id="topic-79">Getting a list of functions and objects in a package</h2>
<article class="post-content">
<h3 id="problem">Problem</h3>

<p>You want to find out what’s in a package.</p>

<h3 id="solution">Solution</h3>

<p>This code snippet will list the functions and objects in a package.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Using search() in a new R session says that these packages are 
# loaded by default:
# "package:stats"     "package:graphics" 
# "package:grDevices" "package:utils"     "package:datasets" 
# "package:methods"   "package:base"  
</span><span class="w">
</span><span class="c1"># Others that are useful:
# gplots
# ggplot2, reshape, plyr
</span><span class="w">
</span><span class="n">showPackageContents</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">packageName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

</span><span class="c1"># Get a list of things contained in a particular package
</span><span class="w">    </span><span class="n">funlist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">objects</span><span class="p">(</span><span class="n">packageName</span><span class="p">)</span><span class="w">

</span><span class="c1"># Remove things that don't start with a letter
</span><span class="w">    </span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grep</span><span class="p">(</span><span class="s1">'^[a-zA-Z][a-zA-Z0-9._]*'</span><span class="p">,</span><span class="w"> </span><span class="n">funlist</span><span class="p">)</span><span class="w">
</span><span class="n">funlist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">funlist</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="w">

</span><span class="c1"># Remove things that contain arrow &lt;-
</span><span class="w">    </span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grep</span><span class="p">(</span><span class="s1">'&lt;-'</span><span class="p">,</span><span class="w"> </span><span class="n">funlist</span><span class="p">)</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">!=</span><span class="m">0</span><span class="p">)</span><span class="w">
  </span><span class="n">funlist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">funlist</span><span class="p">[</span><span class="o">-</span><span class="n">idx</span><span class="p">]</span><span class="w">

</span><span class="c1"># Make a data frame to keep track of status
</span><span class="w">    </span><span class="n">objectlist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">funlist</span><span class="p">,</span><span class="w">
                       </span><span class="n">primitive</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                       </span><span class="n">func</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                       </span><span class="n">object</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                       </span><span class="n">constant</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                       </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">objectlist</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">fname</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">objectlist</span><span class="o">$</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">obj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is.primitive</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">objectlist</span><span class="o">$</span><span class="n">primitive</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
      </span><span class="p">}</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">is.function</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">objectlist</span><span class="o">$</span><span class="n">func</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
      </span><span class="p">}</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">is.object</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">objectlist</span><span class="o">$</span><span class="n">object</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
      </span><span class="p">}</span><span class="w">
      
      </span><span class="c1"># I think these are generally constants
</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is.vector</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">objectlist</span><span class="o">$</span><span class="n">constant</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
      </span><span class="p">}</span><span class="w">
     
  
  </span><span class="p">}</span><span class="w">  
</span><span class="p">}</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="n">packageName</span><span class="p">)</span><span class="w">
  
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n================================================\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"Primitive functions: \n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="n">objectlist</span><span class="o">$</span><span class="n">name</span><span class="p">[</span><span class="n">objectlist</span><span class="o">$</span><span class="n">primitive</span><span class="p">])</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n================================================\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"Non-primitive functions: \n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="n">objectlist</span><span class="o">$</span><span class="n">name</span><span class="p">[</span><span class="n">objectlist</span><span class="o">$</span><span class="n">func</span><span class="w">  </span><span class="o">&amp;</span><span class="w">  </span><span class="o">!</span><span class="n">objectlist</span><span class="o">$</span><span class="n">primitive</span><span class="p">])</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n================================================\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"Constants: \n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="n">objectlist</span><span class="o">$</span><span class="n">name</span><span class="p">[</span><span class="n">objectlist</span><span class="o">$</span><span class="n">constant</span><span class="p">])</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n================================================\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"Objects: \n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="n">objectlist</span><span class="o">$</span><span class="n">name</span><span class="p">[</span><span class="n">objectlist</span><span class="o">$</span><span class="n">object</span><span class="p">])</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="c1"># Run the function using base package
</span><span class="n">showPackageContents</span><span class="p">(</span><span class="s2">"package:base"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

</article>
<h2 class="post-title" id="topic-80">Generating counterbalanced orders</h2>
<article class="post-content">


<h3 id="problem">Problem</h3>

<p>You want to generate counterbalanced sequences for an experiment.</p>

<h3 id="solution">Solution</h3>

<p>The function <code class="highlighter-rouge">latinsquare()</code> (defined below) can be used to generate Latin squares.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">latinsquare</span><span class="p">(</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;      [,1] [,2] [,3] [,4]
#&gt; [1,]    1    2    4    3
#&gt; [2,]    2    1    3    4
#&gt; [3,]    3    4    1    2
#&gt; [4,]    4    3    2    1
</span><span class="w">

</span><span class="c1"># To generate 2 Latin squares of size 4 (in sequence)
</span><span class="n">latinsquare</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;      [,1] [,2] [,3] [,4]
#&gt; [1,]    3    4    1    2
#&gt; [2,]    4    3    2    1
#&gt; [3,]    1    2    4    3
#&gt; [4,]    2    1    3    4
#&gt; [5,]    4    2    1    3
#&gt; [6,]    2    3    4    1
#&gt; [7,]    1    4    3    2
#&gt; [8,]    3    1    2    4
</span><span class="w">

</span><span class="c1"># It is better to put the random seed in the function call, to make it repeatable
# This will return the same sequence of two Latin squares every time
</span><span class="n">latinsquare</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">seed</span><span class="o">=</span><span class="m">5873</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;      [,1] [,2] [,3] [,4]
#&gt; [1,]    1    4    2    3
#&gt; [2,]    4    1    3    2
#&gt; [3,]    2    3    4    1
#&gt; [4,]    3    2    1    4
#&gt; [5,]    3    2    4    1
#&gt; [6,]    1    4    2    3
#&gt; [7,]    4    3    1    2
#&gt; [8,]    2    1    3    4
</span></code></pre>
</div>

<p>There are 576 Latin squares of size 4. The <code class="highlighter-rouge">latinsquare</code> function will, in effect, randomly select <strong>n</strong> of these squares and return them in sequence. This is known as a <strong>replicated Latin square design</strong>.</p>

<p>Once you generate your Latin squares, it is a good idea to inspect them to make sure that there are not many duplicated sequences. This is not uncommon with smaller squares (3x3 or 4x4).</p>

<h3 id="a-function-for-generating-latin-squares">A function for generating Latin squares</h3>

<p>This function generates Latin squares. It uses a somewhat brute-force algorithm to generate each square, which can sometimes fail because it runs out of available numbers to put in a given location. In such cases, it just tries again. There may be an elegant way out there to do it, but I am not aware of it.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## - len is the size of the latin square
## - reps is the number of repetitions - how many Latin squares to generate
## - seed is a random seed that can be used to generate repeatable sequences
## - returnstrings tells it to return a vector of char strings for each square,
##    instead of a big matrix. This option is only really used for checking the
##    randomness of the squares.
</span><span class="n">latinsquare</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">seed</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">returnstrings</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

</span><span class="c1"># Save the old random seed and use the new one, if present
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exists</span><span class="p">(</span><span class="s2">".Random.seed"</span><span class="p">))</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">saved.seed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">.Random.seed</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="k">else</span><span class="w">                         </span><span class="p">{</span><span class="w"> </span><span class="n">saved.seed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="n">set.seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># This matrix will contain all the individual squares
</span><span class="w">    </span><span class="n">allsq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="n">reps</span><span class="o">*</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">len</span><span class="p">)</span><span class="w">

</span><span class="c1"># Store a string id of each square if requested
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">returnstrings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="n">squareid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"character"</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reps</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c1"># Get a random element from a vector (the built-in sample function annoyingly
</span><span class="w">    </span><span class="c1">#   has different behavior if there's only one element in x)
</span><span class="w">    </span><span class="n">sample1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="k">else</span><span class="w">              </span><span class="p">{</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Generate each of n individual squares
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">reps</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

  </span><span class="c1"># Generate an empty square
</span><span class="w">        </span><span class="n">sq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">len</span><span class="p">)</span><span class="w"> 

  </span><span class="c1"># If we fill the square sequentially from top left, some latin squares
</span><span class="w">        </span><span class="c1"># are more probable than others.  So we have to do it random order,
</span><span class="w">        </span><span class="c1"># all over the square.
</span><span class="w">        </span><span class="c1"># The rough procedure is:
</span><span class="w">        </span><span class="c1"># - randomly select a cell that is currently NA (call it the target cell)
</span><span class="w">        </span><span class="c1"># - find all the NA cells sharing the same row or column as the target
</span><span class="w">        </span><span class="c1"># - fill the target cell
</span><span class="w">        </span><span class="c1"># - fill the other cells sharing the row/col
</span><span class="w">        </span><span class="c1"># - If it ever is impossible to fill a cell because all the numbers
</span><span class="w">        </span><span class="c1">#    are already used, then quit and start over with a new square.
</span><span class="w">        </span><span class="c1"># In short, it picks a random empty cell, fills it, then fills in the 
</span><span class="w">        </span><span class="c1"># other empty cells in the "cross" in random order. If we went totally randomly
</span><span class="w">        </span><span class="c1"># (without the cross), the failure rate is much higher.
</span><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nf">any</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">sq</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">

      </span><span class="c1"># Pick a random cell which is currently NA
</span><span class="w">            </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample1</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">sq</span><span class="p">)))</span><span class="w">
      
      </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="m">+1</span><span class="w">       </span><span class="c1"># Get the row num
</span><span class="w">            </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">floor</span><span class="p">((</span><span class="n">k</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="m">+1</span><span class="w"> </span><span class="c1"># Get the col num
</span><span class="w">            
      </span><span class="c1"># Find the other NA cells in the "cross" centered at i,j
</span><span class="w">            </span><span class="n">sqrow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sq</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="w">
      </span><span class="n">sqcol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sq</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span><span class="w">

      </span><span class="c1"># A matrix of coordinates of all the NA cells in the cross
</span><span class="w">            </span><span class="n">openCell</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">rbind</span><span class="p">(</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">sqcol</span><span class="p">)),</span><span class="w"> </span><span class="n">j</span><span class="p">),</span><span class="w">
                        </span><span class="n">cbind</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">sqrow</span><span class="p">))))</span><span class="w">
      </span><span class="c1"># Randomize fill order
</span><span class="w">            </span><span class="n">openCell</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">openCell</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">openCell</span><span class="p">)),]</span><span class="w">
      
      </span><span class="c1"># Put center cell at top of list, so that it gets filled first
</span><span class="w">            </span><span class="n">openCell</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="w"> </span><span class="n">openCell</span><span class="p">)</span><span class="w">
      </span><span class="c1"># There will now be three entries for the center cell, so remove duplicated entries
</span><span class="w">            </span><span class="c1"># Need to make sure it's a matrix -- otherwise, if there's just 
</span><span class="w">            </span><span class="c1"># one row, it turns into a vector, which causes problems
</span><span class="w">            </span><span class="n">openCell</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">openCell</span><span class="p">[</span><span class="o">!</span><span class="n">duplicated</span><span class="p">(</span><span class="n">openCell</span><span class="p">),],</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">

      </span><span class="c1"># Fill in the center of the cross, then the other open spaces in the cross
</span><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">openCell</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="c1"># The current cell to fill
</span><span class="w">                </span><span class="n">ci</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">openCell</span><span class="p">[</span><span class="n">c</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="w">
          </span><span class="n">cj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">openCell</span><span class="p">[</span><span class="n">c</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="w">
          </span><span class="c1"># Get the numbers that are unused in the "cross" centered on i,j
</span><span class="w">                </span><span class="n">freeNum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">len</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">sq</span><span class="p">[</span><span class="n">ci</span><span class="p">,],</span><span class="w"> </span><span class="n">sq</span><span class="p">[,</span><span class="n">cj</span><span class="p">])))</span><span class="w">

          </span><span class="c1"># Fill in this location on the square
</span><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">freeNum</span><span class="p">)</span><span class="o">&gt;</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">sq</span><span class="p">[</span><span class="n">ci</span><span class="p">,</span><span class="n">cj</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample1</span><span class="p">(</span><span class="n">freeNum</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
          </span><span class="k">else</span><span class="w">  </span><span class="p">{</span><span class="w">
              </span><span class="c1"># Failed attempt - no available numbers
</span><span class="w">                    </span><span class="c1"># Re-generate empty square
</span><span class="w">                    </span><span class="n">sq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">len</span><span class="p">)</span><span class="w">

              </span><span class="c1"># Break out of loop
</span><span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w">
          </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  
  </span><span class="c1"># Store the individual square into the matrix containing all squares
</span><span class="w">        </span><span class="n">allsqrows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">((</span><span class="n">n</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">len</span><span class="w">
  </span><span class="n">allsq</span><span class="p">[</span><span class="n">allsqrows</span><span class="p">,]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sq</span><span class="w">
  
  </span><span class="c1"># Store a string representation of the square if requested. Each unique
</span><span class="w">        </span><span class="c1"># square has a unique string.
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">returnstrings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">squareid</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">sq</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="p">}</span><span class="w">

</span><span class="c1"># Restore the old random seed, if present
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">saved.seed</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">.Random.seed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">saved.seed</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">returnstrings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="n">squareid</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="k">else</span><span class="w">               </span><span class="p">{</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="n">allsq</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h4 id="testing-the-function-for-randomness">Testing the function for randomness</h4>

<p>Some algorithms for generating Latin squares may not create them very randomly. There are 576 unique 4x4 squares, and each one should have an equal probability of being created, but some algorithms do not properly do this. There is probably no need to test the randomness of the function above, but here is some code that will do it. Previous algorithms that I used did not have a good random distribution, which was discovered by running the code below.</p>

<p>This code creates 10,000 4x4 Latin squares, then counts how often each of the 576 unique squares appears. The counts should form a not-too-wide normal distribution; otherwise the distribution not very random. I believe the expected standard deviation of the distribution (assuming randomly generated squares) is sqrt(10000/576).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Set up the size and number of squares to generate
</span><span class="n">squaresize</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">4</span><span class="w">
</span><span class="n">numsquares</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">

</span><span class="c1"># Get number of unique squares of a given size.
# There is not a general solution to finding the number of unique nxn squares
# so we just hard-code the values here. (From http://oeis.org/A002860)
</span><span class="n">uniquesquares</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">576</span><span class="p">,</span><span class="w"> </span><span class="m">161280</span><span class="p">,</span><span class="w"> </span><span class="m">812851200</span><span class="p">)[</span><span class="n">squaresize</span><span class="p">]</span><span class="w">

</span><span class="c1"># Generate the squares
</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">latinsquare</span><span class="p">(</span><span class="n">squaresize</span><span class="p">,</span><span class="w"> </span><span class="n">numsquares</span><span class="p">,</span><span class="w"> </span><span class="n">seed</span><span class="o">=</span><span class="m">122</span><span class="p">,</span><span class="w"> </span><span class="n">returnstrings</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Get the list of all squares and counts for each
</span><span class="n">slist</span><span class="w">   </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rle</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w">
</span><span class="n">scounts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">slist</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">

</span><span class="n">hist</span><span class="p">(</span><span class="n">scounts</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">scounts</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">scounts</span><span class="p">)</span><span class="m">+1</span><span class="p">)</span><span class="m">-.5</span><span class="p">))</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"Expected and actual standard deviation: %.4f, %.4f\n"</span><span class="p">,</span><span class="w">
        </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">numsquares</span><span class="o">/</span><span class="n">uniquesquares</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">scounts</span><span class="p">)</span><span class="w"> </span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; Expected and actual standard deviation: 4.1667, 4.0883
</span></code></pre>
</div>

<p><img src="http://www.cookbook-r.com/Tools_for_experiments/Generating_counterbalanced_orders/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3"></p>
</article>
<br>
<br>
<br>
<br>

</body></html>