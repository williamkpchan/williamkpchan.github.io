<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<style>

a:hover,a:active{color:red}
table.w3-table-all{margin:20px 0}
.top {
 position:relative;
 background-color:black;
 height:68px;
 padding-top:20px;
 line-height:50px;
 overflow:hidden;
 z-index:2;
}
body {
 background-color: #000000;
 color: MediumSeaGreen;
 margin-left: 14%;
 margin-right: 14%;
 font-size: 24px;
}
a { text-decoration: none;
	color: #58D858;}
a:visited { color: #88C898;}
A:hover {	color: yellow;}
A:focus {	color: red;}
code { color: gray; background-color: #001010; font-size: 18px;}
pre { color: gray; background-color: #001000; font-size: 18px;}
h1, h2, h3, h4, h5, .goldword {
	color: gold;
}
table{
	width: 100%;
	font-size: 20px;
	border-collapse: collapse;
	border: 1px solid gray;
}
th{
	border: 1px solid gray;
	font-weight:bold;
	color: lightgreen;
}
td{
	padding:10px;
	border: 1px dotted dimgray;
}}
tr>th:first-child{
	width:40%;
}
tr>td:first-child{
	color: lime;

}

strong, .topic{
    color: lime;
}
.left {
    position: absolute;
    left: 100px;
    color: GoldenRod;
    border: 1px solid GoldenRod;
    padding: 2px;
    font-size: 60%;
}
.bord {
    color: redpink;
    border: 1px solid GoldenRod;
    padding: 1px;
    font-size: 90%;
}
.highlight { 
    color: white;
    background-color: #002030
  }
.row-even {background-color: #001810;}
.reference.external{color: gold;}
hr {width: 50%;}
li{
	list-style-type: decimal;
}
#toc, #tang, #san, #pill {
	margin-left: 10%;
	margin-right: 10%;
	color: gold;
	padding: 1%;
	text-align: left;
	box-shadow: 5px 5px 15px silver;
	border-radius: 5px;
	border: 1px solid DarkSlateGray;
    font-size: 90%;
}
.mywords{
    color: Crimson;
}
.orangeword, .kt{
    color: orange;
}
.redword, .kp{
    color: pink;
}
.o{
    color: yellow;
}
.s, em{
    color: lightblue;
}
.remarks {
	font-size: 22px;
	color: MediumSeaGreen;
}
</STYLE>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
</script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, .topic').click(function(){
    parent.history.back();
    return false;
    });
});
</script>


</head><body>

<center><h1>cyclismo R tutorial</h1></center>
<div id="toc"><ul></ul></div>
<br>
<br>
<br>
<h2></h2>
<h2>1. Input</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#assignment" id="id2">Assignment</a></li>
<li><a href="#reading-a-csv-file" id="id3">Reading a CSV file</a></li>
<li><a href="#brief-note-on-fixed-width-files" id="id4">Brief Note on Fixed Width Files</a></li>
</ul>
</div>
<p>Here we explore how to define a data set in an R session. Only two
commands are explored. The first is for simple assignment of data, and
the second is for reading in a data file. There are many ways to read
data into an R session, but we focus on just two to keep it simple.</p>
<div class="section" id="assignment">
<span id="basicassignment"></span><h3><a class="toc-backref" href="#id2">1.1. Assignment</a></h3>
<p>The most straight forward way to store a list of numbers is through an
assignment using the c command. (c stands for &#8220;combine.&#8221;) The idea is
that a list of numbers is stored under a given name, and the name is
used to refer to the data. A list is specified with the c command, and
assignment is specified with the &#8220;&lt;-&#8221; symbols. Another term used to
describe the list of numbers is to call it a &#8220;vector.&#8221;</p>
<p>The numbers within the c command are separated by commas. As an
example, we can create a new variable, called &#8220;bubba&#8221; which will
contain the numbers 3, 5, 7, and 9:</p>
<div class="highlight-rconsole" id="listing-simpleassignment"><span id="index-0"></span><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">9</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>When you enter this command you should not see any output except a new
command line. The command creates a list of numbers called &#8220;bubba.&#8221; To
see what numbers is included in bubba type &#8220;bubba&#8221; and press the enter
key:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba
<span class="go">[1] 3 5 7 9</span>
</pre></div>
</div>
<p>If you wish to work with one of the numbers you can get access to it
using the variable and then square brackets indicating which number:</p>
<div class="highlight-rconsole" id="index-1"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba<span class="p">[</span><span class="m">2</span><span class="p">]</span>
<span class="go">[1] 5</span>
<span class="gp">&gt; </span>bubba<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">[1] 3</span>
<span class="gp">&gt; </span>bubba<span class="p">[</span><span class="m">0</span><span class="p">]</span>
<span class="go">numeric(0)</span>
<span class="gp">&gt; </span>bubba<span class="p">[</span><span class="m">3</span><span class="p">]</span>
<span class="go">[1] 7</span>
<span class="gp">&gt; </span>bubba<span class="p">[</span><span class="m">4</span><span class="p">]</span>
<span class="go">[1] 9</span>
</pre></div>
</div>
<p>Notice that the first entry is referred to as the number 1 entry, and
the zero entry can be used to indicate how the computer will treat the
data. You can store strings using both single and double quotes, and
you can store real numbers.</p>
<p>You now have a list of numbers and are ready to explore. In the
chapters that follow we will examine the basic operations in R that
will allow you to do some of the analyses required in class.</p>
</div>
<div class="section" id="reading-a-csv-file">
<h3><a class="toc-backref" href="#id3">1.2. Reading a CSV file</a></h3>
<p>Unfortunately, it is rare to have just a few data points that you do
not mind typing in at the prompt. It is much more common to have a lot
of data points with complicated relationships. Here we will examine
how to read a data set from a file using the read.csv function but
first discuss the format of a data file.</p>
<p>We assume that the data file is in the format called &#8220;comma separated
values&#8221; (csv). That is, each line contains a row of values which can
be numbers or letters, and each value is separated by a comma. We also
assume that the very first row contains a list of labels. The idea is
that the labels in the top row are used to refer to the different
columns of values.</p>
<p>First we read a very short, somewhat silly, data file. The data file
is called <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/simple.csv">simple.csv</a> and has three columns of
data and six rows. The three columns are labeled &#8220;trial,&#8221; &#8220;mass,&#8221; and
&#8220;velocity.&#8221; We can pretend that each row comes from an observation
during one of two trials labeled &#8220;A&#8221; and &#8220;B.&#8221; A copy of the data file
is shown below and is created in defiance of Werner Heisenberg:</p>
<table border="1" class="docutils" id="id1">
<span id="index-2"></span><caption><span class="caption-text">silly.csv</span><a class="headerlink" href="#id1" title="Permalink to this table">Â¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">trial</th>
<th class="head">mass</th>
<th class="head">velocity</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>A</td>
<td>10</td>
<td>12</td>
</tr>
<tr class="row-odd"><td>A</td>
<td>11</td>
<td>14</td>
</tr>
<tr class="row-even"><td>B</td>
<td>5</td>
<td>8</td>
</tr>
<tr class="row-odd"><td>B</td>
<td>6</td>
<td>10</td>
</tr>
<tr class="row-even"><td>A</td>
<td>10.5</td>
<td>13</td>
</tr>
<tr class="row-odd"><td>B</td>
<td>7</td>
<td>11</td>
</tr>
</tbody>
</table>
<p>The command to read the data file is <em>read.csv</em>. We have to give the
command at least one arguments, but we will give three different
arguments to indicate how the command can be used in different
situations. The first argument is the name of file. The second
argument indicates whether or not the first row is a set of
labels. The third argument indicates that there is a comma between
each number of each line. The following command will read in the data
and assign it to a variable called &#8220;heisenberg:&#8221;</p>
<span class="target" id="index-3"></span><div class="highlight-rconsole" id="index-4"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>heisenberg <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;simple.csv&quot;</span><span class="p">,</span>head<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>heisenberg
<span class="go">trial mass velocity</span>
<span class="go">1     A 10.0       12</span>
<span class="go">2     A 11.0       14</span>
<span class="go">3     B  5.0        8</span>
<span class="go">4     B  6.0       10</span>
<span class="go">5     A 10.5       13</span>
<span class="go">6     B  7.0       11</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>heisenberg<span class="p">)</span>
<span class="go">trial      mass          velocity</span>
<span class="go">A:3   Min.   : 5.00   Min.   : 8.00</span>
<span class="go">B:3   1st Bu.: 6.25   1st Qu.:10.25</span>
<span class="go">      Median : 8.50   Median :11.50</span>
<span class="go">      Mean   : 8.25   Mean   :11.33</span>
<span class="go">      3rd Qu.:10.38   3rd Qu.:12.75</span>
<span class="go">      Max.   :11.00   Max.   :14.00</span>
</pre></div>
</div>
<p>(Note that if you are using a Microsoft system the file naming
convention is different from what we use here. If you want to use a
backslash it needs to be escaped, i.e. use two backslashes together
&#8220;\.&#8221; Also you can specify what folder to use by clicking on the
&#8220;File&#8221; option in the main menu and choose the option to specify your
working directory.)</p>
<p>To get more information on the different options available you can use
the help command:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>read.csv<span class="p">)</span>
</pre></div>
</div>
<p>If R is not finding the file you are trying to read then it may
be looking in the wrong folder/directory. If you are using the
graphical interface you can change the working directory from
the file menu. If you are not sure what files are in the current
working directory you can use the <em>dir()</em> command to list the files
and the <em>getwd()</em> command to determine the current working directory:</p>
<div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">dir</span><span class="p">()</span>
<span class="go">[1] &quot;fixedWidth.dat&quot; &quot;simple.csv&quot;     &quot;trees91.csv&quot;    &quot;trees91.wk1&quot;</span>
<span class="go">[5] &quot;w1.dat&quot;</span>
<span class="gp">&gt; </span><span class="kp">getwd</span><span class="p">()</span>
<span class="go">[1] &quot;/home/black/write/class/stat/stat383-13F/dat&quot;</span>
</pre></div>
</div>
<p>The variable &#8220;heisenberg&#8221; contains the three columns of data. Each
column is assigned a name based on the header (the first line in the
file). You can now access each individual column using a &#8220;$&#8221; to
separate the two names:</p>
<div class="highlight-rconsole" id="index-6"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>heisenberg<span class="o">$</span>trial
<span class="go">[1] A A B B A B</span>
<span class="go">Levels: A B</span>
<span class="gp">&gt; </span>heisenberg<span class="o">$</span>mass
<span class="go">[1] 10.0 11.0  5.0  6.0 10.5  7.0</span>
<span class="gp">&gt; </span>heisenberg<span class="o">$</span>velocity
<span class="go">[1] 12 14  8 10 13 11</span>
</pre></div>
</div>
<p>If you are not sure what columns are contained in the variable you can
use the names command:</p>
<div class="highlight-rconsole" id="index-7"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>heisenberg<span class="p">)</span>
<span class="go">[1] &quot;trial&quot;    &quot;mass&quot;     &quot;velocity&quot;</span>
</pre></div>
</div>
<p>We will look at another example which is used throughout this
tutorial. The data file was created by a group at Oak Ridge National Laboratory,
and I converted it to a CSV file to make it easier to work with.
The original data is given in an excel spreadsheet, and the CSV file,
<a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/trees91.csv">trees91.csv</a> , was created
by deleting the top set of
rows and saving it as a &#8220;csv&#8221; file. This is an option to save within
excel. (You should save the file on your computer.) It is a good idea
to open this file in a spreadsheet and look at it. This will help you
make sense of how R stores the data.</p>
<p>The original spreadsheet is located at
<a class="reference external" href="http://www.cyclismo.org/tutorial/R/http://cdiac.ornl.gov/ftp/ndp061a/trees91.wk1">http://cdiac.ornl.gov/ftp/ndp061a/trees91.wk1</a> .
A description of the data file is located at
<a class="reference external" href="http://www.cyclismo.org/tutorial/R/http://cdiac.ornl.gov/ftp/ndp061a/ndp061a.txt">http://cdiac.ornl.gov/ftp/ndp061a/ndp061a.txt</a> .</p>
<p>The data is used to indicate an estimate of biomass of ponderosa pine
in a study performed by Dale W. Johnson, J. Timothy Ball, and
Roger F. Walker who are associated with the Biological Sciences
Center, Desert Research Institute, P.O. Box 60220, Reno, NV 89506 and
the Environmental and Resource Sciences College of Agriculture,
University of Nevada, Reno, NV 89512. The data is consists of 54
lines, and each line represents an observation. Each observation
includes measurements and markers for 28 different measurements of a
given tree. For example, the first number in each row is a number,
either 1, 2, 3, or 4, which signifies a different level of exposure to
carbon dioxide. The sixth number in every row is an estimate of the
biomass of the stems of a tree. Note that the very first line in the
file is a list of labels used for the different columns of data.</p>
<p>The data can be read into a variable called &#8220;tree&#8221; in using the
read.csv command:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>tree <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;trees91.csv&quot;</span><span class="p">,</span>header<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This will create a new variable called &#8220;tree.&#8221; If you type in &#8220;tree&#8221;
at the prompt and hit enter, all of the numbers stored in the variable
will be printed out. Try this, and you should see that it is difficult
to make any sense out of the numbers.</p>
<p>There are many different ways to keep track of data in R. When you use
the <em>read.csv</em> command R uses a specific kind of variable called a
&#8220;data frame.&#8221; All of the data are stored within the data frame as
separate columns. If you are not sure what kind of variable you have
then you can use the attributes command. This will list all of the
things that R uses to describe the variable:</p>
<div class="highlight-rconsole" id="index-8"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">attributes</span><span class="p">(</span>tree<span class="p">)</span>
<span class="go">$names</span>
<span class="go">[1] &quot;C&quot;      &quot;N&quot;      &quot;CHBR&quot;   &quot;REP&quot;    &quot;LFBM&quot;   &quot;STBM&quot;   &quot;RTBM&quot;   &quot;LFNCC&quot;</span>
<span class="go">[9] &quot;STNCC&quot;  &quot;RTNCC&quot;  &quot;LFBCC&quot;  &quot;STBCC&quot;  &quot;RTBCC&quot;  &quot;LFCACC&quot; &quot;STCACC&quot; &quot;RTCACC&quot;</span>
<span class="go">[17] &quot;LFKCC&quot;  &quot;STKCC&quot;  &quot;RTKCC&quot;  &quot;LFMGCC&quot; &quot;STMGCC&quot; &quot;RTMGCC&quot; &quot;LFPCC&quot;  &quot;STPCC&quot;</span>
<span class="go">[25] &quot;RTPCC&quot;  &quot;LFSCC&quot;  &quot;STSCC&quot;  &quot;RTSCC&quot;</span>

<span class="go">$class</span>
<span class="go">[1] &quot;data.frame&quot;</span>

<span class="go">$row.names</span>
<span class="go">[1] &quot;1&quot;  &quot;2&quot;  &quot;3&quot;  &quot;4&quot;  &quot;5&quot;  &quot;6&quot;  &quot;7&quot;  &quot;8&quot;  &quot;9&quot;  &quot;10&quot; &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot;</span>
<span class="go">[16] &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;20&quot; &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;30&quot;</span>
<span class="go">[31] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;40&quot; &quot;41&quot; &quot;42&quot; &quot;43&quot; &quot;44&quot; &quot;45&quot;</span>
<span class="go">[46] &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;50&quot; &quot;51&quot; &quot;52&quot; &quot;53&quot; &quot;54&quot;</span>
</pre></div>
</div>
<p>The first thing that R stores is a list of names which refer to each
column of the data. For example, the first column is called &#8220;C&#8221;, the
second column is called &#8220;N.&#8221; Tree is of type data.frame. Finally, the
rows are numbered consecutively from 1 to 54. Each column has 54
numbers in it.</p>
<p>If you know that a variable is a data frame but are not sure what
labels are used to refer to the different columns you can use the
names command:</p>
<div class="highlight-rconsole" id="index-9"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>tree<span class="p">)</span>
<span class="go">[1]  &quot;C&quot;      &quot;N&quot;      &quot;CHBR&quot;   &quot;REP&quot;    &quot;LFBM&quot;   &quot;STBM&quot;   &quot;RTBM&quot;   &quot;LFNCC&quot;</span>
<span class="go">[9]  &quot;STNCC&quot;  &quot;RTNCC&quot;  &quot;LFBCC&quot;  &quot;STBCC&quot;  &quot;RTBCC&quot;  &quot;LFCACC&quot; &quot;STCACC&quot; &quot;RTCACC&quot;</span>
<span class="go">[17] &quot;LFKCC&quot;  &quot;STKCC&quot;  &quot;RTKCC&quot;  &quot;LFMGCC&quot; &quot;STMGCC&quot; &quot;RTMGCC&quot; &quot;LFPCC&quot;  &quot;STPCC&quot;</span>
<span class="go">[25] &quot;RTPCC&quot;  &quot;LFSCC&quot;  &quot;STSCC&quot;  &quot;RTSCC&quot;</span>
</pre></div>
</div>
<p>If you want to work with the data in one of the columns you give the
name of the data frame, a &#8220;$&#8221; sign, and the label assigned to the
column. For example, the first column in tree can be called using
&#8220;tree$C:&#8221;</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>tree<span class="o">$</span>C
<span class="go">[1]  1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3</span>
<span class="go">[39] 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4</span>
</pre></div>
</div>
</div>
<div class="section" id="brief-note-on-fixed-width-files">
<h3><a class="toc-backref" href="#id4">1.3. Brief Note on Fixed Width Files</a></h3>
<p id="index-10">There are many ways to read data using R. We only give two examples,
direct assignment and reading csv files. However, another way deserves
a brief mention. It is common to come across data that is organized in
flat files and delimited at preset locations on each line. This is
often called a &#8220;fixed width file.&#8221;</p>
<p>The command to deal with these kind of files is <em>read.fwf</em>. Examples of
how to use this command are not explored here, but a brief example is
given.  If you would like more information on how to use this command
enter the following command:</p>
<div class="highlight-rconsole" id="index-11"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>read.fwf<span class="p">)</span>
</pre></div>
</div>
<p>The <em>read.fwf</em> command requires at least two options. The first is the
name of the file and the second is a list of numbers that gives the
length of each column in the data file. A negative number in the list
indicates that the column should be skipped. Here we give the command
to read the data file <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/fixedWidth.dat">fixedWidth.dat</a> . In
this data file there are three columns. The first colum is 17
characters wide, the second column is 15 characters wide, and the last
column is 7 characters wide. In the example below we use the optional
<em>col.names</em> option to specify the names of the columns:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="go"> &gt; a = read.fwf(&#39;fixedWidth.dat&#39;,widths=c(-17,15,7),col.names=c(&#39;temp&#39;,&#39;offices&#39;))</span>
<span class="go"> &gt; a</span>
<span class="go">  temp offices</span>
<span class="go">1 17.0      35</span>
<span class="go">2 18.0     117</span>
<span class="go">3 17.5      19</span>
<span class="go">4 17.5      28</span>
</pre></div>
</div>


<h2></h2>
<h2>2. Basic Data Types</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#variable-types" id="id1">Variable Types</a></li>
<li><a href="#tables" id="id2">Tables</a></li>
</ul>
</div>
<p>We look at some of the ways that R can store and organize data. This
is a basic introduction to a small subset of the different data types
recognized by R and is not comprehensive in any sense. The main goal
is to demonstrate the different kinds of information R can handle. It
is assumed that you know how to enter data or read data files which is
covered in the first chapter.</p>
<div class="section" id="variable-types">
<h3><a class="toc-backref" href="#id1">2.1. Variable Types</a></h3>
<div class="section" id="numbers">
<h4>2.1.1. Numbers</h4>
<p id="index-0">The way to work with real numbers has already been covered in the
first chapter and is briefly discussed here. The most basic way to
store a number is to make an assignment of a single number:</p>
<span class="target" id="index-1"></span><div class="highlight-rconsole" id="index-2"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="m">3</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>The &#8220;&lt;-&#8221; tells R to take the number to the right of the symbol and
store it in a variable whose name is given on the left. You can also
use the &#8220;=&#8221; symbol. When you make an assignment R does not print out
any information. If you want to see what value a variable has just
type the name of the variable on a line and press the enter key:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a
<span class="go">[1] 3</span>
</pre></div>
</div>
<p>This allows you to do all sorts of basic operations and save the numbers:</p>
<div class="highlight-rconsole" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kp">sqrt</span><span class="p">(</span>a<span class="o">*</span>a<span class="m">+3</span><span class="p">)</span>
<span class="gp">&gt; </span>b
<span class="go">[1] 3.464102</span>
</pre></div>
</div>
<p>If you want to get a list of the variables that you have defined in a
particular session you can list them all using the ls command:</p>
<div class="highlight-rconsole" id="index-4"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">ls</span><span class="p">()</span>
<span class="go">[1] &quot;a&quot; &quot;b&quot;</span>
</pre></div>
</div>
<p>You are not limited to just saving a single number. You can create a
list (also called a &#8220;vector&#8221;) using the c command:</p>
<span class="target" id="index-5"></span><div class="highlight-rconsole" id="index-6"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">[1] 1 2 3 4 5</span>
<span class="gp">&gt; </span>a<span class="m">+1</span>
<span class="go">[1] 2 3 4 5 6</span>
<span class="gp">&gt; </span><span class="kp">mean</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 3</span>
<span class="gp">&gt; </span>var<span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 2.5</span>
</pre></div>
</div>
<span class="target" id="index-7"></span><span class="target" id="index-8"></span><p id="index-9">You can get access to particular entries in the vector in the following manner:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>a<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">[1] 1</span>
<span class="gp">&gt; </span>a<span class="p">[</span><span class="m">2</span><span class="p">]</span>
<span class="go">[1] 2</span>
<span class="gp">&gt; </span>a<span class="p">[</span><span class="m">0</span><span class="p">]</span>
<span class="go">numeric(0)</span>
<span class="gp">&gt; </span>a<span class="p">[</span><span class="m">5</span><span class="p">]</span>
<span class="go">[1] 5</span>
<span class="gp">&gt; </span>a<span class="p">[</span><span class="m">6</span><span class="p">]</span>
<span class="go">[1] NA</span>
</pre></div>
</div>
<p>Note that the zero entry is used to indicate how the data is
stored. The first entry in the vector is the first number, and if you
try to get a number past the last number you get &#8220;NA.&#8221;</p>
<p>Examples of the sort of operations you can do on vectors is given in a
next chapter.</p>
<p>To initialize a list of numbers the <em>numeric</em> command can be used. For
example, to create a list of 10 numbers, initialized to zero, use the
following command:</p>
<div class="highlight-rconsole" id="index-10"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">numeric</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">[1] 0 0 0 0 0 0 0 0 0 0</span>
</pre></div>
</div>
<p>If you wish to determine the data type used for a variable the <em>type</em>
command:</p>
<div class="highlight-rconsole" id="index-11"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="strings">
<h4>2.1.2. Strings</h4>
<p id="index-12">You are not limited to just storing numbers. You can also store
strings. A string is specified by using quotes. Both single and double
quotes will work:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="s">&quot;hello&quot;</span>
<span class="gp">&gt; </span>a
<span class="go">[1] &quot;hello&quot;</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="s">&quot;there&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>b
<span class="go">[1] &quot;hello&quot; &quot;there&quot;</span>
<span class="gp">&gt; </span>b<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">[1] &quot;hello&quot;</span>
</pre></div>
</div>
<p>The name of the type given to strings is <em>character</em>,</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] &quot;character&quot;</span>
<span class="gp">&gt; </span>a <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="m">20</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">[1] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="factors">
<h4>2.1.3. Factors</h4>
<p id="index-13">Another important way R can store data is as a factor. Often times an
experiment includes trials for different levels of some explanatory
variable. For example, when looking at the impact of carbon dioxide on
the growth rate of a tree you might try to observe how different trees
grow when exposed to different preset concentrations of carbon
dioxide. The different levels are also called factors.</p>
<p>Assuming you know how to read in a file, we will look at the data file
given in the first chapter. Several of the variables in the file are
factors:</p>
<span class="target" id="index-14"></span><div class="highlight-rconsole" id="index-15"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>tree<span class="o">$</span>CHBR<span class="p">)</span>
<span class="go">A1  A2  A3  A4  A5  A6  A7  B1  B2  B3  B4  B5  B6  B7  C1  C2  C3  C4  C5  C6</span>
<span class="go">3   1   1   3   1   3   1   1   3   3   3   3   3   3   1   3   1   3   1   1</span>
<span class="go">C7 CL6 CL7  D1  D2  D3  D4  D5  D6  D7</span>
<span class="go">1   1   1   1   1   3   1   1   1   1</span>
</pre></div>
</div>
<p>Because the set of options given in the data file corresponding to the
&#8220;CHBR&#8221; column are not all numbers R automatically assumes that it is a
factor. When you use summary on a factor it does not print out the
five point summary, rather it prints out the possible values and the
frequency that they occur.</p>
<p>In this data set several of the columns are factors, but the
researchers used numbers to indicate the different levels. For
example, the first column, labeled &#8220;C,&#8221; is a factor. Each trees was
grown in an environment with one of four different possible levels of
carbon dioxide. The researchers quite sensibly labeled these four
environments as 1, 2, 3, and 4. Unfortunately, R cannot determine that
these are factors and must assume that they are regular numbers.</p>
<p>This is a common problem and there is a way to tell R to treat the &#8220;C&#8221;
column as a set of factors. You specify that a variable is a factor
using the factor command. In the following example we convert tree$C
into a factor:</p>
<span class="target" id="index-16"></span><div class="highlight-rconsole" id="index-17"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>tree<span class="o">$</span>C
<span class="go">[1]  1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3</span>
<span class="go">[39] 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>tree<span class="o">$</span>C<span class="p">)</span>
<span class="go">   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">  1.000   2.000   2.000   2.519   3.000   4.000</span>
<span class="gp">&gt; </span>tree<span class="o">$</span>C <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>tree<span class="o">$</span>C<span class="p">)</span>
<span class="gp">&gt; </span>tree<span class="o">$</span>C
<span class="go">[1]  1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3</span>
<span class="go">[39] 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4</span>
<span class="go">Levels: 1 2 3 4</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>tree<span class="o">$</span>C<span class="p">)</span>
<span class="go">1  2  3  4</span>
<span class="go">8 23 10 13</span>
<span class="gp">&gt; </span><span class="kp">levels</span><span class="p">(</span>tree<span class="o">$</span>C<span class="p">)</span>
<span class="go">[1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot;</span>
</pre></div>
</div>
<p>Once a vector is converted into a set of factors then R treats it
differently. A set of factors have a discrete set of possible values,
and it does not make sense to try to find averages or other numerical
descriptions. One thing that is important is the number of times that
each factor appears, called their &#8220;frequencies,&#8221; which is printed
using the summary command.</p>
</div>
<div class="section" id="data-frames">
<h4>2.1.4. Data Frames</h4>
<p id="index-18">Another way that information is stored is in data frames. This is a
way to take many vectors of different types and store them in the same
variable. The vectors can be of all different types. For example, a
data frame may contain many lists, and each list might be a list of
factors, strings, or numbers.</p>
<p>There are different ways to create and manipulate data frames. Most
are beyond the scope of this introduction. They are only mentioned
here to offer a more complete description. Please see the first
chapter for more information on data frames.</p>
<p>One example of how to create a data frame is given below:</p>
<div class="highlight-rconsole" id="index-19"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">8</span><span class="p">)</span>
<span class="gp">&gt; </span>levels <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">))</span>
<span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>first<span class="o">=</span>a<span class="p">,</span>
<span class="go">                      second=b,</span>
<span class="go">                      f=levels)</span>
<span class="gp">&gt; </span>bubba
<span class="go">first second f</span>
<span class="go">1     1      2 A</span>
<span class="go">2     2      4 B</span>
<span class="go">3     3      6 A</span>
<span class="go">4     4      8 B</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>bubba<span class="p">)</span>
<span class="go">    first          second    f</span>
<span class="go">Min.   :1.00   Min.   :2.0   A:2</span>
<span class="go">1st Qu.:1.75   1st Qu.:3.5   B:2</span>
<span class="go">Median :2.50   Median :5.0</span>
<span class="go">Mean   :2.50   Mean   :5.0</span>
<span class="go">3rd Qu.:3.25   3rd Qu.:6.5</span>
<span class="go">Max.   :4.00   Max.   :8.0</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>first
<span class="go">[1] 1 2 3 4</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>second
<span class="go">[1] 2 4 6 8</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>f
<span class="go">[1] A B A B</span>
<span class="go">Levels: A B</span>
</pre></div>
</div>
</div>
<div class="section" id="logical">
<span id="logicaloperators"></span>
<h4>2.1.5. Logical</h4>
<p>Another important data type is the logical type. There are two
predefined variables, <em>TRUE</em> and <em>FALSE</em>:</p>
<span class="target" id="index-20"></span><span class="target" id="index-21"></span><div class="highlight-rconsole" id="index-22"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">=</span> <span class="kc">TRUE</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] &quot;logical&quot;</span>
<span class="gp">&gt; </span>b <span class="o">=</span> <span class="kc">FALSE</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>b<span class="p">)</span>
<span class="go">[1] &quot;logical&quot;</span>
</pre></div>
</div>
<p>The standard logical operators can be used:</p>
<table border="1" class="docutils" id="index-23">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&lt;</td>
<td>less
than</td>
</tr>
<tr class="row-even"><td>&gt;</td>
<td>great
than</td>
</tr>
<tr class="row-odd"><td>&lt;=</td>
<td>less
than or
equal</td>
</tr>
<tr class="row-even"><td>&gt;=</td>
<td>greater
than or
equal</td>
</tr>
<tr class="row-odd"><td>==</td>
<td>equal
to</td>
</tr>
<tr class="row-even"><td>!=</td>
<td>not
equal
to</td>
</tr>
<tr class="row-odd"><td>|</td>
<td>entry
wise or</td>
</tr>
<tr class="row-even"><td>||</td>
<td>or</td>
</tr>
<tr class="row-odd"><td>!</td>
<td>not</td>
</tr>
<tr class="row-even"><td>&amp;</td>
<td>entry
wise and</td>
</tr>
<tr class="row-odd"><td>&amp;&amp;</td>
<td>and</td>
</tr>
<tr class="row-even"><td>xor(a,b)</td>
<td>exclusive
or</td>
</tr>
</tbody>
</table>
<p>Note that there is a difference between operators that act on entries
within a vector and the whole vector:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="gp">&gt; </span>b <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="gp">&gt; </span>a<span class="o">|</span>b
<span class="go">[1]  TRUE FALSE</span>
<span class="gp">&gt; </span>a<span class="o">||</span>b
<span class="go">[1] TRUE</span>
<span class="gp">&gt; </span><span class="kp">xor</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">)</span>
<span class="go">[1]  TRUE FALSE</span>
</pre></div>
</div>
<p>There are a large number of functions that test to determine the type
of a variable. For example the <em>is.numeric</em> function can determine if
a variable is numeric:</p>
<span class="target" id="index-24"></span><div class="highlight-rconsole" id="index-25"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">is.numeric</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] TRUE</span>
<span class="gp">&gt; </span><span class="kp">is.factor</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] FALSE</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tables">
<h3><a class="toc-backref" href="#id2">2.2. Tables</a></h3>
<p id="index-26">Another common way to store information is in a table. Here we look at
how to define both one way and two way tables. We only look at how to
create and define tables; the functions used in the analysis of
proportions are examined in another chapter.</p>
<div class="section" id="one-way-tables">
<h4>2.2.1. One Way Tables</h4>
<p id="index-27">The first example is for a one way table. One way tables are not the
most interesting example, but it is a good place to start. One way to
create a table is using the table command. The arguments it takes is a
vector of factors, and it calculates the frequency that each factor
occurs. Here is an example of how to create a one way table:</p>
<div class="highlight-rconsole" id="index-28"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;C&quot;</span><span class="p">))</span>
<span class="gp">&gt; </span>results <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>a<span class="p">)</span>
<span class="gp">&gt; </span>results
<span class="go">a</span>
<span class="go">A B C</span>
<span class="go">4 3 2</span>
<span class="gp">&gt; </span><span class="kp">attributes</span><span class="p">(</span>results<span class="p">)</span>
<span class="go">$dim</span>
<span class="go">[1] 3</span>

<span class="go">$dimnames</span>
<span class="go">$dimnames$a</span>
<span class="go">[1] &quot;A&quot; &quot;B&quot; &quot;C&quot;</span>


<span class="go">$class</span>
<span class="go">[1] &quot;table&quot;</span>

<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>results<span class="p">)</span>
<span class="go">Number of cases in table: 9</span>
<span class="go">Number of factors: 1</span>
</pre></div>
</div>
<p>If you know the number of occurrences for each factor then it is
possible to create the table directly, but the process is,
unfortunately, a bit more convoluted. There is an easier way to define
one-way tables (a table with one row), but it does not extend easily
to two-way tables (tables with more than one row). You must first
create a matrix of numbers. A matrix is like a vector in that it is a
list of numbers, but it is different in that you can have both rows
and columns of numbers. For example, in our example above the number
of occurrences of &#8220;A&#8221; is 4, the number of occurrences of &#8220;B&#8221; is 3, and
the number of occurrences of &#8220;C&#8221; is 2. We will create one row of
numbers. The first column contains a 4, the second column contains a
3, and the third column contains a 2:</p>
<div class="highlight-rconsole" id="index-29"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>occur <span class="o">&lt;-</span> <span class="kt">matrix</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">),</span>ncol<span class="o">=</span><span class="m">3</span><span class="p">,</span>byrow<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span>occur
<span class="go">     [,1] [,2] [,3]</span>
<span class="go">[1,]    4    3    2</span>
</pre></div>
</div>
<p>At this point the variable &#8220;occur&#8221; is a matrix with one row and three
columns of numbers. To dress it up and use it as a table we would like
to give it labels for each columns just like in the previous
example. Once that is done we convert the matrix to a table using the
as.table command:</p>
<span class="target" id="index-30"></span><span class="target" id="index-31"></span><span class="target" id="index-32"></span><div class="highlight-rconsole" id="index-33"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">colnames</span><span class="p">(</span>occur<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="s">&quot;C&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>occur
<span class="go">     A B C</span>
<span class="go">[1,] 4 3 2</span>
<span class="gp">&gt; </span>occur <span class="o">&lt;-</span> <span class="kp">as.table</span><span class="p">(</span>occur<span class="p">)</span>
<span class="gp">&gt; </span>occur
<span class="go">  A B C</span>
<span class="go">A 4 3 2</span>
<span class="gp">&gt; </span><span class="kp">attributes</span><span class="p">(</span>occur<span class="p">)</span>
<span class="go">$dim</span>
<span class="go">[1] 1 3</span>

<span class="go">$dimnames</span>
<span class="go">$dimnames[[1]]</span>
<span class="go">[1] &quot;A&quot;</span>

<span class="go">$dimnames[[2]]</span>
<span class="go">[1] &quot;A&quot; &quot;B&quot; &quot;C&quot;</span>


<span class="go">$class</span>
<span class="go">[1] &quot;table&quot;</span>

</pre></div>
</div>
</div>
<div class="section" id="two-way-tables">
<h4>2.2.2. Two Way Tables</h4>
<p id="index-34">If you want to add rows to your table just add another vector to the
argument of the table command. In the example below we have two
questions. In the first question the responses are labeled &#8220;Never,&#8221;
&#8220;Sometimes,&#8221; or &#8220;Always.&#8221; In the second question the responses are
labeled &#8220;Yes,&#8221; &#8220;No,&#8221; or &#8220;Maybe.&#8221; The set of vectors &#8220;a,&#8221; and &#8220;b,&#8221;
contain the response for each measurement. The third item in &#8220;a&#8221; is
how the third person responded to the first question, and the third
item in &#8220;b&#8221; is how the third person responded to the second question.</p>
<div class="highlight-rconsole" id="index-35"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Sometimes&quot;</span><span class="p">,</span><span class="s">&quot;Sometimes&quot;</span><span class="p">,</span><span class="s">&quot;Never&quot;</span><span class="p">,</span><span class="s">&quot;Always&quot;</span><span class="p">,</span><span class="s">&quot;Always&quot;</span><span class="p">,</span><span class="s">&quot;Sometimes&quot;</span><span class="p">,</span><span class="s">&quot;Sometimes&quot;</span><span class="p">,</span><span class="s">&quot;Never&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Maybe&quot;</span><span class="p">,</span><span class="s">&quot;Maybe&quot;</span><span class="p">,</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span><span class="s">&quot;Maybe&quot;</span><span class="p">,</span><span class="s">&quot;Maybe&quot;</span><span class="p">,</span><span class="s">&quot;No&quot;</span><span class="p">,</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span><span class="s">&quot;No&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>results <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">)</span>
<span class="gp">&gt; </span>results
<span class="go">           b</span>
<span class="go">a           Maybe No Yes</span>
<span class="go">  Always        2  0   0</span>
<span class="go">  Never         0  1   1</span>
<span class="go">  Sometimes     2  1   1</span>
</pre></div>
</div>
<p>The table command allows us to do a very quick calculation, and we can
immediately see that two people who said &#8220;Maybe&#8221; to the first question
also said &#8220;Sometimes&#8221; to the second question.</p>
<p>Just as in the case with one-way tables it is possible to manually
enter two way tables. The procedure is exactly the same as above
except that we now have more than one row. We give a brief example
below to demonstrate how to enter a two-way table that includes
breakdown of a group of people by both their gender and whether or not
they smoke. You enter all of the data as one long list but tell R to
break it up into some number of columns:</p>
<span class="target" id="index-36"></span><div class="highlight-rconsole" id="index-37"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>sexsmoke<span class="o">&lt;-</span><span class="kt">matrix</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">70</span><span class="p">,</span><span class="m">120</span><span class="p">,</span><span class="m">65</span><span class="p">,</span><span class="m">140</span><span class="p">),</span>ncol<span class="o">=</span><span class="m">2</span><span class="p">,</span>byrow<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">rownames</span><span class="p">(</span>sexsmoke<span class="p">)</span><span class="o">&lt;-</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;male&quot;</span><span class="p">,</span><span class="s">&quot;female&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">colnames</span><span class="p">(</span>sexsmoke<span class="p">)</span><span class="o">&lt;-</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;smoke&quot;</span><span class="p">,</span><span class="s">&quot;nosmoke&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>sexsmoke <span class="o">&lt;-</span> <span class="kp">as.table</span><span class="p">(</span>sexsmoke<span class="p">)</span>
<span class="gp">&gt; </span>sexsmoke
<span class="go">       smoke nosmoke</span>
<span class="go">male      70     120</span>
<span class="go">female    65     140</span>
</pre></div>
</div>
<p>The matrix command creates a two by two matrix. The <em>byrow=TRUE</em>
option indicates that the numbers are filled in across the rows first,
and the <em>ncols=2</em> indicates that there are two columns.</p>
</div>


<h2></h2>
<h2>3. Basic Operations and Numerical Descriptions</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#basic-operations" id="id1">Basic Operations</a></li>
<li><a href="#basic-numerical-descriptions" id="id2">Basic Numerical Descriptions</a></li>
<li><a href="#operations-on-vectors" id="id3">Operations on Vectors</a></li>
</ul>
</div>
<p>We look at some of the basic operations that you can perform on lists
of numbers. It is assumed that you know how to enter data or read data
files which is covered in the first chapter, and you know about the
basic data types.</p>
<div class="section" id="basic-operations">
<h3><a class="toc-backref" href="#id1">3.1. Basic Operations</a></h3>
<p>Once you have a vector (or a list of numbers) in memory most basic
operations are available. Most of the basic operations will act on a
whole vector and can be used to quickly perform a large number of
calculations with a single command. There is one thing to note, if you
perform an operation on more than one vector it is often necessary
that the vectors all contain the same number of entries.</p>
<p>Here we first define a vector which we will call &#8220;a&#8221; and will look at
how to add and subtract constant numbers from all of the numbers in
the vector. First, the vector will contain the numbers 1, 2, 3,
and 4. We then see how to add 5 to each of the numbers, subtract 10
from each of the numbers, multiply each number by 4, and divide each
number by 5.</p>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">[1] 1 2 3 4</span>
<span class="gp">&gt; </span>a <span class="o">+</span> <span class="m">5</span>
<span class="go">[1] 6 7 8 9</span>
<span class="gp">&gt; </span>a <span class="o">-</span> <span class="m">10</span>
<span class="go">[1] -9 -8 -7 -6</span>
<span class="gp">&gt; </span>a<span class="o">*</span><span class="m">4</span>
<span class="go">[1]  4  8 12 16</span>
<span class="gp">&gt; </span>a<span class="o">/</span><span class="m">5</span>
<span class="go">[1] 0.2 0.4 0.6 0.8</span>
</pre></div>
</div>
<p>We can save the results in another vector called <em>b</em>:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>b <span class="o">&lt;-</span> a <span class="o">-</span> <span class="m">10</span>
<span class="gp">&gt; </span>b
<span class="go">[1] -9 -8 -7 -6</span>
</pre></div>
</div>
<p>If you want to take the square root, find e raised to each number, the
logarithm, etc., then the usual commands can be used:</p>
<span class="target" id="index-6"></span><span class="target" id="index-7"></span><div class="highlight-rconsole" id="index-8"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">sqrt</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 1.000000 1.414214 1.732051 2.000000</span>
<span class="gp">&gt; </span><span class="kp">exp</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1]  2.718282  7.389056 20.085537 54.598150</span>
<span class="gp">&gt; </span><span class="kp">log</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 0.0000000 0.6931472 1.0986123 1.3862944</span>
<span class="gp">&gt; </span><span class="kp">exp</span><span class="p">(</span><span class="kp">log</span><span class="p">(</span>a<span class="p">))</span>
<span class="go">[1] 1 2 3 4</span>
</pre></div>
</div>
<p>By combining operations and using parentheses you can make more
complicated expressions:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kt">c</span> <span class="o">&lt;-</span> <span class="p">(</span>a <span class="o">+</span> <span class="kp">sqrt</span><span class="p">(</span>a<span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="kp">exp</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="m">+1</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kt">c</span>
<span class="go">[1] 0.2384058 0.4069842 0.5640743 0.7152175</span>
</pre></div>
</div>
<p>Note that you can do the same operations with vector arguments. For
example to add the elements in vector a to the elements in vector b
use the following command:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">+</span> b
<span class="go">[1] -8 -6 -4 -2</span>
</pre></div>
</div>
<p>The operation is performed on an element by element basis. Note this
is true for almost all of the basic functions. So you can bring
together all kinds of complicated expressions:</p>
<span class="target" id="index-9"></span><span class="target" id="index-10"></span><span class="target" id="index-11"></span><div class="highlight-rconsole" id="index-12"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a<span class="o">*</span>b
<span class="go">[1]  -9 -16 -21 -24</span>
<span class="gp">&gt; </span>a<span class="o">/</span>b
<span class="go">[1] -0.1111111 -0.2500000 -0.4285714 -0.6666667</span>
<span class="gp">&gt; </span><span class="p">(</span>a<span class="m">+3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="kp">sqrt</span><span class="p">(</span><span class="m">1</span><span class="o">-</span>b<span class="p">)</span><span class="o">*</span><span class="m">2-1</span><span class="p">)</span>
<span class="go">[1] 0.7512364 1.0000000 1.2884234 1.6311303</span>
</pre></div>
</div>
<p>You need to be careful of one thing. When you do operations on vectors
they are performed on an element by element basis. One ramification of
this is that all of the vectors in an expression must be the same
length. If the lengths of the vectors differ then you may get an error
message, or worse, a warning message and unpredictable results:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">)</span>
<span class="gp">&gt; </span>a<span class="o">+</span>b
<span class="go">[1] 11 13 15 14</span>
<span class="go">Warning message:</span>
<span class="go">longer object length</span>
<span class="go">        is not a multiple of shorter object length in: a + b</span>
</pre></div>
</div>
<p>As you work in R and create new vectors it can be easy to lose track
of what variables you have defined. To get a list of all of the
variables that have been defined use the ls() command:</p>
<div class="highlight-rconsole" id="index-13"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">ls</span><span class="p">()</span>
<span class="go">[1] &quot;a&quot;            &quot;b&quot;            &quot;bubba&quot;        &quot;c&quot;            &quot;last.warning&quot;</span>
<span class="go">[6] &quot;tree&quot;         &quot;trees&quot;</span>
</pre></div>
</div>
<p>Finally, you should keep in mind that the basic operations almost
always work on an element by element basis. There are rare exceptions
to this general rule. For example, if you look at the minimum of two
vectors using the min command you will get the minimum of all of the
numbers. There is a special command, called pmin, that may be the
command you want in some circumstances:</p>
<span class="target" id="index-14"></span><div class="highlight-rconsole" id="index-15"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">-2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">-4</span><span class="p">)</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">-3</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">min</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">)</span>
<span class="go">[1] -4</span>
<span class="gp">&gt; </span><span class="kp">pmin</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">)</span>
<span class="go">[1] -1 -2 -3 -4</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-numerical-descriptions">
<h3><a class="toc-backref" href="#id2">3.2. Basic Numerical Descriptions</a></h3>
<p>Given a vector of numbers there are some basic commands to make it
easier to get some of the basic numerical descriptions of a set of
numbers. Here we assume that you can read in the tree data that was
discussed in a previous chapter. It is assumed that it is stored in a
variable called <em>tree</em>:</p>
<span class="target" id="index-16"></span><div class="highlight-rconsole" id="index-17"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>tree <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;trees91.csv&quot;</span><span class="p">,</span>header<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">);</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>tree<span class="p">)</span>
<span class="go"> [1] &quot;C&quot;      &quot;N&quot;      &quot;CHBR&quot;   &quot;REP&quot;    &quot;LFBM&quot;   &quot;STBM&quot;   &quot;RTBM&quot;   &quot;LFNCC&quot;</span>
<span class="go"> [9] &quot;STNCC&quot;  &quot;RTNCC&quot;  &quot;LFBCC&quot;  &quot;STBCC&quot;  &quot;RTBCC&quot;  &quot;LFCACC&quot; &quot;STCACC&quot; &quot;RTCACC&quot;</span>
<span class="go">[17] &quot;LFKCC&quot;  &quot;STKCC&quot;  &quot;RTKCC&quot;  &quot;LFMGCC&quot; &quot;STMGCC&quot; &quot;RTMGCC&quot; &quot;LFPCC&quot;  &quot;STPCC&quot;</span>
<span class="go">[25] &quot;RTPCC&quot;  &quot;LFSCC&quot;  &quot;STSCC&quot;  &quot;RTSCC&quot;</span>
</pre></div>
</div>
<p>Each column in the data frame can be accessed as a vector. For example
the numbers associated with the leaf biomass (LFBM) can be found using
<em>tree$LFBM</em>:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>tree<span class="o">$</span>LFBM
<span class="go"> [1] 0.430 0.400 0.450 0.820 0.520 1.320 0.900 1.180 0.480 0.210 0.270 0.310</span>
<span class="go">[13] 0.650 0.180 0.520 0.300 0.580 0.480 0.580 0.580 0.410 0.480 1.760 1.210</span>
<span class="go">[25] 1.180 0.830 1.220 0.770 1.020 0.130 0.680 0.610 0.700 0.820 0.760 0.770</span>
<span class="go">[37] 1.690 1.480 0.740 1.240 1.120 0.750 0.390 0.870 0.410 0.560 0.550 0.670</span>
<span class="go">[49] 1.260 0.965 0.840 0.970 1.070 1.220</span>
</pre></div>
</div>
<p>The following commands can be used to get the mean, median, quantiles,
minimum, maximum, variance, and standard deviation of a set of
numbers:</p>
<span class="target" id="index-18"></span><span class="target" id="index-19"></span><span class="target" id="index-20"></span><span class="target" id="index-21"></span><span class="target" id="index-22"></span><span class="target" id="index-23"></span><div class="highlight-rconsole" id="index-24"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">mean</span><span class="p">(</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">[1] 0.7649074</span>
<span class="gp">&gt; </span>median<span class="p">(</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">[1] 0.72</span>
<span class="gp">&gt; </span>quantile<span class="p">(</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">    0%    25%    50%    75%   100%</span>
<span class="go">0.1300 0.4800 0.7200 1.0075 1.7600</span>
<span class="gp">&gt; </span><span class="kp">min</span><span class="p">(</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">[1] 0.13</span>
<span class="gp">&gt; </span><span class="kp">max</span><span class="p">(</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">[1] 1.76</span>
<span class="gp">&gt; </span>var<span class="p">(</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">[1] 0.1429382</span>
<span class="gp">&gt; </span>sd<span class="p">(</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">[1] 0.3780717</span>
</pre></div>
</div>
<p>Finally, the <em>summary</em> command will print out the min, max, mean,
median, and quantiles:</p>
<div class="highlight-rconsole" id="index-25"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go"> 0.1300  0.4800  0.7200  0.7649  1.0080  1.7600</span>
</pre></div>
</div>
<p>The summary command is especially nice because if you give it a data
frame it will print out the summary for every vector in the data
frame:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>tree<span class="p">)</span>
<span class="go">       C               N              CHBR         REP             LFBM</span>
<span class="go"> Min.   :1.000   Min.   :1.000   A1     : 3   Min.   : 1.00   Min.   :0.1300</span>
<span class="go"> 1st Qu.:2.000   1st Qu.:1.000   A4     : 3   1st Qu.: 9.00   1st Qu.:0.4800</span>
<span class="go"> Median :2.000   Median :2.000   A6     : 3   Median :14.00   Median :0.7200</span>
<span class="go"> Mean   :2.519   Mean   :1.926   B2     : 3   Mean   :13.05   Mean   :0.7649</span>
<span class="go"> 3rd Qu.:3.000   3rd Qu.:3.000   B3     : 3   3rd Qu.:20.00   3rd Qu.:1.0075</span>
<span class="go"> Max.   :4.000   Max.   :3.000   B4     : 3   Max.   :20.00   Max.   :1.7600</span>
<span class="go">                                 (Other):36   NA&#39;s   :11.00</span>
<span class="go">      STBM             RTBM            LFNCC           STNCC</span>
<span class="go"> Min.   :0.0300   Min.   :0.1200   Min.   :0.880   Min.   :0.3700</span>
<span class="go"> 1st Qu.:0.1900   1st Qu.:0.2825   1st Qu.:1.312   1st Qu.:0.6400</span>
<span class="go"> Median :0.2450   Median :0.4450   Median :1.550   Median :0.7850</span>
<span class="go"> Mean   :0.2883   Mean   :0.4662   Mean   :1.560   Mean   :0.7872</span>
<span class="go"> 3rd Qu.:0.3800   3rd Qu.:0.5500   3rd Qu.:1.788   3rd Qu.:0.9350</span>
<span class="go"> Max.   :0.7200   Max.   :1.5100   Max.   :2.760   Max.   :1.2900</span>

<span class="go">     RTNCC            LFBCC           STBCC           RTBCC</span>
<span class="go"> Min.   :0.4700   Min.   :25.00   Min.   :14.00   Min.   :15.00</span>
<span class="go"> 1st Qu.:0.6000   1st Qu.:34.00   1st Qu.:17.00   1st Qu.:19.00</span>
<span class="go"> Median :0.7500   Median :37.00   Median :18.00   Median :20.00</span>
<span class="go"> Mean   :0.7394   Mean   :36.96   Mean   :18.80   Mean   :21.43</span>
<span class="go"> 3rd Qu.:0.8100   3rd Qu.:41.00   3rd Qu.:20.00   3rd Qu.:23.00</span>
<span class="go"> Max.   :1.5500   Max.   :48.00   Max.   :27.00   Max.   :41.00</span>

<span class="go">     LFCACC           STCACC           RTCACC           LFKCC</span>
<span class="go"> Min.   :0.2100   Min.   :0.1300   Min.   :0.1100   Min.   :0.6500</span>
<span class="go"> 1st Qu.:0.2600   1st Qu.:0.1600   1st Qu.:0.1600   1st Qu.:0.8100</span>
<span class="go"> Median :0.2900   Median :0.1700   Median :0.1650   Median :0.9000</span>
<span class="go"> Mean   :0.2869   Mean   :0.1774   Mean   :0.1654   Mean   :0.9053</span>
<span class="go"> 3rd Qu.:0.3100   3rd Qu.:0.1875   3rd Qu.:0.1700   3rd Qu.:0.9900</span>
<span class="go"> Max.   :0.3600   Max.   :0.2400   Max.   :0.2400   Max.   :1.1800</span>
<span class="go">                                                    NA&#39;s   :1.0000</span>
<span class="go">     STKCC           RTKCC           LFMGCC           STMGCC</span>
<span class="go"> Min.   :0.870   Min.   :0.330   Min.   :0.0700   Min.   :0.100</span>
<span class="go"> 1st Qu.:0.940   1st Qu.:0.400   1st Qu.:0.1000   1st Qu.:0.110</span>
<span class="go"> Median :1.055   Median :0.475   Median :0.1200   Median :0.130</span>
<span class="go"> Mean   :1.105   Mean   :0.473   Mean   :0.1109   Mean   :0.135</span>
<span class="go"> 3rd Qu.:1.210   3rd Qu.:0.520   3rd Qu.:0.1300   3rd Qu.:0.150</span>
<span class="go"> Max.   :1.520   Max.   :0.640   Max.   :0.1400   Max.   :0.190</span>

<span class="go">     RTMGCC            LFPCC            STPCC            RTPCC</span>
<span class="go"> Min.   :0.04000   Min.   :0.1500   Min.   :0.1500   Min.   :0.1000</span>
<span class="go"> 1st Qu.:0.06000   1st Qu.:0.2000   1st Qu.:0.2200   1st Qu.:0.1300</span>
<span class="go"> Median :0.07000   Median :0.2400   Median :0.2800   Median :0.1450</span>
<span class="go"> Mean   :0.06648   Mean   :0.2381   Mean   :0.2707   Mean   :0.1465</span>
<span class="go"> 3rd Qu.:0.07000   3rd Qu.:0.2700   3rd Qu.:0.3175   3rd Qu.:0.1600</span>
<span class="go"> Max.   :0.09000   Max.   :0.3100   Max.   :0.4100   Max.   :0.2100</span>

<span class="go">     LFSCC            STSCC            RTSCC</span>
<span class="go"> Min.   :0.0900   Min.   :0.1400   Min.   :0.0900</span>
<span class="go"> 1st Qu.:0.1325   1st Qu.:0.1600   1st Qu.:0.1200</span>
<span class="go"> Median :0.1600   Median :0.1800   Median :0.1300</span>
<span class="go"> Mean   :0.1661   Mean   :0.1817   Mean   :0.1298</span>
<span class="go"> 3rd Qu.:0.1875   3rd Qu.:0.2000   3rd Qu.:0.1475</span>
<span class="go"> Max.   :0.2600   Max.   :0.2800   Max.   :0.1700</span>

</pre></div>
</div>
</div>
<div class="section" id="operations-on-vectors">
<h3><a class="toc-backref" href="#id3">3.3. Operations on Vectors</a></h3>
<p>Here we look at some commonly used commands that perform operations on
lists. The commands include the <em>sort</em>, <em>min</em>, <em>max</em>, and <em>sum</em>
commands. First, the <em>sort</em> command can sort the given vector in
either ascending or descending order:</p>
<div class="highlight-rconsole" id="index-26"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>b <span class="o">=</span> <span class="kp">sort</span><span class="p">(</span>a<span class="p">)</span>
<span class="gp">&gt; </span><span class="kt">c</span> <span class="o">=</span> <span class="kp">sort</span><span class="p">(</span>a<span class="p">,</span>decreasing <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">[1] 2 4 6 3 1 5</span>
<span class="gp">&gt; </span>b
<span class="go">[1] 1 2 3 4 5 6</span>
<span class="gp">&gt; </span><span class="kt">c</span>
<span class="go">[1] 6 5 4 3 2 1</span>
</pre></div>
</div>
<p>The <em>min</em> and the <em>max</em> commands find the minimum and the maximum
numbers in the vector:</p>
<span class="target" id="index-27"></span><div class="highlight-rconsole" id="index-28"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">min</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 1</span>
<span class="gp">&gt; </span><span class="kp">max</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 6</span>
</pre></div>
</div>
<p>Finally, the <em>sum</em> command adds up the numbers in the vector:</p>
<div class="highlight-rconsole" id="index-29"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">sum</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 21</span>
</pre></div>
</div>


<h2></h2>
<h2>4. Basic Probability Distributions</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#the-normal-distribution" id="id1">The Normal Distribution</a></li>
<li><a href="#the-t-distribution" id="id2">The t Distribution</a></li>
<li><a href="#the-binomial-distribution" id="id3">The Binomial Distribution</a></li>
<li><a href="#the-chi-squared-distribution" id="id4">The Chi-Squared Distribution</a></li>
</ul>
</div>
<p id="index-0">We look at some of the basic operations associated with probability
distributions. There are a large number of probability distributions
available, but we only look at a few. If you would like to know what
distributions are available you can do a search using the command
help.search(&#8220;distribution&#8221;).</p>
<p>Here we give details about the commands associated with the normal
distribution and briefly mention the commands for other
distributions. The functions for different distributions are very
similar where the differences are noted below.</p>
<p>For this chapter it is assumed that you know how to enter data which
is covered in the previous chapters.</p>
<p>To get a full list of the distributions available in R you can use the
following command:</p>
<div class="highlight-rconsole" id="index-1"><div class="highlight"><pre><span></span><span class="go">help(Distributions)</span>
</pre></div>
</div>
<p>For every distribution there are four commands. The commands for each
distribution are prepended with a letter to indicate the functionality:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="92%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#8220;d&#8221;</td>
<td>returns the height of the probability density function</td>
</tr>
<tr class="row-even"><td>&#8220;p&#8221;</td>
<td>returns the cumulative density function</td>
</tr>
<tr class="row-odd"><td>&#8220;q&#8221;</td>
<td>returns the inverse cumulative density function (quantiles)</td>
</tr>
<tr class="row-even"><td>&#8220;r&#8221;</td>
<td>returns randomly generated numbers</td>
</tr>
</tbody>
</table>
<div class="section" id="the-normal-distribution">
<h3><a class="toc-backref" href="#id1">4.1. The Normal Distribution</a></h3>
<p id="index-2">There are four functions that can be used to generate the values
associated with the normal distribution. You can get a full list of
them and their options using the help command:</p>
<div class="highlight-rconsole" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>Normal<span class="p">)</span>
</pre></div>
</div>
<p>The first function we look at it is <em>dnorm</em>. Given a set of values it
returns the height of the probability distribution at each point. If
you only give the points it assumes you want to use a mean of zero and
standard deviation of one. There are options to use different values
for the mean and standard deviation, though:</p>
<span class="target" id="index-4"></span><div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>dnorm<span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="go">[1] 0.3989423</span>
<span class="gp">&gt; </span>dnorm<span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="o">*</span><span class="kp">sqrt</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="kc">pi</span><span class="p">)</span>
<span class="go">[1] 1</span>
<span class="gp">&gt; </span>dnorm<span class="p">(</span><span class="m">0</span><span class="p">,</span>mean<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="go">[1] 0.0001338302</span>
<span class="gp">&gt; </span>dnorm<span class="p">(</span><span class="m">0</span><span class="p">,</span>mean<span class="o">=</span><span class="m">4</span><span class="p">,</span>sd<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 0.03682701</span>
<span class="gp">&gt;v</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>dnorm<span class="p">(</span>v<span class="p">)</span>
<span class="go">[1] 0.39894228 0.24197072 0.05399097</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-20</span><span class="p">,</span><span class="m">20</span><span class="p">,</span>by<span class="o">=</span><span class="m">.1</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dnorm<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dnorm<span class="p">(</span>x<span class="p">,</span>mean<span class="o">=</span><span class="m">2.5</span><span class="p">,</span>sd<span class="o">=</span><span class="m">0.1</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
</pre></div>
</div>
<p>The second function we examine is pnorm. Given a number or a list it
computes the probability that a normally distributed random number
will be less than that number. This function also goes by the rather
ominous title of the &#8220;Cumulative Distribution Function.&#8221; It accepts
the same options as dnorm:</p>
<div class="highlight-rconsole" id="index-6"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>pnorm<span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="go">[1] 0.5</span>
<span class="gp">&gt; </span>pnorm<span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="go">[1] 0.8413447</span>
<span class="gp">&gt; </span>pnorm<span class="p">(</span><span class="m">0</span><span class="p">,</span>mean<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 0.02275013</span>
<span class="gp">&gt; </span>pnorm<span class="p">(</span><span class="m">0</span><span class="p">,</span>mean<span class="o">=</span><span class="m">2</span><span class="p">,</span>sd<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="go">[1] 0.2524925</span>
<span class="gp">&gt; </span>v <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>pnorm<span class="p">(</span>v<span class="p">)</span>
<span class="go">[1] 0.5000000 0.8413447 0.9772499</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-20</span><span class="p">,</span><span class="m">20</span><span class="p">,</span>by<span class="o">=</span><span class="m">.1</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> pnorm<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> pnorm<span class="p">(</span>x<span class="p">,</span>mean<span class="o">=</span><span class="m">3</span><span class="p">,</span>sd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
</pre></div>
</div>
<p>If you wish to find the probability that a number is larger than the
given number you can use the <em>lower.tail</em> option:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>pnorm<span class="p">(</span><span class="m">0</span><span class="p">,</span>lower.tail<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="go">[1] 0.5</span>
<span class="gp">&gt; </span>pnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span>lower.tail<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="go">[1] 0.1586553</span>
<span class="gp">&gt; </span>pnorm<span class="p">(</span><span class="m">0</span><span class="p">,</span>mean<span class="o">=</span><span class="m">2</span><span class="p">,</span>lower.tail<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="go">[1] 0.9772499</span>
</pre></div>
</div>
<p>The next function we look at is <em>qnorm</em> which is the inverse of
pnorm. The idea behind <em>qnorm</em> is that you give it a probability, and
it returns the number whose cumulative distribution matches the
probability. For example, if you have a normally distributed random
variable with mean zero and standard deviation one, then if you give
the function a probability it returns the associated Z-score:</p>
<div class="highlight-rconsole" id="index-7"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.5</span><span class="p">)</span>
<span class="go">[1] 0</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.5</span><span class="p">,</span>mean<span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="go">[1] 1</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.5</span><span class="p">,</span>mean<span class="o">=</span><span class="m">1</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 1</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.5</span><span class="p">,</span>mean<span class="o">=</span><span class="m">2</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 2</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.5</span><span class="p">,</span>mean<span class="o">=</span><span class="m">2</span><span class="p">,</span>sd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="go">[1] 2</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.25</span><span class="p">,</span>mean<span class="o">=</span><span class="m">2</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 0.6510205</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.333</span><span class="p">)</span>
<span class="go">[1] -0.4316442</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.333</span><span class="p">,</span>sd<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="go">[1] -1.294933</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span><span class="m">0.75</span><span class="p">,</span>mean<span class="o">=</span><span class="m">5</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 6.34898</span>
<span class="gp">&gt; </span>v <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.3</span><span class="p">,</span><span class="m">0.75</span><span class="p">)</span>
<span class="gp">&gt; </span>qnorm<span class="p">(</span>v<span class="p">)</span>
<span class="go">[1] -1.2815516 -0.5244005  0.6744898</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>by<span class="o">=</span><span class="m">.05</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> qnorm<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> qnorm<span class="p">(</span>x<span class="p">,</span>mean<span class="o">=</span><span class="m">3</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> qnorm<span class="p">(</span>x<span class="p">,</span>mean<span class="o">=</span><span class="m">3</span><span class="p">,</span>sd<span class="o">=</span><span class="m">0.1</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
</pre></div>
</div>
<p>The last function we examine is the <em>rnorm</em> function which can generate
random numbers whose distribution is normal. The argument that you
give it is the number of random numbers that you want, and it has
optional arguments to specify the mean and standard deviation:</p>
<span class="target" id="index-8"></span><span class="target" id="index-9"></span><span class="target" id="index-10"></span><div class="highlight-rconsole" id="index-11"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>rnorm<span class="p">(</span><span class="m">4</span><span class="p">)</span>
<span class="go">[1]  1.2387271 -0.2323259 -1.2003081 -1.6718483</span>
<span class="gp">&gt; </span>rnorm<span class="p">(</span><span class="m">4</span><span class="p">,</span>mean<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="go">[1] 2.633080 3.617486 2.038861 2.601933</span>
<span class="gp">&gt; </span>rnorm<span class="p">(</span><span class="m">4</span><span class="p">,</span>mean<span class="o">=</span><span class="m">3</span><span class="p">,</span>sd<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="go">[1] 4.580556 2.974903 4.756097 6.395894</span>
<span class="gp">&gt; </span>rnorm<span class="p">(</span><span class="m">4</span><span class="p">,</span>mean<span class="o">=</span><span class="m">3</span><span class="p">,</span>sd<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="go">[1]  3.000852  3.714180 10.032021  3.295667</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">200</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">200</span><span class="p">,</span>mean<span class="o">=</span><span class="m">-2</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">200</span><span class="p">,</span>mean<span class="o">=</span><span class="m">-2</span><span class="p">,</span>sd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>y<span class="p">)</span>
<span class="gp">&gt; </span>qqnorm<span class="p">(</span>y<span class="p">)</span>
<span class="gp">&gt; </span>qqline<span class="p">(</span>y<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-t-distribution">
<h3><a class="toc-backref" href="#id2">4.2. The t Distribution</a></h3>
<p id="index-12">There are four functions that can be used to generate the values
associated with the t distribution. You can get a full list of them
and their options using the help command:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>TDist<span class="p">)</span>
</pre></div>
</div>
<p>These commands work just like the commands for the normal
distribution. One difference is that the commands assume that the
values are normalized to mean zero and standard deviation one, so you
have to use a little algebra to use these functions in practice. The
other difference is that you have to specify the number of degrees of
freedom. The commands follow the same kind of naming convention, and
the names of the commands are <em>dt</em>, <em>pt</em>, <em>qt</em>, and <em>rt</em>.</p>
<p>A few examples are given below to show how to use the different
commands. First we have the distribution function, <em>dt</em>:</p>
<span class="target" id="index-13"></span><div class="highlight-rconsole" id="index-14"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-20</span><span class="p">,</span><span class="m">20</span><span class="p">,</span>by<span class="o">=</span><span class="m">.5</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dt<span class="p">(</span>x<span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dt<span class="p">(</span>x<span class="p">,</span>df<span class="o">=</span><span class="m">50</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
</pre></div>
</div>
<p>Next we have the cumulative probability distribution function:</p>
<div class="highlight-rconsole" id="index-15"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>pt<span class="p">(</span><span class="m">-3</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 0.006671828</span>
<span class="gp">&gt; </span>pt<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 0.9933282</span>
<span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span>pt<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 0.006671828</span>
<span class="gp">&gt; </span>pt<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 0.996462</span>
<span class="gp">&gt; </span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="m">-4</span><span class="p">,</span><span class="m">-2</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span>pt<span class="p">((</span><span class="kp">mean</span><span class="p">(</span>x<span class="p">)</span><span class="m">-2</span><span class="p">)</span><span class="o">/</span>sd<span class="p">(</span>x<span class="p">),</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 0.001165548</span>
<span class="gp">&gt; </span>pt<span class="p">((</span><span class="kp">mean</span><span class="p">(</span>x<span class="p">)</span><span class="m">-2</span><span class="p">)</span><span class="o">/</span>sd<span class="p">(</span>x<span class="p">),</span>df<span class="o">=</span><span class="m">40</span><span class="p">)</span>
<span class="go">[1] 0.000603064</span>
</pre></div>
</div>
<p>Next we have the inverse cumulative probability distribution function:</p>
<div class="highlight-rconsole" id="index-16"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>qt<span class="p">(</span><span class="m">0.05</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] -1.812461</span>
<span class="gp">&gt; </span>qt<span class="p">(</span><span class="m">0.95</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 1.812461</span>
<span class="gp">&gt; </span>qt<span class="p">(</span><span class="m">0.05</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] -1.724718</span>
<span class="gp">&gt; </span>qt<span class="p">(</span><span class="m">0.95</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 1.724718</span>
<span class="gp">&gt; </span>v <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">0.005</span><span class="p">,</span><span class="m">.025</span><span class="p">,</span><span class="m">.05</span><span class="p">)</span>
<span class="gp">&gt; </span>qt<span class="p">(</span>v<span class="p">,</span>df<span class="o">=</span><span class="m">253</span><span class="p">)</span>
<span class="go">[1] -2.595401 -1.969385 -1.650899</span>
<span class="gp">&gt; </span>qt<span class="p">(</span>v<span class="p">,</span>df<span class="o">=</span><span class="m">25</span><span class="p">)</span>
<span class="go">[1] -2.787436 -2.059539 -1.708141</span>
</pre></div>
</div>
<p>Finally random numbers can be generated according to the t
distribution:</p>
<div class="highlight-rconsole" id="index-17"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>rt<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 0.9440930 2.1734365 0.6785262</span>
<span class="gp">&gt; </span>rt<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1]  0.1043300 -1.4682198  0.0715013</span>
<span class="gp">&gt; </span>rt<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1]  0.8023832 -0.4759780 -1.0546125</span>
</pre></div>
</div>
</div>
<div class="section" id="the-binomial-distribution">
<h3><a class="toc-backref" href="#id3">4.3. The Binomial Distribution</a></h3>
<p id="index-18">There are four functions that can be used to generate the values
associated with the binomial distribution. You can get a full list of
them and their options using the help command:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>Binomial<span class="p">)</span>
</pre></div>
</div>
<p>These commands work just like the commands for the normal
distribution. The binomial distribution requires two extra parameters,
the number of trials and the probability of success for a single
trial. The commands follow the same kind of naming convention, and the
names of the commands are dbinom, pbinom, qbinom, and rbinom.</p>
<p>A few examples are given below to show how to use the different
commands. First we have the distribution function, <em>dbinom</em>:</p>
<div class="highlight-rconsole" id="index-19"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">50</span><span class="p">,</span>by<span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dbinom<span class="p">(</span>x<span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">0.2</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dbinom<span class="p">(</span>x<span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">0.6</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">100</span><span class="p">,</span>by<span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dbinom<span class="p">(</span>x<span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">0.6</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
</pre></div>
</div>
<p>Next we have the cumulative probability distribution function:</p>
<div class="highlight-rconsole" id="index-20"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">24</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span>
<span class="go">[1] 0.4438624</span>
<span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">25</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span>
<span class="go">[1] 0.5561376</span>
<span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">25</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span>
<span class="go">[1] 0.5</span>
<span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">26</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span>
<span class="go">[1] 0.610116</span>
<span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">25</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span>
<span class="go">[1] 0.5561376</span>
<span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">25</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">0.25</span><span class="p">)</span>
<span class="go">[1] 0.999962</span>
<span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">25</span><span class="p">,</span><span class="m">500</span><span class="p">,</span><span class="m">0.25</span><span class="p">)</span>
<span class="go">[1] 4.955658e-33</span>
</pre></div>
</div>
<p id="index-21">Next we have the inverse cumulative probability distribution function:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>qbinom<span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 25</span>
<span class="gp">&gt; </span>qbinom<span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 23</span>
<span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">23</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 0.2879247</span>
<span class="gp">&gt; </span>pbinom<span class="p">(</span><span class="m">22</span><span class="p">,</span><span class="m">51</span><span class="p">,</span><span class="m">1</span><span class="o">/</span><span class="m">2</span><span class="p">)</span>
<span class="go">[1] 0.200531</span>
</pre></div>
</div>
<p>Finally random numbers can be generated according to the binomial
distribution:</p>
<div class="highlight-rconsole" id="index-22"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>rbinom<span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">.2</span><span class="p">)</span>
<span class="go">[1] 30 23 21 19 18</span>
<span class="gp">&gt; </span>rbinom<span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">.7</span><span class="p">)</span>
<span class="go">[1] 66 66 58 68 63</span>
</pre></div>
</div>
</div>
<div class="section" id="the-chi-squared-distribution">
<h3><a class="toc-backref" href="#id4">4.4. The Chi-Squared Distribution</a></h3>
<p id="index-23">There are four functions that can be used to generate the values
associated with the Chi-Squared distribution. You can get a full list
of them and their options using the help command:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>Chisquare<span class="p">)</span>
</pre></div>
</div>
<p>These commands work just like the commands for the normal
distribution. The first difference is that it is assumed that you have
normalized the value so no mean can be specified. The other difference
is that you have to specify the number of degrees of freedom. The
commands follow the same kind of naming convention, and the names of
the commands are <em>dchisq</em>, <em>pchisq</em>, <em>qchisq</em>, and <em>rchisq</em>.</p>
<p>A few examples are given below to show how to use the different
commands. First we have the distribution function, <em>dchisq</em>:</p>
<div class="highlight-rconsole" id="index-24"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-20</span><span class="p">,</span><span class="m">20</span><span class="p">,</span>by<span class="o">=</span><span class="m">.5</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dchisq<span class="p">(</span>x<span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dchisq<span class="p">(</span>x<span class="p">,</span>df<span class="o">=</span><span class="m">12</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
</pre></div>
</div>
<p>Next we have the cumulative probability distribution function:</p>
<div class="highlight-rconsole" id="index-25"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>pchisq<span class="p">(</span><span class="m">2</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 0.003659847</span>
<span class="gp">&gt; </span>pchisq<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 0.01857594</span>
<span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span>pchisq<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 0.981424</span>
<span class="gp">&gt; </span>pchisq<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 4.097501e-06</span>
<span class="gp">&gt; </span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)</span>
<span class="gp">&gt; </span>pchisq<span class="p">(</span>x<span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 1.114255e-07 4.649808e-05 2.773521e-04 1.102488e-03</span>
</pre></div>
</div>
<p>Next we have the inverse cumulative probability distribution function:</p>
<div class="highlight-rconsole" id="index-26"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>qchisq<span class="p">(</span><span class="m">0.05</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 3.940299</span>
<span class="gp">&gt; </span>qchisq<span class="p">(</span><span class="m">0.95</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 18.30704</span>
<span class="gp">&gt; </span>qchisq<span class="p">(</span><span class="m">0.05</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 10.85081</span>
<span class="gp">&gt; </span>qchisq<span class="p">(</span><span class="m">0.95</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 31.41043</span>
<span class="gp">&gt; </span>v <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">0.005</span><span class="p">,</span><span class="m">.025</span><span class="p">,</span><span class="m">.05</span><span class="p">)</span>
<span class="gp">&gt; </span>qchisq<span class="p">(</span>v<span class="p">,</span>df<span class="o">=</span><span class="m">253</span><span class="p">)</span>
<span class="go">[1] 198.8161 210.8355 217.1713</span>
<span class="gp">&gt; </span>qchisq<span class="p">(</span>v<span class="p">,</span>df<span class="o">=</span><span class="m">25</span><span class="p">)</span>
<span class="go">[1] 10.51965 13.11972 14.61141</span>
</pre></div>
</div>
<p>Finally random numbers can be generated according to the Chi-Squared
distribution:</p>
<div class="highlight-rconsole" id="index-27"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>rchisq<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="go">[1] 16.80075 20.28412 12.39099</span>
<span class="gp">&gt; </span>rchisq<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 17.838878  8.591936 17.486372</span>
<span class="gp">&gt; </span>rchisq<span class="p">(</span><span class="m">3</span><span class="p">,</span>df<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="go">[1] 11.19279 23.86907 24.81251</span>
</pre></div>
</div>


<h2></h2>
<h2>5. Basic Plots</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#strip-charts" id="id4">Strip Charts</a></li>
<li><a href="#histograms" id="id5">Histograms</a></li>
<li><a href="#boxplots" id="id6">Boxplots</a></li>
<li><a href="#scatter-plots" id="id7">Scatter Plots</a></li>
<li><a href="#normal-qq-plots" id="id8">Normal QQ Plots</a></li>
</ul>
</div>
<p id="index-0">This is a basic introduction to some of the basic
plotting commands.</p>
<p>

<a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/w1.dat">w1.dat</a> and <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/trees91.csv">trees91.csv</a>
are read
using &#8220;read.csv&#8221; into variables <em>w1</em> and <em>tree</em>:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span> w1 <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;w1.dat&quot;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>head<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>w1<span class="p">)</span>
<span class="go">[1] &quot;vals&quot;</span>
<span class="gp">&gt; </span> tree <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;trees91.csv&quot;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>head<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>tree<span class="p">)</span>
<span class="go"> [1] &quot;C&quot;      &quot;N&quot;      &quot;CHBR&quot;   &quot;REP&quot;    &quot;LFBM&quot;   &quot;STBM&quot;   &quot;RTBM&quot;   &quot;LFNCC&quot;</span>
<span class="go"> [9] &quot;STNCC&quot;  &quot;RTNCC&quot;  &quot;LFBCC&quot;  &quot;STBCC&quot;  &quot;RTBCC&quot;  &quot;LFCACC&quot; &quot;STCACC&quot; &quot;RTCACC&quot;</span>
<span class="go">[17] &quot;LFKCC&quot;  &quot;STKCC&quot;  &quot;RTKCC&quot;  &quot;LFMGCC&quot; &quot;STMGCC&quot; &quot;RTMGCC&quot; &quot;LFPCC&quot;  &quot;STPCC&quot;</span>
<span class="go">[25] &quot;RTPCC&quot;  &quot;LFSCC&quot;  &quot;STSCC&quot;  &quot;RTSCC&quot;</span>
</pre></div>
</div>
<div class="section" id="strip-charts">
<h3><a class="toc-backref" href="#id4">5.1. Strip Charts</a></h3>
<span class="target" id="index-1"></span><p id="index-2">A strip chart is the most basic type of plot available. It plots the
data in order along a line with each data point represented as a
box. </p>
<p>To create a strip chart of this data use the stripchart command:</p>
<div class="highlight-rconsole" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>stripchart<span class="p">)</span>
<span class="gp">&gt; </span>stripchart<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
</pre></div>
</div>

<img alt="_images/stripchart.png" src="http://www.cyclismo.org/tutorial/R/_images/stripchart.png" />
<div class="sidebar">
<p class="first sidebar-title">Strip Chart</p>
<p class="last">This is the most basic possible strip charts. The stripchart() command takes many of the standard plot() options for labeling and annotations.</p>
</div>
<p>There is no title nor axes labels. It only shows how the data looks if you were to
put it all along one line and mark out a box at each point. <br>
If you would prefer to see which points are repeated you can specify that repeated points be stacked:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>stripchart<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>method<span class="o">=</span><span class="s">&quot;stack&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A variation on this is to have the boxes moved up and down so that there is more separation between them:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>stripchart<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>method<span class="o">=</span><span class="s">&quot;jitter&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you do not want the boxes plotting in the horizontal direction you can plot them in the vertical direction:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>stripchart<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>vertical<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span>stripchart<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>vertical<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>method<span class="o">=</span><span class="s">&quot;jitter&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Since you should always annotate your plots there are many different
ways to add titles and labels. One way is within the stripchart
command itself:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>stripchart<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>method<span class="o">=</span><span class="s">&quot;stack&quot;</span><span class="p">,</span>
<span class="go">             main=&#39;Leaf BioMass in High CO2 Environment&#39;,</span>
<span class="go">             xlab=&#39;BioMass of Leaves&#39;)</span>
</pre></div>
</div>
<p>If you have a plot already and want to add a title, you can use the
title command:</p>
<span class="target" id="index-4"></span><div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>title<span class="p">(</span><span class="s">&#39;Leaf BioMass in High CO2 Environment&#39;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&#39;BioMass of Leaves&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this simply adds the title and labels and will write over
the top of any titles or labels you already have.</p>
</div>
<div class="section" id="histograms">
<h3><a class="toc-backref" href="#id5">5.2. Histograms</a></h3>
<p id="index-6">A histogram plots the frequencies that data appears within certain ranges.</p>
<p>To plot a histogram of the data use the &#8220;hist&#8221; command:</p>
<div class="highlight-rconsole" id="index-7"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Distribution of w1&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;w1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/histogramW1.png" src="http://www.cyclismo.org/tutorial/R/_images/histogramW1.png" />
<div class="sidebar">
<p class="first sidebar-title">Histogram Options</p>
<p class="last">Many of the basic plot commands accept the same options. The
<em>help(hist)</em> command will give you options specifically for the
<em>hist</em> command. You can also use the help command to see more but
also note that if you use <em>help(plot)</em> you may see more
options. Experiment with different options to see what you can do.</p>
</div>
<p>R will automatically calculate the intervals to use. 
There are many options to determine how to break up the intervals.

<p>You can specify the number of breaks to use using the breaks
option. Here we look at the histogram for various numbers of breaks:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">6</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">8</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">12</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>You can also vary the size of the domain using the xlim option. This
option takes a vector with two entries in it, the left value and the
right value:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">12</span><span class="p">,</span>xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">))</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">12</span><span class="p">,</span>xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">12</span><span class="p">,</span>xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">12</span><span class="p">,</span>xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1.3</span><span class="p">))</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>breaks<span class="o">=</span><span class="m">12</span><span class="p">,</span>xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="m">1.3</span><span class="p">))</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>The options for adding titles and labels are exactly the same as for
strip charts. You should always annotate your plots and there are many
different ways to add titles and labels. One way is within the hist
command itself:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>
<span class="go">       main=&#39;Leaf BioMass in High CO2 Environment&#39;,</span>
<span class="go">       xlab=&#39;BioMass of Leaves&#39;)</span>
</pre></div>
</div>
<p>If you have a plot already and want to change or add a title, you can use the title command:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>title<span class="p">(</span><span class="s">&#39;Leaf BioMass in High CO2 Environment&#39;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&#39;BioMass of Leaves&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this simply adds the title and labels and will write over
the top of any titles or labels you already have.</p>
<p>It is not uncommon to add other kinds of plots to a histogram. For
example, one of the options to the stripchart command is to add it to
a plot that has already been drawn. For example, you might want to
have a histogram with the strip chart drawn across the top. The
addition of the strip chart might give you a better idea of the
density of the data:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>main<span class="o">=</span><span class="s">&#39;Leaf BioMass in High CO2 Environment&#39;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&#39;BioMass of Leaves&#39;</span><span class="p">,</span>ylim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">16</span><span class="p">))</span>
<span class="gp">&gt; </span>stripchart<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>add<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>at<span class="o">=</span><span class="m">15.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="boxplots">
<h3><a class="toc-backref" href="#id6">5.3. Boxplots</a></h3>
<p>A boxplot provides a graphical view of the median, quartiles, maximum,
and minimum of a data set. Here we provide examples using two
different data sets. The first is the <em>w1</em> data frame mentioned at the
top of this page, and the one column of data is <em>w1$vals</em>. The second
is the <em>tree</em> data frame from the <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/trees91.csv">trees91.csv</a>
data file which is also mentioned at the top of the page.</p>
<p>We first use the <em>w1</em> data set and look at the boxplot of this data set:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>boxplot<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
</pre></div>
</div>
<img alt="_images/simpleBoxPlot.png" src="http://www.cyclismo.org/tutorial/R/_images/simpleBoxPlot.png" />
<p>Again, this is a very plain graph, and the title and labels can be
specified in exactly the same way as in the stripchart and hist
commands:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>boxplot<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>
<span class="go">          main=&#39;Leaf BioMass in High CO2 Environment&#39;,</span>
<span class="go">          ylab=&#39;BioMass of Leaves&#39;)</span>
</pre></div>
</div>
<p>Note that the default orientation is to plot the boxplot
vertically. Because of this we used the ylab option to specify the
axis label. There are a large number of options for this command. To
see more of the options see the help page:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>boxplot<span class="p">)</span>
</pre></div>
</div>
<p>As an example you can specify that the boxplot be plotted horizontally
by specifying the horizontal option:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>boxplot<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>
<span class="go">          main=&#39;Leaf BioMass in High CO2 Environment&#39;,</span>
<span class="go">          xlab=&#39;BioMass of Leaves&#39;,</span>
<span class="go">          horizontal=TRUE)</span>
</pre></div>
</div>
<p>The option to plot the box plot horizontally can be put to good use to
display a box plot on the same image as a histogram. You need to
specify the add option, specify where to put the box plot using the at
option, and turn off the addition of axes using the axes option:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>main<span class="o">=</span><span class="s">&#39;Leaf BioMass in High CO2 Environment&#39;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&#39;BioMass of Leaves&#39;</span><span class="p">,</span>ylim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">16</span><span class="p">))</span>
<span class="gp">&gt; </span>boxplot<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>horizontal<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>at<span class="o">=</span><span class="m">15.5</span><span class="p">,</span>add<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>axes<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are feeling really crazy you can take a histogram and add a box plot and a strip chart:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>hist<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>main<span class="o">=</span><span class="s">&#39;Leaf BioMass in High CO2 Environment&#39;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&#39;BioMass of Leaves&#39;</span><span class="p">,</span>ylim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">16</span><span class="p">))</span>
<span class="gp">&gt; </span>boxplot<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>horizontal<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>at<span class="o">=</span><span class="m">16</span><span class="p">,</span>add<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>axes<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="gp">&gt; </span>stripchart<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>add<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>at<span class="o">=</span><span class="m">15</span><span class="p">)</span>
</pre></div>
</div>
<p>Some people shell out good money to have this much fun.</p>
<p>For the second part on boxplots we will look at the second data frame,
&#8220;tree,&#8221; which comes from the <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/trees91.csv">trees91.csv</a>  file.
To reiterate the discussion at the top of this page and the discussion
in the data types chapter, we need to specify which columns are
factors:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>tree <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;trees91.csv&quot;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>head<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span>tree<span class="o">$</span>C <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>tree<span class="o">$</span>C<span class="p">)</span>
<span class="gp">&gt; </span>tree<span class="o">$</span>N <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>tree<span class="o">$</span>N<span class="p">)</span>
</pre></div>
</div>
<p>We can look at the boxplot of just the data for the stem biomass:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>boxplot<span class="p">(</span>tree<span class="o">$</span>STBM<span class="p">,</span>
<span class="go">          main=&#39;Stem BioMass in Different CO2 Environments&#39;,</span>
<span class="go">          ylab=&#39;BioMass of Stems&#39;)</span>
</pre></div>
</div>
<p>That plot does not tell the whole story. It is for all of the trees,
but the trees were grown in different kinds of environments. The
boxplot command can be used to plot a separate box plot for each
level. In this case the data is held in &#8220;tree$STBM,&#8221; and the different
levels are stored as factors in &#8220;tree$C.&#8221; The command to create
different boxplots is the following:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="go">boxplot(tree$STBM~tree$C)</span>
</pre></div>
</div>
<p>Note that for the level called &#8220;2&#8221; there are four outliers which are
plotted as little circles. There are many options to annotate your
plot including different labels for each level. Please use the
help(boxplot) command for more information.</p>
</div>
<div class="section" id="scatter-plots">
<h3><a class="toc-backref" href="#id7">5.4. Scatter Plots</a></h3>
<p>A scatter plot provides a graphical view of the relationship between
two sets of numbers. Here we provide examples using the <em>tree</em> data
frame from the <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/trees91.csv">trees91.csv</a>
data file which is mentioned at the top of the page. In particular we
look at the relationship between the stem biomass (&#8220;tree$STBM&#8221;) and
the leaf biomass (&#8220;tree$LFBM&#8221;).</p>
<p>The command to plot each pair of points as an x-coordinate and a y-coorindate is &#8220;plot:&#8221;</p>
<div class="highlight-rconsole" id="index-10"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>tree<span class="o">$</span>STBM<span class="p">,</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
</pre></div>
</div>
<p>It appears that there is a strong positive association between the
biomass in the stems of a tree and the leaves of the tree. It appears
to be a linear relationship. In fact, the corelation between these two
sets of observations is quite high:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>cor<span class="p">(</span>tree<span class="o">$</span>STBM<span class="p">,</span>tree<span class="o">$</span>LFBM<span class="p">)</span>
<span class="go">[1] 0.911595</span>
</pre></div>
</div>
<p>Getting back to the plot, you should always annotate your graphs. The
title and labels can be specified in exactly the same way as with the
other plotting commands:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>tree<span class="o">$</span>STBM<span class="p">,</span>tree<span class="o">$</span>LFBM<span class="p">,</span>
<span class="go">       main=&quot;Relationship Between Stem and Leaf Biomass&quot;,</span>
<span class="go">       xlab=&quot;Stem Biomass&quot;,</span>
<span class="go">       ylab=&quot;Leaf Biomass&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="normal-qq-plots">
<h3><a class="toc-backref" href="#id8">5.5. Normal QQ Plots</a></h3>
<p id="index-11">The final type of plot that we look at is the normal quantile
plot. This plot is used to determine if your data is close to being
normally distributed. You cannot be sure that the data is normally
distributed, but you can rule out if it is not normally
distributed. Here we provide examples using the <em>w1</em> data frame
mentioned at the top of this page, and the one column of data is
<em>w1$vals</em>.</p>
<p>The command to generate a normal quantile plot is qqnorm. You can give
it one argument, the univariate data set of interest:</p>
<div class="highlight-rconsole" id="index-12"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>qqnorm<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
</pre></div>
</div>
<p>You can annotate the plot in exactly the same way as all of the other
plotting commands given here:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>qqnorm<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">,</span>
<span class="go">         main=&quot;Normal Q-Q Plot of the Leaf Biomass&quot;,</span>
<span class="go">         xlab=&quot;Theoretical Quantiles of the Leaf Biomass&quot;,</span>
<span class="go">         ylab=&quot;Sample Quantiles of the Leaf Biomass&quot;)</span>
</pre></div>
</div>
<p>After you creat the normal quantile plot you can also add the
theoretical line that the data should fall on if they were normally
distributed:</p>
<div class="highlight-rconsole" id="index-13"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>qqline<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
</pre></div>
</div>
<p>In this example you should see that the data is not quite normally
distributed. There are a few outliers, and it does not match up at the
tails of the distribution.</p>


<h2></h2>
<h2>6. Intermediate Plotting</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#continuous-data" id="id12">Continuous Data</a></li>
<li><a href="#discrete-data" id="id13">Discrete Data</a></li>
<li><a href="#miscellaneous-options" id="id14">Miscellaneous Options</a></li>
</ul>
</div>
<p id="index-0">We look at some more options for plotting, and we assume that you are
familiar with the basic plotting commands (<a class="reference internal" href="plotting.html#basicplots"><span>Basic Plots</span></a>). A
variety of different subjects ranging from plotting options to the
formatting of plots is given.</p>
<p>In many of the examples below we use some of R&#8217;s commands to generate
random numbers according to various distributions. The section is
divided into three sections. The focus of the first section is on
graphing continuous data. The focus of the second section is on
graphing discrete data. The third section offers some miscellaneous
options that are useful in a variety of contexts.</p>
<div class="section" id="continuous-data">
<h3><a class="toc-backref" href="#id12">6.1. Continuous Data</a></h3>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#multiple-data-sets-on-one-plot" id="id15">Multiple Data Sets on One Plot</a></li>
<li><a href="#error-bars" id="id16">Error Bars</a></li>
<li><a href="#adding-noise-jitter" id="id17">Adding Noise (jitter)</a></li>
<li><a href="#multiple-graphs-on-one-image" id="id18">Multiple Graphs on One Image</a></li>
<li><a href="#density-plots" id="id19">Density Plots</a></li>
<li><a href="#pairwise-relationships" id="id20">Pairwise Relationships</a></li>
<li><a href="#shaded-regions" id="id21">Shaded Regions</a></li>
<li><a href="#plotting-a-surface" id="id22">Plotting a Surface</a></li>
</ul>
</div>
<p>In the examples below a data set is defined using R&#8217;s normally
distributed random number generator.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>sd<span class="o">=</span><span class="m">5</span><span class="p">,</span>mean<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> <span class="m">2.5</span><span class="o">*</span>x <span class="o">-</span> <span class="m">1.0</span> <span class="o">+</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>sd<span class="o">=</span><span class="m">9</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">)</span>
<span class="gp">&gt; </span>cor<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="go">[1] 0.7400576</span>
</pre></div>
</div>
<div class="section" id="multiple-data-sets-on-one-plot">
<h4><a class="toc-backref" href="#id15">6.1.1. Multiple Data Sets on One Plot</a></h4>
<p>One common task is to plot multiple data sets on the same plot. In
many situations the way to do this is to create the initial plot and
then add additional information to the plot. For example, to plot
bivariate data the <em>plot</em> command is used to initialize and create the
plot. The <em>points</em> command can then be used to add additional data
sets to the plot.</p>
<p>First define a set of normally distributed random numbers and then
plot them. (This same data set is used throughout the examples below.)</p>
<div class="highlight-rconsole" id="index-1"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>sd<span class="o">=</span><span class="m">5</span><span class="p">,</span>mean<span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> <span class="m">2.5</span><span class="o">*</span>x <span class="o">-</span> <span class="m">1.0</span> <span class="o">+</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>sd<span class="o">=</span><span class="m">9</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">)</span>
<span class="gp">&gt; </span>cor<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="go">[1] 0.7400576</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Independent&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Dependent&quot;</span><span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Random Stuff&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>x1 <span class="o">&lt;-</span> runif<span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">25</span><span class="p">)</span>
<span class="gp">&gt; </span>y1 <span class="o">&lt;-</span> <span class="m">2.5</span><span class="o">*</span>x1 <span class="o">-</span> <span class="m">1.0</span> <span class="o">+</span> runif<span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="m">-6</span><span class="p">,</span><span class="m">6</span><span class="p">)</span>
<span class="gp">&gt; </span>points<span class="p">(</span>x1<span class="p">,</span>y1<span class="p">,</span>col<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that in the previous example, the colour for the second set of
data points is set using the <em>col</em> option. You can try different
numbers to see what colours are available. For most installations
there are at least eight options from 1 to 8.  Also note that in the
example above the points are plotted as circles. The symbol that is
used can be changed using the <em>pch</em> option.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x2 <span class="o">&lt;-</span> runif<span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">25</span><span class="p">)</span>
<span class="gp">&gt; </span>y2 <span class="o">&lt;-</span> <span class="m">2.5</span><span class="o">*</span>x2 <span class="o">-</span> <span class="m">1.0</span> <span class="o">+</span> runif<span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="m">-6</span><span class="p">,</span><span class="m">6</span><span class="p">)</span>
<span class="gp">&gt; </span>points<span class="p">(</span>x2<span class="p">,</span>y2<span class="p">,</span>col<span class="o">=</span><span class="m">3</span><span class="p">,</span>pch<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, try different numbers to see the various options. Another
helpful option is to add a legend. This can be done with the <em>legend</em>
command. The options for the command, in order, are the <em>x</em> and <em>y</em>
coordinates on the plot to place the legend followed by a list of
labels to use. There are a large number of other options so use
<em>help(legend)</em> to see more options. For example a list of colors can
be given with the <em>col</em> option, and a list of symbols can be given
with the <em>pch</em> option.</p>
<div class="highlight-rconsole" id="index-2"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Independent&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Dependent&quot;</span><span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Random Stuff&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>points<span class="p">(</span>x1<span class="p">,</span>y1<span class="p">,</span>col<span class="o">=</span><span class="m">2</span><span class="p">,</span>pch<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>points<span class="p">(</span>x2<span class="p">,</span>y2<span class="p">,</span>col<span class="o">=</span><span class="m">4</span><span class="p">,</span>pch<span class="o">=</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>legend<span class="p">(</span><span class="m">14</span><span class="p">,</span><span class="m">70</span><span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;Original&quot;</span><span class="p">,</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="s">&quot;two&quot;</span><span class="p">),</span>col<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">),</span>pch<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">))</span>
</pre></div>
</div>
<div class="align-center figure" id="id4">
<span id="figure1-intermediateplotting"></span><img alt="Three data sets displayed together." src="http://www.cyclismo.org/tutorial/R/_images/multipleData.png" />
<p class="caption"><span class="caption-text">Figure 1.</span></p>
<div class="legend">
The three data sets displayed on the same graph.</div>
</div>
<p>Another common task is to change the limits of the axes to change the
size of the plotting area. This is achieved using the <em>xlim</em> and
<em>ylim</em> options in the <em>plot</em> command. Both options take a vector of
length two that have the minimum and maximum values.</p>
<span class="target" id="index-3"></span><span class="target" id="index-4"></span><div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Independent&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Dependent&quot;</span><span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Random Stuff&quot;</span><span class="p">,</span>xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">30</span><span class="p">),</span>ylim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">100</span><span class="p">))</span>
<span class="gp">&gt; </span>points<span class="p">(</span>x1<span class="p">,</span>y1<span class="p">,</span>col<span class="o">=</span><span class="m">2</span><span class="p">,</span>pch<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>points<span class="p">(</span>x2<span class="p">,</span>y2<span class="p">,</span>col<span class="o">=</span><span class="m">4</span><span class="p">,</span>pch<span class="o">=</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>legend<span class="p">(</span><span class="m">14</span><span class="p">,</span><span class="m">70</span><span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;Original&quot;</span><span class="p">,</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="s">&quot;two&quot;</span><span class="p">),</span>col<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">),</span>pch<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="error-bars">
<h4><a class="toc-backref" href="#id16">6.1.2. Error Bars</a></h4>
<p>Another common task is to add error bars to a set of data points. This
can be accomplished using the <em>arrows</em> command. The <em>arrows</em> command
takes two pairs of coordinates, that is two pairs of <em>x</em> and <em>y</em>
values. The command then draws a line between each pair and adds an
&#8220;arrow head&#8221; with a given length and angle.</p>
<span class="target" id="index-6"></span><div class="highlight-rconsole" id="index-7"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Independent&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Dependent&quot;</span><span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Random Stuff&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>xHigh <span class="o">&lt;-</span> x
<span class="gp">&gt; </span>yHigh <span class="o">&lt;-</span> y <span class="o">+</span> <span class="kp">abs</span><span class="p">(</span>rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>sd<span class="o">=</span><span class="m">3.5</span><span class="p">))</span>
<span class="gp">&gt; </span>xLow <span class="o">&lt;-</span> x
<span class="gp">&gt; </span>yLow <span class="o">&lt;-</span> y <span class="o">-</span> <span class="kp">abs</span><span class="p">(</span>rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>sd<span class="o">=</span><span class="m">3.1</span><span class="p">))</span>
<span class="gp">&gt; </span>arrows<span class="p">(</span>xHigh<span class="p">,</span>yHigh<span class="p">,</span>xLow<span class="p">,</span>yLow<span class="p">,</span>col<span class="o">=</span><span class="m">2</span><span class="p">,</span>angle<span class="o">=</span><span class="m">90</span><span class="p">,</span>length<span class="o">=</span><span class="m">0.1</span><span class="p">,</span>code<span class="o">=</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="align-center figure" id="id5">
<span id="figure2-intermediateplotting"></span><img alt="Figure with error bars added" src="http://www.cyclismo.org/tutorial/R/_images/errorBars.png" />
<p class="caption"><span class="caption-text">Figure 2.</span></p>
<div class="legend">
A data set with error bars added.</div>
</div>
<p>Note that the option <em>code</em> is used to specify where the bars are
drawn. Its value can be 1, 2, or 3. If <em>code</em> is 1 the bars are drawn
at pairs given in the first argument. If <em>code</em> is 2 the bars are
drawn at the pairs given in the second argument. If <em>code</em> is 3 the
bars are drawn at both.</p>
</div>
<div class="section" id="adding-noise-jitter">
<h4><a class="toc-backref" href="#id17">6.1.3. Adding Noise (jitter)</a></h4>
<p>In the previous example a little bit of &#8220;noise&#8221; was added to the pairs
to produce an artificial offset. This is a common thing to do for
making plots. A simpler way to accomplish this is to use the <em>jitter</em>
command.</p>
<span class="target" id="index-8"></span><span class="target" id="index-9"></span><span class="target" id="index-10"></span><div class="highlight-rconsole" id="index-11"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>numberWhite <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">400</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>numberChipped <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">400</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>par<span class="p">(</span>mfrow<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>numberWhite<span class="p">,</span>numberChipped<span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Number White Marbles Drawn&quot;</span><span class="p">,</span>
<span class="go">       ylab=&quot;Number Chipped Marbles Drawn&quot;,main=&quot;Pulling Marbles&quot;)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span><span class="kp">jitter</span><span class="p">(</span>numberWhite<span class="p">),</span><span class="kp">jitter</span><span class="p">(</span>numberChipped<span class="p">),</span>xlab<span class="o">=</span><span class="s">&quot;Number White Marbles Drawn&quot;</span><span class="p">,</span>
<span class="go">       ylab=&quot;Number Chipped Marbles Drawn&quot;,main=&quot;Pulling Marbles With Jitter&quot;)</span>
</pre></div>
</div>
<div class="align-center figure" id="id6">
<span id="figure3-intermediateplotting"></span><img alt="Points with noise added using the jitter command." src="http://www.cyclismo.org/tutorial/R/_images/jitterArray.png" />
<p class="caption"><span class="caption-text">Figure 3.</span></p>
<div class="legend">
Points with noise added using the <em>jitter</em> command.</div>
</div>
</div>
<div class="section" id="multiple-graphs-on-one-image">
<h4><a class="toc-backref" href="#id18">6.1.4. Multiple Graphs on One Image</a></h4>
<p>Note that a new command was used in the previous example. The <em>par</em>
command can be used to set different parameters. In the example above
the <em>mfrow</em> was set. The plots are arranged in an array where the
default number of rows and columns is one.  The <em>mfrow</em> parameter is a
vector with two entries. The first entry is the number of rows of
images. The second entry is the number of columns. In the example
above the plots were arranged in one row with two plots across.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>par<span class="p">(</span>mfrow<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
<span class="gp">&gt; </span>boxplot<span class="p">(</span>numberWhite<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;first plot&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>boxplot<span class="p">(</span>numberChipped<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;second plot&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span><span class="kp">jitter</span><span class="p">(</span>numberWhite<span class="p">),</span><span class="kp">jitter</span><span class="p">(</span>numberChipped<span class="p">),</span>xlab<span class="o">=</span><span class="s">&quot;Number White Marbles Drawn&quot;</span><span class="p">,</span>
<span class="go">       ylab=&quot;Number Chipped Marbles Drawn&quot;,main=&quot;Pulling Marbles With Jitter&quot;)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>numberWhite<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;fourth plot&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>numberChipped<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;fifth plot&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>mosaicplot<span class="p">(</span><span class="kp">table</span><span class="p">(</span>numberWhite<span class="p">,</span>numberChipped<span class="p">),</span>main<span class="o">=</span><span class="s">&quot;sixth plot&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="align-center figure" id="id7">
<span id="figure4-intermediateplotting"></span><img alt="An array of plots using the par command." src="http://www.cyclismo.org/tutorial/R/_images/twoByThree.png" />
<p class="caption"><span class="caption-text">Figure 4.</span></p>
<div class="legend">
An array of plots using the par command.</div>
</div>
</div>
<div class="section" id="density-plots">
<h4><a class="toc-backref" href="#id19">6.1.5. Density Plots</a></h4>
<p>There are times when you do not want to plot specific points but wish
to plot a density. This can be done using the <em>smoothScatter</em> command.</p>
<div class="highlight-rconsole" id="index-12"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>numberWhite <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>numberChipped <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>smoothScatter<span class="p">(</span>numberWhite<span class="p">,</span>numberChipped<span class="p">,</span>
<span class="go">             xlab=&quot;White Marbles&quot;,ylab=&quot;Chipped Marbles&quot;,main=&quot;Drawing Marbles&quot;)</span>
</pre></div>
</div>
<div class="align-center figure" id="id8">
<img alt="Using smoothScatter to plot densities." src="http://www.cyclismo.org/tutorial/R/_images/smoothScatter.png" />
<p class="caption"><span class="caption-text">Figure 5.</span></p>
<div class="legend">
The <em>SmoothScatter</em> can be used to plot densities.</div>
</div>
<p>Note that the previous example may benefit by superimposing a grid to
help delimit the points of interest. This can be done using the <em>grid</em>
command.</p>
<div class="highlight-rconsole" id="index-13"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>numberWhite <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>numberChipped <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>smoothScatter<span class="p">(</span>numberWhite<span class="p">,</span>numberChipped<span class="p">,</span>
<span class="go">             xlab=&quot;White Marbles&quot;,ylab=&quot;Chipped Marbles&quot;,main=&quot;Drawing Marbles&quot;)</span>
<span class="gp">&gt; </span>grid<span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="pairwise-relationships">
<h4><a class="toc-backref" href="#id20">6.1.6. Pairwise Relationships</a></h4>
<p>There are times that you want to explore a large number of
relationships. A number of relationships can be plotted at one time
using the <em>pairs</em> command. The idea is that you give it a matrix or a
data frame, and the command will create a scatter plot of all
combinations of the data.</p>
<span class="target" id="index-14"></span><div class="highlight-rconsole" id="index-15"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>uData <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">20</span><span class="p">)</span>
<span class="gp">&gt; </span>vData <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">20</span><span class="p">,</span>mean<span class="o">=</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>wData <span class="o">&lt;-</span> uData <span class="o">+</span> <span class="m">2</span><span class="o">*</span>vData <span class="o">+</span> rnorm<span class="p">(</span><span class="m">20</span><span class="p">,</span>sd<span class="o">=</span><span class="m">0.5</span><span class="p">)</span>
<span class="gp">&gt; </span>xData <span class="o">&lt;-</span> <span class="m">-2</span><span class="o">*</span>uData<span class="o">+</span>rnorm<span class="p">(</span><span class="m">20</span><span class="p">,</span>sd<span class="o">=</span><span class="m">0.1</span><span class="p">)</span>
<span class="gp">&gt; </span>yData <span class="o">&lt;-</span> <span class="m">3</span><span class="o">*</span>vData<span class="o">+</span>rnorm<span class="p">(</span><span class="m">20</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2.5</span><span class="p">)</span>
<span class="gp">&gt; </span>d <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>u<span class="o">=</span>uData<span class="p">,</span>v<span class="o">=</span>vData<span class="p">,</span>w<span class="o">=</span>wData<span class="p">,</span>x<span class="o">=</span>xData<span class="p">,</span>y<span class="o">=</span>yData<span class="p">)</span>
<span class="gp">&gt; </span>pairs<span class="p">(</span>d<span class="p">)</span>
</pre></div>
</div>
<div class="align-center figure" id="id9">
<span id="figure5-intermediateplotting"></span><img alt="An array of plots using the pairs command." src="http://www.cyclismo.org/tutorial/R/_images/pairwiseRelationships.png" />
<p class="caption"><span class="caption-text">Figure 5.</span></p>
<div class="legend">
Using <em>pairs</em> to produce all permutations of a set of relationships
on one graph.</div>
</div>
</div>
<div class="section" id="shaded-regions">
<h4><a class="toc-backref" href="#id21">6.1.7. Shaded Regions</a></h4>
<p>A shaded region can be plotted using the <em>polygon</em> command. The
<em>polygon</em> command takes a pair of vectors, <em>x</em> and <em>y</em>, and shades the
region enclosed by the coordinate pairs. In the example below a blue
square is drawn. The vertices are defined starting from the lower
left. Five pairs of points are given because the starting point and
the ending point is the same.</p>
<span class="target" id="index-16"></span><div class="highlight-rconsole" id="index-17"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">-1</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>polygon<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>col<span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>A more complicated example is given below. In this example the
rejection region for a right sided hypothesis test is plotted, and it
is shaded in red. A set of custom axes is constructed, and symbols are
plotted using the <em>expression</em> command.</p>
<span class="target" id="index-18"></span><span class="target" id="index-19"></span><span class="target" id="index-20"></span><div class="highlight-rconsole" id="index-21"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>stdDev <span class="o">&lt;-</span> <span class="m">0.75</span><span class="p">;</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.01</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> dnorm<span class="p">(</span>x<span class="p">,</span>sd<span class="o">=</span>stdDev<span class="p">)</span>
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> qnorm<span class="p">(</span><span class="m">0.95</span><span class="p">,</span>sd<span class="o">=</span>stdDev<span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>type<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span>xaxt<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;p&quot;</span><span class="p">,</span>
<span class="go">       xlab=expression(paste(&#39;Assumed Distribution of &#39;,bar(x))),</span>
<span class="go">       axes=FALSE,ylim=c(0,max(y)*1.05),xlim=c(min(x),max(x)),</span>
<span class="go">       frame.plot=FALSE)</span>
<span class="gp">&gt; </span>axis<span class="p">(</span><span class="m">1</span><span class="p">,</span>at<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span>right<span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">),</span>
<span class="go">       pos = c(0,0),</span>
<span class="go">       labels=c(expression(&#39; &#39;),expression(bar(x)[cr]),expression(mu[0]),expression(&#39; &#39;)))</span>
<span class="gp">&gt; </span>axis<span class="p">(</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>xReject <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span>right<span class="p">,</span><span class="m">5</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.01</span><span class="p">)</span>
<span class="gp">&gt; </span>yReject <span class="o">&lt;-</span> dnorm<span class="p">(</span>xReject<span class="p">,</span>sd<span class="o">=</span>stdDev<span class="p">)</span>
<span class="gp">&gt; </span>polygon<span class="p">(</span><span class="kt">c</span><span class="p">(</span>xReject<span class="p">,</span>xReject<span class="p">[</span><span class="kp">length</span><span class="p">(</span>xReject<span class="p">)],</span>xReject<span class="p">[</span><span class="m">1</span><span class="p">]),</span>
<span class="go">          c(yReject,0, 0), col=&#39;red&#39;)</span>
</pre></div>
</div>
<div class="align-center figure" id="id10">
<span id="figure6-intermediateplotting"></span><img alt="Example of a shaded region" src="http://www.cyclismo.org/tutorial/R/_images/rejectionRegion.png" />
<p class="caption"><span class="caption-text">Figure 6.</span></p>
<div class="legend">
Using <em>polygon</em> to produce a shaded region.</div>
</div>
<p>The axes are drawn separately. This is done by first suppressing the
plotting of the axes in the <em>plot</em> command, and the horizontal axis is
drawn separately. Also note that the <em>expression</em> command is used to
plot a Greek character and also produce subscripts.</p>
</div>
<div class="section" id="plotting-a-surface">
<h4><a class="toc-backref" href="#id22">6.1.8. Plotting a Surface</a></h4>
<p>Finally, a brief example of how to plot a surface is given. The
<em>persp</em> command will plot a surface with a specified perspective. In
the example, a grid is defined by multiplying a row and column vector
to give the <em>x</em> and then the <em>y</em> values for a grid. Once that is done
a sine function is specified on the grid, and the <em>persp</em> command is
used to plot it.</p>
<span class="target" id="index-22"></span><div class="highlight-rconsole" id="index-23"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">2</span><span class="o">*</span><span class="kc">pi</span><span class="p">,</span>by<span class="o">=</span><span class="kc">pi</span><span class="o">/</span><span class="m">100</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> x
<span class="gp">&gt; </span>xg <span class="o">&lt;-</span> <span class="p">(</span>x<span class="o">*</span><span class="m">0+1</span><span class="p">)</span> <span class="o">%*%</span> <span class="kp">t</span><span class="p">(</span>y<span class="p">)</span>
<span class="gp">&gt; </span>yg <span class="o">&lt;-</span> <span class="p">(</span>x<span class="p">)</span> <span class="o">%*%</span> <span class="kp">t</span><span class="p">(</span>y<span class="o">*</span><span class="m">0+1</span><span class="p">)</span>
<span class="gp">&gt; </span>f <span class="o">&lt;-</span> <span class="kp">sin</span><span class="p">(</span>xg<span class="o">+</span>yg<span class="p">)</span>
<span class="gp">&gt; </span>persp<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>f<span class="p">,</span>theta<span class="o">=</span><span class="m">-10</span><span class="p">,</span>phi<span class="o">=</span><span class="m">40</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>The %*% notation is used to perform matrix multiplication.</p>
</div>
</div>
<div class="section" id="discrete-data">
<h3><a class="toc-backref" href="#id13">6.2. Discrete Data</a></h3>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#barplot" id="id23">Barplot</a></li>
<li><a href="#mosaic-plot" id="id24">Mosaic Plot</a></li>
</ul>
</div>
<p>In the examples below a data set is defined using R&#8217;s hypergeometric
random number generator.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>numberWhite <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>numberChipped <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="barplot">
<h4><a class="toc-backref" href="#id23">6.2.1. Barplot</a></h4>
<p>The plot command will try to produce the appropriate plots based on
the data type. The data that is defined above, though, is numeric
data. You need to convert the data to factors to make sure that the
plot command treats it in an appropriate way. The <em>as.factor</em> command
is used to cast the data as factors and ensures that R treats it as
discrete data.</p>
<span class="target" id="index-24"></span><span class="target" id="index-25"></span><span class="target" id="index-26"></span><div class="highlight-rconsole" id="index-27"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>numberWhite <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>numberWhite <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span>numberWhite<span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>numberWhite<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>In this case R will produce a barplot. The <em>barplot</em> command can also
be used to create a barplot. The <em>barplot</em> command requires a vector of
heights, though, and you cannot simply give it the raw data. The
frequencies for the <em>barplot</em> command can be easily calculated using
the <em>table</em> command.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>numberWhite <span class="o">&lt;-</span> rhyper<span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>totals <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>numberWhite<span class="p">)</span>
<span class="gp">&gt; </span>totals
<span class="go">numberWhite</span>
<span class="go">0  1  2  3</span>
<span class="go">4 13 11  2</span>
<span class="gp">&gt; </span>barplot<span class="p">(</span>totals<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Number Draws&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Frequency&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Draws&quot;</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>In the previous example the <em>barplot</em> command is used to set the title
for the plot and the labels for the axes. The labels on the ticks for
the horizontal axis are automatically generated using the labels on
the table. You can change the labels by setting the row names of the
table.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>totals <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>numberWhite<span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">rownames</span><span class="p">(</span>totals<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="s">&quot;three&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>totals
<span class="go">numberWhite</span>
<span class="go">none   one   two three</span>
<span class="go">4      13    11     2</span>
<span class="gp">&gt; </span>barplot<span class="p">(</span>totals<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Number Draws&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Frequency&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Draws&quot;</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>The order of the frequencies is the same as the order in the table. If
you change the order in the table it will change the way it appears in
the barplot. For example, if you wish to arrange the frequencies in
descending order you can use the <em>sort</em> command with the <em>decreasing</em>
option set to <em>TRUE</em>.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>barplot<span class="p">(</span><span class="kp">sort</span><span class="p">(</span>totals<span class="p">,</span>decreasing<span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span>main<span class="o">=</span><span class="s">&quot;Number Draws&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Frequency&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Draws&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The indexing features of R can be used to change the order of the
frequencies manually.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>totals
<span class="go">numberWhite</span>
<span class="go"> none   one   two three</span>
<span class="go">   4    13    11     2</span>
<span class="gp">&gt; </span><span class="kp">sort</span><span class="p">(</span>totals<span class="p">,</span>decreasing<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="go">numberWhite</span>
<span class="go"> one   two  none three</span>
<span class="go">  13    11     4     2</span>
<span class="gp">&gt; </span>totals<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">)]</span>
<span class="go">numberWhite</span>
<span class="go"> two  none three   one</span>
<span class="go">  11     4     2    13</span>
<span class="gp">&gt; </span>barplot<span class="p">(</span>totals<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">)])</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>The <em>barplot</em> command returns the horizontal locations of the
bars. Using the locations and putting together the previous ideas a
Pareto Chart can be constructed.</p>
<div class="highlight-rconsole" id="index-28"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>xLoc <span class="o">=</span> barplot<span class="p">(</span><span class="kp">sort</span><span class="p">(</span>totals<span class="p">,</span>decreasing<span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span>main<span class="o">=</span><span class="s">&quot;Number Draws&quot;</span><span class="p">,</span>
<span class="go">           ylab=&quot;Frequency&quot;,xlab=&quot;Draws&quot;,ylim=c(0,sum(totals)+2))</span>
<span class="gp">&gt; </span>points<span class="p">(</span>xLoc<span class="p">,</span><span class="kp">cumsum</span><span class="p">(</span><span class="kp">sort</span><span class="p">(</span>totals<span class="p">,</span>decreasing<span class="o">=</span><span class="kc">TRUE</span><span class="p">)),</span>type<span class="o">=</span><span class="s">&#39;p&#39;</span><span class="p">,</span>col<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>points<span class="p">(</span>xLoc<span class="p">,</span><span class="kp">cumsum</span><span class="p">(</span><span class="kp">sort</span><span class="p">(</span>totals<span class="p">,</span>decreasing<span class="o">=</span><span class="kc">TRUE</span><span class="p">)),</span>type<span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="mosaic-plot">
<h4><a class="toc-backref" href="#id24">6.2.2. Mosaic Plot</a></h4>
<p>Mosaic plots are used to display proportions for tables that are
divided into two or more conditional distributions. Here we focus on
two way tables to keep things simpler. It is assumed that you are
familiar with using tables in R (see the section on two way tables for
more information: <a class="reference internal" href="tables.html#twowaytables"><span>Two Way Tables</span></a>).</p>
<p>Here we will use a made up data set primarily to make it easier to
figure out what R is doing. The fictitious data set is defined
below. The idea is that sixteen children of age eight are
interviewed. They are asked two questions. The first question is, &#8220;do
you believe in Santa Claus.&#8221; If they say that they do then the term
&#8220;belief&#8221; is recorded, otherwise the term &#8220;no belief&#8221; is recorded. The
second question is whether or not they have an older brother, older
sister, or no older sibling. (We are keeping it simple here!) The
answers that are recorded are &#8220;older brother,&#8221; &#8220;older sister,&#8221; or &#8220;no
older sibling.&#8221;</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>santa <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>belief<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;no belief&#39;</span><span class="p">,</span><span class="s">&#39;no belief&#39;</span><span class="p">,</span><span class="s">&#39;no belief&#39;</span><span class="p">,</span><span class="s">&#39;no belief&#39;</span><span class="p">,</span>
<span class="go">                               &#39;belief&#39;,&#39;belief&#39;,&#39;belief&#39;,&#39;belief&#39;,</span>
<span class="go">                               &#39;belief&#39;,&#39;belief&#39;,&#39;no belief&#39;,&#39;no belief&#39;,</span>
<span class="go">                               &#39;belief&#39;,&#39;belief&#39;,&#39;no belief&#39;,&#39;no belief&#39;),</span>
<span class="go">                      sibling=c(&#39;older brother&#39;,&#39;older brother&#39;,&#39;older brother&#39;,&#39;older sister&#39;,</span>
<span class="go">                                &#39;no older sibling&#39;,&#39;no older sibling&#39;,&#39;no older sibling&#39;,&#39;older sister&#39;,</span>
<span class="go">                                &#39;older brother&#39;,&#39;older sister&#39;,&#39;older brother&#39;,&#39;older sister&#39;,</span>
<span class="go">                                &#39;no older sibling&#39;,&#39;older sister&#39;,&#39;older brother&#39;,&#39;no older sibling&#39;)</span>
<span class="go">                      )</span>
<span class="go"> &gt; santa</span>
<span class="go">       belief          sibling</span>
<span class="go"> 1  no belief    older brother</span>
<span class="go"> 2  no belief    older brother</span>
<span class="go"> 3  no belief    older brother</span>
<span class="go"> 4  no belief     older sister</span>
<span class="go"> 5     belief no older sibling</span>
<span class="go"> 6     belief no older sibling</span>
<span class="go"> 7     belief no older sibling</span>
<span class="go"> 8     belief     older sister</span>
<span class="go"> 9     belief    older brother</span>
<span class="go"> 10    belief     older sister</span>
<span class="go"> 11 no belief    older brother</span>
<span class="go"> 12 no belief     older sister</span>
<span class="go"> 13    belief no older sibling</span>
<span class="go"> 14    belief     older sister</span>
<span class="go"> 15 no belief    older brother</span>
<span class="go"> 16 no belief no older sibling</span>
<span class="go"> &gt;  summary(santa)</span>
<span class="go">   belief              sibling</span>
<span class="go"> belief   :8   no older sibling:5</span>
<span class="go"> no belief:8   older brother   :6</span>
<span class="go">               older sister    :5</span>
</pre></div>
</div>
<p>The data is given as strings, so R will automatically treat them as
categorical data, and the data types are <em>factors</em>. If you plot the
individual data sets, the plot command will default to producing
barplots.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>santa<span class="o">$</span>belief<span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>santa<span class="o">$</span>sibling<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>If you provide both data sets it will automatically produce a mosaic
plot which demonstrates the relative frequencies in terms of the
resulting areas.</p>
<div class="highlight-rconsole" id="index-29"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>santa<span class="o">$</span>sibling<span class="p">,</span>santa<span class="o">$</span>belief<span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>santa<span class="o">$</span>belief<span class="p">,</span>santa<span class="o">$</span>sibling<span class="p">)</span>
</pre></div>
</div>
<p>The <em>mosaicplot</em> command can be called directly</p>
<div class="highlight-rconsole" id="index-30"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>totals <span class="o">=</span> <span class="kp">table</span><span class="p">(</span>santa<span class="o">$</span>belief<span class="p">,</span>santa<span class="o">$</span>sibling<span class="p">)</span>
<span class="gp">&gt; </span>totals

<span class="go">            no older sibling older brother older sister</span>
<span class="go">  belief                   4             1            3</span>
<span class="go">  no belief                1             5            2</span>
<span class="gp">&gt; </span>mosaicplot<span class="p">(</span>totals<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Older Brothers are Jerks&quot;</span><span class="p">,</span>
<span class="go">              xlab=&quot;Belief in Santa Claus&quot;,ylab=&quot;Older Sibling&quot;)</span>
</pre></div>
</div>
<p>The colours of the plot can be specified by setting the <em>col</em>
argument.  The argument is a vector of colours used for the rows. See
Fgure :ref`figure7_intermediatePlotting` for an example.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>mosaicplot<span class="p">(</span>totals<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Older Brothers are Jerks&quot;</span><span class="p">,</span>
<span class="go">              xlab=&quot;Belief in Santa Claus&quot;,ylab=&quot;Older Sibling&quot;,</span>
<span class="go">              col=c(2,3,4))</span>
</pre></div>
</div>
<div class="align-center figure" id="id11">
<span id="figure7-intermediateplotting"></span><img alt="Example of a mosaic plot" src="http://www.cyclismo.org/tutorial/R/_images/santaClaus.png" />
<p class="caption"><span class="caption-text">Figure 7.</span></p>
<div class="legend">
Example of a mosaic plot with colours.</div>
</div>
<p>The labels and the order that they appear in the plot can be changed
in exactly the same way as given in the examples for barplot above.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">rownames</span><span class="p">(</span>totals<span class="p">)</span>
<span class="go">[1] &quot;belief&quot;    &quot;no belief&quot;</span>
<span class="gp">&gt; </span><span class="kp">colnames</span><span class="p">(</span>totals<span class="p">)</span>
<span class="go">[1] &quot;no older sibling&quot; &quot;older brother&quot;    &quot;older sister&quot;</span>
<span class="gp">&gt; </span><span class="kp">rownames</span><span class="p">(</span>totals<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Believes&quot;</span><span class="p">,</span><span class="s">&quot;Does not Believe&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">colnames</span><span class="p">(</span>totals<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;No Older&quot;</span><span class="p">,</span><span class="s">&quot;Older Brother&quot;</span><span class="p">,</span><span class="s">&quot;Older Sister&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>totals

<span class="go">                   No Older Older Brother Older Sister</span>
<span class="go">  Believes                4             1            3</span>
<span class="go">  Does not Believe        1             5            2</span>
<span class="gp">&gt; </span>mosaicplot<span class="p">(</span>totals<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Older Brothers are Jerks&quot;</span><span class="p">,</span>
<span class="go">              xlab=&quot;Belief in Santa Claus&quot;,ylab=&quot;Older Sibling&quot;)</span>
</pre></div>
</div>
<p>When changing the order keep in mind that the table is a two
dimensional array. The indices must include both rows and columns, and
the transpose command (<em>t</em>) can be used to switch how it is plotted
with respect to the vertical and horizontal axes.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>totals

<span class="go">                   No Older Older Brother Older Sister</span>
<span class="go">  Believes                4             1            3</span>
<span class="go">  Does not Believe        1             5            2</span>
<span class="gp">&gt; </span>totals<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">)]</span>

<span class="go">                   Older Brother Older Sister No Older</span>
<span class="go">  Does not Believe             5            2        1</span>
<span class="go">  Believes                     1            3        4</span>
<span class="gp">&gt; </span>mosaicplot<span class="p">(</span>totals<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">)],</span>main<span class="o">=</span><span class="s">&quot;Older Brothers are Jerks&quot;</span><span class="p">,</span>
<span class="go">       xlab=&quot;Belief in Santa Claus&quot;,ylab=&quot;Older Sibling&quot;,col=c(2,3,4))</span>
<span class="gp">&gt; </span>mosaicplot<span class="p">(</span><span class="kp">t</span><span class="p">(</span>totals<span class="p">),</span>main<span class="o">=</span><span class="s">&quot;Older Brothers are Jerks&quot;</span><span class="p">,</span>
<span class="go">       ylab=&quot;Belief in Santa Claus&quot;,xlab=&quot;Older Sibling&quot;,col=c(2,3))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="miscellaneous-options">
<h3><a class="toc-backref" href="#id14">6.3. Miscellaneous Options</a></h3>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#multiple-representations-on-one-plot" id="id25">Multiple Representations On One Plot</a></li>
<li><a href="#multiple-windows" id="id26">Multiple Windows</a></li>
<li><a href="#print-to-a-file" id="id27">Print To A File</a></li>
<li><a href="#annotation-and-formatting" id="id28">Annotation and Formatting</a></li>
</ul>
</div>
<p>The previous examples only provide a slight hint at what is
possible. Here we give some examples that provide a demonstration of
the way the different commands can be combined and the options that
allow them to be used together.</p>
<div class="section" id="multiple-representations-on-one-plot">
<h4><a class="toc-backref" href="#id25">6.3.1. Multiple Representations On One Plot</a></h4>
<p>First, an example of a histogram with an approximation of the density
function is given. In addition to the density function a horizontal
boxplot is added to the plot with a rug representation of the data on
the horizontal axis. The horizontal bounds on the histogram will be
specified. The boxplot must be <em>added</em> to the histogram, and it will
be raised above the histogram.</p>
<span class="target" id="index-31"></span><span class="target" id="index-32"></span><div class="highlight-rconsole" id="index-33"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> rexp<span class="p">(</span><span class="m">20</span><span class="p">,</span>rate<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>x<span class="p">,</span>ylim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">18</span><span class="p">),</span>main<span class="o">=</span><span class="s">&quot;This Are An Histogram&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;X&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>boxplot<span class="p">(</span>x<span class="p">,</span>at<span class="o">=</span><span class="m">16</span><span class="p">,</span>horizontal<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>add<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span>rug<span class="p">(</span>x<span class="p">,</span>side<span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="gp">&gt; </span>d <span class="o">=</span> density<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>points<span class="p">(</span>d<span class="p">,</span>type<span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span>col<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-windows">
<span id="multiplewindows"></span>
<h4><a class="toc-backref" href="#id26">6.3.2. Multiple Windows</a></h4>
<p>The <em>dev</em> commands allow you to create and manipulate multiple
graphics windows. You can create new windows using the <em>dev.new()</em>
command, and you can choose which one to make active using the
<em>dev.set()</em> command. The <em>dev.list()</em>, <em>dev.next()</em>, and <em>dev.prev()</em>
command can be used to list the graphical devices that are available.</p>
<p>In the following example three devices are created. They are listed,
and different plots are created on the different devices.</p>
<span class="target" id="index-34"></span><span class="target" id="index-35"></span><span class="target" id="index-36"></span><span class="target" id="index-37"></span><div class="highlight-rconsole" id="index-38"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>dev.new<span class="p">()</span>
<span class="gp">&gt; </span>dev.new<span class="p">()</span>
<span class="gp">&gt; </span>dev.new<span class="p">()</span>
<span class="gp">&gt; </span>dev.list<span class="p">()</span>
<span class="go">X11cairo X11cairo X11cairo</span>
<span class="go">       2        3        4</span>
<span class="gp">&gt; </span>dev.set<span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="go">X11cairo</span>
<span class="go">       3</span>
<span class="gp">&gt; </span>x <span class="o">=</span> rnorm<span class="p">(</span><span class="m">20</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>dev.set<span class="p">(</span><span class="m">2</span><span class="p">)</span>
<span class="go">X11cairo</span>
<span class="go">       2</span>
<span class="gp">&gt; </span>boxplot<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>dev.set<span class="p">(</span><span class="m">4</span><span class="p">)</span>
<span class="go">X11cairo</span>
<span class="go">       4</span>
<span class="gp">&gt; </span>qqnorm<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>qqline<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>dev.next<span class="p">()</span>
<span class="go">X11cairo</span>
<span class="go">       2</span>
<span class="gp">&gt; </span>dev.set<span class="p">(</span>dev.next<span class="p">())</span>
<span class="go">X11cairo</span>
<span class="go">       2</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>density<span class="p">(</span>x<span class="p">))</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="print-to-a-file">
<h4><a class="toc-backref" href="#id27">6.3.3. Print To A File</a></h4>
<p>There are a couple ways to print a plot to a file. It is important to
be able to work with graphics devices as shown in the previous
subsection (<a class="reference internal" href="#multiplewindows"><span>Multiple Windows</span></a>). The first way explored is to use
the <em>dev.print</em> command. This command will print a copy of the
currently active device, and the format is defined by the <em>device</em>
argument.</p>
<p>In the example below, the current window is printed to a png file
called &#8220;hist.png&#8221; that is 200 pixels wide.</p>
<div class="highlight-rconsole" id="index-39"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> rnorm<span class="p">(</span><span class="m">100</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>dev.print<span class="p">(</span>device<span class="o">=</span>png<span class="p">,</span>width<span class="o">=</span><span class="m">200</span><span class="p">,</span><span class="s">&quot;hist.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>To find out what devices are available on your system use the <em>help</em>
command.</p>
<div class="highlight-rconsole" id="index-40"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>device<span class="p">)</span>
</pre></div>
</div>
<p>Another way to print to a file is to create a device in the same way
as the graphical devices were created in the previous section. Once
the device is created, the various plot commands are given, and then
the device is turned off to write the results to a file.</p>
<div class="highlight-rconsole" id="index-41"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>png<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;hist.png&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>x<span class="p">)</span>
<span class="gp">&gt; </span>rug<span class="p">(</span>x<span class="p">,</span>side<span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="gp">&gt; </span>dev.off<span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="annotation-and-formatting">
<h4><a class="toc-backref" href="#id28">6.3.4. Annotation and Formatting</a></h4>
<p>Basic annotation can be performed in the regular plotting
commmands. For example, there are options to specify labels on axes as
well as titles. More options are available using the <em>axis</em> command.</p>
<p>Most of the primary plotting commands have an option to turn off the
generation of the axes using the <em>axes=FALSE</em> option. The axes can be
then added using the <em>axis</em> command which allows for a greater number
of options.</p>
<p>In the example below a bivariate set of random numbers are generated
and plotted as a scatter plot. The axes are added, but the horizontal
axis is located in the center of the data rather than at the bottom of
the figure. Note that the horizontal and vertical axes are added
separately, and are specified using the first argument to the
command. (Use <em>help(axis)</em> for a full list of options.)</p>
<span class="target" id="index-42"></span><div class="highlight-rconsole" id="index-43"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> <span class="m">3</span><span class="o">*</span>x<span class="m">-1</span><span class="o">+</span>rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="go">   summary(x)</span>
<span class="go">    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go"> -6.1550 -1.9280  1.2000 -0.1425  2.4780  3.1630</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>y<span class="p">)</span>
<span class="go">    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.</span>
<span class="go">-17.9800  -9.0060   0.7057  -1.2060   8.2600  10.9200</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>axes<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span>col<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>axis<span class="p">(</span><span class="m">1</span><span class="p">,</span>pos<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span>at<span class="o">=</span><span class="kp">seq</span><span class="p">(</span><span class="m">-7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span>by<span class="o">=</span><span class="m">1</span><span class="p">))</span>
<span class="gp">&gt; </span>axis<span class="p">(</span><span class="m">2</span><span class="p">,</span>pos<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span>at<span class="o">=</span><span class="kp">seq</span><span class="p">(</span><span class="m">-18</span><span class="p">,</span><span class="m">11</span><span class="p">,</span>by<span class="o">=</span><span class="m">2</span><span class="p">))</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>In the previous example the <em>at</em> option is used to specify the tick marks.</p>
<p>When using the <em>plot</em> command the default behavior is to draw an
axis as well as draw a box around the plotting area. The drawing of
the box can be suppressed using the <em>bty</em> option. The value can be
&#8220;o,&#8221; &#8220;l,&#8221; &#8220;7,&#8221; &#8220;c,&#8221; &#8220;u&#8221;, &#8220;],&#8221; or &#8220;n.&#8221; (The lines drawn roughly look
like the letter given except for &#8220;n&#8221; which draws no lines.)
The box can be drawn later using the <em>box</em> command as well.</p>
<span class="target" id="index-44"></span><div class="highlight-rconsole" id="index-45"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> <span class="m">3</span><span class="o">*</span>x<span class="m">-1</span><span class="o">+</span>rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>bty<span class="o">=</span><span class="s">&quot;7&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">,</span>bty<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>box<span class="p">(</span>lty<span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>The <em>par</em> command can be used to set the default values for various
parameters. A couple are given below. In the example below the default
background is set to grey, no box will be drawn around the window, and
the margins for the axes will be twice the normal size.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>par<span class="p">(</span>bty<span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>par<span class="p">(</span>bg<span class="o">=</span><span class="s">&quot;gray&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>par<span class="p">(</span>mex<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> <span class="m">3</span><span class="o">*</span>x<span class="m">-1</span><span class="o">+</span>rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>Another common task is to place a text string on the plot. The <em>text</em>
command takes a coordinate and a label, and it places the label at the
given coordinate. The <em>text</em> command has options for setting the
offset, size, font, and other options. In the example below the label
&#8220;numbers!&#8221; is placed on the plot. Use <em>help(text)</em> to see more
options.</p>
<div class="highlight-rconsole" id="index-46"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> <span class="m">3</span><span class="o">*</span>x<span class="m">-1</span><span class="o">+</span>rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>text<span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">-2</span><span class="p">,</span><span class="s">&quot;numbers!&quot;</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>The default text command will cut off any characters outside of the
plot area.  This behavior can be overridden using the <em>xpd</em> option.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="gp">&gt; </span>y <span class="o">&lt;-</span> <span class="m">3</span><span class="o">*</span>x<span class="m">-1</span><span class="o">+</span>rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span>mean<span class="o">=</span><span class="m">0</span><span class="p">,</span>sd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="gp">&gt; </span>text<span class="p">(</span><span class="m">-7</span><span class="p">,</span><span class="m">-2</span><span class="p">,</span><span class="s">&quot;outside the area&quot;</span><span class="p">,</span>xpd<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
</div>


<h2></h2>
<h2>7. Indexing Into Vectors</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#indexing-with-logicals" id="id1">Indexing With Logicals</a></li>
<li><a href="#not-available-or-missing-values" id="id2">Not Available or Missing Values</a></li>
<li><a href="#indices-with-logical-expression" id="id3">Indices With Logical Expression</a></li>
</ul>
</div>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><p id="index-2">Given a vector of data one common task is to isolate particular
entries or censor items that meet some criteria. Here we show how to
use R&#8217;s indexing notation to pick out specific items within a vector.</p>
<div class="section" id="indexing-with-logicals">
<h3><a class="toc-backref" href="#id1">7.1. Indexing With Logicals</a></h3>
<p id="index-3">We first give an example of how to select specific items in a
vector. The first step is to define a vector of data, and the second
step is to define a vector made up of logical values. When the vector
of logical values is used for the index into the vector of data values
only the items corresponding to the variables that evaluate to <em>TRUE</em>
are returned:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="gp">&gt; </span>a<span class="p">[</span>b<span class="p">]</span>
<span class="go">[1] 1 4</span>
<span class="gp">&gt; </span><span class="kp">max</span><span class="p">(</span>a<span class="p">[</span>b<span class="p">])</span>
<span class="go">[1] 4</span>
<span class="gp">&gt; </span><span class="kp">sum</span><span class="p">(</span>a<span class="p">[</span>b<span class="p">])</span>
<span class="go">[1] 5</span>
</pre></div>
</div>
</div>
<div class="section" id="not-available-or-missing-values">
<h3><a class="toc-backref" href="#id2">7.2. Not Available or Missing Values</a></h3>
<span class="target" id="index-4"></span><span class="target" id="index-5"></span><p id="index-6">One common problem is data entries that are marked <em>NA</em> or not
available. There is a predefined variable called <em>NA</em> that can be used
to indicate missing information. The problem with this is that some
functions throw an error if one of the entries in the data is NA. Some
functions allow you to ignore the missing values through special
options:</p>
<div class="highlight-rconsole" id="index-7"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="kc">NA</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">[1]  1  2  3  4 NA</span>
<span class="gp">&gt; </span><span class="kp">sum</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] NA</span>
<span class="gp">&gt; </span><span class="kp">sum</span><span class="p">(</span>a<span class="p">,</span>na.rm<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="go">[1] 10</span>
</pre></div>
</div>
<p id="index-8">There are other times, though, when this option is not available, or
you simply want to censor them. The <em>is.na</em> function can be used to
determine which items are not available. The logical &#8220;not&#8221; operator in
R is the <em>!</em> symbol. When used with the indexing notation the items
within a vector that are <em>NA</em> can be easily removed:</p>
<span class="target" id="index-9"></span><span class="target" id="index-10"></span><div class="highlight-rconsole" id="index-11"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="kc">NA</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">is.na</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] FALSE FALSE FALSE FALSE  TRUE</span>
<span class="gp">&gt; </span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1]  TRUE  TRUE  TRUE  TRUE FALSE</span>
<span class="gp">&gt; </span>a<span class="p">[</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>a<span class="p">)]</span>
<span class="go">[1] 1 2 3 4</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> a<span class="p">[</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>a<span class="p">)]</span>
<span class="gp">&gt; </span>b
<span class="go">[1] 1 2 3 4</span>
</pre></div>
</div>
</div>
<div class="section" id="indices-with-logical-expression">
<h3><a class="toc-backref" href="#id3">7.3. Indices With Logical Expression</a></h3>
<p id="index-12">Any logical expression can be used as an index which opens a wide
range of possibilities. For example, you can remove or focus on
entries that match specific criteria. For example, you might want to
remove all entries that are above a certain value:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">[1] 6 2 5 3 8 2</span>
<span class="gp">&gt; </span>b <span class="o">=</span> a<span class="p">[</span>a<span class="o">&lt;</span><span class="m">6</span><span class="p">]</span>
<span class="gp">&gt; </span>b
<span class="go">[1] 2 5 3 2</span>
</pre></div>
</div>
<p>For another example, suppose you want to join together the values that
match two different factors in another vector:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>d <span class="o">=</span> <span class="kt">data.frame</span><span class="p">(</span>one<span class="o">=</span><span class="kp">as.factor</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">)),</span>
<span class="go">                two=c(1,2,3,4,5,6))</span>
<span class="gp">&gt; </span>d
<span class="go">  one two</span>
<span class="go">1   a   1</span>
<span class="go">2   a   2</span>
<span class="go">3   b   3</span>
<span class="go">4   b   4</span>
<span class="go">5   c   5</span>
<span class="go">6   c   6</span>
<span class="gp">&gt; </span>both <span class="o">=</span> d<span class="o">$</span>two<span class="p">[(</span>d<span class="o">$</span>one<span class="o">==</span><span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>d<span class="o">$</span>one<span class="o">==</span><span class="s">&#39;b&#39;</span><span class="p">)]</span>
<span class="gp">&gt; </span>both
<span class="go">[1] 1 2 3 4</span>
</pre></div>
</div>
<p>Note that a single &#8216;|&#8217; was used in the previous example. There is a
difference between &#8216;||&#8217; and &#8216;|&#8217;. A single bar will perform a vector
operation, term by term, while a double bar will evaluate to a single
TRUE or FALSE result:</p>
<span class="target" id="index-13"></span><span class="target" id="index-14"></span><span class="target" id="index-15"></span><div class="highlight-rconsole" id="index-16"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span><span class="o">|</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span>
<span class="go">[1] TRUE TRUE</span>
<span class="gp">&gt; </span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span><span class="o">||</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span>
<span class="go">[1] TRUE</span>
<span class="gp">&gt; </span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span><span class="o">&amp;</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span>
<span class="go">[1] FALSE  TRUE</span>
<span class="gp">&gt; </span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span>
<span class="go">[1] FALSE</span>
</pre></div>
</div>


<h2></h2>
<h2>8. Linear Least Squares Regression</h2>
<span class="target" id="index-0"></span><p id="index-1">Here we look at the most basic linear least squares regression. The
main purpose is to provide an example of the basic commands. It is
assumed that you know how to enter data or read data files which is
covered in the first chapter, and it is assumed that you are familiar
with the different data types.</p>
<p>We will examine the interest rate for four year car loans, and the
data that we use comes from the
<a class="reference external" href="http://www.cyclismo.org/tutorial/R/http://www.federalreserve.gov/releases/g19/20050805/">U.S. Federal Reserve&#8217;s mean rates</a> .
We are looking at and plotting means. This, of course, is a very bad
thing because it removes a lot of the variance and is misleading. The
only reason that we are working with the data in this way is to
provide an example of linear regression that does not use too many
data points. Do not try this without a professional near you, and if a
professional is not near you do not tell anybody you did this. They
will laugh at you. People are mean, especially professionals.</p>
<p>The first thing to do is to specify the data. Here there are only five
pairs of numbers so we can enter them in manually. Each of the five
pairs consists of a year and the mean interest rate:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>year <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2000</span> <span class="p">,</span>   <span class="m">2001</span>  <span class="p">,</span>  <span class="m">2002</span>  <span class="p">,</span>  <span class="m">2003</span> <span class="p">,</span>   <span class="m">2004</span><span class="p">)</span>
<span class="gp">&gt; </span>rate <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">9.34</span> <span class="p">,</span>   <span class="m">8.50</span>  <span class="p">,</span>  <span class="m">7.62</span>  <span class="p">,</span>  <span class="m">6.93</span>  <span class="p">,</span>  <span class="m">6.60</span><span class="p">)</span>
</pre></div>
</div>
<p>The next thing we do is take a look at the data. We first plot the
data using a scatter plot and notice that it looks linear. To confirm
our suspicions we then find the correlation between the year and the
mean interest rates:</p>
<span class="target" id="index-2"></span><div class="highlight-rconsole" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>year<span class="p">,</span>rate<span class="p">,</span>
<span class="go">     main=&quot;Commercial Banks Interest Rate for 4 Year Car Loan&quot;,</span>
<span class="go">     sub=&quot;http://www.federalreserve.gov/releases/g19/20050805/&quot;)</span>
<span class="gp">&gt; </span>cor<span class="p">(</span>year<span class="p">,</span>rate<span class="p">)</span>
<span class="go">[1] -0.9880813</span>
</pre></div>
</div>
<div>
<pre>

<b class="goldword">exercise</b>:
year <- c(2000 ,   2001  ,  2002  ,  2003 ,   2004)
rate <- c(9.34 ,   8.50  ,  7.62  ,  6.93  ,  6.60)

plot(year,rate,
     main="Commercial Banks Interest Rate for 4 Year Car Loan",
     sub="http://www.federalreserve.gov/releases/g19/20050805/")
cor(year,rate)

fit <- lm(rate ~ year)
fit

attributes(fit)
names(fit)
length(fit)

fit$coefficients[[2]]*2015+fit$coefficients[[1]]
</pre>
</div>
<p>At this point we should be excited because associations that strong
never happen in the real world unless you cook the books or work with
averaged data. The next question is what straight line comes &#8220;closest&#8221;
to the data? In this case we will use least squares regression as one
way to determine the line.</p>
<p>Before we can find the least square regression line we have to make
some decisions. First we have to decide which is the explanatory and
which is the response variable. Here, we arbitrarily pick the
explanatory variable to be the year, and the response variable is the
interest rate. This was chosen because it seems like the interest rate
might change in time rather than time changing as the interest rate
changes. (We could be wrong, finance is very confusing.)</p>
<p>The command to perform the least square regression is the <em>lm</em>
command. The command has many options, but we will keep it simple and
not explore them here. If you are interested use the <em>help(lm)</em> command
to learn more. Instead the only option we examine is the one necessary
argument which specifies the relationship.</p>
<p>Since we specified that the interest rate is the response variable and
the year is the explanatory variable this means that the regression
line can be written in slope-intercept form:</p>
<div class="math" id="index-4">
\[rate = (slope) year + (intercept)\]</div>
<p>The way that this relationship is defined in the <em>lm</em> command is that
you write the vector containing the response variable, a tilde (&#8220;~&#8221;),
and a vector containing the explanatory variable:</p>
<div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>fit <span class="o">&lt;-</span> lm<span class="p">(</span>rate <span class="o">~</span> year<span class="p">)</span>
<span class="gp">&gt; </span>fit
<span class="go">Call:</span>
<span class="go">lm(formula = rate ~ year)</span>

<span class="go">Coefficients:</span>
<span class="go">(Intercept)         year</span>
<span class="go">   1419.208       -0.705</span>
</pre></div>
</div>
<p>When you make the call to <em>lm</em> it returns a variable with a lot of
information in it. If you are just learning about least squares
regression you are probably only interested in two things at this
point, the slope and the y-intercept. If you just type the name of the
variable returned by <em>lm</em> it will print out this minimal information to
the screen. (See above.)</p>
<p>If you would like to know what else is stored in the variable you can
use the attributes command:</p>
<div class="highlight-rconsole" id="index-6"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">attributes</span><span class="p">(</span>fit<span class="p">)</span>
<span class="go">$names</span>
<span class="go"> [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;</span>
<span class="go"> [5] &quot;fitted.values&quot; &quot;assign&quot;        &quot;qr&quot;            &quot;df.residual&quot;</span>
<span class="go"> [9] &quot;xlevels&quot;       &quot;call&quot;          &quot;terms&quot;         &quot;model&quot;</span>

<span class="go">$class</span>
<span class="go">[1] &quot;lm&quot;</span>
</pre></div>
</div>
<p>One of the things you should notice is the coefficients variable
within fit. You can print out the y-intercept and slope by accessing
this part of the variable:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>fit<span class="o">$</span>coefficients<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">(Intercept)</span>
<span class="go">   1419.208</span>
<span class="gp">&gt; </span>fit<span class="o">$</span>coefficients<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="go">[1] 1419.208</span>
<span class="gp">&gt; </span>fit<span class="o">$</span>coefficients<span class="p">[</span><span class="m">2</span><span class="p">]</span>
<span class="go">  year</span>
<span class="go">-0.705</span>
<span class="gp">&gt; </span>fit<span class="o">$</span>coefficients<span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
<span class="go">[1] -0.705</span>
</pre></div>
</div>
<p>Note that if you just want to get the number you should use two square
braces. So if you want to get an estimate of the interest rate in the
year 2015 you can use the formula for a line:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>fit<span class="o">$</span>coefficients<span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="o">*</span><span class="m">2015</span><span class="o">+</span>fit<span class="o">$</span>coefficients<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="go">[1] -1.367</span>
</pre></div>
</div>
<p>So if you just wait long enough, the banks will pay you to take a car!</p>
<p>A better use for this formula would be to calculate the residuals and
plot them:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>res <span class="o">&lt;-</span> rate <span class="o">-</span> <span class="p">(</span>fit<span class="o">$</span>coefficients<span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="o">*</span>year<span class="o">+</span>fit<span class="o">$</span>coefficients<span class="p">[[</span><span class="m">1</span><span class="p">]])</span>
<span class="gp">&gt; </span>res
<span class="go">[1]  0.132 -0.003 -0.178 -0.163  0.212</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>year<span class="p">,</span>res<span class="p">)</span>
</pre></div>
</div>
<p>That is a bit messy, but fortunately there are easier ways to get the
residuals. Two other ways are shown below:</p>
<div class="highlight-rconsole" id="index-7"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>residuals<span class="p">(</span>fit<span class="p">)</span>
<span class="go">     1      2      3      4      5</span>
<span class="go"> 0.132 -0.003 -0.178 -0.163  0.212</span>
<span class="gp">&gt; </span>fit<span class="o">$</span>residuals
<span class="go">     1      2      3      4      5</span>
<span class="go"> 0.132 -0.003 -0.178 -0.163  0.212</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>year<span class="p">,</span>fit<span class="o">$</span>residuals<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>If you want to plot the regression line on the same plot as your
scatter plot you can use the abline function along with your variable
fit:</p>
<span class="target" id="index-8"></span><div class="highlight-rconsole" id="index-9"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>plot<span class="p">(</span>year<span class="p">,</span>rate<span class="p">,</span>
<span class="go">     main=&quot;Commercial Banks Interest Rate for 4 Year Car Loan&quot;,</span>
<span class="go">     sub=&quot;http://www.federalreserve.gov/releases/g19/20050805/&quot;)</span>
<span class="gp">&gt; </span>abline<span class="p">(</span>fit<span class="p">)</span>
</pre></div>
</div>
<p>Finally, as a teaser for the kinds of analyses you might see later,
you can get the results of an F-test by asking R for a summary of the
fit variable:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>fit<span class="p">)</span>

<span class="go">Call:</span>
<span class="go">lm(formula = rate ~ year)</span>

<span class="go">Residuals:</span>
<span class="go">     1      2      3      4      5</span>
<span class="go"> 0.132 -0.003 -0.178 -0.163  0.212</span>

<span class="go">Coefficients:</span>
<span class="go">              Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="go">(Intercept) 1419.20800  126.94957   11.18  0.00153 **</span>
<span class="go">year          -0.70500    0.06341  -11.12  0.00156 **</span>
<span class="go">---</span>
<span class="go">Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>

<span class="go">Residual standard error: 0.2005 on 3 degrees of freedom</span>
<span class="go">Multiple R-Squared: 0.9763,     Adjusted R-squared: 0.9684</span>
<span class="go">F-statistic: 123.6 on 1 and 3 DF,  p-value: 0.001559</span>
</pre></div>


<h2></h2>
<h2>9. Calculating Confidence Intervals</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#calculating-a-confidence-interval-from-a-normal-distribution" id="id1">Calculating a Confidence Interval From a Normal Distribution</a></li>
<li><a href="#calculating-a-confidence-interval-from-a-t-distribution" id="id2">Calculating a Confidence Interval From a t Distribution</a></li>
<li><a href="#calculating-many-confidence-intervals-from-a-t-distribution" id="id3">Calculating Many Confidence Intervals From a t Distribution</a></li>
</ul>
</div>
<p id="index-0">Here we look at some examples of calculating confidence intervals. The
examples are for both normal and t distributions. We assume that you
can enter data and know the commands associated with basic
probability. Note that an easier way to calculate confidence intervals
using the <em>t.test</em> command is discussed in section <a class="reference internal" href="pValues.html#t-test"><span>The Easy Way</span></a>.</p>
<div class="section" id="calculating-a-confidence-interval-from-a-normal-distribution">
<h3><a class="toc-backref" href="#id1">9.1. Calculating a Confidence Interval From a Normal Distribution</a></h3>
<p>Here we will look at a fictitious example. We will make some
assumptions for what we might find in an experiment and find the
resulting confidence interval using a normal distribution. Here we
assume that the sample mean is 5, the standard deviation is 2, and the
sample size is 20. In the example below we will use a 95% confidence
level and wish to find the confidence interval. The commands to find
the confidence interval in R are the following:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="m">5</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> <span class="m">2</span>
<span class="gp">&gt; </span>n <span class="o">&lt;-</span> <span class="m">20</span>
<span class="gp">&gt; </span>error <span class="o">&lt;-</span> qnorm<span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="o">*</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">)</span>
<span class="gp">&gt; </span>left <span class="o">&lt;-</span> a<span class="o">-</span>error
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> a<span class="o">+</span>error
<span class="gp">&gt; </span>left
<span class="go">[1] 4.123477</span>
<span class="gp">&gt; </span>right
<span class="go">[1] 5.876523</span>
</pre></div>
</div>
<p>Our level of certainty about the true mean is 95% in predicting that the
true mean is within the interval
between 4.12 and 5.88 assuming that the original random variable is
normally distributed, and the samples are independent.</p>
</div>
<div class="section" id="calculating-a-confidence-interval-from-a-t-distribution">
<h3><a class="toc-backref" href="#id2">9.2. Calculating a Confidence Interval From a t Distribution</a></h3>
<p>Calculating the confidence interval when using a t-test is similar to
using a normal distribution. The only difference is that we use the
command associated with the t-distribution rather than the normal
distribution. Here we repeat the procedures above, but we will assume
that we are working with a sample standard deviation rather than an
exact standard deviation.</p>
<p>Again we assume that the sample mean is 5, the sample standard
deviation is 2, and the sample size is 20. We use a 95% confidence
level and wish to find the confidence interval. The commands to find
the confidence interval in R are the following:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="m">5</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> <span class="m">2</span>
<span class="gp">&gt; </span>n <span class="o">&lt;-</span> <span class="m">20</span>
<span class="gp">&gt; </span>error <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span><span class="o">*</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">)</span>
<span class="gp">&gt; </span>left <span class="o">&lt;-</span> a<span class="o">-</span>error
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> a<span class="o">+</span>error
<span class="gp">&gt; </span>left
<span class="go">[1] 4.063971</span>
<span class="gp">&gt; </span>right
<span class="go">[1] 5.936029</span>
</pre></div>
</div>
<p>The true mean has a probability of 95% of being in the interval
between 4.06 and 5.94 assuming that the original random variable is
normally distributed, and the samples are independent.</p>
<p>We now look at an example where we have a univariate data set and want
to find the 95% confidence interval for the mean. In this example we
use one of the data sets given in the data input chapter. We use the
<a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/w1.dat">w1.dat</a> data set:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>w1 <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;w1.dat&quot;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>head<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>w1<span class="p">)</span>
<span class="go">     vals</span>
<span class="go">Min.   :0.130</span>
<span class="go">1st Qu.:0.480</span>
<span class="go">Median :0.720</span>
<span class="go">Mean   :0.765</span>
<span class="go">3rd Qu.:1.008</span>
<span class="go">Max.   :1.760</span>
<span class="gp">&gt; </span><span class="kp">length</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
<span class="go">[1] 54</span>
<span class="gp">&gt; </span><span class="kp">mean</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
<span class="go">[1] 0.765</span>
<span class="gp">&gt; </span>sd<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
<span class="go">[1] 0.3781222</span>
</pre></div>
</div>
<p>We can now calculate an error for the mean:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>error <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span><span class="kp">length</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span>sd<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span><span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">))</span>
<span class="gp">&gt; </span>error
<span class="go">[1] 0.1032075</span>
</pre></div>
</div>
<p>The confidence interval is found by adding and subtracting the error
from the mean:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>left <span class="o">&lt;-</span> <span class="kp">mean</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span><span class="o">-</span>error
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> <span class="kp">mean</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span><span class="o">+</span>error
<span class="gp">&gt; </span>left
<span class="go">[1] 0.6617925</span>
<span class="gp">&gt; </span>right
<span class="go">[1] 0.8682075</span>
</pre></div>
</div>
<p>There is a 95% probability that the true mean is between 0.66 and 0.87
assuming that the original random variable is normally distributed,
and the samples are independent.</p>
</div>
<div class="section" id="calculating-many-confidence-intervals-from-a-t-distribution">
<h3><a class="toc-backref" href="#id3">9.3. Calculating Many Confidence Intervals From a t Distribution</a></h3>
<p>Suppose that you want to find the confidence intervals for many
tests. This is a common task and most software packages will allow you
to do this.</p>
<p>We have three different sets of results:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="17%" />
<col width="25%" />
<col width="31%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2"><strong>Comparison 1</strong></td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std. Dev.</td>
<td>Number (pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>10</td>
<td>3</td>
<td>300</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>10.5</td>
<td>2.5</td>
<td>230</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="17%" />
<col width="25%" />
<col width="31%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2"><strong>Comparison 2</strong></td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std. Dev.</td>
<td>Number (pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>12</td>
<td>4</td>
<td>210</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>13</td>
<td>5.3</td>
<td>340</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="17%" />
<col width="25%" />
<col width="31%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2"><strong>Comparison 3</strong></td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std. Dev.</td>
<td>Number (pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>30</td>
<td>4.5</td>
<td>420</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>28.5</td>
<td>3</td>
<td>400</td>
</tr>
</tbody>
</table>
<p>For each of these comparisons we want to calculate the associated
confidence interval for the difference of the means. For each
comparison there are two groups. We will refer to group one as the
group whose results are in the first row of each comparison above. We
will refer to group two as the group whose results are in the second
row of each comparison above. Before we can do that we must first
compute a standard error and a t-score. We will find general formulae
which is necessary in order to do all three calculations at once.</p>
<p>We assume that the means for the first group are defined in a variable
called <em>m1</em>. The means for the second group are defined in a variable
called <em>m2</em>. The standard deviations for the first group are in a
variable called <em>sd1</em>. The standard deviations for the second group
are in a variable called <em>sd2</em>. The number of samples for the first
group are in a variable called <em>num1</em>. Finally, the number of samples
for the second group are in a variable called <em>num2</em>.</p>
<p>With these definitions the standard error is the square root of
<em>(sd1^2)/num1+(sd2^2)/num2</em>. The R commands to do this can be found
below:</p>
<span class="target" id="index-1"></span><div class="highlight-rconsole" id="index-2"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>m1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">30</span><span class="p">)</span>
<span class="gp">&gt; </span>m2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">10.5</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">28.5</span><span class="p">)</span>
<span class="gp">&gt; </span>sd1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4.5</span><span class="p">)</span>
<span class="gp">&gt; </span>sd2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2.5</span><span class="p">,</span><span class="m">5.3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>num1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">300</span><span class="p">,</span><span class="m">210</span><span class="p">,</span><span class="m">420</span><span class="p">)</span>
<span class="gp">&gt; </span>num2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">230</span><span class="p">,</span><span class="m">340</span><span class="p">,</span><span class="m">400</span><span class="p">)</span>
<span class="gp">&gt; </span>se <span class="o">&lt;-</span> <span class="kp">sqrt</span><span class="p">(</span>sd1<span class="o">*</span>sd1<span class="o">/</span>num1<span class="o">+</span>sd2<span class="o">*</span>sd2<span class="o">/</span>num2<span class="p">)</span>
<span class="gp">&gt; </span>error <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span>se
</pre></div>
</div>
<p>To see the values just type in the variable name on a line alone:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>m1
<span class="go">[1] 10 12 30</span>
<span class="gp">&gt; </span>m2
<span class="go">[1] 10.5 13.0 28.5</span>
<span class="gp">&gt; </span>sd1
<span class="go">[1] 3.0 4.0 4.5</span>
<span class="gp">&gt; </span>sd2
<span class="go">[1] 2.5 5.3 3.0</span>
<span class="gp">&gt; </span>num1
<span class="go">[1] 300 210 420</span>
<span class="gp">&gt; </span>num2
<span class="go">[1] 230 340 400</span>
<span class="gp">&gt; </span>se
<span class="go">[1] 0.2391107 0.3985074 0.2659216</span>
<span class="gp">&gt; </span>error
<span class="go">[1] 0.4711382 0.7856092 0.5227825</span>
</pre></div>
</div>
<p>Now we need to define the confidence interval around the assumed
differences. Just as in the case of finding the p values in previous
chapter we have to use the <em>pmin</em> command to get the number of degrees
of freedom. In this case the null hypotheses are for a difference of
zero, and we use a 95% confidence interval:</p>
<div class="highlight-rconsole" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>left <span class="o">&lt;-</span> <span class="p">(</span>m1<span class="o">-</span>m2<span class="p">)</span><span class="o">-</span>error
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> <span class="p">(</span>m1<span class="o">-</span>m2<span class="p">)</span><span class="o">+</span>error
<span class="gp">&gt; </span>left
<span class="go">[1] -0.9711382 -1.7856092  0.9772175</span>
<span class="gp">&gt; </span>right
<span class="go">[1] -0.02886177 -0.21439076  2.02278249</span>
</pre></div>
</div>
<p>This gives the confidence intervals for each of the three tests. For
example, in the first experiment the 95% confidence interval is
between -0.97 and -0.03 assuming that the random variables are
normally distributed, and the samples are independent.</p>


<h2></h2>
<h2>10. Calculating <em>p</em> Values</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#calculating-a-single-p-value-from-a-normal-distribution" id="id1">Calculating a Single <em>p</em> Value From a Normal Distribution</a></li>
<li><a href="#calculating-a-single-p-value-from-a-t-distribution" id="id2">Calculating a Single <em>p</em> Value From a t Distribution</a></li>
<li><a href="#calculating-many-p-values-from-a-t-distribution" id="id3">Calculating Many <em>p</em> Values From a t Distribution</a></li>
<li><a href="#the-easy-way" id="id4">The Easy Way</a></li>
</ul>
</div>
<p id="index-0">Here we look at some examples of calculating <em>p</em> values. The examples
are for both normal and t distributions. We assume that you can enter
data and know the commands associated with basic probability. We first
show how to do the calculations the hard way and show how to do the
calculations. The last method makes use of the <em>t.test</em> command and
demonstrates an easier way to calculate a <em>p</em> value.</p>
<div class="section" id="calculating-a-single-p-value-from-a-normal-distribution">
<h3><a class="toc-backref" href="#id1">10.1. Calculating a Single <em>p</em> Value From a Normal Distribution</a></h3>
<p>We look at the steps necessary to calculate the <em>p</em> value for a
particular test. In the interest of simplicity we only look at a two
sided test, and we focus on one example. Here we want to show that the
mean is not close to a fixed value, a.</p>
<div class="math" id="index-1">
\[\begin{split}H_o: \mu_x &amp; = &amp; a,\end{split}\]\[\begin{split}H_a: \mu_x &amp; \neq &amp; a,\end{split}\]</div>
<p>The <em>p</em> value is calculated for a particular sample mean. Here we assume
that we obtained a sample mean, x and want to find its <em>p</em> value. It is
the probability that we would obtain a given sample mean that is
greater than the absolute value of its Z-score or less than the
negative of the absolute value of its Z-score.</p>
<p>For the special case of a normal distribution we also need the
standard deviation. We will assume that we are given the standard
deviation and call it <em>s</em>. The calculation for the <em>p</em> value can be done
in several of ways. We will look at two ways here. The first way is to
convert the sample means to their associated Z-score. The other way is
to simply specify the standard deviation and let the computer do the
conversion. At first glance it may seem like a no brainer, and we
should just use the second method. Unfortunately, when using the
t-distribution we need to convert to the t-score, so it is a good idea
to know both ways.</p>
<p>We first look at how to calculate the <em>p</em> value using the Z-score. The
Z-score is found by assuming that the null hypothesis is true,
subtracting the assumed mean, and dividing by the theoretical standard
deviation. Once the Z-score is found the probability that the value
could be less the Z-score is found using the <em>pnorm</em> command.</p>
<p>This is not enough to get the <em>p</em> value. If the Z-score that is found is
positive then we need to take one minus the associated
probability. Also, for a two sided test we need to multiply the result
by two. Here we avoid these issues and insure that the Z-score is
negative by taking the negative of the absolute value.</p>
<p>We now look at a specific example. In the example below we will use a
value of a of 5, a standard deviation of 2, and a sample size
of 20. We then find the <em>p</em> value for a sample mean of 7:</p>
<div class="highlight-rconsole" id="index-2"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="m">5</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> <span class="m">2</span>
<span class="gp">&gt; </span>n <span class="o">&lt;-</span> <span class="m">20</span>
<span class="gp">&gt; </span>xbar <span class="o">&lt;-</span> <span class="m">7</span>
<span class="gp">&gt; </span>z <span class="o">&lt;-</span> <span class="p">(</span>xbar<span class="o">-</span>a<span class="p">)</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>z
<span class="go">[1] 4.472136</span>
<span class="gp">&gt; </span><span class="m">2</span><span class="o">*</span>pnorm<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span>z<span class="p">))</span>
<span class="go">[1] 7.744216e-06</span>
</pre></div>
</div>
<p>We now look at the same problem only specifying the mean and standard
deviation within the <em>pnorm</em> command. Note that for this case we cannot
so easily force the use of the left tail. Since the sample mean is
more than the assumed mean we have to take two times one minus the
probability:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="m">5</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> <span class="m">2</span>
<span class="gp">&gt; </span>n <span class="o">&lt;-</span> <span class="m">20</span>
<span class="gp">&gt; </span>xbar <span class="o">&lt;-</span> <span class="m">7</span>
<span class="gp">&gt; </span><span class="m">2</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span>pnorm<span class="p">(</span>xbar<span class="p">,</span>mean<span class="o">=</span>a<span class="p">,</span>sd<span class="o">=</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span><span class="m">20</span><span class="p">)))</span>
<span class="go">[1] 7.744216e-06</span>
</pre></div>
</div>
</div>
<div class="section" id="calculating-a-single-p-value-from-a-t-distribution">
<h3><a class="toc-backref" href="#id2">10.2. Calculating a Single <em>p</em> Value From a t Distribution</a></h3>
<p>Finding the <em>p</em> value using a t distribution is very similar to using
the Z-score as demonstrated above. The only difference is that you
have to specify the number of degrees of freedom. Here we look at the
same example as above but use the t distribution instead:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="m">5</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> <span class="m">2</span>
<span class="gp">&gt; </span>n <span class="o">&lt;-</span> <span class="m">20</span>
<span class="gp">&gt; </span>xbar <span class="o">&lt;-</span> <span class="m">7</span>
<span class="gp">&gt; </span>t <span class="o">&lt;-</span> <span class="p">(</span>xbar<span class="o">-</span>a<span class="p">)</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span><span class="kp">t</span>
<span class="go">[1] 4.472136</span>
<span class="gp">&gt; </span><span class="m">2</span><span class="o">*</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span><span class="kp">t</span><span class="p">),</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span>
<span class="go">[1] 0.0002611934</span>
</pre></div>
</div>
<p>We now look at an example where we have a univariate data set and want
to find the <em>p</em> value. In this example we use one of the data sets given
in the data input chapter. We use the <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/w1.dat">w1.dat</a> data set:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>w1 <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;w1.dat&quot;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>head<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>w1<span class="p">)</span>
<span class="go">      vals</span>
<span class="go"> Min.   :0.130</span>
<span class="go"> 1st Qu.:0.480</span>
<span class="go"> Median :0.720</span>
<span class="go"> Mean   :0.765</span>
<span class="go"> 3rd Qu.:1.008</span>
<span class="go"> Max.   :1.760</span>
<span class="gp">&gt; </span><span class="kp">length</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span>
<span class="go">[1] 54</span>
</pre></div>
</div>
<p>Here we use a two sided hypothesis test,</p>
<div class="math">
\[\begin{split}H_o: \mu_x &amp; = &amp; 0.7,\end{split}\]\[\begin{split}H_a: \mu_x &amp; \neq &amp; 0.7.\end{split}\]</div>
<p>So we calculate the sample mean and sample standard deviation in order
to calculate the <em>p</em> value:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t <span class="o">&lt;-</span> <span class="p">(</span><span class="kp">mean</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span><span class="m">-0.7</span><span class="p">)</span><span class="o">/</span><span class="p">(</span>sd<span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span><span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)))</span>
<span class="gp">&gt; </span><span class="kp">t</span>
<span class="go">[1] 1.263217</span>
<span class="gp">&gt; </span><span class="m">2</span><span class="o">*</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span><span class="kp">t</span><span class="p">),</span>df<span class="o">=</span><span class="kp">length</span><span class="p">(</span>w1<span class="o">$</span>vals<span class="p">)</span><span class="m">-1</span><span class="p">)</span>
<span class="go">[1] 0.21204</span>
</pre></div>
</div>
</div>
<div class="section" id="calculating-many-p-values-from-a-t-distribution">
<h3><a class="toc-backref" href="#id3">10.3. Calculating Many <em>p</em> Values From a t Distribution</a></h3>
<p>Suppose that you want to find the <em>p</em> values for many tests. This is a
common task and most software packages will allow you to do this. Here
we see how it can be done in R.</p>
<p>Here we assume that we want to do a one-sided hypothesis test for a
number of comparisons. In particular we will look at three hypothesis
tests. All are of the following form:</p>
<div class="math">
\[\begin{split}H_o: \mu_1 - \mu_2 &amp; = &amp; 0,\end{split}\]\[\begin{split}H_a: \mu_1 - \mu_2 &amp; \neq &amp; 0.\end{split}\]</div>
<p>We have three different sets of comparisons to make:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="24%" />
<col width="28%" />
<col width="28%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Comparison</td>
<td>1</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std. Dev.</td>
<td>Number
(pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>10</td>
<td>3</td>
<td>300</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>10.5</td>
<td>2.5</td>
<td>230</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="26%" />
<col width="30%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Comparison</td>
<td>2</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std. Dev.</td>
<td>Number
(pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>12</td>
<td>4</td>
<td>210</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>13</td>
<td>5.3</td>
<td>340</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="31%" />
<col width="33%" />
<col width="13%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Comparison</td>
<td>3</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std. Dev.</td>
<td>Number
(pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>30</td>
<td>4.5</td>
<td>420</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>28.5</td>
<td>3</td>
<td>400</td>
</tr>
</tbody>
</table>
<p>For each of these comparisons we want to calculate a <em>p</em> value. For each
comparison there are two groups. We will refer to group one as the
group whose results are in the first row of each comparison above. We
will refer to group two as the group whose results are in the second
row of each comparison above. Before we can do that we must first
compute a standard error and a t-score. We will find general formulae
which is necessary in order to do all three calculations at once.</p>
<p>We assume that the means for the first group are defined in a variable
called <em>m1</em>. The means for the second group are defined in a variable
called <em>m2</em>. The standard deviations for the first group are in a
variable called <em>sd1</em>. The standard deviations for the second group are
in a variable called <em>sd2</em>. The number of samples for the first group
are in a variable called <em>num1</em>. Finally, the number of samples for the
second group are in a variable called <em>num2</em>.</p>
<p>With these definitions the standard error is the square root of
<em>(sd1^2)/num1+(sd2^2)/num2</em>. The associated t-score is <em>m1</em> minus <em>m2</em>
all divided by the standard error. The R comands to do this can be
found below:</p>
<div class="highlight-rconsole" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>m1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">30</span><span class="p">)</span>
<span class="gp">&gt; </span>m2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">10.5</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">28.5</span><span class="p">)</span>
<span class="gp">&gt; </span>sd1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4.5</span><span class="p">)</span>
<span class="gp">&gt; </span>sd2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2.5</span><span class="p">,</span><span class="m">5.3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>num1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">300</span><span class="p">,</span><span class="m">210</span><span class="p">,</span><span class="m">420</span><span class="p">)</span>
<span class="gp">&gt; </span>num2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">230</span><span class="p">,</span><span class="m">340</span><span class="p">,</span><span class="m">400</span><span class="p">)</span>
<span class="gp">&gt; </span>se <span class="o">&lt;-</span> <span class="kp">sqrt</span><span class="p">(</span>sd1<span class="o">*</span>sd1<span class="o">/</span>num1<span class="o">+</span>sd2<span class="o">*</span>sd2<span class="o">/</span>num2<span class="p">)</span>
<span class="gp">&gt; </span>t <span class="o">&lt;-</span> <span class="p">(</span>m1<span class="o">-</span>m2<span class="p">)</span><span class="o">/</span>se
</pre></div>
</div>
<p>To see the values just type in the variable name on a line alone:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>m1
<span class="go">[1] 10 12 30</span>
<span class="gp">&gt; </span>m2
<span class="go">[1] 10.5 13.0 28.5</span>
<span class="gp">&gt; </span>sd1
<span class="go">[1] 3.0 4.0 4.5</span>
<span class="gp">&gt; </span>sd2
<span class="go">[1] 2.5 5.3 3.0</span>
<span class="gp">&gt; </span>num1
<span class="go">[1] 300 210 420</span>
<span class="gp">&gt; </span>num2
<span class="go">[1] 230 340 400</span>
<span class="gp">&gt; </span>se
<span class="go">[1] 0.2391107 0.3985074 0.2659216</span>
<span class="gp">&gt; </span><span class="kp">t</span>
<span class="go">[1] -2.091082 -2.509364  5.640761</span>
</pre></div>
</div>
<p>To use the <em>pt</em> command we need to specify the number of degrees of
freedom. This can be done using the <em>pmin</em> command. Note that there is
also a command called <em>min</em>, but it does not work the same way. You
need to use <em>pmin</em> to get the correct results. The numbers of degrees
of freedom are <em>pmin(num1,num2)-1</em>. So the <em>p</em> values can be found
using the following R command:</p>
<div class="highlight-rconsole" id="index-4"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>pt<span class="p">(</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">)</span>
<span class="go">[1] 0.01881168 0.00642689 0.99999998</span>
</pre></div>
</div>
<p>If you enter all of these commands into R you should have noticed that
the last <em>p</em> value is not correct. The pt command gives the probability
that a score is less that the specified t. The t-score for the last
entry is positive, and we want the probability that a t-score is
bigger. One way around this is to make sure that all of the t-scores
are negative. You can do this by taking the negative of the absolute
value of the t-scores:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span><span class="kp">t</span><span class="p">),</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">)</span>
<span class="go">[1] 1.881168e-02 6.426890e-03 1.605968e-08</span>
</pre></div>
</div>
<p>The results from the command above should give you the <em>p</em> values for a
one-sided test. It is left as an exercise how to find the <em>p</em> values for
a two-sided test.</p>
</div>
<div class="section" id="the-easy-way">
<span id="t-test"></span><h3><a class="toc-backref" href="#id4">10.4. The Easy Way</a></h3>
<p>The methods above demonstrate how to calculate the <em>p</em> values directly
making use of the standard formulae. There is another, more direct way
to do this using the <em>t.test</em> command. The <em>t.test</em> command takes a
data set for an argument, and the default operation is to perform a
two sided hypothesis test.</p>
<div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">9.0</span><span class="p">,</span><span class="m">9.5</span><span class="p">,</span><span class="m">9.6</span><span class="p">,</span><span class="m">10.2</span><span class="p">,</span><span class="m">11.6</span><span class="p">)</span>
<span class="gp">&gt; </span>t.test<span class="p">(</span>x<span class="p">)</span>

<span class="go">                                One Sample t-test</span>

<span class="go">data:  x</span>
<span class="go">t = 22.2937, df = 4, p-value = 2.397e-05</span>
<span class="go">alternative hypothesis: true mean is not equal to 0</span>
<span class="go">95 percent confidence interval:</span>
<span class="go">        8.737095 11.222905</span>
<span class="go">sample estimates:</span>
<span class="go">mean of x</span>
<span class="go">                       9.98</span>

<span class="gp">&gt; </span>help<span class="p">(</span>t.test<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>That was an obvious result. If you want to test against a
different assumed mean then you can use the <em>mu</em> argument:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">9.0</span><span class="p">,</span><span class="m">9.5</span><span class="p">,</span><span class="m">9.6</span><span class="p">,</span><span class="m">10.2</span><span class="p">,</span><span class="m">11.6</span><span class="p">)</span>
<span class="gp">&gt; </span>t.test<span class="p">(</span>x<span class="p">,</span>mu<span class="o">=</span><span class="m">10</span><span class="p">)</span>

<span class="go">                                One Sample t-test</span>

<span class="go">data:  x</span>
<span class="go">t = -0.0447, df = 4, p-value = 0.9665</span>
<span class="go">alternative hypothesis: true mean is not equal to 10</span>
<span class="go">95 percent confidence interval:</span>
<span class="go">        8.737095 11.222905</span>
<span class="go">sample estimates:</span>
<span class="go">mean of x</span>
<span class="go">                       9.98</span>
</pre></div>
</div>
<p>If you are interested in a one sided test then you can specify which
test to employ using the <em>alternative</em> option:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">9.0</span><span class="p">,</span><span class="m">9.5</span><span class="p">,</span><span class="m">9.6</span><span class="p">,</span><span class="m">10.2</span><span class="p">,</span><span class="m">11.6</span><span class="p">)</span>
<span class="gp">&gt; </span>t.test<span class="p">(</span>x<span class="p">,</span>mu<span class="o">=</span><span class="m">10</span><span class="p">,</span>alternative<span class="o">=</span><span class="s">&quot;less&quot;</span><span class="p">)</span>

<span class="go">                                One Sample t-test</span>

<span class="go">data:  x</span>
<span class="go">t = -0.0447, df = 4, p-value = 0.4833</span>
<span class="go">alternative hypothesis: true mean is less than 10</span>
<span class="go">95 percent confidence interval:</span>
<span class="go">                       -Inf 10.93434</span>
<span class="go">sample estimates:</span>
<span class="go">mean of x</span>
<span class="go">                       9.98</span>
</pre></div>
</div>
<p>The <em>t.test()</em> command also accepts a second data set to compare two
sets of samples. The default is to treat them as independent sets, but
there is an option to treat them as dependent data sets. (Enter
<em>help(t.test)</em> for more information.) To test two different samples,
the first two arguments should be the data sets to compare:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">9.0</span><span class="p">,</span><span class="m">9.5</span><span class="p">,</span><span class="m">9.6</span><span class="p">,</span><span class="m">10.2</span><span class="p">,</span><span class="m">11.6</span><span class="p">)</span>
<span class="gp">&gt; </span>y<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">9.9</span><span class="p">,</span><span class="m">8.7</span><span class="p">,</span><span class="m">9.8</span><span class="p">,</span><span class="m">10.5</span><span class="p">,</span><span class="m">8.9</span><span class="p">,</span><span class="m">8.3</span><span class="p">,</span><span class="m">9.8</span><span class="p">,</span><span class="m">9.0</span><span class="p">)</span>
<span class="gp">&gt; </span>t.test<span class="p">(</span>x<span class="p">,</span>y<span class="p">)</span>
<span class="go">        Welch Two Sample t-test</span>

<span class="go">data:  x and y</span>
<span class="go">t = 1.1891, df = 6.78, p-value = 0.2744</span>
<span class="go">alternative hypothesis true difference in means is not equal to 0</span>
<span class="go">95 percent confidence interval:</span>
<span class="go">       -0.6185513  1.8535513</span>
<span class="go">sample estimates:</span>
<span class="go">mean of x mean of y</span>
<span class="go">               9.9800    9.3625</span>
</pre></div>
</div>


<h2></h2>
<h2>11. Calculating The Power Of A Test</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#calculating-the-power-using-a-normal-distribution" id="id1">Calculating The Power Using a Normal Distribution</a></li>
<li><a href="#calculating-the-power-using-a-t-distribution" id="id2">Calculating The Power Using a t Distribution</a></li>
<li><a href="#calculating-many-powers-from-a-t-distribution" id="id3">Calculating Many Powers From a t Distribution</a></li>
</ul>
</div>
<p id="index-0">Here we look at some examples of calculating the power of a test. The
examples are for both normal and t distributions. We assume that you
can enter data and know the commands associated with basic
probability. All of the examples here are for a two sided test, and
you can adjust them accordingly for a one sided test.</p>
<div class="section" id="calculating-the-power-using-a-normal-distribution">
<h3><a class="toc-backref" href="#id1">11.1. Calculating The Power Using a Normal Distribution</a></h3>
<p>Here we calculate the power of a test for a normal distribution for a
specific example. Suppose that our hypothesis test is the following:</p>
<div class="math" id="index-1">
\[\begin{split}H_o: \mu_x &amp; = &amp; a,\end{split}\]\[\begin{split}H_a: \mu_x &amp; \neq &amp; a,\end{split}\]</div>
<p>The power of a test is the probability that we can the reject null
hypothesis at a given mean that is away from the one specified in the
null hypothesis. We calculate this probability by first calculating
the probability that we accept the null hypothesis when we should
not. This is the probability to make a type II error. The power is the
probability that we do not make a type II error so we then take one
minus the result to get the power.</p>
<p>We can fail to reject the null hypothesis if the sample happens to be
within the confidence interval we find when we assume that the null
hypothesis is true. To get the confidence interval we find the margin
of error and then add and subtract it to the proposed mean, a, to get
the confidence interval. We then turn around and assume instead that
the true mean is at a different, explicitly specified level, and then
find the probability a sample could be found within the original
confidence interval.</p>
<p>In the example below the hypothesis test is for</p>
<div class="math">
\[\begin{split}H_o: \mu_x &amp; = &amp; 5,\end{split}\]\[\begin{split}H_a: \mu_x &amp; \neq &amp; 5,\end{split}\]</div>
<p>We will assume that the standard deviation is 2, and the sample size
is 20. In the example below we will use a 95% confidence level and
wish to find the power to detect a true mean that differs from 5 by an
amount of 1.5. (All of these numbers are made up solely for this
example.) The commands to find the confidence interval in R are the
following:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="m">5</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> <span class="m">2</span>
<span class="gp">&gt; </span>n <span class="o">&lt;-</span> <span class="m">20</span>
<span class="gp">&gt; </span>error <span class="o">&lt;-</span> qnorm<span class="p">(</span><span class="m">0.975</span><span class="p">)</span><span class="o">*</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">)</span>
<span class="gp">&gt; </span>left <span class="o">&lt;-</span> a<span class="o">-</span>error
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> a<span class="o">+</span>error
<span class="gp">&gt; </span>left
<span class="go">[1] 4.123477</span>
<span class="gp">&gt; </span>right
<span class="go">[1] 5.876523</span>
</pre></div>
</div>
<p>Next we find the Z-scores for the left and right values assuming that the true mean is 5+1.5=6.5:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>assumed <span class="o">&lt;-</span> a <span class="o">+</span> <span class="m">1.5</span>
<span class="gp">&gt; </span>Zleft <span class="o">&lt;-</span> <span class="p">(</span>left<span class="o">-</span>assumed<span class="p">)</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>Zright <span class="o">&lt;-</span><span class="p">(</span>right<span class="o">-</span>assumed<span class="p">)</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>p <span class="o">&lt;-</span> pnorm<span class="p">(</span>Zright<span class="p">)</span><span class="o">-</span>pnorm<span class="p">(</span>Zleft<span class="p">)</span>
<span class="gp">&gt; </span>p
<span class="go">[1] 0.08163792</span>
</pre></div>
</div>
<p>The probability that we make a type II error if the true mean is 6.5
is approximately 8.1%. So the power of the test is 1-p:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span>p
<span class="go">[1] 0.918362</span>
</pre></div>
</div>
<p>In this example, the power of the test is approximately 91.8%. If the
true mean differs from 5 by 1.5 then the probability that we will
reject the null hypothesis is approximately 91.8%.</p>
</div>
<div class="section" id="calculating-the-power-using-a-t-distribution">
<h3><a class="toc-backref" href="#id2">11.2. Calculating The Power Using a t Distribution</a></h3>
<p>Calculating the power when using a t-test is similar to using a normal
distribution. One difference is that we use the command associated
with the t-distribution rather than the normal distribution. Here we
repeat the test above, but we will assume that we are working with a
sample standard deviation rather than an exact standard deviation. We
will explore three different ways to calculate the power of a
test. The first method makes use of the scheme many books recommend if
you do not have the non-central distribution available. The second
does make use of the non-central distribution, and the third makes use
of a single command that will do a lot of the work for us.</p>
<p>In the example the hypothesis test is the same as above,</p>
<div class="math">
\[\begin{split}H_o: \mu_x &amp; = &amp; 5,\end{split}\]\[\begin{split}H_a: \mu_x &amp; \neq &amp; 5,\end{split}\]</div>
<p>Again we assume that the sample standard deviation is 2, and the
sample size is 20. We use a 95% confidence level and wish to find the
power to detect a true mean that differs from 5 by an amount of
1.5. The commands to find the confidence interval in R are the
following:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="m">5</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> <span class="m">2</span>
<span class="gp">&gt; </span>n <span class="o">&lt;-</span> <span class="m">20</span>
<span class="gp">&gt; </span>error <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span><span class="o">*</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">)</span>
<span class="gp">&gt; </span>left <span class="o">&lt;-</span> a<span class="o">-</span>error
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> a<span class="o">+</span>error
<span class="gp">&gt; </span>left
<span class="go">[1] 4.063971</span>
<span class="gp">&gt; </span>right
<span class="go">[1] 5.936029</span>
</pre></div>
</div>
<p>The number of observations is large enough that the results are quite
close to those in the example using the normal distribution. Next we
find the t-scores for the left and right values assuming that the true
mean is 5+1.5=6.5:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>assumed <span class="o">&lt;-</span> a <span class="o">+</span> <span class="m">1.5</span>
<span class="gp">&gt; </span>tleft <span class="o">&lt;-</span> <span class="p">(</span>left<span class="o">-</span>assumed<span class="p">)</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>tright <span class="o">&lt;-</span> <span class="p">(</span>right<span class="o">-</span>assumed<span class="p">)</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>p <span class="o">&lt;-</span> pt<span class="p">(</span>tright<span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span><span class="o">-</span>pt<span class="p">(</span>tleft<span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span>p
<span class="go">[1] 0.1112583</span>
</pre></div>
</div>
<p>The probability that we make a type II error if the true mean is 6.5
is approximately 11.1%. So the power of the test is 1-p:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span>p
<span class="go">[1] 0.8887417</span>
</pre></div>
</div>
<p>In this example, the power of the test is approximately 88.9%. If the
true mean differs from 5 by 1.5 then the probability that we will
reject the null hypothesis is approximately 88.9%. Note that the power
calculated for a normal distribution is slightly higher than for this
one calculated with the t-distribution.</p>
<p>Another way to approximate the power is to make use of the
non-centrality parameter. The idea is that you give it the critical t
scores and the amount that the mean would be shifted if the alternate
mean were the true mean. This is the method that most books recommend.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>ncp <span class="o">&lt;-</span> <span class="m">1.5</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>t <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span>pt<span class="p">(</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>ncp<span class="p">)</span><span class="o">-</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>ncp<span class="p">)</span>
<span class="go">[1] 0.1111522</span>
<span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span><span class="p">(</span>pt<span class="p">(</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>ncp<span class="p">)</span><span class="o">-</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>ncp<span class="p">))</span>
<span class="go">[1] 0.8888478</span>
</pre></div>
</div>
<p>Again, we see that the probability of making a type II error is
approximately 11.1%, and the power is approximately 88.9%. Note that
this is slightly different than the previous calculation but is still
close.</p>
<p>Finally, there is one more command that we explore. This command
allows us to do the same power calculation as above but with a single
command.</p>
<div class="highlight-rconsole" id="index-2"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>power.t.test<span class="p">(</span>n<span class="o">=</span>n<span class="p">,</span>delta<span class="o">=</span><span class="m">1.5</span><span class="p">,</span>sd<span class="o">=</span>s<span class="p">,</span>sig.level<span class="o">=</span><span class="m">0.05</span><span class="p">,</span>
<span class="go">        type=&quot;one.sample&quot;,alternative=&quot;two.sided&quot;,strict = TRUE)</span>

<span class="go">     One-sample t test power calculation</span>

<span class="go">              n = 20</span>
<span class="go">          delta = 1.5</span>
<span class="go">             sd = 2</span>
<span class="go">      sig.level = 0.05</span>
<span class="go">          power = 0.8888478</span>
<span class="go">    alternative = two.sided</span>
</pre></div>
</div>
<p>This is a powerful command that can do much more than just calculate
the power of a test. For example it can also be used to calculate the
number of observations necessary to achieve a given power. For more
information check out the help page, help(power.t.test).</p>
</div>
<div class="section" id="calculating-many-powers-from-a-t-distribution">
<h3><a class="toc-backref" href="#id3">11.3. Calculating Many Powers From a t Distribution</a></h3>
<p>Suppose that you want to find the powers for many tests. This is a
common task and most software packages will allow you to do this. Here
we see how it can be done in R. We use the exact same cases as in the
previous chapter.</p>
<p>Here we assume that we want to do a two-sided hypothesis test for a
number of comparisons and want to find the power of the tests to
detect a 1 point difference in the means. In particular we will look
at three hypothesis tests. All are of the following form:</p>
<div class="math">
\[\begin{split}H_o: \mu_1 - \mu2 &amp; = &amp; 0,\end{split}\]\[\begin{split}H_a: \mu_1 - \mu_2 &amp; \neq &amp; 0,\end{split}\]</div>
<p>We have three different sets of comparisons to make:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="17%" />
<col width="30%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2">Comparison 1</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std. Dev.</td>
<td>Number
(pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>10</td>
<td>3</td>
<td>300</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>10.5</td>
<td>2.5</td>
<td>230</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="19%" />
<col width="19%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2">Comparison 2</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std.
Dev.</td>
<td>Number
(pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>12</td>
<td>4</td>
<td>210</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>13</td>
<td>5.3</td>
<td>340</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="19%" />
<col width="19%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2">Comparison 3</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>Mean</td>
<td>Std.
Dev.</td>
<td>Number
(pop.)</td>
</tr>
<tr class="row-odd"><td>Group I</td>
<td>30</td>
<td>4.5</td>
<td>420</td>
</tr>
<tr class="row-even"><td>Group II</td>
<td>28.5</td>
<td>3</td>
<td>400</td>
</tr>
</tbody>
</table>
<p>For each of these comparisons we want to calculate the power of the
test. For each comparison there are two groups. We will refer to group
one as the group whose results are in the first row of each comparison
above. We will refer to group two as the group whose results are in
the second row of each comparison above. Before we can do that we must
first compute a standard error and a t-score. We will find general
formulae which is necessary in order to do all three calculations at
once.</p>
<p>We assume that the means for the first group are defined in a variable
called m1. The means for the second group are defined in a variable
called m2. The standard deviations for the first group are in a
variable called sd1. The standard deviations for the second group are
in a variable called sd2. The number of samples for the first group
are in a variable called num1. Finally, the number of samples for the
second group are in a variable called num2.</p>
<p>With these definitions the standard error is the square root of
(sd1^2)/num1+(sd2^2)/num2. The R commands to do this can be found
below:</p>
<div class="highlight-rconsole" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>m1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">30</span><span class="p">)</span>
<span class="gp">&gt; </span>m2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">10.5</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">28.5</span><span class="p">)</span>
<span class="gp">&gt; </span>sd1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4.5</span><span class="p">)</span>
<span class="gp">&gt; </span>sd2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2.5</span><span class="p">,</span><span class="m">5.3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>num1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">300</span><span class="p">,</span><span class="m">210</span><span class="p">,</span><span class="m">420</span><span class="p">)</span>
<span class="gp">&gt; </span>num2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">230</span><span class="p">,</span><span class="m">340</span><span class="p">,</span><span class="m">400</span><span class="p">)</span>
<span class="gp">&gt; </span>se <span class="o">&lt;-</span> <span class="kp">sqrt</span><span class="p">(</span>sd1<span class="o">*</span>sd1<span class="o">/</span>num1<span class="o">+</span>sd2<span class="o">*</span>sd2<span class="o">/</span>num2<span class="p">)</span>
</pre></div>
</div>
<p>To see the values just type in the variable name on a line alone:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>m1
<span class="go">[1] 10 12 30</span>
<span class="gp">&gt; </span>m2
<span class="go">[1] 10.5 13.0 28.5</span>
<span class="gp">&gt; </span>sd1
<span class="go">[1] 3.0 4.0 4.5</span>
<span class="gp">&gt; </span>sd2
<span class="go">[1] 2.5 5.3 3.0</span>
<span class="gp">&gt; </span>num1
<span class="go">[1] 300 210 420</span>
<span class="gp">&gt; </span>num2
<span class="go">[1] 230 340 400</span>
<span class="gp">&gt; </span>se
<span class="go">[1] 0.2391107 0.3985074 0.2659216</span>
</pre></div>
</div>
<p>Now we need to define the confidence interval around the assumed
differences. Just as in the case of finding the p values in previous
chapter we have to use the pmin command to get the number of degrees
of freedom. In this case the null hypotheses are for a difference of
zero, and we use a 95% confidence interval:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>left <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.025</span><span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span>se
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> <span class="o">-</span>left
<span class="gp">&gt; </span>left
<span class="go">[1] -0.4711382 -0.7856092 -0.5227825</span>
<span class="gp">&gt; </span>right
<span class="go">[1] 0.4711382 0.7856092 0.5227825</span>
</pre></div>
</div>
<p>We can now calculate the power of the one sided test. Assuming a true
mean of 1 we can calculate the t-scores associated with both the left
and right variables:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>tl <span class="o">&lt;-</span> <span class="p">(</span>left<span class="m">-1</span><span class="p">)</span><span class="o">/</span>se
<span class="gp">&gt; </span>tr <span class="o">&lt;-</span> <span class="p">(</span>right<span class="m">-1</span><span class="p">)</span><span class="o">/</span>se
<span class="gp">&gt; </span>tl
<span class="go">[1] -6.152541 -4.480743 -5.726434</span>
<span class="gp">&gt; </span>tr
<span class="go">[1] -2.2117865 -0.5379844 -1.7945799</span>
<span class="gp">&gt; </span>probII <span class="o">&lt;-</span> pt<span class="p">(</span>tr<span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">)</span> <span class="o">-</span>
<span class="go">pt(tl,df=pmin(num1,num2)-1)</span>
<span class="gp">&gt; </span>probII
<span class="go">[1] 0.01398479 0.29557399 0.03673874</span>
<span class="gp">&gt; </span>power <span class="o">&lt;-</span> <span class="m">1</span><span class="o">-</span>probII
<span class="gp">&gt; </span>power
<span class="go">[1] 0.9860152 0.7044260 0.9632613</span>
</pre></div>
</div>
<p>The results from the command above should give you the p-values for a
two-sided test. It is left as an exercise how to find the p-values for
a one-sided test.</p>
<p>Just as was found above there is more than one way to calculate the
power. We also include the method using the non-central parameter
which is recommended over the previous method:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">t</span>
<span class="go">[1] 1.970377 1.971379 1.965927</span>
<span class="gp">&gt; </span>ncp <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="o">/</span>se
<span class="gp">&gt; </span>pt<span class="p">(</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>ncp<span class="p">)</span><span class="o">-</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>ncp<span class="p">)</span>
<span class="go">[1] 0.01374112 0.29533455 0.03660842</span>
<span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span><span class="p">(</span>pt<span class="p">(</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>ncp<span class="p">)</span><span class="o">-</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span><span class="kp">pmin</span><span class="p">(</span>num1<span class="p">,</span>num2<span class="p">)</span><span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>ncp<span class="p">))</span>
<span class="go">[1] 0.9862589 0.7046655 0.9633916</span>
</pre></div>
</div>


<h2></h2>
<h2>12. Two Way Tables</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#creating-a-table-from-data" id="id1">Creating a Table from Data</a></li>
<li><a href="#creating-a-table-directly" id="id2">Creating a Table Directly</a></li>
<li><a href="#tools-for-working-with-tables" id="id3">Tools For Working With Tables</a></li>
<li><a href="#graphical-views-of-tables" id="id4">Graphical Views of Tables</a></li>
</ul>
</div>
<span class="target" id="index-0"></span><p id="index-1">Here we look at some examples of how to work with two way tables. We
assume that you can enter data and understand the different data
types.</p>
<div class="section" id="creating-a-table-from-data">
<h3><a class="toc-backref" href="#id1">12.1. Creating a Table from Data</a></h3>
<p>We first look at how to create a table from raw data. Here we use a
fictitious data set, <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/smoker.csv">smoker.csv</a>. This data set
was created only to be used as an example, and the numbers were
created to match an example from a text book, p. 629 of the 4th
edition of Moore and McCabe&#8217;s Introduction to the Practice of
Statistics. You should look at the data set in a spreadsheet to see
how it is entered. The information is ordered in a way to make it
easier to figure out what information is in the data.</p>
<p>The idea is that 356 people have been polled on their smoking status
(Smoke) and their socioeconomic status (SES). For each person it was
determined whether or not they are current smokers, former smokers, or
have never smoked. Also, for each person their socioeconomic status
was determined (low, middle, or high). The data file contains only two
columns, and when read R interprets them both as factors:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>smokerData <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&#39;smoker.csv&#39;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>header<span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>smokerData<span class="p">)</span>
<span class="go">     Smoke         SES</span>
<span class="go"> current:116   High  :211</span>
<span class="go"> former :141   Low   : 93</span>
<span class="go"> never  : 99   Middle: 52</span>
</pre></div>
</div>
<p>You can create a two way table of occurrences using the table command
and the two columns in the data frame:</p>
<span class="target" id="index-2"></span><div class="highlight-rconsole" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>smoke <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>smokerData<span class="o">$</span>Smoke<span class="p">,</span>smokerData<span class="o">$</span>SES<span class="p">)</span>
<span class="gp">&gt; </span>smoke

<span class="go">          High Low Middle</span>
<span class="go">  current   51  43     22</span>
<span class="go">  former    92  28     21</span>
<span class="go">  never     68  22      9</span>
</pre></div>
</div>
<p>In this example, there are 51 people who are current smokers and are
in the high SES. Note that it is assumed that the two lists given in
the table command are both factors. (More information on this is
available in the chapter on data types.)</p>
</div>
<div class="section" id="creating-a-table-directly">
<h3><a class="toc-backref" href="#id2">12.2. Creating a Table Directly</a></h3>
<p>Sometimes you are given data in the form of a table and would like to
create a table. Here we examine how to create the table
directly. Unfortunately, this is not as direct a method as might be
desired. Here we create an array of numbers, specify the row and
column names, and then convert it to a table.</p>
<p>In the example below we will create a table identical to the one given
above. In that example we have 3 columns, and the numbers are
specified by going across each row from top to bottom. We need to
specify the data and the number of rows:</p>
<span class="target" id="index-4"></span><span class="target" id="index-5"></span><span class="target" id="index-6"></span><div class="highlight-rconsole" id="index-7"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>smoke <span class="o">&lt;-</span> <span class="kt">matrix</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">51</span><span class="p">,</span><span class="m">43</span><span class="p">,</span><span class="m">22</span><span class="p">,</span><span class="m">92</span><span class="p">,</span><span class="m">28</span><span class="p">,</span><span class="m">21</span><span class="p">,</span><span class="m">68</span><span class="p">,</span><span class="m">22</span><span class="p">,</span><span class="m">9</span><span class="p">),</span>ncol<span class="o">=</span><span class="m">3</span><span class="p">,</span>byrow<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">colnames</span><span class="p">(</span>smoke<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;High&quot;</span><span class="p">,</span><span class="s">&quot;Low&quot;</span><span class="p">,</span><span class="s">&quot;Middle&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">rownames</span><span class="p">(</span>smoke<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;current&quot;</span><span class="p">,</span><span class="s">&quot;former&quot;</span><span class="p">,</span><span class="s">&quot;never&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>smoke <span class="o">&lt;-</span> <span class="kp">as.table</span><span class="p">(</span>smoke<span class="p">)</span>
<span class="gp">&gt; </span>smoke
<span class="go">        High Low Middle</span>
<span class="go">current   51  43     22</span>
<span class="go">former    92  28     21</span>
<span class="go">never     68  22      9</span>
</pre></div>
</div>
</div>
<div class="section" id="tools-for-working-with-tables">
<h3><a class="toc-backref" href="#id3">12.3. Tools For Working With Tables</a></h3>
<p>Here we look at some of the commands available to help look at the
information in a table in different ways. We assume that the data
using one of the methods above, and the table is called &#8220;smoke.&#8221;
First, there are a couple of ways to get graphical views of the data:</p>
<div class="highlight-rconsole" id="index-8"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>barplot<span class="p">(</span>smoke<span class="p">,</span>legend<span class="o">=</span><span class="bp">T</span><span class="p">,</span>beside<span class="o">=</span><span class="bp">T</span><span class="p">,</span>main<span class="o">=</span><span class="s">&#39;Smoking Status by SES&#39;</span><span class="p">)</span>
<span class="gp">&gt; </span>plot<span class="p">(</span>smoke<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Smoking Status By Socioeconomic Status&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are a number of ways to get the marginal distributions using the
margin.table command. If you just give the command the table it
calculates the total number of observations. You can also calculate
the marginal distributions across the rows or columns based on the one
optional argument:</p>
<div class="highlight-rconsole" id="index-9"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">)</span>
<span class="go">[1] 356</span>
<span class="gp">&gt; </span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">,</span><span class="m">1</span><span class="p">)</span>

<span class="go">current  former   never</span>
<span class="go">    116     141      99</span>
<span class="gp">&gt; </span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">,</span><span class="m">2</span><span class="p">)</span>

<span class="go">  High    Low Middle</span>
<span class="go">   211     93     52</span>
</pre></div>
</div>
<p>Combining these commands you can get the proportions:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>smoke<span class="o">/</span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">)</span>

<span class="go">                High        Low     Middle</span>
<span class="go">  current 0.14325843 0.12078652 0.06179775</span>
<span class="go">  former  0.25842697 0.07865169 0.05898876</span>
<span class="go">  never   0.19101124 0.06179775 0.02528090</span>
<span class="gp">&gt; </span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="o">/</span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">)</span>

<span class="go">  current    former     never</span>
<span class="go">0.3258427 0.3960674 0.2780899</span>
<span class="gp">&gt; </span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">)</span>

<span class="go">     High       Low    Middle</span>
<span class="go">0.5926966 0.2612360 0.1460674</span>
</pre></div>
</div>
<p>That is a little obtuse, so fortunately, there is a better way to get
the proportions using the prop.table command. You can specify the
proportions with respect to the different marginal distributions using
the optional argument:</p>
<div class="highlight-rconsole" id="index-10"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">prop.table</span><span class="p">(</span>smoke<span class="p">)</span>

<span class="go">                High        Low     Middle</span>
<span class="go">  current 0.14325843 0.12078652 0.06179775</span>
<span class="go">  former  0.25842697 0.07865169 0.05898876</span>
<span class="go">  never   0.19101124 0.06179775 0.02528090</span>
<span class="gp">&gt; </span><span class="kp">prop.table</span><span class="p">(</span>smoke<span class="p">,</span><span class="m">1</span><span class="p">)</span>

<span class="go">               High       Low    Middle</span>
<span class="go">  current 0.4396552 0.3706897 0.1896552</span>
<span class="go">  former  0.6524823 0.1985816 0.1489362</span>
<span class="go">  never   0.6868687 0.2222222 0.0909091</span>
<span class="gp">&gt; </span><span class="kp">prop.table</span><span class="p">(</span>smoke<span class="p">,</span><span class="m">2</span><span class="p">)</span>

<span class="go">               High       Low    Middle</span>
<span class="go">  current 0.2417062 0.4623656 0.4230769</span>
<span class="go">  former  0.4360190 0.3010753 0.4038462</span>
<span class="go">  never   0.3222749 0.2365591 0.1730769</span>
</pre></div>
</div>
<p>If you want to do a chi-squared test to determine if the proportions
are different, there is an easy way to do this. If we want to test at
the 95% confidence level we need only look at a summary of the table:</p>
<span class="target" id="index-11"></span><div class="highlight-rconsole" id="index-12"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>smoke<span class="p">)</span>
<span class="go">Number of cases in table: 356</span>
<span class="go">Number of factors: 2</span>
<span class="go">Test for independence of all factors:</span>
<span class="go">        Chisq = 18.51, df = 4, p-value = 0.0009808</span>
</pre></div>
</div>
<p>Since the p-value is less that 5% we can reject the null hypothesis at
the 95% confidence level and can say that the proportions vary.</p>
<p>Of course, there is a hard way to do this. This is not for the faint
of heart and involves some linear algebra which we will not
describe. If you wish to calculate the table of expected values then
you need to multiply the vectors of the margins and divide by the
total number of observations:</p>
<span class="target" id="index-13"></span><span class="target" id="index-14"></span><div class="highlight-rconsole" id="index-15"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>expected <span class="o">&lt;-</span> <span class="kp">as.array</span><span class="p">(</span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">,</span><span class="m">1</span><span class="p">))</span> <span class="o">%*%</span> <span class="kp">t</span><span class="p">(</span><span class="kp">as.array</span><span class="p">(</span><span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">,</span><span class="m">2</span><span class="p">)))</span> <span class="o">/</span> <span class="kp">margin.table</span><span class="p">(</span>smoke<span class="p">)</span>
<span class="gp">&gt; </span>expected

<span class="go">              High      Low   Middle</span>
<span class="go">  current 68.75281 30.30337 16.94382</span>
<span class="go">  former  83.57022 36.83427 20.59551</span>
<span class="go">  never   58.67697 25.86236 14.46067</span>
</pre></div>
</div>
<p>(The &#8220;t&#8221; function takes the transpose of the array.)</p>
<p>The result in this array and can be directly compared to the existing
table. We need the square of the difference between the two tables
divided by the expected values. The sum of all these values is the
Chi-squared statistic:</p>
<div class="highlight-rconsole" id="index-16"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>chi <span class="o">&lt;-</span> <span class="kp">sum</span><span class="p">((</span>expected <span class="o">-</span> <span class="kp">as.array</span><span class="p">(</span>smoke<span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="o">/</span>expected<span class="p">)</span>
<span class="gp">&gt; </span>chi
<span class="go">[1] 18.50974</span>
</pre></div>
</div>
<p>We can then get the p-value for this statistic:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span>pchisq<span class="p">(</span>chi<span class="p">,</span>df<span class="o">=</span><span class="m">4</span><span class="p">)</span>
<span class="go">[1] 0.0009808236</span>
</pre></div>
</div>
</div>
<div class="section" id="graphical-views-of-tables">
<h3><a class="toc-backref" href="#id4">12.4. Graphical Views of Tables</a></h3>
<p>The <em>plot</em> command will automatically produce a mosaic plot if its
primary argument is a table. Alternatively, you can call the
<em>mosaicplot</em> command directly.</p>
<span class="target" id="index-17"></span><span class="target" id="index-18"></span><div class="highlight-rconsole" id="index-19"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>smokerData <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&#39;smoker.csv&#39;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>header<span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="gp">&gt; </span>smoke <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>smokerData<span class="o">$</span>Smoke<span class="p">,</span>smokerData<span class="o">$</span>SES<span class="p">)</span>
<span class="gp">&gt; </span>mosaicplot<span class="p">(</span>smoke<span class="p">)</span>
<span class="gp">&gt; </span>help<span class="p">(</span>mosaicplot<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>The <em>mosaicplot</em> command takes many of the same arguments for
annotating a plot:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>mosaicplot<span class="p">(</span>smoke<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Smokers&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Status&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Economic Class&quot;</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>If you wish to switch which side (horizontal versus vertical) to
determine the primary proportion then you can use the <em>sort</em>
option. This can be used to switch whether the width or height is used
for the first proportional length:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>mosaicplot<span class="p">(</span>smoke<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Smokers&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Status&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Economic Class&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>mosaicplot<span class="p">(</span>smoke<span class="p">,</span>sort<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>Finally if you wish to switch which side is used for the vertical and
horzintal axis you can use the <em>dir</em> option:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>mosaicplot<span class="p">(</span>smoke<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Smokers&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Status&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;Economic Class&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>mosaicplot<span class="p">(</span>smoke<span class="p">,</span>dir<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="s">&quot;h&quot;</span><span class="p">))</span>
<span class="gp">&gt;</span>
</pre></div>
</div>


<h2></h2>
<h2>13. Data Management</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#appending-data" id="id1">Appending Data</a></li>
<li><a href="#applying-functions-across-data-elements" id="id2">Applying Functions Across Data Elements</a></li>
</ul>
</div>
<p>Here we look at some common tasks that come up when dealing with
data. These tasks range from assembling different data sets into more
convenient forms and ways to apply functions to different parts of the
data sets. The topics in this section demonstrate some of the power of
R, but it may not be clear at first. The functions are commonly used
in a wide variety of circumstances for a number of different
reasons. These tools have saved me a great deal of time and effort in
circumstances that I would not have predicted in advance.</p>
<p>The important thing to note, though, is that this section is called
&#8220;<em>Data Management.</em>&#8221; It is not called &#8220;<em>Data Manipulation.</em>&#8221;
Politicians &#8220;manipulate&#8221; data, we &#8220;manage&#8221; them.</p>
<div class="section" id="appending-data">
<h3><a class="toc-backref" href="#id1">13.1. Appending Data</a></h3>
<p>When you have more than one set of data you may want to bring them
together. You can bring different data sets together by appending as
rows (<em class="redword">rbind</em>) or by appending as columns (<em class="redword">cbind</em>). The first example
shows how this done with two data frames. The arguments to the
functions can take any number of objects. We only use two here to keep
the demonstration simpler, but additional data frames can be appended
in the same call. It is important to note that when you bring things
together as rows the names of the objects within the data frame must
be the same.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>one<span class="o">=</span><span class="kt">c</span><span class="p">(</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span>two<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="s">&quot;b&quot;</span><span class="p">))</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>one<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">),</span>two<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="s">&quot;d&quot;</span><span class="p">))</span>
<span class="gp">&gt; </span>a
<span class="go">  one two</span>
<span class="go">1   0   a</span>
<span class="go">2   1   a</span>
<span class="go">3   2   b</span>
<span class="gp">&gt; </span>b
<span class="go">  one two</span>
<span class="go">1  10   c</span>
<span class="go">2  11   c</span>
<span class="go">3  12   d</span>
<span class="gp">&gt; </span>v <span class="o">&lt;-</span> <span class="kp">rbind</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>v<span class="p">)</span>
<span class="go">[1] &quot;list&quot;</span>
<span class="gp">&gt; </span>v
<span class="go">  one two</span>
<span class="go">1   0   a</span>
<span class="go">2   1   a</span>
<span class="go">3   2   b</span>
<span class="go">4  10   c</span>
<span class="go">5  11   c</span>
<span class="go">6  12   d</span>
<span class="gp">&gt; </span>w <span class="o">&lt;-</span> <span class="kp">cbind</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>w<span class="p">)</span>
<span class="go">[1] &quot;list&quot;</span>
<span class="gp">&gt; </span>w
<span class="go">  one two one two</span>
<span class="go">1   0   a  10   c</span>
<span class="go">2   1   a  11   c</span>
<span class="go">3   2   b  12   d</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>w<span class="p">)</span> <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="s">&quot;three&quot;</span><span class="p">,</span><span class="s">&quot;four&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>w
<span class="go">  one two three four</span>
<span class="go">1   0   a    10    c</span>
<span class="go">2   1   a    11    c</span>
<span class="go">3   2   b    12    d</span>
</pre></div>
</div>
<p>The same commands also work with vectors and matrices and behave in a similar manner.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>A <span class="o">=</span> <span class="kt">matrix</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span>ncol<span class="o">=</span><span class="m">3</span><span class="p">,</span>byrow<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span>A
<span class="go">     [,1] [,2] [,3]</span>
<span class="go">[1,]    1    2    3</span>
<span class="go">[2,]    4    5    6</span>
<span class="gp">&gt; </span>B <span class="o">=</span> <span class="kt">matrix</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">20</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">40</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">60</span><span class="p">),</span>ncol<span class="o">=</span><span class="m">3</span><span class="p">,</span>byrow<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span>B
<span class="go">     [,1] [,2] [,3]</span>
<span class="go">[1,]   10   20   30</span>
<span class="go">[2,]   40   50   60</span>
<span class="gp">&gt; </span>V <span class="o">&lt;-</span> <span class="kp">rbind</span><span class="p">(</span>A<span class="p">,</span>B<span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>V<span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt; </span>V
<span class="go">     [,1] [,2] [,3]</span>
<span class="go">[1,]    1    2    3</span>
<span class="go">[2,]    4    5    6</span>
<span class="go">[3,]   10   20   30</span>
<span class="go">[4,]   40   50   60</span>
<span class="gp">&gt; </span>W <span class="o">&lt;-</span> <span class="kp">cbind</span><span class="p">(</span>A<span class="p">,</span>B<span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>W<span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt; </span>W
<span class="go">     [,1] [,2] [,3] [,4] [,5] [,6]</span>
<span class="go">[1,]    1    2    3   10   20   30</span>
<span class="go">[2,]    4    5    6   40   50   60</span>
</pre></div>
</div>
</div>
<div class="section" id="applying-functions-across-data-elements">
<h3><a class="toc-backref" href="#id2">13.2. Applying Functions Across Data Elements</a></h3>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><p id="index-2">The various <em>apply</em> functions can be an invaluable tool when trying to
work with subsets within a data set. The different versions of the
<em>apply</em> commands are used to take a function and have the function
perform an operation on each part of the data. There are a wide
variety of these commands, but we only look at two sets of them. The
first set, <em>lapply</em> and <em>sapply</em>, is used to apply a function to every
element in a list. The second one, <em>tapply</em>, is used to apply a
function on each set broken up by a given set of factors.</p>
<div class="section" id="operations-on-lists-and-vectors">
<h4>13.2.1. Operations on Lists and Vectors</h4>
<span class="target" id="index-3"></span><p id="index-4">First, the <em>lapply</em> command is used to take a list of items and
perform some function on each member of the list. That is, the list
includes a number of different objects. You want to perform some
operation on <strong>every</strong> object within the list. You can use <em>lapply</em> to
tell R to go through each item in the list and perform the desired
action on each item.</p>
<p>In the following example a list is created with three elements. The
first is a randomly generated set of numbers with a normal
distribution. The second is a randomly generated set of numbers with
an exponential distribution. The last is a set of factors. A summary
is then performed on each element in the list.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>a<span class="o">=</span>rnorm<span class="p">(</span><span class="m">200</span><span class="p">,</span>mean<span class="o">=</span><span class="m">1</span><span class="p">,</span>sd<span class="o">=</span><span class="m">10</span><span class="p">),</span>
<span class="go">            b=rexp(300,10.0),</span>
<span class="go">            c=as.factor(c(&quot;a&quot;,&quot;b&quot;,&quot;b&quot;,&quot;b&quot;,&quot;c&quot;,&quot;c&quot;)))</span>
<span class="gp">&gt; </span><span class="kp">lapply</span><span class="p">(</span>x<span class="p">,</span><span class="kp">summary</span><span class="p">)</span>
<span class="go">$a</span>
<span class="go">     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.</span>
<span class="go">-26.65000  -6.91200  -0.39250   0.09478   6.86700  32.00000</span>

<span class="go">$b</span>
<span class="go">     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.</span>
<span class="go">0.0001497 0.0242300 0.0633300 0.0895400 0.1266000 0.7160000</span>

<span class="go">$c</span>
<span class="go">a b c</span>
<span class="go">1 3 2</span>
</pre></div>
</div>
<p>The <em>lapply</em> command returns a list. The entries in the list have the
same names as the entries in the list that is passed to it. The values
of each entry are the results from applying the function. The <em>sapply</em>
function is similar, but the difference is that it <strong>tries</strong> to turn
the result into a vector or matrix if possible. If it does not make
sense then it returns a list just like the <em>lapply</em> command.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>a<span class="o">=</span>rnorm<span class="p">(</span><span class="m">8</span><span class="p">,</span>mean<span class="o">=</span><span class="m">1</span><span class="p">,</span>sd<span class="o">=</span><span class="m">10</span><span class="p">),</span>b<span class="o">=</span>rexp<span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">10.0</span><span class="p">))</span>
<span class="gp">&gt; </span>x
<span class="go">$a</span>
<span class="go">[1]  -0.3881426   6.2910959  13.0265859  -1.5296377   6.9285984 -28.3050569</span>
<span class="go">[7]  11.9119731  -7.6036997</span>

<span class="go">$b</span>
<span class="go">[1] 0.212689007 0.081818395 0.222462531 0.181424705 0.168476454 0.002924134</span>
<span class="go">[7] 0.007010114 0.016301837 0.081291728 0.055426055</span>

<span class="gp">&gt; </span>val <span class="o">&lt;-</span> <span class="kp">lapply</span><span class="p">(</span>x<span class="p">,</span><span class="kp">mean</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>val<span class="p">)</span>
<span class="go">[1] &quot;list&quot;</span>
<span class="gp">&gt; </span>val
<span class="go">$a</span>
<span class="go">[1] 0.04146456</span>

<span class="go">$b</span>
<span class="go">[1] 0.1029825</span>

<span class="gp">&gt; </span>val<span class="o">$</span>a
<span class="go">[1] 0.04146456</span>
<span class="gp">&gt; </span>val<span class="o">$</span>b
<span class="go">[1] 0.1029825</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>other <span class="o">&lt;-</span> <span class="kp">sapply</span><span class="p">(</span>x<span class="p">,</span><span class="kp">mean</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>other<span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt; </span>other
<span class="go">         a          b</span>
<span class="go">0.04146456 0.10298250</span>
<span class="gp">&gt; </span>other<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">         a</span>
<span class="go">0.04146456</span>
<span class="gp">&gt; </span>other<span class="p">[</span><span class="m">2</span><span class="p">]</span>
<span class="go">         b</span>
<span class="go">0.1029825</span>
</pre></div>
</div>
</div>
<div class="section" id="operations-by-factors">
<h4>13.2.2. Operations By Factors</h4>
<p id="index-5">Another widely used variant of the <em>apply</em> functions is the <em>tapply</em>
function. The <em>tapply</em> function will take a list of data, usually a vector, a list of factors of the same list, and a function. It will then apply the function to each subset of the data that matches each of the factors.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>val <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>a<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">20</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">50</span><span class="p">),</span>
<span class="go">                    b=as.factor(c(&quot;a&quot;,&quot;a&quot;,&quot;b&quot;,&quot;b&quot;,&quot;a&quot;,&quot;b&quot;)))</span>
<span class="gp">&gt; </span>val
<span class="go">   a b</span>
<span class="go">1  1 a</span>
<span class="go">2  2 a</span>
<span class="go">3 10 b</span>
<span class="go">4 20 b</span>
<span class="go">5  5 a</span>
<span class="go">6 50 b</span>
<span class="gp">&gt; </span>result <span class="o">&lt;-</span> <span class="kp">tapply</span><span class="p">(</span>val<span class="o">$</span>a<span class="p">,</span>val<span class="o">$</span>b<span class="p">,</span><span class="kp">mean</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>result<span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt; </span>result
<span class="go">       a         b</span>
<span class="go">2.666667 26.666667</span>
<span class="gp">&gt; </span>result<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">       a</span>
<span class="go">2.666667</span>
<span class="gp">&gt; </span>result<span class="p">[</span><span class="m">2</span><span class="p">]</span>
<span class="go">       b</span>
<span class="go">26.66667</span>
<span class="gp">&gt; </span>result <span class="o">&lt;-</span> <span class="kp">tapply</span><span class="p">(</span>val<span class="o">$</span>a<span class="p">,</span>val<span class="o">$</span>b<span class="p">,</span><span class="kp">summary</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>result<span class="p">)</span>
<span class="go">[1] &quot;list&quot;</span>
<span class="gp">&gt; </span>result
<span class="go">$a</span>
<span class="go"> Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">1.000   1.500   2.000   2.667   3.500   5.000</span>

<span class="go">$b</span>
<span class="go"> Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">10.00   15.00   20.00   26.67   35.00   50.00</span>

<span class="gp">&gt; </span>result<span class="o">$</span>a
<span class="go"> Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">1.000   1.500   2.000   2.667   3.500   5.000</span>
<span class="gp">&gt; </span>result<span class="o">$</span>b
<span class="go"> Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">10.00   15.00   20.00   26.67   35.00   50.00</span>
</pre></div>
</div>
</div>


<h2></h2>
<h2>14. Time Data Types</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#time-and-date-variables" id="id1">Time and Date Variables</a></li>
<li><a href="#time-operations" id="id2">Time Operations</a></li>
</ul>
</div>
<p id="index-0">The time data types are broken out into a separate section from the
introductory section on data types. (<a class="reference internal" href="types.html#basicdatatypes"><span>Basic Data Types</span></a>) The reason
for this is that dealing with time data can be subtle and must be done
carefully because the data type can be cast in a variety of different
ways. It is not an introductory topic, and if not done well can scare
off the normal people.</p>
<p>I will first go over the basic time data types and then explore the
different kinds of operations that are done with the time data
types. <strong>Please be cautious with time data and read the complete
description including the caveats. There are some common mistakes that
result in calculations that yield results that are very different from
the intended values.</strong></p>
<div class="section" id="time-and-date-variables">
<h3><a class="toc-backref" href="#id1">14.1. Time and Date Variables</a></h3>
<span class="target" id="index-1"></span><p id="index-2">There are a variety of different types specific to time data fields
in R. Here we only look at two, the POSIXct and POSIXlt data types:</p>
<p>POSIXct</p>
<blockquote>
<div>The POSIXct data type is the number of seconds since the start
of January 1, 1970. Negative numbers represent the number of seconds
before this time, and positive numbers represent the number of
seconds afterwards.</div></blockquote>
<p>POSIXlt</p>
<blockquote>
<div><p>The POSIXlt data type is a vector, and the entries in the vector
have the following meanings:</p>
<ol class="arabic simple">
<li>seconds</li>
<li>minutes</li>
<li>hours</li>
<li>day of month (1-31)</li>
<li>month of the year (0-11)</li>
<li>years since 1900</li>
<li>day of the week (0-6 where 0 represents Sunday)</li>
<li>day of the year (0-365)</li>
<li>Daylight savings indicator (positive if it is daylight savings)</li>
</ol>
</div></blockquote>
<p>Part of the difficulty with time data types is that R prints them out
in a way that is different from how it stores them internally. This
can make type conversions tricky, and you have to be careful and test
your operations to insure that R is doing what you think it is doing.</p>
<p>To get the current time, the <em>Sys.time()</em> can be used, and you can
play around a bit with the basic types to get a feel for what R is
doing. The <em>as.POSIXct</em> and <em>as.POSIXlt</em> commands are used to
convert the time value into the different formats.</p>
<span class="target" id="index-3"></span><div class="highlight-rconsole" id="index-4"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>DateTimeClasses<span class="p">)</span>
<span class="gp">&gt; </span>t <span class="o">&lt;-</span> <span class="kp">Sys.time</span><span class="p">()</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt; </span><span class="kp">t</span>
<span class="go">[1] &quot;2014-01-23 14:28:21 EST&quot;</span>
<span class="gp">&gt; </span><span class="kp">print</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span>
<span class="go">[1] &quot;2014-01-23 14:28:21 EST&quot;</span>
<span class="gp">&gt; </span><span class="kp">cat</span><span class="p">(</span><span class="kp">t</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="go">1390505301</span>
<span class="gp">&gt; </span><span class="kt">c</span> <span class="o">&lt;-</span> <span class="kp">as.POSIXct</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span><span class="kt">c</span><span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt; </span><span class="kp">print</span><span class="p">(</span><span class="kt">c</span><span class="p">)</span>
<span class="go">[1] &quot;2014-01-23 14:28:21 EST&quot;</span>
<span class="gp">&gt; </span><span class="kp">cat</span><span class="p">(</span><span class="kt">c</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="go">1390505301</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>l <span class="o">&lt;-</span> <span class="kp">as.POSIXlt</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span>
<span class="gp">&gt; </span>l
<span class="go">[1] &quot;2014-01-23 14:28:21 EST&quot;</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>l<span class="p">)</span>
<span class="go">[1] &quot;list&quot;</span>
<span class="gp">&gt; </span><span class="kp">print</span><span class="p">(</span>l<span class="p">)</span>
<span class="go">[1] &quot;2014-01-23 14:28:21 EST&quot;</span>
<span class="gp">&gt; </span><span class="kp">cat</span><span class="p">(</span>l<span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="go">Error in cat(list(...), file, sep, fill, labels, append) :</span>
<span class="go">argument 1 (type &#39;list&#39;) cannot be handled by &#39;cat&#39;</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>l<span class="p">)</span>
<span class="go">NULL</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="go">[1] 21.01023</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
<span class="go">[1] 28</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">3</span><span class="p">]]</span>
<span class="go">[1] 14</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">4</span><span class="p">]]</span>
<span class="go">[1] 23</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">5</span><span class="p">]]</span>
<span class="go">[1] 0</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">6</span><span class="p">]]</span>
<span class="go">[1] 114</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">7</span><span class="p">]]</span>
<span class="go">[1] 4</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">8</span><span class="p">]]</span>
<span class="go">[1] 22</span>
<span class="gp">&gt; </span>l<span class="p">[[</span><span class="m">9</span><span class="p">]]</span>
<span class="go">[1] 0</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>b <span class="o">&lt;-</span> <span class="kp">as.POSIXct</span><span class="p">(</span>l<span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">cat</span><span class="p">(</span>b<span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="go">1390505301</span>
</pre></div>
</div>
<p>There are times when you have a time data type and want to convert it
into a string so it can be saved into a file to be read by another
application.  The <em>strftime</em> command is used to take a time data type
and convert it to a string. You must supply an additional format
string to let R what format you want to use. See the help page on
<em>strftime</em> to get detailed information about the format string.</p>
<div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span><span class="kp">strftime</span><span class="p">)</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>t <span class="o">&lt;-</span> <span class="kp">Sys.time</span><span class="p">()</span>
<span class="gp">&gt; </span><span class="kp">cat</span><span class="p">(</span><span class="kp">t</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="go">1390506463</span>
<span class="gp">&gt; </span>timeStamp <span class="o">&lt;-</span>  <span class="kp">strftime</span><span class="p">(</span><span class="kp">t</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>timeStamp
<span class="go">[1] &quot;2014-01-23 14:47:43&quot;</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>timeStamp<span class="p">)</span>
<span class="go">[1] &quot;character&quot;</span>
</pre></div>
</div>
<p>Commonly a time stamp is saved in a data file, and it must be
converted into a time data type to allow for calculations. For
example, you may be interested in how much time has elapsed between
two observations. The <em>strptime</em> command is used to take a string and
convert it into a time data type. Like <em>strftime</em> it requires a format
string in addition to the time stamp.</p>
<p>The <em>strptime</em> command is used to take a string and convert it into a
form that R can use for calculations. In the following example a data
frame is defined that has the dates stored as strings. If you read the
data in from a csv file this is how R will keep track of the
data. Note that in this context the strings are assumed to represent
ordinal data, and R will assume that the data field is a set of
factors. You have to use the <em>strptime</em> command to convert it into a
time field.</p>
<div class="highlight-rconsole" id="index-6"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>myData <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>time<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;2014-01-23 14:28:21&quot;</span><span class="p">,</span><span class="s">&quot;2014-01-23 14:28:55&quot;</span><span class="p">,</span>
<span class="go">                              &quot;2014-01-23 14:29:02&quot;,&quot;2014-01-23 14:31:18&quot;),</span>
<span class="go">                      speed=c(2.0,2.2,3.4,5.5))</span>
<span class="gp">&gt; </span>myData
<span class="go">                 time speed</span>
<span class="go">1 2014-01-23 14:28:21   2.0</span>
<span class="go">2 2014-01-23 14:28:55   2.2</span>
<span class="go">3 2014-01-23 14:29:02   3.4</span>
<span class="go">4 2014-01-23 14:31:18   5.5</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>myData<span class="p">)</span>
<span class="go">                 time       speed</span>
<span class="go">2014-01-23 14:28:21:1   Min.   :2.000</span>
<span class="go">2014-01-23 14:28:55:1   1st Qu.:2.150</span>
<span class="go">2014-01-23 14:29:02:1   Median :2.800</span>
<span class="go">2014-01-23 14:31:18:1   Mean   :3.275</span>
<span class="go">                        3rd Qu.:3.925</span>
<span class="go">                        Max.   :5.500</span>
<span class="gp">&gt; </span>myData<span class="o">$</span>time<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">[1] 2014-01-23 14:28:21</span>
<span class="go">4 Levels: 2014-01-23 14:28:21 2014-01-23 14:28:55 ... 2014-01-23 14:31:18</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>myData<span class="o">$</span>time<span class="p">[</span><span class="m">1</span><span class="p">])</span>
<span class="go">[1] &quot;integer&quot;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>myData<span class="o">$</span>time <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span>myData<span class="o">$</span>time<span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>myData
<span class="go">                 time speed</span>
<span class="go">1 2014-01-23 14:28:21   2.0</span>
<span class="go">2 2014-01-23 14:28:55   2.2</span>
<span class="go">3 2014-01-23 14:29:02   3.4</span>
<span class="go">4 2014-01-23 14:31:18   5.5</span>
<span class="gp">&gt; </span>myData<span class="o">$</span>time<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">[1] &quot;2014-01-23 14:28:21&quot;</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>myData<span class="o">$</span>time<span class="p">[</span><span class="m">1</span><span class="p">])</span>
<span class="go">[1] &quot;list&quot;</span>
<span class="gp">&gt; </span>myData<span class="o">$</span>time<span class="p">[</span><span class="m">1</span><span class="p">][[</span><span class="m">2</span><span class="p">]]</span>
<span class="go">[1] 28</span>
</pre></div>
</div>
<p>Now you can perform operations on the fields. For example you can
determine the time between observations. (Please see the notes below
on time operations. This example is a bit misleading!)</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>N <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>myData<span class="o">$</span>time<span class="p">)</span>
<span class="gp">&gt; </span>myData<span class="o">$</span>time<span class="p">[</span><span class="m">2</span><span class="o">:</span>N<span class="p">]</span> <span class="o">-</span> myData<span class="o">$</span>time<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">(</span>N<span class="m">-1</span><span class="p">)]</span>
<span class="go">Time differences in secs</span>
<span class="go">[1]  34   7 136</span>
<span class="go">attr(,&quot;tzone&quot;)</span>
<span class="go">[1] &quot;&quot;</span>
</pre></div>
</div>
<p id="index-7">In addition to the time data types R also has a date data type. The
difference is that the date data type keeps track of numbers of days
rather than seconds. You can cast a string into a date type using the
<em>as.Date</em> function. The <em>as.Date</em> function takes the same arguments as
the time data types discussed above.</p>
<div class="highlight-rconsole" id="index-8"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>theDates <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;1 jan 2012&quot;</span><span class="p">,</span><span class="s">&quot;1 jan 2013&quot;</span><span class="p">,</span><span class="s">&quot;1 jan 2014&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>dateFields <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span>theDates<span class="p">,</span><span class="s">&quot;%d %b %Y&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>dateFields<span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt; </span>dateFields
<span class="go">[1] &quot;2012-01-01&quot; &quot;2013-01-01&quot; &quot;2014-01-01&quot;</span>
<span class="gp">&gt; </span>N <span class="o">&lt;-</span> <span class="kp">length</span><span class="p">(</span>dateFields<span class="p">)</span>
<span class="gp">&gt; </span>diff <span class="o">&lt;-</span> dateFields<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">(</span>N<span class="m">-1</span><span class="p">)]</span> <span class="o">-</span> dateFields<span class="p">[</span><span class="m">2</span><span class="o">:</span>N<span class="p">]</span>
<span class="gp">&gt; </span><span class="kp">diff</span>
<span class="go">Time differences in days</span>
<span class="go">[1] -366 -365</span>
</pre></div>
</div>
<p>You can also define a date in terms of the number days after another
date using the <em>origin</em> option.</p>
<div class="highlight-rconsole" id="index-9"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>infamy <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span><span class="m">-179</span><span class="p">,</span>origin<span class="o">=</span><span class="s">&quot;1942-06-04&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>infamy
<span class="go">[1] &quot;1941-12-07&quot;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>today <span class="o">&lt;-</span> <span class="kp">Sys.Date</span><span class="p">()</span>
<span class="gp">&gt; </span>today
<span class="go">[1] &quot;2014-01-23&quot;</span>
<span class="gp">&gt; </span>today<span class="o">-</span>infamy
<span class="go">Time difference of 26345 days</span>
</pre></div>
</div>
<p>Finally, a nice function to know about and use is the <em>format</em>
command. It can be used in a wide variety of situations, and not just
for dates. It is helpful for dates, though, because you can use it in
<em>cat</em> and <em>print</em> statements to make sure that your output is in
exactly the form that you want.</p>
<div class="highlight-rconsole" id="index-10"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>theTime <span class="o">&lt;-</span> <span class="kp">Sys.time</span><span class="p">()</span>
<span class="gp">&gt; </span>theTime
<span class="go">[1] &quot;2014-01-23 16:15:05 EST&quot;</span>
<span class="gp">&gt; </span>a <span class="o">&lt;-</span> rexp<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0.1</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">[1] 7.432072</span>
<span class="gp">&gt; </span><span class="kp">cat</span><span class="p">(</span><span class="s">&quot;At about&quot;</span><span class="p">,</span><span class="kp">format</span><span class="p">(</span>theTime<span class="p">,</span><span class="s">&quot;%H:%M&quot;</span><span class="p">),</span><span class="s">&quot;the time between occurances was around&quot;</span><span class="p">,</span><span class="kp">format</span><span class="p">(</span>a<span class="p">,</span>digits<span class="o">=</span><span class="m">3</span><span class="p">),</span><span class="s">&quot;seconds\n&quot;</span><span class="p">)</span>
<span class="go">At about 16:15 the time between occurances was around 7.43 seconds</span>
</pre></div>
</div>
</div>
<div class="section" id="time-operations">
<h3><a class="toc-backref" href="#id2">14.2. Time Operations</a></h3>
<p>The most difficult part of dealing with time data can be converting it
into the right format. Once a time or date is stored in R&#8217;s internal
format then a number of basic operations are available. The thing to
keep in mind, though, is that the units you get after an operation can
vary depending on the magnitude of the time values. Be very careful
when dealing with time operations and vigorously test your codes.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>now <span class="o">&lt;-</span> <span class="kp">Sys.time</span><span class="p">()</span>
<span class="gp">&gt; </span>now
<span class="go">[1] &quot;2014-01-23 16:31:00 EST&quot;</span>
<span class="gp">&gt; </span>now<span class="m">-60</span>
<span class="go">[1] &quot;2014-01-23 16:30:00 EST&quot;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>earlier <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span><span class="s">&quot;2000-01-01 00:00:00&quot;</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>later <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span><span class="s">&quot;2000-01-01 00:00:20&quot;</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>later<span class="o">-</span>earlier
<span class="go">Time difference of 20 secs</span>
<span class="gp">&gt; </span><span class="kp">as.double</span><span class="p">(</span>later<span class="o">-</span>earlier<span class="p">)</span>
<span class="go">[1] 20</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>earlier <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span><span class="s">&quot;2000-01-01 00:00:00&quot;</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>later <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span><span class="s">&quot;2000-01-01 01:00:00&quot;</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>later<span class="o">-</span>earlier
<span class="go">Time difference of 1 hours</span>
<span class="gp">&gt; </span><span class="kp">as.double</span><span class="p">(</span>later<span class="o">-</span>earlier<span class="p">)</span>
<span class="go">[1] 1</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>up <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span><span class="s">&quot;1961-08-13&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>down <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span><span class="s">&quot;1989-11-9&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>down<span class="o">-</span>up
<span class="go">Time difference of 10315 days</span>
</pre></div>
</div>
<p>The two examples involving the variables <em>earlier</em> and <em>later</em> in the
previous code sample should cause you a little concern. The value of
the difference depends on the largest units with respect to the
difference! The issue is that when you subtract dates R uses the
equivalent of the <em>difftime</em> command. We need to know how this
operates to reduce the ambiguity when comparing times.</p>
<div class="highlight-rconsole" id="index-11"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span><span class="kp">difftime</span><span class="p">)</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>earlier <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span><span class="s">&quot;2000-01-01 00:00:00&quot;</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>later <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span><span class="s">&quot;2000-01-01 01:00:00&quot;</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">difftime</span><span class="p">(</span>later<span class="p">,</span>earlier<span class="p">)</span>
<span class="go">Time difference of 1 hours</span>
<span class="gp">&gt; </span><span class="kp">difftime</span><span class="p">(</span>later<span class="p">,</span>earlier<span class="p">,</span>units<span class="o">=</span><span class="s">&quot;secs&quot;</span><span class="p">)</span>
<span class="go">Time difference of 3600 secs</span>
</pre></div>
</div>
<p>One thing to be careful about <em>difftime</em> is that it is a double
precision number, but it has units attached to it. This can be tricky,
and you should be careful about the ambiguity in using this command. I
personally always try to specify the units to avoid this.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>earlier <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span><span class="s">&quot;2000-01-01 00:00:00&quot;</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>later <span class="o">&lt;-</span> <span class="kp">strptime</span><span class="p">(</span><span class="s">&quot;2000-01-01 00:00:20&quot;</span><span class="p">,</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>d <span class="o">&lt;-</span> <span class="kp">difftime</span><span class="p">(</span>later<span class="p">,</span>earlier<span class="p">)</span>
<span class="gp">&gt; </span>d
<span class="go">Time difference of 20 secs</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>d<span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt; </span><span class="kp">as.double</span><span class="p">(</span>d<span class="p">)</span>
<span class="go">[1] 20</span>
</pre></div>
</div>
<p>Another way to define a time difference is to use the <em>as.difftime</em>
command. It takes two dates and will compute the difference between
them. It takes a time, its format, and the units to use. Note that in
the following example R is able to figure out what the units are when
making the calculation.</p>
<div class="highlight-rconsole" id="index-12"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>diff <span class="o">&lt;-</span> <span class="kp">as.difftime</span><span class="p">(</span><span class="s">&quot;00:30:00&quot;</span><span class="p">,</span><span class="s">&quot;%H:%M:%S&quot;</span><span class="p">,</span>units<span class="o">=</span><span class="s">&quot;hour&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">diff</span>
<span class="go">Time difference of 0.5 hours</span>
<span class="gp">&gt; </span><span class="kp">Sys.time</span><span class="p">()</span>
<span class="go">[1] &quot;2014-01-23 16:45:39 EST&quot;</span>
<span class="gp">&gt; </span><span class="kp">Sys.time</span><span class="p">()</span><span class="o">+</span><span class="kp">diff</span>
<span class="go">[1] &quot;2014-01-23 17:15:41 EST&quot;</span>
</pre></div>
</div>
<p>The last thing to mention is that once a time stamp is cast into one
of R&#8217;s internal formats comparisons can be made in a natural way.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>diff <span class="o">&lt;-</span> <span class="kp">as.difftime</span><span class="p">(</span><span class="s">&quot;00:30:00&quot;</span><span class="p">,</span><span class="s">&quot;%H:%M:%S&quot;</span><span class="p">,</span>units<span class="o">=</span><span class="s">&quot;hour&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>now <span class="o">&lt;-</span> <span class="kp">Sys.time</span><span class="p">()</span>
<span class="gp">&gt; </span>later <span class="o">&lt;-</span> now <span class="o">+</span> <span class="kp">diff</span>
<span class="gp">&gt; </span>now
<span class="go">[1] &quot;2014-01-23 16:47:48 EST&quot;</span>
<span class="gp">&gt; </span>later
<span class="go">[1] &quot;2014-01-23 17:17:48 EST&quot;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span><span class="kr">if</span><span class="p">(</span>now <span class="o">&lt;</span> later<span class="p">)</span>
<span class="go">  {</span>
<span class="go">     cat(&quot;there you go\n&quot;)</span>
<span class="go">  }</span>
<span class="go">there you go</span>
</pre></div>
</div>


<h2></h2>
<h2>15. Introduction to Programming</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#executing-a-file" id="id2">Executing a file</a></li>
<li><a href="#functions" id="id3">Functions</a></li>
</ul>
</div>
<p>We look at running commands from a source file. We also include an
overview of the different statements that are used for <em>control-flow</em>
that determines which code is executed by the interpreter.</p>
<div class="section" id="executing-a-file">
<h3><a class="toc-backref" href="#id2">15.1. Executing a file</a></h3>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#executing-the-commands-in-a-file" id="id4">Executing the commands in a File</a></li>
<li><a href="#if-statements" id="id5">if statements</a></li>
<li><a href="#for-statements" id="id6">for statements</a></li>
<li><a href="#while-statements" id="id7">while statements</a></li>
<li><a href="#repeat-statements" id="id8">repeat statements</a></li>
<li><a href="#break-and-next-statements" id="id9">break and next statements</a></li>
<li><a href="#switch-statement" id="id10">switch statement</a></li>
<li><a href="#scan-statement" id="id11">scan statement</a></li>
</ul>
</div>
<span class="target" id="index-0"></span><p id="index-1">In the next section the ways to execute the commands in a file using
the <em>source</em> command are given. The remaining sections are used to
list the various flow control options that are available in the R
language definition. The language definition has a wide variety of
control functions which can be found using the <em>help</em> command.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>Control<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<div class="section" id="executing-the-commands-in-a-file">
<h4><a class="toc-backref" href="#id4">15.1.1. Executing the commands in a File</a></h4>
<p>A set of R commands can be saved in a file and then executed as if you
had typed them in from the command line. The <em>source</em> command is used
to read the file and execute the commands in the same sequence given
in the file.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kn">source</span><span class="p">(</span><span class="s">&#39;file.R&#39;</span><span class="p">)</span>
<span class="gp">&gt; </span>help<span class="p">(</span><span class="kn">source</span><span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<p>If you simply source the file the commands are not printed, and the
results of commands are not printed. This can be overridden using the
<em>echo</em>, <em>print.eval</em>, and <em>verbose</em> options.</p>
<p>Some examples are given assuming that a file, <em>simpleEx.R</em>, is in the
current directory. The file is given below:</p>
<span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><div class="highlight-r" id="index-5"><div class="highlight"><pre><span></span><span class="c1"># Define a variable.</span>
x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">)</span>

<span class="c1"># calculate the mean of x and print out the results.</span>
mux <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">)</span>
<span class="kp">cat</span><span class="p">(</span><span class="s">&quot;The mean of x is &quot;</span><span class="p">,</span><span class="kp">mean</span><span class="p">(</span>x<span class="p">),</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>

<span class="c1"># print out a summary of the results</span>
<span class="kp">summary</span><span class="p">(</span>x<span class="p">)</span>
<span class="kp">cat</span><span class="p">(</span><span class="s">&quot;The summary of x is \n&quot;</span><span class="p">,</span><span class="kp">summary</span><span class="p">(</span>x<span class="p">),</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="kp">print</span><span class="p">(</span><span class="kp">summary</span><span class="p">(</span>x<span class="p">))</span>
</pre></div>
</div>
<p>The file also demonstrates the use of <em>#</em> to specify
comments. Anything after the <em>#</em> is ignored. Also, the file
demonstrates the use of <em>cat</em> and <em>print</em> to send results to the
standard output. Note that the commands have options to send results
to a file. Use <em>help</em> for more information.</p>
<p>The output for the different options can be found below:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kn">source</span><span class="p">(</span><span class="s">&#39;simpleEx.R&#39;</span><span class="p">)</span>
<span class="go">The mean of x is  -0.4817475</span>
<span class="go">The summary of x is</span>
<span class="go">-2.24 -0.5342 -0.2862 -0.4817 -0.1973 0.4259</span>
<span class="go">    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go"> -2.2400 -0.5342 -0.2862 -0.4817 -0.1973  0.4259</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span><span class="kn">source</span><span class="p">(</span><span class="s">&#39;simpleEx.R&#39;</span><span class="p">,</span>echo<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="go">    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.</span>
<span class="go">-2.32600 -0.69140 -0.06772 -0.13540  0.46820  1.69600</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span><span class="kn">source</span><span class="p">(</span><span class="s">&#39;simpleEx.R&#39;</span><span class="p">,</span>print.eval<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="go">The mean of x is  0.1230581</span>
<span class="go">    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">-1.7020 -0.2833  0.1174  0.1231  0.9103  1.2220</span>
<span class="go">The summary of x is</span>
<span class="go">-1.702 -0.2833 0.1174 0.1231 0.9103 1.222</span>
<span class="go">   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">-1.7020 -0.2833  0.1174  0.1231  0.9103  1.2220</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span><span class="kn">source</span><span class="p">(</span><span class="s">&#39;simpleEx.R&#39;</span><span class="p">,</span>print.eval<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="go">The mean of x is  0.6279428</span>
<span class="go">The summary of x is</span>
<span class="go">-0.7334 -0.164 0.9335 0.6279 1.23 1.604</span>
<span class="go">   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">-0.7334 -0.1640  0.9335  0.6279  1.2300  1.6040</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span><span class="kn">source</span><span class="p">(</span><span class="s">&#39;simpleEx.R&#39;</span><span class="p">,</span>verbose<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="go">&#39;envir&#39; chosen:&lt;environment: R_GlobalEnv&gt;</span>
<span class="go">encoding = &quot;native.enc&quot; chosen</span>
<span class="go">--&gt; parsed 6 expressions; now eval(.)ing them:</span>

<span class="gp">&gt;&gt;</span><span class="o">&gt;&gt;</span> <span class="kp">eval</span><span class="p">(</span>expression_nr. <span class="m">1</span> <span class="p">)</span>
<span class="go">                 =================</span>

<span class="gp">&gt; </span><span class="c1"># Define a variable.</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">)</span>
<span class="go">curr.fun: symbol &lt;-</span>
<span class="go"> .. after âexpression(x &lt;- rnorm(10))â</span>

<span class="gp">&gt;&gt;</span><span class="o">&gt;&gt;</span> <span class="kp">eval</span><span class="p">(</span>expression_nr. <span class="m">2</span> <span class="p">)</span>
<span class="go">                 =================</span>

<span class="gp">&gt; </span><span class="c1"># calculate the mean of x and print out the results.</span>
<span class="gp">&gt; </span>mux <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">)</span>
<span class="go">curr.fun: symbol =</span>
<span class="go"> .. after âexpression(mux = mean(x))â</span>

<span class="gp">&gt;&gt;</span><span class="o">&gt;&gt;</span> <span class="kp">eval</span><span class="p">(</span>expression_nr. <span class="m">3</span> <span class="p">)</span>
<span class="go">                 =================</span>

<span class="gp">&gt; </span><span class="kp">cat</span><span class="p">(</span><span class="s">&quot;The mean of x is &quot;</span><span class="p">,</span><span class="kp">mean</span><span class="p">(</span>x<span class="p">),</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="go">The mean of x is  -0.1090932</span>
<span class="go">curr.fun: symbol cat</span>
<span class="go"> .. after âexpression(cat(&quot;The mean of x is &quot;,mean(x),&quot;\n&quot;))â</span>

<span class="gp">&gt;&gt;</span><span class="o">&gt;&gt;</span> <span class="kp">eval</span><span class="p">(</span>expression_nr. <span class="m">4</span> <span class="p">)</span>
<span class="go">                 =================</span>

<span class="gp">&gt; </span><span class="c1"># print out a summary of the results</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>x<span class="p">)</span>
<span class="go">curr.fun: symbol summary</span>
<span class="go">   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">-1.3820 -1.0550 -0.1995 -0.1091  0.6813  2.1050</span>
<span class="go"> .. after âexpression(summary(x))â</span>

<span class="gp">&gt;&gt;</span><span class="o">&gt;&gt;</span> <span class="kp">eval</span><span class="p">(</span>expression_nr. <span class="m">5</span> <span class="p">)</span>
<span class="go">                 =================</span>

<span class="gp">&gt; </span><span class="kp">cat</span><span class="p">(</span><span class="s">&quot;The summary of x is \n&quot;</span><span class="p">,</span><span class="kp">summary</span><span class="p">(</span>x<span class="p">),</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="go">The summary of x is</span>
<span class="go"> -1.382 -1.055 -0.1995 -0.1091 0.6813 2.105</span>
<span class="go">curr.fun: symbol cat</span>
<span class="go"> .. after âexpression(cat(&quot;The summary of x is \n&quot;,summary(x),&quot;\n&quot;))â</span>

<span class="gp">&gt;&gt;</span><span class="o">&gt;&gt;</span> <span class="kp">eval</span><span class="p">(</span>expression_nr. <span class="m">6</span> <span class="p">)</span>
<span class="go">                 =================</span>

<span class="gp">&gt; </span><span class="kp">print</span><span class="p">(</span><span class="kp">summary</span><span class="p">(</span>x<span class="p">))</span>
<span class="go">   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.</span>
<span class="go">-1.3820 -1.0550 -0.1995 -0.1091  0.6813  2.1050</span>
<span class="go">curr.fun: symbol print</span>
<span class="go"> .. after âexpression(print(summary(x)))â</span>
</pre></div>
</div>
<p>One common problem that occurs is that R may not know where to find a
file.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kn">source</span><span class="p">(</span><span class="s">&#39;notThere.R&#39;</span><span class="p">)</span>
<span class="go">Error in file(filename, &quot;r&quot;, encoding = encoding) :</span>
<span class="go">  cannot open the connection</span>
<span class="go">In addition: Warning message:</span>
<span class="go">In file(filename, &quot;r&quot;, encoding = encoding) :</span>
<span class="go">  cannot open file &#39;notThere.R&#39;: No such file or directory</span>
</pre></div>
</div>
<p>R will search the current working directory. You can see what files
are in the directory using the <em>dir</em> command, and you can determine
the current directory using the <em>getwd</em> command.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">getwd</span><span class="p">()</span>
<span class="go">[1] &quot;/home/black/public_html/tutorial/R/rst/source/R&quot;</span>
<span class="gp">&gt; </span><span class="kp">dir</span><span class="p">()</span>
<span class="go">[1] &quot;plotting.rData&quot; &quot;power.R&quot;        &quot;shadedRegion.R&quot;</span>
</pre></div>
</div>
<p id="index-6">You can change the current directory, and the options available depend
on how you are using R. For example on a Windows PC or a Macintosh you
can use the menu options to change the working directory. You can
choose the directory using a graphical file browser. Otherwise, you
can change to the correct directory before running R or use the
<em>setwd</em> command.</p>
</div>
<div class="section" id="if-statements">
<h4><a class="toc-backref" href="#id5">15.1.2. if statements</a></h4>
<span class="target" id="index-7"></span><p id="index-8">Conditional execution is available using the <em>if</em> statement and the
corresponding <em>else</em> statement.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> <span class="m">0.1</span>
<span class="gp">&gt; </span><span class="kr">if</span><span class="p">(</span> x <span class="o">&lt;</span> <span class="m">0.2</span><span class="p">)</span>
<span class="go">  {</span>
<span class="go">     x &lt;- x + 1</span>
<span class="go">     cat(&quot;increment that number!\n&quot;)</span>
<span class="go">  }</span>
<span class="go">increment that number!</span>
<span class="gp">&gt; </span>x
<span class="go">[1] 1.1</span>
</pre></div>
</div>
<p>The else statement can be used to specify an alternate option. In the
example below note that the <em>else</em> statement must be on the same line
as the ending brace for the previous <em>if</em> block.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> <span class="m">2.0</span>
<span class="gp">&gt; </span><span class="kr">if</span> <span class="p">(</span> x <span class="o">&lt;</span> <span class="m">0.2</span><span class="p">)</span>
<span class="go"> {</span>
<span class="go">    x &lt;- x + 1</span>
<span class="go">    cat(&quot;increment that number!\n&quot;)</span>
<span class="go"> } else</span>
<span class="go"> {</span>
<span class="go">    x &lt;- x - 1</span>
<span class="go">    cat(&quot;nah, make it smaller.\n&quot;);</span>
<span class="go"> }</span>
<span class="go">nah, make it smaller.</span>
<span class="gp">&gt; </span>x
<span class="go">[1] 1</span>
</pre></div>
</div>
<p>Finally, the <em>if</em> statements can be chained together for multiple
options. The <em>if</em> statement is considered a single code block, so more
<em>if</em> statements can be added after the <em>else</em>.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">=</span> <span class="m">1.0</span>
<span class="gp">&gt; </span><span class="kr">if</span> <span class="p">(</span> x <span class="o">&lt;</span> <span class="m">0.2</span><span class="p">)</span>
<span class="go"> {</span>
<span class="go">    x &lt;- x + 1</span>
<span class="go">    cat(&quot;increment that number!\n&quot;)</span>
<span class="go"> } else if ( x &lt; 2.0)</span>
<span class="go"> {</span>
<span class="go">   x &lt;- 2.0*x</span>
<span class="go">   cat(&quot;not big enough!\n&quot;)</span>
<span class="go"> } else</span>
<span class="go"> {</span>
<span class="go">    x &lt;- x - 1</span>
<span class="go">    cat(&quot;nah, make it smaller.\n&quot;);</span>
<span class="go"> }</span>
<span class="go">not big enough!</span>
<span class="gp">&gt; </span>x
<span class="go">[1] 2</span>
</pre></div>
</div>
<p>The argument to the <em>if</em> statement is a logical expression. A full
list of logical operators can be found in the types document focusing
on logical variables (<a class="reference internal" href="types.html#logicaloperators"><span>Logical</span></a>).</p>
</div>
<div class="section" id="for-statements">
<h4><a class="toc-backref" href="#id6">15.1.3. for statements</a></h4>
<p id="index-9">The <em>for</em> loop can be used to repeat a set of instructions, and it is
used when you know in advance the values that the loop variable will
have each time it goes through the loop. The basic format for the
<em>for</em> loop is <em>for(var in seq) expr</em></p>
<p>An example is given below:</p>
<div class="highlight-rconsole" id="index-10"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kr">for</span> <span class="p">(</span>lupe <span class="kr">in</span> <span class="kp">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>by<span class="o">=</span><span class="m">0.3</span><span class="p">))</span>
<span class="go"> {</span>
<span class="go">    cat(lupe,&quot;\n&quot;);</span>
<span class="go"> }</span>
<span class="go">0</span>
<span class="go">0.3</span>
<span class="go">0.6</span>
<span class="go">0.9</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">16</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kr">for</span> <span class="p">(</span>loop <span class="kr">in</span> x<span class="p">)</span>
<span class="go"> {</span>
<span class="go">    cat(&quot;value of loop: &quot;,loop,&quot;\n&quot;);</span>
<span class="go"> }</span>
<span class="go">value of loop:  1</span>
<span class="go">value of loop:  2</span>
<span class="go">value of loop:  4</span>
<span class="go">value of loop:  8</span>
<span class="go">value of loop:  16</span>
</pre></div>
</div>
<p>See the section on breaks for more options (<a class="reference internal" href="#break"><span>break and next statements</span></a>)</p>
</div>
<div class="section" id="while-statements">
<h4><a class="toc-backref" href="#id7">15.1.4. while statements</a></h4>
<p id="index-11">The <em>while</em> loop can be used to repeat a set of instructions, and it
is often used when you do not know in advance how often the
instructions will be executed. The basic format for a <em>while</em> loop is
<em>while(cond) expr</em></p>
<div class="highlight-rconsole" id="index-12"><div class="highlight"><pre><span></span><span class="gp">&gt;</span>
<span class="gp">&gt; </span>lupe <span class="o">&lt;-</span> <span class="m">1</span><span class="p">;</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="m">1</span>
<span class="gp">&gt; </span><span class="kr">while</span><span class="p">(</span>x <span class="o">&lt;</span> <span class="m">4</span><span class="p">)</span>
<span class="go"> {</span>
<span class="go">    x &lt;- rnorm(1,mean=2,sd=3)</span>
<span class="go">    cat(&quot;trying this value: &quot;,x,&quot; (&quot;,lupe,&quot; times in loop)\n&quot;);</span>
<span class="go">    lupe &lt;- lupe + 1</span>
<span class="go"> }</span>
<span class="go">trying this value:  -4.163169  ( 1  times in loop)</span>
<span class="go">trying this value:  3.061946  ( 2  times in loop)</span>
<span class="go">trying this value:  2.10693  ( 3  times in loop)</span>
<span class="go">trying this value:  -2.06527  ( 4  times in loop)</span>
<span class="go">trying this value:  0.8873237  ( 5  times in loop)</span>
<span class="go">trying this value:  3.145076  ( 6  times in loop)</span>
<span class="go">trying this value:  4.504809  ( 7  times in loop)</span>
</pre></div>
</div>
<p>See the section on breaks for more options (<a class="reference internal" href="#break"><span>break and next statements</span></a>)</p>
</div>
<div class="section" id="repeat-statements">
<h4><a class="toc-backref" href="#id8">15.1.5. repeat statements</a></h4>
<p id="index-13">The <em>repeat</em> loop is similar to the <em>while</em> loop. The difference is
that it will always begin the loop the first time. The <em>while</em> loop
will only start the loop if the condition is true the first time it is
evaluated. Another difference is that you have to explicitly specify
when to stop the loop using the <em>break</em> command.</p>
<p>That is you need to execute the <em>break</em> statement to get out of the
loop.</p>
<div class="highlight-rconsole" id="index-14"><div class="highlight"><pre><span></span><span class="gp">&gt; </span> <span class="kr">repeat</span>
<span class="go">{</span>
<span class="go">    x &lt;- rnorm(1)</span>
<span class="go">    if(x &lt; -2.0) break</span>
<span class="go">}</span>
<span class="gp">&gt; </span>x
<span class="go">[1] -2.300532</span>
</pre></div>
</div>
<p>See the section on breaks for more options (<a class="reference internal" href="#break"><span>break and next statements</span></a>)</p>
</div>
<div class="section" id="break-and-next-statements">
<span id="break"></span>
<h4><a class="toc-backref" href="#id9">15.1.6. break and next statements</a></h4>
<span class="target" id="index-15"></span><p id="index-16">The <em>break</em> statement is used to stop the execution of the current
loop. It will break out of the current loop. The <em>next</em> statement is
used to skip the statements that follow and restart the current
loop. If a <em>for</em> loop is used then the <em>next</em> statement will update
the loop variable.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>x
<span class="go">[1]  1.41699338  2.28086759 -0.01571884  0.56578443  0.60400784</span>
<span class="gp">&gt; </span><span class="kr">for</span><span class="p">(</span>lupe <span class="kr">in</span> x<span class="p">)</span>
<span class="go"> {</span>
<span class="go">     if (lupe &gt; 2.0)</span>
<span class="go">         next</span>

<span class="go">     if( (lupe&lt;0.6) &amp;&amp; (lupe &gt; 0.5))</span>
<span class="go">        break</span>

<span class="go">    cat(&quot;The value of lupe is &quot;,lupe,&quot;\n&quot;);</span>
<span class="go"> }</span>
<span class="go">The value of lupe is  1.416993</span>
<span class="go">The value of lupe is  -0.01571884</span>
</pre></div>
</div>
</div>
<div class="section" id="switch-statement">
<h4><a class="toc-backref" href="#id10">15.1.7. switch statement</a></h4>
<p id="index-17">The <em>switch</em> takes an expression and returns a value in a list based
on the value of the expression. How it does this depends on the data
type of the expression. The basic syntax is <em>switch(statement,item1,item2,item3,...,itemN)</em>.</p>
<p>If the result of the expression is a number then it returns the item
in the list with the same index. Note that the expression is cast as
an integer if it is not an integer.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="kp">as.integer</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>x
<span class="go">[1] 2</span>
<span class="gp">&gt; </span>z <span class="o">=</span> <span class="kr">switch</span><span class="p">(</span>x<span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>z
<span class="go">[1] 2</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="m">3.5</span>
<span class="gp">&gt; </span>z <span class="o">=</span> <span class="kr">switch</span><span class="p">(</span>x<span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>z
<span class="go">[1] 3</span>
</pre></div>
</div>
<p>If the result of the expression is a string, then the list of items
should be in the form <em>&#8220;valueN&#8221;=resultN</em>, and the statement will
return the result that matches the value.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>y <span class="o">&lt;-</span> rnorm<span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>y
<span class="go">[1]  0.4218635 -0.8205637 -1.0191267 -0.6080061 -0.6079133</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="s">&quot;sd&quot;</span>
<span class="gp">&gt; </span>z <span class="o">&lt;-</span> <span class="kr">switch</span><span class="p">(</span>x<span class="p">,</span><span class="s">&quot;mean&quot;</span><span class="o">=</span><span class="kp">mean</span><span class="p">(</span>y<span class="p">),</span><span class="s">&quot;median&quot;</span><span class="o">=</span>median<span class="p">(</span>y<span class="p">),</span><span class="s">&quot;variance&quot;</span><span class="o">=</span>var<span class="p">(</span>y<span class="p">),</span><span class="s">&quot;sd&quot;</span><span class="o">=</span>sd<span class="p">(</span>y<span class="p">))</span>
<span class="gp">&gt; </span>z
<span class="go">[1] 0.5571847</span>
<span class="gp">&gt; </span>x <span class="o">&lt;-</span> <span class="s">&quot;median&quot;</span>
<span class="gp">&gt; </span>z <span class="o">&lt;-</span> <span class="kr">switch</span><span class="p">(</span>x<span class="p">,</span><span class="s">&quot;mean&quot;</span><span class="o">=</span><span class="kp">mean</span><span class="p">(</span>y<span class="p">),</span><span class="s">&quot;median&quot;</span><span class="o">=</span>median<span class="p">(</span>y<span class="p">),</span><span class="s">&quot;variance&quot;</span><span class="o">=</span>var<span class="p">(</span>y<span class="p">),</span><span class="s">&quot;sd&quot;</span><span class="o">=</span>sd<span class="p">(</span>y<span class="p">))</span>
<span class="gp">&gt; </span>z
<span class="go">[1] -0.6080061</span>
</pre></div>
</div>
</div>
<div class="section" id="scan-statement">
<h4><a class="toc-backref" href="#id11">15.1.8. scan statement</a></h4>
<p>The command to read input from the keyboard is the <em>scan</em>
statement. It has a wide variety of options and can be fine tuned to
your specific needs. We only look at the basics here. The <em>scan</em>
statement waits for input from a user, and it returns the value that
was typed in.</p>
<p>When using the command with no set number of lines the command will
continue to read keyboard input until a blank line is entered.</p>
<span class="target" id="index-18"></span><div class="highlight-rconsole" id="index-19"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span><span class="kp">scan</span><span class="p">)</span>
<span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kp">scan</span><span class="p">(</span>what<span class="o">=</span><span class="kt">double</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
<span class="go">1: 3.5</span>
<span class="go">2:</span>
<span class="go">Read 1 item</span>
<span class="gp">&gt; </span>a
<span class="go">[1] 3.5</span>
<span class="gp">&gt; </span><span class="kp">typeof</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] &quot;double&quot;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>a <span class="o">&lt;-</span> <span class="kp">scan</span><span class="p">(</span>what<span class="o">=</span><span class="kt">double</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
<span class="go">1: yo!</span>
<span class="go">1:</span>
<span class="go">Error in scan(file, what, nmax, sep, dec, quote, skip, nlines, na.strings,  :</span>
<span class="go">scan() expected &#39;a real&#39;, got &#39;yo!&#39;</span>
</pre></div>
</div>
<p>If you wish to only have it read from a fixed number of lines the
<em>nmax</em> option can specify how many lines can be typed in, and the
<em>multi.line</em> option can be used to turn off multi-line entry.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span>  <span class="kp">scan</span><span class="p">(</span>what<span class="o">=</span><span class="kt">double</span><span class="p">(</span><span class="m">0</span><span class="p">),</span>nmax<span class="o">=</span><span class="m">1</span><span class="p">,</span>multi.line <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="go">1: 6.7</span>
<span class="go">Read 1 item</span>
<span class="gp">&gt; </span>a
<span class="go">[1] 6.7</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="functions">
<h3><a class="toc-backref" href="#id3">15.2. Functions</a></h3>
<p id="index-20">A shallow overview of defining functions is given here. A few
subtleties will be noted, but R can be a little quirky with respect to
defining functions. The first bit of oddness is that you can think of
a function as an object where you define the function and assign it to
a variable name.</p>
<p>To define a function you assign it to a name, and the keyword
<em>function</em> is used to denote the start of the function and its
argument list.</p>
<div class="highlight-rconsole" id="index-21"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>newDef <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">)</span>
<span class="go"> {</span>
<span class="go">     x = runif(10,a,b)</span>
<span class="go">     mean(x)</span>
<span class="go"> }</span>
<span class="gp">&gt; </span>newDef<span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
<span class="go">[1] 0.06177728</span>
<span class="gp">&gt; </span>newDef
<span class="go">function(a,b)</span>
<span class="go">{</span>
<span class="go">   x = runif(10,a,b)</span>
<span class="go">   mean(x)</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The last expression in the function is what is returned. So in the
example above the sample mean of the numbers is returned.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> newDef<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
<span class="gp">&gt; </span>x
<span class="go">[1] 0.4800442</span>
</pre></div>
</div>
<p>The arguments that are passed are matched in order. They can be
specified explicitly, though.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>newDef<span class="p">(</span>b<span class="o">=</span><span class="m">10</span><span class="p">,</span>a<span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="go">[1] 4.747509</span>
<span class="gp">&gt; </span>newDef<span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
<span class="go">[1] NaN</span>
<span class="go">Warning message:</span>
<span class="go">In runif(10, a, b) : NAs produced</span>
</pre></div>
</div>
<p>You can mix this approach, and R will try to match up the named
arguments and then match the rest going from left to right. Another
bit of weirdness is that R will not evaluate an expression in the
argument list until the moment it is needed in the function. This is a
different kind of behavior than what most people are used to, so be
very careful about this. The best rule of thumb is to not put in
operations in an argument list if they matter after the function is
called.</p>
<p>Another common task is to have a function return multiple items. This
can be accomplished by returning a <em>list</em> of items. The objects within
a list can be accessed using the same <em>$</em> notation that is used for
data frames.</p>
<div class="highlight-rconsole" id="index-22"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kt">c</span> <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>sample <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>a<span class="p">,</span>b<span class="p">)</span>
<span class="go">{</span>
<span class="go">  value = switch(a,&quot;median&quot;=median(b),&quot;mean&quot;=mean(b),&quot;variance&quot;=var(b))</span>
<span class="go">  largeVals = length(c[c&gt;1])</span>
<span class="go">  list(stat=value,number=largeVals)</span>
<span class="go">}</span>
<span class="gp">&gt; </span>result <span class="o">&lt;-</span> <span class="kp">sample</span><span class="p">(</span><span class="s">&quot;median&quot;</span><span class="p">,</span><span class="kt">c</span><span class="p">)</span>
<span class="gp">&gt; </span>result
<span class="go">$stat</span>
<span class="go">[1] 3</span>

<span class="go">$number</span>
<span class="go">[1] 4</span>

<span class="gp">&gt; </span>result<span class="o">$</span>stat
<span class="go">[1] 3</span>
<span class="gp">&gt; </span>result<span class="o">$</span>number
<span class="go">[1] 4</span>
</pre></div>
</div>
<p>There is another potential problem that can occur when using a
function in R. When it comes to determining the value of a variable
there is a path that R will use to search for its value. In the case
of functions if a previously undefined variable appears R will look at
the argument list for the function. Next it will look in the current
work space. If you are not careful R will find the value some place
where you do not expect it, and your function will return a value that
is not correct, and no error will be given. <strong>Be very careful about the
names of variables especially when using functions.</strong></p>


<h2></h2>
<h2>Object Oriented Programming</h2>
<p>There are at least three different approaches to object oriented programming in R. We examine two of them, the S3 and S4 classes. The other approach makes use of a package, and we focus instead on the two built in classes.</p>

<div class="toctree-wrapper compound">
<h2></h2>
<h2>1. S3 Classes</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#the-basic-idea" id="id4">The Basic Idea</a></li>
<li><a href="#memory-management" id="id5">Memory Management</a></li>
<li><a href="#creating-an-s3-class" id="id6">Creating an S3 Class</a><ul>
<li><a href="#straight-forward-approach" id="id7">Straight Forward Approach</a></li>
<li><a href="#local-environment-approach" id="id8">Local Environment Approach</a></li>
</ul>
</li>
<li><a href="#creating-methods" id="id9">Creating  Methods</a><ul>
<li><a href="#id1" id="id10">Straight Forward Approach</a></li>
<li><a href="#s3classesmethodslocal" id="id11">Local Environment Approach</a></li>
</ul>
</li>
<li><a href="#inheritance" id="id12">Inheritance</a></li>
</ul>
</div>
<span class="target" id="index-0"></span><p id="index-1">We examine how to create S3 classes. It is assumed that you are familiar with the basic data types and scripting (<a class="reference internal" href="scripting.html#scripting"><span>Introduction to Programming</span></a>).</p>
<div class="section" id="the-basic-idea">
<span id="s3classesbasicidea"></span><h3><a class="toc-backref" href="#id4">1.1. The Basic Idea</a></h3>
<span class="target" id="index-2"></span><p id="index-3">First, everything in R is treated like as an object. We have seen this with functions. Many of the objects that are created within an R session have attributes associated with them. One common attribute associated with an object is its <strong>class</strong>.</p>
<p>You can set the <strong>class</strong> attribute using the <em>class</em> command. One thing to notice is that the class is a vector which allows an object to inherit from multiple classes, and it allows you to specify the order of inheritance for complex classes. You can also use the <em>class</em> command to determine the classes associated with an object.</p>
<div class="highlight-rconsole" id="index-4"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
<span class="gp">&gt; </span>bubba
<span class="go">[1] 1 2 3</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span><span class="kp">class</span><span class="p">(</span>bubba<span class="p">)</span>
<span class="go">[1] &quot;numeric&quot;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span><span class="kp">class</span><span class="p">(</span>bubba<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>bubba<span class="p">),</span><span class="s">&quot;Flamboyancy&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">class</span><span class="p">(</span>bubba<span class="p">)</span>
<span class="go">[1] &quot;numeric&quot;     &quot;Flamboyancy&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A new command, <em>append</em>, is used here. The first argument is a vector, and the function adds the following arguments to the end of  the vector.</p>
</div>
<p id="index-5">One way to define a method for a class is to use the <em>UseMethod</em> command to define a hierarchy of functions that will react appropriately. The <em>UseMethod</em> command will tell R to look for a function whose prefix matches the current function, and it searches for a suffix in order from the vector of class names.  In other words a set of functions can be defined, and the function that is actually called will be determined by the class name of the first object in the list of arguments.</p>
<p>You first have to define a generic function to reserve the function name. The <em>UseMethod</em> command is then used to tell the R system to search for a different function. The search is based on the name of the function and the names of an object&#8217;s classes. The name of the functions have two parts separated by a &#8221;.&#8221; where the prefix is the function name and the suffix is the name of a class.</p>
<p>That is a lot of verbiage ç½å¦ to describe a relatively simple idea. A very basic example is given below:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>first<span class="o">=</span><span class="s">&quot;one&quot;</span><span class="p">,</span> second<span class="o">=</span><span class="s">&quot;two&quot;</span><span class="p">,</span> third<span class="o">=</span><span class="s">&quot;third&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">class</span><span class="p">(</span>bubba<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>bubba<span class="p">),</span><span class="s">&quot;Flamboyancy&quot;</span><span class="p">)</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>bubba
<span class="go">$first</span>
<span class="go">[1] &quot;one&quot;</span>

<span class="go">$second</span>
<span class="go">[1] &quot;two&quot;</span>

<span class="go">$third</span>
<span class="go">[1] &quot;third&quot;</span>

<span class="go">attr(,&quot;class&quot;)</span>
<span class="go">[1] &quot;list&quot;        &quot;Flamboyancy&quot;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>GetFirst <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span>
<span class="gp">+ </span><span class="p">{</span>
<span class="gp">+ </span>    <span class="kp">UseMethod</span><span class="p">(</span><span class="s">&quot;GetFirst&quot;</span><span class="p">,</span>x<span class="p">)</span>
<span class="gp">+ </span><span class="p">}</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>GetFirst.Flamboyancy <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span>
<span class="gp">+ </span><span class="p">{</span>
<span class="gp">+ </span>   <span class="kr">return</span><span class="p">(</span>x<span class="o">$</span>first<span class="p">)</span>
<span class="gp">+ </span><span class="p">}</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>GetFirst<span class="p">(</span>bubba<span class="p">)</span>
<span class="go">[1] &quot;one&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="memory-management">
<h3><a class="toc-backref" href="#id5">1.2. Memory Management</a></h3>
<span class="target" id="index-6"></span><span class="target" id="index-7"></span><p id="index-8">The plethora of object oriented approaches leads to a natural
question. Which one should you use? With respect to S3 and S4 classes,
the S3 class is more flexible, and the S4 class is a more structured
approach. This is a nice way of saying that the S3 class approach is
for unaware slobs and is a sloppy way to shoot yourself in the foot,
while the S4 class is for uptight pedants.</p>
<p>Our focus here is on S3 classes. Before we delve into the details of
S3 classes we need to talk about memory environments. These can be
used to great effect in S3 classes to make your codes totally
incomprehensible. On the down side they help give S3 classes their
flexibility.</p>
<p>An environment can be thought of as a local scope. It has a set of
variables associated with it. You can access those variables if you
have the &#8220;ID&#8217;&#8217; associated with the environment. There are a number of
commands you can use to manipulate and obtain the pointers to your
environments. You can also use the <em>assign</em> and <em>get</em> commands to set
and get the values of variables within an environment.</p>
<p>The <em>environment</em> command can be used to get the pointer to the
current environment.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">ls</span><span class="p">()</span>
<span class="go">character(0)</span>
<span class="gp">&gt; </span>e <span class="o">&lt;-</span> <span class="kp">environment</span><span class="p">()</span>
<span class="gp">&gt; </span>e
<span class="go">&lt;environment: R_GlobalEnv&gt;</span>
<span class="gp">&gt; </span><span class="kp">assign</span><span class="p">(</span><span class="s">&quot;bubba&quot;</span><span class="p">,</span><span class="m">3</span><span class="p">,</span>e<span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">ls</span><span class="p">()</span>
<span class="go">[1] &quot;bubba&quot; &quot;e&quot;</span>
<span class="gp">&gt; </span>bubba
<span class="go">[1] 3</span>
<span class="gp">&gt; </span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;bubba&quot;</span><span class="p">,</span>e<span class="p">)</span>
<span class="go">[1] 3</span>
</pre></div>
</div>
<p>Environments can be created and embedded within other environments and
can be structured to form a hierarchy. There are a number of commands
to help you move through different environments. You can find more
details using the command <em>help(environment)</em>, but we do not pursue
more details because this is as much as we need for our purposes of
using S3 classes.</p>
</div>
<div class="section" id="creating-an-s3-class">
<h3><a class="toc-backref" href="#id6">1.3. Creating an S3 Class</a></h3>
<p>The basic ideas associated with S3 classes is discussed in the first
section (<a class="reference internal" href="#s3classesbasicidea"><span>The Basic Idea</span></a>). We now expand on that idea and
demonstrate how to define a function that will create and return an
object of a given class. The basic idea is that a list is created with
the relevant members, the list&#8217;s class is set, and a copy of the list
is returned.</p>
<p>Here we examine two different ways to construct an S3 class. The first
approach is more commonly used and is more straightforward. It makes
use of basic list properties. The second approach makes use of the
local environment within a function to define the variables tracked by
the class. The advantage to the second approach is that it looks more
like the object oriented approach that many are familiar with. The
disadvantage is that it is more difficult to read the code, and it is
more like working with pointers which is different from the way other
objects work in R.</p>
<div class="section" id="straight-forward-approach">
<h4><a class="toc-backref" href="#id7">1.3.1. Straight Forward Approach</a></h4>
<p>The first approach is the more standard approach most often seen with
S3 classes. It makes use of the methods defined outside of the class
which is described below, <a class="reference internal" href="#s3classesmethods"><span>Creating  Methods</span></a>. It also keeps track
of the data maintained by the class using the standard practices
associated with lists.</p>
<p>The basic idea is that a function is defined which creates a list. The
data entries tracked by the class are defined in the list. In the
example below the defaults are specified in the argument list with
default values assigned. A new class name is appended to the list&#8217;s
classes, and the list is returned.</p>
<div class="highlight-r" id="s3classesdefinitionsimple"><div class="highlight"><pre><span></span>NorthAmerican <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;cereal&quot;</span><span class="p">)</span>
<span class="p">{</span>

        me <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
                hasBreakfast <span class="o">=</span> eatsBreakfast<span class="p">,</span>
                favoriteBreakfast <span class="o">=</span> myFavorite
       <span class="p">)</span>

        <span class="c1">## Set the name for the class</span>
        <span class="kp">class</span><span class="p">(</span>me<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>me<span class="p">),</span><span class="s">&quot;NorthAmerican&quot;</span><span class="p">)</span>
        <span class="kr">return</span><span class="p">(</span>me<span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once this definition is executed a new function is defined, called
NorthAmerican. A new object of this class can be created by calling
the function.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> NorthAmerican<span class="p">()</span>
<span class="gp">&gt; </span>bubba
<span class="go">$hasBreakfast</span>
<span class="go">[1] TRUE</span>

<span class="go">$favoriteBreakfast</span>
<span class="go">[1] &quot;cereal&quot;</span>

<span class="go">attr(,&quot;class&quot;)</span>
<span class="go">[1] &quot;list&quot;          &quot;NorthAmerican&quot;</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>hasBreakfast
<span class="go">[1] TRUE</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>louise <span class="o">&lt;-</span> NorthAmerican<span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;fried eggs&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>louise
<span class="go">$hasBreakfast</span>
<span class="go">[1] TRUE</span>

<span class="go">$favoriteBreakfast</span>
<span class="go">[1] &quot;fried eggs&quot;</span>

<span class="go">attr(,&quot;class&quot;)</span>
<span class="go">[1] &quot;list&quot;          &quot;NorthAmerican&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="local-environment-approach">
<h4><a class="toc-backref" href="#id8">1.3.2. Local Environment Approach</a></h4>
<p>Another approach can be employed that makes use of the local
environment within a function to access the variables. When we define
methods with this approach later, <a class="reference internal" href="#s3classesmethodslocal"><span>Local Environment Approach</span></a>, the
results will look more like object oriented approaches seen in other
languages.</p>
<p>The approach relies on the local scope created when a function is
called. A new environment is created that can be identified using the
<em>environment</em> command. The environment can be saved in the list
created for the class, and the variables within this scope can then be
accessed using the identification of the environment.</p>
<p>In the example below this approach appears to require more
overhead. When we examine how to add external methods to the class the
advantage will be a little clearer.</p>
<div class="highlight-r" id="s3classesdefinitionenvironment"><div class="highlight"><pre><span></span>NordAmericain <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;cereal&quot;</span><span class="p">)</span>
<span class="p">{</span>

      <span class="c1">## Get the environment for this</span>
      <span class="c1">## instance of the function.</span>
      thisEnv <span class="o">&lt;-</span> <span class="kp">environment</span><span class="p">()</span>

      hasBreakfast <span class="o">&lt;-</span> eatsBreakfast
      favoriteBreakfast <span class="o">&lt;-</span> myFavorite

      <span class="c1">## Create the list used to represent an</span>
      <span class="c1">## object for this class</span>
      me <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>

        <span class="c1">## Define the environment where this list is defined so</span>
        <span class="c1">## that I can refer to it later.</span>
        thisEnv <span class="o">=</span> thisEnv<span class="p">,</span>

        <span class="c1">## The Methods for this class normally go here but are discussed</span>
        <span class="c1">## below. A simple placeholder is here to give you a teaser....</span>
        getEnv <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
        <span class="p">{</span>
              <span class="kr">return</span><span class="p">(</span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;thisEnv&quot;</span><span class="p">,</span>thisEnv<span class="p">))</span>
        <span class="p">}</span>

        <span class="p">)</span>

      <span class="c1">## Define the value of the list within the current environment.</span>
      <span class="kp">assign</span><span class="p">(</span><span class="s">&#39;this&#39;</span><span class="p">,</span>me<span class="p">,</span>envir<span class="o">=</span>thisEnv<span class="p">)</span>

      <span class="c1">## Set the name for the class</span>
      <span class="kp">class</span><span class="p">(</span>me<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>me<span class="p">),</span><span class="s">&quot;NordAmericain&quot;</span><span class="p">)</span>
      <span class="kr">return</span><span class="p">(</span>me<span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now that the class is defined, the environment used for a given object
can be easily retrieved.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> NordAmericain<span class="p">()</span>
<span class="gp">&gt; </span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;hasBreakfast&quot;</span><span class="p">,</span>bubba<span class="o">$</span>getEnv<span class="p">())</span>
<span class="go">[1] TRUE</span>
<span class="gp">&gt; </span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;favoriteBreakfast&quot;</span><span class="p">,</span>bubba<span class="o">$</span>getEnv<span class="p">())</span>
<span class="go">[1] &quot;cereal&quot;</span>
</pre></div>
</div>
<p>Note that there is an unfortunate side effect to this approach. By
keeping track of the environment, it is similar to using a pointer to
the variables rather than the variables themselves. This means when
you make a copy, you are making a copy of the pointer to the
environment.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> NordAmericain<span class="p">(</span>myFavorite<span class="o">=</span><span class="s">&quot;oatmeal&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;favoriteBreakfast&quot;</span><span class="p">,</span>bubba<span class="o">$</span>getEnv<span class="p">())</span>
<span class="go">[1] &quot;oatmeal&quot;</span>
<span class="gp">&gt; </span>louise <span class="o">&lt;-</span> bubba
<span class="gp">&gt; </span><span class="kp">assign</span><span class="p">(</span><span class="s">&quot;favoriteBreakfast&quot;</span><span class="p">,</span><span class="s">&quot;toast&quot;</span><span class="p">,</span>louise<span class="o">$</span>getEnv<span class="p">())</span>
<span class="gp">&gt; </span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;favoriteBreakfast&quot;</span><span class="p">,</span>louise<span class="o">$</span>getEnv<span class="p">())</span>
<span class="go">[1] &quot;toast&quot;</span>
<span class="gp">&gt; </span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;favoriteBreakfast&quot;</span><span class="p">,</span>bubba<span class="o">$</span>getEnv<span class="p">())</span>
<span class="go">[1] &quot;toast&quot;</span>
</pre></div>
</div>
<p>This issue will be explored again in the subsection below detailing
how to create methods for an S3 class. If you wish to be able to copy
an object using this approach you need to create a new method to
return a proper copy.</p>
</div>
</div>
<div class="section" id="creating-methods">
<span id="s3classesmethods"></span><h3><a class="toc-backref" href="#id9">1.4. Creating  Methods</a></h3>
<p>We now explore how to create methods associated with a class. Again we
break it up into two parts. The first approach is used for <strong>both</strong>
approaches discussed in the previous section. If you make use of the
local environment approach discussed above you will likely make use of
both approaches discussed in this section. If you only make use of the
more straight forward approach you only need to be aware of the first
approach discussed here.</p>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id10">1.4.1. Straight Forward Approach</a></h4>
<p id="index-9">The first approach is to define a function that exists outside of the
class. The function is defined in a generic way, and then a function
specific to a given class is defined. The R environment then decides
which function to use based on the class names of an argument to the
function, and the suffix used in the names of the associated
functions.</p>
<p>One thing to keep in mind is that for assignment R makes copies of
objects. The implication is that if you change a part of an object you
need to return an exact copy of the object. Otherwise your changes may
be lost.</p>
<p>In the examples below we define accessors for the variables in the
class defined above. We assume that the class <em>NorthAmerican</em> is
defined in the same way as the first example above,
<a class="reference internal" href="#s3classesdefinitionsimple"><span>Straightforward Class</span></a>. In the first
example the goal is that we want to create a function that will set
the value of <em>hasBreakfast</em> for a given object. The name of the
function will be <em>setHasBreakfast</em>.</p>
<p>The first step is to reserve the name of the function, and use the
<em>UseMethod</em> command to tell R to search for the correct function. If
we pass an object whose class includes the name <em>NorthAmerican</em> then
the correct function to call should be called
<em>setHasBreakfast.NorthAmerican</em>. Note that we will also create a
function called <em>setHasBreakfast.default</em>. This function will be
called if R cannot find another function of the correct class.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span>setHasBreakfast <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">,</span> newValue<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Calling the base setHasBreakfast function&quot;</span><span class="p">)</span>
                <span class="kp">UseMethod</span><span class="p">(</span><span class="s">&quot;setHasBreakfast&quot;</span><span class="p">,</span>elObjeto<span class="p">)</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Note this is not executed!&quot;</span><span class="p">)</span>
        <span class="p">}</span>

setHasBreakfast.default <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">,</span> newValue<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;You screwed up. I do not know how to handle this object.&quot;</span><span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">}</span>


setHasBreakfast.NorthAmerican <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">,</span> newValue<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;In setHasBreakfast.NorthAmerican and setting the value&quot;</span><span class="p">)</span>
                elObjeto<span class="o">$</span>hasBreakfast <span class="o">&lt;-</span> newValue
                <span class="kr">return</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>The first thing to note is that the function returns a copy of the
object passed to it. R passes copies of objects to functions. If you
change an object within a function it does not change the original
object. You must pass back a copy of the updated object.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> NorthAmerican<span class="p">()</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>hasBreakfast
<span class="go">[1] TRUE</span>
<span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> setHasBreakfast<span class="p">(</span>bubba<span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="go">[1] &quot;Calling the base setHasBreakfast function&quot;</span>
<span class="go">[1] &quot;In setHasBreakfast.NorthAmerican and setting the value&quot;</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>hasBreakfast
<span class="go">[1] FALSE</span>
<span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> setHasBreakfast<span class="p">(</span>bubba<span class="p">,</span><span class="s">&quot;No type checking sucker!&quot;</span><span class="p">)</span>
<span class="go">[1] &quot;Calling the base setHasBreakfast function&quot;</span>
<span class="go">[1] &quot;In setHasBreakfast.NorthAmerican and setting the value&quot;</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>hasBreakfast
<span class="go">[1] &quot;No type checking sucker!&quot;</span>
</pre></div>
</div>
<p>If the correct function cannot be found then the default version of
the function is called.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>someNumbers <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">4</span>
<span class="gp">&gt; </span>someNumbers
<span class="go">[1] 1 2 3 4</span>
<span class="gp">&gt; </span>someNumbers <span class="o">&lt;-</span> setHasBreakfast<span class="p">(</span>someNumbers<span class="p">,</span><span class="s">&quot;what?&quot;</span><span class="p">)</span>
<span class="go">[1] &quot;Calling the base setHasBreakfast function&quot;</span>
<span class="go">[1] &quot;You screwed up. I do not know how to handle this object.&quot;</span>
<span class="gp">&gt; </span>someNumbers
<span class="go">[1] 1 2 3 4</span>
</pre></div>
</div>
<p>It is a good practice to only use predefined accessors to get and set
values held by an object. As a matter of completeness we define
methods to get the value of the <em>hasBreakfast</em> field.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span>getHasBreakfast <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Calling the base getHasBreakfast function&quot;</span><span class="p">)</span>
                <span class="kp">UseMethod</span><span class="p">(</span><span class="s">&quot;getHasBreakfast&quot;</span><span class="p">,</span>elObjeto<span class="p">)</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Note this is not executed!&quot;</span><span class="p">)</span>
        <span class="p">}</span>

getHasBreakfast.default <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;You screwed up. I do not know how to handle this object.&quot;</span><span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span>
        <span class="p">}</span>


getHasBreakfast.NorthAmerican <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;In getHasBreakfast.NorthAmerican and returning the value&quot;</span><span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span>elObjeto<span class="o">$</span>hasBreakfast<span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>The functions to get the values are used in the same way.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> NorthAmerican<span class="p">()</span>
<span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> setHasBreakfast<span class="p">(</span>bubba<span class="p">,</span><span class="s">&quot;No type checking sucker!&quot;</span><span class="p">)</span>
<span class="go">[1] &quot;Calling the base setHasBreakfast function&quot;</span>
<span class="go">[1] &quot;In setHasBreakfast.NorthAmerican and setting the value&quot;</span>
<span class="gp">&gt; </span>result <span class="o">&lt;-</span> getHasBreakfast<span class="p">(</span>bubba<span class="p">)</span>
<span class="go">[1] &quot;Calling the base getHasBreakfast function&quot;</span>
<span class="go">[1] &quot;In getHasBreakfast.NorthAmerican and returning the value&quot;</span>
<span class="gp">&gt; </span>result
<span class="go">[1] &quot;No type checking sucker!&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="s3classesmethodslocal">
<span id="id2"></span>
<h4><a class="toc-backref" href="#id11">1.4.2. Local Environment Approach</a></h4>
<p>If the second method for defining an S3 class is used as seen above,
<a class="reference internal" href="#s3classesdefinitionenvironment"><span>Local Environment Class</span></a>, then
the approach for defining a method can include an additional way to
define a method. In this approach functions can be defined within the
list that defines the object.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span>NordAmericain <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;cereal&quot;</span><span class="p">)</span>
<span class="p">{</span>

      <span class="c1">## Get the environment for this</span>
      <span class="c1">## instance of the function.</span>
      thisEnv <span class="o">&lt;-</span> <span class="kp">environment</span><span class="p">()</span>

      hasBreakfast <span class="o">&lt;-</span> eatsBreakfast
      favoriteBreakfast <span class="o">&lt;-</span> myFavorite

      <span class="c1">## Create the list used to represent an</span>
      <span class="c1">## object for this class</span>
      me <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>

              <span class="c1">## Define the environment where this list is defined so</span>
              <span class="c1">## that I can refer to it later.</span>
              thisEnv <span class="o">=</span> thisEnv<span class="p">,</span>

              <span class="c1">## Define the accessors for the data fields.</span>
              getEnv <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
              <span class="p">{</span>
                      <span class="kr">return</span><span class="p">(</span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;thisEnv&quot;</span><span class="p">,</span>thisEnv<span class="p">))</span>
              <span class="p">},</span>

              getHasBreakfast <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
              <span class="p">{</span>
                      <span class="kr">return</span><span class="p">(</span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;hasBreakfast&quot;</span><span class="p">,</span>thisEnv<span class="p">))</span>
              <span class="p">},</span>

              setHasBreakfast <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>value<span class="p">)</span>
              <span class="p">{</span>
                      <span class="kr">return</span><span class="p">(</span><span class="kp">assign</span><span class="p">(</span><span class="s">&quot;hasBreakfast&quot;</span><span class="p">,</span>value<span class="p">,</span>thisEnv<span class="p">))</span>
              <span class="p">},</span>


              getFavoriteBreakfast <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
              <span class="p">{</span>
                      <span class="kr">return</span><span class="p">(</span><span class="kp">get</span><span class="p">(</span><span class="s">&quot;favoriteBreakfast&quot;</span><span class="p">,</span>thisEnv<span class="p">))</span>
              <span class="p">},</span>

              setFavoriteBreakfast <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>value<span class="p">)</span>
              <span class="p">{</span>
                      <span class="kr">return</span><span class="p">(</span><span class="kp">assign</span><span class="p">(</span><span class="s">&quot;favoriteBreakfast&quot;</span><span class="p">,</span>value<span class="p">,</span>thisEnv<span class="p">))</span>
              <span class="p">}</span>

        <span class="p">)</span>

      <span class="c1">## Define the value of the list within the current environment.</span>
      <span class="kp">assign</span><span class="p">(</span><span class="s">&#39;this&#39;</span><span class="p">,</span>me<span class="p">,</span>envir<span class="o">=</span>thisEnv<span class="p">)</span>

      <span class="c1">## Set the name for the class</span>
      <span class="kp">class</span><span class="p">(</span>me<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>me<span class="p">),</span><span class="s">&quot;NordAmericain&quot;</span><span class="p">)</span>
      <span class="kr">return</span><span class="p">(</span>me<span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With this definition the methods can be called in a more direct
manner.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> NordAmericain<span class="p">(</span>myFavorite<span class="o">=</span><span class="s">&quot;oatmeal&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>getFavoriteBreakfast<span class="p">()</span>
<span class="go">[1] &quot;oatmeal&quot;</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>setFavoriteBreakfast<span class="p">(</span><span class="s">&quot;plain toast&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>getFavoriteBreakfast<span class="p">()</span>
<span class="go">[1] &quot;plain toast&quot;</span>
</pre></div>
</div>
<p>As noted above, <a class="reference internal" href="#s3classesdefinitionenvironment"><span>Local Environment Class</span></a>, this approach can be problematic
when making a copy of an object. If you need to make copies of your
objects a function must be defined to explicitly make a copy.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span>makeCopy <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Calling the base makeCopy function&quot;</span><span class="p">)</span>
                <span class="kp">UseMethod</span><span class="p">(</span><span class="s">&quot;makeCopy&quot;</span><span class="p">,</span>elObjeto<span class="p">)</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Note this is not executed!&quot;</span><span class="p">)</span>
        <span class="p">}</span>

makeCopy.default <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;You screwed up. I do not know how to handle this object.&quot;</span><span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">}</span>


makeCopy.NordAmericain <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>elObjeto<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;In makeCopy.NordAmericain and making a copy&quot;</span><span class="p">)</span>
                newObject <span class="o">&lt;-</span> NordAmericain<span class="p">(</span>
                        eatsBreakfast<span class="o">=</span>elObjeto<span class="o">$</span>getHasBreakfast<span class="p">(),</span>
                        myFavorite<span class="o">=</span>elObjeto<span class="o">$</span>getFavoriteBreakfast<span class="p">())</span>
                <span class="kr">return</span><span class="p">(</span>newObject<span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>With this definition we can now make a proper copy of the object and
get the expected results.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>bubba <span class="o">&lt;-</span> NordAmericain<span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;oatmeal&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>louise <span class="o">&lt;-</span> makeCopy<span class="p">(</span>bubba<span class="p">)</span>
<span class="go">[1] &quot;Calling the base makeCopy function&quot;</span>
<span class="go">[1] &quot;In makeCopy.NordAmericain and making a copy&quot;</span>
<span class="gp">&gt; </span>louise<span class="o">$</span>getFavoriteBreakfast<span class="p">()</span>
<span class="go">[1] &quot;oatmeal&quot;</span>
<span class="gp">&gt; </span>louise<span class="o">$</span>setFavoriteBreakfast<span class="p">(</span><span class="s">&quot;eggs&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>louise<span class="o">$</span>getFavoriteBreakfast<span class="p">()</span>
<span class="go">[1] &quot;eggs&quot;</span>
<span class="gp">&gt; </span>bubba<span class="o">$</span>getFavoriteBreakfast<span class="p">()</span>
<span class="go">[1] &quot;oatmeal&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="inheritance">
<h3><a class="toc-backref" href="#id12">1.5. Inheritance</a></h3>
<span class="target" id="index-10"></span><p id="index-11">Inheritance is part of what makes it worthwhile to go to the effort of
making up a proper class. The basic idea is that another class can be
constructed that makes use of all the data and methods of a base class
and builds on them by adding additional data and methods.</p>
<p>The basic idea is that an object&#8217;s class is a vector that contains an
ordered list of classes that an object is a member of. When a new
object is created it can add its class name to that list.  The methods
associated with the class can use the <em>NextMethod</em> command to search
for the function associated with the next class in the list.</p>
<p>In the examples below we build on the example of the
<a class="reference internal" href="#s3classesdefinitionsimple"><span>NorthAmerican class</span></a> defined
above. The examples below assume that the NorthAmerican class given
above is defined, and the class hierarchy is shown in
<a class="reference internal" href="#s3-class-diagram"><span>Figure 1.</span></a>.</p>
<div class="align-center figure" id="id3">
<span id="s3-class-diagram"></span><img alt="Diagram of the NorthAmerican derived classes." src="http://www.cyclismo.org/tutorial/R/_images/s3Classes.png" />
<p class="caption"><span class="caption-text">Figure 1.</span></p>
<div class="legend">
Diagram of the NorthAmerican derived classes.</div>
</div>
<p>A file with the full script is available at
<a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/s3Inheritance.R">s3Inheritance.R</a> .
We do not provide the full code set here in order to keep the
discussion somewhat under control. Our first step is to define the new
classes.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span>Mexican <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;los huevos&quot;</span><span class="p">)</span>
<span class="p">{</span>

        me <span class="o">&lt;-</span> NorthAmerican<span class="p">(</span>eatsBreakfast<span class="p">,</span>myFavorite<span class="p">)</span>

        <span class="c1">## Add the name for the class</span>
        <span class="kp">class</span><span class="p">(</span>me<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>me<span class="p">),</span><span class="s">&quot;Mexican&quot;</span><span class="p">)</span>
        <span class="kr">return</span><span class="p">(</span>me<span class="p">)</span>
<span class="p">}</span>


USAsian <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;pork belly&quot;</span><span class="p">)</span>
<span class="p">{</span>

        me <span class="o">&lt;-</span> NorthAmerican<span class="p">(</span>eatsBreakfast<span class="p">,</span>myFavorite<span class="p">)</span>

        <span class="c1">## Add the name for the class</span>
        <span class="kp">class</span><span class="p">(</span>me<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>me<span class="p">),</span><span class="s">&quot;USAsian&quot;</span><span class="p">)</span>
        <span class="kr">return</span><span class="p">(</span>me<span class="p">)</span>
<span class="p">}</span>

Canadian <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;back bacon&quot;</span><span class="p">)</span>
<span class="p">{</span>

        me <span class="o">&lt;-</span> NorthAmerican<span class="p">(</span>eatsBreakfast<span class="p">,</span>myFavorite<span class="p">)</span>

        <span class="c1">## Add the name for the class</span>
        <span class="kp">class</span><span class="p">(</span>me<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>me<span class="p">),</span><span class="s">&quot;Canadian&quot;</span><span class="p">)</span>
        <span class="kr">return</span><span class="p">(</span>me<span class="p">)</span>
<span class="p">}</span>

Anglophone <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;pancakes&quot;</span><span class="p">)</span>
<span class="p">{</span>

        me <span class="o">&lt;-</span> Canadian<span class="p">(</span>eatsBreakfast<span class="p">,</span>myFavorite<span class="p">)</span>

        <span class="c1">## Add the name for the class</span>
        <span class="kp">class</span><span class="p">(</span>me<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>me<span class="p">),</span><span class="s">&quot;Anglophone&quot;</span><span class="p">)</span>
        <span class="kr">return</span><span class="p">(</span>me<span class="p">)</span>
<span class="p">}</span>

Francophone <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>eatsBreakfast<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>myFavorite<span class="o">=</span><span class="s">&quot;crepes&quot;</span><span class="p">)</span>
<span class="p">{</span>

        me <span class="o">&lt;-</span> Canadian<span class="p">(</span>eatsBreakfast<span class="p">,</span>myFavorite<span class="p">)</span>

        <span class="c1">## Add the name for the class</span>
        <span class="kp">class</span><span class="p">(</span>me<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span><span class="kp">class</span><span class="p">(</span>me<span class="p">),</span><span class="s">&quot;Francophone&quot;</span><span class="p">)</span>
        <span class="kr">return</span><span class="p">(</span>me<span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With these definitions we can define an object. In this case we create
an object from the Francophone class.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>francois <span class="o">&lt;-</span> Francophone<span class="p">()</span>
<span class="gp">&gt; </span>francois
<span class="go">$hasBreakfast</span>
<span class="go">[1] TRUE</span>

<span class="go">$favoriteBreakfast</span>
<span class="go">[1] &quot;crepes&quot;</span>

<span class="go">attr(,&quot;class&quot;)</span>
<span class="go">[1] &quot;list&quot;          &quot;NorthAmerican&quot; &quot;Canadian&quot;      &quot;Francophone&quot;</span>
</pre></div>
</div>
<p>The thing to notice is that the class vector demonstrates the class
inheritance structure. We can now define a method, <em>makeBreakfast</em>
which will make use of the class structure.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span>makeBreakfast <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Calling the base makeBreakfast function&quot;</span><span class="p">)</span>
                <span class="kp">UseMethod</span><span class="p">(</span><span class="s">&quot;makeBreakfast&quot;</span><span class="p">,</span>theObject<span class="p">)</span>
        <span class="p">}</span>

makeBreakfast.default <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="kp">noquote</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Well, this is awkward. Just make&quot;</span><span class="p">,</span>
                                  getFavoriteBreakfast<span class="p">(</span>theObject<span class="p">))))</span>
                <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">}</span>

makeBreakfast.Mexican <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="kp">noquote</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Estoy cocinando&quot;</span><span class="p">,</span>
                                       getFavoriteBreakfast<span class="p">(</span>theObject<span class="p">))))</span>
                <span class="kp">NextMethod</span><span class="p">(</span><span class="s">&quot;makeBreakfast&quot;</span><span class="p">,</span>theObject<span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">}</span>

makeBreakfast.USAsian <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="kp">noquote</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Leave me alone I am making&quot;</span><span class="p">,</span>
                                               getFavoriteBreakfast<span class="p">(</span>theObject<span class="p">))))</span>
                <span class="kp">NextMethod</span><span class="p">(</span><span class="s">&quot;makeBreakfast&quot;</span><span class="p">,</span>theObject<span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">}</span>

makeBreakfast.Canadian <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="kp">noquote</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Good morning, how would you like&quot;</span><span class="p">,</span>
                                       getFavoriteBreakfast<span class="p">(</span>theObject<span class="p">))))</span>
                <span class="kp">NextMethod</span><span class="p">(</span><span class="s">&quot;makeBreakfast&quot;</span><span class="p">,</span>theObject<span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">}</span>

makeBreakfast.Anglophone <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="kp">noquote</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;I hope it is okay that I am making&quot;</span><span class="p">,</span>
                                       getFavoriteBreakfast<span class="p">(</span>theObject<span class="p">))))</span>
                <span class="kp">NextMethod</span><span class="p">(</span><span class="s">&quot;makeBreakfast&quot;</span><span class="p">,</span>theObject<span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">}</span>

makeBreakfast.Francophone <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">{</span>
                <span class="kp">print</span><span class="p">(</span><span class="kp">noquote</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Je cuisine&quot;</span><span class="p">,</span>
                                       getFavoriteBreakfast<span class="p">(</span>theObject<span class="p">))))</span>
                <span class="kp">NextMethod</span><span class="p">(</span><span class="s">&quot;makeBreakfast&quot;</span><span class="p">,</span>theObject<span class="p">)</span>
                <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Note that the functions call the <em>NextMethod</em> function to call the
next function in the list of classes.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>francois <span class="o">&lt;-</span> makeBreakfast<span class="p">(</span>francois<span class="p">)</span>
<span class="go">[1] &quot;Calling the base makeBreakfast function&quot;</span>
<span class="go">[1] Good morning, how would you like crepes</span>
<span class="go">[1] Je cuisine crepes</span>
<span class="go">[1] Well, this is awkward. Just make crepes</span>
</pre></div>
</div>
<p>It is important to note the order that the methods are called. They
are called from left to right in the list of classes. Another thing to
note is that when the methods run out of class names the default
function is called.</p>


<h2></h2>
<h2>2. S4 Classes</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#the-basic-idea" id="id3">The Basic Idea</a></li>
<li><a href="#creating-an-s4-class" id="id4">Creating an S4 Class</a></li>
<li><a href="#creating-methods" id="id5">Creating Methods</a></li>
<li><a href="#inheritance" id="id6">Inheritance</a></li>
</ul>
</div>
<span class="target" id="index-0"></span><p id="index-1">We examine how to create S4 classes. It is assumed that you are
familiar with the basic data types and scripting (<a class="reference internal" href="scripting.html#scripting"><span>Introduction to Programming</span></a>).</p>
<div class="section" id="the-basic-idea">
<h3><a class="toc-backref" href="#id3">2.1. The Basic Idea</a></h3>
<span class="target" id="index-2"></span><p id="index-3">The S4 approach differs from the S3 approach to creating a class in
that it is a more rigid definition. The idea is that an object is
created using the <em>setClass</em> command. The command takes a number of
options. Many of the options are not required, but we make use of
several of the optional arguments because they represent good
practices with respect to object oriented programming.</p>
<p>We first construct a trivial, contrived class simply to demonstrate
the basic idea. Next we demonstrate how to create a method for an S4
class. This example is a little more involved than what we saw in the
section on <a class="reference internal" href="s3Classes.html#s3classesbasicidea"><span>S3 classes</span></a>.</p>
<p>In this example, the name of the class is <em>FirstQuadrant</em>, and the
class is used to keep track of an <em>(x,y)</em> coordinate pair in the first
quadrant. There is a restriction that both values must be greater than
or equal to zero. There are two data elements, called <em>slots</em>, and
they are called <em>x</em> and <em>y</em>. The default values for the coordinate is
the origin, <em>x=0</em> and <em>y=0</em>.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span><span class="c1">######################################################################</span>
<span class="c1"># Create the first quadrant class</span>
<span class="c1">#</span>
<span class="c1"># This is used to represent a coordinate in the first quadrant.</span>
FirstQuadrant <span class="o">&lt;-</span> setClass<span class="p">(</span>
        <span class="c1"># Set the name for the class</span>
        <span class="s">&quot;FirstQuadrant&quot;</span><span class="p">,</span>

        <span class="c1"># Define the slots</span>
        slots <span class="o">=</span> <span class="kt">c</span><span class="p">(</span>
                x <span class="o">=</span> <span class="s">&quot;numeric&quot;</span><span class="p">,</span>
                y <span class="o">=</span> <span class="s">&quot;numeric&quot;</span>
                <span class="p">),</span>

        <span class="c1"># Set the default values for the slots. (optional)</span>
        prototype<span class="o">=</span><span class="kt">list</span><span class="p">(</span>
                x <span class="o">=</span> <span class="m">0.0</span><span class="p">,</span>
                y <span class="o">=</span> <span class="m">0.0</span>
                <span class="p">),</span>

        <span class="c1"># Make a function that can test to see if the data is consistent.</span>
        <span class="c1"># This is not called if you have an initialize function defined!</span>
        validity<span class="o">=</span><span class="kr">function</span><span class="p">(</span>object<span class="p">)</span>
        <span class="p">{</span>
                <span class="kr">if</span><span class="p">((</span>object<span class="o">@</span>x <span class="o">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span>object<span class="o">@</span>y <span class="o">&lt;</span> <span class="m">0</span><span class="p">))</span> <span class="p">{</span>
                        <span class="kr">return</span><span class="p">(</span><span class="s">&quot;A negative number for one of the coordinates was given.&quot;</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="kr">return</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>Note that the way to access one of the data elements is to use the &#8220;&#64;&#8221;
symbol. An example if given below. In the example three elements
of the class defined above are created. The first uses the default
values for the slots, the second overrides the defaults, and finally
an attempt is made to create a coordinate in the second quadrant.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>x <span class="o">&lt;-</span> FirstQuadrant<span class="p">()</span>
<span class="gp">&gt; </span>x
<span class="go">An object of class &quot;FirstQuadrant&quot;</span>
<span class="go">Slot &quot;x&quot;:</span>
<span class="go">[1] 0</span>

<span class="go">Slot &quot;y&quot;:</span>
<span class="go">[1] 0</span>

<span class="gp">&gt; </span>y <span class="o">&lt;-</span> FirstQuadrant<span class="p">(</span>x<span class="o">=</span><span class="m">5</span><span class="p">,</span>y<span class="o">=</span><span class="m">7</span><span class="p">)</span>
<span class="gp">&gt; </span>y
<span class="go">An object of class &quot;FirstQuadrant&quot;</span>
<span class="go">Slot &quot;x&quot;:</span>
<span class="go">[1] 5</span>

<span class="go">Slot &quot;y&quot;:</span>
<span class="go">[1] 7</span>

<span class="gp">&gt; </span>y<span class="o">@</span>x
<span class="go">[1] 5</span>
<span class="gp">&gt; </span>y<span class="o">@</span>y
<span class="go">[1] 7</span>
<span class="gp">&gt; </span>z <span class="o">&lt;-</span> FirstQuadrant<span class="p">(</span>x<span class="o">=</span><span class="m">3</span><span class="p">,</span>y<span class="o">=</span><span class="m">-2</span><span class="p">)</span>
<span class="go">Error in validObject(.Object) :</span>
<span class="go">      invalid class âFirstQuadrantâ object: A negative number for one of the coordinates was given.</span>
<span class="gp">&gt; </span>z
<span class="go">Error: object &#39;z&#39; not found</span>
</pre></div>
</div>
<p>In the next example we create a method that is associated with the
class. The method is used to set the values of a coordinate. The first
step is to reserve the name using the <em>setGeneric</em> command, and then
the <em>setMethod</em> command is used to define the function to be called
when the first argument is an object from the <em>FirstQuadrant</em> class.</p>
<span class="target" id="index-4"></span><div class="highlight-r" id="index-5"><div class="highlight"><pre><span></span><span class="c1"># create a method to assign the value of a coordinate</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;setCoordinate&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>xVal<span class="p">,</span>yVal<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;setCoordinate&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;setCoordinate&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;FirstQuadrant&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>xVal<span class="p">,</span>yVal<span class="p">)</span>
                      <span class="p">{</span>
                              theObject<span class="o">@</span>x <span class="o">&lt;-</span> xVal
                              theObject<span class="o">@</span>y <span class="o">&lt;-</span> yVal
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>
</pre></div>
</div>
<p>It is important to note that R generally passes objects as values. For
this reason the methods defined above return the updated object. When
the method is called, it is used to replace the former object with the
updated object.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>z <span class="o">&lt;-</span> FirstQuadrant<span class="p">(</span>x<span class="o">=</span><span class="m">2.5</span><span class="p">,</span>y<span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="gp">&gt; </span>z
<span class="go">An object of class &quot;FirstQuadrant&quot;</span>
<span class="go">Slot &quot;x&quot;:</span>
<span class="go">[1] 2.5</span>

<span class="go">Slot &quot;y&quot;:</span>
<span class="go">[1] 10</span>

<span class="gp">&gt; </span>z <span class="o">&lt;-</span> setCoordinate<span class="p">(</span>z<span class="p">,</span><span class="m">-3.0</span><span class="p">,</span><span class="m">-5.0</span><span class="p">)</span>
<span class="gp">&gt; </span>z
<span class="go">An object of class &quot;FirstQuadrant&quot;</span>
<span class="go">Slot &quot;x&quot;:</span>
<span class="go">[1] -3</span>

<span class="go">Slot &quot;y&quot;:</span>
<span class="go">[1] -5</span>

</pre></div>
</div>
<p id="index-6">Note that the <em>validity</em> function given in the original class
definition is not called. It is called when an object is first
defined. It can be called later, but only when an explicit request is
made using the <em>validObject</em> command.</p>
</div>
<div class="section" id="creating-an-s4-class">
<h3><a class="toc-backref" href="#id4">2.2. Creating an S4 Class</a></h3>
<span class="target" id="index-7"></span><span class="target" id="index-8"></span><span class="target" id="index-9"></span><span class="target" id="index-10"></span><span class="target" id="index-11"></span><span class="target" id="index-12"></span><span class="target" id="index-13"></span><p id="index-14">An S4 class is created using the <em>setClass()</em> command. At a minimum
the name of the class is specified and the names of the data elements
(slots) is specified. There are a number of other options, and just as
a matter of good practice we also specify a function to verify that
the data is consistent (validation), and we specify the default
values (the prototype). In the last section of this page,
<a class="reference internal" href="#s4inheritance"><span>S4 inheritance</span></a>, we include an additional
parameter used to specify a class hierarchy.</p>
<p>In this section we look at another example, and we examine some of the
functions associated with S4 classes. The example we define will be
used to motivate the use of methods associated with a class, and it
will be used to demonstrate inheritance later. The idea is that we
want to create a program to simulate a cellular automata model of a
predator-prey system.</p>
<p>We do not develop the whole code here but concentrate on the data
structures. In particular we will create a base class for the
agents. In the next section we will create the basic methods for the
class. In the inheritance section we will discuss how to build on the
class to create different predators and different prey species. The
basic structure of the class is shown in <a class="reference internal" href="#s4-agent-class-diagram"><span>Figure 1.</span></a></p>
<div class="align-center figure" id="id1">
<span id="s4-agent-class-diagram"></span><img alt="Diagram of the base Agent class" src="http://www.cyclismo.org/tutorial/R/_images/s4AgentClass.png" />
<p class="caption"><span class="caption-text">Figure 1.</span></p>
<div class="legend">
Diagram of the base class, Agent, used for the agents in a simulation.</div>
</div>
<p>The methods for this class are defined in the following section. Here
we define the class and its slots, and the code to define the class is
given below:</p>
<div class="highlight-r"><div class="highlight"><pre><span></span><span class="c1">######################################################################</span>
<span class="c1"># Create the base Agent class</span>
<span class="c1">#</span>
<span class="c1"># This is used to represent the most basic agent in a simulation.</span>
Agent <span class="o">&lt;-</span> setClass<span class="p">(</span>
        <span class="c1"># Set the name for the class</span>
        <span class="s">&quot;Agent&quot;</span><span class="p">,</span>

        <span class="c1"># Define the slots</span>
        slots <span class="o">=</span> <span class="kt">c</span><span class="p">(</span>
                location <span class="o">=</span> <span class="s">&quot;numeric&quot;</span><span class="p">,</span>
                velocity   <span class="o">=</span> <span class="s">&quot;numeric&quot;</span><span class="p">,</span>
                active   <span class="o">=</span> <span class="s">&quot;logical&quot;</span>
                <span class="p">),</span>

        <span class="c1"># Set the default values for the slots. (optional)</span>
        prototype<span class="o">=</span><span class="kt">list</span><span class="p">(</span>
                location <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span><span class="m">0.0</span><span class="p">),</span>
                active   <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
                velocity <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span><span class="m">0.0</span><span class="p">)</span>
                <span class="p">),</span>

        <span class="c1"># Make a function that can test to see if the data is consistent.</span>
        <span class="c1"># This is not called if you have an initialize function defined!</span>
        validity<span class="o">=</span><span class="kr">function</span><span class="p">(</span>object<span class="p">)</span>
        <span class="p">{</span>
                <span class="kr">if</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>object<span class="o">@</span>velocity<span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">&gt;</span><span class="m">100.0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kr">return</span><span class="p">(</span><span class="s">&quot;The velocity level is out of bounds.&quot;</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="kr">return</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>Now that the code to define the class is given we can create an object
whose class is Agent.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> Agent<span class="p">()</span>
<span class="gp">&gt; </span>a
<span class="go">An object of class &quot;Agent&quot;</span>
<span class="go">Slot &quot;location&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;velocity&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;active&quot;:</span>
<span class="go">[1] TRUE</span>

</pre></div>
</div>
<p>Before we define the methods for the class a number of additional
commands are explored. The first set of functions explored are the
<em>is.object</em> and the <em>isS4</em> commands. The <em>is.object</em> command
determines whether or not a variable refers to an object. The <em>isS4</em>
command determines whether or not the variable is an S4 object. The
reason both are required is that the <em>isS4</em> command alone cannot
determine if a variable is an S3 object. You need to determine if the
variable is an object and then decide if it is S4 or not.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">is.object</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] TRUE</span>
<span class="gp">&gt; </span><span class="kp">isS4</span><span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] TRUE</span>
</pre></div>
</div>
<p>The next set of commands are used to get information about the data
elements, or slots, within an object. The first is the <em>slotNames</em>
command. This command can take either an object or the name of a
class. It returns the names of the slots associated with the class as
strings.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>slotNames<span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] &quot;location&quot; &quot;velocity&quot; &quot;active&quot;</span>
<span class="gp">&gt; </span>slotNames<span class="p">(</span><span class="s">&quot;Agent&quot;</span><span class="p">)</span>
<span class="go">[1] &quot;location&quot; &quot;velocity&quot; &quot;active&quot;</span>
</pre></div>
</div>
<p>The <em>getSlots</em> command is similar to the <em>slotNames</em> command. It takes
the name of a class as a string. It returns a vector whose entries
are the types associated with the slots, and the names of the entries
are the names of the slots.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>getSlots<span class="p">(</span><span class="s">&quot;Agent&quot;</span><span class="p">)</span>
<span class="go">     location  velocity    active</span>
<span class="go">&quot;numeric&quot; &quot;numeric&quot; &quot;logical&quot;</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> getSlots<span class="p">(</span><span class="s">&quot;Agent&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>s<span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="go">     location</span>
<span class="go">&quot;numeric&quot;</span>
<span class="gp">&gt; </span>s<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="go">[1] &quot;numeric&quot;</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>s<span class="p">)</span>
<span class="go">[1] &quot;location&quot; &quot;velocity&quot; &quot;active&quot;</span>
</pre></div>
</div>
<p>The next command examined is the <em>getClass</em> command. It has two
forms. If you give it a variable that is an S4 class it returns a list
of slots for the class associated with the variable. If you give it a
character string with the name of a class it gives the slots and their
data types.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>getClass<span class="p">(</span>a<span class="p">)</span>
<span class="go">An object of class &quot;Agent&quot;</span>
<span class="go">Slot &quot;location&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;velocity&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;active&quot;:</span>
<span class="go">[1] TRUE</span>

<span class="gp">&gt; </span>getClass<span class="p">(</span><span class="s">&quot;Agent&quot;</span><span class="p">)</span>
<span class="go">Class &quot;Agent&quot; [in &quot;.GlobalEnv&quot;]</span>

<span class="go">Slots:</span>

<span class="go">Name:  location velocity   active</span>
<span class="go">Class:  numeric  numeric  logical</span>
</pre></div>
</div>
<p>The final command examined is the <em>slot</em> command. It can be used to
get or set the value of a slot in an object. It can be used in place
of the &#8220;&#64;&#8221; operator.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>slot<span class="p">(</span>a<span class="p">,</span><span class="s">&quot;location&quot;</span><span class="p">)</span>
<span class="go">[1] 0 0</span>
<span class="gp">&gt; </span>slot<span class="p">(</span>a<span class="p">,</span><span class="s">&quot;location&quot;</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
<span class="gp">&gt; </span>a
<span class="go">An object of class &quot;Agent&quot;</span>
<span class="go">Slot &quot;location&quot;:</span>
<span class="go">[1] 1 5</span>

<span class="go">Slot &quot;velocity&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;active&quot;:</span>
<span class="go">[1] TRUE</span>

</pre></div>
</div>
</div>
<div class="section" id="creating-methods">
<h3><a class="toc-backref" href="#id5">2.3. Creating Methods</a></h3>
<span class="target" id="index-15"></span><span class="target" id="index-16"></span><span class="target" id="index-17"></span><span class="target" id="index-18"></span><span class="target" id="index-19"></span><p id="index-20">We now build on the Agent class defined above. Once the class and its
data elements are defined we can define the methods associated with
the class. The basic idea is that if the name of a function has not
been defined, the name must first be reserved using the <em>setGeneric</em>
function. The <em>setMethod</em> can then be used to define which function is
called based on the class names of the objects sent to it.</p>
<p>We define the methods associated with the Agent method given in the
previous section. Note that the <em>validity</em> function for an object is
only called when it is first created and when an explicit call to the
<em>validObject</em> function is made. We make use of the <em>validObject</em>
command in the methods below that are used to change the value of a
data element within an object.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span><span class="c1"># create a method to assign the value of the location</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;setLocation&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>position<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;setLocation&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;setLocation&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>position<span class="p">)</span>
                      <span class="p">{</span>
                              theObject<span class="o">@</span>location <span class="o">&lt;-</span> position
                              validObject<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>

<span class="c1"># create a method to get the value of the location</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;getLocation&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;getLocation&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;getLocation&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">{</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="o">@</span>location<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>


<span class="c1"># create a method to assign the value of active</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;setActive&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>active<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;setActive&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;setActive&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>active<span class="p">)</span>
                      <span class="p">{</span>
                              theObject<span class="o">@</span>active <span class="o">&lt;-</span> active
                              validObject<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>

<span class="c1"># create a method to get the value of active</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;getActive&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;getActive&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;getActive&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">{</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="o">@</span>active<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>


<span class="c1"># create a method to assign the value of velocity</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;setVelocity&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>velocity<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;setVelocity&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;setVelocity&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>velocity<span class="p">)</span>
                      <span class="p">{</span>
                              theObject<span class="o">@</span>velocity <span class="o">&lt;-</span> velocity
                              validObject<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>

<span class="c1"># create a method to get the value of the velocity</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;getVelocity&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;getVelocity&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;getVelocity&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">{</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="o">@</span>velocity<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>
</pre></div>
</div>
<p>With these definitions the data elements are encapsulated and can be
accessed and set using the methods given above. It is generally good
practice in object oriented programming to keep your data private and
not show them to everybody willy nilly.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> Agent<span class="p">()</span>
<span class="gp">&gt; </span>getVelocity<span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 0 0</span>
<span class="gp">&gt; </span>a <span class="o">&lt;-</span> setVelocity<span class="p">(</span>a<span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="m">1.0</span><span class="p">,</span><span class="m">2.0</span><span class="p">))</span>
<span class="gp">&gt; </span>getVelocity<span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 1 2</span>
</pre></div>
</div>
<p>The last topic examined is the idea of overloading functions. In the
examples above the signature is set to a single element. The signature
is a vector of characters and specifies the data types of the argument
list for the method to be defined. Here we create two new methods. The
name of the method is <em>resetActivity</em>, and there are two versions.</p>
<p>The first version accepts two arguments whose types are <em>Agent</em> and
<em>logical</em>. This version of the method will set the activity slot to a
given value. The second version accepts two arguments whose types are
<em>Agent</em> and <em>numeric</em>. This version will set the activity to TRUE and
then set the energy level to the value passed to it. Note that the
names of the variables in the argument list must be exactly the same.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span><span class="c1"># create a method to reset the velocity and the activity</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;resetActivity&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>value<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;resetActivity&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;resetActivity&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span><span class="s">&quot;logical&quot;</span><span class="p">),</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>value<span class="p">)</span>
                      <span class="p">{</span>
                              theObject <span class="o">&lt;-</span> setActive<span class="p">(</span>theObject<span class="p">,</span>value<span class="p">)</span>
                              theObject <span class="o">&lt;-</span> setVelocity<span class="p">(</span>theObject<span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span><span class="m">0.0</span><span class="p">))</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;resetActivity&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span><span class="s">&quot;numeric&quot;</span><span class="p">),</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">,</span>value<span class="p">)</span>
                      <span class="p">{</span>
                              theObject <span class="o">&lt;-</span> setActive<span class="p">(</span>theObject<span class="p">,</span><span class="kc">TRUE</span><span class="p">)</span>
                              theObject <span class="o">&lt;-</span> setVelocity<span class="p">(</span>theObject<span class="p">,</span>value<span class="p">)</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>
</pre></div>
</div>
<p>This definition of the function yields two options for the
<em>resetActivity</em> function. The decision to determine which function to
call depends on two arguments and their type. For example, if the
first argument is from the Agent class and the second is a value of
TRUE or FALSE, then the first version of the function is
called. Otherwise, if the second argument is a number the second
version of the function is called.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>a <span class="o">&lt;-</span> Agent<span class="p">()</span>
<span class="gp">&gt; </span>a
<span class="go">An object of class &quot;Agent&quot;</span>
<span class="go">Slot &quot;location&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;velocity&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;active&quot;:</span>
<span class="go">[1] TRUE</span>

<span class="gp">&gt; </span>a <span class="o">&lt;-</span> resetActivity<span class="p">(</span>a<span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="gp">&gt; </span>getActive<span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] FALSE</span>
<span class="gp">&gt; </span> a <span class="o">&lt;-</span> resetActivity<span class="p">(</span>a<span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
<span class="gp">&gt; </span>getVelocity<span class="p">(</span>a<span class="p">)</span>
<span class="go">[1] 1 3</span>
</pre></div>
</div>
</div>
<div class="section" id="inheritance">
<span id="s4inheritance"></span><h3><a class="toc-backref" href="#id6">2.4. Inheritance</a></h3>
<span class="target" id="index-21"></span><p id="index-22">A class&#8217; inheritance hiearchy can be specified when the class is
defined using the <em>contains</em> option. The <em>contains</em> option is a vector
that lists the classes the new class inherits from. In the following
example we build on the Agent class defined in the previous
section. The idea is that we need agents that represent a predator and
two prey. We will focus on two predators for this example.</p>
<p>The hierarchy for the classes is shown in
<a class="reference internal" href="#s4-pred-prey-class-diagram"><span>Figure 2.</span></a>.  In this example we have one Prey
class that is derived from the Agent class. There are two predator
classes, Bobcat and Lynx. The Bobcat class is derived from the Agent
class, and the Lynx class is derived from the Bobcat class. We will
keep this very simple, and the only methods associated with the new
classes is a <em>move</em> method. For our purposes it will only print out a
message and set the values of the position and velocity to demonstrate
the order of execution of the methods associated with the classes.</p>
<div class="align-center figure" id="id2">
<span id="s4-pred-prey-class-diagram"></span><img alt="Diagram of the predator and prey classes derived from the Agent class." src="http://www.cyclismo.org/tutorial/R/_images/s4AgentPredPrey.png" />
<p class="caption"><span class="caption-text">Figure 2.</span></p>
<div class="legend">
Diagram of the predator and prey classes derived from the Agent class.</div>
</div>
<p>The first step is to create the three new classes.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span><span class="c1">######################################################################</span>
<span class="c1"># Create the Prey class</span>
<span class="c1">#</span>
<span class="c1"># This is used to represent a prey animal</span>
Prey <span class="o">&lt;-</span> setClass<span class="p">(</span>
        <span class="c1"># Set the name for the class</span>
        <span class="s">&quot;Prey&quot;</span><span class="p">,</span>

        <span class="c1"># Define the slots - in this case it is empty...</span>
        slots <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="m">0</span><span class="p">),</span>

        <span class="c1"># Set the default values for the slots. (optional)</span>
        prototype<span class="o">=</span><span class="kt">list</span><span class="p">(),</span>

        <span class="c1"># Make a function that can test to see if the data is consistent.</span>
        <span class="c1"># This is not called if you have an initialize function defined!</span>
        validity<span class="o">=</span><span class="kr">function</span><span class="p">(</span>object<span class="p">)</span>
        <span class="p">{</span>
                <span class="kr">if</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>object<span class="o">@</span>velocity<span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">&gt;</span><span class="m">70.0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kr">return</span><span class="p">(</span><span class="s">&quot;The velocity level is out of bounds.&quot;</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="kr">return</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span>
        <span class="p">},</span>

        <span class="c1"># Set the inheritance for this class</span>
        contains <span class="o">=</span> <span class="s">&quot;Agent&quot;</span>
        <span class="p">)</span>



<span class="c1">######################################################################</span>
<span class="c1"># Create the Bobcat class</span>
<span class="c1">#</span>
<span class="c1"># This is used to represent a smaller predator</span>
Bobcat <span class="o">&lt;-</span> setClass<span class="p">(</span>
        <span class="c1"># Set the name for the class</span>
        <span class="s">&quot;Bobcat&quot;</span><span class="p">,</span>

        <span class="c1"># Define the slots - in this case it is empty...</span>
        slots <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="m">0</span><span class="p">),</span>

        <span class="c1"># Set the default values for the slots. (optional)</span>
        prototype<span class="o">=</span><span class="kt">list</span><span class="p">(),</span>

        <span class="c1"># Make a function that can test to see if the data is consistent.</span>
        <span class="c1"># This is not called if you have an initialize function defined!</span>
        validity<span class="o">=</span><span class="kr">function</span><span class="p">(</span>object<span class="p">)</span>
        <span class="p">{</span>
                <span class="kr">if</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>object<span class="o">@</span>velocity<span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">&gt;</span><span class="m">85.0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kr">return</span><span class="p">(</span><span class="s">&quot;The velocity level is out of bounds.&quot;</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="kr">return</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span>
        <span class="p">},</span>

        <span class="c1"># Set the inheritance for this class</span>
        contains <span class="o">=</span> <span class="s">&quot;Agent&quot;</span>
        <span class="p">)</span>

<span class="c1">######################################################################</span>
<span class="c1"># Create the Lynx class</span>
<span class="c1">#</span>
<span class="c1"># This is used to represent a larger predator</span>
Lynx <span class="o">&lt;-</span> setClass<span class="p">(</span>
        <span class="c1"># Set the name for the class</span>
        <span class="s">&quot;Lynx&quot;</span><span class="p">,</span>

        <span class="c1"># Define the slots - in this case it is empty...</span>
        slots <span class="o">=</span> <span class="kt">character</span><span class="p">(</span><span class="m">0</span><span class="p">),</span>

        <span class="c1"># Set the default values for the slots. (optional)</span>
        prototype<span class="o">=</span><span class="kt">list</span><span class="p">(),</span>

        <span class="c1"># Make a function that can test to see if the data is consistent.</span>
        <span class="c1"># This is not called if you have an initialize function defined!</span>
        validity<span class="o">=</span><span class="kr">function</span><span class="p">(</span>object<span class="p">)</span>
        <span class="p">{</span>
                <span class="kr">if</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>object<span class="o">@</span>velocity<span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">&gt;</span><span class="m">95.0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kr">return</span><span class="p">(</span><span class="s">&quot;The velocity level is out of bounds.&quot;</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="kr">return</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span>
        <span class="p">},</span>

        <span class="c1"># Set the inheritance for this class</span>
        contains <span class="o">=</span> <span class="s">&quot;Bobcat&quot;</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>The inheritance is specified using the <em>contains</em> option in the
<em>setClass</em> command. Note that this can be a vector allowing for
multiple inheritance. We choose not to use that to keep things
simpler. If you are feeling like you need more self-loathing in your
life you should try it out and experiment.</p>
<p>Next we define a method, <em>move</em>, for the new classes. We will include
methods for the Agent, Prey, Bobcat, and Lynx classes. The methods do
not really do anything but are used to demonstrate the idea of how
methods are executed.</p>
<div class="highlight-r"><div class="highlight"><pre><span></span><span class="c1"># create a method to move the agent.</span>
setGeneric<span class="p">(</span>name<span class="o">=</span><span class="s">&quot;move&quot;</span><span class="p">,</span>
                       def<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                       <span class="p">{</span>
                               <span class="kp">standardGeneric</span><span class="p">(</span><span class="s">&quot;move&quot;</span><span class="p">)</span>
                       <span class="p">}</span>
                       <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;move&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Agent&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">{</span>
                              <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Move this Agent dude&quot;</span><span class="p">)</span>
                              theObject <span class="o">&lt;-</span> setVelocity<span class="p">(</span>theObject<span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
                              validObject<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;move&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Prey&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">{</span>
                              <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Check this Prey before moving this dude&quot;</span><span class="p">)</span>
                              theObject <span class="o">&lt;-</span> callNextMethod<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Move this Prey dude&quot;</span><span class="p">)</span>
                              validObject<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;move&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Bobcat&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">{</span>
                              <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Check this Bobcat before moving this dude&quot;</span><span class="p">)</span>
                              theObject <span class="o">&lt;-</span> setLocation<span class="p">(</span>theObject<span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>
                              theObject <span class="o">&lt;-</span> callNextMethod<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Move this Bobcat dude&quot;</span><span class="p">)</span>
                              validObject<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>

setMethod<span class="p">(</span>f<span class="o">=</span><span class="s">&quot;move&quot;</span><span class="p">,</span>
                      signature<span class="o">=</span><span class="s">&quot;Lynx&quot;</span><span class="p">,</span>
                      definition<span class="o">=</span><span class="kr">function</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">{</span>
                              <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Check this Lynx before moving this dude&quot;</span><span class="p">)</span>
                              theObject <span class="o">&lt;-</span> setActive<span class="p">(</span>theObject<span class="p">,</span><span class="kc">FALSE</span><span class="p">)</span>
                              theObject <span class="o">&lt;-</span> callNextMethod<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kp">print</span><span class="p">(</span><span class="s">&quot;Move this Lynx dude&quot;</span><span class="p">)</span>
                              validObject<span class="p">(</span>theObject<span class="p">)</span>
                              <span class="kr">return</span><span class="p">(</span>theObject<span class="p">)</span>
                      <span class="p">}</span>
                      <span class="p">)</span>
</pre></div>
</div>
<p>There are a number of things to note. First each method calls the
<em>callNextMethod</em> command. This command will execute the next version
of the same method for the previous class in the hierarchy. Note that
I have included the arguments (in the same order) as those called by
the original function. Also note that the function returns a copy of
the object and is used to update the object passed to the original
function.</p>
<p>Another thing to note is that the methods associated with the Lync,
Bobcat, and Agent classes arbitrarily change the values of the
position, velocity, and activity for the given object. This is done to
demonstrate the changes that take place and reinforce the necessity
for using the <em>callNextMethod</em> function the way it is used here.</p>
<p>Finally, it should be noted that the <em>validObject</em> command is called
in every method. You should try adding a print statement in the
validity function. You might find that the order is a bit odd. You
should experiment with this and play with it. There are times you do
not get the expected results so be careful!</p>
<p>We now give a brief example to demonstrate the order that the
functions are called. In the example we create a Bobcat object and
then call the <em>move</em> method. We next create a Lynx object and do the
same. We print out the slots for both agents just to demonstrate the
values that are changed.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>robert <span class="o">&lt;-</span> Bobcat<span class="p">()</span>
<span class="gp">&gt; </span>robert
<span class="go">An object of class &quot;Bobcat&quot;</span>
<span class="go">Slot &quot;location&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;velocity&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;active&quot;:</span>
<span class="go">[1] TRUE</span>

<span class="gp">&gt; </span>robert <span class="o">&lt;-</span> move<span class="p">(</span>robert<span class="p">)</span>
<span class="go">[1] &quot;Check this Bobcat before moving this dude&quot;</span>
<span class="go">[1] &quot;Move this Agent dude&quot;</span>
<span class="go">[1] &quot;Move this Bobcat dude&quot;</span>
<span class="gp">&gt; </span>robert
<span class="go">An object of class &quot;Bobcat&quot;</span>
<span class="go">Slot &quot;location&quot;:</span>
<span class="go">[1] 2 3</span>

<span class="go">Slot &quot;velocity&quot;:</span>
<span class="go">[1] 1 2</span>

<span class="go">Slot &quot;active&quot;:</span>
<span class="go">[1] TRUE</span>

<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt;</span>
<span class="gp">&gt; </span>lionel <span class="o">&lt;-</span> Lynx<span class="p">()</span>
<span class="gp">&gt; </span>lionel
<span class="go">An object of class &quot;Lynx&quot;</span>
<span class="go">Slot &quot;location&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;velocity&quot;:</span>
<span class="go">[1] 0 0</span>

<span class="go">Slot &quot;active&quot;:</span>
<span class="go">[1] TRUE</span>

<span class="gp">&gt; </span>lionel <span class="o">&lt;-</span> move<span class="p">(</span>lionel<span class="p">)</span>
<span class="go">[1] &quot;Check this Lynx before moving this dude&quot;</span>
<span class="go">[1] &quot;Check this Bobcat before moving this dude&quot;</span>
<span class="go">[1] &quot;Move this Agent dude&quot;</span>
<span class="go">[1] &quot;Move this Bobcat dude&quot;</span>
<span class="go">[1] &quot;Move this Lynx dude&quot;</span>
<span class="gp">&gt; </span>lionel
<span class="go">An object of class &quot;Lynx&quot;</span>
<span class="go">Slot &quot;location&quot;:</span>
<span class="go">[1] 2 3</span>

<span class="go">Slot &quot;velocity&quot;:</span>
<span class="go">[1] 1 2</span>

<span class="go">Slot &quot;active&quot;:</span>
<span class="go">[1] FALSE</span>

</pre></div>
</div>


<h2></h2>
<h2>16. Case Study: Working Through a HW Problem</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#problem-statement" id="id7">Problem Statement</a></li>
<li><a href="#transforming-the-data" id="id8">Transforming the Data</a></li>
<li><a href="#the-confidence-interval" id="id9">The Confidence Interval</a></li>
<li><a href="#test-of-significance" id="id10">Test of Significance</a></li>
<li><a href="#the-power-of-the-test" id="id11">The Power of the test</a></li>
</ul>
</div>
<span class="target" id="index-0"></span><p id="index-1">We look at a sample homework problem and the R commands necessary to explore the problem. It is assumed that you are familiar will all of the commands discussed throughout this tutorial.</p>
<div class="section" id="problem-statement">
<h3><a class="toc-backref" href="#id7">16.1. Problem Statement</a></h3>
<p>This problem comes from the 5th edition of Moore and McCabe&#8217;s Introduction to the Practice of Statistics and can be found on pp. 466-467. The data consists of the emissions of three different pollutants from 46 different engines. A copy of the data we use here is available. The problem examined here is different from that given in the book but is motivated by the discussion in the book.</p>
<p>In the following examples we will look at the carbon monoxide data which is one of the columns of this data set. First we will transform the data so that it is close to being normally distributed. We will then find the confidence interval for the mean and then perform a significance test to evaluate whether or not the data is away from a fixed standard. Finally, we will find the power of the test to detect a fixed difference from that standard. We will assume that a confidence level of 95% is used throughout.</p>
</div>
<div class="section" id="transforming-the-data">
<h3><a class="toc-backref" href="#id8">16.2. Transforming the Data</a></h3>
<p>We first begin a basic examination of the data. A copy of the data file can be found at <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table_7_3.csv">table_7_3.csv</a>.The first step is to read in the file and get a summary of the center and spread of the data. In this instance we will focus only on the carbon monoxide data.</p>
<div class="highlight-rconsole" id="index-2"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>engine <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;table_7_3.csv&quot;</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>head<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>engine<span class="p">)</span>
<span class="go">[1] &quot;en&quot;  &quot;hc&quot;  &quot;co&quot;  &quot;nox&quot;</span>
<span class="gp">&gt; </span><span class="kp">summary</span><span class="p">(</span>engine<span class="p">)</span>
<span class="go">       en              hc               co              nox</span>
<span class="go"> Min.   : 1.00   Min.   :0.3400   Min.   : 1.850   Min.   :0.490</span>
<span class="go"> 1st Qu.:12.75   1st Qu.:0.4375   1st Qu.: 4.388   1st Qu.:1.110</span>
<span class="go"> Median :24.50   Median :0.5100   Median : 5.905   Median :1.315</span>
<span class="go"> Mean   :24.00   Mean   :0.5502   Mean   : 7.879   Mean   :1.340</span>
<span class="go"> 3rd Qu.:35.25   3rd Qu.:0.6025   3rd Qu.:10.015   3rd Qu.:1.495</span>
<span class="go"> Max.   :46.00   Max.   :1.1000   Max.   :23.530   Max.   :2.940</span>
</pre></div>
</div>
<p>At first glance the carbon monoxide data appears to be skewed. The spread between the third quartile and the max is five times the spread between the min and the first quartile. A boxplot is show in <a class="reference internal" href="#co-raw-boxlot"><span>Figure 1.</span></a> showing that the data appears to be skewed. This is further confirmed in the histogram which is shown in <a class="reference internal" href="#co-raw-histogram"><span>Figure 2.</span></a> Finally, a normal qq plot is given in <a class="reference internal" href="#co-raw-qqplot"><span>Figure 3.</span></a> The data does not appear to be normal.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>qqnorm<span class="p">(</span>engine<span class="o">$</span>co<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Carbon Monoxide&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>qqline<span class="p">(</span>engine<span class="o">$</span>co<span class="p">)</span>
<span class="gp">&gt; </span>boxplot<span class="p">(</span>engine<span class="o">$</span>co<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Carbon Monoxide&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>engine<span class="o">$</span>co<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Carbon Monoxide&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>qqnorm<span class="p">(</span>engine<span class="o">$</span>co<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Carbon Monoxide&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>qqline<span class="p">(</span>engine<span class="o">$</span>co<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<div class="figure align-left" id="id1">
<span id="co-raw-boxlot"></span><img alt="Boxplot of the  CO data." src="http://www.cyclismo.org/tutorial/R/_images/boxplotCO.jpg" />
<p class="caption"><span class="caption-text">Figure 1.</span></p>
<div class="legend">
Boxplot of the Carbon Monoxide Data.</div>
</div>
<div class="figure align-right" id="id2">
<span id="co-raw-histogram"></span><img alt="Histogram of the CO data." src="http://www.cyclismo.org/tutorial/R/_images/coHist.jpg" />
<p class="caption"><span class="caption-text">Figure 2.</span></p>
<div class="legend">
Histogram of the Carbon Monoxide Data.</div>
</div>
<div class="align-center figure" id="id3">
<span id="co-raw-qqplot"></span><img alt="QQPlot of the CO data" src="http://www.cyclismo.org/tutorial/R/_images/qqplotCO.jpg" />
<p class="caption"><span class="caption-text">Figure 3.</span></p>
<div class="legend">
Normal QQ Plot of the Carbon Monoxide Data.</div>
</div>
<p>We next see if the data can be transformed to something that is closer to being normally distributed. We examine the logarithm of the data. First, the boxplot of the log of the data appears to be more evenly distributed as shown in <a class="reference internal" href="#co-log-boxlot"><span>Figure 4.</span></a> Also, the histogram appears to be centered and closer to normal in <a class="reference internal" href="#co-log-histogram"><span>Figure 5.</span></a> Finally, the normal qq plot is shown in in <a class="reference internal" href="#co-log-qqplot"><span>Figure 6.</span></a> It shows that the data is more consistent with what we would expect from normal data.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>lengine <span class="o">&lt;-</span> <span class="kp">log</span><span class="p">(</span>engine<span class="o">$</span>co<span class="p">)</span>
<span class="gp">&gt; </span>boxplot<span class="p">(</span>lengine<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Carbon Monoxide&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>hist<span class="p">(</span>lengine<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;Carbon Monoxide&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>qqnorm<span class="p">(</span>lengine<span class="p">,</span>main<span class="o">=</span><span class="s">&quot;QQ Plot for the Log of the Carbon Monoxide&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>qqline<span class="p">(</span>lengine<span class="p">)</span>
<span class="gp">&gt;</span>
</pre></div>
</div>
<div class="figure align-left" id="id4">
<span id="co-log-boxlot"></span><img alt="Boxplot of the log of the CO data." src="http://www.cyclismo.org/tutorial/R/_images/boxplotCOLog.jpg" />
<p class="caption"><span class="caption-text">Figure 4.</span></p>
<div class="legend">
Boxplot of the Logarithm of the Carbon Monoxide Data.</div>
</div>
<div class="figure align-right" id="id5">
<span id="co-log-histogram"></span><img alt="Histogram of the logarithm of the Carbon Monoxide Data." src="http://www.cyclismo.org/tutorial/R/_images/coHistLog.jpg" />
<p class="caption"><span class="caption-text">Figure 5.</span></p>
<div class="legend">
Histogram of the Logarithm of the Carbon Monoxide Data.</div>
</div>
<div class="align-center figure" id="id6">
<span id="co-log-qqplot"></span><img alt="QQPlot of the log of the CO data" src="http://www.cyclismo.org/tutorial/R/_images/qqplotCOLog.jpg" />
<p class="caption"><span class="caption-text">Figure 6.</span></p>
<div class="legend">
Normal QQ Plot of the Logarithm of the Carbon Monoxide Data.</div>
</div>
<p>There is strong evidence that the logarithm of the carbon monoxide data more closely resembles a normal distribution then does the raw carbon monoxide data. For that reason all of the analysis that follows will be for the logarithm of the data and will make use of the new list &#8220;lengine.&#8221;</p>
</div>
<div class="section" id="the-confidence-interval">
<h3><a class="toc-backref" href="#id9">16.3. The Confidence Interval</a></h3>
<p id="index-3">We now find the confidence interval for the carbon monoxide data. As stated above, we will work with the logarithm of the data because it appears to be closer to a normal distribution. This data is stored in the list called &#8220;lengine.&#8221; Since we do not know the true standard deviation we will use the sample standard deviation and will use a t-distribution.</p>
<p>We first find the sample mean, the sample standard deviation, and the number of observations:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>m <span class="o">&lt;-</span> <span class="kp">mean</span><span class="p">(</span>lengine<span class="p">)</span>
<span class="gp">&gt; </span>s <span class="o">&lt;-</span> sd<span class="p">(</span>lengine<span class="p">)</span>
<span class="gp">&gt; </span>n <span class="o">&lt;-</span> <span class="kp">length</span><span class="p">(</span>lengine<span class="p">)</span>
<span class="gp">&gt; </span>m
<span class="go">[1] 1.883678</span>
<span class="gp">&gt; </span>s
<span class="go">[1] 0.5983851</span>
<span class="gp">&gt; </span>n
<span class="go">[1] 48</span>
</pre></div>
</div>
<p>Now we find the standard error:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>se <span class="o">&lt;-</span> s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">)</span>
<span class="gp">&gt; </span>se
<span class="go">[1] 0.08636945</span>
</pre></div>
</div>
<p>Finally, the margin of error is found based on a 95% confidence level which can then be used to define the confidence interval:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>error <span class="o">&lt;-</span> se<span class="o">*</span>qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span>error
<span class="go">[1] 0.1737529</span>
<span class="gp">&gt; </span>left <span class="o">&lt;-</span> m<span class="o">-</span>error
<span class="gp">&gt; </span>right <span class="o">&lt;-</span> m <span class="o">+</span> error
<span class="gp">&gt; </span>left
<span class="go">[1] 1.709925</span>
<span class="gp">&gt; </span>right
<span class="go">[1] 2.057431</span>
</pre></div>
</div>
<p>The 95% confidence interval is between 1.71 and 2.06. Keep in mind that this is for the logarithm so the 95% confidence interval for the original data can be found by &#8220;undoing&#8221; the logarithm:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kp">exp</span><span class="p">(</span>left<span class="p">)</span>
<span class="go">[1] 5.528548</span>
<span class="gp">&gt; </span><span class="kp">exp</span><span class="p">(</span>right<span class="p">)</span>
<span class="go">[1] 7.82584</span>
</pre></div>
</div>
<p>So the 95% confidence interval for the carbon monoxide is between 5.53 and 7.83.</p>
</div>
<div class="section" id="test-of-significance">
<h3><a class="toc-backref" href="#id10">16.4. Test of Significance</a></h3>
<p>We now perform a test of significance. Here we suppose that ideally the engines should have a mean level of 5.4 and do a two-sided hypothesis test. Here we assume that the true mean is labeled <span class="math">\(\mu_x\)</span> and state the hypothesis test:</p>
<div class="math">
\[\begin{split}H_o: \mu_x &amp; = &amp; 5.4,\end{split}\]\[\begin{split}H_a: \mu_x &amp; \neq &amp; 5.4,\end{split}\]</div>
<p>To perform the hypothesis test we first assume that the null hypothesis is true and find the confidence interval around the assumed mean. Fortunately, we can use the values from the previous step:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>lNull <span class="o">&lt;-</span> <span class="kp">log</span><span class="p">(</span><span class="m">5.4</span><span class="p">)</span> <span class="o">-</span> error
<span class="gp">&gt; </span>rNull <span class="o">&lt;-</span> <span class="kp">log</span><span class="p">(</span><span class="m">5.4</span><span class="p">)</span> <span class="o">+</span> error
<span class="gp">&gt; </span>lNull
<span class="go">[1] 1.512646</span>
<span class="gp">&gt; </span>rNull
<span class="go">[1] 1.860152</span>
<span class="gp">&gt; </span>m
<span class="go">[1] 1.883678</span>
</pre></div>
</div>
<p>The sample mean lies outside of the assumed confidence interval so we can reject the null hypothesis. There is a low probability that we would have obtained our sample mean if the true mean really were 5.4.</p>
<p>Another way to approach the problem would be to calculate the actual p-value for the sample mean that was found. Since the sample mean is greater than 5.4 it can be found with the following code:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="m">2</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span>pt<span class="p">((</span>m<span class="o">-</span><span class="kp">log</span><span class="p">(</span><span class="m">5.4</span><span class="p">))</span><span class="o">/</span>se<span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">))</span>
<span class="go">[1] 0.02692539</span>
</pre></div>
</div>
<p>Since the p-value is 2.7% which is less than 5% we can reject the null hypothesis.</p>
<p>Note that there is yet another way to do this. The function t.test will do a lot of this work for us.</p>
<div class="highlight-rconsole" id="index-4"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t.test<span class="p">(</span>lengine<span class="p">,</span>mu <span class="o">=</span> <span class="kp">log</span><span class="p">(</span><span class="m">5.4</span><span class="p">),</span>alternative <span class="o">=</span> <span class="s">&quot;two.sided&quot;</span><span class="p">)</span>

<span class="go">        One Sample t-test</span>

<span class="go">data:  lengine</span>
<span class="go">t = 2.2841, df = 47, p-value = 0.02693</span>
<span class="go">alternative hypothesis: true mean is not equal to 1.686399</span>
<span class="go">95 percent confidence interval:</span>
<span class="go"> 1.709925 2.057431</span>
<span class="go">sample estimates:</span>
<span class="go">mean of x</span>
<span class="go"> 1.883678</span>
</pre></div>
</div>
<p>More information and a more complete list of the options for this command can be found using the help command:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>help<span class="p">(</span>t.test<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-power-of-the-test">
<h3><a class="toc-backref" href="#id11">16.5. The Power of the test</a></h3>
<p id="index-5">We now find the power of the test. To find the power we need to set a level for the mean and then find the probability that we would accept the null hypothesis if the mean is really at the prescribed level. Here we will find the power to detect a difference if the level were 7. Three different methods are examined. The first is a method that some books advise to use if you do not have a non-central t-test available. The second does make use of the non-central t-test. Finally, the third method makes use of a customized R command.</p>
<p>We first find the probability of accepting the null hypothesis if the level really were 7. We assume that the true mean is 7 and then find the probability that a sample mean would fall within the confidence interval if the null hypothesis were true. Keep in mind that we have to transform the level of 7 by taking its logarithm. Also keep in mind that this is a two-sided test:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>tLeft <span class="o">&lt;-</span> <span class="p">(</span>lNull<span class="o">-</span><span class="kp">log</span><span class="p">(</span><span class="m">7</span><span class="p">))</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>tRight <span class="o">&lt;-</span> <span class="p">(</span>rNull<span class="o">-</span><span class="kp">log</span><span class="p">(</span><span class="m">7</span><span class="p">))</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>p <span class="o">&lt;-</span> pt<span class="p">(</span>tRight<span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span> <span class="o">-</span> pt<span class="p">(</span>tLeft<span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span>p
<span class="go">[1] 0.1629119</span>
<span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span>p
<span class="go">[1] 0.8370881</span>
</pre></div>
</div>
<p>So the probability of making a type II error is approximately 16.3%, and the probability of detecting a difference if the level really is 7 is approximately 83.7%.</p>
<p>Another way to find the power is to use a non-centrality parameter. This is the method that many books advise over the previous method. The idea is that you give it the critical t-values associated with your test and also provide a parameter that indicates how the mean is shifted.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">)</span>
<span class="gp">&gt; </span>shift <span class="o">&lt;-</span> <span class="p">(</span><span class="kp">log</span><span class="p">(</span><span class="m">5.4</span><span class="p">)</span><span class="o">-</span><span class="kp">log</span><span class="p">(</span><span class="m">7</span><span class="p">))</span><span class="o">/</span><span class="p">(</span>s<span class="o">/</span><span class="kp">sqrt</span><span class="p">(</span>n<span class="p">))</span>
<span class="gp">&gt; </span>pt<span class="p">(</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>shift<span class="p">)</span><span class="o">-</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>shift<span class="p">)</span>
<span class="go">[1] 0.1628579</span>
<span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span><span class="p">(</span>pt<span class="p">(</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>shift<span class="p">)</span><span class="o">-</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>n<span class="m">-1</span><span class="p">,</span>ncp<span class="o">=</span>shift<span class="p">))</span>
<span class="go">[1] 0.8371421</span>
</pre></div>
</div>
<p>Again, we see that the power of the test is approximately 83.7%. Note that this result is slightly off from the previous answer. This approach is often recommended over the previous approach.</p>
<p>The final approach we examine allows us to do all the calculations in one step. It makes use of the non-centrality parameter as in the previous example, but all of the commands are done for us.</p>
<div class="highlight-rconsole" id="index-6"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>power.t.test<span class="p">(</span>n<span class="o">=</span>n<span class="p">,</span>delta<span class="o">=</span><span class="kp">log</span><span class="p">(</span><span class="m">7</span><span class="p">)</span><span class="o">-</span><span class="kp">log</span><span class="p">(</span><span class="m">5.4</span><span class="p">),</span>sd<span class="o">=</span>s<span class="p">,</span>sig.level<span class="o">=</span><span class="m">0.05</span><span class="p">,</span>
<span class="go">              type=&quot;one.sample&quot;,alternative=&quot;two.sided&quot;,strict = TRUE)</span>

<span class="go">     One-sample t test power calculation</span>

<span class="go">              n = 48</span>
<span class="go">          delta = 0.2595112</span>
<span class="go">             sd = 0.5983851</span>
<span class="go">      sig.level = 0.05</span>
<span class="go">          power = 0.8371421</span>
<span class="go">    alternative = two.sided</span>
</pre></div>
</div>
<p>This is a powerful command that can do much more than just calculate the power of a test. For example it can also be used to calculate the number of observations necessary to achieve a given power. For more information check out the help page, help(power.t.test).</p>


<h2></h2>
<h2>17. Case Study II: A JAMA Paper on Cholesterol</h2>
<div>
<p>Contents</p>
<ul class="simple">
<li><a href="#overview-of-the-paper" id="id8">Overview of the Paper</a></li>
<li><a href="#the-tables" id="id9">The Tables</a></li>
<li><a href="#confirming-the-p-values-in-table-3" id="id10">Confirming the p-values in Table 3</a></li>
<li><a href="#confirming-the-p-values-in-table-4" id="id11">Confirming the p-values in Table 4</a></li>
<li><a href="#finding-the-power-of-the-test-in-table-3" id="id12">Finding the Power of the Test in Table 3</a></li>
<li><a href="#differences-by-race-in-table-2" id="id13">Differences by Race in Table 2</a></li>
<li><a href="#summary" id="id14">Summary</a></li>
</ul>
</div>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><p id="index-2">We look at a paper that appeared in the Journal of the American
Medical Association and explore how to use R to confirm the results. It is assumed that you are familiar will all of the commands discussed throughout this tutorial.</p>
<div class="section" id="overview-of-the-paper">
<h3><a class="toc-backref" href="#id8">17.1. Overview of the Paper</a></h3>
<p>The paper we examine is by Carroll <em>et al</em>. <a class="reference internal" href="#carroll2005" id="id1">[Carroll2005]</a> The goal is
to confirm the results and explore some of the other results not explicitly addressed in the paper. This paper received a great deal of attention in the media. A partial list of some of the articles is given below, but many of them are now defunct:</p>
<div class="line-block">
<div class="line"><a class="reference external" href="http://www.cyclismo.org/tutorial/R/http://www.foxnews.com/story/0,2933,172026,00.html">FOX News</a></div>
<div class="line"><a class="reference external" href="http://www.cyclismo.org/tutorial/R/http://www.medpagetoday.com/Cardiology/Dyslipidemia/tb/1915">www.medpagetoday.com</a></div>
<div class="line"><a class="reference external" href="http://www.cyclismo.org/tutorial/R/http://www.argusleader.com/apps/pbcs.dll/article?AID=/20051012/NEWS/510120318/1001">Argus Leader</a></div>
<div class="line"><a class="reference external" href="http://www.cyclismo.org/tutorial/R/http://www.theglobeandmail.com/servlet/story/RTGAM.20051012.wchol1012/BNStory/specialScienceandHealth/">The Globe and Mail</a></div>
</div>
<p>The authors examine the trends of several studies of cholesterol levels of Americans. The studies have been conducted in 1960-1962, 1988-1994, 1976-1980, 1988-1994, and 1999-2002. Studies of the studies previous to 1999 have indicated that overall cholesterol levels are declining. The authors of this paper focus on the changes between the two latest studies, 1988-1994 and 1999-2002. They concluded that between certain populations cholesterol levels have decreased over this time.</p>
<p>One of the things that received a great deal of attention is the linkage the authors drew between lowered cholesterol levels and increased use of new drugs to lower cholesterol. Here is a quote from their conclusions:</p>
<blockquote class="epigraph">
<div><em>The increase in the proportion of adults using lipid-lowering medication, particularly in older age groups, likely contributed to the decreases in total and LDL cholesterol levels observed.</em></div></blockquote>
<p>Here we focus on the confirming the results listed in Tables 3 and 4 of the paper. We confirm the p-values given in the paper and then calculate the power of the test to detect a prescribed difference in cholesterol levels.</p>
</div>
<div class="section" id="the-tables">
<h3><a class="toc-backref" href="#id9">17.2. The Tables</a></h3>
<p>Links to the tables in the paper are given below. Links are given to verbatim copies of the tables. For each table there are two links. The first is to a text file displaying the table. The second is to a csv file to be loaded into R. It is assumed that you have downloaded each of the csv files and made them available.</p>
<p>Links to the Tables in the paper:</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="44%" />
<col width="44%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Table
1</td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table1.txt">text 1</a></td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table1.csv">csv 1</a></td>
</tr>
<tr class="row-even"><td>Table
2</td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table2.txt">text 2</a></td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table2.csv">csv 2</a></td>
</tr>
<tr class="row-odd"><td>Table
3</td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table3.txt">text 3</a></td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table3.csv">csv 3</a></td>
</tr>
<tr class="row-even"><td>Table
4</td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table4.txt">text 4</a></td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table4.csv">csv 4</a></td>
</tr>
<tr class="row-odd"><td>Table
5</td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table5.txt">text 5</a></td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table5.csv">csv 5</a></td>
</tr>
<tr class="row-even"><td>Table
6</td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table6.txt">text 6</a></td>
<td><a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table6.csv">csv 6</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="confirming-the-p-values-in-table-3">
<h3><a class="toc-backref" href="#id10">17.3. Confirming the p-values in Table 3</a></h3>
<p>The first thing we do is confirm the p-values. The paper does not
explicitly state the hypothesis test, but they use a two-sided test as
we shall soon see. We will explicitly define the hypothesis test that
the authors are using but first need to define some terms. We need the
means for the 1988-1994 and the 1999-2002 studies and will denote them
M88 and M99 respectively. We also need the standard errors and will
denote them SE88 and SE99 respectively.</p>
<p>In this situation we are trying to compare the means of two
experiments and do not have matched pairs. With this in mind we can
define our hypothesis test:</p>
<div class="math">
\[\begin{split}H_0: M_{88} - M_{99} &amp; = &amp; 0,\end{split}\]\[\begin{split}H_a: M_{88} - M_{99} &amp; \neq &amp; 0,\end{split}\]</div>
<p>When we assume that the hypothesis test we calculate the p-values
using the following values:</p>
<div class="math">
\[Sample Mean = M_{88} - M_{99},\]\[SE = \sqrt{SE_{88}^2 + SE_{99}^2}.\]</div>
<p>Note that the standard errors are given in the data, and we do not
have to use the number of observations to calculate the standard
error. However, we do need the number of observations in calculating
the p-value. The authors used a t test. There are complicated formulas
used to calculate the degrees of freedom for the comparison of two
means, but here we will simply find the minimum of the set of
observations and subtract one.</p>
<p>We first need to read in the data from <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table3.csv">table3.csv</a> and will call the new variable <em>t3</em>. Note that
we use a new option, <em>row.names=&#8221;group&#8221;</em>. This option tells R to use
the entries in the &#8220;group&#8221; column as the row names. Once the table has
been read we will need to make use of the means in the 1988-1994 study
(<em>t3$M.88</em>) and the sample means in the 1999-2002 study
(<em>t3$M.99</em>). We will also have to make use of the corresponding
standard errors (<em>t3$SE.88</em> and <em>t3$SE.99</em>) and the number of
observations (<em>t3$N.88</em> and <em>t3$N.99</em>).</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t3 <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;table3.csv&quot;</span><span class="p">,</span>header<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>row.names<span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">row.names</span><span class="p">(</span>t3<span class="p">)</span>
<span class="go"> [1] &quot;all&quot;    &quot;g20&quot;    &quot;men&quot;    &quot;mg20&quot;   &quot;m20-29&quot; &quot;m30-39&quot; &quot;m40-49&quot; &quot;m50-59&quot;</span>
<span class="go"> [9] &quot;m60-74&quot; &quot;m75&quot;    &quot;women&quot;  &quot;wg20&quot;   &quot;w20-29&quot; &quot;w30-39&quot; &quot;w40-49&quot; &quot;w50-59&quot;</span>
<span class="go">[17] &quot;w60-74&quot; &quot;w75&quot;</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>t3<span class="p">)</span>
<span class="go"> [1] &quot;N.60&quot;  &quot;M.60&quot;  &quot;SE.60&quot; &quot;N.71&quot;  &quot;M.71&quot;  &quot;SE.71&quot; &quot;N.76&quot;  &quot;M.76&quot;  &quot;SE.76&quot;</span>
<span class="go">[10] &quot;N.88&quot;  &quot;M.88&quot;  &quot;SE.88&quot; &quot;N.99&quot;  &quot;M.99&quot;  &quot;SE.99&quot; &quot;p&quot;</span>
<span class="gp">&gt; </span>t3<span class="o">$</span>M.88
<span class="go"> [1] 204 206 204 204 180 201 211 216 214 205 205 207 183 189 204 228 235 231</span>
<span class="gp">&gt; </span>t3<span class="o">$</span>M.99
<span class="go"> [1] 203 203 203 202 183 200 212 215 204 195 202 204 183 194 203 216 223 217</span>
<span class="gp">&gt; </span>diff <span class="o">&lt;-</span> t3<span class="o">$</span>M.88<span class="o">-</span>t3<span class="o">$</span>M.99
<span class="gp">&gt; </span><span class="kp">diff</span>
<span class="go"> [1]  1  3  1  2 -3  1 -1  1 10 10  3  3  0 -5  1 12 12 14</span>
<span class="gp">&gt; </span>se <span class="o">&lt;-</span> <span class="kp">sqrt</span><span class="p">(</span>t3<span class="o">$</span>SE.88<span class="o">^</span><span class="m">2</span><span class="o">+</span>t3<span class="o">$</span>SE.99<span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>se
<span class="go"> [1] 1.140175 1.063015 1.500000 1.500000 2.195450 2.193171 3.361547 3.041381</span>
<span class="go"> [9] 2.193171 3.328663 1.131371 1.063015 2.140093 1.984943 2.126029 2.483948</span>
<span class="go">[17] 2.126029 2.860070</span>
<span class="gp">&gt; </span>deg <span class="o">&lt;-</span> <span class="kp">pmin</span><span class="p">(</span>t3<span class="o">$</span>N.88<span class="p">,</span>t3<span class="o">$</span>N.99<span class="p">)</span><span class="m">-1</span>
<span class="gp">&gt; </span>deg
<span class="go"> [1] 7739 8808 3648 4164  673  672  759  570  970  515 4090 4643  960  860  753</span>
<span class="go">[16]  568  945  552</span>
</pre></div>
</div>
<p>We can now calculate the t statistic. From the null hypothesis, the
assumed mean of the difference is zero. We can then use the <em>pt</em>
command to get the p-values.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t <span class="o">&lt;-</span> <span class="kp">diff</span><span class="o">/</span>se
<span class="gp">&gt; </span><span class="kp">t</span>
<span class="go"> [1]  0.8770580  2.8221626  0.6666667  1.3333333 -1.3664626  0.4559608</span>
<span class="go"> [7] -0.2974821  0.3287980  4.5596075  3.0042088  2.6516504  2.8221626</span>
<span class="go">[13]  0.0000000 -2.5189636  0.4703604  4.8310181  5.6443252  4.8949852</span>
<span class="gp">&gt; </span>pt<span class="p">(</span><span class="kp">t</span><span class="p">,</span>df<span class="o">=</span>deg<span class="p">)</span>
<span class="go"> [1] 0.809758825 0.997609607 0.747486382 0.908752313 0.086125089 0.675717245</span>
<span class="go"> [7] 0.383089952 0.628785421 0.999997110 0.998603837 0.995979577 0.997604809</span>
<span class="go">[13] 0.500000000 0.005975203 0.680883135 0.999999125 0.999999989</span>
<span class="go">0.999999354</span>
</pre></div>
</div>
<p>There are two problems with the calculation above. First, some of the
t-values are positive, and for positive values we need the area under
the curve to the right. There are a couple of ways to fix this, and
here we will insure that the t scores are negative by taking the
negative of the absolute value. The second problem is that this is a
two-sided test, and we have to multiply the probability by two:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span><span class="kp">t</span><span class="p">),</span>df<span class="o">=</span>deg<span class="p">)</span>
<span class="go"> [1] 1.902412e-01 2.390393e-03 2.525136e-01 9.124769e-02 8.612509e-02</span>
<span class="go"> [6] 3.242828e-01 3.830900e-01 3.712146e-01 2.889894e-06 1.396163e-03</span>
<span class="go">[11] 4.020423e-03 2.395191e-03 5.000000e-01 5.975203e-03 3.191169e-01</span>
<span class="go">[16] 8.748656e-07 1.095966e-08 6.462814e-07</span>
<span class="gp">&gt; </span><span class="m">2</span><span class="o">*</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span><span class="kp">t</span><span class="p">),</span>df<span class="o">=</span>deg<span class="p">)</span>
<span class="go"> [1] 3.804823e-01 4.780786e-03 5.050272e-01 1.824954e-01 1.722502e-01</span>
<span class="go"> [6] 6.485655e-01 7.661799e-01 7.424292e-01 5.779788e-06 2.792326e-03</span>
<span class="go">[11] 8.040845e-03 4.790382e-03 1.000000e+00 1.195041e-02 6.382337e-01</span>
<span class="go">[16] 1.749731e-06 2.191933e-08 1.292563e-06</span>
</pre></div>
</div>
<p>These numbers are a close match to the values given in the paper, but
the output above is hard to read. We introduce a new command to loop
through and print out the results in a format that is easier to
read. The for loop allows you to repeat a command a specified number
of times. Here we want to go from 1, 2, 3, ..., to the end of the list
of p-values and print out the group and associated p-value:</p>
<span class="target" id="index-3"></span><div class="highlight-rconsole" id="index-4"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>p <span class="o">&lt;-</span> <span class="m">2</span><span class="o">*</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span><span class="kp">t</span><span class="p">),</span>df<span class="o">=</span>deg<span class="p">)</span>
<span class="gp">&gt; </span><span class="kr">for</span> <span class="p">(</span>j <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>p<span class="p">))</span> <span class="p">{</span>
<span class="go">     cat(&quot;p-value for &quot;,row.names(t3)[j],&quot; &quot;,p[j],&quot;\n&quot;);</span>
<span class="go">}</span>
<span class="go">p-value for  all   0.3804823</span>
<span class="go">p-value for  g20   0.004780786</span>
<span class="go">p-value for  men   0.5050272</span>
<span class="go">p-value for  mg20   0.1824954</span>
<span class="go">p-value for  m20-29   0.1722502</span>
<span class="go">p-value for  m30-39   0.6485655</span>
<span class="go">p-value for  m40-49   0.7661799</span>
<span class="go">p-value for  m50-59   0.7424292</span>
<span class="go">p-value for  m60-74   5.779788e-06</span>
<span class="go">p-value for  m75   0.002792326</span>
<span class="go">p-value for  women   0.008040845</span>
<span class="go">p-value for  wg20   0.004790382</span>
<span class="go">p-value for  w20-29   1</span>
<span class="go">p-value for  w30-39   0.01195041</span>
<span class="go">p-value for  w40-49   0.6382337</span>
<span class="go">p-value for  w50-59   1.749731e-06</span>
<span class="go">p-value for  w60-74   2.191933e-08</span>
<span class="go">p-value for  w75   1.292563e-06</span>
</pre></div>
</div>
<p>We can now compare this to <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table3.txt">Table 3</a> and see
that we have good agreement. The differences come from a round off
errors from using the truncated data in the article as well as using a
different method to calculate the degrees of freedom. Note that for
p-values close to zero the percent errors are very large.</p>
<p>It is interesting to note that among the categories (rows) given in
the table, only a small number of the differences have a p-value small
enough to reject the null hypothesis at the 95% level. The differences
with a p-value less than 5% are the group of all people, men from 60
to 74, men greater than 74, women from 20-74, all women, and women
from the age groups of 30-39, 50-59, 60-74, and greater than 74.</p>
<p>The p-values for nine out of the eighteen categories are low enough to
allow us to reject the associated null hypothesis. One of those
categories is for all people in the study, but very few of the male
categories have significant differences at the 95% level. The majority
of the differences are in the female categories especially the older
age brackets.</p>
</div>
<div class="section" id="confirming-the-p-values-in-table-4">
<h3><a class="toc-backref" href="#id11">17.4. Confirming the p-values in Table 4</a></h3>
<p>We now confirm the p-values given in <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table4.txt">Table 4</a>. The level of detail in the previous section is
not given, rather the commands are briefly given below:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t4 <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;table4.csv&quot;</span><span class="p">,</span>header<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>row.names<span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span><span class="kp">names</span><span class="p">(</span>t4<span class="p">)</span>
<span class="go">[1] &quot;S88N&quot;  &quot;S88M&quot;  &quot;S88SE&quot; &quot;S99N&quot;  &quot;S99M&quot;  &quot;S99SE&quot; &quot;p&quot;</span>
<span class="gp">&gt; </span>diff <span class="o">&lt;-</span> t4<span class="o">$</span>S88M <span class="o">-</span> t4<span class="o">$</span>S99M
<span class="gp">&gt; </span>se <span class="o">&lt;-</span> <span class="kp">sqrt</span><span class="p">(</span>t4<span class="o">$</span>S88SE<span class="o">^</span><span class="m">2</span><span class="o">+</span>t4<span class="o">$</span>S99SE<span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>deg <span class="o">&lt;-</span> <span class="kp">pmin</span><span class="p">(</span>t4<span class="o">$</span>S88N<span class="p">,</span>t4<span class="o">$</span>S99N<span class="p">)</span><span class="m">-1</span>
<span class="gp">&gt; </span>t <span class="o">&lt;-</span> <span class="kp">diff</span><span class="o">/</span>se
<span class="gp">&gt; </span>p <span class="o">&lt;-</span> <span class="m">2</span><span class="o">*</span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span><span class="kp">t</span><span class="p">),</span>df<span class="o">=</span>deg<span class="p">)</span>
<span class="gp">&gt; </span><span class="kr">for</span> <span class="p">(</span>j <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>p<span class="p">))</span> <span class="p">{</span>
<span class="go">     cat(&quot;p-values for &quot;,row.names(t4)[j],&quot; &quot;,p[j],&quot;\n&quot;);</span>
<span class="go">}</span>
<span class="go">p-values for  MA   0.07724362</span>
<span class="go">p-values for  MAM   0.6592499</span>
<span class="go">p-values for  MAW   0.002497728</span>
<span class="go">p-values for  NHW   0.1184228</span>
<span class="go">p-values for  NHWM   0.2673851</span>
<span class="go">p-values for  NHWW   0.02585374</span>
<span class="go">p-values for  NHB   0.001963195</span>
<span class="go">p-values for  NHBM   0.003442551</span>
<span class="go">p-values for  NHBW   0.007932079</span>
</pre></div>
</div>
<p>Again, the p-values are close to those given in <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table4.txt">Table 4</a>. The numbers are off due to truncation errors
from the true data as well as a simplified calculation of the degrees
of freedom. As in the previous section the p-values that are close to
zero have the greatest percent errors.</p>
</div>
<div class="section" id="finding-the-power-of-the-test-in-table-3">
<h3><a class="toc-backref" href="#id12">17.5. Finding the Power of the Test in Table 3</a></h3>
<p>We now will find the power of the test to detect a difference. Here we
arbitrarily choose to find the power to detect a difference of 4
points and then do the same for a difference of 6 points. The first
step is to assume that the null hypothesis is true and find the 95%
confidence interval around a difference of zero:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t3 <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;table3.csv&quot;</span><span class="p">,</span>header<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>row.names<span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>se <span class="o">&lt;-</span> <span class="kp">sqrt</span><span class="p">(</span>t3<span class="o">$</span>SE.88<span class="o">^</span><span class="m">2</span><span class="o">+</span>t3<span class="o">$</span>SE.99<span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="gp">&gt; </span>deg <span class="o">&lt;-</span> <span class="kp">pmin</span><span class="p">(</span>t3<span class="o">$</span>N.88<span class="p">,</span>t3<span class="o">$</span>N.99<span class="p">)</span><span class="m">-1</span>
<span class="gp">&gt; </span>tcut <span class="o">&lt;-</span> qt<span class="p">(</span><span class="m">0.975</span><span class="p">,</span>df<span class="o">=</span>deg<span class="p">)</span>
<span class="gp">&gt; </span>tcut
<span class="go"> [1] 1.960271 1.960233 1.960614 1.960534 1.963495 1.963500 1.963094 1.964135</span>
<span class="go"> [9] 1.962413 1.964581 1.960544 1.960475 1.962438 1.962726 1.963119 1.964149</span>
<span class="go">[17] 1.962477 1.964271</span>
</pre></div>
</div>
<p>Now that the cutoff t-scores for the 95% confidence interval have been
established we want to find the probability of making a type II
error. We find the probability of making a type II error if the
difference is a positive 4.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>typeII <span class="o">&lt;-</span> pt<span class="p">(</span>tcut<span class="p">,</span>df<span class="o">=</span>deg<span class="p">,</span>ncp<span class="o">=</span><span class="m">4</span><span class="o">/</span>se<span class="p">)</span><span class="o">-</span>pt<span class="p">(</span><span class="o">-</span>tcut<span class="p">,</span>df<span class="o">=</span>deg<span class="p">,</span>ncp<span class="o">=</span><span class="m">4</span><span class="o">/</span>se<span class="p">)</span>
<span class="gp">&gt; </span>typeII
<span class="go"> [1] 0.06083127 0.03573266 0.24009202 0.24006497 0.55583392 0.55508927</span>
<span class="go"> [7] 0.77898598 0.74064782 0.55477307 0.77573784 0.05765826 0.03576160</span>
<span class="go">[13] 0.53688674 0.47884787 0.53218625 0.63753092 0.53199248 0.71316969</span>
<span class="gp">&gt; </span><span class="m">1</span><span class="o">-</span>typeII
<span class="go"> [1] 0.9391687 0.9642673 0.7599080 0.7599350 0.4441661 0.4449107 0.2210140</span>
<span class="go"> [8] 0.2593522 0.4452269 0.2242622 0.9423417 0.9642384 0.4631133 0.5211521</span>
<span class="go">[15] 0.4678138 0.3624691 0.4680075 0.2868303</span>
</pre></div>
</div>
<p>It looks like there is a mix here. Some of the tests have a very high
power while others are poor. Six of the categories have very high
power and four have powers less than 30% . One problem is that this is
hard to read. We now show how to use the for loop to create a nicer
output:</p>
<div class="highlight-rconsole" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>power <span class="o">&lt;-</span> <span class="m">1</span><span class="o">-</span>typeII
<span class="gp">&gt; </span><span class="kr">for</span> <span class="p">(</span>j <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>power<span class="p">))</span> <span class="p">{</span>
<span class="go">     cat(&quot;power for &quot;,row.names(t3)[j],&quot; &quot;,power[j],&quot;\n&quot;);</span>
<span class="go"> }</span>

<span class="go">power for  all   0.9391687</span>
<span class="go">power for  g20   0.9642673</span>
<span class="go">power for  men   0.759908</span>
<span class="go">power for  mg20   0.759935</span>
<span class="go">power for  m20-29   0.4441661</span>
<span class="go">power for  m30-39   0.4449107</span>
<span class="go">power for  m40-49   0.221014</span>
<span class="go">power for  m50-59   0.2593522</span>
<span class="go">power for  m60-74   0.4452269</span>
<span class="go">power for  m75   0.2242622</span>
<span class="go">power for  women   0.9423417</span>
<span class="go">power for  wg20   0.9642384</span>
<span class="go">power for  w20-29   0.4631133</span>
<span class="go">power for  w30-39   0.5211521</span>
<span class="go">power for  w40-49   0.4678138</span>
<span class="go">power for  w50-59   0.3624691</span>
<span class="go">power for  w60-74   0.4680075</span>
<span class="go">power for  w75   0.2868303</span>

</pre></div>
</div>
<p>We see that the composite groups, groups made up of larger age groups,
have much higher powers than the age stratified groups. It also
appears that the groups composed of women seem to have higher powers
as well.</p>
</div>
<div class="section" id="differences-by-race-in-table-2">
<h3><a class="toc-backref" href="#id13">17.6. Differences by Race in Table 2</a></h3>
<p>We now look at the differences in the rows of LDL cholesterol in
<a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table2.txt">Table 2</a>. <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table2.txt">Table 2</a> lists
the cholesterol levels broken down by race. Here the p-values are
calculated for the means for the totals rather than for every entry in
the table. We will use the same two-sided hypothesis test as above,
the null hypothesis is that there is no difference between the means.</p>
<p>Since we are comparing means from a subset of the entries and across
rows we cannot simply copy the commands from above. We will first read
the data from the files and then separate the first, fourth, seventh,
and tenth rows:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>t1 <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&#39;table1.csv&#39;</span><span class="p">,</span>head<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>row.name<span class="o">=</span><span class="s">&quot;Group&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>t1
<span class="go">       Total  HDL  LDL  STG</span>
<span class="go">AllG20  8809 8808 3867 3982</span>
<span class="go">MG20    4165 4164 1815 1893</span>
<span class="go">WG20    4644 4644 2052 2089</span>
<span class="go">AMA     2122 2122  950  994</span>
<span class="go">AMA-M    998  998  439  467</span>
<span class="go">AMA-F   1124 1124  511  527</span>
<span class="go">ANHW    4338 4337 1938 1997</span>
<span class="go">ANHW-M  2091 2090  924  965</span>
<span class="go">ANHW-F  2247 2247 1014 1032</span>
<span class="go">ANHB    1602 1602  670  674</span>
<span class="go">ANHB-M   749  749  309  312</span>
<span class="go">ANHB-W   853  853  361  362</span>
<span class="go">M20-29   674  674  304  311</span>
<span class="go">M30-39   673  673  316  323</span>
<span class="go">M40-49   760  760  318  342</span>
<span class="go">M50-59   571  571  245  262</span>
<span class="go">M60-69   671  670  287  301</span>
<span class="go">M70      816  816  345  354</span>
<span class="go">W20-29   961  961  415  419</span>
<span class="go">W30-39   861  861  374  377</span>
<span class="go">W40-49   754  755  347  352</span>
<span class="go">W50-59   569  569  256  263</span>
<span class="go">W60-69   672  671  315  324</span>
<span class="go">W70      827  827  345  354</span>
<span class="gp">&gt; </span>t2 <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&#39;table2.csv&#39;</span><span class="p">,</span>head<span class="o">=</span><span class="bp">T</span><span class="p">,</span>sep<span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>row.name<span class="o">=</span><span class="s">&quot;group&quot;</span><span class="p">)</span>
<span class="gp">&gt; </span>ldlM  <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>t2<span class="o">$</span>LDL<span class="p">[</span><span class="m">1</span><span class="p">],</span>t2<span class="o">$</span>LDL<span class="p">[</span><span class="m">4</span><span class="p">],</span>t2<span class="o">$</span>LDL<span class="p">[</span><span class="m">7</span><span class="p">],</span>t2<span class="o">$</span>LDL<span class="p">[</span><span class="m">10</span><span class="p">])</span>
<span class="gp">&gt; </span>ldlSE <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>t2<span class="o">$</span>LDLSE<span class="p">[</span><span class="m">1</span><span class="p">],</span>t2<span class="o">$</span>LDLSE<span class="p">[</span><span class="m">4</span><span class="p">],</span>t2<span class="o">$</span>LDLSE<span class="p">[</span><span class="m">7</span><span class="p">],</span>t2<span class="o">$</span>LDLSE<span class="p">[</span><span class="m">10</span><span class="p">])</span>
<span class="gp">&gt; </span>ldlN  <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>t1<span class="o">$</span>LDL<span class="p">[</span><span class="m">1</span><span class="p">],</span>t1<span class="o">$</span>LDL<span class="p">[</span><span class="m">4</span><span class="p">],</span>t1<span class="o">$</span>LDL<span class="p">[</span><span class="m">7</span><span class="p">],</span>t1<span class="o">$</span>LDL<span class="p">[</span><span class="m">10</span><span class="p">])</span>
<span class="gp">&gt; </span>ldlNames  <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="kp">row.names</span><span class="p">(</span>t1<span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="kp">row.names</span><span class="p">(</span>t1<span class="p">)[</span><span class="m">4</span><span class="p">],</span><span class="kp">row.names</span><span class="p">(</span>t1<span class="p">)[</span><span class="m">7</span><span class="p">],</span><span class="kp">row.names</span><span class="p">(</span>t1<span class="p">)[</span><span class="m">10</span><span class="p">])</span>
<span class="gp">&gt; </span>ldlM
<span class="go">[1] 123 121 124 121</span>
<span class="gp">&gt; </span>ldlSE
<span class="go">[1] 1.0 1.3 1.2 1.6</span>
<span class="gp">&gt; </span>ldlN
<span class="go">[1] 3867  950 1938  670</span>
<span class="gp">&gt; </span>ldlNames
<span class="go">[1] &quot;AllG20&quot; &quot;AMA&quot;    &quot;ANHW&quot;   &quot;ANHB&quot;</span>
</pre></div>
</div>
<p>We can now find the approximate p-values. This is not the same as the
previous examples because the means are not being compared across
matching values of different lists but down the rows of a single
list. We will make use of two for loops. The idea is that we will loop
though each row except the last row. Then for each of these rows we
make a comparison for every row beneath:</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span><span class="kr">for</span> <span class="p">(</span>j <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="kp">length</span><span class="p">(</span>ldlM<span class="p">)</span><span class="m">-1</span><span class="p">))</span> <span class="p">{</span>
<span class="go">    for (k in (j+1):length(ldlM)) {</span>
<span class="go">       diff &lt;- ldlM[j]-ldlM[k]</span>
<span class="go">       se &lt;- sqrt(ldlSE[j]^2+ldlSE[k]^2)</span>
<span class="go">       t &lt;- diff/se</span>
<span class="go">       n &lt;- min(ldlN[j],ldlN[k])-1</span>
<span class="go">       p &lt;- 2*pt(-abs(t),df=n)</span>
<span class="go">       cat(&quot;(&quot;,j,&quot;,&quot;,k,&quot;) - &quot;,ldlNames[j],&quot; vs &quot;,ldlNames[k],&quot; p: &quot;,p,&quot;\n&quot;)</span>
<span class="go">       }</span>
<span class="go">  }</span>
<span class="go">( 1 , 2 ) -  AllG20  vs  AMA  p:  0.2229872</span>
<span class="go">( 1 , 3 ) -  AllG20  vs  ANHW  p:  0.5221284</span>
<span class="go">( 1 , 4 ) -  AllG20  vs  ANHB  p:  0.2895281</span>
<span class="go">( 2 , 3 ) -  AMA  vs  ANHW  p:  0.09027066</span>
<span class="go">( 2 , 4 ) -  AMA  vs  ANHB  p:  1</span>
<span class="go">( 3 , 4 ) -  ANHW  vs  ANHB  p:  0.1340862</span>
</pre></div>
</div>
<p>We cannot reject the null hypothesis at the 95% level for any of the
differences. We cannot say that there is a significant difference
between any of the groups in this comparison.</p>
</div>
<div class="section" id="summary">
<h3><a class="toc-backref" href="#id14">17.7. Summary</a></h3>
<p>We examined some of the results stated in the paper Trends in Serum
Lipids and Lipoproteins of Adults, 1960-2002 and confirmed the stated
p-values for Tables 3 and 4. We also found the p-values for
differences by some of the race categories in <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table2.txt">Table 2</a>.</p>
<p>When checking the p-values for <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table3.txt">Table 3</a> we
found that nine of the eighteen differences are significant. When
looking at the boxplot (below) for the means from <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table3.txt">Table 3</a> we see that two of those (the means for the two
oldest categories for women) are outliers.</p>
<div class="highlight-rconsole"><div class="highlight"><pre><span></span><span class="gp">&gt; </span>boxplot<span class="p">(</span>t3<span class="o">$</span>M.60<span class="p">,</span>t3<span class="o">$</span>M.71<span class="p">,</span>t3<span class="o">$</span>M.76<span class="p">,</span>t3<span class="o">$</span>M.88<span class="p">,</span>t3<span class="o">$</span>M.99<span class="p">,</span>
<span class="go">          names=c(&quot;60-62&quot;,&quot;71-73&quot;,&quot;76-80&quot;,&quot;88-94&quot;,&quot;99-02&quot;),</span>
<span class="go">          xlab=&quot;Studies&quot;,ylab=&quot;Serum Total Cholesterol&quot;,</span>
<span class="go">          main=&quot;Comparison of Serum Total Cholesterol By Study&quot;)</span>
</pre></div>
</div>
<div class="align-center figure" id="id7">
<span id="table3-boxlot"></span><img alt="Comparison of table 3." src="http://www.cyclismo.org/tutorial/R/_images/comparison.jpg" />
<p class="caption"><span class="caption-text">Figure 1.</span></p>
<div class="legend">
Boxplot of the results in table 3.</div>
</div>
<p>The boxplot helps demonstrate what was found in the comparisons of the
previous studies. There has been long term declines in cholesterol
levels over the whole term of these studies. The new wrinkle in this
study is the association of the use of statins to reduce blood serum
cholesterol levels. The results given in <a class="reference external" href="http://www.cyclismo.org/tutorial/R/_static/table6.txt">Table 6</a> show that every category of people has shown a
significant increase in the use of statins.</p>
<p>One question for discussion is whether or not the association
demonstrates strong enough evidence to claim a causative link between
the two. The news articles that were published in response to the
article imply causation between the use of statins and lower
cholesterol levels. However, the study only demonstrates a positive
association, and the decline in cholesterol levels may be a long term
phenomena with interactions between a wide range of factors.</p>
<p class="rubric">Bibliography</p>
<table class="docutils citation" frame="void" id="carroll2005" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[Carroll2005]</a></td><td><p class="first"><em>Trends in Serum Lipids and Lipoproteins of Adults, 1960-2002</em>,</p>
<p class="last">Margaret D. Carroll, MSPH, David A. Lacher, MD, Paul D. Sorlie,
PhD, James I. Cleeman, MD, David J. Gordon, MD, PhD, Michael Wolz,
MS, Scott M. Grundy, MD, PhD, Clifford L. Johnson, MSPH, <strong>Journal
of the American Medical Association</strong>, October 12, 2005&#8211;Vol 294,
No. 14, pp: 1773-1781</p>
</td></tr>
</tbody>
</table>
<br><br><br><br><br>
<script>
  $(function() {
    var toc = $('#toc>ul');

    function makeLi(text, href) {
      return $('<a href="' + href + '" target="_self">' + text + '</a><br>');
    }

    $('h2, h3,h4').each(function(i) {
      var chapter = $(this), chapterNumber = i + 1;
      toc.append(
        makeLi(chapter.text(), '#chapter-' + chapterNumber)
      );
      chapter.attr('id', 'chapter-' + chapterNumber);
    });

  });
</script>
</body>
</html>
