<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<style>

a:hover,a:active{color:red}
table.w3-table-all{margin:20px 0}
.top {
 position:relative;
 background-color:black;
 height:68px;
 padding-top:20px;
 line-height:50px;
 overflow:hidden;
 z-index:2;
}
body {
 background-color: #000000;
 color: MediumSeaGreen;
 margin-left: 14%;
 margin-right: 14%;
 font-size: 24px;
}
a { text-decoration: none;
	color: #58D858;}
a:visited { color: #88C898;}
A:hover {	color: yellow;}
A:focus {	color: red;}
code { color: gray; background-color: #001010; font-size: 18px;}
pre { color: gray; background-color: #001010; font-size: 18px;}
h1, h2, h3, h4, h5, .goldword {
	color: gold;
}
table{
	width: 100%;
	font-size: 20px;
	border-collapse: collapse;
	border: 1px solid gray;
}
th{
	border: 1px solid gray;
	font-weight:bold;
	color: lightgreen;
}
td{
	padding:10px;
	border: 1px dotted dimgray;
}
tr>th:first-child{
	width:40%;
}
tr>td:first-child{
	color: lime;

}
img{
	margin-top:1%;
	margin-bottom:2%;
}
.topic{
color: lime;
}
.goldsha {
color: white;
border: 1px solid gold;
padding: 2px;
border-radius: 3px;
	box-shadow: -2px -2px 3px gold inset;
}
.redsha {
color: gold;
border: 1px solid red;
padding: 2px;
border-radius: 3px;
	box-shadow: -2px -2px 3px red inset;
}
.whitesha {
color: red;
border: 1px solid white;
padding: 2px;
border-radius: 3px;
	box-shadow: -3px -2px 3px white inset;
}
.orangesha {
color: yellow;
border: 1px solid orange;
padding: 2px;
border-radius: 3px;
	box-shadow: -2px -2px 3px orange inset;
}
.yellowsha {
color: lime;
border: 1px solid yellow;
padding: 2px;
border-radius: 3px;
	box-shadow: 3px 3px 3px silver;
	display: inline-block;
}
.greensha {
color: lightblue;
border: 1px solid green;
padding: 2px;
border-radius: 3px;
	box-shadow: -2px -2px 3px green inset;
}
.left {
position: absolute;
left: 100px;
color: GoldenRod;
border: 1px solid GoldenRod;
padding: 2px;
font-size: 60%;
}
.bord {
color: redpink;
border: 1px solid GoldenRod;
padding: 1px;
font-size: 90%;
}
.yellowbord {
color: lime;
border: 1px solid yellow;
padding: 2px;
border-radius: 3px;
	box-shadow: 3px 3px 3px silver;
}
.bluebord {
color: white;
border: 1px solid lightblue;
padding: 2px;
border-radius: 3px;
	box-shadow: -2px -2px 3px silver inset;
}
.highlight { 
color: white;
background-color: #002030
  }
hr {width: 50%;}
li{
	list-style-type: decimal;
}
#toc, #tang, #san, #pill {
	margin-left: 15%;
	margin-right: 15%;
	color: gold;
	padding: 1%;
	text-align: left;
	box-shadow: 5px 5px 15px silver;
	border-radius: 5px;
	border: 1px solid DarkSlateGray;
font-size: 90%;
}
.mywords{
color: Crimson;
}
.orangeword{
color: orange;
}
.remarks {
	font-size: 22px;
	color: MediumSeaGreen;
}
</STYLE>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
$('h1, h2, h3, h4, h5, .goldword, .topic').click(function(){
parent.history.back();
return false;
});
});
</script>


</head>
<body>

<center><h2>Using Python for Android and QPython</h2></center>
<div id="toc"><ul></ul></div>
<br>
<br>
<br>


<p>Do you want to teach your Android device some clever tricks without mastering the art of native app development? Install Python, and you can automate practically any task and write complete apps using this popular scripting language.</p>
<div class="article_body"><p>To make it easier to run various scripting languages on the Android platform, Google created the Scripting Layer for Android (SL4A) project <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/3#article_i1" target="_self" class="info">[1]</a>. Although Google at some point has lost interest in maintaining the project, the last release of the framework runs perfectly well on any Android version before 5.0. The Python for Android component includes Python 2.6, so practically any script compatible with this version of Python will work on Android. More importantly, the combination of the scripting layer and Python for Android can be used to access Android APIs, so you can write Python scripts that offer the same functionality as native Android apps.</p><p>That's all fine and dandy, but it looks like the SL4A project is no longer maintained, and the available APK packages don't run well on Android 5.0 and higher. Thankfully, the project's code is released under the Apache License 2.0, so the SL4A <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/3#article_i2" target="_self" class="info">[2]</a> and Python for Android <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/3#article_i3" target="_self" class="info">[3]</a> parts have already been forked and updated to work with Android 5.0.</p><p>The SL4A and Python for Android pair is not the only option for using Python for Android. The QPython project <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/3#article_i4" target="_self" class="info">[4]</a> aims to build an entire Python environment for the Android platform (<a href="#article_f1" target="_self" class="figure">Figure 1</a>). QPython is available in Google Play Store in two editions: QPython is based on the Python 2.x series <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/3#article_i5" target="_self" class="info">[5]</a>, and QPython3 comes with Python 3.x <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/3#article_i6" target="_self" class="info">[6]</a>. Both versions are packed with useful features. What's more, QPython supports SL4A, so it provides a drop-in replacement for Google's Scripting Layer for Android and Python for Android. The environment comes with the PIP package manager, which allows you to add practically any Python library and module to your project.</p>
<div class="object-center" id="article_f1">

<img src="http://www.linux-magazine.com/var/linux_magazin/storage/images/issues/2015/176/workspace-python-scripting/figure-1/651851-1-eng-US/Figure-1_reference.png">
<br>
<span>
Figure 1: QPython provides a complete environment for writing and running Python scripts.
</span></div><p>Speaking of libraries, QPython comes with a handful of Python modules, including Bottle. This means that you can use QPython not only to write simple scripts that run locally but also to develop and deploy Python-based web apps. QPython is bundled with the QEdit editor suitable for writing and testing Python scripts (<a href="#article_f2" target="_self" class="figure">Figure 2</a>).</p>
<div class="object-center" id="article_f2">

<img src="http://www.linux-magazine.com/var/linux_magazin/storage/images/issues/2015/176/workspace-python-scripting/figure-2/651854-1-eng-US/Figure-2_reference.png">
<br>
<span>
Figure 2: QPython comes with the QEdit programming editor.
</span></div><p>In short, QPython can transform an Android device into a capable platform for developing and deploying Python scripts. The only fly in the ointment is the fact that QPython contains proprietary components, but its developers promise gradually to open source the entire stack.</p><a name="eztoc0_0_1" id="eztoc0_0_1"></a><h4>Getting Started with QPython</h4><p>QPython is available as an APK package in Google Play Store, so deploying it on the Android device is as easy as it gets. The initial screen lets you quickly run existing scripts and projects, whereas the main interface gives you access to QPython's modules and tools. The <i>Console</i> shortcut launches an interactive Python console, where you can execute statements individually.</p><p>The <i>Programs</i> shortcut opens a simple tool that allows you to browse and manage existing Python scripts and projects. When you tap on a script or a project folder, you have the option to run it, open it for editing, rename it , or delete it. To add Python scripts and projects to QPython, move them into the appropriate folders in the <code>com.hipipal.qpyplus</code> directory on the internal storage of the Android device.</p><p>QPython comes with several useful Python libraries preinstalled, including PIL, Pygame, Bottle, BeautifulSoup, and others. You can also install additional libraries using the option in the <i>Libraries</i> section. Here, you can use either QPython's own QPyPI package manager or PIP.</p><a name="eztoc0_0_2" id="eztoc0_0_2"></a><h4>From Python for Android to QPython</h4><p>If you already have scripts written for SL4A and Python for Android, you'll be pleased to learn that they can be migrated to QPython with a minimum of tweaking. You only need to add a QPython-specific preamble and use the <code>androidhelper</code> library instead of <code>android</code>.</p><p>Because QPython provides support for SL4A, you can use the framework to write and run Python scripts that can access and control Android functionality. QPython comes with a couple of ready-made scripts that you can run and study, but the best way to learn the ropes is to write your own scripts that solve real-world problems.</p><p>For example, if you often need to look up word definitions, you can whip up a simple Python script that can be used to look up the specified word or term in an online reference of your choice (<a href="#article_l1" target="_self" class="listing">Listing 1</a>).</p><div class="box listingbox" id="article_l1">
<div class="boxname">
<p>Listing 1</p>
</div>
<div class="boxtitle">
<p>Lookup Script</p>
</div>
<pre class="none">01 #-*-coding:utf8;-*-
02 #qpy:console
03 #qpy:2
04 import androidhelper
05 droid = androidhelper.Android()
06 s = droid.dialogGetInput('Define', 'Word to define:').result
07 droid.startActivity('android.intent.action.VIEW', 'http://www.google.com/search?q=define:' + s)</pre>
<div class="clear"></div>
</div><p>All scripts in QPython must have a preamble, defining encoding, running mode, and Python version. In <a href="#article_l1" target="_self" class="listing">Listing 1</a>, the encoding is set to UTF-8, and the script is instructed to run in console mode using Python 2.</p><p>Support for SL4A in QPython is provided through the <code>androidhelper</code> library, so the script starts by importing the library and creating the <code>droid</code> object. Android functionality in SL4A can be accessed through so-called facades that are basically friendly wrappers for Android APIs. The lookup script uses the <code>dialogGetInput</code> UI facade to display an input box and obtain the entered value. Once the script has a word or term to look up, it uses the <code>android.intent.action.VIEW</code> intent to open the provided URL (in this case, it's a Google search query followed by the obtained word or term) in the default browser.</p><p>SL4A provides a large collection of facades, and the project's wiki <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/3#article_i7" target="_self" class="info">[7]</a> offers an overview of all available facades along with their brief descriptions.</p><p>To run the script, move it to the <code>com.hipipal.qpyplus/scripts</code> folder, launch QPython, tap the <i>Quick Launch</i> button, choose <i>Run local script</i>, and select the script. For faster access, switch to the main interface, tap the <i>Programs</i> shortcut, and long-tap on the script to create a shortcut on the home screen.</p><a name="eztoc0_0_3" id="eztoc0_0_3"></a><h4>From Android to Mejiro</h4><p>Although plenty of services are available for sharing photos, I use Mejiro <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/3#article_i8" target="_self" class="info">[8]</a>, a single-file photo-publishing PHP web app. This no-frills app allows me to publish photos by simply uploading them to the dedicated <code>photos</code> directory. To make the entire process of snapping a photo and uploading it to Mejiro more straightforward, I wrote a relatively simple Python script that takes care of that (<a href="#article_l2" target="_self" class="listing">Listing 2</a>).</p><div class="box listingbox" id="article_l2">
<div class="boxname">
<p>Listing 2</p>
</div>
<div class="boxtitle">
<p>Upload to Mejiro Script</p>
</div>
<pre class="none">01 #-*-coding:utf8;-*-
02 #qpy:console
03 #qpy:2
04 import androidhelper, time, os, ftplib
05 # Specify FTP connection info
06 server = '127.0.0.1'
07 username = 'username'
08 password = 'password'
09 droid = androidhelper.Android()
10 mejiro_dir = '/sdcard/mejiro/'
11 if not os.path.exists(mejiro_dir):
12 os.makedirs(mejiro_dir)
13 timestamp = time.strftime('%Y%m%d-%H%M%S', time.localtime())
14 droid.cameraInteractiveCapturePicture(mejiro_dir + timestamp + '.jpg')
15 description_text = droid.dialogGetInput('Description', 'Add a description to the photo:').result
16 description_file = timestamp + '.txt'
17 file = open(mejiro_dir + description_file, 'a')
18 file.write('%s\n' % (description_text))
19 file.close()
20 droid.dialogCreateAlert('Upload the photo and the description file?')
21 droid.dialogSetPositiveButtonText('Yes')
22 droid.dialogSetNegativeButtonText('No')
23 droid.dialogShow()
24 response = droid.dialogGetResponse().result
25 if response['which'] == 'positive':
26 droid.dialogCreateSpinnerProgress('Uploading to FTP...')
27 droid.dialogShow()
28 conn = ftplib.FTP(server, username, password)
29 file = open (mejiro_dir + timestamp + '.jpg', 'rb')
30 conn.storbinary('STOR ' + timestamp + '.jpg', file)
31 file.close()
32 file = open (mejiro_dir + description_file, 'rb')
33 conn.storbinary('STOR ' + description_file, file)
34 file.close()
35 conn.quit()
36 droid.makeToast('Upload completed.')
37 droid.dialogDismiss()
38 droid.vibrate()
39 else:
40 droid.makeToast('All done!')
41 droid.dialogDismiss()</pre>
<div class="clear"></div>
</div><p>The script does several things. First, it creates the <code>mejiro</code> directory if it doesn't already exist. Then, it generates a timestamp, opens the default camera app, and saves the taken photo in the <code>mejiro</code> directory. The script then prompts you to add an accompanying note, and it saves it in the same directory. Finally, it asks whether you want to upload both the photo and the note, and when you press <i>Yes</i>, it pushes the files to the server via the FTP protocol. Obviously, for this script to work, you need to install an FTP server on the server running Mejiro and configure the <code>photos</code> directory for FTP access.</p><p>The script is basically regular Python code with several SL4A facades, including <code>dialogCreateAlert</code>, <code>dialogSetPositiveButtonText</code>, <code>dialogSetNegativeButtonText</code>, and <code>dialogShow</code>. As you might have guessed, these facades are used to create a dialog with the <i>Yes</i> and <i>No</i> buttons. The <code>dialogGetResponse</code> facade detects the selected response, which determines the script's flow, and the <code>makeToast</code> facade is used to display short-duration notifications. SL4A also provides the <code>notify</code> facade for regular notifications, but it's not supported in QPython.</p></div>

Going Further with Geofix</h4><p>Another example of QPython's possibilities is the Geofix project <a href="#article_i9" target="_self" class="info">[9]</a> also cobbled together by yours truly. The core of Geofix is a QPython script (there is also a version for use with Python for Android) that receives the geographical coordinates of the current location and saves the obtained data in a tab-separated text file and an SQLite database. The script itself is too long to list in this article, but you can easily clone the project's GitHub repository and study it to your heart's content.</p><p>The Geofix script makes use of several facades. In the code snippet below, the <code>startLocating</code> and <code>stopLocating</code> facades are used to start and stop geolocation:</p><pre class="auto">droid.startLocating()
droid.eventWaitFor('location', int(wait))
location = droid.readLocation().result
droid.stopLocating()</pre><p>The <code>eventWaitFor</code> facade is used to pause the script until it receives geographical data, then the <code>readLocation</code> facade reads the obtained data. The Geofix script also uses the <code>dialogCreateAlert</code> and <code>dialogGetResponse</code> facades to create a dialog and read user response. The <code>cameraInteractiveCapturePicture</code> facade is used to take a snapshot with the default camera app.</p><p>In addition to the <code>.tsv</code> text file, the script saves the obtained geographical data in an SQLite database, and the accompanying simple web app makes it possible to view data in a browser. You can deploy the web app on a remote server and modify the upload script in <a href="/Issues/2015/176/Workspace-Python-Scripting/(offset)/0#article_l2" target="_self" class="listing">Listing 2</a> to transfer the <code>geofix.sqlite</code> database to the appropriate folder on the server via FTP.</p><a name="eztoc0_0_2" id="eztoc0_0_2"></a><h4>Put on a Web Facade</h4><p>SL4A provides several facades for creating graphical elements like dialogs, input boxes, alerts, and so on, but, that's not all: The scripting layer also features the <code>webViewShow</code> facade, which makes it possible to create advanced interfaces using a mix of HTML, CSS, and JavaScript. Although this topic deserves a separate article, the code in <a href="#article_l3" target="_self" class="listing">Listing 3</a> gives a general idea of how the <code>webViewShow</code> facade works.</p><div class="box listingbox" id="article_l3">
<div class="boxname">
<p>Listing 3</p>
</div>
<div class="boxtitle">
<p>Where Am I Script</p>
</div>
<pre class="none">01 import time
02 import androidhelper
03 droid = androidhelper.Android()
04 droid.startLocating()
05 droid.eventWaitFor('location', 9000)
06 location = droid.readLocation().result
07 droid.stopLocating()
08 coords = location['network']
09 lat = str(coords['latitude'])
10 lon = str(coords['longitude'])
11 droid.makeToast('Network coordinates: ' + lat + ' ' + lon)
12 result = droid.geocode(lat, lon).result
13 geocode_data = droid.geocode(lat, lon)
14 country = geocode_data.result[0]['country_name']
15 city = geocode_data.result[0]['locality']
16 place = city + ', ' + country
17 f = open('/sdcard/com.hipipal.qpyplus/scripts/whereami.html', 'w')
18 f.write('&lt;html&gt;&lt;body&gt;&lt;h1&gt;Where Am I?&lt;/h1&gt;I am in &lt;strong&gt;' + place + '&lt;/strong&gt;&lt;/body&gt;&lt;/html&gt;')
19 f.close()
20 droid.webViewShow('file:///sdcard/com.hipipal.qpyplus/scripts/whereami.html')</pre>
<div class="clear"></div>
</div><p>The first part of the script obtains the geographical coordinates of the current location and performs reverse geocoding (i.e., determines the city and country name using the supplied latitude and longitude). The script then writes a simple HTML template containing the <code>place</code> variable to the <code>whereami.html</code> file. Then, the <code>webViewShow</code> facade opens the generated HTML page for viewing.</p><a name="eztoc0_0_3" id="eztoc0_0_3"></a><h4>Final Word</h4><p>Because they are lightweight and easy to master, SL4A/Python for Android and QPython provide a relatively easy way to automate tasks and build Android apps. Even if your Python skills are rather modest, you should be able to learn the Android-specific scripting basics in no time.</p><p>This article barely scratched the surface of the Android scripting layer, but I hope it gives you an idea of what you can build using either the Python for Android or QPython framework.</p>
<br>
<br><br><br><br><br>
<script>
  $(function() {
var toc = $('#toc>ul');

function makeLi(text, href) {
  return $('<a href="' + href + '" target="_self">' + text + '</a><br>');
}

$('h4').each(function(i) {
  var chapter = $(this), chapterNumber = i + 1;
  toc.append(
makeLi(chapter.text(), '#chapter-' + chapterNumber)
  );
  chapter.attr('id', 'chapter-' + chapterNumber);
});

  });
</script>
</body>
</html>
