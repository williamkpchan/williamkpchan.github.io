<!DOCTYPE html>
<!--meta http-equiv="refresh" content="300"-->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<html>
<head>
<title>CheckADayLineStatus</title>
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src='https://williamkpchan.github.io/mainscript.js'></script>
<script src="https://williamkpchan.github.io/LibDocs/stkComments.js"></script>
<script src="https://williamkpchanhp.github.io/filterResulitLib.txt"></script>
<script src="https://code.jquery.com/mobile/1.5.0-alpha.1/jquery.mobile-1.5.0-alpha.1.min.js"></script>

<script src="longHistList.js"></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.common.core.js" ></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.line.js"></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.drawing.yaxis.js"></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.common.dynamic.js"></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.common.tooltips.js"></script>
<script src="https://williamkpchanhp.github.io/codeList.js"></script>
<script src='https://cdn.plot.ly/plotly-2.34.0.min.js'></script>
<script>
  var showTopicNumber = false;
  var topicEnd = "&emsp;";
  var bookid = "CheckADayLineStatus"
  var markerName = "h2"
</script>

<style>
body {width:98%;margin-left: 1%; font-size:24px;}
#dateTime {  text-align: left;}
#cmtNote, #instruction, #message, #usstock{display:none;}
#amtLst {font-size:12px;}
#actions {font-size:12px; text-align: left; tab-size: 8; margin-left: 5%;}
select {border-radius:10px; font-size:20px;background-color:black; color:brown;}
#ohlcDiv {display:inline-block; width:85%; height:700px;}
#linechart {display:inline-block; width:85%; height:700px;}
#StkStatus {font-size:20px;}
</style>

</head>
<body onkeypress="chkKey()">

<center>
<h1>CheckADayLineStatus</h1>
<span class="goldword">&rarr;</span> <span id="dateAndTime" onclick="showDateAndTime()"><script>showDateAndTime();</script></span><br>
<div id="toc"></div>
</center>
<br>
<pre>
<h2>statistics</h2><span class="redbut" onclick="updateStat('CheckADayLineStatus');")>Load stat history</span> <span class="greenbut" onclick="removerec('CheckADayLineStatus');")>Remove first stat record</span><span class="yellowbut" onclick="alertStat();")>copy stat</span><span id="stkNum"></span>
<k>statistics history</k> 
<div id="prevstatistics"></div>

<pk>current statistics</pk>
<div id="currentstatistics"></div>

<h2><dr>M3XM4<dr></h2>
<div id="M3XM4"></div>
<div id="M3XM4Count"></div>

<h2><dr>M2XM3<dr></h2>
<div id="M2XM3"></div>
<div id="M2XM3Count"></div>

<h2>M1XM2</h2>
<div id="M1XM2"></div>
<div id="M1XM2Count"></div>

<h2><r>M0XM4<r></h2>
<div id="M0XM4"></div>
<div id="M0XM4Count"></div>

<h2><o>M0 Cont Up M1<o></h2>
<div id="M0ContUpM1"></div>
<div id="M0ContUpM1Count"></div>

<h2><o>M0 upCross M1<o><br></h2>
<div id="M0uXM1"></div>
<div id="M0uXM1Count"></div>

<h2><gr>M0 downCross M1<gr></h2>
<div id="M0dXM1"></div>
<div id="M0dXM1Count"></div>

<h2><gr>M0 Cont Dn M1<gr></h2>
<div id="M0ContDnM1"></div>
<div id="M0ContDnM1Count"></div>

<h2>StkStatus</h2>
<div id="StkStatus"></div>


</pre>

<script>
codetable = ['600519','603259','002261','000062','600550','000948','000158','601127','301236','600895','000063','300068','300339','000858','300085','000333','300735','002607','601899','300925','600150','300310','600203','688256','002232','300750','300598','300047','601138','600619','000568',
'300308','600776','300502','600418','600536','002456','000736','002600','002475','002463','002594','600187','000676','600988','002786','601162','688036','300759','600809','000977','600276','601919','601989','002717','603083','600489','600171','000536','002241','600690','002130',
'603883','300059','300274','300394','600490','601318','001236','000564','000560','000651','600611','600733','000002','603993','300438','000628','002371','600658','603019','600030','600383','002369','000627','002230','600552','600839','300711','300061','002017','300476','002384',
'600048','300184','300134','603626','603421','300563','601288','603636','601398','300311','002156','000625','000712','000595','600547','300379','002549','600900','605117','002123','000566','002085','600887','600719','002281','002231','600584','000938','601096','300353','000815',
'600036','300177','300746','001339','000725','601600','300293','601012','002368','002714','300757','300760','002027','300139','300149','000737','002155','002031','300679','000034','301378','001696','601689','600133','002466','600795','000561','002686','002142','600686','603890',
'000975','688111','301153','603986','002590','688041','300551','603189','301421','002352','300469','002916','000921','601888','002624','001979','601985','300857','600410','605398','688169','002821','000630','300045','002273','300088','002855','300663','600543','002803','300709',
'300622','002625','600309','000810','600498','600066','002722','600096','601601','300347','003816','002036','002415','601168','688777','300418','300917','000799','002050','002649','600011','603091','603936','002532','000338','601028','300067','000903','300560','600941','600362',
'600877','300561','000807','688035','300352','002990','600114','000933','002268','600031','003015','000519','600938','000768','601857','601328','601058','688012','600318','000021','300763','600379','601988','600696','002271','002180','001298','600919','603920','002422','300287',
'002148','600698','600160','002304','301297','601881','002313','300033','300337','300615','603501','002453','002312','002183','600522','000596','000099','600219','300905','600674','300077','300014','603288','603236','300015','603108','002339','600559','000001','002635','603127',
'300562','603118','600602','000521','300990','000538','000100','003032','300098','600589','002298','300498','300188','300229','600028','300256','600188','000426','600053','002659','601088','600129','301085','601766','300030','603979','000999','002460','300073','600702','002681',
'603068','601939','301091','002555','000425','002920','300147','300328','300122','601166','300433','300250','600106','300382','600838','600893','002291','603712','600326','002459','300630','300207','600016','600721','601668','000995','002028','601688','000878','603228','603605',
'600225','002236','600660','002640','600760','301520','000792','601658','002189','600863','002557','688609','600183','300322','300769','002338','002902','300378','300725','603198','300496','300050','000988','300363','300130','603871','000963','603005','300346','300124','688525',
'002668','002351','002420','300666','603316','603918','600336','300782','002709','601717','300290','002194','000423','002279','002819','300341','300183','300369','002138','300333','600600','688629','688692','600737','300136','301183','300827','601360','300125','300558','600222',
'600072','002892','603607','601818','301608','600100','000514','300590','600050','002244','002512','688981','600159','601179','600398','002547','601117','688117','603662','688710','002465','003005','603988','300638','002938','300884','000066','300605','601878','300803','002777',
'603306','600482','300999','300576','002771','300573','300401','601020','002439','000505','300730','600178','300364','688008','000543','002866','603106','002889','603659','600085','002184','603283','300677','300270','689009','601169','000400','002045','601991','000953','002129',
'000661','300457','603496','600775','603799','600436','300380','300366','002601','688037','603444','603596','600845','301611','601225','000058','000016','600312','000049','601336','300115','000829','601669','002078','600216','605086','002428','002179','605218','002738','301337',
'301160','301383','688390','000678','002409','002823','300608','300536','600023','600438','000786','600345','600460','600601','603456','600406','600958','600487','002474','300210','600027','600463','688120','603927','601319','301282','002708','002229','300046','301509','688072',
'600192','603559','600268','600501','600415','603369','600141','600025','603516','603508','600360','300277','300785','603000','600650','601816','002520','301096','301511','601728','601155','600079','600598','601633','600789','601666','300552','600233','002049','002166','300386',
'300786','002202','002517','000503','600266','600019','000598','600585','300377','300687','600082','300634','000791','300726','603296','600520','601136','688318','300588','300212','000157','300602','000546','301382','000901','300319','002997','002383','600060','301078','603997',
'603220','300002','603536','002405','601918','605111','600026','002812','601009','300896','300458','601099','600198','688498','300295','002544','601995','603327','600763','300641','600711','000020','002401','000776','300331','003026','003004','601233','000657','600830','600963',
'002311','002947','600355','002922','600985','002792','000960','000733','600779','600875','600363','600642','300260','600570','603606','301487','600825','001337','603398','600435','002436','301052','002444','000032','603737','300459','001278','301228','300875','688472',
'300302','001287','300345','603486','300510','002388','002829','301606','002272','688676','300647','600989','000818','002583','603806','600745','600761','600549','003029','601111','300131','600426','600325','600756','600256','002353','002410','603383','300859','601872','300927',
'300781','000166','603207','000612','002008','600161','603338','000525','605168','603613','301257','002507','003000','300609','601901','600089','600990','600101','300724','300866','600449','600886','002151','300570','603206','002120','300624','300213','002885','300170','300450',
'600811','600998','002766','600566','300531','603728','603123','001319','002827','000965','002908','300180','601916','000050','600879','002980','301036','601231','601390','002869','300017','603900','601186','601628','002602','688608','300316','002446','600901','600571','300456',
'002642','600872','300225','600683','003043','000409','002011','603087','002389','600015','601555','300604','601727','603766','301600','300504','300192','002237','002222','600372','603833','600358','601788','300166','605011','300231','002126','002861','601059','301308','603816',
'002055','300429','301090','603958','000040','603223','300474','603345','300797','002987','300395','601118','603589','002285','002558','002305','002848','002139','300606','300408','603160','002514','600703','300738','002943','600000','300399','603007','300181','300053','600148',
'000860','002654','300674','300567','300895','300058','301191','600707','601006','301137','300391','300659','600272','000683','002340','000851','688271','000750','600511','002487','300628','600905','600657','600718','601567','001314','603859','002622','002001','600497','600691',
'002246','300998','601069','600705','000599','605499','002302','002670','002875','600862','300436','301571','601933','301205','300133','601966','603033','600999','600280','600332','002939','600685','001286','300144','000830','300693','300432','002756','600529','688183','300255',
'002065','300667','600111','601456','300762','600665','603341','600285','300662','300245','000550','603392','300843','300107','300887','002685','300657','001309','002952','300176','002309','600916','002270','000620','300003','600199','301333','000831','600699','603389','002572',
'002761','600531','000850','600926','300460','300011','688076','002797','000915','600858','001313','002212','301221','600516','002152','300343','601865','300473','000665','600577','688235','601998','300100','300351','300007','000555','300120','688621','002074','300684','300182',
'601838','600130','600132','000913','600645','300766','000908','002185','000997','601229','301169','688469','600563','002115','002644','301578','000060','601066','300645','002800','300676','688361','601677','002935','000766','300620','002667','000006','688516','600859','000728',
'688593','300751','601898','000603','300252','000932','601137','600009','688506','603286','002970','002647','601699','300793','688166','301586','688023','300892','002294','301607','300315','688122','601868','002865','300559','000983','002025','600156','300400','002488','300169',
'000727','000159','688212','688047','601825','300619','300691','688617','603328','300678','603825','002837','000793','300627','300444','002468','600621','600885','000895','600754','300451','002897','002736','300956','603716','601698','600590','300975','300969','601198',
'601077','301123','300623','300348','300094','301311','603099','000528','600176','600115','300752','603129','600741','300768','600843','002396','688152','601212','002385','300373','688578','300468','603629','000783','600196','300221','002157','600881','600439','688187','301230',
'002317','688002','000151','300155','000513','300344','300846','301526','002597','603530','600765','600143','000801','301021','002335','600535','601607','600588','300012','300442','601877','600606','300114','002816','600546','300506','301099','600237','301102','300475','688202',
'002192','600818','601108','603556','600580','300413','002096','300947','301419','000797','300783','300075','300832','601126','002648','002075','688188','002195','601577','600206','603032','301301','002584','002966','300568','300223','002354','002100','000422','605333','600157',
'000532','300637','002693','002035','600006','600803','601777','688302','002112','603499','002739','601799','600118','603214','301013','300597','300635','300027','300238','603027','603195','600298','300175','601975','601929','300284','300324','300775','300894','601100','300650',
'688327','000955','301307','301316','600380','300404','600873','000039','002104','300080','688099','002493','300779','300049','300342','300197','300548','688266','002606','002508','002177','600018','301011','002215','603663','300393','002989','002587','600970','600750','300633',
'600610','300142','603786','002252','000923','000617','603298','688249','002373','603016','300541','300118','600422','002716','300773','300686','603290','603650','300079','601216','603939','603138','603179','600170','300390','601001','600109','300913','600420','603191','002831',
'688018','301172','688063','002387','688090','301095','002402','002265','000888','002150','002072','600992','300758','600271','600505','688333','600791','000682','600029','300705','002567','002315','603991','603619','300807','603378','300251','002223','301171','300083','002851',
'000429','603358','002673','300076','600850','002176','002528','300320','002432','600350','603212','002603','002698','301165','601636','001379','600062','002178','603009','002579','300661','600301','002426','000937','300487','600348','002796','000893','000506','300830','300037',
'601618','300579','000526','600010','600649','600732','000680','600250','600961','603768','300010','600452','688032','002079','688331','600331','300672','000629','002056','603188','600127','300973','300383','002856','002888','300005','002022','000408','002128','600734','688208',
'002832','600661','002652','000663','605198','002715','600993','002226','002993','600968','300454','002568','300941','600428','000957','603721','002981','600316','301132','688223','603042','000014','601958','603232','300113','600909','600185','603881','002467','601598',
'000636','000069','600822','601615','002979','601928','600343','300583','600692','600975','301001','688213','600094','002472','600257','002173','000403','603477','002843','300072','600626','600820','600771','301536','603186','601377','603801','605009','301330','300542','600576',
'300001','688123','601778','600518','300054','603888','603517','300820','002984','002066','300031','603893','300847','002617','603666','300465','300856','002689','600476','300292','002596','000875','000722','300036','300601','000584','605178','605007','300448','301219','002416',
'688027','000813','002063','000762','603297','300065','601800','002423','301489','300172','301488','000068','300979','300529','002991','002906','600971','002791','001965','600166','300968','002292','603363','300699','600933','688009','002095','300087','300736','000902','000981',
'600612','601156','002737','300398','600521','300863','300494','300303','603379','600399','603688','600193','000659','688050','603529','688568','002154','605358','600104','300745','000876','000998','000887','000702','002414','600582','600165','600352','000415','600021','688599',
'600392','301182','603008','002429','603990','603336','002207','002167','300556','002850','600770','002039','300165','300081','002491','002372','300719','300584','301062','300280','600007','600258','600710','300479','002577','688159','301369','600446','688260','600716','002407',
'600373','002961','002632','605588','300716','600927','605589','300205','002605','300806','300890','600769','002131','000738','000951','600038','600052','002815','003002','600153','601038','688201','002929','000739','603882','600338','601921','600155','002080','002106','002310',
'300253','002611','300244','688348','600557','600728','002430','300338','300271','300093','300248','300765','600346','600039','600061','600369','301039','000547','300101','300493','300189','688601','300957','688192','300117','600847','688668','600595','600071','300199','300522',
'601858','000559','002146','000926','300296','002692','600906','301293','003036','300159','601375','300006','600008','688131','001389','300148','000883','603399','601222','300546','000721','002589','300919','000803','600996','300868','600578','600483','603863','002799','002064',
'688268','601969','001277','301119','688017','600583','603279','600667','301213','688502','301050','300484','603528','300655','002881','301030','002660','603439','002500','000586','000758','002895','605376','000565','601696','300146','603588','300492','300566','600105','300842',
'300503','300580','002227','002370','688385','002705','002657','300648','688005','000516','300299','600107','002037','603598','002643','002380','000729','600131','002867','600773','603305','300026','300168','603197','300106','600662','000402','002073','002898','600329','002020',
'600572','002983','300466','300776','001914','301315','301178','601019','300412','300411','603225','600871','002805','002362','603707','603722','000600','603885','002421','688116','000779','603612','603185','601208','600421','300063','600208','002077','601298','603326','603025',
'301208','300162','601665','002962','002015','300009','301041','300516','688631','603583','300777','688300','601128','601101','301117','002519','300416','600361','002240','002153','300034','002038','000552','600177','300323','301128','301185','000028','688717',
'002262','600981','601021','300518','002713','688234','000823','300226','002845','000011','688561','301393','300024','002703','300374','000821','601595','300538','300791','688347','600207','301589','002747','300631','600804','002076','600151','600515','300241','603093','300537',
'301269','600456','600149','300236','000756','301360','301291','600637','002249','002806','601890','000670','601238','300532','300415','688062','000710','300201','688396','300264','688029','600622','000004','600918','603458','603051','002595','601228','300272','002529','300682',
'600682','301339','300671','002145','600340','300086','002531','301486','000656','002323','300200','301325','600777','002296','003031','600461','600562','300841','603738','300909','300936','300761','601990','600123','600866','603233','000563','002044','000027','601997','301012',
'688521','300233','600211','300070','300430','000597','688110','300545','000897','000590','300520','600391','002235','300071','300285','600641','600708','002773','002683','002162','688484','301136','601000','002043','605090','688019','002841','002451','300770','300446','000980',
'601236','300359','002992','688590','000650','688180','300056','003042','002645','000922','002243','002449','000969','301368','601016','301029','603533','002455','688766','600480','600288','002729','603466','301101','603778','600390','002199','002912','002847','301498',
'601500','002245','688772','600315','000759','002124','002933','002093','300419','002655','300557','601061','603826','001215','600262','600095','300455','301366','002609','002400','301348','688088','301525','002219','688636','301067','300121','002163','000031','603222','688377',
'601098','002506','688595','688536','300603','002457','002007','000029','002068','000070','300227','002376','603077','688016','603324','688387','300578','300102','002332','301358','600377','603660','000045','688598','688380','688372','603929','301312','603919','600556','603356',
'300945','002003','002727','000007','301238','688127','300722','600575','000720','002318','600936','600239','300261','301326','601866','688007','002563','000735','688798','300209','688303','600376','301121','600855','600221','001270','601801','002570','002191','000839','600499',
'301211','000686','300232','600088','300424','600186','301031','688095','002541','002322','688114','600636','600416','603390','002497','600908','300112','000681','600764','300242','000800','300747','301517','000610','688301','600236','002182','688728','300639',
'002653','605158','002158','301058','600797','300327','002217','000723','688205','603368','301162','603002','688408','300035','688066','688158','300889','688486','300870','000811','000987','002021','000709','603172','600663','600320','600455','603779','600639','601519','002019',
'300265','002523','603360','603260','300211','603322','603156','301345','600246','300685','002171','688819','002871','300008','600353','600299','600409','603168','300396','301159','301006','002484','300713','688210','002299','601880','300550','600635','603029','600869','300595',
'600525','002707','603218','600152','000718','688222','002358','601515','002919','688091','301538','301552','002941','600197','300707','600158','688083','002174','688167','003007','603131','003021','603658','603258','300461','000623','600679','301047','688082',
'300482','603822','688248','688538','002967','300718','601611','300811','000690','600743','603171','603489','000589','688278','002248','300748','002813','600037','603773','603063','603396','301550','002936','301016','603267','000972','000677','300626','688343','603860','600579',
'600704','301069','603887','600323','600739','002878','002539','000509','301060','300850','603998','603004','603713','600481','300409','002030','603299','301139','600386','300582','300097','688363','002859','300161','300618','003001','600684','002053','601808','301392','300360',
'605266','601827','000591','002205','300219','603505','603803','300020','301285','300123','600486','600959','603026','688687','002042','300203','600560','600633','002899','300016','002169','688195','002023','002591','688139','301248','688787','300845','600057','002559','300543',
'603028','600339','600729','301180','300443','600841','300787','300527','002355','688150','600817','000404','603800','600495','002896','688336','301259','000410','002588','300613','688418','002926','002533','600664','301387','600801','000848','002762','688126','000009',
'688252','000504','600730','001239','600243','300755','603520','600099','600322','300044','688489','300357','600757','000778','300690','688270','002116','300814','688049','300397','301508','300710','688639','688559','000877','603899','300204','301080','600986','603678','688690',
'605098','603308','002745','300269','000155','600459','000517','301073','600599','603897','600864','300525','300143','300407','300294','300835','688535','300831','688261','600202','002122','000838','688630','600405','603337','300513','301277','301155','002536','000959','688065',
'002840','688052','300670','000917','600282','601018','601333','301565','301089','688588','301580','002775','300040','603038','000868','601399','000859','300249','000936','300032','600640','300737','603203','002125','002086','600335','301328','300996','603122','600210','002518',
'600064','688556','600098','300403','300499','300654','300091','300039','003040','600517','301226','600630','002058','002418','300565','600867','300505','600827','601869','002395','002276','300428','603739','300288','002965','600330','300463','601860','002585','600070','601311',
'603317','002127','002925','003025','600782','600604','300652','688258','003019','300723','300069','000906','301558','605368','300355','603178','000703','301086','600605','603960','601952','603611','301596','600888','000017','603348','002580','601606','600675','600586','605555',
'603565','300052','603037','300489','002239','603931','600835','002119','000880','300278','000501','300953','600227','600200','002901','688522','300109','301207','600884','688582','001283','000701','300778','603056','002882','600201','601608','300772','000962','002170','301251',
'300062','300951','300976','300942','688362','688313','002712','601828','002527','301004','600816','600056','688409','300108','002032','001872','300449','300464','002238','002052','000524','002204','603876','002945','300903','000825','600500','002891','605296','600195','688281',
'301007','001267','300962','002561','300304','688297','300696','002121','300788','600995','688428','002690','300964','002913','300078','688185','688389','300217','301015','600249','301079','600269','002097','000065','000708','300152','600727','601113','000886',
'000668','300406','002876','301288','600119','002269','002959','300477','600749','300365','002755','603069','000633','002406','000777','688721','000025','002937','002735','603350','002958','000638','300140','000863','688153','688401','002009','300948','600128','688262','002413',
'002928','300051','001289','000421','000717','300340','603699','002550','601965','002706','688247','000911','600967','688789','001208','002741','002378','002948','688359','300508','688575','300279','301048','300281','688425','300042','300138','002551','600135','300267','300533',
'300307','000931','002343','301152','000719','300421','300796','301017','300935','301391','603858','600295','300912','688375','001338','600259','605507','603915','300731','000042','300298','300314','300096','002461','688226','301516','605196','002537','603690','600313','000898',
'300043','600116','301321','688200','600004','300991','600337','002524','301302','300222','300688','300410','600267','002565','600120','300916','300939','002349','300194','000785','300158','601908','301246','300254','002102','000056','600125','688695','603488','603519',
'300740','000949','000837','300790','688048','600889','002193','600829','603703','600478','000697','688259','688031','300977','300376','002615','605258','688696','300739','603568','002091','000930','605199','002543','002101','603667','601139','300855','002822','600273','301567',
'603323','002960','300708','688220','000928','301510','605020','002757','300585','600395','688182','002213','300228','600587','688276','300784','603355','601702','600537','688508','301070','688439','688488','300812','600973','605116','600561','000581','300629','300224','300490',
'002554','000090','301603','688510','688100','600748','688707','300157','688700','002646','000420','600623','300497','002682','600328','002274','603985','300554','300720','605136','600396','002726','600033','600742','688378','002700','600638','603100','600502','002918','600059',
'300370','000990','300329','300150','002839','300689','688699','002024','605277','600676','601900','300840','600643','002327','002186','000899','002978','002530','002046','300208','300697','002203','600223','601798','300462','601811','600717','300921','301176','688365',
'688366','601588','002061','603097','002636','600848','300128','601949','300817','002345','000679','300872','002728','002835','688177','688686','603300','601678','300656','603580','000539','002172','600581','300235','600184','600479','002675','688515','301357','000713','002542',
'002985','688322','300480','301141','300534','300675','002480','300426','600444','600388','002048','000019','301270','002873','603628','300581','603039','600248','603067','603393','688533','600976','301023','688779','002253','002331','603829','000970','688399','600375','301061',
'002701','002884','603538','603506','002266','688596','000551','301577','301267','603386','002893','002946','601163','000688','300660','300491','600755','300291','002765','688321','002556','300643','301217','002782','600503','300167','002277','300910','300885','001227','000755',
'002111','301167','603256','300901','002877','300218','301187','002283','002134','002486','003038','000572','603718','600528','300110','300780','600898','002267','600706','000700','300257','000985','300151','603679','603128','600012','300822','300596','300825','600366',
'603970','603219','603018','002250','603733','600629','301201','300880','301389','300171','300375','300185','000567','601886','600673','688351','600787','002489','003006','300771','300753','002521','688080','000301','605305','688039','300681','601619','603507','300240',
'300511','601718','301038','603683','603408','002403','603310','002364','600351','600688','002691','300472','300644','003009','301349','301218','301190','688289','603110','603701','002553','002907','001308','300358','600055','002012','002196','600861','688253','600241','600966',
'301278','688800','002114','002630','600491','300441','000156','301027','603818','600510','603633','688206','300423','300349','000691','600523','688698','603055','000925','600624','002366','600020','688507','603787','603719','688475','301239','000592','300879','002452','300823',
'603098','688429','600468','000012','300275','600807','301327','000816','600138','688089','002408','600894','603312','688518','688209','300767','002284','603200','300164','000520','002511','600979','688225','603085','301129','002350','600977','600506','000935','301103',
'300025','603966','002886','600389','300792','002864','603959','002968','002060','001296','600987','002256','603978','603585','300978','300129','003033','600058','688108','688685','002723','688352','600854','301306','002314','000035','603196','300808','603912','002911','603595',
'002225','002612','688207','002599','603416','688400','002326','002197','002320','600882','600785','002862','002357','002438','002356','003022','002534','600826','300300','301529','603266','002725','688612','002392','601326','002581','300381','002103','300135','000927','688326',
'603906','603866','002159','603726','600596','000008','000882','688025','688691','002807','600370','605081','600997','002785','600744','600110','300019','002626','000802','000795','000030','300507','002650','300523','002526','002915','688106','002540','601011','688279','300668',
'300547','600592','002492','688238','300810','002137','603273','002010','300326','301115','688118','600736','301005','600603','688520','002697','300334','600712','601992','000966','002669','603035','600567','603080','002903','002379','000037','301568','603078','300900','688503',
'603375','001213','600477','001219','301232','600467','300276','688579','688658','688567','600720','603586','001387','002676','600212','300836','603050','688233','600509','002510','600035','002295','000819','300153','600928','301231','300247','300729','300926','688776','301329',
'600783','603933','600597','002297','600252',];
  mustAdd = mustAddA.split(" ")
  codetable = codetable.concat(mustAdd)
  codetable = [...new Set(codetable)]
  document.getElementById("stkNum").innerHTML = " <u>Total stks</u>: "+ codetable.length

  fraudSTK = fraudSTK.split(" ")
  ignoreSTK = ignoreSTK.split(" ")
  fraudSTK = fraudSTK.concat(ignoreSTK)
  fraudSTK = [...new Set(fraudSTK)]

  codetable = codetable.filter(val => !fraudSTK.includes(val));
  codetableLen = codetable.length

      // loop to collect data and chkCross, results in here
     upcrossResulttxt = "";
     NewUpcross = ""
     NewDncross = ""
     NewHUpcross = ""
     NewLDncross = ""
     HContUp = ""
     LContDn = ""
     MContUp = ""
     batchCheckList = ""
     upcrossCnt = 0
     dncrossCnt = 0
     hupcrossCnt = 0
     ldncrossCnt = 0
     MContUpCnt = 0
     MContDnCnt = 0

     thestkdata = [];
     dateLst = [];
     openLst = [];
     highLst = [];
     lowLst = [];
     midLst = [];
     closeLst = [];
     amtLst = [];
     startIntv = 5;
     stkName = "";
     period = 75;

      dataStatus = "M"
      intv1 = startIntv
      intv2 = 2*intv1
      intv3 = 4*intv1
      intv4 = 6*intv1
      intv5 = 8*intv1
      intv6 = 9*intv1
      intv7 = 10*intv1
      intv8 = 11*intv1
      intv9 = 12*intv1
      halfNum = Math.round(intv1/2)

      stkpriceDataArr = [];
      stkList = 恒指成分.split(' ');
      stkPointer = 0;
      titleText = "";
      starti = 0;
      chartColor = ['white',
                    'red','#c80','#c60','#c40',
                    '#0f4','#066','#086','#084',
                    'purple','purple']

      attentionList = ""

      var options = '';  // build the List select option
      for (var i = 0; i < allListNames.length; i++) {
         options += '<option value="' + allListNames[i]+ '">' + allListNames[i] + '</option>';
      }
      $("#selectList").html(options);

      if (localStorage.getItem("attentionList") === null) {
        localStorage.attentionList = "07500";
      } else{
        attentionList = localStorage.getItem("attentionList").split(',');
      }

      // load localStorage.savedCodeList
      if (localStorage.getItem("savedCodeList") === null) {
        quickCodeList = ["110000"];
        localStorage.savedCodeList = quickCodeList;
      } else{
        quickCodeList = localStorage.getItem("savedCodeList").split(',');
      }

      // added extra links
      bigVolHeader = "http://www.etnet.com.hk/www/tc/stocks/realtime/quote_transaction.php?code="
      shortsellHeader = "http://www.aastocks.com/tc/stocks/analysis/stock-short-selling-ratio.aspx?symbol="
      newshead = "http://www.aastocks.com/tc/stocks/analysis/stock-aafn/"
      newstail = "/0/all/1"

      // main loop
      M3XM4Count = 0
      M2XM3Count = 0
      M1XM2Count = 0
      M0XM4Count = 0
      M0uXM1Count = 0
      M0ContUpM1Count = 0

      M0dXM1Count = 0
      M0ContDnM1Count = 0
      totalmtweight = 0

      for (var i = 0; i < codetable.length; i++) {
         collectStkData(codetable[i])
      }


      function updateStat(statname) {
      // update stat
        prevstat = localStorage.getItem(statname);
        if (prevstat === null) { prevstat = "" }

        currentStat = document.getElementById("currentstatistics").innerHTML
        document.getElementById("prevstatistics").innerHTML = prevstat +",<br>"+ currentStat
        localStorage.setItem(statname, 
        document.getElementById("prevstatistics").innerHTML)
        window.location = '#currentstatistics';
        window.scrollTo(window.scrollX, window.scrollY - 750);
        localStorage.setItem("batchMinuteStatusCheck", batchCheckList)
      }

      function removerec(statname) {
        currentStat = document.getElementById("prevstatistics").innerHTML
        currentStat = currentStat.split(',<br>')
        currentStat.shift();
        //currentStat.pop();
        localStorage.setItem(statname, currentStat)
        document.getElementById("prevstatistics").innerHTML = currentStat
      }

      function askforCode() {
        var tempCode = prompt("Code Number:", "");
        if (tempCode != null && tempCode != ""){

            codewidth = tempCode.length
            if(codewidth <= 5){
              theCode = "00000"+tempCode;
              codewidth = theCode.length;
              theCode = theCode.slice(codewidth-5, codewidth);
              codewidth = theCode.length; //update to be used later
            }else{
              theCode = tempCode
            }

           storeCode(theCode)
           collectStkData(theCode)
        }
      }

      function collectStkData(theCode) {

        storeCode(theCode);
          if( theCode.substring(0, 2) == "us"){
              // number of day klines shold be small to avoid slow response, even drop out
              theurl = 'https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,100,qfq';
              imageCode = theCode
          }else{

            if(theCode == "110000"){
             theCode = "HSI"; imageCode = "110000"
            }

          codewidth = theCode.length
          if(theCode == "HSI"){
              theurl = 'https://web.ifzq.gtimg.cn/appstock/app/hkfqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,100,qfq';
              imageCode = "110000"
          }else{

            if(codewidth <= 5){
              theCode = "00000"+theCode;
              codewidth = theCode.length;
              theCode = theCode.slice(codewidth-5, codewidth);
              codewidth = theCode.length; //update to be used later
              theStartCode = theCode
              imageCode = theCode
              theurl = 'https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,100,qfq';

            }else{
              codewidth = theCode.length
              if((codewidth == 6) && !hsReservedCode.includes(theCode)){
                 if (theCode.charAt(0) == "6"){
                    imageCode = theCode+".sh"; // note this comes before following line
                    theCode = "sh"+theCode; 
                 }else{
                    imageCode = theCode+".sz";
                    theCode = "sz"+theCode
                 }
                 theStartCode = theCode
                 theurl = 'https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,100,qfq';
              }else if(codewidth == 9){
                imageCode = theCode
                theCode = theCode.substring(7, 9) + theCode.substring(0, 6);
                theStartCode = theCode
                theurl = 'https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,100,qfq';
              }else{
                theurl = 'https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,100,qfq';
                theStartCode = theCode
                imageCode = theCode
              }
            }
          }
        }

          theStartCode = theCode;
          thedrawdata = [];
          amtLst.length = 0;

          $.get(theurl).done(function(rawJSON) { 
              rawJSON = eval(rawJSON)
              var keys = Object.keys(rawJSON); // read the structure keys ["code", "msg", "data"]

              var insideDatakey = Object.keys(rawJSON)[2] //
              // myobj[Object.keys(myobj)[0]] this is the extract method
              var thedata = rawJSON[Object.keys(rawJSON)[2]]
              thestkkey = Object.keys(thedata)[0] // this is the stk key name
              var tempdata = thedata[Object.keys(thedata)[0]];
              thestkdata = tempdata[Object.keys(tempdata)[0]]; // real data here, this is whole dataset

              if(thestkdata.length == 0){alert("no data in: " + thestkkey)}

              for(i=(thestkdata.length-12);i<thestkdata.length;i++){
                    thedate = thestkdata[i][0];  // date

                    if(codewidth <= 5){
                      theAmtIdx = 8;
                    }else{
                      theAmtIdx = 5;
                    }

                    theamt = Math.round(Number(thestkdata[i][theAmtIdx]));
                    if(codewidth > 5){
                      if(theCode.slice(0, 5) == "sh688"){
                        theamt = Math.round(theamt * Number(thestkdata[i][2])/10000);
                      }else{
                        theamt = Math.round(theamt * Number(thestkdata[i][2])/100);
                      }
                    }

                    theamt = theamt.toString().replace(/\B(?=(\d{4})+(?!\d))/g, ",");
                    $("#turnover").prepend( theamt,"w ");
              }
      
              theNameObj = tempdata[Object.keys(tempdata)[1]];
              theNameObjName  = theNameObj[Object.keys(theNameObj)[0]];
              stkName = theNameObjName[1]

              /* data is arranged in days array, tempdata[320] is last set
              tempdata[320][0]  // date, tempdata[320][1]  // open, tempdata[320][3]  // high
              tempdata[320][4]  // low, tempdata[320][2]  // close */
      
              //period + intv1, the chartwidth + max trend interval
              starti = thestkdata.length - (parseInt(period) + parseInt(intv1)) -5; 

              if(starti <= 0){
                  console.log(theStartCode + " " + stkName +" not enough data! dataLength: " + thestkdata.length);
                  return;
              }

              dateLst = [];
              openLst = [];
              highLst = [];
              lowLst = [];
              midLst = [];
              closeLst = [];
              amtLst = [];

              for (let i = starti; i < thestkdata.length; i++) {
                  dateLst.push(thestkdata[i][0]);
                  openLst.push(Number(thestkdata[i][1]));
                  highLst.push(Number(thestkdata[i][3]));
                  lowLst.push(Number(thestkdata[i][4]));
                  midLst.push((Number(thestkdata[i][3]) + Number(thestkdata[i][4]))/2);
                  closeLst.push(Number(thestkdata[i][2]));
                  amtvalue = Math.round(Number(thestkdata[i][theAmtIdx]));
                  amtLst.push(amtvalue);
              }
              // redraw();  // this line must be inside the AJAX because AJAX run last

              lastPrice = closeLst[closeLst.length-1]
              prevPrice = closeLst[closeLst.length-2]
              priceDiff = (lastPrice - prevPrice)/lastPrice

              lastamt = amtLst[amtLst.length-1]
              lastamt = Number(lastamt)

              mtweight = priceDiff * lastamt/10000 // calc the mtweight for final summation

              if(lastamt > 0){
                totalmtweight = totalmtweight + mtweight // sum the totalmtweight

                chkCross(stkName, highLst, midLst, theCode, lastPrice) // must put inside the RGraph.AJAX.getJSON
                $("#M3XM4Count").html("<k>Total M3XM4Count: </k><bo>"+ M3XM4Count +"</bo>");
                $("#M2XM3Count").html("<k>Total M2XM3Count: </k><bo>"+ M2XM3Count +"</bo>");
                $("#M1XM2Count").html("<k>Total M1XM2Count: </k><bo>"+ M1XM2Count +"</bo>");
                $("#M0XM4Count").html("<k>Total M0XM4Count: </k><bo>"+ M0XM4Count +"</bo>");

                $("#M0uXM1Count").html("<mpk>M0uXM1Count sum: "+ M0uXM1Count +"</mpk>");
                $("#M0ContUpM1Count").html("<mpk>M0ContUpM1Count sum: </mpk><bo>"+ M0ContUpM1Count +"</bo>");

                $("#M0dXM1Count").html("<gr>Total M0dXM1Count: </gr><blg>"+ M0dXM1Count +"</blg>");
                $("#M0ContDnM1Count").html("<gr>Total M0ContDnM1Count: </gr><blg>"+ M0ContDnM1Count +"</blg>");

                $("#currentstatistics").html("<y>"+showDate() +"</y> "+ showTime() + "<br>" +
                  "<k> Total M3XM4Count: </k><bo>"+ M3XM4Count +"</bo>" +
                  "<k> Total M2XM3Count: </k><bo>"+ M2XM3Count +"</bo>" +
                  "<k> Total M1XM2Count: </k><bo>"+ M1XM2Count +"</bo>" +
                  "<k> Total M0XM4Count: </k><bo>"+ M0XM4Count +"</bo>" + 

                  "<br><mpk>M0uXM1Count sum: </mpk><o>"+ M0uXM1Count +"</o>" + 
                  "<mpk> M0ContUpM1Count sum: </mpk><bo>"+ M0ContUpM1Count +"</bo>" +

                  "<gr> Total M0dXM1Count: </gr><blg>"+ M0dXM1Count +"</blg>" + 
                  "<gr> Total M0ContDnM1Count: </gr><blg>"+ M0ContDnM1Count +"</blg>" +
                  "<gr> mtw: </gr><mlg>"+ Math.round(totalmtweight) +"</mlg>,<br>"
                );

              }
           });

           //showActivity(theCode)
           window.scrollTo(0,0);
      }

     function chkKey() {
       var testkey = getChar(event);
       if(testkey == 't'){window.location = '#toc';}
       else if(testkey == 'q'){updateStat("CheckADayLineStatus");}

       // if(testkey == '+'){addToAttentionList();}
       else if(testkey == '-'){removeFmquickCodeList();}
       else if(testkey == 'X'){window.open("Random Charts.html");}
       else if(testkey == '.'){window.open("mlineMinutechart.html");}

       //else if(testkey == 'D'){window.location = '#image';}

       else if(testkey == 'l'){window.location = '#endpage';console.log("l: ");}
       else if(testkey == 'e'){window.location = '#commands';
            window.scrollTo(window.scrollX, window.scrollY + 2000);}
       else if(testkey == 's'){window.location = '#accel';
            window.scrollTo(window.scrollX, window.scrollY - 500);}
       else if(testkey == 'E'){window.location = '#filterMarkers';}
       else if(testkey == 'X'){storeCode(theCode); window.open("Random Charts.html");}
       else if(testkey == '.'){storeCode(theCode); window.open("mlineMinutechart.html");}
       else{chkOtherKeys(testkey)} 
     }

     function getChar(event) {
       if (event.which!=0 && event.charCode!=0) {
         return String.fromCharCode(event.which)   // the rest
       } else {
         return null // special key
       }
     }

     function xunbao(xunbaocode) {
       localStorage.setItem("randomcode", xunbaocode)
       localStorage.setItem("otherCode", xunbaocode)
       localStorage.setItem("stkCode", xunbaocode)

       window.open("Random Charts.html");
       // locs = ["HIghLowTrend.html", "Random Charts.html", ]
       //  window.open("HIghLowTrend.html")
     }

	function fillLineData() {
      var dataArr = prompt("Enter data array sep by space:", "");
      if (dataArr != null && dataArr != "") {
        dataArrArr = dataArr.split(' ');

        stkpriceDataArr = dataArrArr.map(Number);
        redraw()
      }
     }

      function addToquickCodeList() {
        codewidth = theCode.length
        if(codewidth <= 5){
          theCode = "00000"+theCode;
          codewidth = theCode.length;
          theCode = theCode.slice(codewidth-5, codewidth);
        }
        if (!quickCodeList.includes(theCode)) {
          quickCodeList.push(theCode);
          quickCodeList = Array.from(new Set(quickCodeList)); // set unique
          localStorage.savedCodeList = quickCodeList;
          alert(theCode + " added to quickCodeList")
        }else{alert(theCode + " already exist!")}
      }

    function usequickCodeList() {
        stkList = quickCodeList;
        alert("quickCodeList Total: " + quickCodeList.length + "\ndetails see end of this page.\nremember to modify mustadd list!")
        $("#message").text("quickCodeList Total: " + quickCodeList.length + "\n"+stkList);
    }

    function usestkListArr() {
      stkListArr = localStorage.getItem("stkListArr")
      if (stkListArr === null) {
         stkList = quickCodeList;
      } else{
         stkList = stkListArr;
      }
        alert("Use stkListArr, Total: " + stkListArr.length + " : "+stkListArr)
        $("#message").text("stkListArr Total: " + stkListArr.length + "\n"+stkList);
    }

	function addToAttentionList() {
            codewidth = theCode.length
            if(codewidth <= 5){
              theCode = "00000"+theCode;
              codewidth = theCode.length;
              theCode = theCode.slice(codewidth-5, codewidth);
              codewidth = theCode.length; //update to be used later
            }

        attentionList.push(theCode)
        attentionList = [...new Set(attentionList)]; // set unique

        ItemIndex = attentionList.indexOf("");  // remove empty items
        if (ItemIndex > -1) { attentionList.splice(ItemIndex, 1); }

        localStorage.setItem("attentionList", attentionList);
        alert(theCode + " added to attentionList!")
     }
	function removeFmquickCodeList() {
        ItemIndex = quickCodeList.indexOf(theCode);
        if (ItemIndex > -1) { quickCodeList.splice(ItemIndex, 1); }
        quickCodeList = [...new Set(quickCodeList)]; // set unique
        localStorage.setItem("quickCodeList", quickCodeList);
        alert(theCode + " removed fm quickCodeList!")
   }

     function redraw() { // includes main chart and aux charts
        initIntvSteps()
        titleText = showDate() +" "+ showTime()+", p1: "+intv1 +" w: "+(thestkdata.length-starti) +"\n"+theStartCode + " " + stkName + " 日線 ";
        $("#amtLst").html("Amt: ".concat(amtLst.slice((amtLst.length-14),amtLst.length).join("")));

 
        RGraph.reset(document.getElementById('cvs'));

        stkpriceDataArrC = closeLst
        stkpriceDataArrL = lowLst
        stkpriceDataArrM = midLst
        stkpriceDataArrH = highLst
        stdDevH = makeStd(highLst, intv3)
        stdDevL = makeStd(lowLst, intv3)

specialBackUp = lowLst.slice();  // backup array to avoid shadow changes
        newDevadd = makeMovAve(stkpriceDataArrM, intv3).map((a, i) => a + stdDevH[i]);
        newDevminus = makeMovAve(stkpriceDataArrM, intv3).map((a, i) => a - stdDevL[i]);

        mydata = [ stkpriceDataArrM]

          mydata.push(stkpriceDataArrH)
          mydata.push(makeMovAve(stkpriceDataArrH, halfNum))
          mydata.push(makeMovAve(stkpriceDataArrH, intv1))
          mydata.push(makeMovAve(stkpriceDataArrH, intv2))
          //mydata.push(makeMovAve(mydata[1], intv3))
          //mydata.push(makeMovAve(mydata[1], intv4))  // line 6

          mydata.push(stkpriceDataArrL) // line 6, index 5
          mydata.push(makeMovAve(stkpriceDataArrL, halfNum))
          mydata.push(makeMovAve(stkpriceDataArrL, intv1))
          mydata.push(makeMovAve(stkpriceDataArrL, intv2))
          //mydata.push(makeMovAve(mydata[5], intv3))
          // mydata.push(makeMovAve(mydata[5], intv4))

          //mydata.push(makeMovAve(mydata[1], intv8))
          mydata.push(newDevadd)
          mydata.push(newDevminus)  // line 8
        theMax = Math.max(...[].concat(...mydata));
        theMin = Math.min(...[].concat(...mydata));

        thedrawdata = mydata
        //thedrawdata.push(makeMovAve(thedrawdata[2], intv1));  // add one line to check results

        thedrawdata[1] = thedrawdata[1].fill(null,0,0)
        thedrawdata[2] = thedrawdata[2].fill(null,0,halfNum)
        thedrawdata[3] = thedrawdata[3].fill(null,0,intv1)
        thedrawdata[4] = thedrawdata[4].fill(null,0,intv2)

        thedrawdata[5] = thedrawdata[5].fill(null,0,0)
        thedrawdata[6] = thedrawdata[6].fill(null,0,halfNum)
        thedrawdata[7] = thedrawdata[7].fill(null,0,intv1)
        thedrawdata[8] = thedrawdata[8].fill(null,0,intv2)

        thedrawdata[9] = thedrawdata[9].fill(null,0,intv3)
        thedrawdata[10] = thedrawdata[10].fill(null,0,intv3)

        //thedrawdata[11] = thedrawdata[11].fill(null,0,intv3)
        //thedrawdata[12] = thedrawdata[12].fill(null,0,intv1)  // add one line 

lowLst = specialBackUp  // recover data

statusMsg = '<br><span class="red">price '+ mydata[0].slice(-1)[0].toFixed(3) +
'</span>, <span class="darkgreen">intvS '+ mydata[1].slice(-1)[0].toFixed(3) +
'</span>, <span class="blue">intvL '+ mydata[2].slice(-1)[0].toFixed(3) +
'</span>, <span class="purple">Top '+ mydata[3].slice(-1)[0].toFixed(3) +
'</span>, <span class="yellow">Bottom '+ mydata[4].slice(-1)[0].toFixed(3) +
'</span>, <span class="darkgreen">IntvS '+ intv1 +
'</span>, <span class="blue">IntvL '+ intv2 +
'</span>'

$("#lastValues").text("");
$("#lastValues").append(statusMsg);

       drawchart()

		// create datalog table
		 transp = transpose(mydata);
            wAveTrendRange = [];  // this is the gap diff
		  for (var row=0; row < transp.length; row++) {
		    rowRange = transp[row].slice(1, mydata.length);
      	    rowMax = Math.max(...rowRange);
      	    rowMin = Math.min(...rowRange);
      	    var rowDiff = rowMax - rowMin;
      	    wAveTrendRange.push(rowDiff);
      	  }

		wAveTrendRange.fill(null,0,intv3);
		wAvemax = Math.max(...wAveTrendRange);
		wAvemin = Math.min(...wAveTrendRange);
		drawTrend(wAveTrendRange, wAvemax, wAvemin, 'TP');

		// find derivative
		derivative = diff(makeMovAve(mydata[0], 3));
		derivative.unshift(0);
		derivative.fill(null,0,intv1+3); //array.fill(value, start, end)

		// diffaccel
		// diffaccel = thedrawdata[baseSubIdx].map(function(item, index) { return item - thedrawdata[baseMinuIdx][index]; })
		diffaccel = []
		diffaccel.push(thedrawdata[1].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[2].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[3].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[4].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[5].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[6].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel[0].fill(null,0,intv3); //array.fill(value, start, end)
		diffaccel[1].fill(null,0,intv3); //array.fill(value, start, end)
		diffaccel[2].fill(null,0,intv3); //array.fill(value, start, end)
		diffaccel[3].fill(null,0,intv3); //array.fill(value, start, end)
		diffaccel[4].fill(null,0,intv3); //array.fill(value, start, end)
		diffaccel[5].fill(null,0,intv3); //array.fill(value, start, end)

		diffaccMax = Math.max(...[].concat.apply([], diffaccel));
		diffaccMin = Math.min(...[].concat.apply([], diffaccel));
		drawTrend(diffaccel, diffaccMax, diffaccMin, 'accel');

		// ddiffaccel
		ddiffaccel = []
		ddiffaccel.push(diffaccel[0].map(function(item, index) { return item - diffaccel[1][index]; }))
		ddiffaccel.push(diffaccel[1].map(function(item, index) { return item - diffaccel[2][index]; }))
		ddiffaccel.push(diffaccel[2].map(function(item, index) { return item - diffaccel[3][index]; }))
		//ddiffaccel.push(diffaccel[3].map(function(item, index) { return item - diffaccel[4][index]; }))
		//ddiffaccel.push(diffaccel[4].map(function(item, index) { return item - diffaccel[5][index]; }))
		//ddiffaccel[0].fill(null,0,intv3); //array.fill(value, start, end)
		//ddiffaccel[1].fill(null,0,intv3); //array.fill(value, start, end)
		//ddiffaccel[2].fill(null,0,intv3); //array.fill(value, start, end)
		//ddiffaccel[3].fill(null,0,intv3); //array.fill(value, start, end)
		//ddiffaccel[4].fill(null,0,intv3); //array.fill(value, start, end)

		ddiffaccMax = Math.max(...[].concat.apply([], ddiffaccel));
		ddiffaccMin = Math.min(...[].concat.apply([], ddiffaccel));
		drawTrend(ddiffaccel, ddiffaccMax, ddiffaccMin, 'accaccel');

		// find stoch
		stoch1 = makeStoch(mydata[0], 50)
		stochmax1 = Math.max(...stoch1);
		stochmin1 = Math.min(...stoch1);
		drawTrend(stoch1, stochmax1, stochmin1, '强弱50');

        // evaluate B/S
        lastdayPtr = mydata[0].length-1
        statBegin = lastdayPtr - 29
        actionStr = ""
        for (var i = statBegin; i < (lastdayPtr+1); i++) {
          // define references
          Mvalue = mydata[0][i]
          Hvalue = mydata[1][i]
          Lvalue = mydata[5][i]
          hRefvalue = mydata[2][i]
          lRefvalue = mydata[6][i]
          h2Refvalue = mydata[3][i]
          l2Refvalue = mydata[7][i]
          acRefvalue = diffaccel[1][i]
          // compare indicators
          Hdiff = (Hvalue - hRefvalue).toFixed(2)
          Ldiff = (Lvalue - lRefvalue).toFixed(2)
          H2diff = (Hvalue - h2Refvalue).toFixed(2)
          L2diff = (Lvalue - l2Refvalue).toFixed(2)
          Mhdiff = (Mvalue - h2Refvalue).toFixed(2)
          Mldiff = (Mvalue - l2Refvalue).toFixed(2)
          acdiff = (diffaccel[0][i] - diffaccel[0][i-1]).toFixed(2)
          ac1diff = (diffaccel[0][i] - diffaccel[1][i]).toFixed(2)

          Mdiff = (mydata[0][i] - mydata[0][i-1]).toFixed(2)

          if(Hdiff >0){Hdiff = "<span class='red'>" +Hdiff + "</span>"}
          if(Ldiff >0){Ldiff = "<span class='red'>" +Ldiff + "</span>"}
          if(H2diff >0){H2diff = "<span class='red'>" +H2diff + "</span>"}
          if(L2diff >0){L2diff = "<span class='red'>" +L2diff + "</span>"}

          if(Mhdiff >0){Mhdiff = "<r>" +Mhdiff + "</r>"}
          else{Mhdiff = "<gr>" +Mhdiff + "</gr>"}
          if(Mldiff >0){Mldiff = "<r>" +Mldiff + "</r>"}
          else{Mldiff = "<gr>" +Mldiff + "</gr>"}

          if(Mdiff >0){Mdiff = "<r>" +Mdiff + "</r>"}
          else{Mdiff = "<gr>" +Mdiff + "</gr>"}

          if(acdiff >0){acdiff = "<r>" +acdiff + "</r>"}
          else{acdiff = "<gr>" +acdiff + "</gr>"}
          if(ac1diff >0){ac1diff = "<r>" +ac1diff + "</r>"}
          else{ac1diff = "<gr>" +ac1diff + "</gr>"}

          closeValue = lowLst[i]
          dateValue = dateLst[i].slice(5)

          // decision conditions
          actionStr = actionStr + dateValue + " C: " + closeValue +"\tHd: " + Hdiff + "\tLd: " + Ldiff + "\tH2d: " + H2diff + "\tL2d: " + L2diff + "\tMd: " + Mdiff + "\tacd: " + acdiff + "\tac1d: " + ac1diff + "<br>" 

          if(Hdiff>0){action = "buy"}
        }
        explanationStr = "<gr>h2d: h2 diff, l2d: L2 diff, md: M diff, acd: acc0 diff, ac1d: acc0 diff</gr>"
        actionStr = "<pre>" + actionStr + explanationStr+"</pre>"
        $("#actions").html(actionStr);

        drawOHLC()
        drawlinechart()
       }

	function makeMovAve(bigArray, intv) {
	     // the intv-1 is correct
		return bigArray.slice(0, intv-1).concat(calcMovAve(bigArray, intv));
	}
	function calcAve(aveArray) {
		add = (a, b) =>  a + b;
		return aveArray.reduce(add) / aveArray.length;
	}
	
	function calcMovAve(bigArray, intv) {
		var ma = [];
		for (var i =0 ; i < (bigArray.length-intv+1); i++) {ma[i] = calcWAve(bigArray.slice(i, i+intv));} // points to indicator
		return ma;
	}
	function calcWAve(aveArray) {
		var sum = 0
		for( var i = 1; i <= aveArray.length; i++ ) {
			sum += aveArray[i-1] * i;
		}
		return (sum / ((1 + aveArray.length)*aveArray.length/2))
	}

	function makeStoch(bigArray, intv) {
	     tempArr = bigArray.slice(0, intv-1).concat(calcStoch(bigArray, intv));
		return tempArr.fill(50,0,intv-1)
	}

	function calcStoch(bigArray, intv) {
		var stc = [];
		for (var i =0 ; i < (bigArray.length-intv+1); i++) {
			stc[i] = calc1Stoch(bigArray.slice(i, i+intv));
		}
		return stc;
	}

	function calc1Stoch(stcArray) {
			stcMax = Math.max(...stcArray)
			stcMin = Math.min(...stcArray)
			lastVal = stcArray[stcArray.length - 1]
			stcRange = stcMax - stcMin
			if(stcRange == 0){
				stcVal = 50
			}else{
				stcVal = 100*(lastVal - stcMin) / stcRange
			}
			return stcVal
	}

	function makeStd(bigArray, intv) {
	     // the intv-1 is correct
          newArray = new Array(intv-1).fill(0)
		newArray = newArray.concat(calcStd(bigArray, intv));
		return newArray
	}

	function calcStd(bigArray, intv) {
		var stdArrar = [];
		for (var i =0 ; i < (bigArray.length-intv+1); i++) {stdArrar[i] = Std(bigArray.slice(i, i+intv));} // points to indicator
		return stdArrar;
	}

	function Std(array) {
	  const n = array.length
	  const mean = array.reduce((a, b) => a + b) / n
	  return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)
	}

	function transpose(thisArr) { // Swap rows with columns of a matrix
	    return Object.keys(thisArr[0]).map(function(column) {
	        return thisArr.map(function(row) { return row[column]; });
	    });
	}

    function useAttentionList() {
        stkList = attentionList;
        alert("AttentionList Total: " + attentionList.length + "\ndetails see end of this page.\nremember to modify mustadd list!")
        $("#message").text("Total: " + attentionList.length + "\n"+stkList);
    }

    function myfavor() {
        myfavorLst = mychips.split(" ");
        stkList = myfavorLst;
        alert("mychips Total: " + myfavorLst.length + "\ndetails see end of this page.\nremember to modify mustadd list!")
        $("#message").text("mychips Total: " + myfavorLst.length + "\n"+stkList);
    }

    function askList() {
        var theList = prompt("CodeList, Number (5 digits) sep by space： ", "");
        if (theList != null && theList != "HSI" && theList != "") {
            stkList = theList.split(" ");
            alert("Supplied List Total: " + stkList.length + "\ndetails see end of this page.\nremember to modify mustadd list!")
            $("#message").text("Supplied List Total: " + stkList.length + "\n"+stkList);
        }
        codetable = stkList
        document.getElementById("upcrossResult").innerHTML = "";

        for (var i = 0; i < codetable.length; i++) {
           collectStkData(codetable[i])
        }
    }

    function FormatNumberLength5(num) {
        var r = "" + num;
        while (r.length < 5) { r = "0" + r; }
        return r;
    }

    function jpforward() {
        if (stkPointer < stkList.length-1) {
            stkPointer = stkPointer + 1;
        } else {
            stkPointer = 0;
        }
        theCode = stkList[stkPointer];
         collectStkData(theCode)
    }

    function jpback() {
        if (stkPointer > 0) {
            stkPointer = stkPointer - 1;
        } else {
            stkPointer = stkList.length-1;
        }
        theCode = stkList[stkPointer];
         collectStkData(theCode)
    }
    function jprandom() {
        stkPointer = Math.floor(Math.random() * (stkList.length-1))
        theCode = stkList[stkPointer]
         collectStkData(theCode)
    }

    function jpTo0() {
        stkPointer = 0;
        theCode = stkList[stkPointer]
        collectStkData(theCode)
    }

    function storeCode(theCode) {
        if(typeof(Storage) !== "undefined") {
            localStorage.randomcode = theCode;
        }
    }

    function chgchartWidth() {
        newChartWidth = prompt("enter chart width:", "");
        if (newChartWidth != null && newChartWidth != "" && newChartWidth < (1000 - 2*intv1)){
          period = parseInt(newChartWidth);
          localStorage.setItem("daychartWidth", period);
          collectStkData(theCode);
        }

    }
    function chgIntv() {
        intv = prompt("intv1 value:", "");
        if (theCode != null && intv1 != ""){
          intv1 = parseInt(intv);
          initIntvSteps()
          redraw()
        }
    }
    function initIntvSteps() {
      halfNum = Math.round(intv1/2)
      intv2 = 2*intv1
      intv3 = 4*intv1
      intv4 = 6*intv1
      intv5 = 8*intv1
      intv6 = 9*intv1
      intv7 = 10*intv1
      intv8 = 11*intv1
      intv9 = 12*intv1
    }
    function setTabWidth() {
        tabWidth = prompt("set tab width:", "");
        if (tabWidth != null && tabWidth != ""){
          tabWidth = parseInt(tabWidth);
          document.getElementById("actions").style.tabSize = tabWidth;
        }
    }

    function chgHighList() {
        dataStatus = "H"
        redraw()
    }
    function chgLowList() {
        dataStatus = "L"
        redraw()
    }
    function chgMidList() {
        dataStatus = "M"
        redraw()
    }
    function chgCloseLst() {
        dataStatus = "C"
        redraw()
    }

    function largeCht() {
        imgHead = "http://charts.aastocks.com/servlet/Charts?fontsize=12&15MinDelay=F&lang=1&titlestyle=1&vol=1&Indicator=3&indpara1=3&indpara2=5&indpara3=10&indpara4=15&indpara5=20&subChart2=3&ref2para1=12&ref2para2=26&ref2para3=9&subChart3=12&ref3para1=0&ref3para2=0&ref3para3=0&scheme=3&com=100&chartwidth=1600&chartheight=900&stockid=";

        imgTail = "&period=2060&type=1&logoStyle=1"
        imgURL = imgHead + theCode + imgTail
        window.open(imgURL, "_blank")
    }

function assignList(){
  newList = eval(document.getElementById("selectList").value).split(" ");
  stkList = newList;
  codeList = newList;

  document.getElementById("message").focus();
  alert(" Total: " + stkList.length + "\ndetails see end of this page.\nremember to modify mustadd list!\n" + newList)
        $("#message").text("Total: " + stkList.length + "\n"+stkList);
  $('#selectList').blur()

}

function showDateTime() {
    cmtCode = theCode // use another name not to interfere other parts
    var cmtcodewidth = cmtCode.length
    if(cmtcodewidth <= 5){
      cmtCode = "00000"+cmtCode;
      cmtcodewidth = cmtCode.length;
      cmtCode = cmtCode.slice(cmtcodewidth-5, cmtcodewidth);
    }
    else if(cmtcodewidth == 8){ cmtCode = cmtCode.slice(2, 8); }
    else if(cmtcodewidth == 9){ cmtCode = cmtCode.slice(0, 6); }
    commentName = "j" + cmtCode;

    CommentListNames = Object.keys(theCommentList); // extract the names from comments
    // to show comments
    if(CommentListNames.includes(commentName)){
      cmtLocation = CommentListNames.indexOf(commentName);
      commentTxt = theCommentList[Object.keys(theCommentList)[cmtLocation]]
    }else{commentTxt = "No data!";}

    document.getElementById("dateTime").innerHTML ="<span class='orange'>" + commentTxt + "</span>";
}

    function drawchart() {
      listItems = []
      if(dataStatus == "C"){ tooltips = closeLst
      }else if(dataStatus == "L"){ tooltips = lowLst
      }else if(dataStatus == "M"){ tooltips = midLst
      }else { tooltips = highLst}

      dataTooltips = tooltips.map(item => Math.round(item * 1000) / 1000)
      for (index = 0; index < dataTooltips.length; index++) {
        listItems[index] = dateLst[index] + "<br><span class='red'>" + dataStatus + "</span>: " + dataTooltips[index];
      }

      dataTooltips = dataTooltips.map(String)

      var line = new RGraph.Line({
        id:'cvs',
        data: thedrawdata,
        options: {
			title: titleText + " " + "MHL + trends",
			titleColor: 'grey',
			titleSize: 20,
               colors: chartColor,
            backgroundGrid: true, backgroundGridVlines: true,
            backgroundGridColor: '#001000', backgroundGridBorder: false,
            // backgroundGridDotted: true,
            backgroundGridDashed: true, 
            axisColor: '#864',  scaleDecimals: 2,
            xaxis: true,
            //xaxisLabels: ["a","b","c","d"],
            textColor: '#ccc',
            tickmarks: 'plus',
            ticksize: 1,
            linewidth:1,
			ymax: theMax,
			ymin: theMin,
      // labels control the number of grids
            // labels: ['2008','2009','2010','2011','2012','2013','2014','2015','2016','2017','2018'],
            spline: false,
            shadow: false,
            tooltips: listItems,
            gutterLeft: 0, gutterRight: 50,
            gutterTop: 25, gutterBottom: 25
            }
          }).trace();

		yminpct = 100 - (theMax-theMin)*100/theMax,
		ymaxpct = 100,

          yaxis1 = new RGraph.Drawing.YAxis('cvs', 1200)
                .Set('colors', ['gold'])
                .Set('text.color', 'gray')
                .Set('text.size', 8)
                .Set('max', ymaxpct)
                .Set('min', yminpct)
                .Set('linewidth', 2)
                .Set('tickmarkslength', 5)
                .Set('title', '% pct')
                .Draw();

    };

    function drawTrend(therange,maxValue, minValue, chartID) {
       // dataTooltips = therange.map(item => Math.round(item * 1000) / 1000)
       // dataTooltips = dataTooltips.map(String)
       RGraph.reset(document.getElementById(chartID));
       line = new RGraph.Line({
       	id:chartID, data:therange,
       	options: {
       		title: chartID + ", "+theStartCode + " " + stkName,
    			titleColor: 'grey', 
    			titleSize: 10,
       		backgroundGrid: true, axisColor: '#864', textColor: '#ccc',
    		numxticks: 0, colors: chartColor, scaleDecimals: 2,

       		tickmarksDotLinewidth: 0,ticksize: 1, linewidth: 1, 
       		ymax: maxValue, ymin: minValue,
               tickmarks: 'plus',

       		spline: false, shadow: false,
              // tooltips: dataTooltips,
			backgroundGridVlines: true,
			backgroundGridDashed: true, 
       		backgroundGridColor: '#001000',
       		gutterLeft: 0, gutterRight: 50, gutterTop: 25, gutterBottom: 25
       	}
       }).trace();
    };
    
    function diff(arr) {
      return arr.slice(1).map(function(n, i) { return n - arr[i]; });
    }

function showActivity(thecode){
    markers = filterResult.filter(element => element.includes(thecode));
    // clean the h2 tags
    markers = markers.map(element => element.replace(/<\/h2>.*/gi, ""))
    markers = markers.map(element => element.replace(/<h2>/gi, ""))

    markers = markers.map(element => formatWeekDay(element))
    if (markers.length > 50) markers.splice(0, markers.length-80);

    $('#filterMarkers').append("<b class='red'>" + thecode + " 日线特征:</b><br>")
    $('#filterMarkers').append(markers)
}

// format WeekDay
function formatWeekDay(element) {
    dayStr = element.replace(/<.*?>/gi, "") // clean span tags
    dayStr = dayStr.substr(0,6)
    dayStr = convertWeekday(dayStr)
    return(dayStr + " " + element + "<br>")
}

// convert date string to weekday
function parse(str) {
    str = "20" + str
    var y = str.substr(0,4), m = str.substr(4,2) - 1,
        d = str.substr(6,2);
    var D = new Date(y,m,d);
    return (D.getFullYear() == y && D.getMonth() == m && D.getDate() == d) ? D : 'invalid date';
}
function convertWeekday(str) {
    return ["SUN","MON","TUE","WED","THU","FRI","SAT"][parse(str).getDay()]
}
function fetchUsCode(str) {
    theCode = str; collectStkData(str); window.location = '#cvs';
    $('#usstock').toggle();
}

function handleRight( event ){
    codeListPtr = codeListPtr +1
    theCode = codeList[codeListPtr];
    collectStkData(theCode);
}

    codeList = codeList.split(' ')
    codeListPtr = 0

    // $( "html" ).on( "swiperight", handleRight );
    // $( "html" ).on( "swipeleft", askforCode );
    window.addEventListener('click', function (evt) {
        if (evt.detail === 3) { askforCode(); }
    });

    collectStkData(theCode);

function docLoaded() {
    let script1 = document.createElement('script');
    script1.src = 'https://williamkpchan.github.io/LibDocs/readbook.js';
    document.body.appendChild(script1);
    let script = document.createElement('script');
    script.src = 'C:/R programs/!!! STKMon !!!/headerApp.js';
    document.body.appendChild(script);
    window.scrollTo(0,(document.body.scrollHeight));

}

    function drawOHLC() { // includes main chart and aux charts
      var ohlcdata = {
        close:  closeLst,
        low:  lowLst,
        open:  openLst,
        high:  highLst,
        x:  dateLst,
        line: {color: 'rgba(31,119,180,1)'}, 
        increasing: {line: {color: 'red'}},
        decreasing: {line: {color: 'green'}},
        type: 'candlestick', 
        xaxis: 'x', 
        yaxis: 'y'
      };

      var data = [ohlcdata];
      var layout = {
      title: titleText,
        dragmode: 'zoom', 
        showlegend: false,
        xaxis: { rangeslider: { visible: false } }, 
        yaxis: { autorange: true,  type: 'linear' }
      };
      Plotly.newPlot('ohlcDiv', data, layout);
    }


    function chkCross(stkName, highLst, midLst, thisCode, lastPrice) { // includes main chart and aux charts
      contUCnt = 0
        statustxt = `<k onclick="xunbao('` + thisCode + `')">`+ thisCode + " <dr>" + stkName+ '</dr></k>&emsp;'
        $("#StkStatus").append( "<br>" +statustxt);

      // mid data
      dLineM0 = midLst
      dLineM1 = makeMovAve(midLst, intv1)
      dLineM2 = makeMovAve(midLst, intv2)
      dLineM3 = makeMovAve(midLst, intv3)
      dLineM4 = makeMovAve(midLst, intv4)

      indexlast = dLineM0.length-1

      curM0 = dLineM0[indexlast]
      prevM0 = dLineM0[indexlast-1]

      curM1 = dLineM1[indexlast]
      prevM1 = dLineM1[indexlast-1]

      curM2 = dLineM2[indexlast]
      prevM2 = dLineM2[indexlast-1]

      curM3 = dLineM3[indexlast]
      prevM3 = dLineM3[indexlast-1]

      curM4 = dLineM4[indexlast]
      prevM4 = dLineM4[indexlast-1]


      // H data
      dLineH0 = highLst
      dLineH1 = makeMovAve(highLst, intv1)
      dLineH2 = makeMovAve(highLst, intv2)

      curH0 = dLineH0[indexlast]
      prevH0 = dLineH0[indexlast-1]

      curH1 = dLineH1[indexlast]
      prevH1 = dLineH1[indexlast-1]

      curH2 = dLineH2[indexlast]
      prevH2 = dLineH2[indexlast-1]

      // Lo data
      dLineLo0 = lowLst
      dLineLo1 = makeMovAve(lowLst, intv1)
      dLineLo2 = makeMovAve(lowLst, intv2)

      curLo0 = dLineLo0[indexlast]
      prevLo0 = dLineLo0[indexlast-1]

      curLo1 = dLineLo1[indexlast]
      prevLo1 = dLineLo1[indexlast-1]

      curLo2 = dLineLo2[indexlast]
      prevLo2 = dLineLo2[indexlast-1]

      passchk = passExam(highLst, midLst, lowLst, closeLst, amtLst)
      if(passchk == "pass"){ passchk = true}

      // checkX(prevL, prevS, curL, curS) check mid

      curS = curM0
      prevS = prevM0
      curL = curM1
      prevL = prevM1
      checkXMsg = "<k> M0XM1 </k>"+checkX(prevL, prevS, curL, curS)
      $("#StkStatus").append(checkXMsg);
      if(checkXMsg.includes('cont.Up')){contUCnt = contUCnt +1}


      // check if upCross
      result = /UpCross/.test(checkXMsg);
      if(result && passchk){
        uptxt = statustxt.replace(/dr>/g, "o>");
        $("#M0uXM1").append(uptxt);
        M0uXM1Count = M0uXM1Count +1
        batchCheckList = batchCheckList + " " + thisCode.slice(2) // remove first 2 characters
      }

      // check if cont.Up
      result = /cont.Up/.test(checkXMsg);
      if(result && passchk){
        uptxt = statustxt.replace(/dr>/g, "o>");
        $("#M0ContUpM1").append(uptxt);
        M0ContUpM1Count = M0ContUpM1Count +1
      }

      // check if DownCross
      result = /DownCross/.test(checkXMsg);
      if(result){
        downtxt = statustxt.replace(/dr>/g, "gr>");
        $("#M0dXM1").append(downtxt);
        M0dXM1Count = M0dXM1Count +1
      }

      // check if cont.Dn
      result = /cont.Dn/.test(checkXMsg);
      if(result){
        downtxt = statustxt.replace(/dr>/g, "gr>");
        $("#M0ContDnM1").append(downtxt);
        M0ContDnM1Count = M0ContDnM1Count +1
      }



      curL = curM2
      prevL = prevM2
      checkXMsg = "<k> M0XM2 </k>"+checkX(prevL, prevS, curL, curS)
      $("#StkStatus").append(checkXMsg);
      if(checkXMsg.includes('cont.Up')){contUCnt = contUCnt +1}

      curL = curM3
      prevL = prevM3
      checkXMsg = "<k> M0XM3 </k>"+checkX(prevL, prevS, curL, curS)
      $("#StkStatus").append(checkXMsg);
      if(checkXMsg.includes('cont.Up')){contUCnt = contUCnt +1}

      curL = curM4
      prevL = prevM4
      checkXMsg = "<k> M0XM4 </k>"+checkX(prevL, prevS, curL, curS)
      $("#StkStatus").append(checkXMsg);
      if(checkXMsg.includes('cont.Up')){contUCnt = contUCnt +1}

      if(contUCnt == 4){
        $("#M0XM4").append(statustxt);
        M0XM4Count++;
      }

      curS = curM1
      prevS = prevM1
      curL = curM2
      prevL = prevM2
      checkXMsg = "<dr> M1XM2 </dr>"+checkX(prevL, prevS, curL, curS)
      $("#StkStatus").append(checkXMsg);
      if(checkXMsg.includes('cont.Up')){contUCnt = contUCnt +1}

      if(contUCnt == 5){
        $("#M1XM2").append(statustxt);
        M1XM2Count++;
      }

      curS = curM2
      prevS = prevM2
      curL = curM3
      prevL = prevM3
      checkXMsg = "<k> M2XM3 </k>"+checkX(prevL, prevS, curL, curS)
      $("#StkStatus").append(checkXMsg);
      if(checkXMsg.includes('cont.Up')){contUCnt = contUCnt +1}

      if(contUCnt == 6){
        $("#M2XM3").append(statustxt);
        M2XM3Count++;
      }

      curS = curM3
      prevS = prevM3
      curL = curM4
      prevL = prevM4
      checkXMsg = "<k> M3XM4 </k>"+checkX(prevL, prevS, curL, curS)
      $("#StkStatus").append(checkXMsg);
      if(checkXMsg.includes('cont.Up')){contUCnt = contUCnt +1}

      if(contUCnt == 7){
        $("#M3XM4").append(statustxt);
        M3XM4Count++;
      }
    }

    function checkX(prevL, prevS, curL, curS) {
		if (curS == curL){return "critical" }
		if (((prevL == prevS) && (curS > curL )) || ((prevL>prevS) && (curS > curL ))){return "<span class='redrose'>UpCross</span>" }
		if (((prevL == prevS) && (curS < curL )) || ((prevL<prevS) && (curS < curL ))){return "<gr>DownCross</gr>" }
		if ((prevL<prevS) && (curS > curL )){return '<span class="brownword">cont.Up</span>' } // c must > prevC, this is not correct, further check for condition
		if ((prevL>prevS) && (curS < curL )){return '<span class="limeword">cont.Dn</span>' }
	}

     function passExam(highLst, midLst, lowLst, closeLst, amtLst) {
        prevdayAmt = amtLst[amtLst.length-2] // previous day
        // console.log("prevdayAmt: ", prevdayAmt)
        // if(prevdayAmt>5000){  // to filter min amt
              // console.log("prevdayAmt in if: ", prevdayAmt)

              curlow = lowLst[lowLst.length-1]
              prevlow = lowLst[lowLst.length-2]
              lowdiff = curlow - prevlow

              curhigh = highLst[highLst.length-1]
              prevhigh = highLst[highLst.length-2]
              highdiff = curhigh - prevhigh

              curmid = midLst[midLst.length-1]
              prevmid = midLst[midLst.length-2]
              middiff = curmid - prevmid

              curclose = closeLst[closeLst.length-1]
              prevclose = closeLst[closeLst.length-2]
              closediff = curclose - prevclose

              // chk Low tup, tdn
              // chk High tup, tdn
              // chk pLWAv%, L-WAv%

              if(lowdiff>0 && highdiff>0 && middiff>0 && closediff>0 ){
                  return "pass"
              }else{
                  return "fail"
              }
          //}
     }

      function alertStat() {
        prevStat = document.getElementById("prevstatistics").innerHTML
        console.log("prevStat: ",prevStat)
        alert("check console to copy prev Stat")
      }


     function askCodetable() {
       var theCodetable = prompt("Enter stk list seperated by space:", "");
       if (theCodetable != null && theCodetable != "") {
         theCodetable = JSON.stringify(theCodetable.split(" "))
         localStorage.setItem("codetableList", theCodetable);
         codetable = JSON.parse(theCodetable);
         location.reload();
       }
     }
</script>

<script src='createTOC.js'></script>

</body>
</html>
