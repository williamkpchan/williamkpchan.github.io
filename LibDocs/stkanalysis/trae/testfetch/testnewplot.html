<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<html>

<head>
	<title>StockQ Chart</title>
	<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src='https://williamkpchan.github.io/mainscript.js'></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<style>
		#dateTime {
			text-align: left;
		}

		#cmtNote,
		#instruction,
		#message,
		#usstock {
			display: none;
		}

		select {
			border-radius: 10px;
			font-size: 20px;
			background-color: black;
			color: brown;
		}
	</style>

</head>

<body onkeypress="chkKey()">
	<center>
		<br>
		<canvas id="cvs" width="1150" height="600">[No canvas support]</canvas>
		<br>
		<p id="image"></p>
		<canvas id="acc1" width="1150" height="240">[No canvas support]</canvas>
		<canvas id="acc5" width="1150" height="240">[No canvas support]</canvas>
		<canvas id="tp" width="1150" height="240">[No canvas support]</canvas>
		<canvas id="strength50" width="1150" height="240">[No canvas support]</canvas>

		<span id="lastValues"></span>
		<br><span id="turnover"></span>
	</center>

	<div id="dateTime" style="margin-left:5%;" class="lime"> </div>
	<br>
	<pre id="instruction">
</pre>
	<pre id="commands">
commands:
d fillLineData, paste one set data to redraw with std dev
c askforCode

z large chart

R Random Charts.html
m mlineMinutechart.html

f jpforward	b jpback
r jprandom	t jpTo 0

h chgHighList	l chgLowList	m chgMidList	C chgCloseLst

a useAttentionList

i chgIntv
L askList
5 lines: data, WAve5, WAve10, sd+, sd-
A stk code sample: 000001.sh, 399001.sz
max data width: 479
</pre>
	<pre id="message">

</pre>


	<script>

		function chkKey() {
			var testkey = getChar(event);
			if (testkey == 'i') { chgIntv(); }
			if (testkey == 'w') { chgWidth(); }

			else { chkOtherKeys(testkey) }
		}
		function getChar(event) {
			if (event.which != 0 && event.charCode != 0) {
				return String.fromCharCode(event.which)   // the rest
			} else {
				return null // special key
			}
		}

		function chgIntv() {
			intv = prompt("intv1 value:", "");
			if (intv1 != "") {
				intv1 = parseInt(intv);
				initIntvSteps()
				redraw()
			}
		}

		function chgWidth() {
			dataWidth = prompt("new data width:", "");
			if (dataWidth != "") {
				dataWidth = parseInt(dataWidth);
				if (dataWidth < stkdataLength)
					startIdx = stkdataLength - dataWidth
				drawDataArr = stkpriceDataArr.slice(startIdx, endIdx);
				redraw()
			}
		}


		$("#lastValues").text("");

		// Include a function to calculate the Weighted Moving Average (WMA)
		function calcWma(data, period) {
			let wma = [];
			for (let i = period - 1; i < data.length; i++) {
				let sum = 0;
				for (let j = 0; j < period; j++) {
					sum += data[i - j] * (j + 1);
				}
				wma.push(sum / ((period * (period + 1)) / 2));
			}
			return wma;
		}

		// Function to plot the chart
		<script>
		const colors = ['white', 'yellow', 'orange', 'red', 'blue', 'green', 'purple', 'brown'];

		function plotChart(stkpriceDataArr, dataWidth, stkName) {
			try {
				if (!stkpriceDataArr || !stkpriceDataArr.length) {
					throw new Error('No price data available');
				}

				let startIdx = stkpriceDataArr.length - dataWidth;
				let drawDataArr = stkpriceDataArr.slice(startIdx);
				let chartData = {
					labels: Array(drawDataArr.length).fill(''),
					datasets: []
				};

				for (let period = 5; period <= 45; period += 5) {
					let wma = calcWma(drawDataArr, period);
					let wmaData = Array(dataWidth - wma.length).fill(null).concat(wma);
					
					chartData.datasets.push({
						label: `WMA ${period}`,
						data: wmaData,
						borderColor: colors[(period/5 - 1) % colors.length],
						fill: false
					});
				}

				let canvas = document.createElement('canvas');
				document.body.appendChild(canvas);

				let ctx = canvas.getContext('2d');
				new Chart(ctx, {
					type: 'line',
					data: chartData,
					options: {
						responsive: true,
						maintainAspectRatio: false,
						plugins: {
							title: {
								display: true,
								text: `Stock Prices and Multiple WMAs for ${stkName}`
							}
						}
					}
				});
			} catch (error) {
				console.error('Error plotting chart:', error);
			}
		}

		function diff(arr) {
			return arr.slice(1).map(function(n, i) {
				return n - arr[i];
			});
		}

		// Stock price data array
stkpriceDataArr = [27433.48,27791.44,27686.91,27976.84,27896.72,27931.02,27844.91,27778.07,27692.88,27739.73,27930.33,28308.46,28248.44,28331.92,28492.27,28653.87,28430.05,28645.66,29100.5,28292.73,28133.31,28133.31,27500.89,27940.47,27534.58,27665.64,27993.33,27995.6,28032.38,27901.98,27657.42,27147.7,27288.18,26763.13,26815.44,27173.96,27584.06,27452.66,27781.7,27816.9,27682.81,28148.64,27772.76,28303.46,28425.51,28586.9,28837.52,28679.81,28514,28494.2,28606.31,28195.42,28308.79,28210.82,28363.66,28335.57,27685.38,27463.19,26519.95,26659.11,26501.6,26925.05,27480.03,27847.66,28390.18,28323.4,29157.97,29420.92,29397.63,29080.17,29479.81,29950.44,29783.35,29438.42,29483.23,29263.48,29591.27,30046.24,29872.47,29872.47,29910.37,29638.64,29823.92,29883.79,29969.52,30218.26,30069.79,30173.88,30068.81,29999.26,30046.37,29861.55,30199.31,30154.54,30303.37,30179.05,30216.45,30015.51,30129.83,30199.87,30199.87,30403.97,30335.67,30409.56,30606.48,30223.89,30391.6,30829.4,31041.13,31097.97,31008.69,31068.69,31060.47,30991.52,30814.26,30814.26,30930.52,31188.38,31176.01,30996.98,30960,30937.04,30303.17,30603.36,29982.62,30211.91,30687.48,30723.6,31055.86,31148.24,31385.76,31375.83,31437.8,31430.7,31458.4,31522.75,31613.02,31493.34,31494.32,31521.69,31537.35,31961.86,31402.01,30932.37,31535.51,31391.52,31270.09,30924.14,31496.3,31802.44,31832.74,32297.02,32485.59,32778.64,32953.46,32825.95,33015.37,32862.3,32627.97,32731.2,32423.15,32420.06,32619.48,33072.88,33171.37,33066.96,32981.55,33153.21,33527.19,33430.24,33446.26,33503.57,33800.6,33745.4,33677.27,33730.89,34035.99,34200.67,34077.63,33821.3,34137.31,33815.9,34043.49,33981.57,33984.93,33820.38,34060.36,33874.85,34113.23,34133.03,34230.34,34548.53,34777.76,34742.82,34269.16,33587.66,34021.45,34382.13,34327.79,34060.66,33896.04,34084.15,34207.84,34393.98,34312.46,34323.05,34464.64,34529.45,34575.31,34600.38,34577.04,34756.39,34630.24,34599.82,34447.14,34466.24,34479.6,34393.75,34299.33,34033.67,33823.45,33290.08,33876.97,33945.58,33874.24,34196.82,34433.84,34283.27,34292.29,34502.51,34633.53,34786.35,34577.37,34681.79,34421.93,34870.16,34996.18,34888.79,34933.23,34987.02,34687.85,33962.04,34511.99,34798,34823.35,35061.55,35144.31,35058.52,34930.93,35084.53,34935.47,34838.16,35116.4,34792.67,35064.25,35208.51,35101.85,35264.67,35484.97,35499.85,35515.38,35625.4,35343.28,34960.69,34894.12,35120.08,35335.71,35366.26,35405.5,35213.12,35455.8,35399.84,35360.73,35312.53,35443.82,35369.09,35100,35031.07,34879.38,34607.72,34869.63,34577.57,34814.39,34751.32,34584.88,33970.47,33919.84,34258.32,34764.82,34798,34869.37,34299.99,34390.72,33843.92,34326.46,34002.92,34314.67,34416.99,34754.94,34746.25,34496.06,34378.34,34377.81,34912.56,35294.76,35258.61,35457.31,35609.34,35603.08,35677.02,35741.15,35756.88,35490.69,35730.48,35819.56,35913.84,36052.63,36157.58,36124.23,36327.95,36432.22,36319.98,36079.94,35921.23,36100.31,36087.45,36142.22,35931.05,35870.95,35601.98,35619.25,35813.8,35804.38,34899.34,35135.94,34483.72,34022.04,34639.79,34580.08,35227.03,35719.43,35754.75,35754.69,35970.99,35650.95,35544.18,35927.43,35897.64,35365.44,34932.16,35492.7,35753.89,35950.56,36302.38,36398.21,36488.63,36398.08,36338.3,36585.06,36799.65,36407.11,36236.47,36231.66,36068.87,36252.02,36290.32,36113.62,35911.81,35368.47,35028.65,34715.39,34265.37,34364.5,34297.73,34168.09,34160.78,34725.47,35131.86,35405.24,35629.33,35111.16,35089.74,35091.13,35462.78,35768.06,35241.59,34738.06,34566.17,34988.84,34934.27,34312.03,34079.18,33596.61,33131.76,33223.83,34058.75,33892.6,33294.95,33891.35,33794.66,33614.8,32817.38,32632.64,33286.25,33174.07,32944.19,32945.24,33544.34,34063.1,34480.76,34754.93,34552.99,34807.46,34358.5,34707.94,34861.24,34955.89,35294.19,35228.81,34678.35,34818.27,34921.88,34641.18,34496.51,34583.57,34721.12,34308.08,34220.36,34564.59,34451.23,34411.69,34911.2,35160.79,34792.76,33811.4,34049.46,33240.18,33301.93,33916.39,32977.21,33061.5,33128.79,34061.06,32997.97,32899.37,32245.7,32160.74,31834.11,31730.3,32196.66,32223.42,32654.59,31490.07,31253.13,31261.9,31880.24,31928.62,32120.28,32637.19,33212.96,32990.12,32813.23,33248.28,32899.7,32915.78,33180.14,32910.9,32272.79,31392.79,30516.74,30364.83,30668.53,29927.07,29888.78,30530.25,30483.13,30677.36,31500.68,31438.26,30946.99,31029.31,30775.43,31097.26,30967.82,31037.68,31384.55,31338.15,31173.84,30981.33,30772.79,30630.17,31288.26,31072.61,31827.05,31874.84,32036.9,31899.29,31990.04,31761.54,32197.59,32529.63,32845.13,32798.4,32396.17,32812.5,32726.82,32803.47,32832.54,32774.41,33309.51,33336.67,33761.05,33912.44,34152.01,33980.32,33999.04,33706.74,33063.61,32909.59,32969.23,33291.78,32283.4,32098.99,31790.87,31510.43,31656.42,31318.44,31145.3,31581.28,31774.52,32151.71,32381.34,31104.97,31135.09,30961.82,30822.42,31019.68,30706.23,30183.78,30076.68,29590.41,29260.81,29134.99,29683.74,29225.61,28725.51,29490.89,30316.32,30273.87,29926.94,29296.79,29202.88,29239.19,29210.85,30038.72,29634.83,30185.82,30523.8,30423.81,30333.59,31082.56,31499.62,31836.74,31839.11,32033.28,32861.8,32732.95,32653.2,32147.76,32001.25,32403.22,32827,33160.83,32513.94,33715.37,33747.86,33536.7,33592.92,33553.83,33546.32,33745.69,33700.28,34098.1,34194.06,34347.03,33849.46,33852.53,34589.77,34395.01,34429.88,33947.1,33596.34,33597.92,33781.48,33476.46,34005.04,34108.64,33966.35,33202.22,32920.46,32757.54,32849.74,33376.48,33027.49,33203.93,33241.56,32875.71,33220.8,33147.25,33136.37,33269.77,32930.08,33630.61,33517.65,33704.1,33973.01,34189.97,34302.61,33910.85,33296.96,33044.56,33375.49,33629.56,33733.96,33743.84,33949.41,33978.08,33717.09,34086.04,34092.96,34053.94,33926.01,33891.02,34156.69,33949.01,33699.88,33869.27,34245.93,34089.27,34128.05,33696.85,33826.69,33129.59,33045.09,33153.91,32816.92,32889.09,32656.7,32661.84,33003.57,33390.97,33431.44,32856.46,32798.4,32254.86,31909.64,31819.14,32155.4,31874.57,32246.55,31861.98,32244.58,32560.6,32030.11,32105.25,32237.53,32432.08,32394.25,32717.6,32859.03,33274.15,33601.15,33402.38,33482.72,33485.29,33586.52,33684.79,33646.5,34029.69,33886.47,33987.18,33976.63,33897.01,33786.62,33808.96,33875.4,33530.83,33301.87,33826.16,34098.16,34051.7,33684.53,33414.24,33127.74,33674.38,33618.69,33561.81,33531.33,33309.51,33300.62,33348.6,33012.14,33420.77,33535.91,33426.63,33286.58,33055.51,32799.92,32764.65,33093.34,33042.78,32908.27,33061.57,33762.76,33562.86,33573.28,33665.02,33833.61,33876.78,34066.33,34212.12,33979.33,34408.06,34299.12,34053.87,33951.52,33946.71,33727.43,33714.71,33926.74,33852.66,34122.42,34407.6,34418.47,34288.64,33922.26,33734.88,33944.4,34261.42,34347.43,34395.14,34509.03,34585.35,34951.93,35061.21,35225.18,35227.69,35411.24,35438.07,35520.12,35282.72,35459.29,35559.53,35630.68,35282.52,35215.89,35065.62,35473.13,35314.49,35123.36,35176.15,35281.4,35307.63,34946.39,34765.74,34474.83,34500.66,34463.69,34288.83,34472.98,34099.42,34346.9,34559.98,34852.67,34890.24,34721.91,34837.71,34641.97,34443.19,34500.73,34576.59,34663.72,34645.99,34575.53,34907.11,34618.24,34624.3,34517.73,34440.88,34070.42,33963.84,34006.88,33618.88,33550.27,33666.34,33507.5,33433.35,33002.38,33129.55,33119.57,33407.58,33604.65,33739.3,33804.87,33631.14,33670.29,33984.54,33997.65,33665.08,33414.17,33127.28,32936.41,33141.38,33035.93,32784.3,32417.59,32928.96,33052.87,33274.58,33839.08,34061.32,34095.86,34152.6,34112.27,33891.94,34283.1,34337.87,34827.7,34991.21,34945.47,34947.28,35151.04,35088.29,35273.03,35390.15,35333.47,35416.98,35430.42,35950.89,36245.5,36204.44,36124.56,36054.43,36117.38,36247.87,36404.93,36577.94,37090.24,37248.35,37305.16,37306.02,37557.92,37082,37404.35,37385.97,37545.33,37656.52,37710.1,37689.54,37715.04,37430.19,37440.34,37466.11,37683.01,37525.16,37695.73,37711.02,37592.98,37361.12,37266.67,37468.61,37863.8,38001.81,37905.45,37806.39,38049.13,38109.43,38333.45,38467.31,38150.3,38519.84,38654.42,38380.12,38521.36,38677.36,38726.33,38671.69,38797.38,38272.75,38424.27,38773.12,38627.99,38563.8,38612.24,39069.11,39131.53,39069.23,38972.41,38949.02,38996.39,39087.38,38989.83,38585.19,38661.05,38791.35,38722.69,38769.66,39005.49,39043.32,38905.66,38714.77,38790.43,39110.76,39512.13,39781.37,39475.9,39313.64,39282.33,39760.08,39807.37,39566.85,39170.24,39127.14,38596.98,38904.04,38892.8,38883.67,38461.51,38459.08,37983.24,37735.11,37798.97,37753.31,37775.38,37986.4,38239.98,38503.69,38460.92,38085.8,38239.66,38386.09,37815.92,37903.29,38225.66,38675.68,38852.27,38884.26,39056.39,39387.76,39512.84,39431.51,39558.11,39908,39869.38,40003.59,39806.77,39872.99,39671.04,39065.26,39069.59,38852.86,38441.54,38111.48,38686.32,38571.03,38711.29,38807.33,38886.17,38798.99,38868.04,38747.42,38712.21,38647.1,38589.16,38778.1,38834.86,39134.76,39150.33,39411.21,39112.16,39127.8,39164.06,39118.86,39169.52,39331.85,39308,39375.87,39344.79,39291.97,39721.36,39753.75,40000.9,40211.72,40954.48,41198.08,40665.02,40287.53,40415.44,40358.09,39853.87,39935.07,40589.34,40539.93,40743.33,40842.79,40347.97,39737.26,38703.27,38997.66,38763.45,39446.49,39497.54,39357.01,39765.64,40008.39,40563.06,40659.76,40896.53,40834.97,40890.49,40712.78,41175.08,41240.52,41250.5,41091.42,41335.05,41563.08,40936.93,40974.97,40755.75,40345.41,40829.59,40736.96,40861.71,41096.77,41393.78,41622.08,41606.18,41503.1,42025.19,42063.36,42124.65,42208.22,41914.75,42175.11,42313,42330.15,42156.97,42196.52,42011.59,42352.75,41954.24,42080.37,42512,42454.12,42863.86,43065.22,42740.42,43077.7,43239.05,43275.91,42931.6,42924.89,42514.95,42374.36,42114.4,42387.57,42233.05,42141.54,41763.46,42052.19,41794.6,42221.88,43729.93,43729.34,43988.99,44293.13,43910.98,43958.19,43750.86,43444.99,43389.6,43268.94,43408.47,43870.35,44296.51,44736.57,44860.31,44722.06,44910.65,44782,44705.53,45014.04,44765.71,44642.52,44401.93,44247.83,44148.56,43914.12,43828.06,43717.48,43449.9,42326.87,42342.24,42840.26,42906.95,43297.03,43325.8,42992.21,42573.73,42544.22,42392.27,42731.53,42706.56,42529.28,42635.2,41927.32,42518.28,43221.36,43153.13,43487.59,44025.81,44156.12,44565.26,44424.25,44713.76,44850.35,44713.27,44881.64,44544.66,44422.31,44556.04,44873.22,44747.7,44303.65,44470.41,44593.81,44368.68,44711.49,44546.08,44556.16,44627.46,44176.9,43428.02,43461.95,43621.34,43433.12,43240.14,43839.99,43192.04,42521.66,43006.19,42579.08,42801.72,41912.35,41432.87,41350.81,40814.12,41487.79,41841.7,41581.31,41964.63,41953.32,41985.2,42583.32,42587.5,42454.79,42299.7,41583.59,42001.39,41989.96,42225.32,40545.87,38314.86,37965.6,37645.59,40608.45,39593.66,40212.71,40524.79,40368.96,39669.39,39142.11,38170.41,39186.98,39606.57,40093.4,40113.5,40227.59,40527.62,40669.36,40752.96,41317.43,41219.14,40828.69,41113.97,41368.57,41249.38,42410.1,42140.43]

		// Initialize chart parameters
		const theStartCode = "道瓊工業";
		const dataWidth = 80;
		const stkName = "INDU";

		// Plot the chart
		plotChart(stkpriceDataArr, dataWidth, stkName);
		</script>
</body>

</html>