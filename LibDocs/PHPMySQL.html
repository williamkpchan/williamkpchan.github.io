<html>
<head>
<title>..</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script type='text/javascript' src='../mainscript.js'></script>

<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, strong,  div.title').click(function(){
    parent.history.back();
    return false;
    });
});
</script>
<style>
body{width:80%;margin-left: 10%; font-size:22px;}
strong, h1, h2 {color: gold;}
img {max-width:90%; display: inline-block; margin-top: 2%;margin-bottom: 1%; border-radius:3px;}
</style>
</head>
<body onkeypress="chkKey()">
<center><h1>PHP MySQL</h1>
<div id="toc"></div></center>
<br>
<br>
<br>
<pre>
<h2>Connecting to MySQL Database</h2>
<strong>Summary:</strong> in this tutorial, we will show you how to connect to MySQL database server using PDO object.
Before connecting to a MySQL database, you have to specify the following information:
MySQL data source name or <code>DSN</code> :  specifies the address of the MySQL database server. 
You can use IP address or server name e.g., <code>127.0.0.1</code>  or  <code>localhost</code>
MySQL database name: indicates the name of the database to which you want to connect.
Username and password: specify username and password of the MySQL&#8217;s user that you use to connect to the MySQL database server. The account must have sufficient privileges to access the database specified above.

We will use:
The local MySQL database server so the <code>DSN</code> is <code>localhost</code> .
The <code>classicmodels</code> as the 
<a title="MySQL Sample Database" href="http://www.mysqltutorial.org/mysql-sample-database.aspx">sample database</a>.
The <code>root</code> account with a blank password, just for the sake of demonstration.

<h3>Connecting to MySQL steps</h3>
First, to make it convenient, we will create a new PHP file for database configuration named  <code>dbconfig.php</code> that holds all configured parameters:

<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
</td>
<td class="crayon-code">

&lt;?php
    $host = 'localhost';
    $dbname = 'classicmodels';
    $username = 'root';
    $password = '';
</td>
</tr>
</table>
Second, we create a new PHP file named <code>phpmysqlconnect.php</code> :


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
require_once 'dbconfig.php';
 
try {
    $conn = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
    echo "Connected to $dbname at $host successfully.";
} catch (PDOException $pe) {
    die("Could not connect to the database $dbname :" . $pe-&gt;getMessage());
}
</td>
</tr>
</table>
How the script works.
We included the  <code>dbconfig.php</code> file into the script by using the  <code>require_once</code>  function.
Inside the <code>try</code> block, we created a new PDO object with three arguments: connection string, username, and password. The connection string is composed of  <code>$host</code> and <code>$dbname</code>  variables in the  <code>dbconfig.php</code> file.
If the connection to the MySQL database established successfully, we displayed a success message. If there was any errors or exceptions, PHP issued a <code>PDOException</code>  that contains the detailed error message. We call the <code>getMesage()</code>  method of the <code>PDOException</code> object to get the detailed message for display.

Third, let&#8217;s test the script from the web browser.

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/php-mysql-connect.png">
It works as expected. We&#8217;ve successfully connected to the MySQL server.
Let&#8217;s try to change something in the code to make the script display an error message. If you set the  <code>$username</code> variable to blank, you will get the following error message:

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/php-mysql-connect-error.png">
The error message shows that:
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

Access denied for user ''@'localhost' to database 'classicmodels'
</td>
</tr>
</table>
because we don&#8217;t have any blank user in the <code>classicmodels</code> database.
When the script ends, PHP automatically closes the connection to the MySQL database server. If you want to explicitly close the database connection, you need to set the PDO object to <code>null</code> as follows:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$conn = null;
</td>
</tr>
</table>
You can download the scripts of this tutorial via the following download link:

<a href="http://www.mysqltutorial.org/wp-content/uploads/2018/10/phpmysqlconnect.zip">PHP MySQL Connect</a>
In this tutorial, you&#8217;ve learned how to connect to MySQL using PHP PDO object and handle any exception that may occur when connecting the MySQL database.
<h2>Create A New Table</h2>
<strong>Summary</strong>: in this tutorial, we will show you how to use PHP to create MySQL database table by using PDO API.
The following are the steps to show you how to create a new table in a database:
Open a database connection to the MySQL database server.
Execute the 
<a title="Creating Tables Using MySQL CREATE TABLE Statement" href="http://www.mysqltutorial.org/mysql-create-table/">CREATE TABLE</a> statement to create new tables.

<h3>Create table example</h3>
We will create a new table named <code>tasks</code> in the 
<a title="MySQL Sample Database" href="http://www.mysqltutorial.org/mysql-sample-database.aspx">sample database</a> with the following SQL script:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

CREATE TABLE IF NOT EXISTS tasks (
    task_id     INT AUTO_INCREMENT PRIMARY KEY,
    subject     VARCHAR (255)        DEFAULT NULL,
    start_date  DATE                 DEFAULT NULL,
    end_date    DATE                 DEFAULT NULL,
    description VARCHAR (400)        DEFAULT NULL
);
</td>
</tr>
</table>
First, we create a class named <code>CreateTableDemo</code> that has DB configuration parameters. In the constructor of the <code>CreateTableDemo</code> class, we open a connection to the sample database by instantiating a new PDO object.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
/**
 * PHP MySQL Create Table Demo
 */
class CreateTableDemo {
 
    /**
     * database host
     */
    const DB_HOST = 'localhost';
 
    /**
     * database name
     */
    const DB_NAME = 'classicmodels';
 
    /**
     * database user
     */
    const DB_USER = 'root';
    /*
     * database password
     */
    const DB_PASSWORD = '';
 
    /**
     *
     * @var type 
     */
    private $pdo = null;
 
    /**
     * Open the database connection
     */
    public function __construct() {
        // open database connection
        $conStr = sprintf("mysql:host=%s;dbname=%s", self::DB_HOST, self::DB_NAME);
        try {
            $this-&gt;pdo = new PDO($conStr, self::DB_USER, self::DB_PASSWORD);
        } catch (PDOException $e) {
            echo $e-&gt;getMessage();
        }
    }
 
    //...
}
</td>
</tr>
</table>
Next, in the destructor of the <code>CreateTabledemo</code> class, we close the database connection by assigning it the <code>null</code> value.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

    /**
     * close the database connection
     */
    public function __destruct() {
        // close the database connection
        $this-&gt;pdo = null;
    }
</td>
</tr>
</table>
Then, define the <code>createTaskTable()</code> method to create the <code>tasks</code> table:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

    /**
     * create the tasks table
     * @return boolean returns true on success or false on failure
     */
    public function createTaskTable() {
        $sql = &lt;&lt;&lt;EOSQL
            CREATE TABLE IF NOT EXISTS tasks (
                task_id     INT AUTO_INCREMENT PRIMARY KEY,
                subject     VARCHAR (255)        DEFAULT NULL,
                start_date  DATE                 DEFAULT NULL,
                end_date    DATE                 DEFAULT NULL,
                description VARCHAR (400)        DEFAULT NULL
            );
EOSQL;
        return $this-&gt;pdo-&gt;exec($sql);
    }
</td>
</tr>
</table>
To execute an SQL statement, you call the <code>exec()</code>  method of the PDO object. After that, you can create an instance of the <code>CreateTableDemo</code> class and call the <code>createTaskTable()</code> method.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

// create the tasks table
$obj = new CreateTableDemo();
$obj-&gt;createTaskTable();
</td>
</tr>
</table>
Finally, you can check the <code>classicmodels</code> sample database to see if the <code>tasks</code> table has been created.

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/06/php-mysql-create-table.png">
<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/tasks-table.png">
You can download the PHP script file via the following link:

<a class="buttonDownload" href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/phpmysqlcreatetable.zip" target="_blank" rel="noopener">Download PHP MySQL Create Table Source Code</a>
In this tutorial, we have shown you step by step how to use PDO object to create a table in the MySQL database.

Was this tutorial helpful ?

<a data-post="2845" data-post-url="http://www.mysqltutorial.org/php-mysql-create-table/" data-post-title="Create A New Table" data-response="1" href="#" class="wth-green-btn icon-thumbs-up">Yes</a>   
<a data-response="0" data-post="2845" data-post-url="http://www.mysqltutorial.org/php-mysql-create-table/" data-post-title="Create A New Table" href="#" class="wth-red-btn icon-thumbs-down">No</a>
</ul>

<div  class='heateor_sss_sharing_container heateor_sss_horizontal_sharing' heateor-sss-data-href='http://www.mysqltutorial.org/php-mysql-create-table/'>

<ul  class="heateor_sss_sharing_ul">
<li class="heateorSssSharingRound">
<i style="width:35px;height:35px;border-radius:999px;">
<ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssFacebookSvg">
</ss>
</i>
<li class="heateorSssSharingRound">
<i style="width:35px;height:35px;border-radius:999px;">
<ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssTwitterSvg">
</ss>
</i>
<li class="heateorSssSharingRound">
<i style="width:35px;height:35px;border-radius:999px;">
<ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssRedditSvg">
</ss>
</i>



<div id="alternative_content_bottom"> 

<a class="prev-page-anchor" href="http://www.mysqltutorial.org/php-connecting-to-mysql-database/" rel="prev" title="Connecting to MySQL Database">Previous Tutorial: Connecting to MySQL Database</a>

<a class="next-page-anchor" href="http://www.mysqltutorial.org/php-querying-data-from-mysql-table/" rel="next" title="Querying Data from Database">Next Tutorial: Querying Data from Database</a>
</article>
</main>
<aside class="sidebar sidebar-primary widget-area" role="complementary" aria-label="Primary Sidebar" itemscope itemtype="https://schema.org/WPSideBar">
<section id="text-24" class="widget widget_text">

<h5>MySQL Quick Start</h5>

<ul id="menu-mysql-quick-start" class="menu">
<li id="menu-item-4209" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4209">
<a href="http://www.mysqltutorial.org/what-is-mysql/" itemprop="url">What Is MySQL?</a>
<li id="menu-item-2320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2320">
<a title="Install MySQL Database Server" href="http://www.mysqltutorial.org/install-mysql/" itemprop="url">Install MySQL Database Server</a>
<li id="menu-item-2324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2324">
<a title="Download MySQL Sample Database" href="http://www.mysqltutorial.org/mysql-sample-database.aspx" itemprop="url">Download MySQL Sample Database</a>
<li id="menu-item-2321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2321">
<a title="How to Load Sample Database into MySQL Database Server" href="http://www.mysqltutorial.org/how-to-load-sample-database-into-mysql-database-server.aspx" itemprop="url">Load Sample Database</a>
</ul>
</section>
<section id="text-23" class="widget widget_text">
<h2>Querying Data from Database</h2>
<strong>Summary</strong>
<em>: 
</em>in this tutorial, you will learn how to query data from MySQL database by using PHP PDO. You will also learn how to use PDO prepared statement to select data securely.
<em>
<br /> 
</em>
<h3>PHP MySQL Querying data using simple SELECT statement</h3>
To query data from the MySQL database, follow the steps below:
First, connect to a MySQL database. Check it out 
<a title="PHP Connecting to MySQL Database" href="http://www.mysqltutorial.org/php-connecting-to-mysql-database/">the connecting to MySQL database using PDO tutorial for detail information</a>.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
</td>
</tr>
</table>
Then, construct a 
<a title="MySQL SELECT" href="http://www.mysqltutorial.org/mysql-select-statement-query-data.aspx">SELECT statement</a> and execute it by using the <code>query()</code> method of the PDO object.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$sql = 'SELECT lastname, firstname, jobtitle 
        FROM employees
        ORDER BY lastname';
 
$q = $pdo-&gt;query($sql);
</td>
</tr>
</table>
The <code>query()</code> method of the PDO object returns a <code>PDOStatement</code> object, or <code>false</code> on failure.
Next, set the <code>PDO::FETCH_ASSOC</code> fetch mode for the <code>PDOStatement</code> object by using the <code>setFetchMode()</code> method. The <code>PDO::FETCH_ASSOC</code> mode instructs the <code>fetch()</code> method to return a result set as an array indexed by column name.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$q-&gt;setFetchMode(PDO::FETCH_ASSOC);
</td>
</tr>
</table>
After that, fetch each row from the result set until there is no row left by using the <code>fetch()</code> method of the <code>PDOStatement</code> object.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;table class="table table-bordered table-condensed"&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;First Name&lt;/th&gt;
            &lt;th&gt;Last Name&lt;/th&gt;
            &lt;th&gt;Job Title&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        &lt;?php while ($r = $q-&gt;fetch()): ?&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;?php echo htmlspecialchars($r['lastname']) ?&gt;&lt;/td&gt;
                &lt;td&gt;&lt;?php echo htmlspecialchars($r['firstname']); ?&gt;&lt;/td&gt;
                &lt;td&gt;&lt;?php echo htmlspecialchars($r['jobtitle']); ?&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;?php endwhile; ?&gt;
    &lt;/tbody&gt;
&lt;/table&gt;
</td>
</tr>
</table>
Putting it all together.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
require_once 'dbconfig.php';
 
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
 
    $sql = 'SELECT lastname,
                    firstname,
                    jobtitle
               FROM employees
              ORDER BY lastname';
 
    $q = $pdo-&gt;query($sql);
    $q-&gt;setFetchMode(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    die("Could not connect to the database $dbname :" . $e-&gt;getMessage());
}
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;PHP MySQL Query Data Demo&lt;/title&gt;
        &lt;link href="css/bootstrap.min.css" rel="stylesheet"&gt;
        &lt;link href="css/style.css" rel="stylesheet"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="container"&gt;
            &lt;h1&gt;Employees&lt;/h1&gt;
            &lt;table class="table table-bordered table-condensed"&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th&gt;First Name&lt;/th&gt;
                        &lt;th&gt;Last Name&lt;/th&gt;
                        &lt;th&gt;Job Title&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                    &lt;?php while ($row = $q-&gt;fetch()): ?&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&lt;?php echo htmlspecialchars($row['lastname']) ?&gt;&lt;/td&gt;
                            &lt;td&gt;&lt;?php echo htmlspecialchars($row['firstname']); ?&gt;&lt;/td&gt;
                            &lt;td&gt;&lt;?php echo htmlspecialchars($row['jobtitle']); ?&gt;&lt;/td&gt;
                        &lt;/tr&gt;
                    &lt;?php endwhile; ?&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
    &lt;/body&gt;
&lt;/div&gt;
&lt;/html&gt;
</td>
</tr>
</table>

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/PHP-PDO-SELECT.png">
<h3>PHP MySQL Querying data using PDO prepared statement</h3>
In practice, we often pass the argument from PHP to the SQL statement e.g., get the employee whose last name ends with <code>son</code> . To do it securely and avoid SQL injection attack, you need to use the PDO prepared statement.
Let&#8217;s take a look at the following example:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
require_once 'dbconfig.php';
 
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
 
    $sql = 'SELECT lastname,
                    firstname,
                    jobtitle
               FROM employees
              WHERE lastname LIKE ?';
 
    $q = $pdo-&gt;prepare($sql);
    $q-&gt;execute(['%son']);
    $q-&gt;setFetchMode(PDO::FETCH_ASSOC);
 
    while ($r = $q-&gt;fetch()) {
        echo sprintf('%s &lt;br/&gt;', $r['lastname']);
    }
} catch (PDOException $pe) {
    die("Could not connect to the database $dbname :" . $pe-&gt;getMessage());
}
</td>
</tr>
</table>
How the script works.
First, we use a question mark (?) in the <code>SELECT</code> statement. PDO will replace the question mark in the query by the corresponding argument. The question mark is called positional placeholder.
Next, we call the <code>prepare()</code> method of the PDO object to prepare the SQL statement for the execution.
Then, we execute the statement by calling the <code>execute()</code> method of the <code>PDOStatement</code> object. In addition, we pass an argument as an array to replace the placeholder in the <code>SELECT</code> statement. By doing this, the <code>SELECT</code> statement will be translated as follows:




<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

SELECT lastname,
       firstname,
       jobtitle
  FROM employees
 WHERE lastname LIKE '%son';
</td>
</tr>
</table>

After that, we set the fetch mode for the <code>PDOStatement</code> object.
Finally, we fetch each row of the result set and display the last name field.

PHP provides you with another way to use placeholders in the prepared statement called named placeholder. The advantages of using the named placeholder are:
More descriptive.
If the SQL statement has multiple placeholders, it is easier pass the arguments to the <code>execute()</code> method.

Let&#8217;s take a look at the following example:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
require_once 'dbconfig.php';
 
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
 
    $sql = 'SELECT lastname,
                    firstname,
                    jobtitle
               FROM employees
              WHERE lastname LIKE :lname OR 
                    firstname LIKE :fname;';
 
    // prepare statement for execution
    $q = $pdo-&gt;prepare($sql);
    
    // pass values to the query and execute it
    $q-&gt;execute([':fname' =&gt; 'Le%',
        ':lname' =&gt; '%son']);
    
    $q-&gt;setFetchMode(PDO::FETCH_ASSOC);
    
    // print out the result set
    while ($r = $q-&gt;fetch()) {
        echo sprintf('%s &lt;br/&gt;', $r['lastname']);
    }
} catch (PDOException $e) {
    die("Could not connect to the database $dbname :" . $e-&gt;getMessage());
}
</td>
</tr>
</table>
The <code>:lname</code> and <code>:fname</code> are the named placeholders. They are substituted by the corresponding argument in the associative array that we pass to the execute method.
In this tutorial, you have learned how to query data from MySQL database using PDO objects.
<h2>Insert Data Into a Table</h2>
<strong>Summary</strong>
<em>: 
</em>in this tutorial, you will learn how to use PHP PDO to insert data into a MySQL table.
We will use the <code>tasks</code> table that we created in the 
<a title="PHP MySQL Create Table" href="www.mysqltutorial.org/php-mysql-create-table/">PHP MySQL create table</a> tutorial. If you have not yet created the <code>tasks</code> table, please follow the tutorial and create it before going forward with this tutorial.
The following picture illustrates the <code>tasks</code> table:

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/tasks-table.png">
To insert data into a table, you follow the steps below:

<a title="PHP MySQL Connect" href="http://www.mysqltutorial.org/php-connecting-to-mysql-database/">Connect to the MySQL database</a> by creating a new instance of the PDO object.
Construct a 
<a title="MySQL INSERT statement" href="http://www.mysqltutorial.org/mysql-insert-statement.aspx">MySQL INSERT statement</a>.
Call <code>exec()</code>  method of the PDO object.

<h3>PHP MySQL Insert data examples</h3>
<h4>PHP MySQL: insert a new row into a table example</h4>



<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
class InsertDataDemo {
 
    const DB_HOST = 'localhost';
    const DB_NAME = 'classicmodels';
    const DB_USER = 'root';
    const DB_PASSWORD = '';
 
    private $pdo = null;
 
    /**
     * Open the database connection
     */
    public function __construct() {
        // open database connection
        $conStr = sprintf("mysql:host=%s;dbname=%s", self::DB_HOST, self::DB_NAME);
        try {
            $this-&gt;pdo = new PDO($conStr, self::DB_USER, self::DB_PASSWORD);
        } catch (PDOException $pe) {
            die($pe-&gt;getMessage());
        }
    }
//...
</td>
</tr>
</table>
The following example illustrates how to insert a new row into the <code>tasks</code> table.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

   /**
     * Insert a row into a table
     * @return
     */
    public function insert() {
        $sql = "INSERT INTO tasks (
                      subject,
                      description,
                      start_date,
                      end_date
                  )
                  VALUES (
                      'Learn PHP MySQL Insert Dat',
                      'PHP MySQL Insert data into a table',
                      '2013-01-01',
                      '2013-01-01'
                  )";
 
        return $this-&gt;pdo-&gt;exec($sql);
    }
</td>
</tr>
</table>
We defined the <code>InsertDataDemo</code> class with a constructor that establishes the database connection and a destructor that closes the database connection. Please refer to the 
<a title="PHP MySQL Create table" href="http://www.mysqltutorial.org/php-mysql/php-mysql-create-table/">PHP MySQL create table tutorial</a> for the code these methods.
Inside the <code>InsertDataDemo</code> class, we define a the insert method that calls the <code>exec()</code>  method of the PDO object  to execute the <code>INSERT</code> statement.
The following statement creates an instance of the <code>InsertDataDemo</code> class and calls the <code>insert()</code>  method to insert a new row into the tasks table.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$obj = new InsertDataDemo();
$obj-&gt;insert();
</td>
</tr>
</table>
Let&#8217;s query the data in the <code>tasks</code> table:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

SELECT *
  FROM tasks;
</td>
</tr>
</table>

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/PHP-MySQL-Insert">
<h4>PHP MySQL: insert a single row using prepared statement example</h4>
To pass values from PHP to SQL statement dynamically and securely, you use the PDO prepared statement.
First, use MySQL statement with named placeholders as follows:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$sql = 'INSERT INTO tasks (
                      subject,
                      description,
                      start_date,
                      end_date
                  )
                  VALUES (
                      :subject,
                      :description,
                      :start_date,
                      :end_date
                  );';
</td>
</tr>
</table>
The :subject, :description, :startdate and :enddate are called named placeholders.
Second, call the <code>prepare()</code>  method of the PDO object to prepare the SQL statement for the execution:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$q = $pdo-&gt;prepare($sql);
</td>
</tr>
</table>
Third, call the <code>execute()</code>  method and pass an array that contains the values which are corresponding to the named placeholders.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$q-&gt;execute($task)
</td>
</tr>
</table>
Putting it all together.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

   /**
     * Insert a new task into the tasks table
     * @param string $subject
     * @param string $description
     * @param string $startDate
     * @param string $endDate
     * @return mixed returns false on failure 
     */
    function insertSingleRow($subject, $description, $startDate, $endDate) {
        $task = array(':subject' =&gt; $subject,
            ':description' =&gt; $description,
            ':start_date' =&gt; $startDate,
            ':end_date' =&gt; $endDate);
 
        $sql = 'INSERT INTO tasks (
                      subject,
                      description,
                      start_date,
                      end_date
                  )
                  VALUES (
                      :subject,
                      :description,
                      :start_date,
                      :end_date
                  );';
 
        $q = $this-&gt;pdo-&gt;prepare($sql);
 
        return $q-&gt;execute($task);
    }
</td>
</tr>
</table>
Now we can pass the task&#8217;s data to the <code>insertSingleRow()</code> method:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$obj-&gt;insertSingleRow('MySQL PHP Insert Tutorial', 
                          'MySQL PHP Insert using prepared statement', 
                          '2013-01-01', 
                          '2013-01-02');
</td>
</tr>
</table>
Le&#8217;ts check the <code>tasks</code> table:

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/PHP-MySQL-Insert-Task-Prepared-Statement-Example-300x30.png">
<h4>PHP MySQL Insert multiple rows into a table example</h4>
There are two ways to insert multiple rows into a table:
Execute the <code>insertSingleRow()</code>  method multiple times.
Construct a MySQL <code>INSERT</code> statement that inserts multiple rows and executes it.

<h3>Download</h3>
You can download the source code of this tutorial via the following link:

<a class="buttonDownload" href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/phpmysqlinsert.zip" target="_blank" rel="noopener">Download PHP MySQL Insert Source Code</a>
In this tutorial, you have learned how to insert data into a MySQL table using PHP PDO prepared statement.
<h2>Update Data</h2>
<strong>Summary</strong>: in this tutorial, you will learn how to update data in a MySQL table using PHP PDO prepared statement.
We are going to use the <code>tasks</code> table in the 
<a title="MySQL Sample Database" href="http://www.mysqltutorial.org/mysql-sample-database.aspx">sample database </a>for practicing. If you have not yet created the <code>tasks </code>table, please follow the 
<a title="PHP MySQL Create Table Tutorial" href="http://www.mysqltutorial.org/php-mysql-create-table/">PHP MySQL create table</a> tutorial to complete it first.
The following picture illustrates the structure of the <code>tasks</code> table.

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/tasks-table.png">
To 
<a href="http://www.mysqltutorial.org/mysql-update-data.aspx">update data in a table</a>, you use the following steps:
First, 
<a href="http://www.mysqltutorial.org/php-connecting-to-mysql-database/">connect to the MySQL database</a> by creating a new PDO object.
Second, construct an 
<a title="MySQL Update data" href="http://www.mysqltutorial.org/mysql-update-data.aspx">UPDATE statement</a> to update data. If you want to pass values to the <code>UPDATE</code> statement, you use the named placeholders such as <code>:name</code>.
Third, call the <code>execute()</code>  method of the <code>PDOStatement</code> object with an array that contains the corresponding input values of the named placeholders specified in the <code>UPDATE</code> statement.

<h3>update data example</h3>
<h4>PHP MySQL &#8211; update a single row</h4>
Let&#8217;s take a look at the following <code>UpdateDataDemo</code> class.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
/**
 * PHP MySQL Update data demo
 */
class UpdateDataDemo {
 
    const DB_HOST = 'localhost';
    const DB_NAME = 'classicmodels';
    const DB_USER = 'root';
    const DB_PASSWORD = '';
 
    /**
     * PDO instance
     * @var PDO
     */
    private $pdo = null;
 
    /**
     * Open the database connection
     */
    public function __construct() {
        // open database connection
        $connStr = sprintf("mysql:host=%s;dbname=%s", self::DB_HOST, self::DB_NAME);
        try {
            $this-&gt;pdo = new PDO($connStr, self::DB_USER, self::DB_PASSWORD);
        } catch (PDOException $e) {
            die($e-&gt;getMessage());
        }
    }
 
    /**
     * Update an existing task in the tasks table
     * @param string $subject
     * @param string $description
     * @param string $startDate
     * @param string $endDate
     * @return bool return true on success or false on failure
     */
    public function update($id, $subject, $description, $startDate, $endDate) {
        $task = [
            ':taskid' =&gt; $id,
            ':subject' =&gt; $subject,
            ':description' =&gt; $description,
            ':start_date' =&gt; $startDate,
            ':end_date' =&gt; $endDate];
 
 
        $sql = 'UPDATE tasks
                    SET subject      = :subject,
                         start_date  = :start_date,
                         end_date    = :end_date,
                         description = :description
                  WHERE task_id = :taskid';
 
        $q = $this-&gt;pdo-&gt;prepare($sql);
 
        return $q-&gt;execute($task);
    }
 
    /**
     * close the database connection
     */
    public function __destruct() {
        // close the database connection
        $this-&gt;pdo = null;
    }
 
}
 
$obj = new UpdateDataDemo();
 
if ($obj-&gt;update(2, 'MySQL PHP Update Tutorial', 
                    'MySQL PHP Update using prepared statement', 
                    '2013-01-01', 
                    '2013-01-01') !== false)
    echo 'The task has been updated successfully';
else
    echo 'Error updated the task';
</td>
</tr>
</table>
How the script works.
First, connect to the database by creating a new <code>PDO</code> instance in the constructor of the <code>UpdateDataDemo</code> class.
Second, in the <code> update()</code> method, construct the <code>UPDATE</code> statement with named placeholders.
Third, use a prepared statement to prepare the <code>UPDATE</code> statement for the execution and execute it with an array argument.

you can update a row with id 2 using the following script:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$obj = new UpdateDataDemo();
 
if($obj-&gt;update(2,
 'MySQL PHP Update Tutorial',
 'MySQL PHP Update using prepared statement', 
 '2013-01-01',
 '2013-01-01') !== false)
 echo 'The task has been updated successfully';
else 
 echo 'Error updated the task';
</td>
</tr>
</table>
You can 
<a href="http://www.mysqltutorial.org/mysql-select-statement-query-data.aspx">query data</a> from the <code>tasks</code> table to verify the update:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

SELECT * 
FROM
   tasks;
</td>
</tr>
</table>

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/PHP-MySQL-update">
You can download the code via the following link:

<a class="buttonDownload" href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/phpmysqlupdate.zip" target="_blank" rel="noopener">Download PHP MySQL Update Source Code</a>
<h4>PHP MySQL &#8211; update rows in related tables</h4>
There are three ways to update rows in related tables:
Use the 
<a title="MySQL UPDATE JOIN" href="http://www.mysqltutorial.org/mysql-update-join/">MySQL UPDATE JOIN</a> statement.
Use multiple <code>UPDATE</code> statements inside a 
<a title="MySQL Transaction" href="http://www.mysqltutorial.org/mysql-transaction.aspx">transaction</a>.

We will examine the second way in the 
<a href="http://www.mysqltutorial.org/php-mysql-transaction/">PHP MySQL transaction</a> tutorial.
In this tutorial, you have learned how to update data in the MySQL table using the PHP PDO prepared statement.
<h2>Delete Data</h2>
<strong>Summary</strong>
<em>:
</em> in this tutorial, you will learn how to delete data from MySQL database table by using PHP PDO.
We will use the <code>tasks</code> table in the 
<a title="MySQL Sample Database" href="http://www.mysqltutorial.org/mysql-sample-database.aspx">sample database</a> for the demonstration. Before going forward with this tutorial, you should follow the 
<a title="PHP MySQL Create Table" href="http://www.mysqltutorial.org/php-mysql-create-table/">PHP MySQL create table tutorial</a> to create the <code>tasks</code> table and 
<a title="PHP MySQL Insert" href="http://www.mysqltutorial.org/php-insert-data-into-mysql-table/">insert sample data</a> for practicing.
See the following tasks table.

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/tasks-table.png">
To delete data in a table, you use the following steps:

<a title="Connecting to MySQL Database" href="http://www.mysqltutorial.org/php-connecting-to-mysql-database/">Connect to the MySQL database</a> by creating a new instance of the PDO object.
Construct a 
<a title="MySQL DELETE statement" href="http://www.mysqltutorial.org/mysql-delete-statement.aspx">DELETE statement </a>to delete a row, multiple rows, or all rows in a table. If you want to delete all rows in a big table quickly and more efficiently, you use the 
<a title="MySQL TRUNCATE TABLE" href="http://www.mysqltutorial.org/mysql-truncate-table/">TRUNCATE TABLE</a> statement.
Execute the <code>DELETE</code> statement by calling the <code>exec()</code>  method of the <code>PDO</code> object or the <code>execute()</code> method of the <code>PDOStatement</code> object.

<h3>PHP MySQL Delete data examples</h3>
<h4>PHP MySQL: delete a single row example</h4>
To delete a single row in a table, you use the <code>DELETE</code> statement with a 
<a title="MySQL WHERE clause" href="http://www.mysqltutorial.org/mysql-where/">WHERE clause</a> that specifies which row to delete.
The following script deletes a row with id 2 in the <code>tasks</code> table.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
/**
 * PHP MySQL Delete Data Demo
 */
class DeleteDataDemo {
 
    const DB_HOST = 'localhost';
    const DB_NAME = 'classicmodels';
    const DB_USER = 'root';
    const DB_PASSWORD = '';
 
    /**
     * PDO instance
     * @var PDO 
     */
    private $pdo = null;
 
    /**
     * Open a database connection to MySQL
     */
    public function __construct() {
        // open database connection
        $conStr = sprintf("mysql:host=%s;dbname=%s", self::DB_HOST, self::DB_NAME);
        try {
            $this-&gt;pdo = new PDO($conStr, self::DB_USER, self::DB_PASSWORD);
        } catch (PDOException $e) {
            die($e-&gt;getMessage());
        }
    }
 
    /**
     * Delete a task based on a specified task id
     * @param int $id
     * @return bool true on success or false on failure
     */
    public function delete($id) {
 
        $sql = 'DELETE FROM tasks
                WHERE task_id = :task_id';
 
        $q = $this-&gt;pdo-&gt;prepare($sql);
 
        return $q-&gt;execute([':task_id' =&gt; $id]);
    }
 
    /**
     * close the database connection
     */
    public function __destruct() {
        $this-&gt;pdo = null;
    }
 
}
 
$obj = new DeleteDataDemo();
// delete id 2
$obj-&gt;delete(2);
</td>
</tr>
</table>
How it works.
In the <code>__construct()</code>  method of the <code>DeleteDataDemo</code> class, we connect to the MySQL database by initiating an instance of the <code>PDO</code> class, and in the <code>__destruct()</code>  method, we close the database connection.
The <code>delete()</code>  method accepts the <code>id</code> as the argument. First, we call the <code>prepare()</code>  method of the <code>PDO</code> object to prepare the <code>DELETE</code> statement for execution, and then we pass an array that contains values corresponding to the named placeholders in the <code>DELETE</code> statement to the <code> execute()</code> method of the <code>PDOStatement</code> object.
To delete the task with id 2, we create an instance of the <code>DeleteDataDemo</code> class and call the <code>delete()</code> method.
<h4>PHP MySQL: delete all rows in a table examples</h4>
There are two ways to delete all rows in a table:
Issue a <code>DELETE </code>statement without a 
<a href="http://www.mysqltutorial.org/mysql-where/">WHERE clause</a>.
Issue a <code>TRUNCATE TABLE</code> statement.

The following <code> deleteAll()</code> method deletes all rows in the <code>tasks</code> table using the <code>DELETE</code> statement:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
/**
 * Delete all rows in the tasks table
 */
public function deleteAll(){
 $sql = 'DELETE FROM tasks';
 return $this-&gt;pdo-&gt;exec($sql);
}
</td>
</tr>
</table>
The following <code>truncateTable()</code> method removes all rows in the <code>tasks</code> table as well as resets its 
<a title="Auto increment column" href="http://www.mysqltutorial.org/mysql-sequence/">autoincrement</a> column&#8217;s value:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
/**
 * Truncate the tasks table
 */
public function truncateTable() {
 $sql = 'TRUNCATE TABLE tasks';
 return $this-&gt;pdo-&gt;exec($sql);
 
}
</td>
</tr>
</table>
You can download the source code of this tutorial via the following link:

<a class="buttonDownload" href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/phpmysqldelete.zip" rel="noopener">Download PHP MySQL Delete Source Code</a>
In this tutorial, we have shown you how to delete data from MySQL table using PHP PDO.
<h2>Call MySQL Stored Procedures</h2>
<strong>Summary</strong>
<em>: 
</em>in this tutorial, you will learn how to call MySQL stored procedures using PHP PDO. We will show you how to call stored procedures that return a result set and stored procedures that accept input/output parameters.
<h3>Calling stored procedures that return a result set</h3>
The steps of calling a 
<a title="MySQL Stored Procedure" href="http://www.mysqltutorial.org/mysql-stored-procedure-tutorial.aspx">MySQL stored procedure</a> that returns a result set using PHP PDO are similar to 
<a title="PHP Querying Data from MySQL Database" href="http://www.mysqltutorial.org/php-querying-data-from-mysql-table/">querying data from MySQL database table using the SELECT statement</a>. Instead of sending a <code>SELECT</code> statement to MySQL database, you send a stored procedure call statement.
First, create a stored procedure named <code>GetCustomers()</code>  in the 
<a title="MySQL Sample Database" href="http://www.mysqltutorial.org/mysql-sample-database.aspx">sample database</a> for the demonstration. The <code>GetCustomers()</code> 
<em> 
</em>stored procedure  retrieves the <code>name</code> and <code>credit limit</code>  of customers from the <code>customers</code> table.
The following <code>GetCustomers()</code> stored procedure illustrates the logic:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

DELIMITER $$
 
CREATE PROCEDURE GetCustomers()
BEGIN
 SELECT customerName, creditlimit
 FROM customers;
    END$$
</td>
</tr>
</table>
Second, create a new PHP file named  <code>phpmysqlstoredprocedure1.php</code> 
<em> 
</em>with the following code
<em>:
</em>


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;PHP MySQL Stored Procedure Demo 1&lt;/title&gt;
        &lt;link rel="stylesheet" href="css/table.css" type="text/css" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;?php
        require_once 'dbconfig.php';
        try {
            $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
            // execute the stored procedure
            $sql = 'CALL GetCustomers()';
            // call the stored procedure
            $q = $pdo-&gt;query($sql);
            $q-&gt;setFetchMode(PDO::FETCH_ASSOC);
        } catch (PDOException $e) {
            die("Error occurred:" . $e-&gt;getMessage());
        }
        ?&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;th&gt;Customer Name&lt;/th&gt;
                &lt;th&gt;Credit Limit&lt;/th&gt;
            &lt;/tr&gt;
            &lt;?php while ($r = $q-&gt;fetch()): ?&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;?php echo $r['customerName'] ?&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;?php echo '$' . number_format($r['creditlimit'], 2) ?&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;?php endwhile; ?&gt;
        &lt;/table&gt;
    &lt;/body&gt;
&lt;/html&gt;
</td>
</tr>
</table>
Everything is straightforward except the SQL query:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

CALL GetCustomers();
</td>
</tr>
</table>
We send the statement that calls the  <code>GetCustomers()</code> 
<em> 
</em>stored procedure to MySQL. And we execute the statement to get a result set.
Third, test the script in the web browser to see how it works.

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/php-mysql-stored"(max-width: 474px) 100vw, 474px" />
You can download the script via the following link:

<a class="buttonDownload" href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/phpmysqlstoredprocedure.zip" target="_blank" rel="noopener">Download PHP MySQL Stored Procedure Source Code</a>
<h3>Calling stored procedures with an OUT parameter</h3>
It is a little bit tricky to call a stored procedure with the <code>OUT</code> parameter. We will use the <code>GetCustomerLevel()</code>  stored procedure that accepts a customer number as an input parameter and returns the customer level based on credit limit.
Check the 
<a title="MySQL IF Statement" href="http://www.mysqltutorial.org/mysql-if-statement/">MySQL IF statement tutorial</a> for detailed information on the <code>GetCustomerLevel()</code>  stored procedure.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

DELIMITER $$
 
CREATE PROCEDURE GetCustomerLevel(
    in  p_customerNumber int(11), 
    out p_customerLevel  varchar(10))
BEGIN
    DECLARE creditlim double;
 
    SELECT creditlimit INTO creditlim
    FROM customers
    WHERE customerNumber = p_customerNumber;
 
    IF creditlim &gt; 50000 THEN
    SET p_customerLevel = 'PLATINUM';
    ELSEIF (creditlim &lt;= 50000 AND creditlim &gt;= 10000) THEN
        SET p_customerLevel = 'GOLD';
    ELSEIF creditlim &lt; 10000 THEN
        SET p_customerLevel = 'SILVER';
    END IF;
 
END$$
</td>
</tr>
</table>
In MySQL, we can call the <code>GetCustomerLevel()</code>  stored procedure as follows:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

CALL GetCustomerLevel(103,@level);
SELECT @level AS level;
</td>
</tr>
</table>
In PHP, we have to emulate those statements:
First, we need to execute the <code>GetCustomerLevel()</code>  stored procedure.
Second, to get the customer level, we need to query it from the variable <code>@level</code> . It is important that we must call the method <code>closeCursor()</code>  of the <code>PDOStatement</code>  object in order to execute the next SQL statement.

Let&#8217;s take a look at how the logic is implemented in the following PHP script:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
require_once 'dbconfig.php';
 
/**
 * Get customer level
 * @param int $customerNumber
 * @return string
 */
function getCustomerLevel(int $customerNumber) {
    try {
        $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
 
        // calling stored procedure command
        $sql = 'CALL GetCustomerLevel(:id,@level)';
 
        // prepare for execution of the stored procedure
        $stmt = $pdo-&gt;prepare($sql);
 
        // pass value to the command
        $stmt-&gt;bindParam(':id', $customerNumber, PDO::PARAM_INT);
 
        // execute the stored procedure
        $stmt-&gt;execute();
 
        $stmt-&gt;closeCursor();
 
        // execute the second query to get customer's level
        $row = $pdo-&gt;query("SELECT @level AS level")-&gt;fetch(PDO::FETCH_ASSOC);
        if ($row) {
            return $row !== false ? $row['level'] : null;
        }
    } catch (PDOException $e) {
        die("Error occurred:" . $e-&gt;getMessage());
    }
    return null;
}
 
$customerNo = 103;
echo sprintf('Customer #%d is %s', $customerNo, getCustomerLevel($customerNo));
</td>
</tr>
</table>
If you test the script in the web browser, you will see the following screenshot:

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/01/php-mysql-stored"/php-mysql-stored-procedure-OUT-parameter-300x97.png 300w" sizes="(max-width: 483px) 100vw, 483px" />
You can download the script via the following link:

<a class="buttonDownload" href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/phpmysqlstoredprocedureoutparam.zip" target="_blank" rel="noopener">Download PHP MySQL Stored Procedure with the OUT Parameter Source Code</a>
In this tutorial, you have learned how to call MySQL stored procedures using PHP PDO.
<h2>PHP MySQL Transaction</h2>
<strong>Summary</strong>: in this tutorial, you will learn how to handle MySQL transaction in PHP to ensure data integrity of the database.

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/06/PHP-MySQL-Transaction.gif">A 
<a href="http://www.mysqltutorial.org/mysql-transaction.aspx">transaction</a> is a set of inter-dependent SQL statements that needs to execute in all-or-nothing mode. A transaction is successful if all SQL statements executed successfully. A failure of any statement will trigger the system to rollback to the original state to avoid data inconsistency.
A classic example of the transaction is a money transfer transaction from one bank account to another. It requires three steps:
Check the balance of the transferred account to see if the amount is sufficient for the transfer.
If the amount is sufficient, deduct the amount from the balance of the transferred account.
Add the transfer amount to the balance of the receiving account.

If an error occurs in the second step, the third step should not continue. In addition, if an error occurs in the third step, the second step must be reversed. The amounts of both bank accounts are intact in case of failure or adjusted correctly if the transaction is completed successfully.
<h3>MySQL transaction in PHP</h3>
When you use PDO to 
<a title="PHP MySQL Connect" href="http://www.mysqltutorial.org/php-connecting-to-mysql-database/">create a connection to the database</a> that supports the transaction, the auto-commit mode is set. It means that every query you issue is wrapped inside an implicit transaction.
Notice that not all 
<a title="MySQL Storage Engines" href="http://www.mysqltutorial.org/understand-mysql-table-types-innodb-myisam.aspx">storage engines</a> in MySQL support transaction e.g., MyISAM does not support the transaction, however, InnoDB does.
To handle MySQL transaction in PHP, you use the following steps:
<ol>
Start the transaction by calling the <code>beginTransaction()</code> method of the PDO object.
Place the SQL statements and the  <code>commit()</code> method call in a <code>try</code> block.
Rollback the transaction in the <code>catch</code> block by calling the <code>rollBack()</code> method of the PDO object.
</ol>
<h3>PHP MySQL transaction example</h3>
We will 
<a title="MySQLCreate Table" href="http://www.mysqltutorial.org/mysql-create-table/">create a table</a> named <code>accounts</code> to demonstrate the money transfer between two bank accounts.
First, execute the following statement to create the <code>accounts</code> table:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

CREATE TABLE accounts (
    id     INT AUTO_INCREMENT PRIMARY KEY,
    name   VARCHAR (50)    NOT NULL,
    amount DECIMAL (19, 4) NOT NULL
);
</td>
</tr>
</table>
Second, 
<a title="MySQL INSERT statement" href="http://www.mysqltutorial.org/mysql-insert-statement.aspx">insert </a>two rows into the <code>accounts</code> table:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

INSERT INTO accounts(name,amount)
VALUES('John',25000),
      ('Mary',95000);
</td>
</tr>
</table>
Third, 
<a title="MySQL query data" href="http://www.mysqltutorial.org/mysql-select-statement-query-data.aspx">query </a>the <code>accounts</code> table:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

SELECT *
  FROM accounts;
</td>
</tr>
</table>

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/06/PHP-MySQL-Transaction-example.png">
Let&#8217;s take a look at the following <code>TransactionDemo</code> class:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
/**
 * PHP MySQL Transaction Demo
 */
class TransactionDemo {
 
    const DB_HOST = 'localhost';
    const DB_NAME = 'classicmodels';
    const DB_USER = 'root';
    const DB_PASSWORD = '';
 
    /**
     * Open the database connection
     */
    public function __construct() {
        // open database connection
        $conStr = sprintf("mysql:host=%s;dbname=%s", self::DB_HOST, self::DB_NAME);
        try {
            $this-&gt;pdo = new PDO($conStr, self::DB_USER, self::DB_PASSWORD);
        } catch (PDOException $e) {
            die($e-&gt;getMessage());
        }
    }
 
    /**
     * PDO instance
     * @var PDO 
     */
    private $pdo = null;
 
    /**
     * Transfer money between two accounts
     * @param int $from
     * @param int $to
     * @param float $amount
     * @return true on success or false on failure.
     */
    public function transfer($from, $to, $amount) {
 
        try {
            $this-&gt;pdo-&gt;beginTransaction();
 
            // get available amount of the transferer account
            $sql = 'SELECT amount FROM accounts WHERE id=:from';
            $stmt = $this-&gt;pdo-&gt;prepare($sql);
            $stmt-&gt;execute(array(":from" =&gt; $from));
            $availableAmount = (int) $stmt-&gt;fetchColumn();
            $stmt-&gt;closeCursor();
 
            if ($availableAmount &lt; $amount) {
                echo 'Insufficient amount to transfer';
                return false;
            }
            // deduct from the transferred account
            $sql_update_from = 'UPDATE accounts
 SET amount = amount - :amount
 WHERE id = :from';
            $stmt = $this-&gt;pdo-&gt;prepare($sql_update_from);
            $stmt-&gt;execute(array(":from" =&gt; $from, ":amount" =&gt; $amount));
            $stmt-&gt;closeCursor();
 
            // add to the receiving account
            $sql_update_to = 'UPDATE accounts
                                SET amount = amount + :amount
                                WHERE id = :to';
            $stmt = $this-&gt;pdo-&gt;prepare($sql_update_to);
            $stmt-&gt;execute(array(":to" =&gt; $to, ":amount" =&gt; $amount));
 
            // commit the transaction
            $this-&gt;pdo-&gt;commit();
 
            echo 'The amount has been transferred successfully';
 
            return true;
        } catch (PDOException $e) {
            $this-&gt;pdo-&gt;rollBack();
            die($e-&gt;getMessage());
        }
    }
 
    /**
     * close the database connection
     */
    public function __destruct() {
        // close the database connection
        $this-&gt;pdo = null;
    }
 
}
 
// test the transfer method
$obj = new TransactionDemo();
 
// transfer 30K from from account 1 to 2
$obj-&gt;transfer(1, 2, 30000);
 
 
// transfer 5K from from account 1 to 2
$obj-&gt;transfer(1, 2, 5000);
</td>
</tr>
</table>
We 
<a title="PHP Connecting to MySQL Database" href="http://www.mysqltutorial.org/php-connecting-to-mysql-database/">open a database connection</a> in the <code> __construct()</code> method and close it in the <code>__destruct()</code> method. In the <code>transfer()</code> method:
First, we query <code>amount</code> of the transferred account and compare it with the transfer amount to check if the balance of the transferred account is sufficient.
Second, in case the amount is sufficient, we deduct the transfer amount from the transferred account and add it to the receiving account.
Third, we commit the transaction by calling the <code>commit()</code> method. If any error occurs, we call the <code>rollBack()</code> method in the <code>catch</code> block to rollback the transaction.

Let&#8217;s test the <code>transfer()</code> method.


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

// transfer 30K from from account 1 to 2
$obj-&gt;transfer(1, 2, 30000);
</td>
</tr>
</table>
We transferred 30K from John&#8217;s account to Mary&#8217;s. We got the following message:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

Insufficient amount to transfer
</td>
</tr>
</table>
Let&#8217;s make another transfer:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

// transfer 5K from from account 1 to 2
$obj-&gt;transfer(1, 2, 5000);
</td>
</tr>
</table>
The script returns the following message:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

The amount has been transferred successfully.
</td>
</tr>
</table>
We have transferred money between two bank accounts successfully.
You can download the source code via the following link:

<a class="buttonDownload" href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/phpmysqltransaction.zip" target="_blank" rel="noopener">Download PHP MySQL Transaction Source Code</a>
In this tutorial, we have shown you step by step how to handle MySQL transactions in PHP to ensure data integrity.
<h2>PHP MySQL BLOB</h2>
<strong>Summary</strong>: in this tutorial, you will learn how to handle BLOB data using PHP PDO. We will show you how to insert, update and select BLOB data in MySQL databases.

Sometimes, for the security reasons, you may need to store large data objects e.g., images, PDF files, and videos in the MySQL database.
MySQL provides a BLOB type that can hold a large amount of data. BLOB stands for the binary large data object. The maximum value of a BLOB object is specified by the available memory and the communication package size. You can change the communication package size by using the  <code>max_allowed_packet</code> variable in MySQL and  <code>post_max_size</code> in the PHP settings.
Let&#8217;s see how PHP PDO handles the BLOB type in MySQL.
First, we 
<a href="http://www.mysqltutorial.org/mysql-create-table/">create a new table</a> named <code>files</code> in the 
<a title="MySQL Sample Database" href="http://www.mysqltutorial.org/mysql-sample-database.aspx">sample database</a> for practicing.
The <code>files</code> table contains three columns:
The id column is the 
<a href="http://www.mysqltutorial.org/mysql-primary-key/">primary key</a>, 
<a href="http://www.mysqltutorial.org/mysql-sequence/">auto-increment</a> column.
The mime column stores the mime type of the file.
The data column whose data type is the BLOB that is used to store the content of the file.

The following 
<a href="http://www.mysqltutorial.org/mysql-create-table/">CREATE TABLE</a> statement creates the <code>files</code> table:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

CREATE TABLE files (
    id   INT           AUTO_INCREMENT PRIMARY KEY,
    mime VARCHAR (255) NOT NULL,
    data BLOB          NOT NULL
);
</td>
</tr>
</table>
Second, we define a class called <code>BlobDemo</code> with the following code:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

&lt;?php
 
/**
 * PHP MySQL BLOB Demo
 */
class BobDemo {
 
    const DB_HOST = 'localhost';
    const DB_NAME = 'classicmodels';
    const DB_USER = 'root';
    const DB_PASSWORD = '';
 
    /**
     * Open the database connection
     */
    public function __construct() {
        // open database connection
        $conStr = sprintf("mysql:host=%s;dbname=%s;charset=utf8", self::DB_HOST, self::DB_NAME);
 
        try {
            $this-&gt;pdo = new PDO($conStr, self::DB_USER, self::DB_PASSWORD);
            //for prior PHP 5.3.6
            //$conn-&gt;exec("set names utf8");
        } catch (PDOException $e) {
            echo $e-&gt;getMessage();
        }
    }
 
    /**
     * close the database connection
     */
    public function __destruct() {
        // close the database connection
        $this-&gt;pdo = null;
    }
 
}
</td>
</tr>
</table>
In the <code> __construct()</code> method, we 
<a href="http://www.mysqltutorial.org/php-connecting-to-mysql-database/">open a database connection to the MySQL database</a>, and in the  <code>__destruct()</code> method, we close the connection.
<h3>Insert BLOB data into the database</h3>
PHP PDO provides a convenient way to work with BLOB data using the streams and prepare statements. To insert the content of a file into a BLOB column, you follow the steps below:
First, open the file for reading in binary mode.
Second, construct an 
<a title="MySQL INSERT" href="http://www.mysqltutorial.org/mysql-insert-statement.aspx">INSERT statement</a>.
Third, bind the file handle to the prepared statement using the  <code>bindParam()</code> method and call the  <code>execute()</code> method to execute the query.

See the following  <code>insertBlob()</code> method:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

   /**
     * insert blob into the files table
     * @param string $filePath
     * @param string $mime mimetype
     * @return bool
     */
    public function insertBlob($filePath, $mime) {
        $blob = fopen($filePath, 'rb');
 
        $sql = "INSERT INTO files(mime,data) VALUES(:mime,:data)";
        $stmt = $this-&gt;pdo-&gt;prepare($sql);
 
        $stmt-&gt;bindParam(':mime', $mime);
        $stmt-&gt;bindParam(':data', $blob, PDO::PARAM_LOB);
 
        return $stmt-&gt;execute();
    }
</td>
</tr>
</table>
Notice that the <code>PDO::PARAM_LOB</code> instructs PDO to map the data as a stream.
<h3>Update an existing BLOB column</h3>
To update a BLOB column, you use the same technique as described in the inserting data into a BLOB column. See the following  <code>updateBlob()</code> method:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

   /**
     * update the files table with the new blob from the file specified
     * by the filepath
     * @param int $id
     * @param string $filePath
     * @param string $mime
     * @return bool
     */
    function updateBlob($id, $filePath, $mime) {
 
        $blob = fopen($filePath, 'rb');
 
        $sql = "UPDATE files
                SET mime = :mime,
                    data = :data
                WHERE id = :id;";
 
        $stmt = $this-&gt;pdo-&gt;prepare($sql);
 
        $stmt-&gt;bindParam(':mime', $mime);
        $stmt-&gt;bindParam(':data', $blob, PDO::PARAM_LOB);
        $stmt-&gt;bindParam(':id', $id);
 
        return $stmt-&gt;execute();
    }
</td>
</tr>
</table>

<h3>Query data from BLOB column</h3>
The following steps describe how to select data from a BLOB column:
First, construct a 
<a title="MySQL SELECT statement" href="http://www.mysqltutorial.org/mysql-select-statement-query-data.aspx">SELECT statement</a>.
Second, bind the corresponding parameter using the  <code>bindColumn()</code> method of the <code>PDOStatement</code> object.
Third, execute the statement.

See the following  <code>selectBlob()</code> method:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

    /**
     * select data from the the files
     * @param int $id
     * @return array contains mime type and BLOB data
     */
    public function selectBlob($id) {
 
        $sql = "SELECT mime,
                        data
                   FROM files
                  WHERE id = :id;";
 
        $stmt = $this-&gt;pdo-&gt;prepare($sql);
        $stmt-&gt;execute(array(":id" =&gt; $id));
        $stmt-&gt;bindColumn(1, $mime);
        $stmt-&gt;bindColumn(2, $data, PDO::PARAM_LOB);
 
        $stmt-&gt;fetch(PDO::FETCH_BOUND);
 
        return array("mime" =&gt; $mime,
            "data" =&gt; $data);
    }
</td>
</tr>
</table>

<h3>PHP MySQL BLOB examples</h3>
In the following examples, we will use the <code>BlobDemo</code> class to save a GIF image and a PDF file into the BLOB column of the <code>files</code> table.
<h4>PHP MySQL BLOB with image files</h4>
First, we insert binary data from the <code>images/php-mysql-blob.gif</code> file into the BLOB column of the <code>files</code> table as follows:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$blobObj = new BlobDemo();
 
// test insert gif image
$blobObj-&gt;insertBlob('images/php-mysql-blob.gif',"image/gif");
</td>
</tr>
</table>

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/06/php-mysql-blob-gif-example.png">
Then, we can select the BLOB data and display it as a GIF image:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$a = $blobObj-&gt;selectBlob(1);
header("Content-Type:" . $a['mime']);
echo $a['data'];
</td>
</tr>
</table>

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/06/php-mysql-blob" sizes="(max-width: 397px) 100vw, 397px" />
<h4>PHP MySQL BLOB with PDF files</h4>
The following code inserts the content of the  <code>pdf/php-mysql-blob.pdf</code> PDF file into the BLOB column:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$blobObj = new BlobDemo();
 
// test insert pdf
$blobObj-&gt;insertBlob('pdf/php-mysql-blob.pdf',"application/pdf");
</td>
</tr>
</table>

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/06/php-mysql-blob-pdf-example.png">
Then, we can select the PDF data and render it in the web browser as follows:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$a = $blobObj-&gt;selectBlob(2);
header("Content-Type:" . $a['mime']);
echo $a['data'];
</td>
</tr>
</table>

<img src="http://www.mysqltutorial.org/wp-content/uploads/2013/06/php-mysql-blob" 442px) 100vw, 442px" />
To replace the PDF file with the GIF image file, you use the  <code>updateBlob()</code> method as follows:


<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">

</td>
<td class="crayon-code">

$blobObj-&gt;updateBlob(2, 'images/php-mysql-blob.gif', "image/gif");
 
$a = $blobObj-&gt;selectBlob(2);
header("Content-Type:" . $a['mime']);
echo $a['data'];
</td>
</tr>
</table>
You can download the source code of this tutorial via the following link:

<a class="buttonDownload" href="http://www.mysqltutorial.org/wp-content/uploads/2018/03/phpmysqlblob.zip" target="_blank" rel="noopener">Download PHP MySQL BLOB Source Code</a>
In this tutorial, we have shown you how to manage MySQL BLOB data including inserting, updating, and querying blob.

Was this tutorial helpful ?

<a data-post="2905" data-post-url="http://www.mysqltutorial.org/php-mysql-blob/" data-post-title="PHP MySQL BLOB" data-response="1" href="#" class="wth-green-btn icon-thumbs-up">Yes</a>   
<a data-response="0" data-post="2905" data-post-url="http://www.mysqltutorial.org/php-mysql-blob/" data-post-title="PHP MySQL BLOB" href="#" class="wth-red-btn icon-thumbs-down">No</a>
</ul>

<div  class='heateor_sss_sharing_container heateor_sss_horizontal_sharing' heateor-sss-data-href='http://www.mysqltutorial.org/php-mysql-blob/'>

<ul  class="heateor_sss_sharing_ul">
<li class="heateorSssSharingRound">
<i style="width:35px;height:35px;border-radius:999px;">
<ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssFacebookSvg">
</ss>
</i>
<li class="heateorSssSharingRound">
<i style="width:35px;height:35px;border-radius:999px;">
<ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssTwitterSvg">
</ss>
</i>
<li class="heateorSssSharingRound">
<i style="width:35px;height:35px;border-radius:999px;">
<ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssRedditSvg">
</ss>
</i>



<div id="alternative_content_bottom"> 

<a class="prev-page-anchor" href="http://www.mysqltutorial.org/php-mysql-transaction/" rel="prev" title="PHP MySQL Transaction">Previous Tutorial: PHP MySQL Transaction</a>

</article>
</main>
<aside class="sidebar sidebar-primary widget-area" role="complementary" aria-label="Primary Sidebar" itemscope itemtype="https://schema.org/WPSideBar">
<section id="text-24" class="widget widget_text">

<h5>MySQL Quick Start</h5>

<ul id="menu-mysql-quick-start" class="menu">
<li id="menu-item-4209" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4209">
<a href="http://www.mysqltutorial.org/what-is-mysql/" itemprop="url">What Is MySQL?</a>
<li id="menu-item-2320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2320">
<a title="Install MySQL Database Server" href="http://www.mysqltutorial.org/install-mysql/" itemprop="url">Install MySQL Database Server</a>
<li id="menu-item-2324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2324">
<a title="Download MySQL Sample Database" href="http://www.mysqltutorial.org/mysql-sample-database.aspx" itemprop="url">Download MySQL Sample Database</a>
<li id="menu-item-2321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2321">
<a title="How to Load Sample Database into MySQL Database Server" href="http://www.mysqltutorial.org/how-to-load-sample-database-into-mysql-database-server.aspx" itemprop="url">Load Sample Database</a>
</ul>
<br>
<br>
<br>
<br>

<script>
	var toc = $('#toc');
	$('h2').each(function(i) {
		var topic = $(this), topicNumber = i + 1;
		toc.append('<a href="#topic-'+topicNumber+'" target="_self">'+topic.text()+'</a><br>');
		topic.attr('id', 'topic-' + topicNumber);
	});
</script>

</body>
</html>
