<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<html>
<head>
<title>daily chart</title>
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src='https://williamkpchan.github.io/mainscript.js'></script>
<script src="https://williamkpchan.github.io/LibDocs/stkComments.js"></script>
<script src="https://williamkpchanhp.github.io/filterResulitLib.txt"></script>
<script src="https://code.jquery.com/mobile/1.5.0-alpha.1/jquery.mobile-1.5.0-alpha.1.min.js"></script>

<script src="https://williamkpchanhp.github.io/LibDocs/longHistList.js"></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.common.core.js" ></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.line.js"></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.drawing.yaxis.js"></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.common.dynamic.js"></script>
<script src="https://williamkpchan.github.io/LibDocs/rchart/RGraph.common.tooltips.js"></script>
<script src="https://williamkpchanhp.github.io/codeList.js"></script>

<style>
#dateTime {  text-align: left;}
#cmtNote, #instruction, #message, #usstock{display:none;}
#amtLst {font-size:14px;}
select {border-radius:10px; font-size:20px;background-color:black; color:brown;}
</style>

</head>
<body onkeypress="chkKey()">
<center>
<br>
<canvas id="cvs" width="1150" height="600">[No canvas support]</canvas>
<br>
<canvas id="accel" width="1150" height="240">[No canvas support]</canvas>
<br>
<canvas id="accaccel" width="1150" height="240">[No canvas support]</canvas>
<br>
K线图日数与趋势图不同
<p id="amtLst"></p>
<p id="image"></p>
<canvas id="TP" width="1150" height="240">[No canvas support]</canvas>
<canvas id="强弱50" width="1150" height="240">[No canvas support]</canvas>

<span id="lastValues"></span>
<br><span id="turnover"></span>
</center>

<div id="dateTime" style="margin-left:5%;" class="lime"> </div>
<span onclick="$('#instruction').toggle();"> 🎌 </span>
<a href="AStkList.txt" class="whitebut" target="_blank">A股清单</a>

<a href="http://www.etnet.com.hk/www/tc/stocks/industry_adu.php" target="_blank" class="bordred1">行業板塊</a>
<a href="http://www.etnet.com.hk/www/tc/stocks/indexes_detail.php?subtype=HSI" target="_blank" class="bordred1">指數成分股表現</a>
<a href="http://www.etnet.com.hk/www/tc/stocks/ah.php" target="_blank" class="bordred1">AH股表現</a>
<select id="selectList" onchange="assignList()"></select>
<span onclick="$('#message').toggle();"> 🎌 </span>
<pre id="filterMarkers"></pre>

<br>
<pre id="instruction">
</pre>
<pre id="commands">
commands:
d fillLineData, paste one set data to redraw with std dev
c askforCode

z large chart

R Random Charts.html
m mlineMinutechart.html

f jpforward	b jpback
r jprandom	t jpTo 0

h chgHighList	l chgLowList	m chgMidList	C chgCloseLst

a useAttentionList

i chgIntv
L askList
5 lines: data, WAve5, WAve10, sd+, sd-
A stk code sample: 000001.sh, 399001.sz
chartColor: red green orange blue #900 #a00 #b0f #c00 #d0a gray purple yellow white
white is ma of startIntv line
purple yellow is sd
green is half startIntv
orange ia p1
note startIntv at 4 buy at red ux orange, sell at red dx green
002340 002276 600025 300548 002429 002615 688660
</pre>
<pre id="message">

</pre>
<span onclick="$('#usstock').toggle();">usstock 🎌 </span>
<pre id="usstock">
<b onclick='fetchUsCode("usTCEHY.PS")'>usTCEHY.PS 腾信</b> . <b onclick='fetchUsCode("usPEP.OQ")'>usPEP.OQ 百事可乐</b> . <b onclick='fetchUsCode("usORCL.N")'>usORCL.N 甲骨文</b> . <b onclick='fetchUsCode("usOIL.AM")'>usOIL.AM 标普高盛原油指数ETN</b> . <b onclick='fetchUsCode("usNVS.N")'>usNVS.N 诺华制药</b> . <b onclick='fetchUsCode("usNVFY.OQ")'>usNVFY.OQ 诺华家具</b> . <b onclick='fetchUsCode("usNVDA.OQ")'>usNVDA.OQ 英伟达</b> . <b onclick='fetchUsCode("usNTES.OQ")'>usNTES.OQ 网易</b> . <b onclick='fetchUsCode("usNTAP.OQ")'>usNTAP.OQ 美国网存</b> . <b onclick='fetchUsCode("usNKE.N")'>usNKE.N 耐克</b> . <b onclick='fetchUsCode("usNFLX.OQ")'>usNFLX.OQ 奈飞</b> . <b onclick='fetchUsCode("usMSFT.OQ")'>usMSFT.OQ 微软</b> . <b onclick='fetchUsCode("usMS.N")'>usMS.N 摩根士丹利</b> . <b onclick='fetchUsCode("usMPNGY.PS")'>usMPNGY.PS 美团</b> . <b onclick='fetchUsCode("usMET.N")'>usMET.N 大都会人寿</b> . <b onclick='fetchUsCode("usMBLY.OQ")'>usMBLY.OQ Mobileye Global Inc</b> . <b onclick='fetchUsCode("usMAT.OQ")'>usMAT.OQ 美泰</b> . <b onclick='fetchUsCode("usLRCX.OQ")'>usLRCX.OQ 拉姆研究</b> . <b onclick='fetchUsCode("usLMT.N")'>usLMT.N 洛克希德马丁</b> . <b onclick='fetchUsCode("usKWEB.AM")'>usKWEB.AM 中国海外互联网ETF</b> . <b onclick='fetchUsCode("usJT.N")'>usJT.N 简普科技</b> . <b onclick='fetchUsCode("usJNJ.N")'>usJNJ.N 强生</b> . <b onclick='fetchUsCode("usIRBT.OQ")'>usIRBT.OQ Irobot Corp</b> . <b onclick='fetchUsCode("usINTU.OQ")'>usINTU.OQ 财捷</b> . <b onclick='fetchUsCode("usINTC.OQ")'>usINTC.OQ 英特尔</b> . <b onclick='fetchUsCode("usILMN.OQ")'>usILMN.OQ Illumina Inc</b> . <b onclick='fetchUsCode("usHUYA.N")'>usHUYA.N 虎牙</b> . <b onclick='fetchUsCode("usH.N")'>usH.N 凯悦酒店</b> . <b onclick='fetchUsCode("usGRPN.OQ")'>usGRPN.OQ Groupon Inc</b> . <b onclick='fetchUsCode("usGOGO.OQ")'>usGOGO.OQ Gogo Inc</b> . <b onclick='fetchUsCode("usGLW.N")'>usGLW.N 康宁</b> . <b onclick='fetchUsCode("usGHG.N")'>usGHG.N 格林酒店</b> . <b onclick='fetchUsCode("usGDS.OQ")'>usGDS.OQ 万国数据</b> . <b onclick='fetchUsCode("usGDOT.N")'>usGDOT.N Green Dot Corp</b> . <b onclick='fetchUsCode("usGD.N")'>usGD.N 通用动力</b> . <b onclick='fetchUsCode("usFTNT.OQ")'>usFTNT.OQ 飞塔信息</b> . <b onclick='fetchUsCode("usFEDU.N")'>usFEDU.N 四季教育</b> . <b onclick='fetchUsCode("usFDX.N")'>usFDX.N 联邦快递</b> . <b onclick='fetchUsCode("usFANH.OQ")'>usFANH.OQ 泛华控股集团</b> . <b onclick='fetchUsCode("usFAMI.OQ")'>usFAMI.OQ 农米良品</b> . <b onclick='fetchUsCode("usETR.N")'>usETR.N 安特吉</b> . <b onclick='fetchUsCode("usZTO.N")'>usZTO.N 中通快递</b> . <b onclick='fetchUsCode("usZKIN.OQ")'>usZKIN.OQ 正康国际</b> . <b onclick='fetchUsCode("usYUMC.N")'>usYUMC.N 百胜中国</b> . <b onclick='fetchUsCode("usYELP.N")'>usYELP.N Yelp</b> . <b onclick='fetchUsCode("usYECO.PS")'>usYECO.PS 玉龙生态材料</b> . <b onclick='fetchUsCode("usXIACY.PS")'>usXIACY.PS 小米集团</b> . <b onclick='fetchUsCode("usX.N")'>usX.N 美国钢铁</b> . <b onclick='fetchUsCode("usWDC.OQ")'>usWDC.OQ 西部数据</b> . <b onclick='fetchUsCode("usWDAY.OQ")'>usWDAY.OQ Workday</b> . <b onclick='fetchUsCode("usWBA.OQ")'>usWBA.OQ 沃尔格林-联合博姿</b> . <b onclick='fetchUsCode("usVXZ.AM")'>usVXZ.AM 恐慌中期做多ETN-iPath S</b> . <b onclick='fetchUsCode("usVXX.AM")'>usVXX.AM 短期VIX指数期货ETN</b> . <b onclick='fetchUsCode("usVMW.N")'>usVMW.N 威睿</b> . <b onclick='fetchUsCode("usV.N")'>usV.N Visa</b> . <b onclick='fetchUsCode("usUSNA.N")'>usUSNA.N 优莎娜</b> . <b onclick='fetchUsCode("usUNH.N")'>usUNH.N 联合健康</b> . <b onclick='fetchUsCode("usUNG.AM")'>usUNG.AM 美国即月天然气ETF</b> . <b onclick='fetchUsCode("usTXN.OQ")'>usTXN.OQ 德州仪器</b> . <b onclick='fetchUsCode("usTRIP.OQ")'>usTRIP.OQ 猫途鹰</b> . <b onclick='fetchUsCode("usTME.N")'>usTME.N 腾讯音乐</b> . <b onclick='fetchUsCode("usTKAT.AM")'>usTKAT.AM 大公文交所</b> . <b onclick='fetchUsCode("usTGT.N")'>usTGT.N 塔吉特</b> . <b onclick='fetchUsCode("usTER.OQ")'>usTER.OQ 泰瑞达</b> . <b onclick='fetchUsCode("usSSYS.OQ")'>usSSYS.OQ Stratasys</b> . <b onclick='fetchUsCode("usSPWR.OQ")'>usSPWR.OQ Sunpower Corp</b> . <b onclick='fetchUsCode("usSPLK.OQ")'>usSPLK.OQ Splunk Inc</b> . <b onclick='fetchUsCode("usSPI.OQ")'>usSPI.OQ 阳光动力</b> . <b onclick='fetchUsCode("usSMI.AM")'>usSMI.AM Vaneck Hip Sustainable Muni Etf</b> . <b onclick='fetchUsCode("usSMFG.N")'>usSMFG.N 三井住友金融</b> . <b onclick='fetchUsCode("usSIMO.OQ")'>usSIMO.OQ 慧荣科技</b> . <b onclick='fetchUsCode("usSBUX.OQ")'>usSBUX.OQ 星巴克</b> . <b onclick='fetchUsCode("usSAP.N")'>usSAP.N SAP</b> . <b onclick='fetchUsCode("usROK.N")'>usROK.N 罗克韦尔自动化</b> . <b onclick='fetchUsCode("usRF.N")'>usRF.N 地区金融</b> . <b onclick='fetchUsCode("usRENN.N")'>usRENN.N 人人网</b> . <b onclick='fetchUsCode("usQD.N")'>usQD.N 趣店</b> . <b onclick='fetchUsCode("usQCOM.OQ")'>usQCOM.OQ 高通</b> . <b onclick='fetchUsCode("usPLUG.OQ")'>usPLUG.OQ 普拉格能源</b> . <b onclick='fetchUsCode("usPFE.N")'>usPFE.N 辉瑞</b> . <b onclick='fetchUsCode("usPETZ.OQ")'>usPETZ.OQ 天地荟</b> . <b onclick='fetchUsCode("usKSM.N")'>usKSM.N DWS市政债务基金</b> . <b onclick='fetchUsCode("usEQIX.OQ")'>usEQIX.OQ 易昆尼克斯</b> . <b onclick='fetchUsCode("usENV.N")'>usENV.N Envestnet Inc</b> . <b onclick='fetchUsCode("usEBAY.OQ")'>usEBAY.OQ eBay</b> . <b onclick='fetchUsCode("usEA.OQ")'>usEA.OQ 艺电</b> . <b onclick='fetchUsCode("usDZZ.AM")'>usDZZ.AM 黄金两倍做空ETN（德银）</b> . <b onclick='fetchUsCode("usDXCM.OQ")'>usDXCM.OQ 德康医疗</b> . <b onclick='fetchUsCode("usDUK.N")'>usDUK.N 杜克能源</b> . <b onclick='fetchUsCode("usDGZ.AM")'>usDGZ.AM 黄金短期做空ETN（德银）</b> . <b onclick='fetchUsCode("usDGP.AM")'>usDGP.AM 黄金两倍做多ETN</b> . <b onclick='fetchUsCode("usDELL.N")'>usDELL.N 戴尔科技</b> . <b onclick='fetchUsCode("usDB.N")'>usDB.N 德意志银行</b> . <b onclick='fetchUsCode("usDAL.N")'>usDAL.N 达美航空</b> . <b onclick='fetchUsCode("usCSIQ.OQ")'>usCSIQ.OQ 阿特斯太阳能</b> . <b onclick='fetchUsCode("usCPHI.AM")'>usCPHI.AM 惠普森医药</b> . <b onclick='fetchUsCode("usCOST.OQ")'>usCOST.OQ 好市多</b> . <b onclick='fetchUsCode("usCOP.N")'>usCOP.N 康菲石油</b> . <b onclick='fetchUsCode("usCOF.N")'>usCOF.N 第一资本信贷</b> . <b onclick='fetchUsCode("usCMCSA.OQ")'>usCMCSA.OQ 康卡斯特</b> . <b onclick='fetchUsCode("usCAT.N")'>usCAT.N 卡特彼勒</b> . <b onclick='fetchUsCode("usCANG.N")'>usCANG.N 灿谷</b> . <b onclick='fetchUsCode("usCAJ.N")'>usCAJ.N 佳能</b> . <b onclick='fetchUsCode("usC.N")'>usC.N 花旗集团</b> . <b onclick='fetchUsCode("usBYSI.OQ")'>usBYSI.OQ 万春医药</b> . <b onclick='fetchUsCode("usBK.N")'>usBK.N 纽约梅隆银行</b> . <b onclick='fetchUsCode("usBIDU.OQ")'>usBIDU.OQ 百度</b> . <b onclick='fetchUsCode("usBAX.N")'>usBAX.N 百特国际</b> . <b onclick='fetchUsCode("usATVI.OQ")'>usATVI.OQ 动视暴雪</b> . <b onclick='fetchUsCode("usATSG.OQ")'>usATSG.OQ 航空运输服务</b> . <b onclick='fetchUsCode("usAPH.N")'>usAPH.N 安诺电子</b> . <b onclick='fetchUsCode("usAMRC.N")'>usAMRC.N 阿梅雷斯克</b> . <b onclick='fetchUsCode("usAMGN.OQ")'>usAMGN.OQ 安进</b> . <b onclick='fetchUsCode("usAMBA.OQ")'>usAMBA.OQ 安霸</b> . <b onclick='fetchUsCode("usALL.N")'>usALL.N 好事达</b> . <b onclick='fetchUsCode("usADSK.OQ")'>usADSK.OQ 欧特克</b> . <b onclick='fetchUsCode("usABT.N")'>usABT.N 雅培</b> . <b onclick='fetchUsCode("usAAPL.OQ")'>usAAPL.OQ 苹果</b> . <b onclick='fetchUsCode("usYY.OQ")'>usYY.OQ 欢聚</b> . <b onclick='fetchUsCode("usYRD.N")'>usYRD.N 宜人金科</b> . <b onclick='fetchUsCode("usXNET.OQ")'>usXNET.OQ 迅雷</b> . <b onclick='fetchUsCode("usXIN.N")'>usXIN.N 鑫苑置业</b> . <b onclick='fetchUsCode("usVNET.OQ")'>usVNET.OQ 世纪互联</b> . <b onclick='fetchUsCode("usVIPS.N")'>usVIPS.N 唯品会</b> . <b onclick='fetchUsCode("usUTSI.OQ")'>usUTSI.OQ UT斯达康</b> . <b onclick='fetchUsCode("usTOUR.OQ")'>usTOUR.OQ 途牛</b> . <b onclick='fetchUsCode("usTEDU.OQ")'>usTEDU.OQ 达内科技</b> . <b onclick='fetchUsCode("usTANH.OQ")'>usTANH.OQ 碳博士控股</b> . <b onclick='fetchUsCode("usTAL.N")'>usTAL.N 好未来</b> . <b onclick='fetchUsCode("usSOL.N")'>usSOL.N Emeren Group Ltd</b> . <b onclick='fetchUsCode("usSOHU.OQ")'>usSOHU.OQ 搜狐</b> . <b onclick='fetchUsCode("usSEED.OQ")'>usSEED.OQ 奥瑞金种业</b> . <b onclick='fetchUsCode("usRCON.OQ")'>usRCON.OQ 研控科技</b> . <b onclick='fetchUsCode("usOIIM.OQ")'>usOIIM.OQ 凹凸科技</b> . <b onclick='fetchUsCode("usNOAH.N")'>usNOAH.N 诺亚财富</b> . <b onclick='fetchUsCode("usNCTY.OQ")'>usNCTY.OQ 第九城市</b> . <b onclick='fetchUsCode("usMOXC.OQ")'>usMOXC.OQ 魔线</b> . <b onclick='fetchUsCode("usMOMO.OQ")'>usMOMO.OQ 挚文集团</b> . <b onclick='fetchUsCode("usMLCO.OQ")'>usMLCO.OQ 新濠博亚娱乐</b> . <b onclick='fetchUsCode("usLITB.N")'>usLITB.N 兰亭集势</b> . <b onclick='fetchUsCode("usLEJU.N")'>usLEJU.N 乐居</b> . <b onclick='fetchUsCode("usKNDI.OQ")'>usKNDI.OQ 康迪车业</b> . <b onclick='fetchUsCode("usJKS.N")'>usJKS.N 晶科能源</b> . <b onclick='fetchUsCode("usJD.OQ")'>usJD.OQ 京东</b> . <b onclick='fetchUsCode("usHTHT.OQ")'>usHTHT.OQ 华住</b> . <b onclick='fetchUsCode("usHOLI.OQ")'>usHOLI.OQ 和利时自动化</b> . <b onclick='fetchUsCode("usHIHO.OQ")'>usHIHO.OQ 骇维金属加工</b> . <b onclick='fetchUsCode("usHCM.OQ")'>usHCM.OQ 和黄医药</b> . <b onclick='fetchUsCode("usGURE.OQ")'>usGURE.OQ 海湾资源</b> . <b onclick='fetchUsCode("usFTFT.OQ")'>usFTFT.OQ 未来金融科技</b> . <b onclick='fetchUsCode("usFENG.N")'>usFENG.N 凤凰新媒体</b> . <b onclick='fetchUsCode("usEDU.N")'>usEDU.N 新东方</b> . <b onclick='fetchUsCode("usDSWL.OQ")'>usDSWL.OQ 德斯维尔工业</b> . <b onclick='fetchUsCode("usDQ.N")'>usDQ.N 大全新能源</b> . <b onclick='fetchUsCode("usCYD.N")'>usCYD.N 玉柴国际</b> . <b onclick='fetchUsCode("usCXDC.PS")'>usCXDC.PS 鑫达集团</b> . <b onclick='fetchUsCode("usCREG.OQ")'>usCREG.OQ 中国循环能源</b> . <b onclick='fetchUsCode("usCOE.N")'>usCOE.N 51Talk</b> . <b onclick='fetchUsCode("usCNET.OQ")'>usCNET.OQ 中网载线</b> . <b onclick='fetchUsCode("usCMCM.N")'>usCMCM.N 猎豹移动</b> . <b onclick='fetchUsCode("usCLWT.OQ")'>usCLWT.OQ 欧陆科仪</b> . <b onclick='fetchUsCode("usCJJD.OQ")'>usCJJD.OQ 九洲大药房</b> . <b onclick='fetchUsCode("usCHNR.OQ")'>usCHNR.OQ 中国天然资源</b> . <b onclick='fetchUsCode("usCGA.N")'>usCGA.N 中国绿色农业</b> . <b onclick='fetchUsCode("usCCM.N")'>usCCM.N 泰和诚医疗</b> . <b onclick='fetchUsCode("usCAAS.OQ")'>usCAAS.OQ 中汽系统</b> . <b onclick='fetchUsCode("usBZUN.OQ")'>usBZUN.OQ 宝尊电商</b> . <b onclick='fetchUsCode("usBSPM.OQ")'>usBSPM.OQ Biostar Pharmaceuticals, Inc.</b> . <b onclick='fetchUsCode("usBGNE.OQ")'>usBGNE.OQ 百济神州</b> . <b onclick='fetchUsCode("usBEDU.N")'>usBEDU.N 博实乐</b> . <b onclick='fetchUsCode("usBABA.N")'>usBABA.N 阿里巴巴</b> . <b onclick='fetchUsCode("usATHM.N")'>usATHM.N 汽车之家</b> . <b onclick='fetchUsCode("usATAI.OQ")'>usATAI.OQ Atai Life Sciences Nv</b> . <b onclick='fetchUsCode("usUMC.N")'>usUMC.N 联电</b> . <b onclick='fetchUsCode("usTSM.N")'>usTSM.N 台积电</b> . <b onclick='fetchUsCode("usHIMX.OQ")'>usHIMX.OQ 奇景光电</b> . <b onclick='fetchUsCode("usGIGM.OQ")'>usGIGM.OQ 和信超媒体</b> . <b onclick='fetchUsCode("usCHT.N")'>usCHT.N 中华电信</b> . <b onclick='fetchUsCode("usASX.N")'>usASX.N 日月光半导体</b> . <b onclick='fetchUsCode("usXRX.OQ")'>usXRX.OQ 施乐</b> . <b onclick='fetchUsCode("usVZ.N")'>usVZ.N Verizon</b> . <b onclick='fetchUsCode("usUBER.N")'>usUBER.N 优步</b> . <b onclick='fetchUsCode("usTSLA.OQ")'>usTSLA.OQ 特斯拉</b> . <b onclick='fetchUsCode("usTMUS.OQ")'>usTMUS.OQ T-Mobile Us Inc</b> . <b onclick='fetchUsCode("usSWKS.OQ")'>usSWKS.OQ 思佳讯</b> . <b onclick='fetchUsCode("usQRVO.OQ")'>usQRVO.OQ Qorvo Inc</b> . <b onclick='fetchUsCode("usMU.OQ")'>usMU.OQ 美光科技</b> . <b onclick='fetchUsCode("usMSI.N")'>usMSI.N 摩托罗拉解决方案</b> . <b onclick='fetchUsCode("usMMI.N")'>usMMI.N 马库斯米利查普</b> . <b onclick='fetchUsCode("usMETA.OQ")'>usMETA.OQ Meta Platforms Inc</b> . <b onclick='fetchUsCode("usMCHP.OQ")'>usMCHP.OQ 微芯科技</b> . <b onclick='fetchUsCode("usMA.N")'>usMA.N 万事达</b> . <b onclick='fetchUsCode("usLYFT.OQ")'>usLYFT.OQ Lyft Inc</b> . <b onclick='fetchUsCode("usLOGI.OQ")'>usLOGI.OQ 罗技</b> . <b onclick='fetchUsCode("usJBL.N")'>usJBL.N 捷普科技</b> . <b onclick='fetchUsCode("usIGT.N")'>usIGT.N 国际游戏科技</b> . <b onclick='fetchUsCode("usIBM.N")'>usIBM.N IBM</b> . <b onclick='fetchUsCode("usHPQ.N")'>usHPQ.N 惠普</b> . <b onclick='fetchUsCode("usHPE.N")'>usHPE.N 慧与</b> . <b onclick='fetchUsCode("usEMR.N")'>usEMR.N 艾默生电气</b> . <b onclick='fetchUsCode("usDT.N")'>usDT.N Dynatrace Inc</b> . <b onclick='fetchUsCode("usDLB.N")'>usDLB.N 杜比实验室</b> . <b onclick='fetchUsCode("usCMBM.OQ")'>usCMBM.OQ Cambium Networks Corporation</b> . <b onclick='fetchUsCode("usATI.N")'>usATI.N 阿勒格尼技术</b> . <b onclick='fetchUsCode("usARW.N")'>usARW.N 艾睿</b> . <b onclick='fetchUsCode("usADI.OQ")'>usADI.OQ 亚德诺</b> . <b onclick='fetchUsCode("usACM.N")'>usACM.N Aecom</b> . <b onclick='fetchUsCode("usACLS.OQ")'>usACLS.OQ Axcelis Technologies</b> . <b onclick='fetchUsCode("usABNB.OQ")'>usABNB.OQ 爱彼迎</b> . <b onclick='fetchUsCode("usVRSN.OQ")'>usVRSN.OQ 威瑞信</b> . <b onclick='fetchUsCode("usTRMB.OQ")'>usTRMB.OQ 天宝导航公司</b> . <b onclick='fetchUsCode("usTDC.N")'>usTDC.N 天睿公司</b> . <b onclick='fetchUsCode("usT.N")'>usT.N AT&amp;T</b> . <b onclick='fetchUsCode("usSTX.OQ")'>usSTX.OQ 希捷科技</b> . <b onclick='fetchUsCode("usSRAD.OQ")'>usSRAD.OQ Sportradar Group Ag</b> . <b onclick='fetchUsCode("usSATS.OQ")'>usSATS.OQ 回声星通信</b> . <b onclick='fetchUsCode("usPYPL.OQ")'>usPYPL.OQ Paypal</b> . <b onclick='fetchUsCode("usKLAC.OQ")'>usKLAC.OQ 科磊</b> . <b onclick='fetchUsCode("usJNPR.N")'>usJNPR.N 瞻博网络</b> . <b onclick='fetchUsCode("usGE.N")'>usGE.N 通用电气</b> . <b onclick='fetchUsCode("usERIC.OQ")'>usERIC.OQ 爱立信</b> . <b onclick='fetchUsCode("usEAR.OQ")'>usEAR.OQ Eargo Inc</b> . <b onclick='fetchUsCode("usDD.N")'>usDD.N 杜邦</b> . <b onclick='fetchUsCode("usCVLT.OQ")'>usCVLT.OQ 康沃系统</b> . <b onclick='fetchUsCode("usCSCO.OQ")'>usCSCO.OQ 思科</b> . <b onclick='fetchUsCode("usCRWD.OQ")'>usCRWD.OQ Crowdstrike Holdings Inc</b> . <b onclick='fetchUsCode("usCRM.N")'>usCRM.N 赛富时</b> . <b onclick='fetchUsCode("usCIEN.N")'>usCIEN.N Ciena科技</b> . <b onclick='fetchUsCode("usCDNS.OQ")'>usCDNS.OQ 楷登电子</b> . <b onclick='fetchUsCode("usAZPN.OQ")'>usAZPN.OQ 艾斯本</b> . <b onclick='fetchUsCode("usAVGO.OQ")'>usAVGO.OQ 博通</b> . <b onclick='fetchUsCode("usATNI.OQ")'>usATNI.OQ Atn International Inc</b> . <b onclick='fetchUsCode("usAMD.OQ")'>usAMD.OQ 美国超微公司</b> . <b onclick='fetchUsCode("usALTR.OQ")'>usALTR.OQ Altair Engineering Inc</b> . <b onclick='fetchUsCode("usAKAM.OQ")'>usAKAM.OQ 阿克迈</b> . <b onclick='fetchUsCode("usACN.N")'>usACN.N 埃森哲</b> . <b onclick='fetchUsCode("usZM.OQ")'>usZM.OQ Zoom视频通讯</b> . <b onclick='fetchUsCode("usWISH.OQ")'>usWISH.OQ Contextlogic Inc</b> . <b onclick='fetchUsCode("usWE.N")'>usWE.N Wework Inc</b> . <b onclick='fetchUsCode("usVOD.OQ")'>usVOD.OQ 沃达丰</b> . <b onclick='fetchUsCode("usTYL.N")'>usTYL.N 泰勒科技</b> . <b onclick='fetchUsCode("usTDS.N")'>usTDS.N 电话和数据系统</b> . <b onclick='fetchUsCode("usSPCE.N")'>usSPCE.N 维珍银河</b> . <b onclick='fetchUsCode("usSNOW.N")'>usSNOW.N Snowflake Inc</b> . <b onclick='fetchUsCode("usSNAP.N")'>usSNAP.N Snap Inc</b> . <b onclick='fetchUsCode("usS.N")'>usS.N Sentinelone Inc</b> . <b onclick='fetchUsCode("usRBLX.N")'>usRBLX.N Roblox Corporation</b> . <b onclick='fetchUsCode("usPINS.N")'>usPINS.N Pinterest Inc</b> . <b onclick='fetchUsCode("usPATH.N")'>usPATH.N Uipath Inc</b> . <b onclick='fetchUsCode("usOPEN.OQ")'>usOPEN.OQ Opendoor Technologies Inc</b> . <b onclick='fetchUsCode("usNOW.N")'>usNOW.N 现在服务公司</b> . <b onclick='fetchUsCode("usNOK.N")'>usNOK.N 诺基亚</b> . <b onclick='fetchUsCode("usMRVL.OQ")'>usMRVL.OQ 迈威尔科技</b> . <b onclick='fetchUsCode("usJMIA.N")'>usJMIA.N Jumia Technologies Ag</b> . <b onclick='fetchUsCode("usINFA.N")'>usINFA.N Informatica Inc</b> . <b onclick='fetchUsCode("usGOOGL.OQ")'>usGOOGL.OQ 谷歌-A</b> . <b onclick='fetchUsCode("usGOOG.OQ")'>usGOOG.OQ 谷歌-C</b> . <b onclick='fetchUsCode("usFVRR.N")'>usFVRR.N Fiverr International Ltd</b> . <b onclick='fetchUsCode("usFSR.N")'>usFSR.N 菲斯克</b> . <b onclick='fetchUsCode("usFFIV.OQ")'>usFFIV.OQ F5</b> . <b onclick='fetchUsCode("usDUOL.OQ")'>usDUOL.OQ 多邻国</b> . <b onclick='fetchUsCode("usDDD.N")'>usDDD.N 3D系统</b> . <b onclick='fetchUsCode("usCTSH.OQ")'>usCTSH.OQ 高知特</b> . <b onclick='fetchUsCode("usCCI.N")'>usCCI.N 冠城国际</b> . <b onclick='fetchUsCode("usAPP.OQ")'>usAPP.OQ Applovin Corp</b> . <b onclick='fetchUsCode("usAMZN.OQ")'>usAMZN.OQ 亚马逊</b> . <b onclick='fetchUsCode("usAMAT.OQ")'>usAMAT.OQ 应用材料</b> . <b onclick='fetchUsCode("usADBE.OQ")'>usADBE.OQ Adobe Inc</b> . <b onclick='fetchUsCode("usWFC.N")'>usWFC.N 富国银行</b> . <b onclick='fetchUsCode("usUSB.N")'>usUSB.N 美国合众银行</b> . <b onclick='fetchUsCode("usJPM.N")'>usJPM.N 摩根大通</b> . <b onclick='fetchUsCode("usHIG.N")'>usHIG.N 美国哈特福德金融</b> . <b onclick='fetchUsCode("usGS.N")'>usGS.N 高盛</b> . <b onclick='fetchUsCode("usCI.N")'>usCI.N 信诺</b> . <b onclick='fetchUsCode("usBAC.N")'>usBAC.N 美国银行</b> . <b onclick='fetchUsCode("usAXP.N")'>usAXP.N 美国运通</b> . <b onclick='fetchUsCode("usAIG.N")'>usAIG.N 美国国际集团</b> . <b onclick='fetchUsCode("usMRK.N")'>usMRK.N 默沙东</b> . <b onclick='fetchUsCode("usMO.N")'>usMO.N 奥驰亚</b> . <b onclick='fetchUsCode("usMDT.N")'>usMDT.N 美敦力</b> . <b onclick='fetchUsCode("usMCD.N")'>usMCD.N 麦当劳</b> . <b onclick='fetchUsCode("usKO.N")'>usKO.N 可口可乐</b> . <b onclick='fetchUsCode("usCVS.N")'>usCVS.N CVS健康</b> . <b onclick='fetchUsCode("usCPB.N")'>usCPB.N 金宝汤</b> . <b onclick='fetchUsCode("usBMY.N")'>usBMY.N 施贵宝</b> . <b onclick='fetchUsCode("usXOM.N")'>usXOM.N 埃克森美孚</b> . <b onclick='fetchUsCode("usWMB.N")'>usWMB.N 威廉姆斯</b> . <b onclick='fetchUsCode("usSO.N")'>usSO.N 美国南方公司</b> . <b onclick='fetchUsCode("usSLB.N")'>usSLB.N 斯伦贝谢</b> . <b onclick='fetchUsCode("usHAL.N")'>usHAL.N 哈里伯顿</b> . <b onclick='fetchUsCode("usGM.N")'>usGM.N 通用汽车</b> . <b onclick='fetchUsCode("usF.N")'>usF.N 福特汽车</b> . <b onclick='fetchUsCode("usEXC.OQ")'>usEXC.OQ 爱克斯龙电力</b> . <b onclick='fetchUsCode("usEP.AM")'>usEP.AM Empire Petroleum Corporation</b> . <b onclick='fetchUsCode("usCVX.N")'>usCVX.N 雪佛龙</b> . <b onclick='fetchUsCode("usAES.N")'>usAES.N AES发电</b> . <b onclick='fetchUsCode("usAEP.OQ")'>usAEP.OQ 美国电力</b> . <b onclick='fetchUsCode("usNWS.OQ")'>usNWS.OQ 新闻集团 Class B</b> . <b onclick='fetchUsCode("usDIS.N")'>usDIS.N 迪士尼</b> . <b onclick='fetchUsCode("usCCU.N")'>usCCU.N 智利CCU啤酒</b> . <b onclick='fetchUsCode("usWY.N")'>usWY.N 惠好</b> . <b onclick='fetchUsCode("usWMT.N")'>usWMT.N 沃尔玛</b> . <b onclick='fetchUsCode("usUPS.N")'>usUPS.N 联合包裹</b> . <b onclick='fetchUsCode("usPG.N")'>usPG.N 宝洁</b> . <b onclick='fetchUsCode("usNSC.N")'>usNSC.N 诺福克南方</b> . <b onclick='fetchUsCode("usMMM.N")'>usMMM.N 3M Company</b> . <b onclick='fetchUsCode("usIP.N")'>usIP.N 国际纸业</b> . <b onclick='fetchUsCode("usHD.N")'>usHD.N 家得宝</b> . <b onclick='fetchUsCode("usEL.N")'>usEL.N 雅诗兰黛</b> . <b onclick='fetchUsCode("usDOW.N")'>usDOW.N 陶氏化学</b> . <b onclick='fetchUsCode("usCL.N")'>usCL.N 高露洁</b> . <b onclick='fetchUsCode("usBA.N")'>usBA.N 波音</b> . <b onclick='fetchUsCode("usAA.N")'>usAA.N 美国铝业公司</b> . <b onclick='fetchUsCode("usUSNA.N")'>USNA.N 优莎娜</b> . <b onclick='fetchUsCode("usUSO.AM")'>USO.AM 美国原油ETF</b> . </pre>

<script>
      let thestkdata = [];
      let dateLst = [];
      let openLst = [];
      let highLst = [];
      let lowLst = [];
      let midLst = [];
      let closeLst = [];
      let amtLst = [];
      let startIntv = 6;

      if (localStorage.getItem("daychartWidth") === null) {
        localStorage.setItem("daychartWidth", 75);
        period = 75;
      } else{
        period = localStorage.getItem("daychartWidth");
      }
      dataStatus = "L"
      intv1 = startIntv
      intv2 = 2*intv1
      intv3 = 3*intv1
      intv4 = 4*intv1
      intv5 = 5*intv1
      intv6 = 6*intv1
      intv7 = 7*intv1
      intv8 = 8*intv1
      intv9 = 9*intv1
      stkpriceDataArr = [];
      stkList = codeList.split(' ');
      stkPointer = 0;
      theCode = localStorage.randomcode;
      titleText = "";
      starti = 0;
      chartColor = ['red','green','orange','blue','#900','#a00','#b0f','#c00','#d0a','gray','purple','yellow','white']

      attentionList = ""

      var options = '';  // build the List select option
      for (var i = 0; i < allListNames.length; i++) {
         options += '<option value="' + allListNames[i]+ '">' + allListNames[i] + '</option>';
      }
      $("#selectList").html(options);


      if (localStorage.getItem("attentionList") === null) {
        localStorage.attentionList = "07500";
      } else{
        attentionList = localStorage.getItem("attentionList").split(',');
      }
      //console.log(attentionList)

      // load localStorage.savedCodeList
      if (localStorage.getItem("savedCodeList") === null) {
        quickCodeList = ["110000"];
        localStorage.savedCodeList = quickCodeList;
      } else{
        quickCodeList = localStorage.getItem("savedCodeList").split(',');
      }


      // added extra links
      bigVolHeader = "http://www.etnet.com.hk/www/tc/stocks/realtime/quote_transaction.php?code="
      shortsellHeader = "http://www.aastocks.com/tc/stocks/analysis/stock-short-selling-ratio.aspx?symbol="
      newshead = "http://www.aastocks.com/tc/stocks/analysis/stock-aafn/"
      newstail = "/0/all/1"

      function askforCode() {
        var tempCode = prompt("Code Number:", "");
        if (tempCode != null && tempCode != ""){

            codewidth = tempCode.length
            if(codewidth <= 5){
              theCode = "00000"+tempCode;
              codewidth = theCode.length;
              theCode = theCode.slice(codewidth-5, codewidth);
              codewidth = theCode.length; //update to be used later
            }else{
              theCode = tempCode
            }

           storeCode(theCode)
           collectStkData(theCode)  // show turnover and draw
        }
      }

      function collectStkData(theCode) {
      $("#turnover").html(
       '<br><span class="randomBut gold bordred1 borRad10" onclick="askforCode()">号码</span> ' +
       '<span class="randomBut gold bordred1 borRad10" onclick="jpforward()">Next</span> ' +
      '<a href="' + bigVolHeader + theCode +'" target="_blank" class="white bordred1 borRad10">大戶</a>' +
      '<a href="' + newshead + theCode + newstail +'" target="_blank" class="white bordred1 borRad10">資料</a>' +
      '<a href="' + shortsellHeader + theCode + '" target="_blank" class="white bordred1 borRad10">沽空</a> '
      );

        //if(isNaN(theCode.substring(0, 1))){  // is it character}
        if( theCode.substring(0, 2) == "us"){
              theurl = 'https://web.ifzq.gtimg.cn/appstock/app/usfqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,1000,qfq';
              imageCode = theCode
        }else{

          if(theCode == "110000"){
             theCode = "HSI"; imageCode = "110000"
          }

          codewidth = theCode.length
          if(theCode == "HSI"){
              theurl = 'https://web.ifzq.gtimg.cn/appstock/app/hkfqkline/get?_var=kline_dayqfq&param=hk' + theCode + ',day,,,1000,qfq';
              imageCode = "110000"
          }else{
            if(codewidth <= 5){
              theCode = "00000"+theCode;
              codewidth = theCode.length;
              theCode = theCode.slice(codewidth-5, codewidth);
              codewidth = theCode.length; //update to be used later
              theStartCode = theCode
              imageCode = theCode
              theurl = 'https://web.ifzq.gtimg.cn/appstock/app/hkfqkline/get?_var=kline_dayqfq&param=hk' + theCode + ',day,,,1000,qfq';
            }else{
              codewidth = theCode.length
              if((codewidth == 6) && !hsReservedCode.includes(theCode)){
                 if (theCode.charAt(0) == "6"){
                    imageCode = theCode+".sh"; // note this comes before following line
                    theCode = "sh"+theCode; 
                 }else{
                    imageCode = theCode+".sz";
                    theCode = "sz"+theCode
                 }
                 theStartCode = theCode
                 theurl = 'https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,1000,qfq';
              }else if(codewidth == 9){
                imageCode = theCode
                theCode = theCode.substring(7, 9) + theCode.substring(0, 6);
                theStartCode = theCode

                theurl = 'https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,1000,qfq';
              }else{
                theurl = 'https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?_var=kline_dayqfq&param=' + theCode + ',day,,,1000,qfq';
                theStartCode = theCode
                imageCode = theCode
              }
            }
          }
        }
          theStartCode = theCode;
        document.getElementById("image").innerHTML = '<img src="http://charts.aastocks.com/servlet/Charts?fontsize=12&15MinDelay=F&lang=1&titlestyle=1&vol=1&Indicator=3&indpara1=3&indpara2=6&indpara3=9&indpara4=12&indpara5=15&subChart1=3&ref1para1=7&ref1para2=10&ref1para3=3&subChart2=3&ref2para1=12&ref2para2=26&ref2para3=9&subChart3=7&ref3para1=7&ref3para2=5&ref3para3=0&subChart4=7&ref4para1=11&ref4para2=8&ref3para3=0&subChart5=13&ref4para1=0&ref4para2=0&ref4para3=0&scheme=3&com=100&chartwidth=1200&chartheight=760&stockid='+ imageCode +'&period=7&type=1&logoStyle=1">'


          thestkdata = [];
          thedrawdata = [];
          dateLst = [];
          openLst = [];
          highLst = [];
          lowLst = [];
          midLst = [];
          closeLst = [];
          amtLst.length = 0;
      
          RGraph.AJAX.getJSON(theurl, function (rawJSON){
              var keys = Object.keys(rawJSON); // read the structure keys ["code", "msg", "data"]

              var insideDatakey = Object.keys(rawJSON)[2] //
              // myobj[Object.keys(myobj)[0]] this is the extract method
      
              var thedata = rawJSON[Object.keys(rawJSON)[2]]
              thestkkey = Object.keys(thedata)[0] // this is the stk key name
              var tempdata = thedata[Object.keys(thedata)[0]];
              thestkdata = tempdata[Object.keys(tempdata)[0]]; // real data here, this is whole dataset

              if(thestkdata.length == 0){alert("no data in: " + thestkkey)}

              for(i=(thestkdata.length-12);i<thestkdata.length;i++){
                    thedate = thestkdata[i][0];  // date
                    if(codewidth <= 5){
                      theAmtIdx = 8;
                    }else{
                      theAmtIdx = 5;
                    }
                    theamt = Math.round(Number(thestkdata[i][theAmtIdx]));
                    if(codewidth > 5){
                      if(theCode.slice(0, 5) == "sh688"){
                        theamt = Math.round(theamt * Number(thestkdata[i][2])/10000);
                      }else{
                        theamt = Math.round(theamt * Number(thestkdata[i][2])/100);
                      }
                    }
                    theamt = theamt.toString().replace(/\B(?=(\d{4})+(?!\d))/g, ",");
                    $("#turnover").prepend( theamt,"w ");
                  }
      
              theNameObj = tempdata[Object.keys(tempdata)[1]];
              theNameObjName  = theNameObj[Object.keys(theNameObj)[0]];
              stkName = theNameObjName[1]
      
              /* data is arranged in days array, tempdata[320] is last set
              tempdata[320][0]  // date
              tempdata[320][1]  // open
              tempdata[320][3]  // high
              tempdata[320][4]  // low
              tempdata[320][2]  // close */
      
                //period + intv1, the chartwidth + max trend interval
              starti = thestkdata.length - (parseInt(period) + parseInt(intv1)) -5; 
              if(starti <= 0){
                  alert(theStartCode + " " + stkName +" not enough data! dataLength: " + thestkdata.length);
                  return;
              }

              for (let i = starti; i < thestkdata.length; i++) {
                  dateLst.push(thestkdata[i][0]);
                  openLst.push(Number(thestkdata[i][1]));
                  highLst.push(Number(thestkdata[i][3]));
                  lowLst.push(Number(thestkdata[i][4]));
                  midLst.push((Number(thestkdata[i][3]) + Number(thestkdata[i][4]))/2);
                  closeLst.push(Number(thestkdata[i][2]));
                  amtvalue = "&emsp;" + Math.round(Number(thestkdata[i][8])).toString().replace(/\B(?=(\d{4})+(?!\d))/g, ",") +"w ";
                  amtLst.push(amtvalue);
              }
              if(dataStatus == "C"){ stkpriceDataArr = closeLst
              }else if(dataStatus == "L"){ stkpriceDataArr = lowLst
              }else if(dataStatus == "M"){ stkpriceDataArr = midLst
              }else { stkpriceDataArr = highLst}

              redraw();  // this line must be inside the AJAX because AJAX run last
           });

           showDateTime();
           $("#dateTime").prepend("Item " + (stkPointer+1) + " of " + stkList.length + ", ");

           //showActivity(theCode)

      }

     function chkKey() {
       var testkey = getChar(event);
       if(testkey == '0'){ theCode = '000001.sh'; collectStkData('000001.sh');}

       else if(testkey == '3'){ theCode = '399001.sz'; collectStkData('399001.sz');}
       else if(testkey == '1'){ theCode = '110000'; collectStkData('HSI');}
       else if(testkey == '2'){ theCode = '01339'; collectStkData('02013');}
       else if(testkey == '4'){ theCode = '01766'; collectStkData('01766');}
       else if(testkey == '5'){ theCode = '03800'; collectStkData('03800');}
       else if(testkey == '6'){ theCode = '00371'; collectStkData('00371');}
       else if(testkey == '7'){ theCode = '00788'; collectStkData('00788');}
       else if(testkey == '8'){ theCode = '00308'; collectStkData('00308');}
       else if(testkey == '9'){ theCode = '00390'; collectStkData('00390');}
       else if(testkey == 'u'){ theCode = 'us.DJI'; collectStkData('us.DJI');}
       else if(testkey == 'n'){ theCode = 'us.IXIC'; collectStkData('us.IXIC');}
       else if(testkey == 'J'){ theCode = 'us.INX'; collectStkData('us.INX');}
       else if(testkey == 'U'){ $('#usstock').toggle(); window.location = '#usstock';}
       else if(testkey == 'd'){fillLineData();}
       else if(testkey == 'c'){askforCode();}
       else if(testkey == '+'){addToquickCodeList();}
       else if(testkey == 'q'){myfavor();}
       else if(testkey == 'Q'){usequickCodeList();}
       else if(testkey == 'B'){usestkListArr();}

       // if(testkey == '+'){addToAttentionList();}
       else if(testkey == '-'){removeFmquickCodeList();}
       else if(testkey == 'X'){storeCode(theCode); window.open("Random Charts.html");}
       else if(testkey == '.'){storeCode(theCode); window.open("mlineMinutechart.html");}

       else if(testkey == 'a'){useAttentionList();}
       else if(testkey == 'f'){jpforward();}
       else if(testkey == ']'){jpforward();}
       else if(testkey == 'b'){jpback();}
       else if(testkey == '['){jpback();}
       else if(testkey == 'r'){jprandom();}
       else if(testkey == 't'){jpTo0();}
       else if(testkey == 'h'){chgHighList();}
       else if(testkey == 'l'){chgLowList();}
       else if(testkey == 'm'){chgMidList();}
       else if(testkey == 'i'){chgIntv();}
       else if(testkey == 'w'){chgchartWidth();}
       else if(testkey == 'j'){period = 300; intv1 = 30; collectStkData(theCode);}
       else if(testkey == 'k'){period = 50; intv1 = 2; collectStkData(theCode);}

       else if(testkey == 'C'){chgCloseLst();}
       else if(testkey == 'L'){askList()}
       else if(testkey == 'z'){largeCht()}
       else if(testkey == 'e'){window.location = '#commands';
            window.scrollTo(window.scrollX, window.scrollY - 300);}
       else if(testkey == 'E'){window.location = '#filterMarkers';}
       else{chkOtherKeys(testkey)} 
     }

     function getChar(event) {
       if (event.which!=0 && event.charCode!=0) {
         return String.fromCharCode(event.which)   // the rest
       } else {
         return null // special key
       }
     }

	function fillLineData() {
      var dataArr = prompt("Enter data array sep by space:", "");
      if (dataArr != null && dataArr != "") {
        dataArrArr = dataArr.split(' ');

        stkpriceDataArr = dataArrArr.map(Number);
        redraw()
      }
     }

      function addToquickCodeList() {
        codewidth = theCode.length
        if(codewidth <= 5){
          theCode = "00000"+theCode;
          codewidth = theCode.length;
          theCode = theCode.slice(codewidth-5, codewidth);
        }
        if (!quickCodeList.includes(theCode)) {
          quickCodeList.push(theCode);
          quickCodeList = Array.from(new Set(quickCodeList)); // set unique
          localStorage.savedCodeList = quickCodeList;
          alert(theCode + " added to quickCodeList")
        }else{alert(theCode + " already exist!")}
      }

    function usequickCodeList() {
        stkList = quickCodeList;
        alert("quickCodeList Total: " + quickCodeList.length + "\ndetails see end of this page.\nremember to modify mustadd list!")
        $("#message").text("quickCodeList Total: " + quickCodeList.length + "\n"+stkList);
    }

    function usestkListArr() {
      stkListArr = localStorage.getItem("stkListArr")
      if (stkListArr === null) {
         stkList = quickCodeList;
      } else{
         stkList = stkListArr;
      }
        alert("Use stkListArr, Total: " + stkListArr.length + " : "+stkListArr)
        $("#message").text("stkListArr Total: " + stkListArr.length + "\n"+stkList);
    }

	function addToAttentionList() {
            codewidth = theCode.length
            if(codewidth <= 5){
              theCode = "00000"+theCode;
              codewidth = theCode.length;
              theCode = theCode.slice(codewidth-5, codewidth);
              codewidth = theCode.length; //update to be used later
            }

        attentionList.push(theCode)
        attentionList = [...new Set(attentionList)]; // set unique

        ItemIndex = attentionList.indexOf("");  // remove empty items
        if (ItemIndex > -1) { attentionList.splice(ItemIndex, 1); }

        localStorage.setItem("attentionList", attentionList);
        alert(theCode + " added to attentionList!")
     }
	function removeFmquickCodeList() {
        ItemIndex = quickCodeList.indexOf(theCode);
        if (ItemIndex > -1) { quickCodeList.splice(ItemIndex, 1); }
        quickCodeList = [...new Set(quickCodeList)]; // set unique
        localStorage.setItem("quickCodeList", quickCodeList);
        alert(theCode + " removed fm quickCodeList!")
   }

     function redraw() {
        initIntvSteps()
        titleText = showDate() +" "+ showTime()+", p1: "+intv1+ " p9: "+intv9+" w: "+(thestkdata.length-starti) +"\n"+theStartCode + " " + stkName + " 日線 ";
        $("#amtLst").html("Amt: ".concat(amtLst.slice((amtLst.length-14),amtLst.length).join("")));

 
        RGraph.reset(document.getElementById('cvs'));

        if(dataStatus == "C"){ stkpriceDataArr = closeLst
        }else if(dataStatus == "L"){ stkpriceDataArr = lowLst
        }else if(dataStatus == "M"){ stkpriceDataArr = midLst
        }else { stkpriceDataArr = highLst}

        stdDevH = makeStd(highLst, intv3)
        stdDevL = makeStd(lowLst, intv3)
        newDevadd = makeMovAve(stkpriceDataArr, intv3).map((a, i) => a + stdDevH[i]);
        newDevminus = makeMovAve(stkpriceDataArr, intv3).map((a, i) => a - stdDevL[i]);

        mydata = [ stkpriceDataArr]
          mydata.push(makeMovAve(stkpriceDataArr, intv1/2))
          mydata.push(makeMovAve(mydata[1], intv1))
          mydata.push(makeMovAve(mydata[1], intv2))
          mydata.push(makeMovAve(mydata[1], intv3))
          mydata.push(makeMovAve(mydata[1], intv4))
          mydata.push(makeMovAve(mydata[1], intv5))
          mydata.push(makeMovAve(mydata[1], intv6))
          mydata.push(makeMovAve(mydata[1], intv7))
          mydata.push(makeMovAve(mydata[1], intv8))
          mydata.push(newDevadd)
          mydata.push(newDevminus)
        theMax = Math.max(...[].concat(...mydata));
        theMin = Math.min(...[].concat(...mydata));

        thedrawdata = mydata
        thedrawdata.push(makeMovAve(thedrawdata[2], intv1));  // add one line to check results

        thedrawdata[1] = thedrawdata[1].fill(null,0,intv1)
        thedrawdata[2] = thedrawdata[2].fill(null,0,intv2)
        thedrawdata[3] = thedrawdata[3].fill(null,0,intv3)
        thedrawdata[4] = thedrawdata[4].fill(null,0,intv4)
        thedrawdata[5] = thedrawdata[5].fill(null,0,intv5)
        thedrawdata[6] = thedrawdata[6].fill(null,0,intv6)
        thedrawdata[7] = thedrawdata[7].fill(null,0,intv7)
        thedrawdata[8] = thedrawdata[8].fill(null,0,intv8)
        thedrawdata[9] = thedrawdata[9].fill(null,0,intv9)
        thedrawdata[10] = thedrawdata[10].fill(null,0,intv3)
        thedrawdata[11] = thedrawdata[11].fill(null,0,intv3)
        thedrawdata[12] = thedrawdata[12].fill(null,0,intv1)  // add one line 

statusMsg = '<br><span class="red">price '+ mydata[0].slice(-1)[0].toFixed(3) +
'</span>, <span class="darkgreen">intvS '+ mydata[1].slice(-1)[0].toFixed(3) +
'</span>, <span class="blue">intvL '+ mydata[2].slice(-1)[0].toFixed(3) +
'</span>, <span class="purple">Top '+ mydata[3].slice(-1)[0].toFixed(3) +
'</span>, <span class="yellow">Bottom '+ mydata[4].slice(-1)[0].toFixed(3) +
'</span>, <span class="darkgreen">IntvS '+ intv1 +
'</span>, <span class="blue">IntvL '+ intv2 +
'</span>'

$("#lastValues").text("");
$("#lastValues").append(statusMsg);

       drawchart()

		// create datalog table
		 transp = transpose(mydata);
            wAveTrendRange = [];  // this is the gap diff
		  for (var row=0; row < transp.length; row++) {
		    rowRange = transp[row].slice(1, mydata.length);
      	    rowMax = Math.max(...rowRange);
      	    rowMin = Math.min(...rowRange);
      	    var rowDiff = rowMax - rowMin;
      	    wAveTrendRange.push(rowDiff);
      	  }

		wAveTrendRange.fill(null,0,intv9);
		wAvemax = Math.max(...wAveTrendRange);
		wAvemin = Math.min(...wAveTrendRange);
		drawTrend(wAveTrendRange, wAvemax, wAvemin, 'TP');

		// find derivative
		derivative = diff(makeMovAve(mydata[0], 3));
		derivative.unshift(0);
		derivative.fill(null,0,intv1+3); //array.fill(value, start, end)

		// diffaccel
		// diffaccel = thedrawdata[baseSubIdx].map(function(item, index) { return item - thedrawdata[baseMinuIdx][index]; })
		diffaccel = []
		diffaccel.push(thedrawdata[1].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[2].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[3].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[4].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[5].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel.push(thedrawdata[6].map(function(item, index) { return item - thedrawdata[9][index]; }))
		diffaccel[0].fill(null,0,intv9); //array.fill(value, start, end)
		diffaccel[1].fill(null,0,intv9); //array.fill(value, start, end)
		diffaccel[2].fill(null,0,intv9); //array.fill(value, start, end)
		diffaccel[3].fill(null,0,intv9); //array.fill(value, start, end)
		diffaccel[4].fill(null,0,intv9); //array.fill(value, start, end)
		diffaccel[5].fill(null,0,intv9); //array.fill(value, start, end)

		diffaccMax = Math.max(...[].concat.apply([], diffaccel));
		diffaccMin = Math.min(...[].concat.apply([], diffaccel));
		drawTrend(diffaccel, diffaccMax, diffaccMin, 'accel');


		// ddiffaccel
		ddiffaccel = []
		ddiffaccel.push(diffaccel[0].map(function(item, index) { return item - diffaccel[4][index]; }))
		ddiffaccel.push(diffaccel[1].map(function(item, index) { return item - diffaccel[4][index]; }))
		ddiffaccel.push(diffaccel[2].map(function(item, index) { return item - diffaccel[4][index]; }))
		ddiffaccel.push(diffaccel[3].map(function(item, index) { return item - diffaccel[4][index]; }))
		ddiffaccel.push(diffaccel[4].map(function(item, index) { return item - diffaccel[4][index]; }))
		ddiffaccel[0].fill(null,0,intv8); //array.fill(value, start, end)
		ddiffaccel[1].fill(null,0,intv8); //array.fill(value, start, end)
		ddiffaccel[2].fill(null,0,intv8); //array.fill(value, start, end)
		ddiffaccel[3].fill(null,0,intv8); //array.fill(value, start, end)
		ddiffaccel[4].fill(null,0,intv8); //array.fill(value, start, end)

		ddiffaccMax = Math.max(...[].concat.apply([], ddiffaccel));
		ddiffaccMin = Math.min(...[].concat.apply([], ddiffaccel));
		drawTrend(ddiffaccel, ddiffaccMax, ddiffaccMin, 'accaccel');

		// find stoch
		stoch1 = makeStoch(mydata[0], 50)
		stochmax1 = Math.max(...stoch1);
		stochmin1 = Math.min(...stoch1);
		drawTrend(stoch1, stochmax1, stochmin1, '强弱50');

     }

	function makeMovAve(bigArray, intv) {
	     // the intv-1 is correct
		return bigArray.slice(0, intv-1).concat(calcMovAve(bigArray, intv));
	}
	function calcAve(aveArray) {
		add = (a, b) =>  a + b;
		return aveArray.reduce(add) / aveArray.length;
	}
	
	function calcMovAve(bigArray, intv) {
		var ma = [];
		for (var i =0 ; i < (bigArray.length-intv+1); i++) {ma[i] = calcWAve(bigArray.slice(i, i+intv));} // points to indicator
		return ma;
	}
	function calcWAve(aveArray) {
		var sum = 0
		for( var i = 1; i <= aveArray.length; i++ ) {
			sum += aveArray[i-1] * i;
		}
		return (sum / ((1 + aveArray.length)*aveArray.length/2))
	}

	function makeStoch(bigArray, intv) {
	     tempArr = bigArray.slice(0, intv-1).concat(calcStoch(bigArray, intv));
		return tempArr.fill(50,0,intv-1)
	}

	function calcStoch(bigArray, intv) {
		var stc = [];
		for (var i =0 ; i < (bigArray.length-intv+1); i++) {
			stc[i] = calc1Stoch(bigArray.slice(i, i+intv));
		}
		return stc;
	}

	function calc1Stoch(stcArray) {
			stcMax = Math.max(...stcArray)
			stcMin = Math.min(...stcArray)
			lastVal = stcArray[stcArray.length - 1]
			stcRange = stcMax - stcMin
			if(stcRange == 0){
				stcVal = 50
			}else{
				stcVal = 100*(lastVal - stcMin) / stcRange
			}
			return stcVal
	}

	function makeStd(bigArray, intv) {
	     // the intv-1 is correct
          newArray = new Array(intv-1).fill(0)
		newArray = newArray.concat(calcStd(bigArray, intv));
		return newArray
	}

	function calcStd(bigArray, intv) {
		var stdArrar = [];
		for (var i =0 ; i < (bigArray.length-intv+1); i++) {stdArrar[i] = Std(bigArray.slice(i, i+intv));} // points to indicator
		return stdArrar;
	}

	function Std(array) {
	  const n = array.length
	  const mean = array.reduce((a, b) => a + b) / n
	  return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)
	}

	function transpose(thisArr) { // Swap rows with columns of a matrix
	    return Object.keys(thisArr[0]).map(function(column) {
	        return thisArr.map(function(row) { return row[column]; });
	    });
	}

    function useAttentionList() {
        stkList = attentionList;
        alert("AttentionList Total: " + attentionList.length + "\ndetails see end of this page.\nremember to modify mustadd list!")
        $("#message").text("Total: " + attentionList.length + "\n"+stkList);
    }

    function myfavor() {
        myfavorLst = mychips.split(" ");
        stkList = myfavorLst;
        alert("mychips Total: " + myfavorLst.length + "\ndetails see end of this page.\nremember to modify mustadd list!")
        $("#message").text("mychips Total: " + myfavorLst.length + "\n"+stkList);
    }

    function askList() {
        var theList = prompt("CodeList, Number (5 digits) sep by space： ", "");
        if (theList != null && theList != "HSI" && theList != "") {
            stkList = theList.split(" ");
            alert("Supplied List Total: " + stkList.length + "\ndetails see end of this page.\nremember to modify mustadd list!")
            $("#message").text("Supplied List Total: " + stkList.length + "\n"+stkList);
        }
    }

    function FormatNumberLength5(num) {
        var r = "" + num;
        while (r.length < 5) { r = "0" + r; }
        return r;
    }

    function jpforward() {
        if (stkPointer < stkList.length-1) {
            stkPointer = stkPointer + 1;
        } else {
            stkPointer = 0;
        }
        theCode = stkList[stkPointer];
         collectStkData(theCode)
    }

    function jpback() {
        if (stkPointer > 0) {
            stkPointer = stkPointer - 1;
        } else {
            stkPointer = stkList.length-1;
        }
        theCode = stkList[stkPointer];
         collectStkData(theCode)
    }
    function jprandom() {
        stkPointer = Math.floor(Math.random() * (stkList.length-1))
        theCode = stkList[stkPointer]
         collectStkData(theCode)
    }

    function jpTo0() {
        stkPointer = 0;
        theCode = stkList[stkPointer]
        collectStkData(theCode)
    }

    function storeCode(theCode) {
        if(typeof(Storage) !== "undefined") {
            localStorage.randomcode = theCode;
        }
    }


    function chgchartWidth() {
        newChartWidth = prompt("enter chart width:", "");
        if (newChartWidth != null && newChartWidth != "" && newChartWidth < (1000 - 2*intv1)){
          period = parseInt(newChartWidth);
          localStorage.setItem("daychartWidth", period);
          collectStkData(theCode);
        }

    }
    function chgIntv() {
        intv = prompt("intv1 value:", "");
        if (theCode != null && intv1 != ""){
          intv1 = parseInt(intv);
          initIntvSteps()
          redraw()
        }
    }
    function initIntvSteps() {
      intv2 = 2*intv1
      intv3 = 3*intv1
      intv4 = 4*intv1
      intv5 = 5*intv1
      intv6 = 6*intv1
      intv7 = 7*intv1
      intv8 = 8*intv1
      intv9 = 9*intv1
    }
    function chgHighList() {
        dataStatus = "H"
        redraw()
    }
    function chgLowList() {
        dataStatus = "L"
        redraw()
    }
    function chgMidList() {
        dataStatus = "M"
        redraw()
    }
    function chgCloseLst() {
        dataStatus = "C"
        redraw()
    }

    function largeCht() {
        imgHead = "http://charts.aastocks.com/servlet/Charts?fontsize=12&15MinDelay=F&lang=1&titlestyle=1&vol=1&Indicator=3&indpara1=3&indpara2=5&indpara3=10&indpara4=15&indpara5=20&subChart2=3&ref2para1=12&ref2para2=26&ref2para3=9&subChart3=12&ref3para1=0&ref3para2=0&ref3para3=0&scheme=3&com=100&chartwidth=1600&chartheight=900&stockid=";

        imgTail = "&period=2060&type=1&logoStyle=1"
        imgURL = imgHead + theCode + imgTail
        window.open(imgURL, "_blank")
    }

function assignList(){
  newList = eval(document.getElementById("selectList").value).split(" ");
  stkList = newList;
  codeList = newList;
  // console.log(newList)

  document.getElementById("message").focus();
  alert(" Total: " + stkList.length + "\ndetails see end of this page.\nremember to modify mustadd list!\n" + newList)
        $("#message").text("Total: " + stkList.length + "\n"+stkList);
  $('#selectList').blur()

}

function showDateTime() {
    cmtCode = theCode // use another name not to interfere other parts
    var cmtcodewidth = cmtCode.length
    if(cmtcodewidth <= 5){
      cmtCode = "00000"+cmtCode;
      cmtcodewidth = cmtCode.length;
      cmtCode = cmtCode.slice(cmtcodewidth-5, cmtcodewidth);
    }
    else if(cmtcodewidth == 8){ cmtCode = cmtCode.slice(2, 8); }
    else if(cmtcodewidth == 9){ cmtCode = cmtCode.slice(0, 6); }
    commentName = "j" + cmtCode;

    CommentListNames = Object.keys(theCommentList); // extract the names from comments
    // to show comments
    if(CommentListNames.includes(commentName)){
      cmtLocation = CommentListNames.indexOf(commentName);
      commentTxt = theCommentList[Object.keys(theCommentList)[cmtLocation]]
    }else{commentTxt = "No data!";}

    document.getElementById("dateTime").innerHTML ="<span class='orange'>" + commentTxt + "</span>";
}

    function drawchart() {
      listItems = []
      if(dataStatus == "C"){ tooltips = closeLst
      }else if(dataStatus == "L"){ tooltips = lowLst
      }else if(dataStatus == "M"){ tooltips = midLst
      }else { tooltips = highLst}

      dataTooltips = tooltips.map(item => Math.round(item * 1000) / 1000)
      for (index = 0; index < dataTooltips.length; index++) {
        listItems[index] = dateLst[index] + "<br><span class='red'>" + dataStatus + "</span>: " + dataTooltips[index];
      }

      dataTooltips = dataTooltips.map(String)

      var line = new RGraph.Line({
        id:'cvs',
        data: thedrawdata,
        options: {
			title: titleText + " " + dataStatus,
			titleColor: 'grey',
			titleSize: 20,
               colors: chartColor,
            backgroundGrid: true, backgroundGridVlines: true,
            backgroundGridColor: '#001000', backgroundGridBorder: false,
            // backgroundGridDotted: true,
            backgroundGridDashed: true, 
            axisColor: '#864',  scaleDecimals: 2,
            xaxis: true,
            //xaxisLabels: ["a","b","c","d"],
            textColor: '#ccc',
            tickmarks: 'plus',
            ticksize: 1,
            linewidth:1,
			ymax: theMax,
			ymin: theMin,
      // labels control the number of grids
            // labels: ['2008','2009','2010','2011','2012','2013','2014','2015','2016','2017','2018'],
            spline: false,
            shadow: false,
            tooltips: listItems,
            gutterLeft: 0, gutterRight: 50,
            gutterTop: 25, gutterBottom: 25
            }
          }).trace();

		yminpct = 100 - (theMax-theMin)*100/theMax,
		ymaxpct = 100,

          yaxis1 = new RGraph.Drawing.YAxis('cvs', 1200)
                .Set('colors', ['gold'])
                .Set('text.color', 'gray')
                .Set('text.size', 8)
                .Set('max', ymaxpct)
                .Set('min', yminpct)
                .Set('linewidth', 2)
                .Set('tickmarkslength', 5)
                .Set('title', '% pct')
                .Draw();

    };

    function drawTrend(therange,maxValue, minValue, chartID) {
       // dataTooltips = therange.map(item => Math.round(item * 1000) / 1000)
       // dataTooltips = dataTooltips.map(String)
       RGraph.reset(document.getElementById(chartID));
       line = new RGraph.Line({
       	id:chartID, data:therange,
       	options: {
       		title: chartID + ", "+theStartCode + " " + stkName,
    			titleColor: 'grey', 
    			titleSize: 10,
       		backgroundGrid: true, axisColor: '#864', textColor: '#ccc',
    		numxticks: 0, colors: chartColor, scaleDecimals: 2,

       		tickmarksDotLinewidth: 0,ticksize: 1, linewidth: 1, 
       		ymax: maxValue, ymin: minValue,
               tickmarks: 'plus',

       		spline: false, shadow: false,
              // tooltips: dataTooltips,
			backgroundGridVlines: true,
			backgroundGridDashed: true, 
       		backgroundGridColor: '#001000',
       		gutterLeft: 0, gutterRight: 50, gutterTop: 25, gutterBottom: 25
       	}
       }).trace();
    };
    
    function diff(arr) {
      return arr.slice(1).map(function(n, i) { return n - arr[i]; });
    }

function showActivity(thecode){
    markers = filterResult.filter(element => element.includes(thecode));
    // clean the h2 tags
    markers = markers.map(element => element.replace(/<\/h2>.*/gi, ""))
    markers = markers.map(element => element.replace(/<h2>/gi, ""))

    markers = markers.map(element => formatWeekDay(element))
    if (markers.length > 50) markers.splice(0, markers.length-80);

    $('#filterMarkers').append("<b class='red'>" + thecode + " 日线特征:</b><br>")
    $('#filterMarkers').append(markers)
}

// format WeekDay
function formatWeekDay(element) {
    dayStr = element.replace(/<.*?>/gi, "") // clean span tags
    dayStr = dayStr.substr(0,6)
    dayStr = convertWeekday(dayStr)
    return(dayStr + " " + element + "<br>")
}

// convert date string to weekday
function parse(str) {
    str = "20" + str
    var y = str.substr(0,4), m = str.substr(4,2) - 1,
        d = str.substr(6,2);
    var D = new Date(y,m,d);
    return (D.getFullYear() == y && D.getMonth() == m && D.getDate() == d) ? D : 'invalid date';
}
function convertWeekday(str) {
    return ["SUN","MON","TUE","WED","THU","FRI","SAT"][parse(str).getDay()]
}
function fetchUsCode(str) {
    theCode = str; collectStkData(str); window.location = '#cvs';
    $('#usstock').toggle();
}

function handleRight( event ){
    codeListPtr = codeListPtr +1
    theCode = codeList[codeListPtr];
    collectStkData(theCode);
}

    codeList = codeList.split(' ')
    codeListPtr = 0

    $( "html" ).on( "swiperight", handleRight );
    $( "html" ).on( "swipeleft", askforCode );
    collectStkData(theCode);

function docLoaded() {
    let script1 = document.createElement('script');
    script1.src = 'https://williamkpchan.github.io/LibDocs/readbook.js';
    document.body.appendChild(script1);
    let script = document.createElement('script');
    script.src = 'C:/R programs/!!! STKMon !!!/headerApp.js';
    document.body.appendChild(script);
    window.scrollTo(0,(document.body.scrollHeight));
}
</script>
</body>
</html>
