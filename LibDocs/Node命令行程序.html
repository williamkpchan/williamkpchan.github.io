<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width"/>
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, strong,  div.title').click(function(){
    parent.history.back();
    return false;
    });
});
</script>
<style>
body{width:80%;margin-left: 10%}
strong, h1, h2 {color: gold;}
</style>
</head><body>
<center><h2>Node命令行程序</h2>
<div id="toc"></div></center>
<br>
<br>
<br>
<pre>
<a href="http://mp.weixin.qq.com/s?__biz=MjM5NDMwNjMzNA==&mid=2651809810&idx=1&sn=8fc37fb3c41ae6d0b379062a38652988&chksm=bd7208638a058175e0a02ed95b8bb2a075104f2227ce3990c44cac2a844b86b4ca2fc03b22a1&mpshare=1&scene=1&srcid=0823z7FLbxBg1sxHkHnQiXe3&pass_ticket=vkbsfKi9G0mxWxxboQIJ5m9%2FK1eqzyD8i5CUBXWiQydJHzo4YxM1aFjEAWFb5Rtz#rd">30分钟使用Node</a>


让我很无奈的是使用Java编写命令行程序是比较麻烦的，好在NodeJs干这事很方便， 在接下来的30分钟里我将教你编写一个有趣的终端程序并将它发布到npm仓库中，赶紧GET吧~


在开始之前请务必确认你安装了Node的环境，我目前使用的NodeJs环境是 v6.10.3。


<strong>创建项目结构</strong>


<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScq2uKicScXJKCwUC2LVlhjG04Ho55yT7LicbqtGuXzoHoum17p4f3LXCHg/0?wx_fmt=png">

根据提示初始化你的项目，如果你不懂怎么填写一路回车也是可以的（终端会提示你输入一些项目信息）

创建一个二进制目录
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqB2SFd2Eib7LYSY3UqAJiatALAOcpRU9RZ33mLtzZ7B1D1F5AYndCaAHw/0?wx_fmt=png">

在 lowb 根目录下创建一个 bin 目录，我们将可执行文件存放在这里，此时你的项目结构是这样的：
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqfLv5Mpll8XKB3FYSFiabdvBNCc0EtsrcsIO7ZtJ4k02dw118KTkNSxA/0?wx_fmt=png">


<strong>光杆司令的做法</strong>


原理是解析Node中的进程对象&nbsp;process.argv

首先在 bin 目录下创建一个文件&nbsp;lowb.js&nbsp;作为我们的运行程序
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqm33Nmp2ZDibZibiaIjhbVic8lqsdI64m4jU2JtROHbTzNpBbUia9UcC8V7g/0?wx_fmt=png">

这段代码中非常简单，我们首先引入了&nbsp;fs&nbsp;模块和&nbsp;package.json&nbsp;的变量（用于获取版本号）。 然后编写了一个函数进行调用，里面只实现了一个&nbsp;-v&nbsp;和&nbsp;-h&nbsp;的命令。

process.argv&nbsp;是一个数组，第一个元素返回node执行路径，第二个元素是当前执行文件的路径， 从第三个开始是运行时带的参数


<strong>指定执行脚本</strong>


修改一下&nbsp;package.json
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqfFfDnU1PRYUZj9Pp1zGpqTG47KfvBmt1wZpS1WUqADibVSxoftqJs8Q/0?wx_fmt=png">

注意添加了&nbsp;bin&nbsp;这个参数，将&nbsp;lowb&nbsp;这个命令映射到&nbsp;bin/lowb.js&nbsp;这个文件， 我们打包安装后调用&nbsp;lowb&nbsp;命令会执行&nbsp;bin/lowb.js&nbsp;中的内容。


<strong>安装到本地</strong>


<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqvS6R7qWwQq7FIjUpIxOKUAAS4iaR1lQCE6QIpsjskj005d7jlSF7W1g/0?wx_fmt=png">

在 lowb 根目录下执行如上命令，你将看到类似如下的输出
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqgQGxHiasznGM500r9fd3tyfZmTziaHh5S8SDapMibwulxvMicWPVVpSG9g/0?wx_fmt=png">

此时已经将命令安装到本地了，我们可以试试在终端下运行了：
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqYLKaaQvp9nhhozH5qicuZYicFcdqr6wJQMBVOZqgsZAf6WIrv63w9Qhw/0?wx_fmt=png">


<strong>试试Commander.js</strong>


前面这种做法当然是可以完成一个命令行程序的，但这样的做法就像是在刀耕火种的时代，而且功能有限； 在前端界赫赫有名的工程师&nbsp;tj&nbsp;写了一个库&nbsp;commander.js&nbsp;就是帮助我们简化命令行程序开发。

它是受Ruby中的一个库&nbsp;commander&nbsp;而诞生，是一款轻量级表现力强大的命令行框架。

我们来使用这个工具完成今天要做的小玩意。


<strong>安装Commander.js</strong>


<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqJkMIasyfeXtygoRtictbC34zicWG2ho2YNzyyIzMLWIW3ibucWEoib19ZA/0?wx_fmt=png">


<strong>快速入门</strong>


<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqC4xBcIOarDRDd9TV8gLszcZvkOic99zSOwibTwbdkVMLl7MnaZVocP2A/0?wx_fmt=png">

这是官方README中的一段代码，我们写一个JS运行一下&nbsp;cmd -h&nbsp;看看
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScquicCXIBo5fGTAqqjA6sMGzKkTNT5aqJOUViagEscElaiaT5ia94iaokOibsg/0?wx_fmt=png">


<strong>常用api</strong>


commander.js&nbsp;中命令行有两种可变性，option：选项，command：命令。

<ul class=" list-paddingleft-2" style="">
<li>
通过option设置的选项可以通过program.chdir或者program.noTests来访问
</li>
<li>
通过command设置的命令通常在action回调中处理逻辑
</li>
</ul>

本文中没有用到command就不详述了。


<strong>开始干它一票吧</strong>


我们希望做出来的使用效果是这样的:
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqUDC2gOUeyQ01zjuhSSkNuUvuklViciaqic9f2iaFicqDHHRp7CeozrAceLg/0?wx_fmt=png">
<ul class=" list-paddingleft-2" style="">
<li>
<strong>-V, --version: </strong>
输出程序的版本号
</li>
<li>
<strong>-i, --index &lt;n&gt;:</strong>
 ascii动物的索引，默认是随机的
</li>
<li>
<strong>-t, --type &lt;value&gt;:</strong>
 输出文本的类型，名言、段子、唐诗、宋词，默认是名言
</li>
<li>
<strong>-h, --help: </strong>
帮助信息
</li>
</ul>

引入 commander
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqFFIpr40J9rzWbwtJ1ibBvGV0xPCTpeOL6ZPmG87owvZs00xtuYZt9Kg/0?wx_fmt=png">

编写命令处理的代码
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScq34AExLQX0Vkz6EeoPVnrnfLfMLkkJADaYYl2Aogeiax7PxFPp3d1CbA/0?wx_fmt=png">

<strong>option 的常用API</strong>

<strong></strong>

<ul class=" list-paddingleft-2" style="">
<li>
第一个参数是选项定义，分为短定义和长定义，用|，,，连接，参数可以用&lt;&gt;或者[]修饰，前者意为必须参数，后者意为可选参数
</li>
<li>
第二个参数为选项描述
</li>
<li>
第三个参数为选项参数默认值，可选
</li>
</ul>


<strong>准备原材料</strong>


什么原材料？我们需要输出ascii的动物图像和一些名言、段子等文本，这里数据我就存放在&nbsp;data目录下。 当然做的高级点你可以用爬虫~ 本文引砖抛玉了

我准备了&nbsp;animals.txt&nbsp;里面存放的是ascii的动物图像，像这样：
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqNdY6NBYstoLrK4jaq5fOwMKwGnIbyu1ceiaDricLNgtib6fOsXBic9ZErg/0?wx_fmt=png">
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqCe0KyvU477Sic4lbRGQs1beYoaxIWFFggFALruU4ib9LJe9pobV5zWYw/0?wx_fmt=png">

如果觉得这些你不喜欢可以上这里看看还有更多的小动物任你把玩。

还有&nbsp;段子，名言，唐诗，宋词&nbsp;的数据

将这5个文本数据存放在 data 目录下，使用JS变量存储一下
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqJ5K181RMMZh1e8PKAtKdmeDXnRb1qHO1ticzC3KsYMbo01zyNWLNRjw/0?wx_fmt=png">


<strong>读取数据</strong>


编写2个函数，一个用于产生随机的ascii动物文本，一个用于返回名言或段子
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqcupuJa5Rtahk2rSFfUJGd07MUOSFpBfZMjjicnwu1pehcJOBPfh8fDA/0?wx_fmt=png">

然后在命令解析的下面开始调用他们吧~
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqgCZkEThYLk2ZXTvsTuDmNhYf0hXajxV73iagHpicf8Ns0cWOD5CicmZfA/0?wx_fmt=png">

这里的逻辑非常简单，如果没有指定动物索引则随机获取一个小动物，否则取指定的。 然后输出名言/段子，输出一个小动物~ 大功告成


<strong>来试试吧</strong>


程序编写ok后我们安装到本地，然后执行&nbsp;lowb -t jokes&nbsp;试试看？
<img src="http://mmbiz.qpic.cn/mmbiz_png/eDpwXmSEM4H6leliaNWictwCxPLDECibScqpVyDrq3n7ypibecXZZjiaQOAkmCHKj0K5bMghYwdbdEJTv5lg0BQLzGw/0?wx_fmt=png">

默认输出的是名言，我加了-t参数指定来个段子。


<strong>发布到NPM仓库</strong>


我们希望所有人都可以下载到自己写的程序就需要将它发布到npm的仓库中， 发布前需要注册npm账号，顺手绑定一下你的github账号吧。注册ok后在项目根目录下执行 sudo npm publish 会提示你输入一下npm的账号和密码验证，完了就会推送到&nbsp;npmjs.org&nbsp;了，你可以搜到自己的程序。

像安装其他程序一样安装&nbsp;sudo npm install lowb -g（记得把本地安装的卸载了）
<br>
<br>
<br>
<br>

<script>
	var toc = $('#toc');
	$('strong').each(function(i) {
		var topic = $(this), topicNumber = i + 1;
		toc.append('<a href="#topic-'+topicNumber+'" target="_self">'+topic.text()+'</a><br>');
		topic.attr('id', 'topic-' + topicNumber);
	});
</script>
</body>
</html>
