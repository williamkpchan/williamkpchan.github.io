<html><head>
<meta charset="utf-8">

<style>
html {
  overflow:   scroll;
}
::-webkit-scrollbar {
    width: 0px;
    background: transparent; /* make scrollbar transparent */
}

a:hover,a:active{color:red}
table.w3-table-all{margin:20px 0}
.top {
 position:relative;
 background-color:black;
 height:68px;
 padding-top:20px;
 line-height:50px;
 overflow:hidden;
 z-index:2;
}
body {
 background-color: #000000;
 color: MediumSeaGreen;
 margin-left: 14%;
 margin-right: 14%;
 font-size: 24px;
}
a { text-decoration: none;
	color: #58D858;}
a:visited { color: #88C898;}
A:hover {	color: yellow;}
A:focus {	color: red;}
code { color: gray; background-color: #001010; font-size: 18px;}
pre { color: gray; background-color: #001010; font-size: 18px;}
h1, h2, h3, h4, h5, .goldword {
	color: gold;
}
table{
	width: 100%;
	font-size: 20px;
	border-collapse: collapse;
	border: 1px solid gray;
}
th{
	border: 1px solid gray;
	font-weight:bold;
	color: lightgreen;
}
td{
	padding:10px;
	border: 1px dotted dimgray;
}
tr>th:first-child{
	width:40%;
}
tr>td:first-child{
	color: lime;

}
img{
	margin-top:1%;
	margin-bottom:2%;
}
.topic{
    color: lime;
}
.goldsha {
    color: white;
    border: 1px solid gold;
    padding: 2px;
    border-radius: 3px;
	box-shadow: -2px -2px 3px gold inset;
}
.redsha {
    color: gold;
    border: 1px solid red;
    padding: 2px;
    border-radius: 3px;
	box-shadow: -2px -2px 3px red inset;
}
.whitesha {
    color: red;
    border: 1px solid white;
    padding: 2px;
    border-radius: 3px;
	box-shadow: -3px -2px 3px white inset;
}
.orangesha {
    color: yellow;
    border: 1px solid orange;
    padding: 2px;
    border-radius: 3px;
	box-shadow: -2px -2px 3px orange inset;
}
.yellowsha {
    color: lime;
    border: 1px solid yellow;
    padding: 2px;
    border-radius: 3px;
	box-shadow: 3px 3px 3px silver;
	display: inline-block;
}
.greensha {
    color: lightblue;
    border: 1px solid green;
    padding: 2px;
    border-radius: 3px;
	box-shadow: -2px -2px 3px green inset;
}
.left {
    position: absolute;
    left: 100px;
    color: GoldenRod;
    border: 1px solid GoldenRod;
    padding: 2px;
    font-size: 60%;
}
.bord {
    border: 1px solid GoldenRod;
    padding: 10px;
    font-size: 90%;
}
.bord b{color:gold;}
.yellowbord {
    color: lime;
    border: 1px solid yellow;
    padding: 2px;
    border-radius: 3px;
	box-shadow: 3px 3px 3px silver;
}
.bluebord {
    color: white;
    border: 1px solid lightblue;
    padding: 2px;
    border-radius: 3px;
	box-shadow: -2px -2px 3px silver inset;
}
.highlight { 
    color: white;
    background-color: #002030
  }
hr {width: 50%;}
li{
	list-style-type: decimal;
}
#toc, #tang, #san, #pill {
	margin-left: 15%;
	margin-right: 15%;
	color: gold;
	padding: 1%;
	text-align: left;
	box-shadow: 5px 5px 15px silver;
	border-radius: 5px;
	border: 1px solid DarkSlateGray;
    font-size: 90%;
}
.mywords{
    color: Crimson;
}
.orangeword{
    color: orange;
}
.remarks {
	font-size: 22px;
	color: MediumSeaGreen;
}
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, .topic').click(function(){
    parent.history.back();
    return false;
    });
});
</script>


</head>
<body>

<center><b>JavaScript Tutorial</b></center>
<div class="bord">
<center>Table of Contents</center><br>
<a href="#toc" target="_self">TOC section</a><br>
<a href="#PART1" target="_self"><b>PART 1</b></a><br>

<a href="#chapter-1" target="_self"><b>An introduction</b></a><br>
<a href="#chapter-3" target="_self">An Introduction to JavaScript</a>, <a href="#chapter-11" target="_self">Code editors</a>, <a href="#chapter-17" target="_self">Developer console</a><br>
<br>
<a href="#chapter-23" target="_self"><b>JavaScript Fundamentals</b></a><br>
<a href="#chapter-25" target="_self">Hello, world!</a>, <a href="#chapter-32" target="_self">Code structure</a>, <a href="#chapter-37" target="_self">The modern mode, "use strict"</a>, <a href="#chapter-38" target="_self">“use strict”</a>, <a href="#chapter-41" target="_self">Variables</a>, <a href="#chapter-50" target="_self">Data types</a>, <a href="#chapter-61" target="_self">Type Conversions</a>, <a href="#chapter-68" target="_self">Operators</a>, <a href="#chapter-82" target="_self">Comparisons</a>, <a href="#chapter-91" target="_self">Interaction: alert, prompt, confirm</a>, <a href="#chapter-98" target="_self">Conditional operators: if, '?'</a>, <a href="#chapter-108" target="_self">Logical operators</a>, <a href="#chapter-116" target="_self">Loops: while and for</a>, <a href="#chapter-126" target="_self">The "switch" statement</a>, <a href="#chapter-133" target="_self">Functions</a>, <a href="#chapter-145" target="_self">Function expressions and arrows</a>, <a href="#chapter-152" target="_self">JavaScript specials</a>, <br>
<br>
<a href="#chapter-163" target="_self"><b>Code quality</b></a><br>
<a href="#chapter-165" target="_self">Debugging in Chrome</a>, <a href="#chapter-175" target="_self">Coding style</a>, <a href="#chapter-35" target="_self">Comments</a>, <a href="#chapter-188" target="_self">Ninja code</a>, <a href="#chapter-203" target="_self">Automated testing with mocha</a>, <a href="#chapter-218" target="_self">Polyfills</a><br>
<br>
<a href="#chapter-222" target="_self"><b>Objects: the basics</b></a><br>
<a href="#chapter-224" target="_self">Objects</a>, <a href="#chapter-235" target="_self">Garbage collection</a>, <a href="#chapter-244" target="_self">Symbol type</a>, <a href="#chapter-251" target="_self">Object methods, "this"</a>, <a href="#chapter-260" target="_self">Object to primitive conversion</a>, <a href="#chapter-267" target="_self">Constructor, operator "new"</a><br>
<br>
<a href="#chapter-275" target="_self"><b>Data types</b></a><br>
<a href="#chapter-277" target="_self">Methods of primitives</a>, <a href="#chapter-282" target="_self">Numbers</a>, <a href="#chapter-293" target="_self">Strings</a>, <a href="#chapter-307" target="_self">Arrays</a>, <a href="#chapter-320" target="_self">Array methods</a>, <a href="#chapter-330" target="_self">Iterables</a>, <a href="#chapter-338" target="_self">Map, Set, WeakMap and WeakSet</a>, <a href="#chapter-348" target="_self">Object.keys, values, entries</a>, <a href="#chapter-353" target="_self">Destructuring assignment</a>, <a href="#chapter-361" target="_self">Date and time</a>, <a href="#chapter-373" target="_self">JSON methods, toJSON</a><br>
<br>
<a href="#chapter-383" target="_self"><b>Advanced working with functions</b></a><br>
<a href="#chapter-385" target="_self">Recursion and stack</a>, <a href="#chapter-393" target="_self">Rest parameters and spread operator</a>, <a href="#chapter-399" target="_self">Closure</a>, <a href="#chapter-410" target="_self">The old "var"</a>, <a href="#chapter-415" target="_self">Global object</a>, <a href="#chapter-419" target="_self">Function object, NFE</a>, <a href="#chapter-427" target="_self">The "new Function" syntax</a>, <a href="#chapter-432" target="_self">Scheduling: setTimeout and setInterval</a>, <a href="#chapter-440" target="_self">Decorators and forwarding, call/apply</a>, <a href="#chapter-448" target="_self">Function binding</a>, <a href="#chapter-455" target="_self">Currying and partials</a>, <a href="#chapter-463" target="_self">Arrow functions revisited</a><br>
<br>
<a href="#chapter-468" target="_self"><b>Objects, classes, inheritance</b></a><br>
<a href="#chapter-470" target="_self">Property flags and descriptors</a>, <a href="#chapter-479" target="_self">Property getters and setters</a>, <a href="#chapter-485" target="_self">Prototypal inheritance</a>, <a href="#chapter-492" target="_self">F.prototype</a>, <a href="#chapter-498" target="_self">Native prototypes</a>, <a href="#chapter-507" target="_self">Methods for prototypes</a>, <a href="#chapter-514" target="_self">Class patterns</a>, <a href="#chapter-522" target="_self">Classes</a>, <a href="#chapter-529" target="_self">Class inheritance, super</a>, <a href="#chapter-537" target="_self">Class checking: "instanceof"</a>, <a href="#chapter-543" target="_self">Mixins</a><br>
<br>
<a href="#chapter-548" target="_self"><b>Error handling</b></a><br>
<a href="#chapter-550" target="_self">Error handling, "try..catch"</a>, <a href="#chapter-561" target="_self">Custom errors, extending Error</a><br>
<br>
<a href="#PART2" target="_self"><b>PART 2</b></a><br>

<b>Browser: Document, Events, Interfaces</b><br>
<br>
<a href="#chapter-568" target="_self"><b>Document</b></a><br>
<a href="#chapter-570" target="_self">Browser environment, specs</a>, <a href="#chapter-575" target="_self">DOM tree</a>, <a href="#chapter-584" target="_self">Walking the DOM</a>, <a href="#chapter-593" target="_self">Searching: getElement* and querySelector*</a>, <a href="#chapter-604" target="_self">Node properties: type, tag and contents</a>, <a href="#chapter-617" target="_self">Attributes and properties</a>, <a href="#chapter-626" target="_self">Modifying the document</a>, <a href="#chapter-636" target="_self">Styles and classes</a>, <a href="#chapter-645" target="_self">Element size and scrolling</a>, <a href="#chapter-658" target="_self">Window sizes and scrolling</a>, <a href="#chapter-667" target="_self">Coordinates</a><br>
<br>
<a href="#chapter-676" target="_self"><b>Introduction into Events</b></a><br>
<a href="#chapter-678" target="_self">Introduction to browser events</a>, <a href="#chapter-688" target="_self">Bubbling and capturing</a>, <a href="#chapter-695" target="_self">Event delegation</a>, <a href="#chapter-701" target="_self">Browser default actions</a>, <a href="#chapter-708" target="_self">Dispatching custom events</a><br>
<br>
<a href="#chapter-718" target="_self"><b>Events in details</b></a><br>
<a href="#chapter-720" target="_self">Mouse events basics</a>, 
<a href="#chapter-729" target="_self">Moving: mouseover/out, mouseenter/leave</a>, <a href="#chapter-738" target="_self">Drag'n'Drop with mouse events</a>, <a href="#chapter-745" target="_self">Keyboard: keydown and keyup</a>, <a href="#chapter-754" target="_self">Scrolling</a>, <a href="#chapter-758" target="_self">Page lifecycle: DOMContentLoaded, load, beforeunload, unload</a>, <a href="#chapter-766" target="_self">Resource loading: onload and onerror</a><br>
<br>
<a href="#chapter-772" target="_self"><b>Forms, controls</b></a><br>
<a href="#chapter-774" target="_self">Form properties and methods</a>, <a href="#chapter-781" target="_self">Focusing: focus/blur</a>, <a href="#chapter-789" target="_self">Events: change, input, cut, copy, paste</a>, <a href="#chapter-796" target="_self">Form submission: event and method submit</a><br>
<br>
<a href="#PART3" target="_self"><b>PART 3</b></a><br>
<b>Additional articles</b><br>
<br>
<b>Animation</b><br>
<a href="#chapter-801" target="_self">Bezier curve</a>, <a href="#chapter-807" target="_self">CSS-animations</a>, <a href="#chapter-818" target="_self">JavaScript animations</a><br>
<br>
<b>Frames and windows</b><br>
<a href="#chapter-828" target="_self">Popups and window methods</a>, <a href="#chapter-839" target="_self">Cross-window communication</a>, <a href="#chapter-847" target="_self">The clickjacking attack</a><br>
<br>
<b>Regular expressions</b><br>
<a href="#chapter-855" target="_self">Patterns and flags</a>, <a href="#chapter-862" target="_self">Methods of RegExp and String</a>, <a href="#chapter-873" target="_self">Character classes</a>, <a href="#chapter-882" target="_self">Escaping, special characters</a>, Sets and ranges [...], <a href="#chapter-892" target="_self">The unicode flag</a>, <a href="#chapter-894" target="_self">Quantifiers +, *, ? and {n}</a>, <a href="#chapter-900" target="_self">Greedy and lazy quantifiers</a>, <a href="#chapter-907" target="_self">Capturing groups</a>, <a href="#chapter-914" target="_self">Backreferences: \n and $n</a>, <a href="#chapter-918" target="_self">Alternation (OR) |</a>, <a href="#chapter-922" target="_self">String start ^ and finish $</a>, <a href="#chapter-925" target="_self">Multiline mode, flag "m"</a>, <a href="#chapter-930" target="_self">Lookahead (in progress)</a>, <a href="#chapter-932" target="_self">Infinite backtracking problem</a>, <br>
<br>
<b>Promises, async/await</b><br>
<a href="#chapter-937" target="_self">Introduction: callbacks</a>, <a href="#chapter-943" target="_self">Promise</a>, <a href="#chapter-948" target="_self">Promises chaining</a>, <a href="#chapter-960" target="_self">Promise API</a>, <a href="#chapter-968" target="_self">Async/await</a><br>

</div><br>

<div id="toc">
<h5>Table Of Content</h5>
<br id="PART1">
<ul>
<a href="#chapter-1" target="_self">An introduction</a><br>
<a href="#chapter-2" target="_self"></a><br>
<a href="#chapter-3" target="_self">An Introduction to JavaScript</a><br>
<a href="#chapter-4" target="_self">What is JavaScript?</a><br>
<a href="#chapter-5" target="_self">What can in-browser JavaScript do?</a><br>
<a href="#chapter-6" target="_self">What CAN'T in-browser JavaScript do?</a><br>
<a href="#chapter-7" target="_self">What makes JavaScript unique?</a><br>
<a href="#chapter-8" target="_self">Languages “over” JavaScript</a><br>
<a href="#chapter-9" target="_self">Summary</a><br>
<a href="#chapter-10" target="_self"></a><br>
<a href="#chapter-11" target="_self">Code editors</a><br>
<a href="#chapter-12" target="_self">IDE</a><br>
<a href="#chapter-13" target="_self">Lightweight editors</a><br>
<a href="#chapter-14" target="_self">My favorites</a><br>
<a href="#chapter-15" target="_self">Let's not argue</a><br>
<a href="#chapter-16" target="_self"></a><br>
<a href="#chapter-17" target="_self">Developer console</a><br>
<a href="#chapter-18" target="_self">Google Chrome</a><br>
<a href="#chapter-19" target="_self">Firefox, Edge and others</a><br>
<a href="#chapter-20" target="_self">Safari</a><br>
<a href="#chapter-21" target="_self">Summary</a><br>
<a href="#chapter-22" target="_self"></a><br>
<a href="#chapter-23" target="_self">JavaScript Fundamentals</a><br>
<a href="#chapter-24" target="_self"></a><br>
<a href="#chapter-25" target="_self">Hello, world!</a><br>
<a href="#chapter-26" target="_self">The “script” tag</a><br>
<a href="#chapter-27" target="_self">The modern markup</a><br>
<a href="#chapter-28" target="_self">External scripts</a><br>
<a href="#chapter-29" target="_self">Summary</a><br>
<a href="#chapter-30" target="_self">Tasks</a><br>
<a href="#chapter-31" target="_self"></a><br>
<a href="#chapter-32" target="_self">Code structure</a><br>
<a href="#chapter-33" target="_self">Statements</a><br>
<a href="#chapter-34" target="_self">Semicolons</a><br>
<a href="#chapter-35" target="_self">Comments</a><br>
<a href="#chapter-36" target="_self"></a><br>
<a href="#chapter-37" target="_self">The modern mode, "use strict"</a><br>
<a href="#chapter-38" target="_self">“use strict”</a><br>
<a href="#chapter-39" target="_self">Always “use strict”</a><br>
<a href="#chapter-40" target="_self"></a><br>
<a href="#chapter-41" target="_self">Variables</a><br>
<a href="#chapter-42" target="_self">A variable</a><br>
<a href="#chapter-43" target="_self">A real-life analogy</a><br>
<a href="#chapter-44" target="_self">Variable naming</a><br>
<a href="#chapter-45" target="_self">Constants</a><br>
<a href="#chapter-46" target="_self">Name things right</a><br>
<a href="#chapter-47" target="_self">Summary</a><br>
<a href="#chapter-48" target="_self">Tasks</a><br>
<a href="#chapter-49" target="_self"></a><br>
<a href="#chapter-50" target="_self">Data types</a><br>
<a href="#chapter-51" target="_self">A number</a><br>
<a href="#chapter-52" target="_self">A string</a><br>
<a href="#chapter-53" target="_self">A boolean (logical type)</a><br>
<a href="#chapter-54" target="_self">The “null” value</a><br>
<a href="#chapter-55" target="_self">The “undefined” value</a><br>
<a href="#chapter-56" target="_self">Objects and Symbols</a><br>
<a href="#chapter-57" target="_self">The typeof operator</a><br>
<a href="#chapter-58" target="_self">Summary</a><br>
<a href="#chapter-59" target="_self">Tasks</a><br>
<a href="#chapter-60" target="_self"></a><br>
<a href="#chapter-61" target="_self">Type Conversions</a><br>
<a href="#chapter-62" target="_self">ToString</a><br>
<a href="#chapter-63" target="_self">ToNumber</a><br>
<a href="#chapter-64" target="_self">ToBoolean</a><br>
<a href="#chapter-65" target="_self">Summary</a><br>
<a href="#chapter-66" target="_self">Tasks</a><br>
<a href="#chapter-67" target="_self"></a><br>
<a href="#chapter-68" target="_self">Operators</a><br>
<a href="#chapter-69" target="_self">Terms: “unary”, “binary”, “operand”</a><br>
<a href="#chapter-70" target="_self">Strings concatenation, binary +</a><br>
<a href="#chapter-71" target="_self">Numeric conversion, unary +</a><br>
<a href="#chapter-72" target="_self">Operators precedence</a><br>
<a href="#chapter-73" target="_self">Assignment</a><br>
<a href="#chapter-74" target="_self">Remainder %</a><br>
<a href="#chapter-75" target="_self">Exponentiation **</a><br>
<a href="#chapter-76" target="_self">Increment/decrement</a><br>
<a href="#chapter-77" target="_self">Bitwise operators</a><br>
<a href="#chapter-78" target="_self">Modify-in-place</a><br>
<a href="#chapter-79" target="_self">Comma</a><br>
<a href="#chapter-80" target="_self">Tasks</a><br>
<a href="#chapter-81" target="_self"></a><br>
<a href="#chapter-82" target="_self">Comparisons</a><br>
<a href="#chapter-83" target="_self">Boolean is the result</a><br>
<a href="#chapter-84" target="_self">String comparison</a><br>
<a href="#chapter-85" target="_self">Comparison of different types</a><br>
<a href="#chapter-86" target="_self">Strict equality</a><br>
<a href="#chapter-87" target="_self">Comparison with null and undefined</a><br>
<a href="#chapter-88" target="_self">Summary</a><br>
<a href="#chapter-89" target="_self">Tasks</a><br>
<a href="#chapter-90" target="_self"></a><br>
<a href="#chapter-91" target="_self">Interaction: alert, prompt, confirm</a><br>
<a href="#chapter-92" target="_self">alert</a><br>
<a href="#chapter-93" target="_self">prompt</a><br>
<a href="#chapter-94" target="_self">confirm</a><br>
<a href="#chapter-95" target="_self">Summary</a><br>
<a href="#chapter-96" target="_self">Tasks</a><br>
<a href="#chapter-97" target="_self"></a><br>
<a href="#chapter-98" target="_self">Conditional operators: if, '?'</a><br>
<a href="#chapter-99" target="_self">The “if” statement</a><br>
<a href="#chapter-100" target="_self">Boolean conversion</a><br>
<a href="#chapter-101" target="_self">The “else” clause</a><br>
<a href="#chapter-102" target="_self">Several conditions: “else if”</a><br>
<a href="#chapter-103" target="_self">Ternary operator ‘?'</a><br>
<a href="#chapter-104" target="_self">Multiple ‘?'</a><br>
<a href="#chapter-105" target="_self">Non-traditional use of ‘?'</a><br>
<a href="#chapter-106" target="_self">Tasks</a><br>
<a href="#chapter-107" target="_self"></a><br>
<a href="#chapter-108" target="_self">Logical operators</a><br>
<a href="#chapter-109" target="_self">|| (OR)</a><br>
<a href="#chapter-110" target="_self">OR seeks the first truthy value</a><br>
<a href="#chapter-111" target="_self">&amp;&amp; (AND)</a><br>
<a href="#chapter-112" target="_self">AND seeks the first falsy value</a><br>
<a href="#chapter-113" target="_self">! (NOT)</a><br>
<a href="#chapter-114" target="_self">Tasks</a><br>
<a href="#chapter-115" target="_self"></a><br>
<a href="#chapter-116" target="_self">Loops: while and for</a><br>
<a href="#chapter-117" target="_self">The “while” loop</a><br>
<a href="#chapter-118" target="_self">The “do…while” loop</a><br>
<a href="#chapter-119" target="_self">The “for” loop</a><br>
<a href="#chapter-120" target="_self">Breaking the loop</a><br>
<a href="#chapter-121" target="_self">Continue to the next iteration</a><br>
<a href="#chapter-122" target="_self">Labels for break/continue</a><br>
<a href="#chapter-123" target="_self">Summary</a><br>
<a href="#chapter-124" target="_self">Tasks</a><br>
<a href="#chapter-125" target="_self"></a><br>
<a href="#chapter-126" target="_self">The "switch" statement</a><br>
<a href="#chapter-127" target="_self">The syntax</a><br>
<a href="#chapter-128" target="_self">An example</a><br>
<a href="#chapter-129" target="_self">Grouping of “case”</a><br>
<a href="#chapter-130" target="_self">Type matters</a><br>
<a href="#chapter-131" target="_self">Tasks</a><br>
<a href="#chapter-132" target="_self"></a><br>
<a href="#chapter-133" target="_self">Functions</a><br>
<a href="#chapter-134" target="_self">Function Declaration</a><br>
<a href="#chapter-135" target="_self">Local variables</a><br>
<a href="#chapter-136" target="_self">Outer variables</a><br>
<a href="#chapter-137" target="_self">Parameters</a><br>
<a href="#chapter-138" target="_self">Default values</a><br>
<a href="#chapter-139" target="_self">Returning a value</a><br>
<a href="#chapter-140" target="_self">Naming a function</a><br>
<a href="#chapter-141" target="_self">Functions == Comments</a><br>
<a href="#chapter-142" target="_self">Summary</a><br>
<a href="#chapter-143" target="_self">Tasks</a><br>
<a href="#chapter-144" target="_self"></a><br>
<a href="#chapter-145" target="_self">Function expressions and arrows</a><br>
<a href="#chapter-146" target="_self">Callback functions</a><br>
<a href="#chapter-147" target="_self">Function Expression vs Function Declaration</a><br>
<a href="#chapter-148" target="_self">Arrow functions</a><br>
<a href="#chapter-149" target="_self">Summary</a><br>
<a href="#chapter-150" target="_self">Tasks</a><br>
<a href="#chapter-151" target="_self"></a><br>
<a href="#chapter-152" target="_self">JavaScript specials</a><br>
<a href="#chapter-153" target="_self">Code structure</a><br>
<a href="#chapter-154" target="_self">Strict mode</a><br>
<a href="#chapter-155" target="_self">Variables</a><br>
<a href="#chapter-156" target="_self">Interaction</a><br>
<a href="#chapter-157" target="_self">Operators</a><br>
<a href="#chapter-158" target="_self">Loops</a><br>
<a href="#chapter-159" target="_self">The “switch” construct</a><br>
<a href="#chapter-160" target="_self">Functions</a><br>
<a href="#chapter-161" target="_self">More to come</a><br>
<a href="#chapter-162" target="_self"></a><br>
<a href="#chapter-163" target="_self">Code quality</a><br>
<a href="#chapter-164" target="_self"></a><br>
<a href="#chapter-165" target="_self">Debugging in Chrome</a><br>
<a href="#chapter-166" target="_self">The “sources” pane</a><br>
<a href="#chapter-167" target="_self">Console</a><br>
<a href="#chapter-168" target="_self">Breakpoints</a><br>
<a href="#chapter-169" target="_self">Debugger command</a><br>
<a href="#chapter-170" target="_self">Pause and look around</a><br>
<a href="#chapter-171" target="_self">Tracing the execution</a><br>
<a href="#chapter-172" target="_self">Logging</a><br>
<a href="#chapter-173" target="_self">Summary</a><br>
<a href="#chapter-174" target="_self"></a><br>
<a href="#chapter-175" target="_self">Coding style</a><br>
<a href="#chapter-176" target="_self">Syntax</a><br>
<a href="#chapter-177" target="_self">Functions below the code</a><br>
<a href="#chapter-178" target="_self">Style guides</a><br>
<a href="#chapter-179" target="_self">Automated linters</a><br>
<a href="#chapter-180" target="_self">Summary</a><br>
<a href="#chapter-181" target="_self">Tasks</a><br>
<a href="#chapter-182" target="_self"></a><br>
<a href="#chapter-183" target="_self">Comments</a><br>
<a href="#chapter-184" target="_self">Bad comments</a><br>
<a href="#chapter-185" target="_self">Good comments</a><br>
<a href="#chapter-186" target="_self">Summary</a><br>
<a href="#chapter-187" target="_self"></a><br>
<a href="#chapter-188" target="_self">Ninja code</a><br>
<a href="#chapter-189" target="_self">Brevity is the soul of wit</a><br>
<a href="#chapter-190" target="_self">One-letter variables</a><br>
<a href="#chapter-191" target="_self">Use abbreviations</a><br>
<a href="#chapter-192" target="_self">Soar high. Be abstract.</a><br>
<a href="#chapter-193" target="_self">Attention test</a><br>
<a href="#chapter-194" target="_self">Smart synonyms</a><br>
<a href="#chapter-195" target="_self">Reuse names</a><br>
<a href="#chapter-196" target="_self">Underscores for fun</a><br>
<a href="#chapter-197" target="_self">Show your love</a><br>
<a href="#chapter-198" target="_self">Overlap outer variables</a><br>
<a href="#chapter-199" target="_self">Side-effects everywhere!</a><br>
<a href="#chapter-200" target="_self">Powerful functions!</a><br>
<a href="#chapter-201" target="_self">Summary</a><br>
<a href="#chapter-202" target="_self"></a><br>
<a href="#chapter-203" target="_self">Automated testing with mocha</a><br>
<a href="#chapter-204" target="_self">Why we need tests?</a><br>
<a href="#chapter-205" target="_self">Behavior Driven Development (BDD)</a><br>
<a href="#chapter-206" target="_self">Development of “pow”: the spec</a><br>
<a href="#chapter-207" target="_self">The development flow</a><br>
<a href="#chapter-208" target="_self">The spec in action</a><br>
<a href="#chapter-209" target="_self">Initial implementation</a><br>
<a href="#chapter-210" target="_self">Improving the spec</a><br>
<a href="#chapter-211" target="_self">Improving the implementation</a><br>
<a href="#chapter-212" target="_self">Nested describe</a><br>
<a href="#chapter-213" target="_self">Extending the spec</a><br>
<a href="#chapter-214" target="_self">Summary</a><br>
<a href="#chapter-215" target="_self">What now?</a><br>
<a href="#chapter-216" target="_self">Tasks</a><br>
<a href="#chapter-217" target="_self"></a><br>
<a href="#chapter-218" target="_self">Polyfills</a><br>
<a href="#chapter-219" target="_self">Babel</a><br>
<a href="#chapter-220" target="_self">Examples in the tutorial</a><br>
<a href="#chapter-221" target="_self"></a><br>
<a href="#chapter-222" target="_self">Objects: the basics</a><br>
<a href="#chapter-223" target="_self"></a><br>
<a href="#chapter-224" target="_self">Objects</a><br>
<a href="#chapter-225" target="_self">Literals and properties</a><br>
<a href="#chapter-226" target="_self">Square brackets</a><br>
<a href="#chapter-227" target="_self">Property value shorthand</a><br>
<a href="#chapter-228" target="_self">Existence check</a><br>
<a href="#chapter-229" target="_self">The “for…in” loop</a><br>
<a href="#chapter-230" target="_self">Copying by reference</a><br>
<a href="#chapter-231" target="_self">Cloning and merging, Object.assign</a><br>
<a href="#chapter-232" target="_self">Summary</a><br>
<a href="#chapter-233" target="_self">Tasks</a><br>
<a href="#chapter-234" target="_self"></a><br>
<a href="#chapter-235" target="_self">Garbage collection</a><br>
<a href="#chapter-236" target="_self">Reachability</a><br>
<a href="#chapter-237" target="_self">A simple example</a><br>
<a href="#chapter-238" target="_self">Two references</a><br>
<a href="#chapter-239" target="_self">Interlinked objects</a><br>
<a href="#chapter-240" target="_self">Unreachable island</a><br>
<a href="#chapter-241" target="_self">Internal algorithms</a><br>
<a href="#chapter-242" target="_self">Summary</a><br>
<a href="#chapter-243" target="_self"></a><br>
<a href="#chapter-244" target="_self">Symbol type</a><br>
<a href="#chapter-245" target="_self">Symbols</a><br>
<a href="#chapter-246" target="_self">“Hidden” properties</a><br>
<a href="#chapter-247" target="_self">Global symbols</a><br>
<a href="#chapter-248" target="_self">System symbols</a><br>
<a href="#chapter-249" target="_self">Summary</a><br>
<a href="#chapter-250" target="_self"></a><br>
<a href="#chapter-251" target="_self">Object methods, "this"</a><br>
<a href="#chapter-252" target="_self">Method examples</a><br>
<a href="#chapter-253" target="_self">“this” in methods</a><br>
<a href="#chapter-254" target="_self">“this” is not bound</a><br>
<a href="#chapter-255" target="_self">Internals: Reference Type</a><br>
<a href="#chapter-256" target="_self">Arrow functions have no “this”</a><br>
<a href="#chapter-257" target="_self">Summary</a><br>
<a href="#chapter-258" target="_self">Tasks</a><br>
<a href="#chapter-259" target="_self"></a><br>
<a href="#chapter-260" target="_self">Object to primitive conversion</a><br>
<a href="#chapter-261" target="_self">ToPrimitive</a><br>
<a href="#chapter-262" target="_self">Symbol.toPrimitive</a><br>
<a href="#chapter-263" target="_self">toString/valueOf</a><br>
<a href="#chapter-264" target="_self">ToPrimitive and ToString/ToNumber</a><br>
<a href="#chapter-265" target="_self">Summary</a><br>
<a href="#chapter-266" target="_self"></a><br>
<a href="#chapter-267" target="_self">Constructor, operator "new"</a><br>
<a href="#chapter-268" target="_self">Constructor function</a><br>
<a href="#chapter-269" target="_self">Dual-syntax constructors: new.target</a><br>
<a href="#chapter-270" target="_self">Return from constructors</a><br>
<a href="#chapter-271" target="_self">Methods in constructor</a><br>
<a href="#chapter-272" target="_self">Summary</a><br>
<a href="#chapter-273" target="_self">Tasks</a><br>
<a href="#chapter-274" target="_self"></a><br>
<a href="#chapter-275" target="_self">Data types</a><br>
<a href="#chapter-276" target="_self"></a><br>
<a href="#chapter-277" target="_self">Methods of primitives</a><br>
<a href="#chapter-278" target="_self">A primitive as an object</a><br>
<a href="#chapter-279" target="_self">Summary</a><br>
<a href="#chapter-280" target="_self">Tasks</a><br>
<a href="#chapter-281" target="_self"></a><br>
<a href="#chapter-282" target="_self">Numbers</a><br>
<a href="#chapter-283" target="_self">More ways to write a number</a><br>
<a href="#chapter-284" target="_self">toString(base)</a><br>
<a href="#chapter-285" target="_self">Rounding</a><br>
<a href="#chapter-286" target="_self">Imprecise calculations</a><br>
<a href="#chapter-287" target="_self">Tests: isFinite and isNaN</a><br>
<a href="#chapter-288" target="_self">parseInt and parseFloat</a><br>
<a href="#chapter-289" target="_self">Other math functions</a><br>
<a href="#chapter-290" target="_self">Summary</a><br>
<a href="#chapter-291" target="_self">Tasks</a><br>
<a href="#chapter-292" target="_self"></a><br>
<a href="#chapter-293" target="_self">Strings</a><br>
<a href="#chapter-294" target="_self">Quotes</a><br>
<a href="#chapter-295" target="_self">Special characters</a><br>
<a href="#chapter-296" target="_self">String length</a><br>
<a href="#chapter-297" target="_self">Accessing characters</a><br>
<a href="#chapter-298" target="_self">Strings are immutable</a><br>
<a href="#chapter-299" target="_self">Changing the case</a><br>
<a href="#chapter-300" target="_self">Searching for a substring</a><br>
<a href="#chapter-301" target="_self">Getting a substring</a><br>
<a href="#chapter-302" target="_self">Comparing strings</a><br>
<a href="#chapter-303" target="_self">Internals, Unicode</a><br>
<a href="#chapter-304" target="_self">Summary</a><br>
<a href="#chapter-305" target="_self">Tasks</a><br>
<a href="#chapter-306" target="_self"></a><br>
<a href="#chapter-307" target="_self">Arrays</a><br>
<a href="#chapter-308" target="_self">Declaration</a><br>
<a href="#chapter-309" target="_self">Methods pop/push, shift/unshift</a><br>
<a href="#chapter-310" target="_self">Internals</a><br>
<a href="#chapter-311" target="_self">Performance</a><br>
<a href="#chapter-312" target="_self">Loops</a><br>
<a href="#chapter-313" target="_self">A word about “length”</a><br>
<a href="#chapter-314" target="_self">new Array()</a><br>
<a href="#chapter-315" target="_self">Multidimensional arrays</a><br>
<a href="#chapter-316" target="_self">toString</a><br>
<a href="#chapter-317" target="_self">Summary</a><br>
<a href="#chapter-318" target="_self">Tasks</a><br>
<a href="#chapter-319" target="_self"></a><br>
<a href="#chapter-320" target="_self">Array methods</a><br>
<a href="#chapter-321" target="_self">Add/remove items</a><br>
<a href="#chapter-322" target="_self">Searching in array</a><br>
<a href="#chapter-323" target="_self">Transform an array</a><br>
<a href="#chapter-324" target="_self">Iterate: forEach</a><br>
<a href="#chapter-325" target="_self">Array.isArray</a><br>
<a href="#chapter-326" target="_self">Most methods support “thisArg”</a><br>
<a href="#chapter-327" target="_self">Summary</a><br>
<a href="#chapter-328" target="_self">Tasks</a><br>
<a href="#chapter-329" target="_self"></a><br>
<a href="#chapter-330" target="_self">Iterables</a><br>
<a href="#chapter-331" target="_self">Symbol.iterator</a><br>
<a href="#chapter-332" target="_self">String is iterable</a><br>
<a href="#chapter-333" target="_self">Calling an iterator explicitly</a><br>
<a href="#chapter-334" target="_self">Iterables and array-likes</a><br>
<a href="#chapter-335" target="_self">Array.from</a><br>
<a href="#chapter-336" target="_self">Summary</a><br>
<a href="#chapter-337" target="_self"></a><br>
<a href="#chapter-338" target="_self">Map, Set, WeakMap and WeakSet</a><br>
<a href="#chapter-339" target="_self">Map</a><br>
<a href="#chapter-340" target="_self">Map from Object</a><br>
<a href="#chapter-341" target="_self">Iteration over Map</a><br>
<a href="#chapter-342" target="_self">Set</a><br>
<a href="#chapter-343" target="_self">Iteration over Set</a><br>
<a href="#chapter-344" target="_self">WeakMap and WeakSet</a><br>
<a href="#chapter-345" target="_self">Summary</a><br>
<a href="#chapter-346" target="_self">Tasks</a><br>
<a href="#chapter-347" target="_self"></a><br>
<a href="#chapter-348" target="_self">Object.keys, values, entries</a><br>
<a href="#chapter-349" target="_self">Object.keys, values, entries</a><br>
<a href="#chapter-350" target="_self">Object.keys/values/entries ignore symbolic properties</a><br>
<a href="#chapter-351" target="_self">Tasks</a><br>
<a href="#chapter-352" target="_self"></a><br>
<a href="#chapter-353" target="_self">Destructuring assignment</a><br>
<a href="#chapter-354" target="_self">Array destructuring</a><br>
<a href="#chapter-355" target="_self">Object destructuring</a><br>
<a href="#chapter-356" target="_self">Nested destructuring</a><br>
<a href="#chapter-357" target="_self">Smart function parameters</a><br>
<a href="#chapter-358" target="_self">Summary</a><br>
<a href="#chapter-359" target="_self">Tasks</a><br>
<a href="#chapter-360" target="_self"></a><br>
<a href="#chapter-361" target="_self">Date and time</a><br>
<a href="#chapter-362" target="_self">Creation</a><br>
<a href="#chapter-363" target="_self">Access date components</a><br>
<a href="#chapter-364" target="_self">Setting date components</a><br>
<a href="#chapter-365" target="_self">Autocorrection</a><br>
<a href="#chapter-366" target="_self">Date to number, date diff</a><br>
<a href="#chapter-367" target="_self">Date.now()</a><br>
<a href="#chapter-368" target="_self">Benchmarking</a><br>
<a href="#chapter-369" target="_self">Date.parse from a string</a><br>
<a href="#chapter-370" target="_self">Summary</a><br>
<a href="#chapter-371" target="_self">Tasks</a><br>
<a href="#chapter-372" target="_self"></a><br>
<a href="#chapter-373" target="_self">JSON methods, toJSON</a><br>
<a href="#chapter-374" target="_self">JSON.stringify</a><br>
<a href="#chapter-375" target="_self">Excluding and transforming: replacer</a><br>
<a href="#chapter-376" target="_self">Formatting: spacer</a><br>
<a href="#chapter-377" target="_self">Custom “toJSON”</a><br>
<a href="#chapter-378" target="_self">JSON.parse</a><br>
<a href="#chapter-379" target="_self">Using reviver</a><br>
<a href="#chapter-380" target="_self">Summary</a><br>
<a href="#chapter-381" target="_self">Tasks</a><br>
<a href="#chapter-382" target="_self"></a><br>
<a href="#chapter-383" target="_self">Advanced working with functions</a><br>
<a href="#chapter-384" target="_self"></a><br>
<a href="#chapter-385" target="_self">Recursion and stack</a><br>
<a href="#chapter-386" target="_self">Two ways of thinking</a><br>
<a href="#chapter-387" target="_self">The execution stack</a><br>
<a href="#chapter-388" target="_self">Recursive traversals</a><br>
<a href="#chapter-389" target="_self">Recursive structures</a><br>
<a href="#chapter-390" target="_self">Summary</a><br>
<a href="#chapter-391" target="_self">Tasks</a><br>
<a href="#chapter-392" target="_self"></a><br>
<a href="#chapter-393" target="_self">Rest parameters and spread operator</a><br>
<a href="#chapter-394" target="_self">Rest parameters ...</a><br>
<a href="#chapter-395" target="_self">The “arguments” variable</a><br>
<a href="#chapter-396" target="_self">Spread operator</a><br>
<a href="#chapter-397" target="_self">Summary</a><br>
<a href="#chapter-398" target="_self"></a><br>
<a href="#chapter-399" target="_self">Closure</a><br>
<a href="#chapter-400" target="_self">A couple of questions</a><br>
<a href="#chapter-401" target="_self">Lexical Environment</a><br>
<a href="#chapter-402" target="_self">Nested functions</a><br>
<a href="#chapter-403" target="_self">Environments in detail</a><br>
<a href="#chapter-404" target="_self">Code blocks and loops, IIFE</a><br>
<a href="#chapter-405" target="_self">If</a><br>
<a href="#chapter-406" target="_self">For, while</a><br>
<a href="#chapter-407" target="_self">Garbage collection</a><br>
<a href="#chapter-408" target="_self">Tasks</a><br>
<a href="#chapter-409" target="_self"></a><br>
<a href="#chapter-410" target="_self">The old "var"</a><br>
<a href="#chapter-411" target="_self">“var” has no block scope</a><br>
<a href="#chapter-412" target="_self">“var” are processed at the function start</a><br>
<a href="#chapter-413" target="_self">Summary</a><br>
<a href="#chapter-414" target="_self"></a><br>
<a href="#chapter-415" target="_self">Global object</a><br>
<a href="#chapter-416" target="_self">Uses of “window”</a><br>
<a href="#chapter-417" target="_self">“this” and global object</a><br>
<a href="#chapter-418" target="_self"></a><br>
<a href="#chapter-419" target="_self">Function object, NFE</a><br>
<a href="#chapter-420" target="_self">The “name” property</a><br>
<a href="#chapter-421" target="_self">The “length” property</a><br>
<a href="#chapter-422" target="_self">Custom properties</a><br>
<a href="#chapter-423" target="_self">Named Function Expression</a><br>
<a href="#chapter-424" target="_self">Summary</a><br>
<a href="#chapter-425" target="_self">Tasks</a><br>
<a href="#chapter-426" target="_self"></a><br>
<a href="#chapter-427" target="_self">The "new Function" syntax</a><br>
<a href="#chapter-428" target="_self">The syntax</a><br>
<a href="#chapter-429" target="_self">The closure</a><br>
<a href="#chapter-430" target="_self">Summary</a><br>
<a href="#chapter-431" target="_self"></a><br>
<a href="#chapter-432" target="_self">Scheduling: setTimeout and setInterval</a><br>
<a href="#chapter-433" target="_self">setTimeout</a><br>
<a href="#chapter-434" target="_self">setInterval</a><br>
<a href="#chapter-435" target="_self">Recursive setTimeout</a><br>
<a href="#chapter-436" target="_self">setTimeout(…,0)</a><br>
<a href="#chapter-437" target="_self">Summary</a><br>
<a href="#chapter-438" target="_self">Tasks</a><br>
<a href="#chapter-439" target="_self"></a><br>
<a href="#chapter-440" target="_self">Decorators and forwarding, call/apply</a><br>
<a href="#chapter-441" target="_self">Transparent caching</a><br>
<a href="#chapter-442" target="_self">Using “func.call” for the context</a><br>
<a href="#chapter-443" target="_self">Going multi-argument with “func.apply”</a><br>
<a href="#chapter-444" target="_self">Borrowing a method</a><br>
<a href="#chapter-445" target="_self">Summary</a><br>
<a href="#chapter-446" target="_self">Tasks</a><br>
<a href="#chapter-447" target="_self"></a><br>
<a href="#chapter-448" target="_self">Function binding</a><br>
<a href="#chapter-449" target="_self">Losing “this”</a><br>
<a href="#chapter-450" target="_self">Solution 1: a wrapper</a><br>
<a href="#chapter-451" target="_self">Solution 2: bind</a><br>
<a href="#chapter-452" target="_self">Summary</a><br>
<a href="#chapter-453" target="_self">Tasks</a><br>
<a href="#chapter-454" target="_self"></a><br>
<a href="#chapter-455" target="_self">Currying and partials</a><br>
<a href="#chapter-456" target="_self">Going partial without context</a><br>
<a href="#chapter-457" target="_self">Currying</a><br>
<a href="#chapter-458" target="_self">Currying? What for?</a><br>
<a href="#chapter-459" target="_self">Advanced curry implementation</a><br>
<a href="#chapter-460" target="_self">Summary</a><br>
<a href="#chapter-461" target="_self">Tasks</a><br>
<a href="#chapter-462" target="_self"></a><br>
<a href="#chapter-463" target="_self">Arrow functions revisited</a><br>
<a href="#chapter-464" target="_self">Arrow functions have no “this”</a><br>
<a href="#chapter-465" target="_self">Arrows have no “arguments”</a><br>
<a href="#chapter-466" target="_self">Summary</a><br>
<a href="#chapter-467" target="_self"></a><br>
<a href="#chapter-468" target="_self">Objects, classes, inheritance</a><br>
<a href="#chapter-469" target="_self"></a><br>
<a href="#chapter-470" target="_self">Property flags and descriptors</a><br>
<a href="#chapter-471" target="_self">Property flags</a><br>
<a href="#chapter-472" target="_self">Read-only</a><br>
<a href="#chapter-473" target="_self">Non-enumerable</a><br>
<a href="#chapter-474" target="_self">Non-configurable</a><br>
<a href="#chapter-475" target="_self">Object.defineProperties</a><br>
<a href="#chapter-476" target="_self">Object.getOwnPropertyDescriptors</a><br>
<a href="#chapter-477" target="_self">Sealing an object globally</a><br>
<a href="#chapter-478" target="_self"></a><br>
<a href="#chapter-479" target="_self">Property getters and setters</a><br>
<a href="#chapter-480" target="_self">Getters and setters</a><br>
<a href="#chapter-481" target="_self">Accessor descriptors</a><br>
<a href="#chapter-482" target="_self">Smarter getters/setters</a><br>
<a href="#chapter-483" target="_self">Using for compatibility</a><br>
<a href="#chapter-484" target="_self"></a><br>
<a href="#chapter-485" target="_self">Prototypal inheritance</a><br>
<a href="#chapter-486" target="_self">[[Prototype]]</a><br>
<a href="#chapter-487" target="_self">Read/write rules</a><br>
<a href="#chapter-488" target="_self">The value of “this”</a><br>
<a href="#chapter-489" target="_self">Summary</a><br>
<a href="#chapter-490" target="_self">Tasks</a><br>
<a href="#chapter-491" target="_self"></a><br>
<a href="#chapter-492" target="_self">F.prototype</a><br>
<a href="#chapter-493" target="_self">The “prototype” property</a><br>
<a href="#chapter-494" target="_self">Default F.prototype, constructor property</a><br>
<a href="#chapter-495" target="_self">Summary</a><br>
<a href="#chapter-496" target="_self">Tasks</a><br>
<a href="#chapter-497" target="_self"></a><br>
<a href="#chapter-498" target="_self">Native prototypes</a><br>
<a href="#chapter-499" target="_self">Object.prototype</a><br>
<a href="#chapter-500" target="_self">Other built-in prototypes</a><br>
<a href="#chapter-501" target="_self">Primitives</a><br>
<a href="#chapter-502" target="_self">Changing native prototypes</a><br>
<a href="#chapter-503" target="_self">Borrowing from prototypes</a><br>
<a href="#chapter-504" target="_self">Summary</a><br>
<a href="#chapter-505" target="_self">Tasks</a><br>
<a href="#chapter-506" target="_self"></a><br>
<a href="#chapter-507" target="_self">Methods for prototypes</a><br>
<a href="#chapter-508" target="_self">Brief history</a><br>
<a href="#chapter-509" target="_self">“Very plain” objects</a><br>
<a href="#chapter-510" target="_self">Getting all properties</a><br>
<a href="#chapter-511" target="_self">Summary</a><br>
<a href="#chapter-512" target="_self">Tasks</a><br>
<a href="#chapter-513" target="_self"></a><br>
<a href="#chapter-514" target="_self">Class patterns</a><br>
<a href="#chapter-515" target="_self">Functional class pattern</a><br>
<a href="#chapter-516" target="_self">Factory class pattern</a><br>
<a href="#chapter-517" target="_self">Prototype-based classes</a><br>
<a href="#chapter-518" target="_self">Prototype-based inheritance for classes</a><br>
<a href="#chapter-519" target="_self">Summary</a><br>
<a href="#chapter-520" target="_self">Tasks</a><br>
<a href="#chapter-521" target="_self"></a><br>
<a href="#chapter-522" target="_self">Classes</a><br>
<a href="#chapter-523" target="_self">The “class” syntax</a><br>
<a href="#chapter-524" target="_self">Class Expression</a><br>
<a href="#chapter-525" target="_self">Static methods</a><br>
<a href="#chapter-526" target="_self">Summary</a><br>
<a href="#chapter-527" target="_self">Tasks</a><br>
<a href="#chapter-528" target="_self"></a><br>
<a href="#chapter-529" target="_self">Class inheritance, super</a><br>
<a href="#chapter-530" target="_self">Overriding a method</a><br>
<a href="#chapter-531" target="_self">Overriding constructor</a><br>
<a href="#chapter-532" target="_self">Super: internals, [[HomeObject]]</a><br>
<a href="#chapter-533" target="_self">Static methods and inheritance</a><br>
<a href="#chapter-534" target="_self">Natives are extendable</a><br>
<a href="#chapter-535" target="_self">Tasks</a><br>
<a href="#chapter-536" target="_self"></a><br>
<a href="#chapter-537" target="_self">Class checking: "instanceof"</a><br>
<a href="#chapter-538" target="_self">The instanceof operator</a><br>
<a href="#chapter-539" target="_self">Bonus: Object toString for the type</a><br>
<a href="#chapter-540" target="_self">Summary</a><br>
<a href="#chapter-541" target="_self">Tasks</a><br>
<a href="#chapter-542" target="_self"></a><br>
<a href="#chapter-543" target="_self">Mixins</a><br>
<a href="#chapter-544" target="_self">A mixin example</a><br>
<a href="#chapter-545" target="_self">EventMixin</a><br>
<a href="#chapter-546" target="_self">Summary</a><br>
<a href="#chapter-547" target="_self"></a><br>
<a href="#chapter-548" target="_self">Error handling</a><br>
<a href="#chapter-549" target="_self"></a><br>
<a href="#chapter-550" target="_self">Error handling, "try..catch"</a><br>
<a href="#chapter-551" target="_self">The “try…catch” syntax</a><br>
<a href="#chapter-552" target="_self">Error object</a><br>
<a href="#chapter-553" target="_self">Using “try…catch”</a><br>
<a href="#chapter-554" target="_self">Throwing our own errors</a><br>
<a href="#chapter-555" target="_self">Rethrowing</a><br>
<a href="#chapter-556" target="_self">try…catch…finally</a><br>
<a href="#chapter-557" target="_self">Global catch</a><br>
<a href="#chapter-558" target="_self">Summary</a><br>
<a href="#chapter-559" target="_self">Tasks</a><br>
<a href="#chapter-560" target="_self"></a><br>
<a href="#chapter-561" target="_self">Custom errors, extending Error</a><br>
<a href="#chapter-562" target="_self">Extending Error</a><br>
<a href="#chapter-563" target="_self">Further inheritance</a><br>
<a href="#chapter-564" target="_self">Wrapping exceptions</a><br>
<a href="#chapter-565" target="_self">Summary</a><br>
<a href="#chapter-566" target="_self">Tasks</a><br>
<a href="#chapter-567" target="_self"></a>
<br id="PART2">
<a href="#chapter-568" target="_self">Document</a><br>
<a href="#chapter-569" target="_self"></a><br>
<a href="#chapter-570" target="_self">Browser environment, specs</a><br>
<a href="#chapter-571" target="_self">Document Object Model (DOM)</a><br>
<a href="#chapter-572" target="_self">BOM (part of HTML spec)</a><br>
<a href="#chapter-573" target="_self">Summary</a><br>
<a href="#chapter-574" target="_self"></a><br>
<a href="#chapter-575" target="_self">DOM tree</a><br>
<a href="#chapter-576" target="_self">An example of DOM</a><br>
<a href="#chapter-577" target="_self">Autocorrection</a><br>
<a href="#chapter-578" target="_self">Other node types</a><br>
<a href="#chapter-579" target="_self">See it yourself</a><br>
<a href="#chapter-580" target="_self">In the browser inspector</a><br>
<a href="#chapter-581" target="_self">Interaction with console</a><br>
<a href="#chapter-582" target="_self">Summary</a><br>
<a href="#chapter-583" target="_self"></a><br>
<a href="#chapter-584" target="_self">Walking the DOM</a><br>
<a href="#chapter-585" target="_self">On top: documentElement and body</a><br>
<a href="#chapter-586" target="_self">Children: childNodes, firstChild, lastChild</a><br>
<a href="#chapter-587" target="_self">Siblings and the parent</a><br>
<a href="#chapter-588" target="_self">Element-only navigation</a><br>
<a href="#chapter-589" target="_self">More links: tables</a><br>
<a href="#chapter-590" target="_self">Summary</a><br>
<a href="#chapter-591" target="_self">Tasks</a><br>
<a href="#chapter-592" target="_self"></a><br>
<a href="#chapter-593" target="_self">Searching: getElement* and querySelector*</a><br>
<a href="#chapter-594" target="_self">document.getElementById or just id</a><br>
<a href="#chapter-595" target="_self">getElementsBy*</a><br>
<a href="#chapter-596" target="_self">querySelectorAll</a><br>
<a href="#chapter-597" target="_self">querySelector</a><br>
<a href="#chapter-598" target="_self">matches</a><br>
<a href="#chapter-599" target="_self">closest</a><br>
<a href="#chapter-600" target="_self">Live collections</a><br>
<a href="#chapter-601" target="_self">Summary</a><br>
<a href="#chapter-602" target="_self">Tasks</a><br>
<a href="#chapter-603" target="_self"></a><br>
<a href="#chapter-604" target="_self">Node properties: type, tag and contents</a><br>
<a href="#chapter-605" target="_self">DOM node classes</a><br>
<a href="#chapter-606" target="_self">The “nodeType” property</a><br>
<a href="#chapter-607" target="_self">Tag: nodeName and tagName</a><br>
<a href="#chapter-608" target="_self">innerHTML: the contents</a><br>
<a href="#chapter-609" target="_self">outerHTML: full HTML of the element</a><br>
<a href="#chapter-610" target="_self">nodeValue/data: text node content</a><br>
<a href="#chapter-611" target="_self">textContent: pure text</a><br>
<a href="#chapter-612" target="_self">The “hidden” property</a><br>
<a href="#chapter-613" target="_self">More properties</a><br>
<a href="#chapter-614" target="_self">Summary</a><br>
<a href="#chapter-615" target="_self">Tasks</a><br>
<a href="#chapter-616" target="_self"></a><br>
<a href="#chapter-617" target="_self">Attributes and properties</a><br>
<a href="#chapter-618" target="_self">DOM properties</a><br>
<a href="#chapter-619" target="_self">HTML attributes</a><br>
<a href="#chapter-620" target="_self">Property-attribute synchronization</a><br>
<a href="#chapter-621" target="_self">DOM properties are typed</a><br>
<a href="#chapter-622" target="_self">Non-standard attributes, dataset</a><br>
<a href="#chapter-623" target="_self">Summary</a><br>
<a href="#chapter-624" target="_self">Tasks</a><br>
<a href="#chapter-625" target="_self"></a><br>
<a href="#chapter-626" target="_self">Modifying the document</a><br>
<a href="#chapter-627" target="_self">Example: show a message</a><br>
<a href="#chapter-628" target="_self">Creating an element</a><br>
<a href="#chapter-629" target="_self">Insertion methods</a><br>
<a href="#chapter-630" target="_self">Cloning nodes: cloneNode</a><br>
<a href="#chapter-631" target="_self">Removal methods</a><br>
<a href="#chapter-632" target="_self">A word about “document.write”</a><br>
<a href="#chapter-633" target="_self">Summary</a><br>
<a href="#chapter-634" target="_self">Tasks</a><br>
<a href="#chapter-635" target="_self"></a><br>
<a href="#chapter-636" target="_self">Styles and classes</a><br>
<a href="#chapter-637" target="_self">className and classList</a><br>
<a href="#chapter-638" target="_self">Element style</a><br>
<a href="#chapter-639" target="_self">Resetting the style property</a><br>
<a href="#chapter-640" target="_self">Mind the units</a><br>
<a href="#chapter-641" target="_self">Computed styles: getComputedStyle</a><br>
<a href="#chapter-642" target="_self">Summary</a><br>
<a href="#chapter-643" target="_self">Tasks</a><br>
<a href="#chapter-644" target="_self"></a><br>
<a href="#chapter-645" target="_self">Element size and scrolling</a><br>
<a href="#chapter-646" target="_self">Sample element</a><br>
<a href="#chapter-647" target="_self">Geometry</a><br>
<a href="#chapter-648" target="_self">offsetParent, offsetLeft/Top</a><br>
<a href="#chapter-649" target="_self">offsetWidth/Height</a><br>
<a href="#chapter-650" target="_self">clientTop/Left</a><br>
<a href="#chapter-651" target="_self">clientWidth/Height</a><br>
<a href="#chapter-652" target="_self">scrollWidth/Height</a><br>
<a href="#chapter-653" target="_self">scrollLeft/scrollTop</a><br>
<a href="#chapter-654" target="_self">Don't take width/height from CSS</a><br>
<a href="#chapter-655" target="_self">Summary</a><br>
<a href="#chapter-656" target="_self">Tasks</a><br>
<a href="#chapter-657" target="_self"></a><br>
<a href="#chapter-658" target="_self">Window sizes and scrolling</a><br>
<a href="#chapter-659" target="_self">Width/height of the window</a><br>
<a href="#chapter-660" target="_self">Width/height of the document</a><br>
<a href="#chapter-661" target="_self">Get the current scroll</a><br>
<a href="#chapter-662" target="_self">Scrolling: scrollTo, scrollBy, scrollIntoView</a><br>
<a href="#chapter-663" target="_self">scrollIntoView</a><br>
<a href="#chapter-664" target="_self">Forbid the scrolling</a><br>
<a href="#chapter-665" target="_self">Summary</a><br>
<a href="#chapter-666" target="_self"></a><br>
<a href="#chapter-667" target="_self">Coordinates</a><br>
<a href="#chapter-668" target="_self">Window coordinates: getBoundingClientRect</a><br>
<a href="#chapter-669" target="_self">elementFromPoint(x, y)</a><br>
<a href="#chapter-670" target="_self">Using for position:fixed</a><br>
<a href="#chapter-671" target="_self">Document coordinates</a><br>
<a href="#chapter-672" target="_self">Getting document coordinates</a><br>
<a href="#chapter-673" target="_self">Summary</a><br>
<a href="#chapter-674" target="_self">Tasks</a><br>
<a href="#chapter-675" target="_self"></a><br>
<a href="#chapter-676" target="_self">Introduction into Events</a><br>
<a href="#chapter-677" target="_self"></a><br>
<a href="#chapter-678" target="_self">Introduction to browser events</a><br>
<a href="#chapter-679" target="_self">Event handlers</a><br>
<a href="#chapter-680" target="_self">Accessing the element: this</a><br>
<a href="#chapter-681" target="_self">Possible mistakes</a><br>
<a href="#chapter-682" target="_self">addEventListener</a><br>
<a href="#chapter-683" target="_self">Event object</a><br>
<a href="#chapter-684" target="_self">Object handlers: handleEvent</a><br>
<a href="#chapter-685" target="_self">Summary</a><br>
<a href="#chapter-686" target="_self">Tasks</a><br>
<a href="#chapter-687" target="_self"></a><br>
<a href="#chapter-688" target="_self">Bubbling and capturing</a><br>
<a href="#chapter-689" target="_self">Bubbling</a><br>
<a href="#chapter-690" target="_self">event.target</a><br>
<a href="#chapter-691" target="_self">Stopping bubbling</a><br>
<a href="#chapter-692" target="_self">Capturing</a><br>
<a href="#chapter-693" target="_self">Summary</a><br>
<a href="#chapter-694" target="_self"></a><br>
<a href="#chapter-695" target="_self">Event delegation</a><br>
<a href="#chapter-696" target="_self">Delegation example: actions in markup</a><br>
<a href="#chapter-697" target="_self">The “behavior” pattern</a><br>
<a href="#chapter-698" target="_self">Summary</a><br>
<a href="#chapter-699" target="_self">Tasks</a><br>
<a href="#chapter-700" target="_self"></a><br>
<a href="#chapter-701" target="_self">Browser default actions</a><br>
<a href="#chapter-702" target="_self">Preventing browser actions</a><br>
<a href="#chapter-703" target="_self">Prevent further events</a><br>
<a href="#chapter-704" target="_self">event.defaultPrevented</a><br>
<a href="#chapter-705" target="_self">Summary</a><br>
<a href="#chapter-706" target="_self">Tasks</a><br>
<a href="#chapter-707" target="_self"></a><br>
<a href="#chapter-708" target="_self">Dispatching custom events</a><br>
<a href="#chapter-709" target="_self">Event constructor</a><br>
<a href="#chapter-710" target="_self">dispatchEvent</a><br>
<a href="#chapter-711" target="_self">Bubbling example</a><br>
<a href="#chapter-712" target="_self">MouseEvent, KeyboardEvent and others</a><br>
<a href="#chapter-713" target="_self">Custom events</a><br>
<a href="#chapter-714" target="_self">event.preventDefault()</a><br>
<a href="#chapter-715" target="_self">Events-in-events are synchronous</a><br>
<a href="#chapter-716" target="_self">Summary</a><br>
<a href="#chapter-717" target="_self"></a><br>
<a href="#chapter-718" target="_self">Events in details</a><br>
<a href="#chapter-719" target="_self"></a><br>
<a href="#chapter-720" target="_self">Mouse events basics</a><br>
<a href="#chapter-721" target="_self">Mouse event types</a><br>
<a href="#chapter-722" target="_self">Getting the button: which</a><br>
<a href="#chapter-723" target="_self">Modifiers: shift, alt, ctrl and meta</a><br>
<a href="#chapter-724" target="_self">Coordinates: clientX/Y, pageX/Y</a><br>
<a href="#chapter-725" target="_self">No selection on mousedown</a><br>
<a href="#chapter-726" target="_self">Summary</a><br>
<a href="#chapter-727" target="_self">Tasks</a><br>
<a href="#chapter-728" target="_self"></a><br>
<a href="#chapter-729" target="_self">Moving: mouseover/out, mouseenter/leave</a><br>
<a href="#chapter-730" target="_self">Mouseover/mouseout, relatedTarget</a><br>
<a href="#chapter-731" target="_self">Events frequency</a><br>
<a href="#chapter-732" target="_self">“Extra” mouseout when leaving for a child</a><br>
<a href="#chapter-733" target="_self">Events mouseenter and mouseleave</a><br>
<a href="#chapter-734" target="_self">Event delegation</a><br>
<a href="#chapter-735" target="_self">Summary</a><br>
<a href="#chapter-736" target="_self">Tasks</a><br>
<a href="#chapter-737" target="_self"></a><br>
<a href="#chapter-738" target="_self">Drag'n'Drop with mouse events</a><br>
<a href="#chapter-739" target="_self">Drag'n'Drop algorithm</a><br>
<a href="#chapter-740" target="_self">Correct positioning</a><br>
<a href="#chapter-741" target="_self">Detecting droppables</a><br>
<a href="#chapter-742" target="_self">Summary</a><br>
<a href="#chapter-743" target="_self">Tasks</a><br>
<a href="#chapter-744" target="_self"></a><br>
<a href="#chapter-745" target="_self">Keyboard: keydown and keyup</a><br>
<a href="#chapter-746" target="_self">Teststand</a><br>
<a href="#chapter-747" target="_self">Keydown and keyup</a><br>
<a href="#chapter-748" target="_self">Auto-repeat</a><br>
<a href="#chapter-749" target="_self">Default actions</a><br>
<a href="#chapter-750" target="_self">Legacy</a><br>
<a href="#chapter-751" target="_self">Summary</a><br>
<a href="#chapter-752" target="_self">Tasks</a><br>
<a href="#chapter-753" target="_self"></a><br>
<a href="#chapter-754" target="_self">Scrolling</a><br>
<a href="#chapter-755" target="_self">Prevent scrolling</a><br>
<a href="#chapter-756" target="_self">Tasks</a><br>
<a href="#chapter-757" target="_self"></a><br>
<a href="#chapter-758" target="_self">Page lifecycle: DOMContentLoaded, load, beforeunload, unload</a><br>
<a href="#chapter-759" target="_self">DOMContentLoaded</a><br>
<a href="#chapter-760" target="_self">window.onload</a><br>
<a href="#chapter-761" target="_self">window.onunload</a><br>
<a href="#chapter-762" target="_self">window.onbeforeunload</a><br>
<a href="#chapter-763" target="_self">readyState</a><br>
<a href="#chapter-764" target="_self">Summary</a><br>
<a href="#chapter-765" target="_self"></a><br>
<a href="#chapter-766" target="_self">Resource loading: onload and onerror</a><br>
<a href="#chapter-767" target="_self">Loading a script</a><br>
<a href="#chapter-768" target="_self">Other resources</a><br>
<a href="#chapter-769" target="_self">Summary</a><br>
<a href="#chapter-770" target="_self">Tasks</a><br>
<a href="#chapter-771" target="_self"></a><br>
<a href="#chapter-772" target="_self">Forms, controls</a><br>
<a href="#chapter-773" target="_self"></a><br>
<a href="#chapter-774" target="_self">Form properties and methods</a><br>
<a href="#chapter-775" target="_self">Navigation: form and elements</a><br>
<a href="#chapter-776" target="_self">Backreference: element.form</a><br>
<a href="#chapter-777" target="_self">Form elements</a><br>
<a href="#chapter-778" target="_self">Summary</a><br>
<a href="#chapter-779" target="_self">Tasks</a><br>
<a href="#chapter-780" target="_self"></a><br>
<a href="#chapter-781" target="_self">Focusing: focus/blur</a><br>
<a href="#chapter-782" target="_self">Events focus/blur</a><br>
<a href="#chapter-783" target="_self">Methods focus/blur</a><br>
<a href="#chapter-784" target="_self">Allow focusing on any element: tabindex</a><br>
<a href="#chapter-785" target="_self">Delegation: focusin/focusout</a><br>
<a href="#chapter-786" target="_self">Summary</a><br>
<a href="#chapter-787" target="_self">Tasks</a><br>
<a href="#chapter-788" target="_self"></a><br>
<a href="#chapter-789" target="_self">Events: change, input, cut, copy, paste</a><br>
<a href="#chapter-790" target="_self">Event: change</a><br>
<a href="#chapter-791" target="_self">Event: input</a><br>
<a href="#chapter-792" target="_self">Events: cut, copy, paste</a><br>
<a href="#chapter-793" target="_self">Summary</a><br>
<a href="#chapter-794" target="_self">Tasks</a><br>
<a href="#chapter-795" target="_self"></a><br>
<a href="#chapter-796" target="_self">Form submission: event and method submit</a><br>
<a href="#chapter-797" target="_self">Event: submit</a><br>
<a href="#chapter-798" target="_self">Method: submit</a><br>
<a href="#chapter-799" target="_self">Tasks</a><br>
<a href="#chapter-800" target="_self"></a>
<br id="PART3">
<a href="#chapter-801" target="_self">Bezier curve</a><br>
<a href="#chapter-802" target="_self">Control points</a><br>
<a href="#chapter-803" target="_self">Maths</a><br>
<a href="#chapter-804" target="_self">De Casteljau's algorithm</a><br>
<a href="#chapter-805" target="_self">Summary</a><br>
<a href="#chapter-806" target="_self"></a><br>
<a href="#chapter-807" target="_self">CSS-animations</a><br>
<a href="#chapter-808" target="_self">CSS transitions</a><br>
<a href="#chapter-809" target="_self">transition-property</a><br>
<a href="#chapter-810" target="_self">transition-duration</a><br>
<a href="#chapter-811" target="_self">transition-delay</a><br>
<a href="#chapter-812" target="_self">transition-timing-function</a><br>
<a href="#chapter-813" target="_self">Event transitionend</a><br>
<a href="#chapter-814" target="_self">Keyframes</a><br>
<a href="#chapter-815" target="_self">Summary</a><br>
<a href="#chapter-816" target="_self">Tasks</a><br>
<a href="#chapter-817" target="_self"></a><br>
<a href="#chapter-818" target="_self">JavaScript animations</a><br>
<a href="#chapter-819" target="_self">setInterval</a><br>
<a href="#chapter-820" target="_self">requestAnimationFrame</a><br>
<a href="#chapter-821" target="_self">Structured animation</a><br>
<a href="#chapter-822" target="_self">Timing functions</a><br>
<a href="#chapter-823" target="_self">Reversal: ease*</a><br>
<a href="#chapter-824" target="_self">More interesting “draw”</a><br>
<a href="#chapter-825" target="_self">Summary</a><br>
<a href="#chapter-826" target="_self">Tasks</a><br>
<a href="#chapter-827" target="_self"></a><br>
<a href="#chapter-828" target="_self">Popups and window methods</a><br>
<a href="#chapter-829" target="_self">Popup blocking</a><br>
<a href="#chapter-830" target="_self">Modern usage</a><br>
<a href="#chapter-831" target="_self">window.open</a><br>
<a href="#chapter-832" target="_self">Example: a minimalistic window</a><br>
<a href="#chapter-833" target="_self">Accessing a popup</a><br>
<a href="#chapter-834" target="_self">Accessing the opener window</a><br>
<a href="#chapter-835" target="_self">Closing a popup</a><br>
<a href="#chapter-836" target="_self">Focus/blur on a popup</a><br>
<a href="#chapter-837" target="_self">Summary</a><br>
<a href="#chapter-838" target="_self"></a><br>
<a href="#chapter-839" target="_self">Cross-window communication</a><br>
<a href="#chapter-840" target="_self">Same Origin</a><br>
<a href="#chapter-841" target="_self">Accessing an iframe contents</a><br>
<a href="#chapter-842" target="_self">window.frames</a><br>
<a href="#chapter-843" target="_self">The sandbox attribute</a><br>
<a href="#chapter-844" target="_self">Cross-window messaging</a><br>
<a href="#chapter-845" target="_self">Summary</a><br>
<a href="#chapter-846" target="_self"></a><br>
<a href="#chapter-847" target="_self">The clickjacking attack</a><br>
<a href="#chapter-848" target="_self">The idea</a><br>
<a href="#chapter-849" target="_self">The demo</a><br>
<a href="#chapter-850" target="_self">Old-school defences (weak)</a><br>
<a href="#chapter-851" target="_self">X-Frame-Options</a><br>
<a href="#chapter-852" target="_self">Showing with disabled functionality</a><br>
<a href="#chapter-853" target="_self">Summary</a><br>
<a href="#chapter-854" target="_self"></a><br>
<a href="#chapter-855" target="_self">Patterns and flags</a><br>
<a href="#chapter-856" target="_self">Regular expressions</a><br>
<a href="#chapter-857" target="_self">Usage</a><br>
<a href="#chapter-858" target="_self">Flags</a><br>
<a href="#chapter-859" target="_self">The “i” flag</a><br>
<a href="#chapter-860" target="_self">Summary</a><br>
<a href="#chapter-861" target="_self"></a><br>
<a href="#chapter-862" target="_self">Methods of RegExp and String</a><br>
<a href="#chapter-863" target="_self">str.search(reg)</a><br>
<a href="#chapter-864" target="_self">str.match(reg), no “g” flag</a><br>
<a href="#chapter-865" target="_self">str.match(reg) with “g” flag</a><br>
<a href="#chapter-866" target="_self">str.split(regexp|substr, limit)</a><br>
<a href="#chapter-867" target="_self">str.replace(str|reg, str|func)</a><br>
<a href="#chapter-868" target="_self">regexp.test(str)</a><br>
<a href="#chapter-869" target="_self">regexp.exec(str)</a><br>
<a href="#chapter-870" target="_self">The "y" flag</a><br>
<a href="#chapter-871" target="_self">Summary, recipes</a><br>
<a href="#chapter-872" target="_self"></a><br>
<a href="#chapter-873" target="_self">Character classes</a><br>
<a href="#chapter-874" target="_self">Most used classes: \d \s \w</a><br>
<a href="#chapter-875" target="_self">Word boundary: \b</a><br>
<a href="#chapter-876" target="_self">Reverse classes</a><br>
<a href="#chapter-877" target="_self">Spaces are regular characters</a><br>
<a href="#chapter-878" target="_self">A dot is any character</a><br>
<a href="#chapter-879" target="_self">Summary</a><br>
<a href="#chapter-880" target="_self">Tasks</a><br>
<a href="#chapter-881" target="_self"></a><br>
<a href="#chapter-882" target="_self">Escaping, special characters</a><br>
<a href="#chapter-883" target="_self">Escaping</a><br>
<a href="#chapter-884" target="_self">A slash</a><br>
<a href="#chapter-885" target="_self">new RegExp</a><br>
<a href="#chapter-886" target="_self">Sets</a><br>
<a href="#chapter-887" target="_self">Ranges</a><br>
<a href="#chapter-888" target="_self">Excluding ranges</a><br>
<a href="#chapter-889" target="_self">No escaping in […]</a><br>
<a href="#chapter-890" target="_self">Tasks</a><br>
<a href="#chapter-891" target="_self"></a><br>
<a href="#chapter-892" target="_self">The unicode flag</a><br>
<a href="#chapter-893" target="_self"></a><br>
<a href="#chapter-894" target="_self">Quantifiers +, *, ? and {n}</a><br>
<a href="#chapter-895" target="_self">Quantity {n}</a><br>
<a href="#chapter-896" target="_self">Shorthands</a><br>
<a href="#chapter-897" target="_self">More examples</a><br>
<a href="#chapter-898" target="_self">Tasks</a><br>
<a href="#chapter-899" target="_self"></a><br>
<a href="#chapter-900" target="_self">Greedy and lazy quantifiers</a><br>
<a href="#chapter-901" target="_self">Greedy search</a><br>
<a href="#chapter-902" target="_self">Lazy mode</a><br>
<a href="#chapter-903" target="_self">Alternative approach</a><br>
<a href="#chapter-904" target="_self">Summary</a><br>
<a href="#chapter-905" target="_self">Tasks</a><br>
<a href="#chapter-906" target="_self"></a><br>
<a href="#chapter-907" target="_self">Capturing groups</a><br>
<a href="#chapter-908" target="_self">Example</a><br>
<a href="#chapter-909" target="_self">Contents of parentheses</a><br>
<a href="#chapter-910" target="_self">Nested groups</a><br>
<a href="#chapter-911" target="_self">Non-capturing groups with ?:</a><br>
<a href="#chapter-912" target="_self">Tasks</a><br>
<a href="#chapter-913" target="_self"></a><br>
<a href="#chapter-914" target="_self">Backreferences: \n and $n</a><br>
<a href="#chapter-915" target="_self">Group in replacement: $n</a><br>
<a href="#chapter-916" target="_self">Group in pattern: \n</a><br>
<a href="#chapter-917" target="_self"></a><br>
<a href="#chapter-918" target="_self">Alternation (OR) |</a><br>
<a href="#chapter-919" target="_self">Regexp for time</a><br>
<a href="#chapter-920" target="_self">Tasks</a><br>
<a href="#chapter-921" target="_self"></a><br>
<a href="#chapter-922" target="_self">String start ^ and finish $</a><br>
<a href="#chapter-923" target="_self">Tasks</a><br>
<a href="#chapter-924" target="_self"></a><br>
<a href="#chapter-925" target="_self">Multiline mode, flag "m"</a><br>
<a href="#chapter-926" target="_self">Line start ^</a><br>
<a href="#chapter-927" target="_self">Line end $</a><br>
<a href="#chapter-928" target="_self">Anchors ^$ versus \n</a><br>
<a href="#chapter-929" target="_self"></a><br>
<a href="#chapter-930" target="_self">Lookahead (in progress)</a><br>
<a href="#chapter-931" target="_self"></a><br>
<a href="#chapter-932" target="_self">Infinite backtracking problem</a><br>
<a href="#chapter-933" target="_self">Example</a><br>
<a href="#chapter-934" target="_self">Backtracking</a><br>
<a href="#chapter-935" target="_self">How to fix?</a><br>
<a href="#chapter-936" target="_self"></a><br>
<a href="#chapter-937" target="_self">Introduction: callbacks</a><br>
<a href="#chapter-938" target="_self">Callback in callback</a><br>
<a href="#chapter-939" target="_self">Handling errors</a><br>
<a href="#chapter-940" target="_self">Pyramid of doom</a><br>
<a href="#chapter-941" target="_self">Tasks</a><br>
<a href="#chapter-942" target="_self"></a><br>
<a href="#chapter-943" target="_self">Promise</a><br>
<a href="#chapter-944" target="_self">Consumers: “.then” and “.catch”</a><br>
<a href="#chapter-945" target="_self">Example: loadScript</a><br>
<a href="#chapter-946" target="_self">Tasks</a><br>
<a href="#chapter-947" target="_self"></a><br>
<a href="#chapter-948" target="_self">Promises chaining</a><br>
<a href="#chapter-949" target="_self">Returning promises</a><br>
<a href="#chapter-950" target="_self">Example: loadScript</a><br>
<a href="#chapter-951" target="_self">Bigger example: fetch</a><br>
<a href="#chapter-952" target="_self">Error handling</a><br>
<a href="#chapter-953" target="_self">Implicit try…catch</a><br>
<a href="#chapter-954" target="_self">Rethrowing</a><br>
<a href="#chapter-955" target="_self">Fetch error handling example</a><br>
<a href="#chapter-956" target="_self">Unhandled rejections</a><br>
<a href="#chapter-957" target="_self">Summary</a><br>
<a href="#chapter-958" target="_self">Tasks</a><br>
<a href="#chapter-959" target="_self"></a><br>
<a href="#chapter-960" target="_self">Promise API</a><br>
<a href="#chapter-961" target="_self">Promise.resolve</a><br>
<a href="#chapter-962" target="_self">Promise.reject</a><br>
<a href="#chapter-963" target="_self">Promise.all</a><br>
<a href="#chapter-964" target="_self">Promise.race</a><br>
<a href="#chapter-965" target="_self">Summary</a><br>
<a href="#chapter-966" target="_self">Tasks</a><br>
<a href="#chapter-967" target="_self"></a><br>
<a href="#chapter-968" target="_self">Async/await</a><br>
<a href="#chapter-969" target="_self">Async functions</a><br>
<a href="#chapter-970" target="_self">Await</a><br>
<a href="#chapter-971" target="_self">Error handling</a><br>
<a href="#chapter-972" target="_self">Summary</a><br>
<a href="#chapter-973" target="_self">Tasks</a><br></ul></div>
<br>
<br>
<br>

<h1 class="main__header-title" id="chapter-1">An introduction</h1>
<h4 class="sidebar__section-title">Sibling chapters</h4><nav class="sidebar__navigation"><ul><li>
<a href="http://javascript.info/getting-started" class="sidebar__link">An introduction</a></li><li>
<a href="http://javascript.info/first-steps" class="sidebar__link">JavaScript Fundamentals</a></li><li>
<a href="http://javascript.info/code-quality" class="sidebar__link">Code quality</a></li><li>
<a href="http://javascript.info/object-basics" class="sidebar__link">Objects: the basics</a></li><li>
<a href="http://javascript.info/data-types" class="sidebar__link">Data types</a></li><li>
<a href="http://javascript.info/advanced-functions" class="sidebar__link">Advanced working with functions</a></li><li>
<a href="http://javascript.info/object-oriented-programming" class="sidebar__link">Objects, classes, inheritance</a></li><li>
<a href="http://javascript.info/error-handling" class="sidebar__link">Error handling</a></li></ul></nav>

<h6 id="chapter-2"></h6>
<h1 class="main__header-title" id="chapter-3">An Introduction to JavaScript</h1>
<p>Let's see what's so special about JavaScript, what we can achieve with it and which other technologies play well with it.</p>
<h2 id="chapter-4">
What is JavaScript?</h2>
<p><em>JavaScript</em> was initially created to <em>“make webpages alive”</em>.</p>
<p>The programs in this language are called <em>scripts</em>. They can be written right in the HTML and execute automatically as the page loads.</p>
<p>Scripts are provided and executed as a plain text. They don't need a special preparation or a compilation to run.</p>
<p>In this aspect, JavaScript is very different from another language called 
<a href="http://en.wikipedia.org/wiki/Java">Java</a>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Why <u>Java</u>Script?</span></div>
            <div class="important__content"><p>When JavaScript was created, it initially had another name: “LiveScript”. But Java language was very popular at that time, so it was decided that positioning a new language as a “younger brother” of Java would help.</p>
<p>But as it evolved, JavaScript became a fully independent language, with its own specification called 
<a href="http://en.wikipedia.org/wiki/ECMAScript">ECMAScript</a>, and now it has no relation to Java at all.</p>
</div></div>
<p>At present, JavaScript can execute not only in the browser, but also on the server, or actually on any device where there exists a special program called 
<a href="https://en.wikipedia.org/wiki/JavaScript_engine">the JavaScript engine</a>.</p>
<p>The browser has an embedded engine, sometimes it's also called a “JavaScript virtual machine”.</p>
<p>Different engines have different “codenames”, for example:</p>
<ul>
<li>
<a href="https://en.wikipedia.org/wiki/V8_(JavaScript_engine)">V8</a> – in Chrome and Opera.</li>
<li>
<a href="https://en.wikipedia.org/wiki/SpiderMonkey">SpiderMonkey</a> – in Firefox.</li>
<li>…There are other codenames like “Trident”, “Chakra” for different versions of IE, “ChakraCore” for Microsoft Edge, “Nitro” and “SquirrelFish” for Safari etc.</li>
</ul>
<p>The terms above are good to remember, because they are used in developer articles on the internet. We'll use them too. For instance, if “a feature X is supported by V8”, then it probably works in Chrome and Opera.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">How engines work?</span></div>
            <div class="important__content"><p>Engines are complicated. But the basics are easy.</p>
<ol>
<li>The engine (embedded if it's a browser) reads (“parses”) the script.</li>
<li>Then it converts (“compiles”) the script to the machine language.</li>
<li>And then the machine code runs, pretty fast.</li>
</ol>
<p>The engine applies optimizations on every stage of the process. It even watches the compiled script as it runs, analyzes the data that flows through it and applies optimizations to the machine code based on that knowledge. At the end, scripts are quite fast.</p>
</div></div>
<h2 id="chapter-5">
What can in-browser JavaScript do?</h2>
<p>The modern JavaScript is a “safe” programming language. It does not provide low-level access to memory or CPU, because it was initially created for browsers which do not require it.</p>
<p>The capabilities greatly depend on the environment that runs JavaScript. For instance, 
<a href="https://wikipedia.org/wiki/Node.js">Node.JS</a> supports functions that allow JavaScript to read/write arbitrary files, perform network requests etc.</p>
<p>In-browser JavaScript can do everything related to webpage manipulation, interaction with the user and the webserver.</p>
<p>For instance, in-browser JavaScript is able to:</p>
<ul>
<li>Add new HTML to the page, change the existing content, modify styles.</li>
<li>React to user actions, run on mouse clicks, pointer movements, key presses.</li>
<li>Send requests over the network to remote servers, download and upload files (so-called 
<a href="https://en.wikipedia.org/wiki/Ajax_(programming)">AJAX</a> and 
<a href="https://en.wikipedia.org/wiki/Comet_(programming)">COMET</a> technologies).</li>
<li>Get and set cookies, ask questions to the visitor, show messages.</li>
<li>Remember the data on the client-side (“local storage”).</li>
</ul>
<h2 id="chapter-6">
What CAN'T in-browser JavaScript do?</h2>
<p>JavaScript's abilities in the browser are limited for the sake of the user's safety. The aim is to prevent an evil webpage from accessing private information or harming the user's data.</p>
<p>The examples of such restrictions are:</p>
<ul>
<li>
<p>JavaScript on a webpage may not read/write arbitrary files on the hard disk, copy them or execute programs. It has no direct access to OS system functions.</p>
<p>Modern browsers allow it to work with files, but the access is limited and only provided if the user does certain actions, like “dropping” a file into a browser window or selecting it via an <code>&lt;input&gt;</code> tag.</p>
<p>There are ways to interact with camera/microphone and other devices, but they require a user's explicit permission. So a JavaScript-enabled page may not sneakily enable a web-camera, observe the surroundings and send the information to the 
<a href="https://en.wikipedia.org/wiki/National_Security_Agency">NSA</a>.</p>
</li>
<li>
<p>Different tabs/windows generally do not know about each other. Sometimes they do, for example when one window uses JavaScript to open the other one. But even in this case, JavaScript from one page may not access the other if they come from different sites (from a different domain, protocol or port).</p>
<p>This is called the “Same Origin Policy”. To work around that, <em>both pages</em> must contain a special JavaScript code that handles data exchange.</p>
<p>The limitation is again for user's safety. A page from <code>http://anysite.com</code> which a user has opened must not be able to access another browser tab with the URL <code>http://gmail.com</code> and steal information from there.</p>
</li>
<li>
<p>JavaScript can easily communicate over the net to the server where the current page came from. But its ability to receive data from other sites/domains is crippled. Though possible, it requires explicit agreement (expressed in HTTP headers) from the remote side. Once again, that's safety limitations.</p>
</li>
</ul>
      <img src="http://javascript.info/article/intro/limitations.png">
<p>Such limits do not exist if JavaScript is used outside of the browser, for example on a server. Modern browsers also allow installing plugin/extensions which may get extended permissions.</p>
<h2 id="chapter-7">
What makes JavaScript unique?</h2>
<p>There are at least <em>three</em> great things about JavaScript:</p>
<div class="balance balance_single"><div class="balance__pluses"><div class="balance__content"><ul class="balance__list"><li>Full integration with HTML/CSS.</li>
<li>Simple things done simply.</li>
<li>Supported by all major browsers and enabled by default.</li>
</ul></div></div></div><p>Combined, these three things exist only in JavaScript and no other browser technology.</p>
<p>That's what makes JavaScript unique. That's why it's the most widespread tool to create browser interfaces.</p>
<p>While planning to learn a new technology, it's beneficial to check its perspectives. So let's move on to the modern trends that include new languages and browser abilities.</p>
<h2 id="chapter-8">
Languages “over” JavaScript</h2>
<p>The syntax of JavaScript does not suit everyone's needs. Different people want different features.</p>
<p>That's to be expected, because projects and requirements are different for everyone.</p>
<p>So recently a plethora of new languages appeared, which are <em>transpiled</em> (converted) to JavaScript before they run in the browser.</p>
<p>Modern tools make the transpilation very fast and transparent, actually allowing developers to code in another language and autoconverting it “under the hood”.</p>
<p>Examples of such languages:</p>
<ul>
<li>
<a href="http://coffeescript.org/">CoffeeScript</a> is a “syntactic sugar” for JavaScript, it introduces shorter syntax, allowing to write more precise and clear code. Usually Ruby devs like it.</li>
<li>
<a href="http://www.typescriptlang.org/">TypeScript</a> is concentrated on adding “strict data typing”, to simplify development and support of complex systems. It is developed by Microsoft.</li>
<li>
<a href="https://www.dartlang.org/">Dart</a> is a standalone language that has its own engine that runs in non-browser environments (like mobile apps). It was initially offered by Google as a replacement for JavaScript, but as of now, browsers require it to be transpiled to JavaScript just like the ones above.</li>
</ul>
<p>There are more. Of course even if we use one of those languages, we should also know JavaScript, to really understand what we're doing.</p>
<h2 id="chapter-9">
Summary</h2>
<ul>
<li>JavaScript was initially created as a browser-only language, but now it is used in many other environments as well.</li>
<li>At this moment, JavaScript has a unique position as the most widely-adopted browser language with full integration with HTML/CSS.</li>
<li>There are many languages that get “transpiled” to JavaScript and provide certain features. It is recommended to take a look at them, at least briefly, after mastering JavaScript.</li>
</ul>

<h6 id="chapter-10"></h6>
<h1 class="main__header-title" id="chapter-11">Code editors</h1>
<p>A code editor is the place where a programmer spends most of his time.</p>
<p>There are two archetypes: IDE and lightweight editors. Many people feel comfortable choosing one tool of each type.</p>


<h2 id="chapter-12">
IDE</h2>
<p>The term 
<a href="https://en.wikipedia.org/wiki/Integrated_development_environment">IDE</a> (Integrated Development Environment) means a powerful editor with many features that usually operates on a “whole project”. As said, that's not just an editor, but a full-scale “development environment”.</p>
<p>An IDE loads the project (can be many files), and then allows navigation between files, provides autocompletion based on the whole project, integrates with a version management system (like 
<a href="https://git-scm.com/">git</a>), a testing environment and other “project-level” stuff.</p>
<p>If you haven't considered selecting an IDE yet, look at the following variants:</p>
<ul>
<li>IntelliJ editors: 
<a href="http://www.jetbrains.com/webstorm/">WebStorm</a> for frontend development and 
<a href="http://www.jetbrains.com/phpstorm/">PHPStorm (PHP)</a>, 
<a href="http://www.jetbrains.com/idea/">IDEA (Java)</a>, 
<a href="http://www.jetbrains.com/ruby/">RubyMine (Ruby)</a> and others if you need additional languages.</li>
<li>Visual Studio is fine if you're a .NET developer, and a free version is available (
<a href="https://www.visualstudio.com/vs/community/">Visual Studio Community</a>)</li>
<li>Eclipse-based products, like 
<a href="http://www.aptana.com/">Aptana</a> and Zend Studio.</li>
<li>
<a href="http://www.activestate.com/komodo-ide">Komodo IDE</a> and its lightweight free version 
<a href="http://www.activestate.com/komodo-edit">Komodo Edit</a>.</li>
<li>
<a href="http://netbeans.org/">Netbeans</a>.</li>
</ul>
<p>All of the IDEs listed above are available on both Windows and Mac, and the IDEs other than Visual Studio are also available on Linux.</p>
<p>Most IDEs are paid, but have a trial period. Their cost is usually negligible compared to a qualified developer's salary, so just choose the best one for you.</p>
<h2 id="chapter-13">
Lightweight editors</h2>
<p>“Lightweight editors” are not as powerful as IDEs, but they're fast, elegant and simple.</p>
<p>They are mainly used to instantly open and edit a file.</p>
<p>The main difference between a “lightweight editor” and an “IDE” is that an IDE works on a project-level, so it loads much more data on start, analyzes the project structure if needed and so on. A lightweight editor is much faster if we need only one file.</p>
<p>In practice, lightweight editors may have a lot of plugins including directory-level syntax analyzers and autocompleters, so there's no strict border between a lightweight editor and an IDE.</p>
<p>The following options deserve your attention:</p>
<ul>
<li>
<a href="https://code.visualstudio.com/">Visual Studio Code</a> (cross-platform, free).</li>
<li>
<a href="https://atom.io/">Atom</a> (cross-platform, free).</li>
<li>
<a href="http://www.sublimetext.com">Sublime Text</a> (cross-platform, shareware).</li>
<li>
<a href="https://notepad-plus-plus.org/">Notepad++</a> (Windows, free).</li>
<li>Vim and Emacs are also cool, if you know how to use them.</li>
</ul>
<h2 id="chapter-14">
My favorites</h2>
<p>The personal preference of the author is to have both an IDE for projects and a lightweight editor for quick and easy file editing.</p>
<p>I'm using:</p>
<ul>
<li>
<a href="http://www.jetbrains.com/webstorm/">WebStorm</a> for JS, and if there is one more language in the project, then I switch to other Jetbrains editors like 
<a href="http://www.jetbrains.com/phpstorm/">PHPStorm</a> (PHP), 
<a href="http://www.jetbrains.com/idea/">IDEA</a> (Java), 
<a href="http://www.jetbrains.com/ruby/">RubyMine</a> (Ruby). There are editors for other languages too, but I haven't used them.</li>
<li>As a lightweight editor – 
<a href="http://www.sublimetext.com">Sublime Text</a> or 
<a href="https://atom.io/">Atom</a>.</li>
</ul>
<p>If you don't know what to choose, you can consider these ones.</p>
<h2 id="chapter-15">
Let's not argue</h2>
<p>The editors in the lists above are those that either I or my friends who I consider good developers have been using for a long time and are happy with.</p>
<p>There are other great editors in our big world. Please choose the one you like the most.</p>
<p>The choice of an editor, like any other tool, is individual and depends on your projects, habits, personal preferences.</p>

<h6 id="chapter-16"></h6>
<h1 class="main__header-title" id="chapter-17">Developer console</h1>
<p>Code is prone to errors. You are quite likely to make errors… Oh, what am I talking about? You are <em>absolutely</em> going to make errors, at least if you're a human, not a 
<a href="https://en.wikipedia.org/wiki/Bender_(Futurama)">robot</a>.</p>
<p>But in the browser, a user doesn't see the errors by default. So, if something goes wrong in the script, we won't see what's broken and can't fix it.</p>
<p>To see errors and get a lot of other useful information about scripts, browsers have embedded “developer tools”.</p>
<p>Most often developers lean towards Chrome or Firefox for development, because those browsers have the best developer tools. Other browsers also provide developer tools, sometimes with special features, but are usually playing “catch-up” to Chrome or Firefox. So most people have a “favorite” browser and switch to others if a problem is browser-specific.</p>
<p>Developer tools are really powerful, there are many features. To start, we'll learn how to open them, look at errors and run JavaScript commands.</p>


<h2 id="chapter-18">
Google Chrome</h2>
<p>Open the page 
<a href="http://javascript.info/article/devtools/bug.html">bug.html</a>.</p>
<p>There's an error in the JavaScript code on it. It's hidden from a regular visitor's eyes, so let's open developer tools to see it.</p>
<p>Press <kbd class="shortcut">F12</kbd> or, if you're on Mac, then <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>Opt<span class="shortcut__plus">+</span>J</kbd>.</p>
<p>The developer tools will open on the Console tab by default.</p>
<p>It looks somewhat like this:</p>
      <img src="http://javascript.info/article/devtools/chrome.png">
<p>The exact look of developer tools depends on your version of Chrome. It changes from time to time, but should be similar.</p>
<ul>
<li>Here we can see the red-colored error message. In this case the script contains an unknown “lalala” command.</li>
<li>On the right, there is a clickable link to the source <code>bug.html:12</code> with the line number where the error has occurred.</li>
</ul>
<p>Below the error message there is a blue <code>&gt;</code> symbol. It marks a “command line” where we can type JavaScript commands and press <kbd class="shortcut">Enter</kbd> to run them (<kbd class="shortcut">Shift<span class="shortcut__plus">+</span>Enter</kbd> to input multi-line commands).</p>
<p>Now we can see errors and that's enough for the start. We'll be back to developer tools later and cover debugging more in-depth in the chapter 
<a href="http://javascript.info/debugging-chrome">Debugging in Chrome</a>.</p>
<h2 id="chapter-19">
Firefox, Edge and others</h2>
<p>Most other browsers use <kbd class="shortcut">F12</kbd> to open developer tools.</p>
<p>The look &amp; feel of them is quite similar. Once you know how to use one of them (you can start with Chrome), you can easily switch to another.</p>
<h2 id="chapter-20">
Safari</h2>
<p>Safari (Mac browser, not supported by Windows/Linux) is a little bit special here. We need to enable the “Develop menu” first.</p>
<p>Open Preferences and go to “Advanced” pane. There's a checkbox at the bottom:</p>
      <img src="http://javascript.info/article/devtools/safari.png">
<p>Now <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>Opt<span class="shortcut__plus">+</span>C</kbd> can toggle the console. Also note that the new top menu item named “Develop” has appeared. It has many commands and options.</p>
<h2 id="chapter-21">
Summary</h2>
<ul>
<li>Developer tools allow us to see errors, run commands, examine variables and much more.</li>
<li>They can be opened with <kbd class="shortcut">F12</kbd> for most browsers under Windows. Chrome for Mac needs <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>Opt<span class="shortcut__plus">+</span>J</kbd>, Safari: <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>Opt<span class="shortcut__plus">+</span>C</kbd> (need to enable first).</li>
</ul>
<p>Now we have the environment ready. In the next section we'll get down to JavaScript.</p>

<h6 id="chapter-22"></h6>
<h1 class="main__header-title" id="chapter-23">JavaScript Fundamentals</h1>
<p>Let's learn the fundamentals of script building.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/hello-world" class="lessons-list__link">Hello, world!</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/structure" class="lessons-list__link">Code structure</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/strict-mode" class="lessons-list__link">The modern mode, "use strict"</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/variables" class="lessons-list__link">Variables</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/types" class="lessons-list__link">Data types</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/type-conversions" class="lessons-list__link">Type Conversions</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/operators" class="lessons-list__link">Operators</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/comparison" class="lessons-list__link">Comparisons</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/alert-prompt-confirm" class="lessons-list__link">Interaction: alert, prompt, confirm</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/ifelse" class="lessons-list__link">Conditional operators: if, '?'</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/logical-operators" class="lessons-list__link">Logical operators</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/while-for" class="lessons-list__link">Loops: while and for</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/switch" class="lessons-list__link">The "switch" statement</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/function-basics" class="lessons-list__link">Functions</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/function-expressions-arrows" class="lessons-list__link">Function expressions and arrows</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/javascript-specials" class="lessons-list__link">JavaScript specials</a></li></ol></div>

<h6 id="chapter-24"></h6>
<h1 class="main__header-title" id="chapter-25">Hello, world!</h1>
<p>The tutorial that you're reading is about core JavaScript, which is platform-independent. Further on, you will learn Node.JS and other platforms that use it.</p>
<p>But, we need a working environment to run our scripts, and, just because this book is online, the browser is a good choice. We'll keep the amount of browser-specific commands (like <code>alert</code>) to a minimum, so that you don't spend time on them if you plan to concentrate on another environment like Node.JS. On the other hand, browser details are explained in detail in the 
<a href="http://javascript.info/ui">next part</a> of the tutorial.</p>
<p>So first, let's see how to attach a script to a webpage. For server-side environments, you can just execute it with a command like <code>"node my.js"</code> for Node.JS.</p>


<h2 id="chapter-26">
The “script” tag</h2>
<p>JavaScript programs can be inserted in any part of an HTML document with the help of the <code>&lt;script&gt;</code> tag.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="100" data-highlight-block="7-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;body&gt;

  &lt;p&gt;Before the script...&lt;/p&gt;

  &lt;script&gt;
    alert( 'Hello, world!' );
  &lt;/script&gt;

  &lt;p&gt;...After the script.&lt;/p&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>You can run the example by clicking on the “Play” button in its right-top corner.</p>
<p>The <code>&lt;script&gt;</code> tag contains JavaScript code which is automatically executed when the browser meets the tag.</p>
<h2 id="chapter-27">
The modern markup</h2>
<p>The <code>&lt;script&gt;</code> tag has a few attributes that are rarely used nowadays, but we can find them in old code:</p>
<dl>
<dt>The <code>type</code> attribute: <code>&lt;script <u>type</u>=…&gt;</code></dt>
<dd>
<p>The old standard HTML4 required a script to have a type. Usually it was <code>type="text/javascript"</code>. The modern HTML standard assumes this <code>type</code> by default. No attribute is required.</p>
</dd>
<dt>The <code>language</code> attribute: <code>&lt;script <u>language</u>=…&gt;</code></dt>
<dd>
<p>This attribute was meant to show the language of the script. As of now, this attribute makes no sense, the language is JavaScript by default. No need to use it.</p>
</dd>
<dt>Comments before and after scripts.</dt>
<dd>
<p>In really ancient books and guides, one may find comments inside <code>&lt;script&gt;</code>, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script type="text/javascript"&gt;&lt;!--
    ...
//--&gt;&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>These comments were supposed to hide the code from an old browser that didn't know about a <code>&lt;script&gt;</code> tag. But all browsers born in the past 15+ years don't have any issues. We mention it here, because such comments serve as a sign. If you see that somewhere – that code is probably really old and not worth looking into.</p>
</dd>
</dl>
<h2 id="chapter-28">
External scripts</h2>
<p>If we have a lot of JavaScript code, we can put it into a separate file.</p>
<p>The script file is attached to HTML with the <code>src</code> attribute:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script src="/path/to/script.js"&gt;&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>/path/to/script.js</code> is an absolute path to the file with the script (from the site root).</p>
<p>It is also possible to provide a path relative to the current page. For instance, <code>src="script.js"</code> would mean a file <code>"script.js"</code> in the current folder.</p>
<p>We can give a full URL as well, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js"&gt;&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>To attach several scripts, use multiple tags:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script src="/js/script1.js"&gt;&lt;/script&gt;
&lt;script src="/js/script2.js"&gt;&lt;/script&gt;
…</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Please note:</span></div>
            <div class="important__content"><p>As a rule, only the simplest scripts are put into HTML. More complex ones reside in separate files.</p>
<p>The benefit of a separate file is that the browser will download it and then store in its 
<a href="https://en.wikipedia.org/wiki/Web_cache">cache</a>.</p>
<p>After this, other pages that want the same script will take it from the cache instead of downloading it. So the file is actually downloaded only once.</p>
<p>That saves traffic and makes pages faster.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">If <code>src</code> is set, the script content is ignored.</span></div>
            <div class="important__content"><p>A single <code>&lt;script&gt;</code> tag can't have both the <code>src</code> attribute and the code inside.</p>
<p>This won't work:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:8-11">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script src="file.js"&gt;
  alert(1); // the content is ignored, because src is set
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>We must choose: either it's an external <code>&lt;script src="…"&gt;</code> or a regular <code>&lt;script&gt;</code> with code.</p>
<p>The example above can be split into two scripts to work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script src="file.js"&gt;&lt;/script&gt;
&lt;script&gt;
  alert(1);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-29">
Summary</h2>
<ul>
<li>We can use a <code>&lt;script&gt;</code> tag to add JavaScript code to the page.</li>
<li>The <code>type</code> and <code>language</code> attributes are not required.</li>
<li>A script in an external file can be inserted with <code>&lt;script src="path/to/script.js"&gt;&lt;/script&gt;</code>.</li>
</ul>
<p>There is much more to learn about browser scripts and their interaction with the web-page. But let's keep in mind that this part of the tutorial is devoted to the JavaScript language, so we shouldn't distract ourselves from it. We'll be using a browser as a way to run JavaScript, which is very convenient for online reading, but yet one of many.</p>
<div class="tasks"><h2 id="chapter-30" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#show-an-alert" name="show-an-alert" class="main__anchor">Show an alert</a></h3>
<a href="http://javascript.info/task/hello-alert" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a page that shows a message “I'm JavaScript!”.</p>
<p>Do it in a sandbox, or on your hard drive, doesn't matter, just ensure that it works.</p>
<p>
<a href="https://en.js.cx/task/hello-alert/solution/" target="blank">Demo in new window</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/5AmOR7Hcp4NwWZ4qbMDE?p=preview" target="_blank" data-plunk-id="5AmOR7Hcp4NwWZ4qbMDE">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#show-an-alert-with-an-external-script" name="show-an-alert-with-an-external-script" class="main__anchor">Show an alert with an external script</a></h3>
<a href="http://javascript.info/task/hello-alert-ext" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Take the solution of the previous task 
<a href="http://javascript.info/task/hello-alert">Show an alert</a>. Modify it by extracting the script content into an external file <code>alert.js</code>, residing in the same folder.</p>
<p>Open the page, ensure that the alert works.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The HTML code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;body&gt;

  &lt;script src="alert.js"&gt;&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>For the file <code>alert.js</code> in the same folder:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("I'm JavaScript!");</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-31"></h6>
<h1 class="main__header-title" id="chapter-32">Code structure</h1>
<p>The first thing to study is the building blocks of the code.</p>


<h2 id="chapter-33">
Statements</h2>
<p>Statements are syntax constructs and commands that perform actions.</p>
<p>We've already seen a statement <code>alert('Hello, world!')</code>, which shows the message.</p>
<p>We can have as many statements in the code as we want. Another statement can be separated with a semicolon.</p>
<p>For example, here we split the message into two:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('Hello'); alert('World');</code></pre>
        </div>
      </div>
      
      </div><p>Usually each statement is written on a separate line – thus the code becomes more readable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('Hello');
alert('World');</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-34">
Semicolons</h2>
<p>A semicolon may be omitted in most cases when a line break exists.</p>
<p>This would also work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('Hello')
alert('World')</code></pre>
        </div>
      </div>
      
      </div><p>Here JavaScript interprets the line break as an “implicit” semicolon. That's also called an 
<a href="https://tc39.github.io/ecma262/#sec-automatic-semicolon-insertion">automatic semicolon insertion</a>.</p>
<p><strong>In most cases a newline implies a semicolon. But “in most cases” does not mean “always”!</strong></p>
<p>There are cases when a newline does not mean a semicolon, for example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(3 +
1
+ 2);</code></pre>
        </div>
      </div>
      
      </div><p>The code outputs <code>6</code>, because JavaScript does not insert semicolons here. It is intuitively obvious that if the line ends with a plus <code>"+"</code>, then it is an “incomplete expression”, no semicolon required. And in this case that works as intended.</p>
<p><strong>But there are situations where JavaScript “fails” to assume a semicolon where it is really needed.</strong></p>
<p>Errors which occur in such cases are quite hard to find and fix.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">An example of an error</span></div>
            <div class="important__content"><p>If you're curious to see a concrete example of such an error, check this code out:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">[1, 2].forEach(alert)</code></pre>
        </div>
      </div>
      
      </div><p>No need to think about the meaning of the brackets <code>[]</code> and <code>forEach</code> yet. We'll study them later, for now it does not matter. Let's just remember the result: it shows <code>1</code>, then <code>2</code>.</p>
<p>Now let's add an <code>alert</code> before the code and <em>not</em> finish it with a semicolon:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("There will be an error")

[1, 2].forEach(alert)</code></pre>
        </div>
      </div>
      
      </div><p>Now if we run it, only the first <code>alert</code> is shown, and then we have an error!</p>
<p>But everything is fine again if we add a semicolon after <code>alert</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("All fine now");

[1, 2].forEach(alert)</code></pre>
        </div>
      </div>
      
      </div><p>Now we have the “All fine now” message and then <code>1</code> and <code>2</code>.</p>
<p>The error in the no-semicolon variant occurs because JavaScript does not imply a semicolon before square brackets <code>[...]</code>.</p>
<p>So, because the semicolon is not auto-inserted, the code in the first example is treated as a single statement. That's how the engine sees it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("There will be an error")[1, 2].forEach(alert)</code></pre>
        </div>
      </div>
      
      </div><p>But it should be two separate statements, not a single one. Such a merging in this case is just wrong, hence the error. There are other situations when such a thing happens.</p>
</div></div>
<p>It's recommended to put semicolons between statements even if they are separated by newlines. This rule is widely adopted by the community. Let's note once again – <em>it is possible</em> to leave out semicolons most of the time. But it's safer – especially for a beginner – to use them.</p>
<h2 id="chapter-35">
Comments</h2>
<p>As time goes on, the program becomes more and more complex. It becomes necessary to add <em>comments</em> which describe what happens and why.</p>
<p>Comments can be put into any place of the script. They don't affect the execution, because the engine simply ignores them.</p>
<p><strong>One-line comments start with the two forward slash characters <code>//</code>.</strong></p>
<p>The rest of the line is a comment. It may occupy a full line of its own or follow a statement.</p>
<p>Like here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// This comment occupies a line of its own
alert('Hello');

alert('World'); // This comment follows the statement</code></pre>
        </div>
      </div>
      
      </div><p><strong>Multiline comments start with a forward slash and an asterisk <code>/*</code> and end with an asterisk and a forward slash <code>*/</code>.</strong></p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">/* An example with two messages.
This is a multiline comment.
*/
alert('Hello');
alert('World');</code></pre>
        </div>
      </div>
      
      </div><p>The content of comments is ignored, so if we put code inside <code>/* … */</code> it won't execute.</p>
<p>Sometimes it comes in handy to temporarily disable a part of code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">/* Commenting out the code
alert('Hello');
*/
alert('World');</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Use hotkeys!</span></div>
            <div class="important__content"><p>In most editors a line of code can be commented out by <kbd class="shortcut">Ctrl<span class="shortcut__plus">+</span>/</kbd> hotkey for a single-line comment and something like <kbd class="shortcut">Ctrl<span class="shortcut__plus">+</span>Shift<span class="shortcut__plus">+</span>/</kbd> – for multiline comments (select a piece of code and press the hotkey). For Mac try <kbd class="shortcut">Cmd</kbd> instead of <kbd class="shortcut">Ctrl</kbd>.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Nested comments are not supported!</span></div>
            <div class="important__content"><p>There may not be <code>/*...*/</code> inside another <code>/*...*/</code>.</p>
<p>Such code will die with an error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">/*
  /* nested comment ?!? */
*/
alert( 'World' );</code></pre>
        </div>
      </div>
      
      </div></div></div>
<p>Please, don't hesitate to comment your code.</p>
<p>Comments increase the overall code footprint, but that's not a problem at all. There are many tools which minify the code before publishing to the production server. They remove comments, so they don't appear in the working scripts. Therefore comments do not have any negative effects on production at all.</p>
<p>Further in the tutorial, there will be a chapter 
<a href="http://javascript.info/coding-style">Coding style</a> that also explains how to write better comments.</p>

<h6 id="chapter-36"></h6>
<h1 class="main__header-title" id="chapter-37">The modern mode, "use strict"</h1>
<p>For a long time JavaScript was evolving without compatibility issues. New features were added to the language, but the old functionality did not change.</p>
<p>That had the benefit of never breaking existing code. But the downside was that any mistake or an imperfect decision made by JavaScript creators got stuck in the language forever.</p>
<p>It had been so until 2009 when ECMAScript 5 (ES5) appeared. It added new features to the language and modified some of the existing ones. To keep the old code working, most modifications are off by default. One needs to enable them explicitly with a special directive <code>"use strict"</code>.</p>


<h2 id="chapter-38">
“use strict”</h2>
<p>The directive looks like a string: <code>"use strict"</code> or <code>'use strict'</code>. When it is located on the top of the script, then the whole script works the “modern” way.</p>
<p>For example</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">"use strict";

// this code works the modern way
...</code></pre>
        </div>
      </div>
      
      </div><p>We will learn functions (a way to group commands) soon.</p>
<p>Looking ahead let's just note that <code>"use strict"</code> can be put at the start of a function (most kinds of functions) instead of the whole script. Then strict mode is enabled in that function only. But usually people use it for the whole script.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Ensure that “use strict” is at the top</span></div>
            <div class="important__content"><p>Please make sure that <code>"use strict"</code> is on the top of the script, otherwise the strict mode may not be enabled.</p>
<p>There is no strict mode here:</p>
<div data-trusted="1" class="code-example" data-no-strict="1">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("some code");
// "use strict" below is ignored, must be on the top

"use strict";

// strict mode is not activated</code></pre>
        </div>
      </div>
      
      </div><p>Only comments may appear above <code>"use strict"</code>.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">There's no way to cancel <code>use strict</code></span></div>
            <div class="important__content"><p>There is no directive <code>"no use strict"</code> or alike, that would return the old behavior.</p>
<p>Once we enter the strict mode, there's no return.</p>
</div></div>
<h2 id="chapter-39">
Always “use strict”</h2>
<p>The differences of <code>"use strict"</code> versus the “default” mode are still to be covered.</p>
<p>In the next chapters, as we learn language features, we'll make notes about the differences of the strict mode. Luckily, there are not so many. And they actually make our life better.</p>
<p>At this point in time it's enough to know about it in general:</p>
<ol>
<li>The <code>"use strict"</code> directive switches the engine to the “modern” mode, changing the behavior of some built-in features. We'll see the details as we study.</li>
<li>The strict mode is enabled by <code>"use strict"</code> at the top. Also there are several language features like “classes” and “modules” that enable strict mode automatically.</li>
<li>The strict mode is supported by all modern browsers.</li>
<li>It's always recommended to start scripts with <code>"use strict"</code>. All examples in this tutorial assume so, unless (very rarely) specified otherwise.</li>
</ol>

<h6 id="chapter-40"></h6>
<h1 class="main__header-title" id="chapter-41">Variables</h1>
<p>Most of the time, a JavaScript application needs to work with information. Here are 2 examples:</p>
<ol>
<li>An online-shop – the information might include goods being sold and a shopping cart.</li>
<li>A chat application – the information might include users, messages, and much more.</li>
</ol>
<p>Variables are used to store this information.</p>


<h2 id="chapter-42">
A variable</h2>
<p>A 
<a href="https://en.wikipedia.org/wiki/Variable_(computer_science)">variable</a> is a “named storage” for data. We can use variables to store goodies, visitors and other data.</p>
<p>To create a variable in JavaScript, we need to use the <code>let</code> keyword.</p>
<p>The statement below creates (in other words: <em>declares</em> or <em>defines</em>) a variable with the name “message”:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let message;</code></pre>
        </div>
      </div>
      
      </div><p>Now we can put some data into it by using the assignment operator <code>=</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let message;

message = 'Hello'; // store the string</code></pre>
        </div>
      </div>
      
      </div><p>The string is now saved into the memory area associated with the variable. We can access it using the variable name:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let message;
message = 'Hello!';

alert(message); // shows the variable content</code></pre>
        </div>
      </div>
      
      </div><p>To be concise we can merge the variable declaration and assignment into a single line:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let message = 'Hello!'; // define the variable and assign the value

alert(message); // Hello!</code></pre>
        </div>
      </div>
      
      </div><p>We can also declare multiple variables in one line:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = 'John', age = 25, message = 'Hello';</code></pre>
        </div>
      </div>
      
      </div><p>That might seem shorter, but it's not recommended. For the sake of better readability, please use a single line per variable.</p>
<p>The multiline variant is a bit longer, but easier to read:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = 'John';
let age = 25;
let message = 'Hello';</code></pre>
        </div>
      </div>
      
      </div><p>Some people also write many variables like that:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = 'John',
  age = 25,
  message = 'Hello';</code></pre>
        </div>
      </div>
      
      </div><p>…Or even in the “comma-first” style:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = 'John'
  , age = 25
  , message = 'Hello';</code></pre>
        </div>
      </div>
      
      </div><p>Technically, all these variants do the same. So, it's a matter of personal taste and aesthetics.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>var</code> instead of <code>let</code></span></div>
            <div class="important__content"><p>In older scripts you may also find another keyword: <code>var</code> instead of <code>let</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:0-3">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var message = 'Hello';</code></pre>
        </div>
      </div>
      
      </div><p>The <code>var</code> keyword is <em>almost</em> the same as <code>let</code>. It also declares a variable, but in a slightly different, “old-school” fashion.</p>
<p>There are subtle differences between <code>let</code> and <code>var</code>, but they do not matter for us yet. We'll cover them in detail later, in the chapter 
<a href="http://javascript.info/var">The old "var"</a>.</p>
</div></div>
<h2 id="chapter-43">
A real-life analogy</h2>
<p>We can easily grasp the concept of a “variable” if we imagine it as a “box” for data, with a uniquely-named sticker on it.</p>
<p>For instance, the variable <code>message</code> can be imagined as a box labelled <code>"message"</code> with the value <code>"Hello!"</code> in it:</p>
      <img src="http://javascript.info/article/variables/variable.png">
<p>We can put any value into the box.</p>
<p>Also we can change it. The value can be changed as many times as needed:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let message;

message = 'Hello!';

message = 'World!'; // value changed

alert(message);</code></pre>
        </div>
      </div>
      
      </div><p>When the value is changed, the old data is removed from the variable:</p>
      <img src="http://javascript.info/article/variables/variable-change.png">
<p>We can also declare two variables and copy data from one into the other.</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let hello = 'Hello world!';

let message;

// copy 'Hello world' from hello into message
message = hello;

// now two variables hold the same data
alert(hello); // Hello world!
alert(message); // Hello world!</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Functional languages</span></div>
            <div class="important__content"><p>It may be interesting to know that there also exist 
<a href="https://en.wikipedia.org/wiki/Functional_programming">functional</a> programming languages that forbid changing a variable value. For example, 
<a href="http://www.scala-lang.org/">Scala</a> or 
<a href="http://www.erlang.org/">Erlang</a>.</p>
<p>In such languages, once the value is stored “in the box”, it's there forever. If we need to store something else, the language forces us to create a new box (declare a new variable). We can't reuse the old one.</p>
<p>Though it may seem a little bit odd at first sight, these languages are quite capable of serious development. More than that, there are areas like parallel computations where this limitation confers certain benefits. Studying such a language (even if not planning to use it soon) is recommended to broaden the mind.</p>
</div></div>
<h2 id="chapter-44">
Variable naming</h2>
<p>There are two limitations for a variable name in JavaScript:</p>
<ol>
<li>The name must contain only letters, digits, symbols <code>$</code> and <code>_</code>.</li>
<li>The first character must not be a digit.</li>
</ol>
<p>Valid names, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let userName;
let test123;</code></pre>
        </div>
      </div>
      
      </div><p>When the name contains multiple words, 
<a href="https://en.wikipedia.org/wiki/CamelCase">camelCase</a> is commonly used. That is: words go one after another, each word starts with a capital letter: <code>myVeryLongName</code>.</p>
<p>What's interesting – the dollar sign <code>'$'</code> and the underscore <code>'_'</code> can also be used in names. They are regular symbols, just like letters, without any special meaning.</p>
<p>These names are valid:</p>
<div data-trusted="0" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let $ = 1; // declared a variable with the name "$"
let _ = 2; // and now a variable with the name "_"

alert($ + _); // 3</code></pre>
        </div>
      </div>
      
      </div><p>Examples of incorrect variable names:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let 1a; // cannot start with a digit

let my-name; // a hyphen '-' is not allowed in the name</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Case matters</span></div>
            <div class="important__content"><p>Variables named <code>apple</code> and <code>AppLE</code> – are two different variables.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Non-english letters are allowed, but not recommended</span></div>
            <div class="important__content"><p>It is possible to use any language, including cyrillic letters or even hieroglyphs, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let имя = '...';
let 我 = '...';</code></pre>
        </div>
      </div>
      
      </div><p>Technically, there is no error here, such names are allowed, but there is an international tradition to use English in variable names. Even if we're writing a small script, it may have a long life ahead. People from other countries may need to read it some time.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Reserved names</span></div>
            <div class="important__content"><p>There is a list of reserved words, which cannot be used as variable names, because they are used by the language itself.</p>
<p>For example, words <code>let</code>, <code>class</code>, <code>return</code>, <code>function</code> are reserved.</p>
<p>The code below gives a syntax error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let let = 5; // can't name a variable "let", error!
let return = 5; // also can't name it "return", error!</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">An assignment without <code>use strict</code></span></div>
            <div class="important__content"><p>Normally, we need to define a variable before using it. But in the old times, it was technically possible to create a variable by a mere assignment of the value, without <code>let</code>. This still works now if we don't put <code>use strict</code>. The behavior is kept for compatibility with old scripts.</p>
<div data-trusted="1" class="code-example" data-no-strict="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// note: no "use strict" in this example

num = 5; // the variable "num" is created if didn't exist

alert(num); // 5</code></pre>
        </div>
      </div>
      
      </div><p>That's a bad practice, it gives an error in the strict mode:</p>
<div data-trusted="0" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">"use strict";

num = 5; // error: num is not defined</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-45">
Constants</h2>
<p>To declare a constant (unchanging) variable, one can use <code>const</code> instead of <code>let</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const myBirthday = '18.04.1982';</code></pre>
        </div>
      </div>
      
      </div><p>Variables declared using <code>const</code> are called “constants”. They cannot be changed. An attempt to do it would cause an error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const myBirthday = '18.04.1982';

myBirthday = '01.01.2001'; // error, can't reassign the constant!</code></pre>
        </div>
      </div>
      
      </div><p>When a programmer is sure that the variable should never change, he can use <code>const</code> to guarantee it, and also to clearly show that fact to everyone.</p>
<h3>
Uppercase constants</a></h3><p>There is a widespread practice to use constants as aliases for difficult-to-remember values that are known prior to execution.</p>
<p>Such constants are named using capital letters and underscores.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const COLOR_RED = "#F00";
const COLOR_GREEN = "#0F0";
const COLOR_BLUE = "#00F";
const COLOR_ORANGE = "#FF7F00";

// ...when we need to pick a color
let color = COLOR_ORANGE;
alert(color); // #FF7F00</code></pre>
        </div>
      </div>
      
      </div><p>Benefits:</p>
<ul>
<li><code>COLOR_ORANGE</code> is much easier to remember than <code>"#FF7F00"</code>.</li>
<li>It is much easier to mistype in <code>"#FF7F00"</code> than in <code>COLOR_ORANGE</code>.</li>
<li>When reading the code, <code>COLOR_ORANGE</code> is much more meaningful than <code>#FF7F00</code>.</li>
</ul>
<p>When should we use capitals for a constant, and when should we name them normally? Let's make that clear.</p>
<p>Being a “constant” just means that the value never changes. But there are constants that are known prior to execution (like a hexadecimal value for red), and there are those that are <em>calculated</em> in run-time, during the execution, but do not change after the assignment.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const pageLoadTime = /* time taken by a webpage to load */;</code></pre>
        </div>
      </div>
      
      </div><p>The value of <code>pageLoadTime</code> is not known prior to the page load, so it's named normally. But it's still a constant, because it doesn't change after assignment.</p>
<p>In other words, capital-named constants are only used as aliases for “hard-coded” values.</p>
<h2 id="chapter-46">
Name things right</h2>
<p>Talking about variables, there's one more extremely important thing.</p>
<p>Please name the variables sensibly. Take time to think if needed.</p>
<p>Variable naming is one of the most important and complex skills in programming. A quick glance at variable names can reveal which code is written by a beginner and which by an experienced developer.</p>
<p>In a real project, most of the time is spent on modifying and extending the existing code base, rather than writing something completely separate from scratch. And when we return to the code after some time of doing something else, it's much easier to find information that is well-labelled. Or, in other words, when the variables have good names.</p>
<p>Please spend some time thinking about the right name for a variable before declaring it. That will repay you a lot.</p>
<p>Some good-to-follow rules are:</p>
<ul>
<li>Use human-readable names like <code>userName</code> or <code>shoppingCart</code>.</li>
<li>Stay away from abbreviations or short names like <code>a</code>, <code>b</code>, <code>c</code>, unless you really know what you're doing.</li>
<li>Make the name maximally descriptive and concise. Examples of bad names are <code>data</code> and <code>value</code>. Such a name says nothing. It is only ok to use them if it's exceptionally obvious from the context which data or value is meant.</li>
<li>Agree on terms within your team and in your own mind. If a site visitor is called a “user” then we should name related variables like <code>currentUser</code> or <code>newUser</code>, but not <code>currentVisitor</code> or a <code>newManInTown</code>.</li>
</ul>
<p>Sounds simple? Indeed it is, but creating good descriptive-and-concise names in practice is not. Go for it.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Reuse or create?</span></div>
            <div class="important__content"><p>And the last note. There are some lazy programmers who, instead of declaring a new variable, tend to reuse the existing ones.</p>
<p>As a result, the variable is like a box where people throw different things without changing the sticker. What is inside it now? Who knows… We need to come closer and check.</p>
<p>Such a programmer saves a little bit on variable declaration, but loses ten times more on debugging the code.</p>
<p>An extra variable is good, not evil.</p>
<p>Modern JavaScript minifiers and browsers optimize code well enough, so it won't create performance issues. Using different variables for different values can even help the engine to optimize.</p>
</div></div>
<h2 id="chapter-47">
Summary</h2>
<p>We can declare variables to store data. That can be done using <code>var</code> or <code>let</code> or <code>const</code>.</p>
<ul>
<li><code>let</code> – is a modern variable declaration. The code must be in strict mode to use <code>let</code> in Chrome (V8).</li>
<li><code>var</code> – is an old-school variable declaration. Normally we don't use it at all, but we'll cover subtle differences from <code>let</code> in the chapter 
<a href="http://javascript.info/var">The old "var"</a>, just in case you need them.</li>
<li><code>const</code> – is like <code>let</code>, but the value of the variable can't be changed.</li>
</ul>
<p>Variables should be named in a way that allows us to easily understand what's inside.</p>
<div class="tasks"><h2 id="chapter-48" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#working-with-variables" name="working-with-variables" class="main__anchor">Working with variables</a></h3>
<a href="http://javascript.info/task/hello-variables" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><ol>
<li>Declare two variables: <code>admin</code> and <code>name</code>.</li>
<li>Assign the value <code>"John"</code> to <code>name</code>.</li>
<li>Copy the value from <code>name</code> to <code>admin</code>.</li>
<li>Show the value of <code>admin</code> using <code>alert</code> (must output “John”).</li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>In the code below, each line corresponds to the item in the task list.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let admin, name; // can declare two variables at once

name = "John";

admin = name;

alert( admin ); // "John"</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#giving-the-right-name" name="giving-the-right-name" class="main__anchor">Giving the right name</a></h3>
<a href="http://javascript.info/task/declare-variables" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><ol>
<li>Create the variable with the name of our planet. How would you name such a variable?</li>
<li>Create the variable to store the name of the current visitor. How would you name that variable?</li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>First, the variable for the name of our planet.</p>
<p>That's simple:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let ourPlanetName = "Earth";</code></pre>
        </div>
      </div>
      
      </div><p>Note, we could use a shorter name <code>planet</code>, but it might be not obvious what planet it refers to. It's nice to be more verbose. At least until the variable isNotTooLong.</p>
<p>Second, the name of the current visitor:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let currentUserName = "John";</code></pre>
        </div>
      </div>
      
      </div><p>Again, we could shorten that to <code>userName</code> if we know for sure that the user is current.</p>
<p>Modern editors and autocomplete make long variable names easy to write. Don't save on them. A name with 3 words in it is fine.</p>
<p>And if your editor does not have proper autocompletion, get 
<a href="http://javascript.info/editors">a new one</a>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#uppercase-const" name="uppercase-const" class="main__anchor">Uppercase const?</a></h3>
<a href="http://javascript.info/task/uppercast-constant" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Examine the following code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const birthday = '18.04.1982';

const age = someCode(birthday);</code></pre>
        </div>
      </div>
      
      </div><p>Here we have a constant <code>birthday</code> date and the <code>age</code> is calculated from <code>birthday</code> with the help of some code (it is not provided for shortness, and because details don't matter here).</p>
<p>Would it be right to use upper case for <code>birthday</code>? For <code>age</code>? Or even for both?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const BIRTHDAY = '18.04.1982'; // make uppercase?

const AGE = someCode(BIRTHDAY); // make uppercase?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We generally use upper case for constants that are “hard-coded”. Or, in other words, when the value is known prior to execution and directly written into the code.</p>
<p>In this code, <code>birthday</code> is exactly like that. So we could use the upper case for it.</p>
<p>In contrast, <code>age</code> is evaluated in run-time. Today we have one age, a year after we'll have another one. It is constant in a sense that it does not change through the code execution. But it is a bit “less of a constant” than <code>birthday</code>, it is calculated, so we should keep the lower case for it.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-49"></h6>
<h1 class="main__header-title" id="chapter-50">Data types</h1>
<p>A variable in JavaScript can contain any data. A variable can at one moment be a string and later receive a numeric value:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// no error
let message = "hello";
message = 123456;</code></pre>
        </div>
      </div>
      
      </div><p>Programming languages that allow such things are called “dynamically typed”, meaning that there are data types, but variables are not bound to any of them.</p>
<p>There are seven basic data types in JavaScript. Here we'll study the basics, and in the next chapters we'll talk about each of them in detail.</p>


<h2 id="chapter-51">
A number</h2>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let n = 123;
n = 12.345;</code></pre>
        </div>
      </div>
      
      </div><p>The <em>number</em> type serves both for integer and floating point numbers.</p>
<p>There are many operations for numbers, e.g. multiplication <code>*</code>, division <code>/</code>, addition <code>+</code>, subtraction <code>-</code> and so on.</p>
<p>Besides regular numbers, there are so-called “special numeric values” which also belong to that type: <code>Infinity</code>, <code>-Infinity</code> and <code>NaN</code>.</p>
<ul>
<li>
<p><code>Infinity</code> represents the mathematical 
<a href="https://en.wikipedia.org/wiki/Infinity">Infinity</a> ∞. It is a special value that's greater than any number.</p>
<p>We can get it as a result of division by zero:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1 / 0 ); // Infinity</code></pre>
        </div>
      </div>
      
      </div><p>Or just mention it in the code directly:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Infinity ); // Infinity</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p><code>NaN</code> represents a computational error. It is a result of an incorrect or an undefined mathematical operation, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "not a number" / 2 ); // NaN, such division is erroneous</code></pre>
        </div>
      </div>
      
      </div><p><code>NaN</code> is sticky. Any further operation on <code>NaN</code> would give <code>NaN</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "not a number" / 2 + 5 ); // NaN</code></pre>
        </div>
      </div>
      
      </div><p>So, if there's <code>NaN</code> somewhere in a mathematical expression, it propagates to the whole result.</p>
</li>
</ul>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Mathematical operations are safe</span></div>
            <div class="important__content"><p>Doing maths is safe in JavaScript. We can do anything: divide by zero, treat non-numeric strings as numbers, etc.</p>
<p>The script will never stop with a fatal error (“die”). At worst we'll get <code>NaN</code> as the result.</p>
</div></div>
<p>Special numeric values formally belong to the “number” type. Of course they are not numbers in a common sense of this word.</p>
<p>We'll see more about working with numbers in the chapter 
<a href="http://javascript.info/number">Numbers</a>.</p>
<h2 id="chapter-52">
A string</h2>
<p>A string in JavaScript must be quoted.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Hello";
let str2 = 'Single quotes are ok too';
let phrase = `can embed ${str}`;</code></pre>
        </div>
      </div>
      
      </div><p>In JavaScript, there are 3 types of quotes.</p>
<ol>
<li>Double quotes: <code>"Hello"</code>.</li>
<li>Single quotes: <code>'Hello'</code>.</li>
<li>Backticks: <code>`Hello`</code>.</li>
</ol>
<p>Double and single quotes are “simple” quotes. There's no difference between them in JavaScript.</p>
<p>Backticks are “extended functionality” quotes. They allow us to embed variables and expressions into a string by wrapping them in <code>${…}</code>, for example:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:15-22,6:22-30">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let name = "John";

// embed a variable
alert( `Hello, ${name}!` ); // Hello, John!

// embed an expression
alert( `the result is ${1 + 2}` ); // the result is 3</code></pre>
        </div>
      </div>
      
      </div><p>The expression inside <code>${…}</code> is evaluated and the result becomes a part of the string. We can put anything there: a variable like <code>name</code> or an arithmetical expression like <code>1 + 2</code> or something more complex.</p>
<p>Please note that this can only be done in backticks. Other quotes do not allow such embedding!</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "the result is ${1 + 2}" ); // the result is ${1 + 2} (double quotes do nothing)</code></pre>
        </div>
      </div>
      
      </div><p>We'll cover strings more thoroughly in the chapter 
<a href="http://javascript.info/string">Strings</a>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">There is no <em>character</em> type.</span></div>
            <div class="important__content"><p>In some languages, there is a special “character” type for a single character. For example, in the C language and in Java it is <code>char</code>.</p>
<p>In JavaScript, there is no such type. There's only one type: <code>string</code>. A string may consist of only one character or many of them.</p>
</div></div>
<h2 id="chapter-53">
A boolean (logical type)</h2>
<p>The boolean type has only two values: <code>true</code> and <code>false</code>.</p>
<p>This type is commonly used to store yes/no values: <code>true</code> means “yes, correct”, and <code>false</code> means “no, incorrect”.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let nameFieldChecked = true; // yes, name field is checked
let ageFieldChecked = false; // no, age field is not checked</code></pre>
        </div>
      </div>
      
      </div><p>Boolean values also come as a result of comparisons:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let isGreater = 4 &gt; 1;

alert( isGreater ); // true (the comparison result is "yes")</code></pre>
        </div>
      </div>
      
      </div><p>We'll cover booleans more deeply later in the chapter 
<a href="http://javascript.info/logical-operators">Logical operators</a>.</p>
<h2 id="chapter-54">
The “null” value</h2>
<p>The special <code>null</code> value does not belong to any type of those described above.</p>
<p>It forms a separate type of its own, which contains only the <code>null</code> value:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = null;</code></pre>
        </div>
      </div>
      
      </div><p>In JavaScript <code>null</code> is not a “reference to a non-existing object” or a “null pointer” like in some other languages.</p>
<p>It's just a special value which has the sense of “nothing”, “empty” or “value unknown”.</p>
<p>The code above states that the <code>age</code> is unknown or empty for some reason.</p>
<h2 id="chapter-55">
The “undefined” value</h2>
<p>The special value <code>undefined</code> stands apart. It makes a type of its own, just like <code>null</code>.</p>
<p>The meaning of <code>undefined</code> is “value is not assigned”.</p>
<p>If a variable is declared, but not assigned, then its value is exactly <code>undefined</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x;

alert(x); // shows "undefined"</code></pre>
        </div>
      </div>
      
      </div><p>Technically, it is possible to assign <code>undefined</code> to any variable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x = 123;

x = undefined;

alert(x); // "undefined"</code></pre>
        </div>
      </div>
      
      </div><p>…But it's not recommended to do that. Normally, we use <code>null</code> to write an “empty” or an “unknown” value into the variable, and <code>undefined</code> is only used for checks, to see if the variable is assigned or similar.</p>
<h2 id="chapter-56">
Objects and Symbols</h2>
<p>The <code>object</code> type is special.</p>
<p>All other types are called “primitive”, because their values can contain only a single thing (be it a string or a number or whatever). In contrast, objects are used to store collections of data and more complex entities. We'll deal with them later in the chapter 
<a href="http://javascript.info/object">Objects</a> after we know enough about primitives.</p>
<p>The <code>symbol</code> type is used to create unique identifiers for objects. We have to mention it here for completeness, but it's better to study them after objects.</p>
<h2 id="chapter-57">
The typeof operator</h2>
<p>The <code>typeof</code> operator returns the type of the argument. It's useful when we want to process values of different types differently, or just want to make a quick check.</p>
<p>It supports two forms of syntax:</p>
<ol>
<li>As an operator: <code>typeof x</code>.</li>
<li>Function style: <code>typeof(x)</code>.</li>
</ol>
<p>In other words, it works both with parentheses or without them. The result is the same.</p>
<p>The call to <code>typeof x</code> returns a string with the type name:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10,12-12,14-14">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">typeof undefined // "undefined"

typeof 0 // "number"

typeof true // "boolean"

typeof "foo" // "string"

typeof Symbol("id") // "symbol"

typeof Math // "object"  (1)

typeof null // "object"  (2)

typeof alert // "function"  (3)</code></pre>
        </div>
      </div>
      
      </div><p>The last three lines may need additional explanations:</p>
<ol>
<li><code>Math</code> is a built-in object that provides mathematical operations. We will learn it in the chapter 
<a href="http://javascript.info/number">Numbers</a>. Here it serves just as an example of an object.</li>
<li>The result of <code>typeof null</code> is <code>"object"</code>. That's wrong. It is an officially recognized error in <code>typeof</code>, kept for compatibility. Of course, <code>null</code> is not an object. It is a special value with a separate type of its own. So, again, that's an error in the language.</li>
<li>The result of <code>typeof alert</code> is <code>"function"</code>, because <code>alert</code> is a function of the language. We'll study functions in the next chapters, and we'll see that there's no special “function” type in the language. Functions belong to the object type. But <code>typeof</code> treats them differently. Formally, it's incorrect, but very convenient in practice.</li>
</ol>
<h2 id="chapter-58">
Summary</h2>
<p>There are 7 basic types in JavaScript.</p>
<ul>
<li><code>number</code> for numbers of any kind: integer or floating-point.</li>
<li><code>string</code> for strings. A string may have one or more characters, there's no separate single-character type.</li>
<li><code>boolean</code> for <code>true</code>/<code>false</code>.</li>
<li><code>null</code> for unknown values – a standalone type that has a single value <code>null</code>.</li>
<li><code>undefined</code> for unassigned values – a standalone type that has a single value <code>undefined</code>.</li>
<li><code>object</code> for more complex data structures.</li>
<li><code>symbol</code> for unique identifiers.</li>
</ul>
<p>The <code>typeof</code> operator allows us to see which type is stored in the variable.</p>
<ul>
<li>Two forms: <code>typeof x</code> or <code>typeof(x)</code>.</li>
<li>Returns a string with the name of the type, like <code>"string"</code>.</li>
<li>For <code>null</code> returns <code>"object"</code> – that's an error in the language, it's not an object in fact.</li>
</ul>
<p>In the next chapters we'll concentrate on primitive values and once we're familiar with them, then we'll move on to objects.</p>
<div class="tasks"><h2 id="chapter-59" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#string-quotes" name="string-quotes" class="main__anchor">String quotes</a></h3>
<a href="http://javascript.info/task/string-quotes" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What is the output of the script?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let name = "Ilya";

alert( `hello ${1}` ); // ?

alert( `hello ${"name"}` ); // ?

alert( `hello ${name}` ); // ?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Backticks embed the expression inside <code>${...}</code> into the string.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let name = "Ilya";

// the expression is a number 1
alert( `hello ${1}` ); // hello 1

// the expression is a string "name"
alert( `hello ${"name"}` ); // hello name

// the expression is a variable, embed it
alert( `hello ${name}` ); // hello Ilya</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-60"></h6>
<h1 class="main__header-title" id="chapter-61">Type Conversions</h1>
<p>Most of the time, operators and functions automatically convert a value to the right type. That's called “type conversion”.</p>
<p>For example, <code>alert</code> automatically converts any value to a string to show it. Mathematical operations convert values to numbers.</p>
<p>There are also cases when we need to explicitly convert a value to put things right.</p>


<div class="important important_smart">
            <div class="important__header"><span class="important__type">Not talking about objects yet</span></div>
            <div class="important__content"><p>In this chapter we don't cover objects yet. Here we study primitives first. Later, after we learn objects, we'll see how object conversion works in the chapter 
<a href="http://javascript.info/object-toprimitive">Object to primitive conversion</a>.</p>
</div></div>
<h2 id="chapter-62">
ToString</h2>
<p>String conversion happens when we need the string form of a value.</p>
<p>For example, <code>alert(value)</code> does it to show the value.</p>
<p>We can also use a call <code>String(value)</code> function for that:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let value = true;
alert(typeof value); // boolean

value = String(value); // now value is a string "true"
alert(typeof value); // string</code></pre>
        </div>
      </div>
      
      </div><p>String conversion is mostly obvious. A <code>false</code> becomes <code>"false"</code>, <code>null</code> becomes <code>"null"</code> etc.</p>
<h2 id="chapter-63">
ToNumber</h2>
<p>Numeric conversion happens in mathematical functions and expressions automatically.</p>
<p>For example, when division <code>/</code> is applied to non-numbers:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "6" / "2" ); // 3, strings are converted to numbers</code></pre>
        </div>
      </div>
      
      </div><p>We can use a <code>Number(value)</code> function to explicitly convert a <code>value</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "123";
alert(typeof str); // string

let num = Number(str); // becomes a number 123

alert(typeof num); // number</code></pre>
        </div>
      </div>
      
      </div><p>Explicit conversion is usually required when we read a value from a string-based source like a text form, but we expect a number to be entered.</p>
<p>If the string is not a valid number, the result of such conversion is <code>NaN</code>, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = Number("an arbitrary string instead of a number");

alert(age); // NaN, conversion failed</code></pre>
        </div>
      </div>
      
      </div><p>Numeric conversion rules:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Becomes…</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>undefined</code></td>
<td><code>NaN</code></td>
</tr>
<tr>
<td><code>null</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>true&nbsp;and&nbsp;false</code></td>
<td><code>1</code> and <code>0</code></td>
</tr>
<tr>
<td><code>string</code></td>
<td>Whitespaces from the start and the end are removed. Then, if the remaining string is empty, the result is <code>0</code>. Otherwise, the number is “read” from the string. An error gives <code>NaN</code>.</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Number("   123   ") ); // 123
alert( Number("123z") );      // NaN (error reading a number at "z")
alert( Number(true) );        // 1
alert( Number(false) );       // 0</code></pre>
        </div>
      </div>
      
      </div><p>Please note that <code>null</code> and <code>undefined</code> behave differently here: <code>null</code> becomes a zero, while <code>undefined</code> becomes <code>NaN</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Addition ‘+' concatenates strings</span></div>
            <div class="important__content"><p>Almost all mathematical operations convert values to numbers. With a notable exception of the addition <code>+</code>. If one of the added values is a string, then another one is also converted to a string.</p>
<p>Then it concatenates (joins) them:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1 + '2' ); // '12' (string to the right)
alert( '1' + 2 ); // '12' (string to the left)</code></pre>
        </div>
      </div>
      
      </div><p>That only happens when one of the arguments is a string. Otherwise, values are converted to numbers.</p>
</div></div>
<h2 id="chapter-64">
ToBoolean</h2>
<p>Boolean conversion is the simplest one.</p>
<p>It happens in logical operations (later we'll meet condition tests and other kinds of them), but also can be performed manually with the call of <code>Boolean(value)</code>.</p>
<p>The conversion rule:</p>
<ul>
<li>Values that are intuitively “empty”, like <code>0</code>, an empty string, <code>null</code>, <code>undefined</code> and <code>NaN</code> become <code>false</code>.</li>
<li>Other values become <code>true</code>.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Boolean(1) ); // true
alert( Boolean(0) ); // false

alert( Boolean("hello") ); // true
alert( Boolean("") ); // false</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Please note: the string with zero <code>"0"</code> is <code>true</code></span></div>
            <div class="important__content"><p>Some languages (namely PHP) treat <code>"0"</code> as <code>false</code>. But in JavaScript a non-empty string is always <code>true</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Boolean("0") ); // true
alert( Boolean(" ") ); // spaces, also true (any non-empty string is true)</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-65">
Summary</h2>
<p>There are three most widely used type conversions: to string, to number and to boolean.</p>
<p><strong><code>ToString</code></strong> – Occurs when we output something, can be performed with <code>String(value)</code>. The conversion to string is usually obvious for primitive values.</p>
<p><strong><code>ToNumber</code></strong> – Occurs in math operations, can be performed with <code>Number(value)</code>.</p>
<p>The conversion follows the rules:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Becomes…</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>undefined</code></td>
<td><code>NaN</code></td>
</tr>
<tr>
<td><code>null</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>true&nbsp;/&nbsp;false</code></td>
<td><code>1 / 0</code></td>
</tr>
<tr>
<td><code>string</code></td>
<td>The string is read “as is”, whitespaces from both sides are ignored. An empty string becomes <code>0</code>. An error gives <code>NaN</code>.</td>
</tr>
</tbody>
</table>
<p><strong><code>ToBoolean</code></strong> – Occurs in logical operations, or can be performed with <code>Boolean(value)</code>.</p>
<p>Follows the rules:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Becomes…</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code>, <code>null</code>, <code>undefined</code>, <code>NaN</code>, <code>""</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td>any other value</td>
<td><code>true</code></td>
</tr>
</tbody>
</table>
<p>Most of these rules are easy to understand and memorize. The notable exceptions where people usually make mistakes are:</p>
<ul>
<li><code>undefined</code> is <code>NaN</code> as a number, not <code>0</code>.</li>
<li><code>"0"</code> and space-only strings like <code>" "</code> are true as a boolean.</li>
</ul>
<p>Objects are not covered here, we'll return to them later in the chapter 
<a href="http://javascript.info/object-toprimitive">Object to primitive conversion</a> that is devoted exclusively to objects, after we learn more basic things about JavaScript.</p>
<div class="tasks"><h2 id="chapter-66" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#type-conversions" name="type-conversions" class="main__anchor">Type conversions</a></h3>
<a href="http://javascript.info/task/primitive-conversions-questions" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What are results of these expressions?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">"" + 1 + 0
"" - 1 + 0
true + false
6 / "3"
"2" * "3"
4 + 5 + "px"
"$" + 4 + 5
"4" - 2
"4px" - 2
7 / 0
"  -9\n" + 5
"  -9\n" - 5
null + 1
undefined + 1</code></pre>
        </div>
      </div>
      
      </div><p>Think well, write down and then compare with the answer.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">"" + 1 + 0 = "10" // (1)
"" - 1 + 0 = -1 // (2)
true + false = 1
6 / "3" = 2
"2" * "3" = 6
4 + 5 + "px" = "9px"
"$" + 4 + 5 = "$45"
"4" - 2 = 2
"4px" - 2 = NaN
7 / 0 = Infinity
" -9\n" + 5 = " -9\n5"
" -9\n" - 5 = -14
null + 1 = 1 // (3)
undefined + 1 = NaN // (4)</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>The addition with a string <code>"" + 1</code> converts <code>1</code> to a string: <code>"" + 1 = "1"</code>, and then we have <code>"1" + 0</code>, the same rule is applied.</li>
<li>The subtraction <code>"-"</code> (like most math operations) only works with numbers, it converts an empty string <code>""</code> to <code>0</code>.</li>
<li><code>null</code> becomes <code>0</code> after the numeric conversion.</li>
<li><code>undefined</code> becomes <code>NaN</code> after the numeric conversion.</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-67"></h6>
<h1 class="main__header-title" id="chapter-68">Operators</h1>
<p>Many operators are known to us from school. They are addition <code>+</code>, a multiplication <code>*</code>, a subtraction <code>-</code> and so on.</p>
<p>In this chapter we concentrate on aspects that are not covered by school arithmetic.</p>


<h2 id="chapter-69">
Terms: “unary”, “binary”, “operand”</h2>
<p>Before we move on, let's grasp the common terminology.</p>
<ul>
<li>
<p><em>An operand</em> – is what operators are applied to. For instance in multiplication <code>5 * 2</code> there are two operands: the left operand is <code>5</code>, and the right operand is <code>2</code>. Sometimes people say “arguments” instead of “operands”.</p>
</li>
<li>
<p>An operator is <em>unary</em> if it has a single operand. For example, the unary negation <code>"-"</code> reverses the sign of the number:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x = 1;

x = -x;
alert( x ); // -1, unary negation was applied</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>An operator is <em>binary</em> if it has two operands. The same minus exists in the binary form as well:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x = 1, y = 3;
alert( y - x ); // 2, binary minus subtracts values</code></pre>
        </div>
      </div>
      
      </div><p>Formally, we're talking about two different operators here: the unary negation (single operand, reverses the sign) and the binary subtraction (two operands, subtracts).</p>
</li>
</ul>
<h2 id="chapter-70">
Strings concatenation, binary +</h2>
<p>Now let's see special features of JavaScript operators that are beyond school arithmetics.</p>
<p>Usually the plus operator <code>'+'</code> sums numbers.</p>
<p>But if the binary <code>+</code> is applied to strings, it merges (concatenates) them:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let s = "my" + "string";
alert(s); // mystring</code></pre>
        </div>
      </div>
      
      </div><p>Note that if any of operands is a string, then the other one is converted to a string too.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '1' + 2 ); // "12"
alert( 2 + '1' ); // "21"</code></pre>
        </div>
      </div>
      
      </div><p>See, it doesn't matter whether the first operand is a string or the second one. The rule is simple: if either operand is a string, then convert the other one into a string as well.</p>
<p>String concatenation and conversion is a special feature of the binary plus <code>"+"</code>. Other arithmetic operators work only with numbers. They always convert their operands to numbers.</p>
<p>For instance, subtraction and division:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 2 - '1' ); // 1
alert( '6' / '2' ); // 3</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-71">
Numeric conversion, unary +</h2>
<p>The plus <code>+</code> exist in two forms. The binary form that we used above and the unary form.</p>
<p>The unary plus or, in other words, the plus operator <code>+</code> applied to a single value, doesn't do anything with numbers, but if the operand is not a number, then it is converted into it.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// No effect on numbers
let x = 1;
alert( +x ); // 1

let y = -2;
alert( +y ); // -2

// Converts non-numbers
alert( +true ); // 1
alert( +"" );   // 0</code></pre>
        </div>
      </div>
      
      </div><p>It actually does the same as <code>Number(...)</code>, but shorter.</p>
<p>A need to convert string to number arises very often. For example, if we are getting values from HTML form fields, then they are usually strings.</p>
<p>What if we want to sum them?</p>
<p>The binary plus would add them as strings:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let apples = "2";
let oranges = "3";

alert( apples + oranges ); // "23", the binary plus concatenates strings</code></pre>
        </div>
      </div>
      
      </div><p>If we want to treat them as numbers, then we can convert and then sum:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let apples = "2";
let oranges = "3";

// both values converted to numbers before the binary plus
alert( +apples + +oranges ); // 5

// the longer variant
// alert( Number(apples) + Number(oranges) ); // 5</code></pre>
        </div>
      </div>
      
      </div><p>From a mathematician's standpoint the abundance of pluses may seem strange. But from a programmer's standpoint, there's nothing special: unary pluses are applied first, they convert strings to numbers, and then the binary plus sums them up.</p>
<p>Why are unary pluses applied to values before the binary one? As we're going to see, that's because of their <em>higher precedence</em>.</p>
<h2 id="chapter-72">
Operators precedence</h2>
<p>If an expression has more than one operator, the execution order is defined by their <em>precedence</em>, or, in other words, there's an implicit priority order among the operators.</p>
<p>From school we all know that the multiplication in the expression <code>1 + 2 * 2</code> should be calculated before the addition. That's exactly the precedence thing. The multiplication is said to have <em>a higher precedence</em> than the addition.</p>
<p>Parentheses override any precedence, so if we're not satisfied with the order, we can use them, like: <code>(1 + 2) * 2</code>.</p>
<p>There are many operators in JavaScript. Every operator has a corresponding precedence number. The one with the bigger number executes first. If the precedence is the same, the execution order is from left to right.</p>
<p>An extract from the 
<a href="https://developer.mozilla.org/en/JavaScript/Reference/operators/operator_precedence">precedence table</a> (you don't need to remember this, but note that unary operators are higher than corresponding binary ones):</p>
<table>
<thead>
<tr>
<th>Precedence</th>
<th>Name</th>
<th>Sign</th>
</tr>
</thead>
<tbody>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>16</td>
<td>unary plus</td>
<td><code>+</code></td>
</tr>
<tr>
<td>16</td>
<td>unary negation</td>
<td><code>-</code></td>
</tr>
<tr>
<td>14</td>
<td>multiplication</td>
<td><code>*</code></td>
</tr>
<tr>
<td>14</td>
<td>division</td>
<td><code>/</code></td>
</tr>
<tr>
<td>13</td>
<td>addition</td>
<td><code>+</code></td>
</tr>
<tr>
<td>13</td>
<td>subtraction</td>
<td><code>-</code></td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>3</td>
<td>assignment</td>
<td><code>=</code></td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>As we can see, the “unary plus” has a priority of <code>16</code>, which is higher than <code>13</code> for the “addition” (binary plus). That's why in the expression <code>"+apples + +oranges"</code> unary pluses work first, and then the addition.</p>
<h2 id="chapter-73">
Assignment</h2>
<p>Let's note that an assignment <code>=</code> is also an operator. It is listed in the precedence table with the very low priority of <code>3</code>.</p>
<p>That's why when we assign a variable, like <code>x = 2 * 2 + 1</code>, then the calculations are done first, and afterwards the <code>=</code> is evaluated, storing the result in <code>x</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x = 2 * 2 + 1;

alert( x ); // 5</code></pre>
        </div>
      </div>
      
      </div><p>It is possible to chain assignments:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a, b, c;

a = b = c = 2 + 2;

alert( a ); // 4
alert( b ); // 4
alert( c ); // 4</code></pre>
        </div>
      </div>
      
      </div><p>Chained assignments evaluate from right to left. First the rightmost expression <code>2 + 2</code> is evaluated then assigned to the variables on the left: <code>c</code>, <code>b</code> and <code>a</code>. At the end, all variables share a single value.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The assignment operator <code>"="</code> returns a value</span></div>
            <div class="important__content"><p>An operator always returns a value. That's obvious for most of them like an addition <code>+</code> or a multiplication <code>*</code>. But the assignment operator follows that rule too.</p>
<p>The call <code>x = value</code> writes the <code>value</code> into <code>x</code> <em>and then returns it</em>.</p>
<p>Here's the demo that uses an assignment as part of a more complex expression:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 1;
let b = 2;

let c = 3 - (a = b + 1);

alert( a ); // 3
alert( c ); // 0</code></pre>
        </div>
      </div>
      
      </div><p>In the example above, the result of <code>(a = b + 1)</code> is the value which is assigned to <code>a</code> (that is <code>3</code>). It is then used to subtract from <code>3</code>.</p>
<p>Funny code, isn't it? We should understand how it works, because sometimes we can see it in 3rd-party libraries, but shouldn't write anything like that ourselves. Such tricks definitely don't make the code clearer and readable.</p>
</div></div>
<h2 id="chapter-74">
Remainder %</h2>
<p>The remainder operator <code>%</code> despite its look does not have a relation to percents.</p>
<p>The result of <code>a % b</code> is the remainder of the integer division of <code>a</code> by <code>b</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 5 % 2 ); // 1 is a remainder of 5 divided by 2
alert( 8 % 3 ); // 2 is a remainder of 8 divided by 3
alert( 6 % 3 ); // 0 is a remainder of 6 divided by 3</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-75">
Exponentiation **</h2>
<p>The exponentiation operator <code>**</code> is a recent addition to the language.</p>
<p>For a natural number <code>b</code>, the result of <code>a ** b</code> is <code>a</code> multiplied by itself <code>b</code> times.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 2 ** 2 ); // 4  (2 * 2)
alert( 2 ** 3 ); // 8  (2 * 2 * 2)
alert( 2 ** 4 ); // 16 (2 * 2 * 2 * 2)</code></pre>
        </div>
      </div>
      
      </div><p>The operator works for non-integer numbers of <code>a</code> and <code>b</code> as well, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 4 ** (1/2) ); // 2 (power of 1/2 is the same as a square root, that's maths)
alert( 8 ** (1/3) ); // 2 (power of 1/3 is the same as a cubic root)</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-76">
Increment/decrement</h2>
<!-- Can't use -- in title, because built-in parse turns it into – -->
<p>Increasing or decreasing a number by one is among the most common numerical operations.</p>
<p>So, there are special operators for that:</p>
<ul>
<li>
<p><strong>Increment</strong> <code>++</code> increases a variable by 1:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 2;
counter++;      // works same as counter = counter + 1, but shorter
alert( counter ); // 3</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p><strong>Decrement</strong> <code>--</code> decreases a variable by 1:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 2;
counter--;      // works same as counter = counter - 1, but shorter
alert( counter ); // 1</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Important:</span></div>
            <div class="important__content"><p>Increment/decrement can be applied only to a variable. An attempt to use it on a value like <code>5++</code> will give an error.</p>
</div></div>
<p>Operators <code>++</code> and <code>--</code> can be placed both after and before the variable.</p>
<ul>
<li>When the operator goes after the variable, it is called a “postfix form”: <code>counter++</code>.</li>
<li>The “prefix form” is when the operator stands before the variable: <code>++counter</code>.</li>
</ul>
<p>Both of these records do the same: increase <code>counter</code> by <code>1</code>.</p>
<p>Is there any difference? Yes, but we can only see it if we use the returned value of <code>++/--</code>.</p>
<p>Let's clarify. As we know, all operators return a value. Increment/decrement is not an exception here. The prefix form returns the new value, while the postfix form returns the old value (prior to increment/decrement).</p>
<p>To see the difference, here's the example:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:13-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 1;
let a = ++counter; // (*)

alert(a); // 2</code></pre>
        </div>
      </div>
      
      </div><p>Here in the line <code>(*)</code> the prefix call <code>++counter</code> increments <code>counter</code> and returns the new value that is <code>2</code>. So the <code>alert</code> shows <code>2</code>.</p>
<p>Now let's use the postfix form:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:13-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 1;
let a = counter++; // (*) changed ++counter to counter++

alert(a); // 1</code></pre>
        </div>
      </div>
      
      </div><p>In the line <code>(*)</code> the <em>postfix</em> form <code>counter++</code> also increments <code>counter</code>, but returns the <em>old</em> value (prior to increment). So the <code>alert</code> shows <code>1</code>.</p>
<p>To summarize:</p>
<ul>
<li>
<p>If the result of increment/decrement is not used, then there is no difference in which form to use:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 0;
counter++;
++counter;
alert( counter ); // 2, the lines above did the same</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>If we'd like to increase the value <em>and</em> use the result of the operator right now, then we need the prefix form:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 0;
alert( ++counter ); // 1</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>If we'd like to increment, but use the previous value, then we need the postfix form:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 0;
alert( counter++ ); // 0</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Increment/decrement among other operators</span></div>
            <div class="important__content"><p>Operators <code>++/--</code> can be used inside an expression as well. Their precedence is higher than most other arithmetical operations.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 1;
alert( 2 * ++counter ); // 4</code></pre>
        </div>
      </div>
      
      </div><p>Compare with:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 1;
alert( 2 * counter++ ); // 2, because counter++ returns the "old" value</code></pre>
        </div>
      </div>
      
      </div><p>Though technically allowable, such notation usually makes the code less readable. One line does multiple things – not good.</p>
<p>While reading the code, a fast “vertical” eye-scan can easily miss such <code>counter++</code>, and it won't be obvious that the variable increases.</p>
<p>The “one line – one action” style is advised:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let counter = 1;
alert( 2 * counter );
counter++;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-77">
Bitwise operators</h2>
<p>Bitwise operators treat arguments as 32-bit integer numbers and work on the level of their binary representation.</p>
<p>These operators are not JavaScript-specific. They are supported in most programming languages.</p>
<p>The list of operators:</p>
<ul>
<li>AND ( <code>&amp;</code> )</li>
<li>OR ( <code>|</code> )</li>
<li>XOR ( <code>^</code> )</li>
<li>NOT ( <code>~</code> )</li>
<li>LEFT SHIFT ( <code>&lt;&lt;</code> )</li>
<li>RIGHT SHIFT ( <code>&gt;&gt;</code> )</li>
<li>ZERO-FILL RIGHT SHIFT ( <code>&gt;&gt;&gt;</code> )</li>
</ul>
<p>These operators are used very rarely. To understand them, we should delve into low-level number representation, and it would not be optimal to do that right now. Especially because we won't need them any time soon. If you're curious, you can read the 
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators">Bitwise Operators</a> article in MDN. It would be more practical to do that when a real need arises.</p>
<h2 id="chapter-78">
Modify-in-place</h2>
<p>We often need to apply an operator to a variable and store the new result in it.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let n = 2;
n = n + 5;
n = n * 2;</code></pre>
        </div>
      </div>
      
      </div><p>This notation can be shortened using operators <code>+=</code> and <code>*=</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let n = 2;
n += 5; // now n = 7 (same as n = n + 5)
n *= 2; // now n = 14 (same as n = n * 2)

alert( n ); // 14</code></pre>
        </div>
      </div>
      
      </div><p>Short “modify-and-assign” operators exist for all arithmetical and bitwise operators: <code>/=</code>, <code>-=</code> etc.</p>
<p>Such operators have the same precedence as a normal assignment, so they run after most other calculations:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let n = 2;

n *= 3 + 5;

alert( n ); // 16  (right part evaluated first, same as n *= 8)</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-79">
Comma</h2>
<p>The comma operator <code>','</code> is one of most rare and unusual operators. Sometimes it's used to write shorter code, so we need to know it in order to understand what's going on.</p>
<p>The comma operator allows us to evaluate several expressions, dividing them with a comma <code>','</code>. Each of them is evaluated, but the result of only the last one is returned.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = (1 + 2, 3 + 4);

alert( a ); // 7 (the result of 3 + 4)</code></pre>
        </div>
      </div>
      
      </div><p>Here, the first expression <code>1 + 2</code> is evaluated, and its result is thrown away, then <code>3 + 4</code> is evaluated and returned as the result.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Comma has a very low precedence</span></div>
            <div class="important__content"><p>Please note that the comma operator has very low precedence, lower than <code>=</code>, so parentheses are important in the example above.</p>
<p>Without them: <code>a = 1 + 2, 3 + 4</code> evaluates <code>+</code> first, summing the numbers into <code>a = 3, 7</code>, then the assignment operator <code>=</code> assigns    <code>a = 3</code>, and then the number after the comma <code>7</code> is not processed anyhow, so it's ignored.</p>
</div></div>
<p>Why do we need such an operator which throws away everything except the last part?</p>
<p>Sometimes people use it in more complex constructs to put several actions in one line.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:5-28">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// three operations in one line
for (a = 1, b = 3, c = a * b; a &lt; 10; a++) {
 ...
}</code></pre>
        </div>
      </div>
      
      </div><p>Such tricks are used in many JavaScript frameworks, that's why we mention them. But usually they don't improve the code readability, so we should think well before writing like that.</p>
<div class="tasks"><h2 id="chapter-80" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#the-postfix-and-prefix-forms" name="the-postfix-and-prefix-forms" class="main__anchor">The postfix and prefix forms</a></h3>
<a href="http://javascript.info/task/increment-order" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What are the final values of all variables <code>a</code>, <code>b</code>, <code>c</code> and <code>d</code> after the code below?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 1, b = 1;

let c = ++a; // ?
let d = b++; // ?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer is:</p>
<ul>
<li><code>a = 2</code></li>
<li><code>b = 2</code></li>
<li><code>c = 2</code></li>
<li><code>d = 1</code></li>
</ul>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 1, b = 1;

alert( ++a ); // 2, prefix form returns the new value
alert( b++ ); // 1, postfix form returns the old value

alert( a ); // 2, incremented once
alert( b ); // 2, incremented once</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#assignment-result" name="assignment-result" class="main__anchor">Assignment result</a></h3>
<a href="http://javascript.info/task/assignment-result" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>What are the values of <code>a</code> and <code>x</code> after the code below?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 2;

let x = 1 + (a *= 2);</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer is:</p>
<ul>
<li><code>a = 4</code> (multiplied by 2)</li>
<li><code>x = 5</code> (calculated as 1 + 4)</li>
</ul>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-81"></h6>
<h1 class="main__header-title" id="chapter-82">Comparisons</h1>
<p>Many comparison operators we know from maths:</p>
<ul>
<li>Greater/less than: <code>a &gt; b</code>, <code>a &lt; b</code>.</li>
<li>Greater/less than or equals: <code>a &gt;= b</code>, <code>a &lt;= b</code>.</li>
<li>Equality check is written as <code>a == b</code> (please note the double equation sign <code>'='</code>. A single symbol <code>a = b</code> would mean an assignment).</li>
<li>Not equals. In maths the notation is <code>≠</code>, in JavaScript it's written as an assignment with an exclamation sign before it: <code>a != b</code>.</li>
</ul>


<h2 id="chapter-83">
Boolean is the result</h2>
<p>Just as all other operators, a comparison returns a value. The value is of the boolean type.</p>
<ul>
<li><code>true</code> – means “yes”, “correct” or “the truth”.</li>
<li><code>false</code> – means “no”, “wrong” or “a lie”.</li>
</ul>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 2 &gt; 1 );  // true (correct)
alert( 2 == 1 ); // false (wrong)
alert( 2 != 1 ); // true (correct)</code></pre>
        </div>
      </div>
      
      </div><p>A comparison result can be assigned to a variable, just like any value:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let result = 5 &gt; 4; // assign the result of the comparison
alert( result ); // true</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-84">
String comparison</h2>
<p>To see which string is greater than the other, the so-called “dictionary” or “lexicographical” order is used.</p>
<p>In other words, strings are compared letter-by-letter.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'Z' &gt; 'A' ); // true
alert( 'Glow' &gt; 'Glee' ); // true
alert( 'Bee' &gt; 'Be' ); // true</code></pre>
        </div>
      </div>
      
      </div><p>The algorithm to compare two strings is simple:</p>
<ol>
<li>Compare first characters of both strings.</li>
<li>If the first one is greater(or less), then the first string is greater(or less) than the second. We're done.</li>
<li>Otherwise if first characters are equal, compare the second characters the same way.</li>
<li>Repeat until the end of any string.</li>
<li>If both strings ended simultaneously, then they are equal. Otherwise the longer string is greater.</li>
</ol>
<p>In the example above, the comparison <code>'Z' &gt; 'A'</code> gets the result at the first step.</p>
<p>Strings <code>"Glow"</code> and <code>"Glee"</code> are compared character-by-character:</p>
<ol>
<li><code>G</code> is the same as <code>G</code>.</li>
<li><code>l</code> is the same as <code>l</code>.</li>
<li><code>o</code> is greater than <code>e</code>. Stop here. The first string is greater.</li>
</ol>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Not a real dictionary, but Unicode order</span></div>
            <div class="important__content"><p>The comparison algorithm given above is roughly equivalent to the one used in book dictionaries or phone books. But it's not exactly the same.</p>
<p>For instance, case matters. A capital letter <code>"A"</code> is not equal to the lowercase <code>"a"</code>. Which one is greater? Actually, the lowercase <code>"a"</code> is. Why? Because the lowercase character has a greater index in the internal encoding table (Unicode). We'll get back to specific details and consequences in the chapter 
<a href="http://javascript.info/string">Strings</a>.</p>
</div></div>
<h2 id="chapter-85">
Comparison of different types</h2>
<p>When compared values belong to different types, they are converted to numbers.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '2' &gt; 1 ); // true, string '2' becomes a number 2
alert( '01' == 1 ); // true, string '01' becomes a number 1</code></pre>
        </div>
      </div>
      
      </div><p>For boolean values, <code>true</code> becomes <code>1</code> and <code>false</code> becomes <code>0</code>, that's why:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( true == 1 ); // true
alert( false == 0 ); // true</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">A funny consequence</span></div>
            <div class="important__content"><p>It is possible that at the same time:</p>
<ul>
<li>Two values are equal.</li>
<li>One of them is <code>true</code> as a boolean and the other one is <code>false</code> as a boolean.</li>
</ul>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 0;
alert( Boolean(a) ); // false

let b = "0";
alert( Boolean(b) ); // true

alert(a == b); // true!</code></pre>
        </div>
      </div>
      
      </div><p>From JavaScript's standpoint that's quite normal. An equality check converts using the numeric conversion (hence <code>"0"</code> becomes <code>0</code>), while <code>Boolean</code> conversion uses another set of rules.</p>
</div></div>
<h2 id="chapter-86">
Strict equality</h2>
<p>A regular equality check <code>"=="</code> has a problem. It cannot differ <code>0</code> from <code>false</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 0 == false ); // true</code></pre>
        </div>
      </div>
      
      </div><p>The same thing with an empty string:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '' == false ); // true</code></pre>
        </div>
      </div>
      
      </div><p>That's because operands of different types are converted to a number by the equality operator <code>==</code>. An empty string, just like <code>false</code>, becomes a zero.</p>
<p>What to do if we'd like to differentiate <code>0</code> from <code>false</code>?</p>
<p><strong>A strict equality operator <code>===</code> checks the equality without type conversion.</strong></p>
<p>In other words, if <code>a</code> and <code>b</code> are of different types, then <code>a === b</code> immediately returns <code>false</code> without an attempt to convert them.</p>
<p>Let's try it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 0 === false ); // false, because the types are different</code></pre>
        </div>
      </div>
      
      </div><p>There also exists a “strict non-equality” operator <code>!==</code>, as an analogy for <code>!=</code>.</p>
<p>The strict equality check operator is a bit longer to write, but makes it obvious what's going on and leaves less space for errors.</p>
<h2 id="chapter-87">
Comparison with null and undefined</h2>
<p>Let's see more edge cases.</p>
<p>There's a non-intuitive behavior when <code>null</code> or <code>undefined</code> are compared with other values.</p>
<dl>
<dt>For a strict equality check <code>===</code></dt>
<dd>
<p>These values are different, because each of them belong to a separate type of it's own.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( null === undefined ); // false</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt>For a non-strict check <code>==</code></dt>
<dd>
<p>There's a special rule. These two are a “sweet couple”: they equal each other (in the sense of <code>==</code>), but not any other value.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( null == undefined ); // true</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt>For maths and other comparisons <code>&lt; &gt; &lt;= &gt;=</code></dt>
<dd>
<p>Values <code>null/undefined</code> are converted to a number: <code>null</code> becomes <code>0</code>, while <code>undefined</code> becomes <code>NaN</code>.</p>
</dd>
</dl>
<p>Now let's see funny things that happen when we apply those rules. And, what's more important, how to not fall into a trap with these features.</p>
<h3>
Strange result: null vs 0</a></h3><p>Let's compare <code>null</code> with a zero:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:27-31">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( null &gt; 0 );  // (1) false
alert( null == 0 ); // (2) false
alert( null &gt;= 0 ); // (3) true</code></pre>
        </div>
      </div>
      
      </div><p>Yeah, mathematically that's strange. The last result states that "<code>null</code> is greater than or equal to zero". Then one of the comparisons above must be correct, but they are both false.</p>
<p>The reason is that an equality check <code>==</code> and comparisons <code>&gt; &lt; &gt;= &lt;=</code> work differently. Comparisons convert <code>null</code> to a number, hence treat it as <code>0</code>. That's why (3) <code>null &gt;= 0</code> is true and (1) <code>null &gt; 0</code> is false.</p>
<p>On the other hand, the equality check <code>==</code> for <code>undefined</code> and <code>null</code> works by the rule, without any conversions. They equal each other and don't equal anything else. That's why (2) <code>null == 0</code> is false.</p>
<h3>
An incomparable undefined</a></h3><p>The value <code>undefined</code> shouldn't participate in comparisons at all:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( undefined &gt; 0 ); // false (1)
alert( undefined &lt; 0 ); // false (2)
alert( undefined == 0 ); // false (3)</code></pre>
        </div>
      </div>
      
      </div><p>Why does it dislike a zero so much? Always false!</p>
<p>We've got these results because:</p>
<ul>
<li>Comparisons <code>(1)</code> and <code>(2)</code> return <code>false</code> because <code>undefined</code> gets converted to <code>NaN</code>. And <code>NaN</code> is a special numeric value which returns <code>false</code> for all comparisons.</li>
<li>The equality check <code>(3)</code> returns <code>false</code>, because <code>undefined</code> only equals <code>null</code> and no other value.</li>
</ul>
<h3>
Evade problems</a></h3><p>Why did we observe these examples? Should we remember these peculiarities all the time? Well, not really. Actually, these tricky things will gradually become familiar over time, but there's a solid way to evade any problems with them.</p>
<p>Just treat any comparison with <code>undefined/null</code> except the strict equality <code>===</code> with exceptional care.</p>
<p>Don't use comparisons <code>&gt;= &gt; &lt; &lt;=</code> with a variable which may be <code>null/undefined</code>, unless you are really sure what you're doing. If a variable can have such values, then check for them separately.</p>
<h2 id="chapter-88">
Summary</h2>
<ul>
<li>Comparison operators return a logical value.</li>
<li>Strings are compared letter-by-letter in the “dictionary” order.</li>
<li>When values of different types are compared, they get converted to numbers (with the exclusion of a strict equality check).</li>
<li>Values <code>null</code> and <code>undefined</code> equal <code>==</code> each other and do not equal any other value.</li>
<li>Be careful when using comparisons like <code>&gt;</code> or <code>&lt;</code> with variables that can occasionally be <code>null/undefined</code>. Making a separate check for <code>null/undefined</code> is a good idea.</li>
</ul>
<div class="tasks"><h2 id="chapter-89" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#comparisons" name="comparisons" class="main__anchor">Comparisons</a></h3>
<a href="http://javascript.info/task/comparison-questions" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What will be the result for expressions?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">5 &gt; 4
"apple" &gt; "pineapple"
"2" &gt; "12"
undefined == null
undefined === null
null == "\n0\n"
null === +"\n0\n"</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">5 &gt; 4 → true
"apple" &gt; "pineapple" → false
"2" &gt; "12" → true
undefined == null → true
undefined === null → false
null == "\n0\n" → false
null === +"\n0\n" → false</code></pre>
        </div>
      </div>
      
      </div><p>Some of the reasons:</p>
<ol>
<li>Obviously, true.</li>
<li>Dictionary comparison, hence false.</li>
<li>Again, dictionary comparison, first char of <code>"2"</code> is greater than the first char of <code>"1"</code>.</li>
<li>Values <code>null</code> and <code>undefined</code> equal each other only.</li>
<li>Strict equality is strict. Different types from both sides lead to false.</li>
<li>See (4).</li>
<li>Strict equality of different types.</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-90"></h6>
<h1 class="main__header-title" id="chapter-91">Interaction: alert, prompt, confirm</h1>
<p>This part of the tutorial aims to cover JavaScript “as is”, without environment-specific tweaks.</p>
<p>But still we use a browser as the demo environment. So we should know at least a few user-interface functions. In this chapter we'll get familiar with the browser functions <code>alert</code>, <code>prompt</code> and <code>confirm</code>.</p>


<h2 id="chapter-92">
alert</h2>
<p>Syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(message);</code></pre>
        </div>
      </div>
      
      </div><p>This shows a message and pauses the script execution until the user presses “OK”.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("Hello");</code></pre>
        </div>
      </div>
      
      </div><p>The mini-window with the message is called a <em>modal window</em>. The word “modal” means that the visitor can't interact with the rest of the page, press other buttons etc, until they have dealt with the window. In this case – until they press “OK”.</p>
<h2 id="chapter-93">
prompt</h2>
<p>Function <code>prompt</code> accepts two arguments:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">result = prompt(title[, default]);</code></pre>
        </div>
      </div>
      
      </div><p>It shows a modal window with a text message, an input field for the visitor and buttons OK/CANCEL.</p>
<dl>
<dt><code>title</code></dt>
<dd>The text to show to the visitor.</dd>
<dt><code>default</code></dt>
<dd>An optional second parameter, the initial value for the input field.</dd>
</dl>
<p>The visitor may type something in the prompt input field and press OK. Or they can cancel the input by pressing the CANCEL button or hitting the <kbd class="shortcut">Esc</kbd> key.</p>
<p>The call to <code>prompt</code> returns the text from the field or <code>null</code> if the input was canceled.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = prompt('How old are you?', 100);

alert(`You are ${age} years old!`); // You are 100 years old!</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">IE: always supply a <code>default</code></span></div>
            <div class="important__content"><p>The second parameter is optional. But if we don't supply it, Internet Explorer would insert the text <code>"undefined"</code> into the prompt.</p>
<p>Run this code in Internet Explorer to see that:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let test = prompt("Test");</code></pre>
        </div>
      </div>
      
      </div><p>So, to look good in IE, it's recommended to always provide the second argument:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let test = prompt("Test", ''); // &lt;-- for IE</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-94">
confirm</h2>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">result = confirm(question);</code></pre>
        </div>
      </div>
      
      </div><p>Function <code>confirm</code> shows a modal window with a <code>question</code> and two buttons: OK and CANCEL.</p>
<p>The result is <code>true</code> if OK is pressed and <code>false</code> otherwise.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let isBoss = confirm("Are you the boss?");

alert( isBoss ); // true if OK is pressed</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-95">
Summary</h2>
<p>We covered 3 browser-specific functions to interact with the visitor:</p>
<dl>
<dt><code>alert</code></dt>
<dd>shows a message.</dd>
<dt><code>prompt</code></dt>
<dd>shows a message asking the user to input text. It returns the text or, if CANCEL or <kbd class="shortcut">Esc</kbd> is clicked, all browsers return <code>null</code>.</dd>
<dt><code>confirm</code></dt>
<dd>shows a message and waits for the user to press “OK” or “CANCEL”. It returns <code>true</code> for OK and <code>false</code> for CANCEL/<kbd class="shortcut">Esc</kbd>.</dd>
</dl>
<p>All these methods are modal: they pause the script execution and don't allow the visitor to interact with the rest of the page until the message has been dismissed.</p>
<p>There are two limitations shared by all the methods above:</p>
<ol>
<li>The exact location of the modal window is determined by the browser. Usually it's in the center.</li>
<li>The exact look of the window also depends on the browser. We can't modify it.</li>
</ol>
<p>That is the price for simplicity. There are other ways to show nicer windows and richer interaction with the visitor, but if “bells and whistles” do not matter much, these methods work just fine.</p>
<div class="tasks"><h2 id="chapter-96" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#a-simple-page" name="a-simple-page" class="main__anchor">A simple page</a></h3>
<a href="http://javascript.info/task/simple-page" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Create a web-page that asks for a name and outputs it.</p>
<p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>JavaScript-code:</p>
<div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let name = prompt("What is your name?", "");
alert(name);</code></pre>
        </div>
      </div>
      
      </div><p>The full page:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;

  &lt;script&gt;
    'use strict';

    let name = prompt("What is your name?", "");
    alert(name);
  &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-97"></h6>
<h1 class="main__header-title" id="chapter-98">Conditional operators: if, '?'</h1>
<p>Sometimes we need to perform different actions based on a condition.</p>
<p>There is the <code>if</code> statement for that and also the conditional (ternary) operator for conditional evaluation which we will be referring as  the “question mark” operator: <code>"?"</code> for simplicity.</p>


<h2 id="chapter-99">
The “if” statement</h2>
<p>The “if” statement gets a condition, evaluates it and, if the result is <code>true</code>, executes the code.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let year = prompt('In which year was ECMAScript-2015 specification published?', '');

if (year == 2015) alert( 'You are right!' );</code></pre>
        </div>
      </div>
      
      </div><p>In the example above, the condition is a simple equality check: <code>year == 2015</code>, but it can be much more complex.</p>
<p>If there is more than one command to execute, we can use a code block in figure brackets:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (year == 2015) {
  alert( "That's correct!" );
  alert( "You're so smart!" );
}</code></pre>
        </div>
      </div>
      
      </div><p>It is recommended to use figure brackets every time with <code>if</code>, even if there is only one command. That improves readability.</p>
<h2 id="chapter-100">
Boolean conversion</h2>
<p>The <code>if (…)</code> statement evaluates the expression in parentheses and converts it to the boolean type.</p>
<p>Let's recall the conversion rules from the chapter 
<a href="http://javascript.info/type-conversions">Type Conversions</a>:</p>
<ul>
<li>A number <code>0</code>, an empty string <code>""</code>, <code>null</code>, <code>undefined</code> and <code>NaN</code> become <code>false</code>. Because of that they are called “falsy” values.</li>
<li>Other values become <code>true</code>, so they are called “truthy”.</li>
</ul>
<p>So, the code under this condition would never execute:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (0) { // 0 is falsy
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>…And inside this condition – always works:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (1) { // 1 is truthy
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>We can also pass a pre-evaluated boolean value to <code>if</code>, like here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let cond = (year == 2015); // equality evaluates to true or false

if (cond) {
  ...
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-101">
The “else” clause</h2>
<p>The <code>if</code> statement may contain an optional “else” block. It executes when the condition is wrong.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let year = prompt('In which year was ECMAScript-2015 specification published?', '');

if (year == 2015) {
  alert( 'You guessed it right!' );
} else {
  alert( 'How can you be so wrong?' ); // any value except 2015
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-102">
Several conditions: “else if”</h2>
<p>Sometimes we'd like to test several variants of a condition. There is an <code>else if</code> clause for that.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let year = prompt('In which year was ECMAScript-2015 specification published?', '');

if (year &lt; 2015) {
  alert( 'Too early...' );
} else if (year &gt; 2015) {
  alert( 'Too late' );
} else {
  alert( 'Exactly!' );
}</code></pre>
        </div>
      </div>
      
      </div><p>In the code above JavaScript first checks <code>year &lt; 2015</code>. If it is falsy it then goes to the next condition <code>year &gt; 2015</code>, and otherwise shows the last <code>alert</code>.</p>
<p>There can be more <code>else if</code> blocks. The ending <code>else</code> is optional.</p>
<h2 id="chapter-103">
Ternary operator ‘?'</h2>
<p>Sometimes we need to assign a variable depending on a condition.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let accessAllowed;
let age = prompt('How old are you?', '');

if (age &gt; 18) {
  accessAllowed = true;
} else {
  accessAllowed = false;
}

alert(accessAllowed);</code></pre>
        </div>
      </div>
      
      </div><p>The so-called “ternary” or “question mark” operator lets us do that shorter and simpler.</p>
<p>The operator is represented by a question mark <code>"?"</code>.  The formal term “ternary” means that the operator has three operands. It is actually the one and only operator in JavaScript which has that many.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let result = condition ? value1 : value2</code></pre>
        </div>
      </div>
      
      </div><p>The <code>condition</code> is evaluated, if it's truthy then <code>value1</code> is returned, otherwise – <code>value2</code>.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let accessAllowed = (age &gt; 18) ? true : false;</code></pre>
        </div>
      </div>
      
      </div><p>Technically, we can omit parentheses around <code>age &gt; 18</code>. The question mark operator has a low precedence. It executes after the comparison <code>&gt;</code>, so that'll do the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// the comparison operator "age &gt; 18" executes first anyway
// (no need to wrap it into parentheses)
let accessAllowed = age &gt; 18 ? true : false;</code></pre>
        </div>
      </div>
      
      </div><p>…But parentheses make the code more readable. So it's recommended to use them.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Please note:</span></div>
            <div class="important__content"><p>In the example above it's possible to evade the question mark operator, because the comparison by itself returns <code>true/false</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// the same
let accessAllowed = age &gt; 18;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-104">
Multiple ‘?'</h2>
<p>A sequence of question mark <code>"?"</code> operators allows returning a value that depends on more than one condition.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = prompt('age?', 18);

let message = (age &lt; 3) ? 'Hi, baby!' :
  (age &lt; 18) ? 'Hello!' :
  (age &lt; 100) ? 'Greetings!' :
  'What an unusual age!';

alert( message );</code></pre>
        </div>
      </div>
      
      </div><p>It may be difficult at first to grasp what's going on. But after a closer look we can see that it's just an ordinary sequence of tests.</p>
<ol>
<li>The first question mark checks whether <code>age &lt; 3</code>.</li>
<li>If true – returns <code>'Hi, baby!'</code>, otherwise – goes after the colon <code>":"</code> and checks for <code>age &lt; 18</code>.</li>
<li>If that's true – returns <code>'Hello!'</code>, otherwise – goes after the next colon <code>":"</code> and checks for <code>age &lt; 100</code>.</li>
<li>If that's true – returns <code>'Greetings!'</code>, otherwise – goes after the last colon <code>":"</code> and returns <code>'What an unusual age!'</code>.</li>
</ol>
<p>The same logic using <code>if..else</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (age &lt; 3) {
  message = 'Hi, baby!';
} else if (a &lt; 18) {
  message = 'Hello!';
} else if (age &lt; 100) {
  message = 'Greetings!';
} else {
  message = 'What an unusual age!';
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-105">
Non-traditional use of ‘?'</h2>
<p>Sometimes the question mark <code>'?'</code> is used as a replacement for <code>if</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let company = prompt('Which company created JavaScript?', '');

(company == 'Netscape') ?
   alert('Right!') : alert('Wrong.');</code></pre>
        </div>
      </div>
      
      </div><p>Depending on the condition <code>company == 'Netscape'</code>, either the first or the second part after <code>"?"</code> gets executed and shows the alert.</p>
<p>We don't assign a result to a variable here. The idea is to execute different code depending on the condition.</p>
<p><strong>It is not recommended to use the question mark operator in this way.</strong></p>
<p>The notation seems to be shorter than <code>if</code>, which appeals to some programmers. But it is less readable.</p>
<p>Here is the same code with <code>if</code> for comparison:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let company = prompt('Which company created JavaScript?', '');

if (company == 'Netscape') {
  alert('Right!');
} else {
  alert('Wrong.');
}</code></pre>
        </div>
      </div>
      
      </div><p>Our eyes scan the code vertically. The constructs which span several lines are easier to understand than a long horizontal instruction set.</p>
<p>The idea of a question mark <code>'?'</code> is to return one or another value depending on the condition. Please use it for exactly that. There is <code>if</code> to execute different branches of the code.</p>
<div class="tasks"><h2 id="chapter-106" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#if-a-string-with-zero" name="if-a-string-with-zero" class="main__anchor">if (a string with zero)</a></h3>
<a href="http://javascript.info/task/if-zero-string" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Will <code>alert</code> be shown?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if ("0") {
  alert( 'Hello' );
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p><strong>Yes, it will.</strong></p>
<p>Any string except an empty one (and <code>"0"</code> is not empty) becomes <code>true</code> in the logical context.</p>
<p>We can run and check:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if ("0") {
  alert( 'Hello' );
}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#the-name-of-javascript" name="the-name-of-javascript" class="main__anchor">The name of JavaScript</a></h3>
<a href="http://javascript.info/task/check-standard" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>Using the <code>if..else</code> construct, write the code which asks: ‘What is the “official” name of JavaScript?'</p>
<p>If the visitor enters “ECMAScript”, then output “Right!”, otherwise – output: “Didn't know? ECMAScript!”</p>
      <img src="http://javascript.info/task/check-standard/ifelse_task2.png">
<p>
<a href="https://en.js.cx/task/check-standard/ifelse_task2/" target="blank">Demo in new window</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;body&gt;
  &lt;script&gt;
    'use strict';

    let value = prompt('What is the "official" name of JavaScript?', '');

    if (value == 'ECMAScript') {
      alert('Right!');
    } else {
      alert("You don't know? ECMAScript!");
    }
  &lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#show-the-sign" name="show-the-sign" class="main__anchor">Show the sign</a></h3>
<a href="http://javascript.info/task/sign" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>Using <code>if..else</code>, write the code which gets a number via <code>prompt</code> and then shows in <code>alert</code>:</p>
<ul>
<li><code>1</code>, if the value is greater than zero,</li>
<li><code>-1</code>, if less than zero,</li>
<li><code>0</code>, if equals zero.</li>
</ul>
<p>In this task we assume that the input is always a number.</p>
<p>
<a href="https://en.js.cx/task/sign/if_sign/" target="blank">Demo in new window</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let value = prompt('Type a number', 0);

if (value &gt; 0) {
  alert( 1 );
} else if (value &lt; 0) {
  alert( -1 );
} else {
  alert( 0 );
}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#check-the-login" name="check-the-login" class="main__anchor">Check the login</a></h3>
<a href="http://javascript.info/task/check-login" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>Write the code which asks for a login with <code>prompt</code>.</p>
<p>If the visitor enters <code>"Admin"</code>, then <code>prompt</code> for a password, if the input is an empty line or <kbd class="shortcut">Esc</kbd> – show “Canceled.”, if it's another string – then show “I don't know you”.</p>
<p>The password is checked as follows:</p>
<ul>
<li>If it equals “TheMaster”, then show “Welcome!”,</li>
<li>Another string – show “Wrong password”,</li>
<li>For an empty string or cancelled input, show “Canceled.”</li>
</ul>
<p>The schema:</p>
      <img src="http://javascript.info/task/check-login/ifelse_task.png">
<p>Please use nested <code>if</code> blocks. Mind the overall readability of the code.</p>
<p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let userName = prompt("Who's there?", '');

if (userName == 'Admin') {

  let pass = prompt('Password?', '');

  if (pass == 'TheMaster') {
    alert( 'Welcome!' );
  } else if (pass == null) {
    alert( 'Canceled.' );
  } else {
    alert( 'Wrong password' );
  }

} else if (userName == null) {
  alert( 'Canceled' );
} else {
  alert( "I don't know you" );
}</code></pre>
        </div>
      </div>
      
      </div><p>Note the vertical indents inside the <code>if</code> blocks. They are technically not required, but make the code more readable.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-if-into" name="rewrite-if-into" class="main__anchor">Rewrite 'if' into '?'</a></h3>
<a href="http://javascript.info/task/rewrite-if-question" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Rewrite this <code>if</code> using the ternary operator <code>'?'</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (a + b &lt; 4) {
  result = 'Below';
} else {
  result = 'Over';
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">result = (a + b &lt; 4) ? 'Below' : 'Over';</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-if-else-into" name="rewrite-if-else-into" class="main__anchor">Rewrite 'if..else' into '?'</a></h3>
<a href="http://javascript.info/task/rewrite-if-else-question" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Rewrite <code>if..else</code> using multiple ternary operators <code>'?'</code>.</p>
<p>For readability, it's recommended to split the code into multiple lines.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let message;

if (login == 'Employee') {
  message = 'Hello';
} else if (login == 'Director') {
  message = 'Greetings';
} else if (login == '') {
  message = 'No login';
} else {
  message = '';
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let message = (login == 'Employee') ? 'Hello' :
  (login == 'Director') ? 'Greetings' :
  (login == '') ? 'No login' :
  '';</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-107"></h6>
<h1 class="main__header-title" id="chapter-108">Logical operators</h1>
<p>There are three logical operators in JavaScript: <code>||</code> (OR), <code>&amp;&amp;</code> (AND), <code>!</code> (NOT).</p>
<p>Although they are called “logical”, they can be applied to values of any type, not only boolean. The result can also be of any type.</p>
<p>Let's see the details.</p>


<h2 id="chapter-109">
|| (OR)</h2>
<p>The “OR” operator is represented with two vertical line symbols:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">result = a || b;</code></pre>
        </div>
      </div>
      
      </div><p>In classical programming, logical OR is meant to manipulate boolean values only. If any of its arguments are <code>true</code>, then it returns <code>true</code>, otherwise it returns <code>false</code>.</p>
<p>In JavaScript the operator is a little bit more tricky and powerful. But first let's see what happens with boolean values.</p>
<p>There are four possible logical combinations:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( true || true );   // true
alert( false || true );  // true
alert( true || false );  // true
alert( false || false ); // false</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, the result is always <code>true</code> except for the case when both operands are <code>false</code>.</p>
<p>If an operand is not boolean, then it's converted to boolean for the evaluation.</p>
<p>For instance, a number <code>1</code> is treated as <code>true</code>, a number <code>0</code> – as <code>false</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (1 || 0) { // works just like if( true || false )
  alert( 'truthy!' );
}</code></pre>
        </div>
      </div>
      
      </div><p>Most of the time, OR <code>||</code> is used in an <code>if</code> statement to test if <em>any</em> of the given conditions is correct.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let hour = 9;

if (hour &lt; 10 || hour &gt; 18) {
  alert( 'The office is closed.' );
}</code></pre>
        </div>
      </div>
      
      </div><p>We can pass more conditions:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let hour = 12;
let isWeekend = true;

if (hour &lt; 10 || hour &gt; 18 || isWeekend) {
  alert( 'The office is closed.' ); // it is the weekend
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-110">
OR seeks the first truthy value</h2>
<p>The logic described above is somewhat classical. Now let's bring in the “extra” features of JavaScript.</p>
<p>The extended algorithm works as follows.</p>
<p>Given multiple OR'ed values:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">result = value1 || value2 || value3;</code></pre>
        </div>
      </div>
      
      </div><p>The OR <code>"||"</code> operator does the following:</p>
<ul>
<li>Evaluate operands from left to right.</li>
<li>For each operand, convert it to boolean. If the result is <code>true</code>, then stop and return the original value of that operand.</li>
<li>If all other operands have been assessed (i.e. all were <code>falsy</code>), return the last operand.</li>
</ul>
<p>A value is returned in its original form, without the conversion.</p>
<p>In other words, a chain of OR <code>"||"</code> returns the first truthy value or the last one if no such value is found.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1 || 0 ); // 1 (1 is truthy)
alert( true || 'no matter what' ); // (true is truthy)

alert( null || 1 ); // 1 (1 is the first truthy value)
alert( null || 0 || 1 ); // 1 (the first truthy value)
alert( undefined || null || 0 ); // 0 (all falsy, returns the last value)</code></pre>
        </div>
      </div>
      
      </div><p>That leads to some interesting usages compared to a “pure, classical, boolean-only OR”.</p>
<ol>
<li>
<p><strong>Getting the first truthy value from the list of variables or expressions.</strong></p>
<p>Imagine we have several variables, which can either contain the data or be <code>null/undefined</code>. And we need to choose the first one with data.</p>
<p>We can use OR <code>||</code> for that:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let currentUser = null;
let defaultUser = "John";

let name = currentUser || defaultUser || "unnamed";

alert( name ); // selects "John" – the first truthy value</code></pre>
        </div>
      </div>
      
      </div><p>If both <code>currentUser</code> and <code>defaultUser</code> were falsy then <code>"unnamed"</code> would be the result.</p>
</li>
<li>
<p><strong>Short-circuit evaluation.</strong></p>
<p>Operands can be not only values, but arbitrary expressions. OR evaluates and tests them from left to right. The evaluation stops when a truthy value is reached, and the value is returned. The process is called “a short-circuit evaluation”, because it goes as short as possible from left to right.</p>
<p>This is clearly seen when the expression given as the second argument has a side effect. Like a variable assignment.</p>
<p>If we run the example below, <code>x</code> would not get assigned:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:0-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x;

true || (x = 1);

alert(x); // undefined, because (x = 1) not evaluated</code></pre>
        </div>
      </div>
      
      </div><p>…And if the first argument is <code>false</code>, then <code>OR</code> goes on and evaluates the second one thus running the assignment:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:0-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x;

false || (x = 1);

alert(x); // 1</code></pre>
        </div>
      </div>
      
      </div><p>An assignment is a simple case, other side effects can be involved.</p>
<p>As we can see, such a use case is a "shorter way to do <code>if</code>". The first operand is converted to boolean and if it's false then the second one is evaluated.</p>
<p>Most of time it's better to use a “regular” <code>if</code> to keep the code easy to understand, but sometimes that can be handy.</p>
</li>
</ol>
<h2 id="chapter-111">
&amp;&amp; (AND)</h2>
<p>The AND operator is represented with two ampersands <code>&amp;&amp;</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">result = a &amp;&amp; b;</code></pre>
        </div>
      </div>
      
      </div><p>In classical programming AND returns <code>true</code> if both operands are truthy and <code>false</code> otherwise:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( true &amp;&amp; true );   // true
alert( false &amp;&amp; true );  // false
alert( true &amp;&amp; false );  // false
alert( false &amp;&amp; false ); // false</code></pre>
        </div>
      </div>
      
      </div><p>An example with <code>if</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let hour = 12;
let minute = 30;

if (hour == 12 &amp;&amp; minute == 30) {
  alert( 'Time is 12:30' );
}</code></pre>
        </div>
      </div>
      
      </div><p>Just as for OR, any value is allowed as an operand of AND:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (1 &amp;&amp; 0) { // evaluated as true &amp;&amp; false
  alert( "won't work, because the result is falsy" );
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-112">
AND seeks the first falsy value</h2>
<p>Given multiple AND'ed values:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">result = value1 &amp;&amp; value2 &amp;&amp; value3;</code></pre>
        </div>
      </div>
      
      </div><p>The AND <code>"&amp;&amp;"</code> operator does the following:</p>
<ul>
<li>Evaluate operands from left to right.</li>
<li>For each operand, convert it to a boolean. If the result is <code>false</code>, stop and return the original value of that operand.</li>
<li>If all other operands have been assessed (i.e. all were truthy), return the last operand.</li>
</ul>
<p>In other words, AND returns the first falsy value or the last value if none were found.</p>
<p>The rules above are similar to OR. The difference is that AND returns the first <em>falsy</em> value while OR returns the first <em>truthy</em> one.</p>
<p>Examples:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// if the first operand is truthy,
// AND returns the second operand:
alert( 1 &amp;&amp; 0 ); // 0
alert( 1 &amp;&amp; 5 ); // 5

// if the first operand is falsy,
// AND returns it. The second operand is ignored
alert( null &amp;&amp; 5 ); // null
alert( 0 &amp;&amp; "no matter what" ); // 0</code></pre>
        </div>
      </div>
      
      </div><p>We can also pass several values in a row. See how the first falsy one is returned:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1 &amp;&amp; 2 &amp;&amp; null &amp;&amp; 3 ); // null</code></pre>
        </div>
      </div>
      
      </div><p>When all values are truthy, the last value is returned:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1 &amp;&amp; 2 &amp;&amp; 3 ); // 3, the last one</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">AND <code>&amp;&amp;</code> executes before OR <code>||</code></span></div>
            <div class="important__content"><p>The precedence of the AND <code>&amp;&amp;</code> operator is higher than OR <code>||</code>, so it executes before OR.</p>
<p>In the code below <code>1 &amp;&amp; 0</code> is calculated first:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 5 || 1 &amp;&amp; 0 ); // 5</code></pre>
        </div>
      </div>
      
      </div></div></div>
<p>Just like OR, the AND <code>&amp;&amp;</code> operator can sometimes replace <code>if</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x = 1;

(x &gt; 0) &amp;&amp; alert( 'Greater than zero!' );</code></pre>
        </div>
      </div>
      
      </div><p>The action in the right part of <code>&amp;&amp;</code> would execute only if the evaluation reaches it. That is: only if <code>(x &gt; 0)</code> is true.</p>
<p>So we basically have an analogue for:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x = 1;

if (x &gt; 0) {
  alert( 'Greater than zero!' );
}</code></pre>
        </div>
      </div>
      
      </div><p>The variant with <code>&amp;&amp;</code> appears to be shorter. But <code>if</code> is more obvious and tends to be a little bit more readable.</p>
<p>So it is recommended to use every construct for its purpose. Use <code>if</code> if we want if. And use <code>&amp;&amp;</code> if we want AND.</p>
<h2 id="chapter-113">
! (NOT)</h2>
<p>The boolean NOT operator is represented with an exclamation sign <code>"!"</code>.</p>
<p>The syntax is pretty simple:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">result = !value;</code></pre>
        </div>
      </div>
      
      </div><p>The operator accepts a single argument and does the following:</p>
<ol>
<li>Converts the operand to boolean type: <code>true/false</code>.</li>
<li>Returns an inverse value.</li>
</ol>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( !true ); // false
alert( !0 ); // true</code></pre>
        </div>
      </div>
      
      </div><p>A double NOT <code>!!</code> is sometimes used for converting a value to boolean type:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( !!"non-empty string" ); // true
alert( !!null ); // false</code></pre>
        </div>
      </div>
      
      </div><p>That is, the first NOT converts the value to boolean and returns the inverse, and the second NOT inverses it again. At the end we have a plain value-to-boolean conversion.</p>
<p>There's a little more verbose way to do the same thing – a built-in <code>Boolean</code> function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Boolean("non-empty string") ); // true
alert( Boolean(null) ); // false</code></pre>
        </div>
      </div>
      
      </div><div class="tasks"><h2 id="chapter-114" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-s-the-result-of-or" name="what-s-the-result-of-or" class="main__anchor">What's the result of OR?</a></h3>
<a href="http://javascript.info/task/alert-null-2-undefined" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What the code below is going to output?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( null || 2 || undefined );</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer is <code>2</code>, that's the first truthy value.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( null || 2 || undefined );</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-s-the-result-of-or-ed-alerts" name="what-s-the-result-of-or-ed-alerts" class="main__anchor">What's the result of OR'ed alerts?</a></h3>
<a href="http://javascript.info/task/alert-or" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>What the code below will output?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( alert(1) || 2 || alert(3) );</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: first <code>1</code>, then <code>2</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( alert(1) || 2 || alert(3) );</code></pre>
        </div>
      </div>
      
      </div><p>The call to <code>alert</code> does not return a value. Or, in other words, it returns <code>undefined</code>.</p>
<ol>
<li>The first OR <code>||</code> evaluates it's left operand <code>alert(1)</code>. That shows the first message with <code>1</code>.</li>
<li>The <code>alert</code> returns <code>undefined</code>, so OR goes on to the second operand searching for a truthy value.</li>
<li>The second operand <code>2</code> is truthy, so the execution is halted, <code>2</code> is returned and then shown by the outer alert.</li>
</ol>
<p>There will be no <code>3</code>, because the evaluation does not reach <code>alert(3)</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-is-the-result-of-and" name="what-is-the-result-of-and" class="main__anchor">What is the result of AND?</a></h3>
<a href="http://javascript.info/task/alert-1-null-2" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What this code is going to show?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1 &amp;&amp; null &amp;&amp; 2 );</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <code>null</code>, because it's the first falsy value from the list.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1 &amp;&amp; null &amp;&amp; 2 );</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-is-the-result-of-and-ed-alerts" name="what-is-the-result-of-and-ed-alerts" class="main__anchor">What is the result of AND'ed alerts?</a></h3>
<a href="http://javascript.info/task/alert-and" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>What will this code show?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( alert(1) &amp;&amp; alert(2) );</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <code>1</code>, and then <code>undefined</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( alert(1) &amp;&amp; alert(2) );</code></pre>
        </div>
      </div>
      
      </div><p>The call to <code>alert</code> returns <code>undefined</code> (it just shows a message, so there's no meaningful return).</p>
<p>Because of that, <code>&amp;&amp;</code> evaluates the left operand (outputs <code>1</code>), and immediately stops, because <code>undefined</code> is a falsy value. And <code>&amp;&amp;</code> looks for a falsy value and returns it, so it's done.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#the-result-of-or-and-or" name="the-result-of-or-and-or" class="main__anchor">The result of OR AND OR</a></h3>
<a href="http://javascript.info/task/alert-and-or" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What will be the result?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( null || 2 &amp;&amp; 3 || 4 );</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <code>3</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( null || 2 &amp;&amp; 3 || 4 );</code></pre>
        </div>
      </div>
      
      </div><p>The precedence of AND <code>&amp;&amp;</code> is higher than <code>||</code>, so it executes first.</p>
<p>The result of <code>2 &amp;&amp; 3 = 3</code>, so the expression becomes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">null || 3 || 4</code></pre>
        </div>
      </div>
      
      </div><p>Now the result if the first truthy value: <code>3</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#check-the-range-between" name="check-the-range-between" class="main__anchor">Check the range between</a></h3>
<a href="http://javascript.info/task/check-if-in-range" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>Write an “if” condition to check that <code>age</code> is between <code>14</code> and <code>90</code> inclusively.</p>
<p>“Inclusively” means that <code>age</code> can reach the edges <code>14</code> or <code>90</code>.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (age &gt;= 14 &amp;&amp; age &lt;= 90)</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#check-the-range-outside" name="check-the-range-outside" class="main__anchor">Check the range outside</a></h3>
<a href="http://javascript.info/task/check-if-out-range" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>Write an <code>if</code> condition to check that <code>age</code> is NOT between 14 and 90 inclusively.</p>
<p>Create two variants: the first one using NOT <code>!</code>, the second one – without it.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The first variant:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (!(age &gt;= 14 &amp;&amp; age &lt;= 90))</code></pre>
        </div>
      </div>
      
      </div><p>The second variant:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (age &lt; 14 || age &gt; 90)</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#a-question-about-if" name="a-question-about-if" class="main__anchor">A question about "if"</a></h3>
<a href="http://javascript.info/task/if-question" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Which of these <code>alert</code>s are going to execute?</p>
<p>What will be the results of the expressions inside <code>if(...)</code>?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (-1 || 0) alert( 'first' );
if (-1 &amp;&amp; 0) alert( 'second' );
if (null || -1 &amp;&amp; 1) alert( 'third' );</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: the first and the third will execute.</p>
<p>Details:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Runs.
// The result of -1 || 0 = -1, truthy
if (-1 || 0) alert( 'first' );

// Doesn't run
// -1 &amp;&amp; 0 = 0, falsy
if (-1 &amp;&amp; 0) alert( 'second' );

// Executes
// Operator &amp;&amp; has a higher precedence than ||
// so -1 &amp;&amp; 1 executes first, giving us the chain:
// null || -1 &amp;&amp; 1  -&gt;  null || 1  -&gt;  1
if (null || -1 &amp;&amp; 1) alert( 'third' );</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-115"></h6>
<h1 class="main__header-title" id="chapter-116">Loops: while and for</h1>
<p>We often have a need to perform similar actions many times in a row.</p>
<p>For example, when we need to output goods from a list one after another. Or just run the same code for each number from 1 to 10.</p>
<p><em>Loops</em> are a way to repeat the same part of code multiple times.</p>


<h2 id="chapter-117">
The “while” loop</h2>
<p>The <code>while</code> loop has the following syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">while (condition) {
  // code
  // so-called "loop body"
}</code></pre>
        </div>
      </div>
      
      </div><p>While the <code>condition</code> is <code>true</code>, the <code>code</code> from the loop body is executed.</p>
<p>For instance, the loop below outputs <code>i</code> while <code>i &lt; 3</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
while (i &lt; 3) { // shows 0, then 1, then 2
  alert( i );
  i++;
}</code></pre>
        </div>
      </div>
      
      </div><p>A single execution of the loop body is called <em>an iteration</em>. The loop in the example above makes three iterations.</p>
<p>If there were no <code>i++</code> in the example above, the loop would repeat (in theory) forever. In practice, the browser provides ways to stop such loops, and for server-side JavaScript we can kill the process.</p>
<p>Any expression or a variable can be a loop condition, not just a comparison. They are evaluated and converted to boolean by <code>while</code>.</p>
<p>For instance, the shorter way to write <code>while (i != 0)</code> could be <code>while (i)</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 3;
while (i) { // when i becomes 0, the condition becomes falsy, and the loop stops
  alert( i );
  i--;
}</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Brackets are not required for a single-line body</span></div>
            <div class="important__content"><p>If the loop body has a single statement, we can omit the brackets <code>{…}</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 3;
while (i) alert(i--);</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-118">
The “do…while” loop</h2>
<p>The condition check can be moved <em>below</em> the loop body using the <code>do..while</code> syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">do {
  // loop body
} while (condition);</code></pre>
        </div>
      </div>
      
      </div><p>The loop will first execute the body, then check the condition and, while it's truthy, execute it again and again.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
do {
  alert( i );
  i++;
} while (i &lt; 3);</code></pre>
        </div>
      </div>
      
      </div><p>This form of syntax is rarely used except when you want the body of the loop to execute <strong>at least once</strong> regardless of the condition being truthy. Usually, the other form is preferred: <code>while(…) {…}</code>.</p>
<h2 id="chapter-119">
The “for” loop</h2>
<p>The <code>for</code> loop is the most often used one.</p>
<p>It looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (begin; condition; step) {
  // ... loop body ...
}</code></pre>
        </div>
      </div>
      
      </div><p>Let's learn the meaning of these parts by example. The loop below runs <code>alert(i)</code> for <code>i</code> from <code>0</code> up to (but not including) <code>3</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 3; i++) { // shows 0, then 1, then 2
  alert(i);
}</code></pre>
        </div>
      </div>
      
      </div><p>Let's examine the <code>for</code> statement part by part:</p>
<table>
<thead>
<tr>
<th>part</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>begin</td>
<td><code>i = 0</code></td>
<td>Executes once upon entering the loop.</td>
</tr>
<tr>
<td>condition</td>
<td><code>i &lt; 3</code></td>
<td>Checked before every loop iteration, if fails the loop stops.</td>
</tr>
<tr>
<td>step</td>
<td><code>i++</code></td>
<td>Executes after the body on each iteration, but before the condition check.</td>
</tr>
<tr>
<td>body</td>
<td><code>alert(i)</code></td>
<td>Runs again and again while the condition is truthy</td>
</tr>
</tbody>
</table>
<p>The general loop algorithm works like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">Run begin
→ (if condition → run body and run step)
→ (if condition → run body and run step)
→ (if condition → run body and run step)
→ ...</code></pre>
        </div>
      </div>
      
      </div><p>If you are new to loops, then maybe it would help if you go back to the example and reproduce how it runs step-by-step on a piece of paper.</p>
<p>Here's what exactly happens in our case:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// for (let i = 0; i &lt; 3; i++) alert(i)

// run begin
let i = 0
// if condition → run body and run step
if (i &lt; 3) { alert(i); i++ }
// if condition → run body and run step
if (i &lt; 3) { alert(i); i++ }
// if condition → run body and run step
if (i &lt; 3) { alert(i); i++ }
// ...finish, because now i == 3</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Inline variable declaration</span></div>
            <div class="important__content"><p>Here the “counter” variable <code>i</code> is declared right in the loop. That's called an “inline” variable declaration. Such variables are visible only inside the loop.</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:5-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 3; i++) {
  alert(i); // 0, 1, 2
}
alert(i); // error, no such variable</code></pre>
        </div>
      </div>
      
      </div><p>Instead of defining a variable, we can use an existing one:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

for (i = 0; i &lt; 3; i++) { // use an existing variable
  alert(i); // 0, 1, 2
}

alert(i); // 3, visible, because declared outside of the loop</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h3>
Skipping parts</a></h3><p>Any part of <code>for</code> can be skipped.</p>
<p>For example, we can omit <code>begin</code> if we don't need to do anything at the loop start.</p>
<p>Like here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0; // we have i already declared and assigned

for (; i &lt; 3; i++) { // no need for "begin"
  alert( i ); // 0, 1, 2
}</code></pre>
        </div>
      </div>
      
      </div><p>We can also remove the <code>step</code> part:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

for (; i &lt; 3;) {
  alert( i++ );
}</code></pre>
        </div>
      </div>
      
      </div><p>The loop became identical to <code>while (i &lt; 3)</code>.</p>
<p>We can actually remove everything, thus creating an infinite loop:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (;;) {
  // repeats without limits
}</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the two <code>for</code> semicolons <code>;</code> must be present, otherwise it would be a syntax error.</p>
<h2 id="chapter-120">
Breaking the loop</h2>
<p>Normally the loop exits when the condition becomes falsy.</p>
<p>But we can force the exit at any moment. There's a special <code>break</code> directive for that.</p>
<p>For example, the loop below asks the user for a series of numbers, but “breaks” when no number is entered:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sum = 0;

while (true) {

  let value = +prompt("Enter a number", '');

  if (!value) break; // (*)

  sum += value;

}
alert( 'Sum: ' + sum );</code></pre>
        </div>
      </div>
      
      </div><p>The <code>break</code> directive is activated in the line <code>(*)</code> if the user enters an empty line or cancels the input. It stops the loop immediately, passing the control to the first line after the loop. Namely, <code>alert</code>.</p>
<p>The combination “infinite loop + <code>break</code> as needed” is great for situations when the condition must be checked not in the beginning/end of the loop, but in the middle, or even in several places of the body.</p>
<h2 id="chapter-121">
Continue to the next iteration</h2>
<p>The <code>continue</code> directive is a “lighter version” of <code>break</code>. It doesn't stop the whole loop. Instead it stops the current iteration and forces the loop to start a new one (if the condition allows).</p>
<p>We can use it if we're done on the current iteration and would like to move on to the next.</p>
<p>The loop below uses <code>continue</code> to output only odd values:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:2-27">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 10; i++) {

  // if true, skip the remaining part of the body
  if (i % 2 == 0) continue;

  alert(i); // 1, then 3, 5, 7, 9
}</code></pre>
        </div>
      </div>
      
      </div><p>For even values of <code>i</code> the <code>continue</code> directive stops body execution, passing the control to the next iteration of <code>for</code> (with the next number). So the <code>alert</code> is only called for odd values.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The directive <code>continue</code> helps to decrease nesting level</span></div>
            <div class="important__content"><p>A loop that shows odd values could look like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 10; i++) {

  if (i % 2) {
    alert( i );
  }

}</code></pre>
        </div>
      </div>
      
      </div><p>From a technical point of view it's identical to the example above. Surely, we can just wrap the code in the <code>if</code> block instead of <code>continue</code>.</p>
<p>But as a side-effect we got one more figure brackets nesting level. If the code inside <code>if</code> is longer than a few lines, that may decrease the overall readability.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">No <code>break/continue</code> to the right side of ‘?'</span></div>
            <div class="important__content"><p>Please note that syntax constructs that are not expressions cannot be used in <code>'?'</code>. In particular, directives <code>break/continue</code> are disallowed there.</p>
<p>For example, if we take this code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (i &gt; 5) {
  alert(i);
} else {
  continue;
}</code></pre>
        </div>
      </div>
      
      </div><p>…And rewrite it using a question mark:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:21-29">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">(i &gt; 5) ? alert(i) : continue; // continue not allowed here</code></pre>
        </div>
      </div>
      
      </div><p>…Then it stops working. The code like this will give a syntax error:</p>
<p>That's just another reason not to use a question mark operator <code>'?'</code> instead of <code>if</code>.</p>
</div></div>
<h2 id="chapter-122">
Labels for break/continue</h2>
<p>Sometimes we need to break out from multiple nested loops at once.</p>
<p>For example, in the code below we loop over <code>i</code> and <code>j</code> prompting for coordinates <code>(i, j)</code> from <code>(0,0)</code> to <code>(3,3)</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 3; i++) {

  for (let j = 0; j &lt; 3; j++) {

    let input = prompt(`Value at coords (${i},${j})`, '');

    // what if I want to exit from here to Done (below)?

  }
}

alert('Done!');</code></pre>
        </div>
      </div>
      
      </div><p>We need a way to stop the process if the user cancels the input.</p>
<p>The ordinary <code>break</code> after <code>input</code> would only break the inner loop. That's not sufficient. Labels come to the rescue.</p>
<p>A <em>label</em> is an identifier with a colon before a loop:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">labelName: for (...) {
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>The <code>break &lt;labelName&gt;</code> statement in the loop breaks out to the label.</p>
<p>Like here:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:0-6,7:16-27">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">outer: for (let i = 0; i &lt; 3; i++) {

  for (let j = 0; j &lt; 3; j++) {

    let input = prompt(`Value at coords (${i},${j})`, '');

    // if an empty string or canceled, then break out of both loops
    if (!input) break outer; // (*)

    // do something with the value...
  }
}
alert('Done!');</code></pre>
        </div>
      </div>
      
      </div><p>In the code above <code>break outer</code> looks upwards for the label named <code>outer</code> and breaks out of that loop.</p>
<p>So the control goes straight from <code>(*)</code> to <code>alert('Done!')</code>.</p>
<p>We can also move the label onto a separate line:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">outer:
for (let i = 0; i &lt; 3; i++) { ... }</code></pre>
        </div>
      </div>
      
      </div><p>The <code>continue</code> directive can also be used with a label. In this case the execution jumps to the next iteration of the labeled loop.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Labels are not a “goto”</span></div>
            <div class="important__content"><p>Labels do not allow us to jump into an arbitrary place of code.</p>
<p>For example, it is impossible to do this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">break label;  // jumps to label? No.

label: for (...)</code></pre>
        </div>
      </div>
      
      </div><p>The call to a <code>break/continue</code> is only possible from inside the loop, and the label must be somewhere upwards from the directive.</p>
</div></div>
<h2 id="chapter-123">
Summary</h2>
<p>We covered 3 types of loops:</p>
<ul>
<li><code>while</code> – The condition is checked before each iteration.</li>
<li><code>do..while</code> – The condition is checked after each iteration.</li>
<li><code>for (;;)</code> – The condition is checked before each iteration, additional settings available.</li>
</ul>
<p>To make an “infinite” loop, usually the <code>while(true)</code> construct is used. Such a loop, just like any other, can be stopped with the <code>break</code> directive.</p>
<p>If we don't want to do anything on the current iteration and would like to forward to the next one, the <code>continue</code> directive does it.</p>
<p><code>Break/continue</code> support labels before the loop. A label is the only way for <code>break/continue</code> to escape the nesting and go to the outer loop.</p>
<div class="tasks"><h2 id="chapter-124" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#last-loop-value" name="last-loop-value" class="main__anchor">Last loop value</a></h3>
<a href="http://javascript.info/task/loop-last-value" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>What is the last value alerted by this code? Why?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 3;

while (i) {
  alert( i-- );
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <code>1</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 3;

while (i) {
  alert( i-- );
}</code></pre>
        </div>
      </div>
      
      </div><p>Every loop iteration decreases <code>i</code> by <code>1</code>. The check <code>while(i)</code> stops the loop when <code>i = 0</code>.</p>
<p>Hence, the steps of the loop form the following sequence (“loop unrolled”):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 3;

alert(i--); // shows 3, decreases i to 2

alert(i--) // shows 2, decreases i to 1

alert(i--) // shows 1, decreases i to 0

// done, while(i) check stops the loop</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#which-values-shows-the-while" name="which-values-shows-the-while" class="main__anchor">Which values shows the while?</a></h3>
<a href="http://javascript.info/task/which-value-while" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>For every loop, write down which values it shows, in your opinion. And then compare with the answer.</p>
<p>Both loops <code>alert</code> same values or not?</p>
<ol>
<li>
<p>The prefix form <code>++i</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
while (++i &lt; 5) alert( i );</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>The postfix form <code>i++</code></p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
while (i++ &lt; 5) alert( i );</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The task demonstrates how postfix/prefix forms can lead to different results when used in comparisons.</p>
<ol>
<li>
<p><strong>From 1 to 4</strong></p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
while (++i &lt; 5) alert( i );</code></pre>
        </div>
      </div>
      
      </div><p>The first value is <code>i=1</code>, because <code>++i</code> first increments <code>i</code> and then returns the new value. So the first comparison is <code>1 &lt; 5</code> and the <code>alert</code> shows <code>1</code>.</p>
<p>Then follow <code>2,3,4…</code> – the values show up one after another. The comparison always uses the incremented value, because <code>++</code> is before the variable.</p>
<p>Finally, <code>i=4</code> is incremented to <code>5</code>, the comparison <code>while(5 &lt; 5)</code> fails, and the loop stops. So <code>5</code> is not shown.</p>
</li>
<li>
<p><strong>From 1 to 5</strong></p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
while (i++ &lt; 5) alert( i );</code></pre>
        </div>
      </div>
      
      </div><p>The first value is again <code>i=1</code>. The postfix form of <code>i++</code> increments <code>i</code> and then returns the <em>old</em> value, so the comparison <code>i++ &lt; 5</code> will use <code>i=0</code> (contrary to <code>++i &lt; 5</code>).</p>
<p>But the <code>alert</code> call is separate. It's another statement which executes after the increment and the comparison. So it gets the current <code>i=1</code>.</p>
<p>Then follow <code>2,3,4…</code></p>
<p>Let's stop on <code>i=4</code>. The prefix form <code>++i</code> would increment it and use <code>5</code> in the comparison. But here we have the postfix form <code>i++</code>. So it increments <code>i</code> to <code>5</code>, but returns the old value. Hence the comparison is actually <code>while(4 &lt; 5)</code> – true, and the control goes on to <code>alert</code>.</p>
<p>The value <code>i=5</code> is the last one, because on the next step <code>while(5 &lt; 5)</code> is false.</p>
</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#which-values-get-shown-by-the-for-loop" name="which-values-get-shown-by-the-for-loop" class="main__anchor">Which values get shown by the "for" loop?</a></h3>
<a href="http://javascript.info/task/which-value-for" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>For each loop write down which values it is going to show. Then compare with the answer.</p>
<p>Both loops <code>alert</code> same values or not?</p>
<ol>
<li>
<p>The postfix form:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 5; i++) alert( i );</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>The prefix form:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 5; ++i) alert( i );</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p><strong>The answer: from <code>0</code> to <code>4</code> in both cases.</strong></p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 5; ++i) alert( i );

for (let i = 0; i &lt; 5; i++) alert( i );</code></pre>
        </div>
      </div>
      
      </div><p>That can be easily deducted from the algorithm of <code>for</code>:</p>
<ol>
<li>Execute once <code>i = 0</code> before everything (begin).</li>
<li>Check the condition <code>i &lt; 5</code></li>
<li>If <code>true</code> – execute the loop body <code>alert(i)</code>, and then <code>i++</code></li>
</ol>
<p>The increment <code>i++</code> is separated from the condition check (2). That's just another statement.</p>
<p>The value returned by the increment is not used here, so there's no difference between <code>i++</code> and <code>++i</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#output-even-numbers-in-the-loop" name="output-even-numbers-in-the-loop" class="main__anchor">Output even numbers in the loop</a></h3>
<a href="http://javascript.info/task/for-even" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Use the <code>for</code> loop to output even numbers from <code>2</code> to <code>10</code>.</p>
<p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 2; i &lt;= 10; i++) {
  if (i % 2 == 0) {
    alert( i );
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>We use the “modulo” operator <code>%</code> to get the remainder and check for the evenness here.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#replace-for-with-while" name="replace-for-with-while" class="main__anchor">Replace "for" with "while"</a></h3>
<a href="http://javascript.info/task/replace-for-while" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Rewrite the code changing the <code>for</code> loop to <code>while</code> without altering its behavior (the output should stay same).</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 3; i++) {
  alert( `number ${i}!` );
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
while (i &lt; 3) {
  alert( `number ${i}!` );
  i++;
}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#repeat-until-the-input-is-correct" name="repeat-until-the-input-is-correct" class="main__anchor">Repeat until the input is correct</a></h3>
<a href="http://javascript.info/task/repeat-until-correct" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a loop which prompts for a number greater than <code>100</code>. If the visitor enters another number – ask him to input again.</p>
<p>The loop must ask for a number until either the visitor enters a number greater than <code>100</code> or cancels the input/enters an empty line.</p>
<p>Here we can assume that the visitor only inputs numbers. There's no need to implement a special handling for a non-numeric input in this task.</p>
<p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num;

do {
  num = prompt("Enter a number greater than 100?", 0);
} while (num &lt;= 100 &amp;&amp; num);</code></pre>
        </div>
      </div>
      
      </div><p>The loop <code>do..while</code> repeats while both checks are truthy:</p>
<ol>
<li>The check for <code>num &lt;= 100</code> – that is, the entered value is still not greater than <code>100</code>.</li>
<li>The check <code>&amp;&amp; num</code> is false when <code>num</code> is <code>null</code> or a empty strig. Then the <code>while</code> loop stops too.</li>
</ol>
<p>P.S. If <code>num</code> is <code>null</code> then <code>num &lt;= 100</code> is <code>true</code>, so without the 2nd check the loop wouldn't stop if the user clicks CANCEL. Both checks are required.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#output-prime-numbers" name="output-prime-numbers" class="main__anchor">Output prime numbers</a></h3>
<a href="http://javascript.info/task/list-primes" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>An integer number greater than <code>1</code> is called a 
<a href="https://en.wikipedia.org/wiki/Prime_number">prime</a> if it cannot be divided without a remainder by anything except <code>1</code> and itself.</p>
<p>In other words, <code>n &gt; 1</code> is a prime if it can't be evenly divided by anything except <code>1</code> and <code>n</code>.</p>
<p>For example, <code>5</code> is a prime, because it cannot be divided without a remainder by <code>2</code>, <code>3</code> and <code>4</code>.</p>
<p><strong>Write the code which outputs prime numbers in the interval from <code>2</code> to <code>n</code>.</strong></p>
<p>For <code>n = 10</code> the result will be <code>2,3,5,7</code>.</p>
<p>P.S. The code should work for any <code>n</code>, not be hard-tuned for any fixed value.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>There are many algorithms for this task.</p>
<p>Let's use a nested loop:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">For each i in the interval {
  check if i has a divisor from 1..i
  if yes =&gt; the value is not a prime
  if no =&gt; the value is a prime, show it
}</code></pre>
        </div>
      </div>
      
      </div><p>The code using a label:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let n = 10;

nextPrime:
for (let i = 2; i &lt;= n; i++) { // for each i...

  for (let j = 2; j &lt; i; j++) { // look for a divisor..
    if (i % j == 0) continue nextPrime; // not a prime, go next i
  }

  alert( i ); // a prime
}</code></pre>
        </div>
      </div>
      
      </div><p>There's a lot of space to opimize it. For instance, we could look for the divisors from <code>2</code> to square root of <code>i</code>. But anyway, if we want to be really efficient for large intervals, we need change the approach and rely on advanced maths and complex algorithms like 
<a href="https://en.wikipedia.org/wiki/Quadratic_sieve">Quadratic sieve</a>, 
<a href="https://en.wikipedia.org/wiki/General_number_field_sieve">General number field sieve</a> etc.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-125"></h6>
<h1 class="main__header-title" id="chapter-126">The "switch" statement</h1>
<p>A <code>switch</code> statement can replace multiple <code>if</code> checks.</p>
<p>It gives a more descriptive way to compare a value with multiple variants.</p>


<h2 id="chapter-127">
The syntax</h2>
<p>The <code>switch</code> has one or more <code>case</code> blocks and an optional default.</p>
<p>It looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">switch(x) {
  case 'value1':  // if (x === 'value1')
    ...
    [break]

  case 'value2':  // if (x === 'value2')
    ...
    [break]

  default:
    ...
    [break]
}</code></pre>
        </div>
      </div>
      
      </div><ul>
<li>The value of <code>x</code> is checked for a strict equality to the value from the first <code>case</code> (that is, <code>value1</code>) then to the second (<code>value2</code>) and so on.</li>
<li>If the equality is found, <code>switch</code> starts to execute the code starting from the corresponding <code>case</code>, until the nearest <code>break</code> (or until the end of <code>switch</code>).</li>
<li>If no case is matched then the <code>default</code> code is executed (if it exists).</li>
</ul>
<h2 id="chapter-128">
An example</h2>
<p>An example of <code>switch</code> (the executed code is highlighted):</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 2 + 2;

switch (a) {
  case 3:
    alert( 'Too small' );
    break;
  case 4:
    alert( 'Exactly!' );
    break;
  case 5:
    alert( 'Too large' );
    break;
  default:
    alert( "I don't know such values" );
}</code></pre>
        </div>
      </div>
      
      </div><p>Here the <code>switch</code> starts to compare <code>a</code> from the first <code>case</code> variant that is <code>3</code>. The match fails.</p>
<p>Then <code>4</code>. That's a match, so the execution starts from <code>case 4</code> until the nearest <code>break</code>.</p>
<p><strong>If there is no <code>break</code> then the execution continues with the next <code>case</code> without any checks.</strong></p>
<p>An example without <code>break</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 2 + 2;

switch (a) {
  case 3:
    alert( 'Too small' );
  case 4:
    alert( 'Exactly!' );
  case 5:
    alert( 'Too big' );
  default:
    alert( "I don't know such values" );
}</code></pre>
        </div>
      </div>
      
      </div><p>In the example above we'll see sequential execution of three <code>alert</code>s:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'Exactly!' );
alert( 'Too big' );
alert( "I don't know such values" );</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Any expression can be a <code>switch/case</code> argument</span></div>
            <div class="important__content"><p>Both <code>switch</code> and <code>case</code> allow arbitrary expressions.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = "1";
let b = 0;

switch (+a) {
  case b + 1:
    alert("this runs, because +a is 1, exactly equals b+1");
    break;

  default:
    alert("this doesn't run");
}</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>+a</code> gives <code>1</code>, that's compared with <code>b + 1</code> in <code>case</code>, and the corresponding code is executed.</p>
</div></div>
<h2 id="chapter-129">
Grouping of “case”</h2>
<p>Several variants of <code>case</code> which share the same code can be grouped.</p>
<p>For example, if we want the same code to run for <code>case 3</code> and <code>case 5</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-11">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 2 + 2;

switch (a) {
  case 4:
    alert('Right!');
    break;

  case 3:                    // (*) grouped two cases
  case 5:
    alert('Wrong!');
    alert("Why don't you take a math class?");
    break;

  default:
    alert('The result is strange. Really.');
}</code></pre>
        </div>
      </div>
      
      </div><p>Now both <code>3</code> and <code>5</code> show the same message.</p>
<p>The ability to “group” cases is a side-effect of how <code>switch/case</code> works without <code>break</code>. Here the execution of <code>case 3</code> starts from the line <code>(*)</code> and goes through <code>case 5</code>, because there's no <code>break</code>.</p>
<h2 id="chapter-130">
Type matters</h2>
<p>Let's emphasize that the equality check is always strict. The values must be of the same type to match.</p>
<p>For example, let's consider the code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arg = prompt("Enter a value?")
switch (arg) {
  case '0':
  case '1':
    alert( 'One or zero' );
    break;

  case '2':
    alert( 'Two' );
    break;

  case 3:
    alert( 'Never executes!' );
    break;
  default:
    alert( 'An unknown value' )
}</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>For <code>0</code>, <code>1</code>, the first <code>alert</code> runs.</li>
<li>For <code>2</code> the second <code>alert</code> runs.</li>
<li>But for <code>3</code>, the result of the <code>prompt</code> is a string <code>"3"</code>, which is not strictly equal <code>===</code> to the number <code>3</code>. So we've got a dead code in <code>case 3</code>! The <code>default</code> variant will execute.</li>
</ol>
<div class="tasks"><h2 id="chapter-131" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-the-switch-into-an-if" name="rewrite-the-switch-into-an-if" class="main__anchor">Rewrite the "switch" into an "if"</a></h3>
<a href="http://javascript.info/task/rewrite-switch-if-else" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write the code using <code>if..else</code> which would correspond to the following <code>switch</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">switch (browser) {
  case 'Edge':
    alert( "You've got the Edge!" );
    break;

  case 'Chrome':
  case 'Firefox':
  case 'Safari':
  case 'Opera':
    alert( 'Okay we support these browsers too' );
    break;

  default:
    alert( 'We hope that this page looks ok!' );
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To precisely match the functionality of <code>switch</code>, the <code>if</code> must use a strict comparison <code>'==='</code>.</p>
<p>For given strings though, a simple <code>'=='</code> works too.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if(browser == 'Edge') {
  alert("You've got the Edge!");
} else if (browser == 'Chrome'
 || browser == 'Firefox'
 || browser == 'Safari'
 || browser == 'Opera') {
  alert( 'Okay we support these browsers too' );
} else {
  alert( 'We hope that this page looks ok!' );
}</code></pre>
        </div>
      </div>
      
      </div><p>Please note: the construct <code>browser == 'Chrome' || browser == 'Firefox' …</code> is split into multiple lines for better readability.</p>
<p>But the <code>switch</code> construct is still cleaner and more descriptive.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-if-into-switch" name="rewrite-if-into-switch" class="main__anchor">Rewrite "if" into "switch"</a></h3>
<a href="http://javascript.info/task/rewrite-if-switch" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Rewrite the code below using a single <code>switch</code> statement:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = +prompt('a?', '');

if (a == 0) {
  alert( 0 );
}
if (a == 1) {
  alert( 1 );
}

if (a == 2 || a == 3) {
  alert( '2,3' );
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The first two checks turn into two <code>case</code>. The third check is split into two cases:</p>
<div data-trusted="1" class="code-example" data-highlight-block="14-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = +prompt('a?', '');

switch (a) {
  case 0:
    alert( 0 );
    break;

  case 1:
    alert( 1 );
    break;

  case 2:
  case 3:
    alert( '2,3' );
    break;
}</code></pre>
        </div>
      </div>
      
      </div><p>Please note: the <code>break</code> at the bottom is not required. But we put it to make the code future-proof.</p>
<p>In the future, there is a chance that we'd want to add one more <code>case</code>, for example <code>case 4</code>. And if we forget to add a break before it, at the end of <code>case 3</code>, there will be an error. So that's a kind of self-insurance.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-132"></h6>
<h1 class="main__header-title" id="chapter-133">Functions</h1>
<p>Quite often we need to perform a similar action in many places of the script.</p>
<p>For example, we need to show a nice-looking message when a visitor logs in, logs out and maybe somewhere else.</p>
<p>Functions are the main “building blocks” of the program. They allow the code to be called many times without repetition.</p>


<p>We've already seen examples of built-in functions, like <code>alert(message)</code>, <code>prompt(message, default)</code> and <code>confirm(question)</code>. But we can create functions of our own as well.</p>
<h2 id="chapter-134">
Function Declaration</h2>
<p>To create a function we can use a <em>function declaration</em>.</p>
<p>It looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage() {
  alert( 'Hello everyone!' );
}</code></pre>
        </div>
      </div>
      
      </div><p>The <code>function</code> keyword goes first, then goes the <em>name of the function</em>, then a list of <em>parameters</em> in the brackets (empty in the example above) and finally the code of the function, also named “the function body”.</p>
      <img src="http://javascript.info/article/function-basics/function_basics.png">
<p>Our new function can be called by its name: <code>showMessage()</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage() {
  alert( 'Hello everyone!' );
}

showMessage();
showMessage();</code></pre>
        </div>
      </div>
      
      </div><p>The call <code>showMessage()</code> executes the code of the function. Here we will see the message two times.</p>
<p>This example clearly demonstrates one of the main purposes of functions: to evade code duplication.</p>
<p>If we ever need to change the message or the way it is shown, it's enough to modify the code in one place: the function which outputs it.</p>
<h2 id="chapter-135">
Local variables</h2>
<p>A variable declared inside a function is only visible inside that function.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage() {
  let message = "Hello, I'm JavaScript!"; // local variable

  alert( message );
}

showMessage(); // Hello, I'm JavaScript!

alert( message ); // &lt;-- Error! The variable is local to the function</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-136">
Outer variables</h2>
<p>A function can access an outer variable as well, for example:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:4-12,3:28-36">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let userName = 'John';

function showMessage() {
  let message = 'Hello, ' + userName;
  alert(message);
}

showMessage(); // Hello, John</code></pre>
        </div>
      </div>
      
      </div><p>The function has full access to the outer variable. It can modify it as well.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:4-12,3:2-10,5:28-36,9:22-26,13:22-25">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let userName = 'John';

function showMessage() {
  userName = "Bob"; // (1) changed the outer variable

  let message = 'Hello, ' + userName;
  alert(message);
}

alert( userName ); // John before the function call

showMessage();

alert( userName ); // Bob, the value was modified by the function</code></pre>
        </div>
      </div>
      
      </div><p>The outer variable is only used if there's no local one. So an occasional modification may happen if we forget <code>let</code>.</p>
<p>If a same-named variable is declared inside the function then it <em>shadows</em> the outer one. For instance, in the code below the function uses the local <code>userName</code>. The outer one is ignored:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3" data-highlight-inline="5:41-44,12:22-26">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let userName = 'John';

function showMessage() {
  let userName = "Bob"; // declare a local variable

  let message = 'Hello, ' + userName; // Bob
  alert(message);
}

// the function will create and use it's own userName
showMessage();

alert( userName ); // John, unchanged, the function did not access the outer variable</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Global variables</span></div>
            <div class="important__content"><p>Variables declared outside of any function, such as the outer <code>userName</code> in the code above, are called <em>global</em>.</p>
<p>Global variables are visible from any function (unless shadowed by locals).</p>
<p>Usually, a function declares all variables specific to its task, and global variables only store project-level data, so important that it really must be seen from anywhere. Modern code has few or no globals. Most variables reside in their functions.</p>
</div></div>
<h2 id="chapter-137">
Parameters</h2>
<p>We can pass arbitrary data to functions using parameters (also called <em>function arguments</em>) .</p>
<p>In the example below, the function has two parameters: <code>from</code> and <code>text</code>.</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5" data-highlight-inline="0:21-31">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage(from, text) { // arguments: from, text
  alert(from + ': ' + text);
}

showMessage('Ann', 'Hello!'); // Ann: Hello! (*)
showMessage('Ann', "What's up?"); // Ann: What's up? (**)</code></pre>
        </div>
      </div>
      
      </div><p>When the function is called in lines <code>(*)</code> and <code>(**)</code>, the given values are copied to local variables <code>from</code> and <code>text</code>. Then the function uses them.</p>
<p>Here's one more example: we have a variable <code>from</code> and pass it to the function. Please note: the function changes <code>from</code>, but the change is not seen outside, because a function always gets a copy of the value:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage(from, text) {

  from = '*' + from + '*'; // make "from" look nicer

  alert( from + ': ' + text );
}

let from = "Ann";

showMessage(from, "Hello"); // *Ann*: Hello

// the value of "from" is the same, the function modified a local copy
alert( from ); // Ann</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-138">
Default values</h2>
<p>If a parameter is not provided, then its value becomes <code>undefined</code>.</p>
<p>For instance, the aforementioned function <code>showMessage(from, text)</code> can be called with a single argument:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">showMessage("Ann");</code></pre>
        </div>
      </div>
      
      </div><p>That's not an error. Such a call would output <code>"Ann: undefined"</code>. There's no <code>text</code>, so it's assumed that <code>text === undefined</code>.</p>
<p>If we want to use a “default” <code>text</code> in this case, then we can specify it after <code>=</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:27-49">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage(from, text = "no text given") {
  alert( from + ": " + text );
}

showMessage("Ann"); // Ann: no text given</code></pre>
        </div>
      </div>
      
      </div><p>Now if the <code>text</code> parameter is not passed, it will get the value <code>"no text given"</code></p>
<p>Here <code>"no text given"</code> is a string, but it can be a more complex expression, which is only evaluated and assigned if the parameter is missing. So, this is also possible:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage(from, text = anotherFunction()) {
  // anotherFunction() only executed if no text given
  // its result becomes the value of text
}</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Default parameters old-style</span></div>
            <div class="important__content"><p>Old editions of JavaScript did not support default parameters. So there are alternative ways to support them, that you can find mostly in the old scripts.</p>
<p>For instance, an explicit check for being <code>undefined</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-3">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage(from, text) {
  if (text === undefined) {
    text = 'no text given';
  }

  alert( from + ": " + text );
}</code></pre>
        </div>
      </div>
      
      </div><p>…Or the <code>||</code> operator:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMessage(from, text) {
  // if text is falsy then text gets the "default" value
  text = text || 'no text given';
  ...
}</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-139">
Returning a value</h2>
<p>A function can return a value back into the calling code as the result.</p>
<p>The simplest example would be a function that sums two values:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:2-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sum(a, b) {
  return a + b;
}

let result = sum(1, 2);
alert( result ); // 3</code></pre>
        </div>
      </div>
      
      </div><p>The directive <code>return</code> can be in any place of the function. When the execution reaches it, the function stops, and the value is returned to the calling code (assigned to <code>result</code> above).</p>
<p>There may be many occurrences of <code>return</code> in a single function. For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2,4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function checkAge(age) {
  if (age &gt; 18) {
    return true;
  } else {
    return confirm('Got a permission from the parents?');
  }
}

let age = prompt('How old are you?', 18);

if ( checkAge(age) ) {
  alert( 'Access granted' );
} else {
  alert( 'Access denied' );
}</code></pre>
        </div>
      </div>
      
      </div><p>It is possible to use <code>return</code> without a value. That causes the function to exit immediately.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMovie(age) {
  if ( !checkAge(age) ) {
    return;
  }

  alert( "Showing you the movie" ); // (*)
  // ...
}</code></pre>
        </div>
      </div>
      
      </div><p>In the code above, if <code>checkAge(age)</code> returns <code>false</code>, then <code>showMovie</code> won't proceed to the <code>alert</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">A function with an empty <code>return</code> or without it returns <code>undefined</code></span></div>
            <div class="important__content"><p>If a function does not return a value, it is the same as if it returns <code>undefined</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function doNothing() { /* empty */ }

alert( doNothing() === undefined ); // true</code></pre>
        </div>
      </div>
      
      </div><p>An empty <code>return</code> is also the same as <code>return undefined</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function doNothing() {
  return;
}

alert( doNothing() === undefined ); // true</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Never add a newline between <code>return</code> and the value</span></div>
            <div class="important__content"><p>For a long expression in <code>return</code>, it might be tempting to put it on a separate line, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">return
 (some + long + expression + or + whatever * f(a) + f(b))</code></pre>
        </div>
      </div>
      
      </div><p>That doesn't work, because JavaScript assumes a semicolon after <code>return</code>. That'll work the same as:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:6-7">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">return;
 (some + long + expression + or + whatever * f(a) + f(b))</code></pre>
        </div>
      </div>
      
      </div><p>So, it effectively becomes an empty return. We should put the value on the same line instead.</p>
</div></div>
<h2 id="chapter-140">
Naming a function</h2>
<p>Functions are actions. So their name is usually a verb. It should briefly, but as accurately as possible describe what the function does. So that a person who reads the code gets the right clue.</p>
<p>It is a widespread practice to start a function with a verbal prefix which vaguely describes the action. There must be an agreement within the team on the meaning of the prefixes.</p>
<p>For instance, functions that start with <code>"show"</code> usually show something.</p>
<p>Function starting with…</p>
<ul>
<li><code>"get…"</code> – return a value,</li>
<li><code>"calc…"</code> – calculate something,</li>
<li><code>"create…"</code> – create something,</li>
<li><code>"check…"</code> – check something and return a boolean, etc.</li>
</ul>
<p>Examples of such names:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">showMessage(..)     // shows a message
getAge(..)          // returns the age (gets it somehow)
calcSum(..)         // calculates a sum and returns the result
createForm(..)      // creates a form (and usually returns it)
checkPermission(..) // checks a permission, returns true/false</code></pre>
        </div>
      </div>
      
      </div><p>With prefixes in place, a glance at a function name gives an understanding what kind of work it does and what kind of value it returns.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">One function – one action</span></div>
            <div class="important__content"><p>A function should do exactly what is suggested by its name, no more.</p>
<p>Two independent actions usually deserve two functions, even if they are usually called together (in that case we can make a 3rd function that calls those two).</p>
<p>A few examples of breaking this rule:</p>
<ul>
<li><code>getAge</code> – would be bad if it shows an <code>alert</code> with the age (should only get).</li>
<li><code>createForm</code> – would be bad if it modifies the document, adding a form to it (should only create it and return).</li>
<li><code>checkPermission</code> – would be bad if displays the <code>access granted/denied</code> message (should only perform the check and return the result).</li>
</ul>
<p>These examples assume common meanings of prefixes. What they mean for you is determined by you and your team. Maybe it's pretty normal for your code to behave differently. But you should have a firm understanding of what a prefix means, what a prefixed function can and cannot do. All same-prefixed functions should obey the rules. And the team should share the knowledge.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Ultrashort function names</span></div>
            <div class="important__content"><p>Functions that are used <em>very often</em> sometimes have ultrashort names.</p>
<p>For example, 
<a href="http://jquery.com">jQuery</a> framework defines a function <code>$</code>, 
<a href="http://lodash.com/">LoDash</a> library has it's core function named <code>_</code>.</p>
<p>These are exceptions. Generally functions names should be concise, but descriptive.</p>
</div></div>
<h2 id="chapter-141">
Functions == Comments</h2>
<p>Functions should be short and do exactly one thing. If that thing is big, maybe it's worth it to split the function into a few smaller functions. Sometimes following this rule may not be that easy, but it's definitely a good thing.</p>
<p>A separate function is not only easier to test and debug – its very existence is a great comment!</p>
<p>For instance, compare the two functions <code>showPrimes(n)</code> below. Each one outputs 
<a href="https://en.wikipedia.org/wiki/Prime_number">prime numbers</a> up to <code>n</code>.</p>
<p>The first variant uses a label:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showPrimes(n) {
  nextPrime: for (let i = 2; i &lt; n; i++) {

    for (let j = 2; j &lt; i; j++) {
      if (i % j == 0) continue nextPrime;
    }

    alert( i ); // a prime
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>The second variant uses an additional function <code>isPrime(n)</code> to test for primality:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:4-30">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showPrimes(n) {

  for (let i = 2; i &lt; n; i++) {
    if (!isPrime(i)) continue;

    alert(i);  // a prime
  }
}

function isPrime(n) {
  for (let i = 2; i &lt; n; i++) {
    if ( n % i == 0) return false;
  }
  return true;
}</code></pre>
        </div>
      </div>
      
      </div><p>The second variant is easier to understand isn't it? Instead of the code piece we see a name of the action (<code>isPrime</code>). Sometimes people refer to such code as <em>self-describing</em>.</p>
<p>So, functions can be created even if we don't intend to reuse them. They structure the code and make it readable.</p>
<h2 id="chapter-142">
Summary</h2>
<p>A function declaration looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function name(parameters, delimited, by, comma) {
  /* code */
}</code></pre>
        </div>
      </div>
      
      </div><ul>
<li>Values passed to a function as parameters are copied to its local variables.</li>
<li>A function may access outer variables. But it works only from inside out. The code outside of the function doesn't see its local variables.</li>
<li>A function can return a value. If it doesn't then its result is <code>undefined</code>.</li>
</ul>
<p>To make the code clean and easy to understand, it's recommended to use mainly local variables and parameters in the function, not outer variables.</p>
<p>It is always easier to understand a function which gets parameters, works with them and returns a result than a function which gets no parameters, but modifies outer variables as a side-effect.</p>
<p>Function naming:</p>
<ul>
<li>A name should clearly describe what the function does. When we see a function call in the code, a good name instantly gives us an understanding what it does and returns.</li>
<li>A function is an action, so function names are usually verbal.</li>
<li>There exist many well-known function prefixes like <code>create…</code>, <code>show…</code>, <code>get…</code>, <code>check…</code> and so on. Use them to hint what a function does.</li>
</ul>
<p>Functions are the main building blocks of scripts. Now we've covered the basics, so we actually can start creating and using them. But that's only the beginning of the path. We are going to return to them many times, going more deeply into their advanced features.</p>
<div class="tasks"><h2 id="chapter-143" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#is-else-required" name="is-else-required" class="main__anchor">Is "else" required?</a></h3>
<a href="http://javascript.info/task/if-else-required" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>The following function returns <code>true</code> if the parameter <code>age</code> is greater than <code>18</code>.</p>
<p>Otherwise it asks for a confirmation and returns its result:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function checkAge(age) {
  if (age &gt; 18) {
    return true;
  } else {
    // ...
    return confirm('Did parents allow you?');
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>Will the function work differently if <code>else</code> is removed?</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function checkAge(age) {
  if (age &gt; 18) {
    return true;
  }
  // ...
  return confirm('Did parents allow you?');
}</code></pre>
        </div>
      </div>
      
      </div><p>Is there any difference in the behavior of these two variants?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>No difference.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-the-function-using-or" name="rewrite-the-function-using-or" class="main__anchor">Rewrite the function using '?' or '||'</a></h3>
<a href="http://javascript.info/task/rewrite-function-question-or" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>The following function returns <code>true</code> if the parameter <code>age</code> is greater than <code>18</code>.</p>
<p>Otherwise it asks for a confirmation and returns its result.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function checkAge(age) {
  if (age &gt; 18) {
    return true;
  } else {
    return confirm('Do you have your parents permission to access this page?');
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>Rewrite it, to perform the same, but without <code>if</code>, in a single line.</p>
<p>Make two variants of <code>checkAge</code>:</p>
<ol>
<li>Using a question mark operator <code>'?'</code></li>
<li>Using OR <code>||</code></li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Using a question mark operator <code>'?'</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function checkAge(age) {
  return (age &gt; 18) ? true : confirm('Did parents allow you?');
}</code></pre>
        </div>
      </div>
      
      </div><p>Using OR <code>||</code> (the shortest variant):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function checkAge(age) {
  return (age &gt; 18) || confirm('Did parents allow you?');
}</code></pre>
        </div>
      </div>
      
      </div><p>Note that the parentheses around <code>age &gt; 18</code> are not required here. They exist for better readabilty.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#function-min-a-b" name="function-min-a-b" class="main__anchor">Function min(a, b)</a></h3>
<a href="http://javascript.info/task/min" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 1</span></div><div class="task__content"><p>Write a function <code>min(a,b)</code> which returns the least of two numbers <code>a</code> and <code>b</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">min(2, 5) == 2
min(3, -1) == -1
min(1, 1) == 1</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>A solution using <code>if</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function min(a, b) {
  if (a &lt; b) {
    return a;
  } else {
    return b;
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>A solution with a question mark operator <code>'?'</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function min(a, b) {
  return a &lt; b ? a : b;
}</code></pre>
        </div>
      </div>
      
      </div><p>P.S. In the case of an equality <code>a == b</code> it does not matter what to return.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#function-pow-x-n" name="function-pow-x-n" class="main__anchor">Function pow(x,n)</a></h3>
<a href="http://javascript.info/task/pow" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write a function <code>pow(x,n)</code> that returns <code>x</code> in power <code>n</code>. Or, in other words, multiplies <code>x</code> by itself <code>n</code> times and returns the result.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">pow(3, 2) = 3 * 3 = 9
pow(3, 3) = 3 * 3 * 3 = 27
pow(1, 100) = 1 * 1 * ...*1 = 1</code></pre>
        </div>
      </div>
      
      </div><p>Create a web-page that prompts for <code>x</code> and <code>n</code>, and then shows the result of <code>pow(x,n)</code>.</p>
<p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p><p>P.S. In this task the function should support only natural values of <code>n</code>: integers up from <code>1</code>.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  let result = x;

  for (let i = 1; i &lt; n; i++) {
    result *= x;
  }

  return result;
}

let x = prompt("x?", '');
let n = prompt("n?", '');

if (n &lt;= 1) {
  alert(`Power ${n} is not supported,
    use an integer greater than 0`);
} else {
  alert( pow(x, n) );
}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-144"></h6>
<h1 class="main__header-title" id="chapter-145">Function expressions and arrows</h1>
<p>In JavaScript, a function is not a “magical language structure”, but a special kind of value.</p>


<p>The syntax that we used before is called a <em>Function Declaration</em>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert( "Hello" );
}</code></pre>
        </div>
      </div>
      
      </div><p>There is another syntax for creating a function that is called a <em>Function Expression</em>.</p>
<p>It looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function() {
  alert( "Hello" );
};</code></pre>
        </div>
      </div>
      
      </div><p>Here, the function is created and assigned to the variable explicitly, like any other value. No matter how the function is defined, it's just a value stored in the variable <code>sayHi</code>.</p>
<p>The meaning of these code samples is the same: "create a function and put it into the variable <code>sayHi</code>".</p>
<p>We can even print out that value using <code>alert</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert( "Hello" );
}

alert( sayHi ); // shows the function code</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the last line does not run the function, because there are no parentheses after <code>sayHi</code>. There are programming languages where any mention of a function name causes its execution, but JavaScript is not like that.</p>
<p>In JavaScript, a function is a value, so we can deal with it as a value. The code above shows its string representation, which is the source code.</p>
<p>It is a special value of course, in the sense that we can call it like <code>sayHi()</code>.</p>
<p>But it's still a value. So we can work with it like with other kinds of values.</p>
<p>We can copy a function to another variable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {   // (1) create
  alert( "Hello" );
}

let func = sayHi;    // (2) copy

func(); // Hello     // (3) run the copy (it works)!
sayHi(); // Hello    //     this still works too (why wouldn't it)</code></pre>
        </div>
      </div>
      
      </div><p>Here's what happens above in detail:</p>
<ol>
<li>
<p>The Function Declaration <code>(1)</code> creates the function and puts it into the variable named <code>sayHi</code>.</p>
</li>
<li>
<p>Line <code>(2)</code> copies it into the variable <code>func</code>.</p>
<p>Please note again: there are no parentheses after <code>sayHi</code>. If there were, then <code>func = sayHi()</code> would write  <em>the result of the call</em> <code>sayHi()</code> into <code>func</code>, not <em>the function</em> <code>sayHi</code> itself.</p>
</li>
<li>
<p>Now the function can be called as both <code>sayHi()</code> and <code>func()</code>.</p>
</li>
</ol>
<p>Note that we could also have used a Function Expression to declare <code>sayHi</code>, in the first line:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function() { ... };

let func = sayHi;
// ...</code></pre>
        </div>
      </div>
      
      </div><p>Everything would work the same. Even more obvious what's going on, right?</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Why there's a semicolon at the end?</span></div>
            <div class="important__content"><p>There might be a question, why does Function Expression have a semicolon <code>;</code> at the end, and Function Declaration does not:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="6:1-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  // ...
}

let sayHi = function() {
  // ...
};</code></pre>
        </div>
      </div>
      
      </div><p>The answer is simple:</p>
<ul>
<li>There's no need for <code>;</code> at the end of code blocks and syntax structures that use them like <code>if { ... }</code>, <code>for { }</code>, <code>function f { }</code> etc.</li>
<li>A Function Expression is used inside the statement: <code>let sayHi = ...;</code>, as a value. It's not a code block. The semicolon <code>;</code> is recommended at the end of statements, no matter what is the value. So the semicolon here is not related to the Function Expression itself in any way, it just terminates the statement.</li>
</ul>
</div></div>
<h2 id="chapter-146">
Callback functions</h2>
<p>Let's look at more examples of passing functions as values and using function expressions.</p>
<p>We'll write a function <code>ask(question, yes, no)</code> with three parameters:</p>
<dl>
<dt><code>question</code></dt>
<dd>Text of the question</dd>
<dt><code>yes</code></dt>
<dd>Function to run if the answer is “Yes”</dd>
<dt><code>no</code></dt>
<dd>Function to run if the answer is “No”</dd>
</dl>
<p>The function should ask the <code>question</code> and, depending on the user's answer, call <code>yes()</code> or <code>no()</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function ask(question, yes, no) {
  if (confirm(question)) yes()
  else no();
}

function showOk() {
  alert( "You agreed." );
}

function showCancel() {
  alert( "You canceled the execution." );
}

// usage: functions showOk, showCancel are passed as arguments to ask
ask("Do you agree?", showOk, showCancel);</code></pre>
        </div>
      </div>
      
      </div><p>Before we explore how we can write it in a much shorter way, let's note that in the browser (and on the server-side in some cases) such functions are quite popular. The major difference between a real-life implementation and the example above is that real-life functions use more complex ways to interact with the user than a simple <code>confirm</code>. In the browser, such a function usually draws a nice-looking question window. But that's another story.</p>
<p><strong>The arguments of <code>ask</code> are called <em>callback functions</em> or just <em>callbacks</em>.</strong></p>
<p>The idea is that we pass a function and expect it to be “called back” later if necessary. In our case, <code>showOk</code> becomes the callback for the “yes” answer, and <code>showCancel</code> for the “no” answer.</p>
<p>We can use Function Expressions to write the same function much shorter:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function ask(question, yes, no) {
  if (confirm(question)) yes()
  else no();
}

ask(
  "Do you agree?",
  function() { alert("You agreed."); },
  function() { alert("You canceled the execution."); }
);</code></pre>
        </div>
      </div>
      
      </div><p>Here, functions are declared right inside the <code>ask(...)</code> call. They have no name, and so are called <em>anonymous</em>. Such functions are not accessible outside of <code>ask</code> (because they are not assigned to variables), but that's just what we want here.</p>
<p>Such code appears in our scripts very naturally, it's in the spirit of JavaScript.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">A function is a value representing an “action”</span></div>
            <div class="important__content"><p>Regular values like strings or numbers represent the <em>data</em>.</p>
<p>A function can be perceived as an <em>action</em>.</p>
<p>We can pass it between variables and run when we want.</p>
</div></div>
<h2 id="chapter-147">
Function Expression vs Function Declaration</h2>
<p>Let's formulate the key differences between Function Declarations and Expressions.</p>
<p>First, the syntax: how to see what is what in the code.</p>
<ul>
<li>
<p><em>Function Declaration:</em> a function, declared as a separate statement, in the main code flow.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Function Declaration
function sum(a, b) {
  return a + b;
}</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p><em>Function Expression:</em> a function, created inside an expression or inside another syntax construct.</p>
<p>Here, the function is created at the right side of the “assignment expression =”:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Function Expression
let sum = function(a, b) {
  return a + b;
};</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<p>The more subtle difference is <em>when</em> a function is created by the JavaScript engine.</p>
<p><strong>A Function Expression is created when the execution reaches it and is usable from then on.</strong></p>
<p>Once the execution flow passes to the right side of the assignment <code>let sum = function…</code> – here we go, the function is created and can be used (assigned, called etc) from now on.</p>
<p>Function Declarations are different.</p>
<p><strong>A Function Declaration is usable in the whole script/code block.</strong></p>
<p>In other words, when JavaScript <em>prepares</em> to run the script or a code block, it first looks for Function Declarations in it and creates the functions. We can think of it as an “initialization stage”.</p>
<p>And after all of the Function Declarations are processed, the execution goes on.</p>
<p>As a result, a function declared as a Function Declaration can be called earlier than it is defined.</p>
<p>For example, this works:</p>
<div data-trusted="0" class="code-example" data-refresh="1" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">sayHi("John"); // Hello, John

function sayHi(name) {
  alert( `Hello, ${name}` );
}</code></pre>
        </div>
      </div>
      
      </div><p>The Function Declaration <code>sayHi</code> is created when JavaScript is preparing to start the script and is visible everywhere in it.</p>
<p>…If it was a Function Expression, then it wouldn't work:</p>
<div data-trusted="0" class="code-example" data-refresh="1" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">sayHi("John"); // error!

let sayHi = function(name) {  // (*) no magic any more
  alert( `Hello, ${name}` );
};</code></pre>
        </div>
      </div>
      
      </div><p>Function Expressions are created when the execution reaches them. That would happen only in the line <code>(*)</code>. Too late.</p>
<p><strong>When a Function Declaration is made within a code block, it is visible everywhere inside that block. But not outside of it.</strong></p>
<p>Sometimes that's handy to declare a local function only needed in that block alone. But that feature may also cause problems.</p>
<p>For instance, let's imagine that we need to declare a function <code>welcome()</code> depending on the <code>age</code> variable that we get in run time. And then we plan to use it some time later.</p>
<p>The code below doesn't work:</p>
<div data-trusted="1" class="code-example" data-highlight-block="18-18">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = prompt("What is your age?", 18);

// conditionally declare a function
if (age &lt; 18) {

  function welcome() {
    alert("Hello!");
  }

} else {

  function welcome() {
    alert("Greetings!");
  }

}

// ...use it later
welcome(); // Error: welcome is not defined</code></pre>
        </div>
      </div>
      
      </div><p>That's because a Function Declaration is only visible inside the code block in which it resides.</p>
<p>Here's another example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3,9-9,21-21">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = 16; // take 16 as an example

if (age &lt; 18) {
  welcome();               // \   (runs)
                           //  |
  function welcome() {     //  |
    alert("Hello!");       //  |  Function Declaration is available
  }                        //  |  everywhere in the block where it's declared
                           //  |
  welcome();               // /   (runs)

} else {

  function welcome() {     //  for age = 16, this "welcome" is never created
    alert("Greetings!");
  }
}

// Here we're out of figure brackets,
// so we can not see Function Declarations made inside of them.

welcome(); // Error: welcome is not defined</code></pre>
        </div>
      </div>
      
      </div><p>What can we do to make <code>welcome</code> visible outside of <code>if</code>?</p>
<p>The correct approach would be to use a Function Expression and assign <code>welcome</code> to the variable that is declared outside of <code>if</code> and has the proper visibility.</p>
<p>Now it works as intended:</p>
<div data-trusted="1" class="code-example" data-highlight-block="18-18">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = prompt("What is your age?", 18);

let welcome;

if (age &lt; 18) {

  welcome = function() {
    alert("Hello!");
  };

} else {

  welcome = function() {
    alert("Greetings!");
  };

}

welcome(); // ok now</code></pre>
        </div>
      </div>
      
      </div><p>Or we could simplify it even further using a question mark operator <code>?</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = prompt("What is your age?", 18);

let welcome = (age &lt; 18) ?
  function() { alert("Hello!"); } :
  function() { alert("Greetings!"); };

welcome(); // ok now</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">When to choose Function Declaration versus Function Expression?</span></div>
            <div class="important__content"><p>As a rule of thumb, when we need to declare a function, the first to consider is Function Declaration syntax, the one we used before. It gives more freedom in how to organize our code, because we can call such functions before they are declared.</p>
<p>It's also a little bit easier to look up <code>function f(…) {…}</code> in the code than <code>let f = function(…) {…}</code>. Function Declarations are more “eye-catching”.</p>
<p>…But if a Function Declaration does not suit us for some reason (we've seen an example above), then Function Expression should be used.</p>
</div></div>
<h2 id="chapter-148">
Arrow functions</h2>
<p>There's one more very simple and concise syntax for creating functions, that's often better than Function Expressions. It's called “arrow functions”, because it looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let func = (arg1, arg2, ...argN) =&gt; expression</code></pre>
        </div>
      </div>
      
      </div><p>…This creates a function <code>func</code> that has arguments <code>arg1..argN</code>, evaluates the <code>expression</code> on the right side with their use and returns its result.</p>
<p>In other words, it's roughly the same as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let func = function(arg1, arg2, ...argN) {
  return expression;
}</code></pre>
        </div>
      </div>
      
      </div><p>…But much more concise.</p>
<p>Let's see an example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sum = (a, b) =&gt; a + b;

/* The arrow function is a shorter form of:

let sum = function(a, b) {
  return a + b;
};
*/

alert( sum(1, 2) ); // 3</code></pre>
        </div>
      </div>
      
      </div><p>If we have only one argument, then parentheses can be omitted, making that even shorter:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// same as
// let double = function(n) { return n * 2 }
let double = n =&gt; n * 2;

alert( double(3) ); // 6</code></pre>
        </div>
      </div>
      
      </div><p>If there are no arguments, parentheses should be empty (but they should be present):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = () =&gt; alert("Hello!");

sayHi();</code></pre>
        </div>
      </div>
      
      </div><p>Arrow functions can be used in the same way as Function Expressions.</p>
<p>For instance, here's the rewritten example with <code>welcome()</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = prompt("What is your age?", 18);

let welcome = (age &lt; 18) ?
  () =&gt; alert('Hello') :
  () =&gt; alert("Greetings!");

welcome(); // ok now</code></pre>
        </div>
      </div>
      
      </div><p>Arrow functions may appear unfamiliar and not very readable at first, but that quickly changes as the eyes get used to the structure.</p>
<p>They are very convenient for simple one-line actions, when we're just too lazy to write many words.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Multiline arrow functions</span></div>
            <div class="important__content"><p>The examples above took arguments from the left of <code>=&gt;</code> and evaluated the right-side expression with them.</p>
<p>Sometimes we need something a little bit more complex, like multiple expressions or statements. It is also possible, but we should enclose them in figure brackets. Then use a normal <code>return</code> within them.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sum = (a, b) =&gt; {  // the figure bracket opens a multiline function
  let result = a + b;
  return result; // if we use figure brackets, use return to get results
};

alert( sum(1, 2) ); // 3</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">More to come</span></div>
            <div class="important__content"><p>Here we praised arrow functions for brevity. But that's not all! Arrow functions have other interesting features. We'll return to them later in the chapter 
<a href="http://javascript.info/arrow-functions">Arrow functions revisited</a>.</p>
<p>For now, we can already use them for one-line actions and callbacks.</p>
</div></div>
<h2 id="chapter-149">
Summary</h2>
<ul>
<li>Functions are values. They can be assigned, copied or declared in any place of the code.</li>
<li>If the function is declared as a separate statement in the main code flow, that's called a “Function Declaration”.</li>
<li>If the function is created as a part of an expression, it's called a “Function Expression”.</li>
<li>Function Declarations are processed before the code block is executed. They are visible everywhere in the block.</li>
<li>Function Expressions are created when the execution flow reaches them.</li>
</ul>
<p>In most cases when we need to declare a function, a Function Declaration is preferable, because it is visible prior to the declaration itself. That gives us more flexibility in code organization, and is usually more readable.</p>
<p>So we should use a Function Expression only when a Function Declaration is not fit for the task. We've seen a couple of examples of that in this chapter, and will see more in the future.</p>
<p>Arrow functions are handy for one-liners. They come in two flavors:</p>
<ol>
<li>Without figure brackets: <code>(...args) =&gt; expression</code> – the right side is an expression: the function evaluates it and returns the result.</li>
<li>With figure brackets: <code>(...args) =&gt; { body }</code> – brackets allow us to write multiple statements inside the function, but we need an explicit <code>return</code> to return something.</li>
</ol>
<div class="tasks"><h2 id="chapter-150" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-with-arrow-functions" name="rewrite-with-arrow-functions" class="main__anchor">Rewrite with arrow functions</a></h3>
<a href="http://javascript.info/task/rewrite-arrow" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Replace Function Expressions with arrow functions in the code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function ask(question, yes, no) {
  if (confirm(question)) yes()
  else no();
}

ask(
  "Do you agree?",
  function() { alert("You agreed."); },
  function() { alert("You canceled the execution."); }
);</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-highlight-block="7-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function ask(question, yes, no) {
  if (confirm(question)) yes()
  else no();
}

ask(
  "Do you agree?",
  () =&gt; alert("You agreed."),
  () =&gt; alert("You canceled the execution.")
);</code></pre>
        </div>
      </div>
      
      </div><p>Looks short and clean, right?</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-151"></h6>
<h1 class="main__header-title" id="chapter-152">JavaScript specials</h1>
<p>This chapter briefly recaps the features of JavaScript that we've learned by now, paying special attention to subtle moments.</p>


<h2 id="chapter-153">
Code structure</h2>
<p>Statements are delimited with a semicolon:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('Hello'); alert('World');</code></pre>
        </div>
      </div>
      
      </div><p>Usually, a line-break is also treated as a delimiter, so that would also work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('Hello')
alert('World')</code></pre>
        </div>
      </div>
      
      </div><p>That's called “automatic semicolon insertion”. Sometimes it doesn't work, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("There will be an error after this message")

[1, 2].forEach(alert)</code></pre>
        </div>
      </div>
      
      </div><p>Most codestyle guides agree that we should put a semicolon after each statement.</p>
<p>Semicolons are not required after code blocks <code>{...}</code> and syntax constructs with them like loops:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  // no semicolon needed after function declaration
}

for(;;) {
  // no semicolon needed after the loop
}</code></pre>
        </div>
      </div>
      
      </div><p>…But even if we can put an “extra” semicolon somewhere, that's not an error. It will be ignored.</p>
<p>More in: 
<a href="#chapter-32">Code structure</a>.</p>
<h2 id="chapter-154">
Strict mode</h2>
<p>To fully enable all features of modern JavaScript, we should start scripts with <code>"use strict"</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">'use strict';

...</code></pre>
        </div>
      </div>
      
      </div><p>The directive must be at the top of a script or at the beginning of a function.</p>
<p>Without <code>"use strict"</code>, everything still works, but some features behave in the old-fashion, “compatible” way. We'd generally prefer the modern behavior.</p>
<p>Some modern features of the language (like classes that we'll study in the future) enable strict mode implicitly.</p>
<p>More in: 
<a href="http://javascript.info/strict-mode">The modern mode, "use strict"</a>.</p>
<h2 id="chapter-155">
Variables</h2>
<p>Can be declared using:</p>
<ul>
<li><code>let</code></li>
<li><code>const</code> (constant, can't be changed)</li>
<li><code>var</code> (old-style, will see later)</li>
</ul>
<p>A variable name can include:</p>
<ul>
<li>Letters and digits, but the first character may not be a digit.</li>
<li>Characters <code>$</code> and <code>_</code> are normal, on par with letters.</li>
<li>Non-Latin alphabets and hieroglyphs are also allowed, but commonly not used.</li>
</ul>
<p>Variables are dynamically typed. They can store any value:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let x = 5;
x = "John";</code></pre>
        </div>
      </div>
      
      </div><p>There are 7 data types:</p>
<ul>
<li><code>number</code> for both floating-point and integer numbers,</li>
<li><code>string</code> for strings,</li>
<li><code>boolean</code> for logical values: <code>true/false</code>,</li>
<li><code>null</code> – a type with a single value <code>null</code>, meaning “empty” or “does not exist”,</li>
<li><code>undefined</code> – a type with a single value <code>undefined</code>, meaning “not assigned”,</li>
<li><code>object</code> and <code>symbol</code> – for complex data structures and unique identifiers, we haven't learnt them yet.</li>
</ul>
<p>The <code>typeof</code> operator returns the type for a value, with two exceptions:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">typeof null == "object" // error in the language
typeof function(){} == "function" // functions are treated specially</code></pre>
        </div>
      </div>
      
      </div><p>More in: 
<a href="http://javascript.info/variables">Variables</a> and 
<a href="http://javascript.info/types">Data types</a>.</p>
<h2 id="chapter-156">
Interaction</h2>
<p>We're using a browser as a working environment, so basic UI functions will be:</p>
<dl>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt"><code>prompt(question[, default])</code></a></dt>
<dd>Ask a <code>question</code>, and return either what the visitor entered or <code>null</code> if he pressed “cancel”.</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/confirm"><code>confirm(question)</code></a></dt>
<dd>Ask a <code>question</code> and suggest to choose between Ok and Cancel. The choice is returned as <code>true/false</code>.</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/alert"><code>alert(message)</code></a></dt>
<dd>Output a <code>message</code>.</dd>
</dl>
<p>All these functions are <em>modal</em>, they pause the code execution and prevent the visitor from interacting with the page until he answers.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let userName = prompt("Your name?", "Alice");
let isTeaWanted = confirm("Do you want some tea?");

alert( "Visitor: " + userName ); // Alice
alert( "Tea wanted: " + isTeaWanted ); // true</code></pre>
        </div>
      </div>
      
      </div><p>More in: 
<a href="http://javascript.info/alert-prompt-confirm">Interaction: alert, prompt, confirm</a>.</p>
<h2 id="chapter-157">
Operators</h2>
<p>JavaScript supports the following operators:</p>
<dl>
<dt>Arithmetical</dt>
<dd>
<p>Regular: <code>* + - /</code>, also <code>%</code> for the remainder and <code>**</code> for power of a number.</p>
<p>Binary plus <code>+</code> concatenates strings. And if any of the operands is a string, the other one is converted to string too:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '1' + 2 ); // '12', string
alert( 1 + '2' ); // '12', string</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt>Assignments</dt>
<dd>
<p>There is a simple assignment: <code>a = b</code> and combined ones like <code>a *= 2</code>.</p>
</dd>
<dt>Bitwise</dt>
<dd>
<p>Bitwise operators work with integers on bit-level: see the 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators">docs</a> when they are needed.</p>
</dd>
<dt>Ternary</dt>
<dd>
<p>The only operator with three parameters: <code>cond ? resultA : result B</code>. If <code>cond</code> is truthy, returns <code>resultA</code>, otherwise <code>resultB</code>.</p>
</dd>
<dt>Logical operators</dt>
<dd>
<p>Logical AND <code>&amp;&amp;</code> and OR <code>||</code> perform short-circuit evaluation and then return the value where it stopped.</p>
</dd>
<dt>Comparisons</dt>
<dd>
<p>Equality check <code>==</code> for values of different types converts them to a number (except <code>null</code> and <code>undefined</code> that equal each other and nothing else), so these are equal:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 0 == false ); // true
alert( 0 == '' ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Other comparisons convert to a number as well.</p>
<p>The strict equality operator <code>===</code> doesn't do the conversion: different types always mean different values for it, so:</p>
<p>Values <code>null</code> and <code>undefined</code> are special: they equal <code>==</code> each other and don't equal anything else.</p>
<p>Greater/less comparisons compare strings character-by-character, other types are converted to a number.</p>
</dd>
<dt>Logical operators</dt>
<dd>
<p>There are few others, like a comma operator.</p>
</dd>
</dl>
<p>More in: 
<a href="http://javascript.info/operators">Operators</a>, 
<a href="http://javascript.info/comparison">Comparisons</a>, 
<a href="http://javascript.info/logical-operators">Logical operators</a>.</p>
<h2 id="chapter-158">
Loops</h2>
<ul>
<li>
<p>We covered 3 types of loops:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// 1
while (condition) {
  ...
}

// 2
do {
  ...
} while (condition);

// 3
for(let i = 0; i &lt; 10; i++) {
  ...
}</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>The variable declared in <code>for(let...)</code> loop is visible only inside the loop. But we can also omit <code>let</code> and reuse an existing variable.</p>
</li>
<li>
<p>Directives <code>break/continue</code> allow to exit the whole loop/current iteration. Use labels to break nested loops.</p>
</li>
</ul>
<p>Details in: 
<a href="http://javascript.info/while-for">Loops: while and for</a>.</p>
<p>Later we'll study more types of loops to deal with objects.</p>
<h2 id="chapter-159">
The “switch” construct</h2>
<p>The “switch” construct can replace multiple <code>if</code> checks. It uses <code>===</code> for comparisons.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let age = prompt('Your age?', 18);

switch (age) {
  case 18:
    alert("Won't work"); // the result of prompt is a string, not a number

  case "18":
    alert("This works!");
    break;

  default:
    alert("Any value not equal to one above");
}</code></pre>
        </div>
      </div>
      
      </div><p>Details in: 
<a href="http://javascript.info/switch">The "switch" statement</a>.</p>
<h2 id="chapter-160">
Functions</h2>
<p>We covered three ways to create a function in JavaScript:</p>
<ol>
<li>
<p>Function Declaration: the function in the main code flow</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sum(a, b) {
  let result = a + b;

  return result;
}</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Function Expression: the function in the context of an expression</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sum = function(a, b) {
  let result = a + b;

  return result;
}</code></pre>
        </div>
      </div>
      
      </div><p>Function expression can have a name, like <code>sum = function name(a, b)</code>, but that <code>name</code> is only visible inside that function.</p>
</li>
<li>
<p>Arrow functions:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// expression at the right side
let sum = (a, b) =&gt; a + b;

// or multi-line syntax with { ... }, need return here:
let sum = (a, b) =&gt; {
  // ...
  return a + b;
}

// without arguments
let sayHi = () =&gt; alert("Hello");

// with a single argument
let double = n =&gt; n * 2;</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<ul>
<li>Functions may have local variables: those declared inside its body. Such variables are only visible inside the function.</li>
<li>Parameters can have default values: <code>function sum(a = 1, b = 2) {...}</code>.</li>
<li>Functions always return something. If there's no <code>return</code> statement, then the result is <code>undefined</code>.</li>
</ul>
<table>
<thead>
<tr>
<th>Function Declaration</th>
<th>Function Expression</th>
</tr>
</thead>
<tbody>
<tr>
<td>visible in the whole code block</td>
<td>created when the execution reaches it</td>
</tr>
<tr>
<td>-</td>
<td>can have a name, visible only inside the function</td>
</tr>
</tbody>
</table>
<p>More: see 
<a href="http://javascript.info/function-basics">Functions</a>, 
<a href="http://javascript.info/function-expressions-arrows">Function expressions and arrows</a>.</p>
<h2 id="chapter-161">
More to come</h2>
<p>That was a brief list of JavaScript features. As of now we've studied only basics. Further in the tutorial you'll find more specials and advanced features of JavaScript.</p>

<h6 id="chapter-162"></h6>
<h1 class="main__header-title" id="chapter-163">Code quality</h1>
<p>This chapter explains coding practices that we'll use further in the development.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/debugging-chrome" class="lessons-list__link">Debugging in Chrome</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/coding-style" class="lessons-list__link">Coding style</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/comments" class="lessons-list__link">Comments</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/ninja-code" class="lessons-list__link">Ninja code</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/testing-mocha" class="lessons-list__link">Automated testing with mocha</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/polyfills" class="lessons-list__link">Polyfills</a></li></ol></div>

<h6 id="chapter-164"></h6>
<h1 class="main__header-title" id="chapter-165">Debugging in Chrome</h1>
<p>Before writing more complex code, let's talk about debugging.</p>
<p>All modern browsers and most other environments support “debugging” – a special UI in developer tools that makes finding and fixing errors much easier.</p>
<p>We'll be using Chrome here, because it's probably the most feature-rich in this aspect.</p>


<h2 id="chapter-166">
The “sources” pane</h2>
<p>Your Chrome version may look a little bit different, but it still should be obvious what's there.</p>
<ul>
<li>Open the 
<a href="http://javascript.info/article/debugging-chrome/debugging/index.html">example page</a> in Chrome.</li>
<li>Turn on developer tools with <kbd class="shortcut">F12</kbd> (Mac: <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>Opt<span class="shortcut__plus">+</span>I</kbd>).</li>
<li>Select the <code>sources</code> pane.</li>
</ul>
<p>Here's what you should see if you are doing it for the first time:</p>
      <img src="http://javascript.info/article/debugging-chrome/chrome-open-sources.png">
<p>The toggler button <span class="devtools" style="background-position:-168px -76px"></span> opens the tab with files.</p>
<p>Let's click it and select <code>index.html</code> and then <code>hello.js</code> in the tree view. Here's what should show up:</p>
      <img src="http://javascript.info/article/debugging-chrome/chrome-tabs.png">
<p>Here we can see three zones:</p>
<ol>
<li><strong>Resources zone</strong> lists html, javascript, css and other files including images that are attached to the page. Chrome extensions may appear here too.</li>
<li><strong>Source zone</strong> shows the source code.</li>
<li><strong>Information and control zone</strong> is for debugging, we'll explore it soon.</li>
</ol>
<p>Now you could click the same toggler <span class="devtools" style="background-position:-200px -76px"></span> again to hide the resources list and give the code some space.</p>
<h2 id="chapter-167">
Console</h2>
<p>If we press <code>Esc</code>, then a console opens below. We can type commands there and press <kbd class="shortcut">Enter</kbd> to execute.</p>
<p>After a statement is executed, its result is shown below.</p>
<p>For example, here <code>1+2</code> results in <code>3</code>, and <code>hello("debugger")</code> returns nothing, so the result is <code>undefined</code>:</p>
      <img src="http://javascript.info/article/debugging-chrome/chrome-sources-console.png">
<h2 id="chapter-168">
Breakpoints</h2>
<p>Let's examine what's going on within the code of the 
<a href="http://javascript.info/article/debugging-chrome/debugging/index.html">example page</a>. In <code>hello.js</code>, click at the line number <code>4</code>. Yes, right on the <code>"4"</code> digit, not on the code.</p>
<p>Congratulations! You've set a breakpoint. Please also click on the number for line <code>8</code>.</p>
<p>It should look like this (blue is where you should click):</p>
      <img src="http://javascript.info/article/debugging-chrome/chrome-sources-breakpoint.png">
<p>A <em>breakpoint</em> is a point of code where the debugger will automatically pause the JavaScript execution.</p>
<p>While the code is paused, we can examine current variables, execute commands in the console etc. In other words, we can debug it.</p>
<p>We can always find a list of breakpoints in the right pane. That's useful when we have many breakpoints in various files. It allows to:</p>
<ul>
<li>Quickly jump to the breakpoint in the code (by clicking on it in the right pane).</li>
<li>Temporarily disable the breakpoint by unchecking it.</li>
<li>Remove the breakpoint by right-clicking and selecting Remove.</li>
<li>…And so on.</li>
</ul>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Conditional breakpoints</span></div>
            <div class="important__content"><p><em>Right click</em> on the line number allows to create a <em>conditional</em> breakpoint. It only triggers when the given expression is truthy.</p>
<p>That's handy when we need to stop only for a certain variable value or for certain function parameters.</p>
</div></div>
<h2 id="chapter-169">
Debugger command</h2>
<p>We can also pause the code by using the <code>debugger</code> command, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hello(name) {
  let phrase = `Hello, ${name}!`;

  debugger;  // &lt;-- the debugger stops here

  say(phrase);
}</code></pre>
        </div>
      </div>
      
      </div><p>That's very convenient when we are in a code editor and don't want to switch to the browser and look up the script in developer tools to set the breakpoint.</p>
<h2 id="chapter-170">
Pause and look around</h2>
<p>In our example, <code>hello()</code> is called during the page load, so the easiest way to activate the debugger is to reload the page. So let's press <kbd class="shortcut">F5</kbd> (Windows, Linux) or <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>R</kbd> (Mac).</p>
<p>As the breakpoint is set, the execution pauses at the 4th line:</p>
      <img src="http://javascript.info/article/debugging-chrome/chrome-sources-debugger-pause.png">
<p>Please open the informational dropdowns to the right (labeled with arrows). They allow you to examine the current code state:</p>
<ol>
<li>
<p><strong><code>Watch</code> – shows current values for any expressions.</strong></p>
<p>You can click the plus <code>+</code> and input an expression. The debugger will show its value at any moment, automatically recalculating it in the process of execution.</p>
</li>
<li>
<p><strong><code>Call Stack</code> – shows the nested calls chain.</strong></p>
<p>At the current moment the debugger is inside <code>hello()</code> call, called by a script in <code>index.html</code> (no function there, so it's called “anonymous”).</p>
<p>If you click on a stack item, the debugger jumps to the corresponding code, and all its variables can be examined as well.</p>
</li>
<li>
<p><strong><code>Scope</code> – current variables.</strong></p>
<p><code>Local</code> shows local function variables. You can also see their values highlighted right over the source.</p>
<p><code>Global</code> has global variables (out of any functions).</p>
<p>There's also <code>this</code> keyword there that we didn't study yet, but we'll do that soon.</p>
</li>
</ol>
<h2 id="chapter-171">
Tracing the execution</h2>
<p>Now it's time to <em>trace</em> the script.</p>
<p>There are buttons for it at the top of the right pane. Let's engage them.</p>
<dl>
<dt><span class="devtools" style="background-position:-7px -76px"></span> – continue the execution, hotkey <kbd class="shortcut">F8</kbd>.</dt>
<dd>
<p>Resumes the execution. If there are no additional breakpoints, then the execution just continues and the debugger looses the control.</p>
<p>Here's what we can see after a click on it:</p>
      <img src="http://javascript.info/article/debugging-chrome/chrome-sources-debugger-trace-1.png">
<p>The execution has resumed, reached another breakpoint inside <code>say()</code> and paused there. Take a look at the “Call stack” at the right. It has increased by one more call. We're inside <code>say()</code> now.</p>
</dd>
<dt><span class="devtools" style="background-position:-137px -76px"></span> – make a step (run the next command), but <em>don't go into the function</em>, hotkey <kbd class="shortcut">F10</kbd>.</dt>
<dd>
<p>If we click it now, <code>alert</code> will be shown. The important thing is that <code>alert</code> can be any function, the execution “steps over it”, skipping the function internals.</p>
</dd>
<dt><span class="devtools" style="background-position:-72px -76px"></span> – make a step, hotkey <kbd class="shortcut">F11</kbd>.</dt>
<dd>
<p>The same as the previous one, but “steps into” nested functions. Clicking this will step through all script actions one by one.</p>
</dd>
<dt><span class="devtools" style="background-position:-104px -76px"></span> – continue the execution till the end of the current function, hotkey <kbd class="shortcut">Shift<span class="shortcut__plus">+</span>F11</kbd>.</dt>
<dd>
<p>The execution would stop at the very last line of the current function. That's handy when we accidentally entered a nested call using <span class="devtools" style="background-position:-72px -76px"></span>, but it does not interest us, and we want to continue to its end as soon as possible.</p>
</dd>
<dt><span class="devtools" style="background-position:-7px -28px"></span> – enable/disable all breakpoints.</dt>
<dd>
<p>That button does not move the execution. Just a mass on/off for breakpoints.</p>
</dd>
<dt><span class="devtools" style="background-position:-264px -4px"></span> – enable/disable automatic pause in case of an error.</dt>
<dd>
<p>When enabled, and the developer tools is open, a script error automatically pauses the execution. Then we can analyze variables to see what went wrong. So if our script dies with an error, we can open debugger, enable this option and reload the page to see where it dies and what's the context at that moment.</p>
</dd>
</dl>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Continue to here</span></div>
            <div class="important__content"><p>Right click on a line of code opens the context menu with a great option called “Continue to here”.</p>
<p>That's handy when we want to move multiple steps forward, but we're too lazy to set a breakpoint.</p>
</div></div>
<h2 id="chapter-172">
Logging</h2>
<p>To output something to console, there's <code>console.log</code> function.</p>
<p>For instance, this outputs values from <code>0</code> to <code>4</code> to console:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// open console to see
for (let i = 0; i &lt; 5; i++) {
  console.log("value", i);
}</code></pre>
        </div>
      </div>
      
      </div><p>Regular users don't see that output, it is in the console. To see it, either open the Console tab of developer tools or press <kbd class="shortcut">Esc</kbd> while in another tab: that opens the console at the bottom.</p>
<p>If we have enough logging in our code, then we can see what's going on from the records, without the debugger.</p>
<h2 id="chapter-173">
Summary</h2>
<p>As we can see, there are three main ways to pause a script:</p>
<ol>
<li>A breakpoint.</li>
<li>The <code>debugger</code> statements.</li>
<li>An error (if dev tools are open and the button <span class="devtools" style="background-position:-264px -4px"></span> is “on”)</li>
</ol>
<p>Then we can examine variables and step on to see where the execution goes wrong.</p>
<p>There are many more options in developer tools than covered here. The full manual is at 
<a href="https://developers.google.com/web/tools/chrome-devtools">https://developers.google.com/web/tools/chrome-devtools</a></p>
<p>The information from this chapter is enough to begin debugging, but later, especially if you do a lot of browser stuff, please go there and look through more advanced capabilities of developer tools.</p>
<p>Oh, and also you can click at various places of dev tools and just see what's showing up. That's probably the fastest route to learn dev tools. Don't forget about the right click as well!</p>

<h6 id="chapter-174"></h6>
<h1 class="main__header-title" id="chapter-175">Coding style</h1>
<p>Our code must be as clean and easy to read as possible.</p>
<p>That is actually an art of programming – to take a complex task and code it in a way that is both correct and human-readable.</p>
<p>One thing to help is the good code style.</p>


<h2 id="chapter-176">
Syntax</h2>
<p>A cheatsheet with the rules (more details below):</p>
      <img src="http://javascript.info/article/coding-style/code-style.png">
<!--
```js
function pow(x, n) {
  let result = 1;

  for (let i = 0; i < n; i++) {
    result *= x;
  }

  return result;
}

let x = prompt("x?", "");
let n = prompt("n?", "");

if (n < 0) {
  alert(`Power ${n} is not supported,
    please enter an integer number, greater than 0`);
} else {
  alert( pow(x, n) );
}
```

-->
<p>Now let's discuss the rules and reasons for them in detail.</p>
<p>Nothing is “carved in stone” here. Everything is optional and can be changed: these are coding rules, not religious dogmas.</p>
<h3>
Figure brackets</a></h3><p>In most JavaScript projects figure brackets are written on the same line, not on the new line. A so-called “egyptian” style. There's also a space before an opening bracket.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (condition) {
  // do this
  // ...and that
  // ...and that
}</code></pre>
        </div>
      </div>
      
      </div><p>A single-line construct is an important edge case. Should we use brackets at all? If yes, then where?</p>
<p>Here are the annotated variants, so you can judge about their readability on your own:</p>
<!--
```js no-beautify
if (n < 0) {alert(`Power ${n} is not supported`);}

if (n < 0) alert(`Power ${n} is not supported`);

if (n < 0)
  alert(`Power ${n} is not supported`);

if (n < 0) {
  alert(`Power ${n} is not supported`);
}
```
-->
      <img src="http://javascript.info/article/coding-style/figure-bracket-style.png">
<p>As a summary:</p>
<ul>
<li>For a really short code, one line is acceptable: like <code>if (cond) return null</code>.</li>
<li>But a separate line for each statement in brackets is usually better.</li>
</ul>
<h3>
Line length</a></h3><p>The maximal line length should be limited. No one likes to eye-follow a long horizontal line. It's better to split it.</p>
<p>The maximal line length is agreed on the team-level. It's usually 80 or 120 characters.</p>
<h3>
Indents</a></h3><p>There are two types of indents:</p>
<ul>
<li>
<p><strong>A horizontal indent: 2(4) spaces.</strong></p>
<p>A horizontal indentation is made using either 2 or 4 spaces or the “Tab” symbol. Which one to choose is an old holy war. Spaces are more common nowadays.</p>
<p>One advantage of spaces over tabs is that spaces allow more flexible configurations of indents than the “Tab” symbol.</p>
<p>For instance, we can align the arguments with the opening bracket, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">show(parameters,
     aligned, // 5 spaces padding at the left
     one,
     after,
     another
  ) {
  // ...
}</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p><strong>A vertical indent: empty lines for splitting code into logical blocks.</strong></p>
<p>Even a single function can often be divided in logical blocks. In the example below, the initialization of variables, the main loop and returning the result are split vertically:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  let result = 1;
  //              &lt;--
  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }
  //              &lt;--
  return result;
}</code></pre>
        </div>
      </div>
      
      </div><p>Insert an extra newline where it helps to make the code more readable. There should not be more than nine lines of code without a vertical indentation.</p>
</li>
</ul>
<h3>
A semicolon</a></h3><p>A semicolon should be present after each statement. Even if it could possibly be skipped.</p>
<p>There are languages where a semicolon is truly optional. It's rarely used there. But in JavaScript there are few cases when a line break is sometimes not interpreted as a semicolon. That leaves a place for programming errors.</p>
<p>As you become more mature as a programmer, you may choose a no-semicolon style, like 
<a href="https://standardjs.com/">StandardJS</a>, but that's only when you know JavaScript well and understand possible pitfalls.</p>
<h3>
Nesting levels</a></h3><p>There should not be too many nesting levels.</p>
<p>Sometimes it's a good idea to use the 
<a href="http://javascript.info/while-for#continue">“continue”</a> directive in the loop to evade extra nesting in <code>if(..) { ... }</code>:</p>
<p>Instead of:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 10; i++) {
  if (cond) {
    ... // &lt;- one more nesting level
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>We can write:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:13-21">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 10; i++) {
  if (!cond) continue;
  ...  // &lt;- no extra nesting level
}</code></pre>
        </div>
      </div>
      
      </div><p>A similar thing can be done with <code>if/else</code> and <code>return</code>.</p>
<p>For example, two constructs below are identical.</p>
<p>The first one:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  if (n &lt; 0) {
    alert("Negative 'n' not supported");
  } else {
    let result = 1;

    for (let i = 0; i &lt; n; i++) {
      result *= x;
    }

    return result;
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>And this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  if (n &lt; 0) {
    alert("Negative 'n' not supported");
    return;
  }

  let result = 1;

  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }

  return result;
}</code></pre>
        </div>
      </div>
      
      </div><p>…But the second one is more readable, because the “edge case” of <code>n &lt; 0</code> is handled early on, and then we have the “main” code flow, without an additional nesting.</p>
<h2 id="chapter-177">
Functions below the code</h2>
<p>If you are writing several “helper” functions and the code to use them, then there are three ways to place them.</p>
<ol>
<li>
<p>Functions above the code that uses them:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:3-24,13:3-27">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// function declarations
function createElement() {
  ...
}

function setHandler(elem) {
  ...
}

function walkAround() {
  ...
}

// the code which uses them
let elem = createElement();
setHandler(elem);
walkAround();</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Code first, then functions</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:3-36,5:7-23">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// the code which uses the functions
let elem = createElement();
setHandler(elem);
walkAround();

// --- helper functions ---

function createElement() {
  ...
}

function setHandler(elem) {
  ...
}

function walkAround() {
  ...
}</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Mixed: a function is described where it's first used.</p>
</li>
</ol>
<p>Most of time, the second variant is preferred.</p>
<p>That's because when reading a code, we first want to know “what it does”. If the code goes first, then it provides that information. And then maybe we won't need to read functions at all, especially if their names are adequate to what they're doing.</p>
<h2 id="chapter-178">
Style guides</h2>
<p>A style guide contains general rules about “how to write”: which quotes to use, how many spaces to indent, where to put line breaks, etc. A lot of minor things.</p>
<p>In total, when all members of a team use the same style guide, the code looks uniform. No matter who of the team wrote it, it's still the same style.</p>
<p>Surely, a team may think out a style guide themselves. But as of now, there's no need to. There are many tried, worked-out style guides, which are easy to adopt.</p>
<p>For instance:</p>
<ul>
<li>
<a href="https://google.github.io/styleguide/javascriptguide.xml">Google JavaScript Style Guide</a></li>
<li>
<a href="https://github.com/airbnb/javascript">Airbnb JavaScript Style Guide</a></li>
<li>
<a href="https://github.com/rwaldron/idiomatic.js">Idiomatic.JS</a></li>
<li>
<a href="https://standardjs.com/">StandardJS</a></li>
<li>(there are more)</li>
</ul>
<p>If you're a novice developer, then you could start with the cheatsheet above in the chapter, and later browse the style guides to pick up the common principles and maybe choose one.</p>
<h2 id="chapter-179">
Automated linters</h2>
<p>There are tools that can check the code style automatically. They are called “linters”.</p>
<p>The great thing about them is that style-checking also finds some bugs, like a typo in a variable or function name.</p>
<p>So it's recommended to install one, even if you don't want to stick to a “code style”. They help to find typos – and that's already good enough.</p>
<p>Most well-known tools are:</p>
<ul>
<li>
<a href="http://www.jslint.com/">JSLint</a> – one of the first linters.</li>
<li>
<a href="http://www.jshint.com/">JSHint</a> – more settings than JSLint.</li>
<li>
<a href="http://eslint.org/">ESLint</a> – probably the newest one.</li>
</ul>
<p>All of them can do the job. The author uses 
<a href="http://eslint.org/">ESLint</a>.</p>
<p>Most linters are integrated with editors: just enable the plugin in the editor and configure the style.</p>
<p>For instance, for ESLint you should do the following:</p>
<ol>
<li>Install 
<a href="https://nodejs.org/">Node.JS</a>.</li>
<li>Install ESLint with the command <code>npm install -g eslint</code> (npm is Node.JS package installer).</li>
<li>Create a config file named <code>.eslintrc</code> in the root of your JavaScript project (in the folder that contains all your files).</li>
</ol>
<p>Here's an example of <code>.eslintrc</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">{
  "extends": "eslint:recommended",
  "env": {
    "browser": true,
    "node": true,
    "es6": true
  },
  "rules": {
    "no-console": 0,
  },
  "indent": 2
}</code></pre>
        </div>
      </div>
      
      </div><p>Here the directive <code>"extends"</code> denotes that we base on the “eslint:recommended” set of settings, and then we specify our own.</p>
<p>Then install/enable the plugin for your editor that integrates with ESLint. The majority of editors have it.</p>
<p>It is possible to download style rule sets from the web and extend them instead. See 
<a href="http://eslint.org/docs/user-guide/getting-started">http://eslint.org/docs/user-guide/getting-started</a> for more details about installation.</p>
<p>Using a linter has a great side-effect: linters catch typos. For instance, when an undefined variable is accessed, a linter detects it and (if integrated with an editor) highlights it. In most cases that's a mistype. So we can fix it right ahead.</p>
<p>For that reason even if you're not concerned about styles, using a linter is highly recommended.</p>
<p>Also certain IDEs support built-in linting, that also may be good, but not so tunable as ESLint.</p>
<h2 id="chapter-180">
Summary</h2>
<p>All syntax rules from this chapter and the style guides aim to increase readability, so all of them are debatable.</p>
<p>When we think about “how to write better?”, the sole criterion is “what makes the code more readable and easier to understand? what helps to evade errors?” That's the main thing to keep in mind when choosing the style or discussing which one is better.</p>
<p>Read style guides to see the latest ideas about that and follow those that you find the best.</p>
<div class="tasks"><h2 id="chapter-181" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#bad-style" name="bad-style" class="main__anchor">Bad style</a></h3>
<a href="http://javascript.info/task/style-errors" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>What's wrong with the code style below?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x,n)
{
  let result=1;
  for(let i=0;i&lt;n;i++) {result*=x;}
  return result;
}

let x=prompt("x?",''), n=prompt("n?",'')
if (n&lt;=0)
{
  alert(`Power ${n} is not supported, please enter an integer number greater than zero`);
}
else
{
  alert(pow(x,n))
}</code></pre>
        </div>
      </div>
      
      </div><p>Fix it.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>You could note the following:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x,n)  // &lt;- no space between arguments
{  // &lt;- figure bracket on a separate line
  let result=1;   // &lt;- no spaces to the both sides of =
  for(let i=0;i&lt;n;i++) {result*=x;}   // &lt;- no spaces
  // the contents of { ... } should be on a new line
  return result;
}

let x=prompt("x?",''), n=prompt("n?",'') // &lt;-- technically possible,
// but better make it 2 lines, also there's no spaces and ;
if (n&lt;0)  // &lt;- no spaces inside (n &lt; 0), and should be extra line above it
{   // &lt;- figure bracket on a separate line
  // below - a long line, may be worth to split into 2 lines
  alert(`Power ${n} is not supported, please enter an integer number greater than zero`);
}
else // &lt;- could write it on a single line like "} else {"
{
  alert(pow(x,n))  // no spaces and ;
}</code></pre>
        </div>
      </div>
      
      </div><p>The fixed variant:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  let result = 1;

  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }

  return result;
}

let x = prompt("x?", "");
let n = prompt("n?", "");

if (n &lt; 0) {
  alert(`Power ${n} is not supported,
    please enter an integer number greater than zero`);
} else {
  alert( pow(x, n) );
}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-182"></h6>
<h1 class="main__header-title" id="chapter-183">Comments</h1>
<p>As we know from the chapter 
<a href="http://javascript.info/structure">Code structure</a>, comments can be single-line: starting with <code>//</code> and multiline: <code>/* ... */</code>.</p>
<p>We normally use them to describe how and why the code works.</p>
<p>From the first sight, commenting might be obvious, but novices in programming usually get it wrong.</p>
<h2 id="chapter-184">
Bad comments</h2>
<p>Novices tend to use comments to explain “what is going on in the code”. Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// This code will do this thing (...) and that thing (...)
// ...and who knows what else...
very;
complex;
code;</code></pre>
        </div>
      </div>
      
      </div><p>But in a good code the amount of such “explanatory” comments should be minimal. Seriously, a code should be easy to understand without them.</p>
<p>There's a great rule about that: “if the code is so unclear that it requires a comment, then maybe it should be rewritten instead”.</p>
<h3>
Recipe: factor out functions</a></h3><p>Sometimes it's beneficial to replace a code piece with a function, like here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-7">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showPrimes(n) {
  nextPrime:
  for (let i = 2; i &lt; n; i++) {

    // check if i is a prime number
    for (let j = 2; j &lt; i; j++) {
      if (i % j == 0) continue nextPrime;
    }

    alert(i);
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>The better variant, with a factored out function <code>isPrime</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:4-30">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showPrimes(n) {

  for (let i = 2; i &lt; n; i++) {
    if (!isPrime(i)) continue;

    alert(i);
  }
}

function isPrime(n) {
  for (let i = 2; i &lt; n; i++) {
    if (n % i == 0) return false;
  }

  return true;
}</code></pre>
        </div>
      </div>
      
      </div><p>Now we can understand the code easily. The function itself becomes the comment. Such code is called <em>self-descriptive</em>.</p>
<h3>
Recipe: create functions</a></h3><p>And if we have a long “code sheet” like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// here we add whiskey
for(let i = 0; i &lt; 10; i++) {
  let drop = getWhiskey();
  smell(drop);
  add(drop, glass);
}

// here we add juice
for(let t = 0; t &lt; 3; t++) {
  let tomato = getTomato();
  examine(tomato);
  let juice = press(tomato);
  add(juice, glass);
}

// ...</code></pre>
        </div>
      </div>
      
      </div><p>Then it might be a better variant to refactor it into functions like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">addWhiskey(glass);
addJuice(glass);

function addWhiskey(container) {
  for(let i = 0; i &lt; 10; i++) {
    let drop = getWhiskey();
    //...
  }
}

function addJuice(container) {
  for(let t = 0; t &lt; 3; t++) {
    let tomato = getTomato();
    //...
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>Once again, functions themselves tell what's going on. There's nothing to comment. And also the code structure is better when split. It's clear what every function does, what it takes and what it returns.</p>
<p>In reality, we can't totally evade “explanatory” comments. There are complex algorithms. And there are smart “tweaks” for purposes of optimization. But generally we should try to keep the code simple and self-descriptive.</p>
<h2 id="chapter-185">
Good comments</h2>
<p>So, explanatory comments are usually bad. Which comments are good?</p>
<dl>
<dt>Describe the architecture</dt>
<dd>
<p>Provide a high-level overview of components, how they interact, what's the control flow in various situations… In short – the bird's eye view of the code. There's a special diagram language 
<a href="http://wikipedia.org/wiki/Unified_Modeling_Language">UML</a> for high-level architecture diagrams. Definitely worth studying.</p>
</dd>
<dt>Document a function usage</dt>
<dd>
<p>There's a special syntax 
<a href="http://en.wikipedia.org/wiki/JSDoc">JSDoc</a> to document a function: usage, parameters, returned value.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">/**
 * Returns x raised to the n-th power.
 *
 * @param {number} x The number to raise.
 * @param {number} n The power, must be a natural number.
 * @return {number} x raised to the n-th power.
 */
function pow(x, n) {
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>Such comments allow us to understand the purpose of the function and use it the right way without looking in its code.</p>
<p>By the way, many editors like 
<a href="https://www.jetbrains.com/webstorm/">WebStorm</a> can understand them as well and use them to provide autocomplete and some automatic code-checking.</p>
<p>Also, there are tools like 
<a href="https://github.com/jsdoc3/jsdoc">JSDoc 3</a> that can generate HTML-documentation from the comments. You can read more information about JSDoc at 
<a href="http://usejsdoc.org/">http://usejsdoc.org/</a>.</p>
</dd>
<dt>Why is the task solved this way?</dt>
<dd>
<p>What's written is important. But what's <em>not</em> written maybe even more important to understand what's going on. Why is the task solved exactly this way? The code gives no answer.</p>
<p>If there are many ways to solve the task, why this one? Especially when it's not the most obvious one.</p>
<p>Without such comments the following situation is possible:</p>
<ol>
<li>You (or your colleague) open the code written some time ago, and see that it's “suboptimal”.</li>
<li>You think: “How stupid I was then, and how much smarter I'm now”, and rewrite using the “more obvious and correct” variant.</li>
<li>…The urge to rewrite was good. But in the process you see that the “more obvious” solution is actually lacking. You even dimly remember why, because you already tried it long ago. You revert to the correct variant, but the time was wasted.</li>
</ol>
<p>Comments that explain the solution are very important. They help to continue development the right way.</p>
</dd>
<dt>Any subtle features of the code? Where they are used?</dt>
<dd>
<p>If the code has anything subtle and counter-obvious, it's definitely worth commenting.</p>
</dd>
</dl>
<h2 id="chapter-186">
Summary</h2>
<p>An important sign of a good developer is comments: their presence and even their absense.</p>
<p>Good comments allow us to maintain the code well, come back to it after a delay and use it more effectively.</p>
<p><strong>Comment this:</strong></p>
<ul>
<li>Overall architecture, high-level view.</li>
<li>Function usage.</li>
<li>Important solutions, especially when not immediately obvious.</li>
</ul>
<p><strong>Evade comments:</strong></p>
<ul>
<li>That tell “how code works” and “what it does”.</li>
<li>Put them only if it's impossible to make the code so simple and self-descriptive that it doesn't require those.</li>
</ul>
<p>Comments are also used for auto-documenting tools like JSDoc3: they read them and generate HTML-docs (or docs in another format).</p>

<h6 id="chapter-187"></h6>
<h1 class="main__header-title" id="chapter-188">Ninja code</h1>
<p>Programmer ninjas of the past used these tricks to make code maintainers cry.</p>
<p>Code review gurus look for them in test tasks.</p>
<p>Novice developers sometimes use them even better than programmer ninjas.</p>
<p>Read them carefully and find out who you are – a ninja, a novice, or maybe a code reviewer?</p>


<div class="important important_warn">
            <div class="important__header"><span class="important__type">Irony detected</span></div>
            <div class="important__content"><p>Many start following ninja paths. Few succeed.</p>
</div></div>
<h2 id="chapter-189">
Brevity is the soul of wit</h2>
<p>Make the code as short as possible. Show how smart you are.</p>
<p>Let subtle language features guide you.</p>
<p>For instance, take a look at this ternary operator <code>'?'</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// taken from a well-known javascript library
i = i ? i &lt; 0 ? Math.max(0, len + i) : i : 0;</code></pre>
        </div>
      </div>
      
      </div><p>Cool, right? If you write like that, the developer who comes across this line and tries to understand what is the value of <code>i</code> is going to have a merry time. Then come to you, seeking for an answer.</p>
<p>Tell him that shorter is always better. Initiate him into the paths of ninja.</p>
<h2 id="chapter-190">
One-letter variables</h2>
<blockquote class="quote"><div class="quote__i"><div class="quote__text"><p>The Dao hides in wordlessness. Only the Dao is well begun and well
completed.</p>
</div></div><footer class="quote__footer">
        <cite class="quote__author">Laozi (Tao Te Ching)</cite>
       </footer></blockquote><p>Another way to code faster (and much worse!) is to use single-letter variable names everywhere. Like <code>a</code>, <code>b</code> or <code>c</code>.</p>
<p>A short variable disappears in the code like a real ninja in the forest. No one will be able to find it using “search” of the editor. And even if someone does, he won't be able to “decipher” what the name <code>a</code> or <code>b</code> means.</p>
<p>…But there's an exception. A real ninja will never use <code>i</code> as the counter in a <code>"for"</code> loop. Anywhere, but not here. Look around, there are many more exotic letters. For instance, <code>x</code> or <code>y</code>.</p>
<p>An exotic variable as a loop counter is especially cool if the loop body takes 1-2 pages (make it longer if you can). Then if someone looks deep inside the loop, he won't be able to quickly figure out that the variable named <code>x</code> is the loop counter.</p>
<h2 id="chapter-191">
Use abbreviations</h2>
<p>If the team rules forbid the use of one-letter and vague names – shorten them, make abbreviations.</p>
<p>Like this:</p>
<ul>
<li><code>list</code> → <code>lst</code>.</li>
<li><code>userAgent</code> → <code>ua</code>.</li>
<li><code>browser</code> → <code>brsr</code>.</li>
<li>…etc</li>
</ul>
<p>Only the one with truly good intuition will be able to understand such names. Try to shorten everything. Only a worthy person should be able to uphold the development of your code.</p>
<h2 id="chapter-192">
Soar high. Be abstract.</h2>
<blockquote class="quote"><div class="quote__i"><div class="quote__text"><p>The great square is cornerless<br>
The great vessel is last complete,<br>
The great note is rarified sound,<br>
The great image has no form.</p>
</div></div><footer class="quote__footer">
        <cite class="quote__author">Laozi (Tao Te Ching)</cite>
       </footer></blockquote><p>While choosing a name try to use the most abstract word. Like <code>obj</code>, <code>data</code>, <code>value</code>, <code>item</code>, <code>elem</code> and so on.</p>
<ul>
<li>
<p><strong>The ideal name for a variable is <code>data</code>.</strong> Use it everywhere you can. Indeed, every variable holds <em>data</em>, right?</p>
<p>…But what to do if <code>data</code> is already taken? Try <code>value</code>, it's also universal. After all, a variable eventually gets a <em>value</em>.</p>
</li>
<li>
<p><strong>Name a variable by its type: <code>str</code>, <code>num</code>…</strong></p>
<p>Give them a try. A young ninja may wonder – do such names make the code worse? Actually, yes!</p>
<p>From one hand, the variable name still means something. It says what's inside the variable: a string, a number or something else. But when an outsider tries to understand the code, he'll be surprised to see that there's actually no information at all!</p>
<p>Indeed, the value type is easy to find out by debugging. But what's the meaning of the variable? Which string/number does it store? There's just no way to figure out without a good meditation!</p>
</li>
<li>
<p><strong>…But what if there are no more such names?</strong> Just add a number: <code>data1, item2, elem5</code>…</p>
</li>
</ul>
<h2 id="chapter-193">
Attention test</h2>
<p>Only a truly attentive programmer should be able to understand the code. But how to check that?</p>
<p><strong>One of the ways – use similar variable names, like <code>date</code> and <code>data</code>.</strong></p>
<p>Mix them where you can.</p>
<p>A quick read of such code becomes impossible. And when there's a typo… Ummm… We're stuck for long, time to drink tea.</p>
<h2 id="chapter-194">
Smart synonyms</h2>
<blockquote class="quote"><div class="quote__i"><div class="quote__text"><p>The hardest thing of all is to find a black cat in a dark room, especially if there is no cat.</p>
</div></div><footer class="quote__footer">
        <cite class="quote__author">Confucius</cite>
       </footer></blockquote><p>Using <em>similar</em> names for <em>same</em> things makes life more interesting and shows your creativity to the public.</p>
<p>For instance, consider function prefixes. If a function shows a message on the screen – start it with <code>display…</code>, like <code>displayMessage</code>. And then if another function shows on the screen something else, like a user name, start it with <code>show…</code> (like <code>showName</code>).</p>
<p>Insinuate that there's a subtle difference between such functions, while there is none.</p>
<p>Make a pact with fellow ninjas of the team: if John starts “showing” functions with <code>display...</code> in his code, then Peter could use <code>render..</code>, and Ann – <code>paint...</code>. Note how much more interesting and diverse the code became.</p>
<p>…And now the hat trick!</p>
<p>For two functions with important differences – use the same prefix!</p>
<p>For instance, the function <code>printPage(page)</code> will use a printer. And the function <code>printText(text)</code> will put the text on-screen. Let an unfamiliar reader think well over similarly named function <code>printMessage</code>: “Where does it put the message? To a printer or on the screen?”. To make it really shine, <code>printMessage(message)</code> should output it in the new window!</p>
<h2 id="chapter-195">
Reuse names</h2>
<blockquote class="quote"><div class="quote__i"><div class="quote__text"><p>Once the whole is divided, the parts<br>
need names.<br>
There are already enough names.<br>
One must know when to stop.</p>
</div></div><footer class="quote__footer">
        <cite class="quote__author">Laozi (Tao Te Ching)</cite>
       </footer></blockquote><p>Add a new variable only when absolutely necessary.</p>
<p>Instead, reuse existing names. Just write new values into them.</p>
<p>In a function try to use only variables passed as parameters.</p>
<p>That would make it really hard to identify what's exactly in the variable <em>now</em>. And also where it comes from. A person with weak intuition would have to analyze the code line-by-line and track the changes through every code branch.</p>
<p><strong>An advanced variant of the approach is to covertly (!) replace the value with something alike in the middle of a loop or a function.</strong></p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function ninjaFunction(elem) {
  // 20 lines of code working with elem

  elem = clone(elem);

  // 20 more lines, now working with the clone of the elem!
}</code></pre>
        </div>
      </div>
      
      </div><p>A fellow programmer who wants to work with <code>elem</code> in the second half of the function will be surprised… Only during the debugging, after examining the code he will find out that he's working with a clone!</p>
<p>Deadly effective even against an experienced ninja. Seen in code regularly.</p>
<h2 id="chapter-196">
Underscores for fun</h2>
<p>Put underscores <code>_</code> and <code>__</code> before variable names. Like <code>_name</code> or <code>__value</code>. It would be great if only you knew their meaning. Or, better, add them just for fun, without particular meaning at all. Or different meanings in different places.</p>
<p>You kill two rabbits with one shot. First, the code becomes longer and less readable, and the second, a fellow developer may spend a long time trying to figure out what the underscores mean.</p>
<p>A smart ninja puts underscores at one spot of code and evades them at other places. That makes the code even more fragile and increases the probability of future errors.</p>
<h2 id="chapter-197">
Show your love</h2>
<p>Let everyone see how magnificent your entities are! Names like <code>superElement</code>, <code>megaFrame</code> and <code>niceItem</code> will definitely enlighten a reader.</p>
<p>Indeed, from one hand, something is written: <code>super..</code>, <code>mega..</code>, <code>nice..</code> But from the other hand – that brings no details. A reader may decide to look for a hidden meaning and meditate for an hour or two.</p>
<h2 id="chapter-198">
Overlap outer variables</h2>
<blockquote class="quote"><div class="quote__i"><div class="quote__text"><p>When in the light, can't see anything in the darkness.<br>
When in the darkness, can see everything in the light.</p>
</div></div><footer class="quote__footer">
        <cite class="quote__author">Guan Yin Zi</cite>
       </footer></blockquote><p>Use same names for variables inside and outside a function. As simple. No efforts required.</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:4-8,3:6-10">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = authenticateUser();

function render() {
  let user = anotherValue();
  ...
  ...many lines...
  ...
  ... // &lt;-- a programmer wants to work with user here and...
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>A programmer who jumps inside the <code>render</code> will probably fail to notice that there's a local <code>user</code> shadowing the outer one.</p>
<p>Then he'll try to work with <code>user</code> assuming that it's the external variable, the result of <code>authenticateUser()</code>… The trap is sprung! Hello, debugger…</p>
<h2 id="chapter-199">
Side-effects everywhere!</h2>
<p>There are functions that look like they don't change anything. Like <code>isReady()</code>, <code>checkPermission()</code>, <code>findTags()</code>… They are assumed to carry out calculations, find and return the data, without changing anything outside of them. In other words, without “side-effects”.</p>
<p><strong>A really beautiful trick is to add a “useful” action to them, besides the main task.</strong></p>
<p>The expression of dazed surprise on the face of your colleague when he sees a function named <code>is..</code>, <code>check..</code> or <code>find...</code> changing something – will definitely broaden your boundaries of reason.</p>
<p><strong>Another way to surprise is to return a non-standard result.</strong></p>
<p>Show your original thinking! Let the call of <code>checkPermission</code> return not <code>true/false</code>, but a complex object with the results of the check.</p>
<p>Those developers who try to write <code>if (checkPermission(..))</code>, will wonder why it doesn't work. Tell them: “Read the docs!”. And give this article.</p>
<h2 id="chapter-200">
Powerful functions!</h2>
<blockquote class="quote"><div class="quote__i"><div class="quote__text"><p>The great Tao flows everywhere,<br>
both to the left and to the right.</p>
</div></div><footer class="quote__footer">
        <cite class="quote__author">Laozi (Tao Te Ching)</cite>
       </footer></blockquote><p>Don't limit the function by what's written in its name. Be broader.</p>
<p>For instance, a function <code>validateEmail(email)</code> could (besides checking the email for correctness) show an error message and ask to re-enter the email.</p>
<p>Additional actions should not be obvious from the function name. A true ninja coder will make them not obvious from the code as well.</p>
<p><strong>Joining several actions into one protects your code from reuse.</strong></p>
<p>Imagine, another developer wants only to check the email, and not output any message. Your function  <code>validateEmail(email)</code> that does both will not suit him. So he won't break your meditation by asking anything about it.</p>
<h2 id="chapter-201">
Summary</h2>
<p>All “pieces of advice” above are from the real code… Sometimes, written by experienced developers. Maybe even more experienced than you are ;)</p>
<ul>
<li>Follow some of them, and your code will become full of surprises.</li>
<li>Follow many of them, and your code will become truly yours, no one would want to change it.</li>
<li>Follow all, and your code will become a valuable lesson for young developers looking for enlightenment.</li>
</ul>

<h6 id="chapter-202"></h6>
<h1 class="main__header-title" id="chapter-203">Automated testing with mocha</h1>
<p>Automated testing will be used in further tasks.</p>
<p>It's actually a part of the “educational minimum” of a developer.</p>


<h2 id="chapter-204">
Why we need tests?</h2>
<p>When we write a function, we can usually imagine what it should do: which parameters give which results.</p>
<p>During development, we can check the function by running it and comparing the outcome with the expected one. For instance, we can do it in the console.</p>
<p>If something is wrong – then we fix the code, run again, check the result – and so on till it works.</p>
<p>But such manual “re-runs” are imperfect.</p>
<p><strong>When testing a code by manual re-runs, it's easy to miss something.</strong></p>
<p>For instance, we're creating a function <code>f</code>. Wrote some code, testing: <code>f(1)</code> works, but <code>f(2)</code> doesn't work. We fix the code and now <code>f(2)</code> works. Looks complete? But we forgot to re-test <code>f(1)</code>. That may lead to an error.</p>
<p>That's very typical. When we develop something, we keep a lot of possible use cases in mind. But it's hard to expect a programmer to check all of them manually after every change. So it becomes easy to fix one thing and break another one.</p>
<p><strong>Automated testing means that tests are written separately, in addition to the code. They can be executed easily and check all the main use cases.</strong></p>
<h2 id="chapter-205">
Behavior Driven Development (BDD)</h2>
<p>Let's use a technique named 
<a href="http://en.wikipedia.org/wiki/Behavior-driven_development">Behavior Driven Development</a> or, in short, BDD. That approach is used among many projects. BDD is not just about testing. That's more.</p>
<p><strong>BDD is three things in one: tests AND documentation AND examples.</strong></p>
<p>Enough words. Let's see the example.</p>
<h2 id="chapter-206">
Development of “pow”: the spec</h2>
<p>Let's say we want to make a function <code>pow(x, n)</code> that raises <code>x</code> to an integer power <code>n</code>. We assume that <code>n≥0</code>.</p>
<p>That task is just an example: there's the <code>**</code> operator in JavaScript that can do that, but here we concentrate on the development flow that can be applied to more complex tasks as well.</p>
<p>Before creating the code of <code>pow</code>, we can imagine what the function should do and describe it.</p>
<p>Such description is called a <em>specification</em> or, in short, a spec, and looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("pow", function() {

  it("raises to n-th power", function() {
    assert.equal(pow(2, 3), 8);
  });

});</code></pre>
        </div>
      </div>
      
      </div><p>A spec has three main building blocks that you can see above:</p>
<dl>
<dt><code>describe("title", function() { ... })</code></dt>
<dd>
<p>What functionality we're describing. Uses to group “workers” – the <code>it</code> blocks. In our case we're describing the function <code>pow</code>.</p>
</dd>
<dt><code>it("title", function() { ... })</code></dt>
<dd>
<p>In the title of <code>it</code> we <em>in a human-readable way</em> describe the particular use case, and the second argument is a function that tests it.</p>
</dd>
<dt><code>assert.equal(value1, value2)</code></dt>
<dd>
<p>The code inside <code>it</code> block, if the implementation is correct, should execute without errors.</p>
<p>Functions <code>assert.*</code> are used to check whether <code>pow</code> works as expected. Right here we're using one of them – <code>assert.equal</code>, it compares arguments and yields an error if they are not equal. Here it checks that the result of <code>pow(2, 3)</code> equals <code>8</code>.</p>
<p>There are other types of comparisons and checks that we'll see further.</p>
</dd>
</dl>
<h2 id="chapter-207">
The development flow</h2>
<p>The flow of development usually looks like this:</p>
<ol>
<li>An initial spec is written, with tests for the most basic functionality.</li>
<li>An initial implementation is created.</li>
<li>To check whether it works, we run the testing framework 
<a href="http://mochajs.org/">Mocha</a> (more details soon) that runs the spec. Errors are displayed. We make corrections until everything works.</li>
<li>Now we have a working initial implementation with tests.</li>
<li>We add more use cases to the spec, probably not yet supported by the implementations. Tests start to fail.</li>
<li>Go to 3, update the implementation till tests give no errors.</li>
<li>Repeat steps 3-6 till the functionality is ready.</li>
</ol>
<p>So, the development is <em>iterative</em>. We write the spec, implement it, make sure tests pass, then write more tests, make sure they work etc. At the end we have both a working implementation and tests for it.</p>
<p>In our case, the first step is complete: we have an initial spec for <code>pow</code>. So let's make an implementation. But before that let's make a “zero” run of the spec, just to see that tests are working (they will all fail).</p>
<h2 id="chapter-208">
The spec in action</h2>
<p>Here in the tutorial we'll be using the following JavaScript libraries for tests:</p>
<ul>
<li>
<a href="http://mochajs.org/">Mocha</a> – the core framework: it provides common testing functions including <code>describe</code> and <code>it</code> and the main function that runs tests.</li>
<li>
<a href="http://chaijs.com">Chai</a> – the library with many assertions. It allows to use a lot of different assertions, for now we need only <code>assert.equal</code>.</li>
<li>
<a href="http://sinonjs.org/">Sinon</a> – a library to spy over functions, emulate built-in functions and more, we'll need it much later.</li>
</ul>
<p>These libraries are suitable for both in-browser and server-side testing. Here we'll consider the browser variant.</p>
<p>The full HTML page with these frameworks and <code>pow</code> spec:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;!-- add mocha css, to show results --&gt;
  &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.css"&gt;
  &lt;!-- add mocha framework code --&gt;
  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    mocha.setup('bdd'); // minimal setup
  &lt;/script&gt;
  &lt;!-- add chai --&gt;
  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    // chai has a lot of stuff, let's make assert global
    let assert = chai.assert;
  &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;script&gt;
    function pow(x, n) {
      /* function code is to be written, empty now */
    }
  &lt;/script&gt;

  &lt;!-- the script with tests (describe, it...) --&gt;
  &lt;script src="test.js"&gt;&lt;/script&gt;

  &lt;!-- the element with id="mocha" will contain test results --&gt;
  &lt;div id="mocha"&gt;&lt;/div&gt;

  &lt;!-- run tests! --&gt;
  &lt;script&gt;
    mocha.run();
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The page can be divided into four parts:</p>
<ol>
<li>The <code>&lt;head&gt;</code> – add third-party libraries and styles for tests.</li>
<li>The <code>&lt;script&gt;</code> with the function to test, in our case – with the code for <code>pow</code>.</li>
<li>The tests – in our case an external script <code>test.js</code> that has <code>describe("pow", ...)</code> from above.</li>
<li>The HTML element <code>&lt;div id="mocha"&gt;</code> will be used by Mocha to output results.</li>
<li>The tests are started by the command <code>mocha.run()</code>.</li>
</ol>
<p>The result:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/DpoIGQujfeZhebARG4Jo?p=preview" target="_blank" title="open in sandbox" data-plunk-id="DpoIGQujfeZhebARG4Jo" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://en.js.cx/article/testing-mocha/pow-1/"></iframe>
  </div><p>As of now, the test fails, there's an error. That's logical: we have an empty function code in <code>pow</code>, so <code>pow(2,3)</code> returns <code>undefined</code> instead of <code>8</code>.</p>
<p>For the future, let's note that there are advanced test-runners, like 
<a href="https://karma-runner.github.io/">karma</a> and others. So it's generally not a problem to setup many different tests.</p>
<h2 id="chapter-209">
Initial implementation</h2>
<p>Let's make a simple implementation of <code>pow</code>, for tests to pass:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow() {
  return 8; // :) we cheat!
}</code></pre>
        </div>
      </div>
      
      </div><p>Wow, now it works!</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/QghJUoiN8jFtVfljQXNC?p=preview" target="_blank" title="open in sandbox" data-plunk-id="QghJUoiN8jFtVfljQXNC" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://en.js.cx/article/testing-mocha/pow-min/"></iframe>
  </div><h2 id="chapter-210">
Improving the spec</h2>
<p>What we've done is definitely a cheat. The function does not work: an attempt to calculate <code>pow(3,4)</code> would give an incorrect result, but tests pass.</p>
<p>…But the situation is quite typical, it happens in practice. Tests pass, but the function works wrong. Our spec is imperfect. We need to add more use cases to it.</p>
<p>Let's add one more test to see if <code>pow(3, 4) = 81</code>.</p>
<p>We can select one of two ways to organize the test here:</p>
<ol>
<li>
<p>The first variant – add one more <code>assert</code> into the same <code>it</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("pow", function() {

  it("raises to n-th power", function() {
    assert.equal(pow(2, 3), 8);
    assert.equal(pow(3, 4), 81);
  });

});</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>The second – make two tests:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("pow", function() {

  it("2 raised to power 3 is 8", function() {
    assert.equal(pow(2, 3), 8);
  });

  it("3 raised to power 3 is 27", function() {
    assert.equal(pow(3, 3), 27);
  });

});</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>The principal difference is that when <code>assert</code> triggers an error, the <code>it</code> block immediately terminates. So, in the first variant if the first <code>assert</code> fails, then we'll never see the result of the second <code>assert</code>.</p>
<p>Making tests separate is useful to get more information about what's going on, so the second variant is better.</p>
<p>And besides that, there's one more rule that's good to follow.</p>
<p><strong>One test checks one thing.</strong></p>
<p>If we look at the test and see two independent checks in it, it's better to split it into two simpler ones.</p>
<p>So let's continue with the second variant.</p>
<p>The result:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/DEzWwmbmQqejOw0CX48A?p=preview" target="_blank" title="open in sandbox" data-plunk-id="DEzWwmbmQqejOw0CX48A" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://en.js.cx/article/testing-mocha/pow-2/"></iframe>
  </div><p>As we could expect, the second test failed. Sure, our function always returns <code>8</code>, while the <code>assert</code> expects <code>27</code>.</p>
<h2 id="chapter-211">
Improving the implementation</h2>
<p>Let's write something more real for tests to pass:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  let result = 1;

  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }

  return result;
}</code></pre>
        </div>
      </div>
      
      </div><p>To be sure that the function works well, let's test it for more values. Instead of writing <code>it</code> blocks manually, we can generate them in <code>for</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("pow", function() {

  function makeTest(x) {
    let expected = x * x * x;
    it(`${x} in the power 3 is ${expected}`, function() {
      assert.equal(pow(x, 3), expected);
    });
  }

  for (let x = 1; x &lt;= 5; x++) {
    makeTest(x);
  }

});</code></pre>
        </div>
      </div>
      
      </div><p>The result:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/l87TGEgMxDS4bLYxNmbk?p=preview" target="_blank" title="open in sandbox" data-plunk-id="l87TGEgMxDS4bLYxNmbk" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://en.js.cx/article/testing-mocha/pow-3/"></iframe>
  </div><h2 id="chapter-212">
Nested describe</h2>
<p>We're going to add even more tests. But before that let's note that the helper function <code>makeTest</code> and <code>for</code> should be grouped together. We won't need <code>makeTest</code> in other tests, it's needed only in <code>for</code>: their common task is to check how <code>pow</code> raises into the given power.</p>
<p>Grouping is done with a nested <code>describe</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2,15-15">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("pow", function() {

  describe("raises x to power n", function() {

    function makeTest(x) {
      let expected = x * x * x;
      it(`${x} in the power 3 is ${expected}`, function() {
        assert.equal(pow(x, 3), expected);
      });
    }

    for (let x = 1; x &lt;= 5; x++) {
      makeTest(x);
    }

  });

  // ... more tests to follow here, both describe and it can be added
});</code></pre>
        </div>
      </div>
      
      </div><p>The nested <code>describe</code> defines a new “subgroup” of tests. In the output we can see the titled indentation:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/l3pTGpRdjaZCWJ3fCr0e?p=preview" target="_blank" title="open in sandbox" data-plunk-id="l3pTGpRdjaZCWJ3fCr0e" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://en.js.cx/article/testing-mocha/pow-4/"></iframe>
  </div><p>In the future we can add more <code>it</code> and <code>describe</code> on the top level with helper functions of their own, they won't see <code>makeTest</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>before/after</code> and <code>beforeEach/afterEach</code></span></div>
            <div class="important__content"><p>We can setup <code>before/after</code> functions that execute before/after running tests, and also <code>beforeEach/afterEach</code> functions that execute before/after <em>every</em> <code>it</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("test", function() {

  before(() =&gt; alert("Testing started – before all tests"));
  after(() =&gt; alert("Testing finished – after all tests"));

  beforeEach(() =&gt; alert("Before a test – enter a test"));
  afterEach(() =&gt; alert("After a test – exit a test"));

  it('test 1', () =&gt; alert(1));
  it('test 2', () =&gt; alert(2));

});</code></pre>
        </div>
      </div>
      
      </div><p>The running sequence will be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">Testing started – before all tests (before)
Before a test – enter a test (beforeEach)
1
After a test – exit a test   (afterEach)
Before a test – enter a test (beforeEach)
2
After a test – exit a test   (afterEach)
Testing finished – after all tests (after)</code></pre>
        </div>
      </div>
      
      </div><p>
<a class="edit" target="_blank" href="http://plnkr.co/edit/LNHgyY9xlBiPYKuPBEfl?p=preview">Open the example in the sandbox.</a></p><p>Usually, <code>beforeEach/afterEach</code> (<code>before/each</code>) are used to perform initialization, zero out counters or do something else between the tests (or test groups).</p>
</div></div>
<h2 id="chapter-213">
Extending the spec</h2>
<p>The basic functionality of <code>pow</code> is complete. The first iteration of the development is done. When we're done celebrating and drinking champagne – let's go on and improve it.</p>
<p>As it was said, the function <code>pow(x, n)</code> is meant to work with positive integer values <code>n</code>.</p>
<p>To indicate a mathematical error, JavaScript functions usually return <code>NaN</code>. Let's do the same for invalid values of <code>n</code>.</p>
<p>Let's first add the behavior to the spec(!):</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5,9-9">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("pow", function() {

  // ...

  it("for negative n the result is NaN", function() {
    assert.isNaN(pow(2, -1));
  });

  it("for non-integer n the result is NaN", function() {
    assert.isNaN(pow(2, 1.5));
  });

});</code></pre>
        </div>
      </div>
      
      </div><p>The result with new tests:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/sEEU3SBRyEWT5rNFYm3f?p=preview" target="_blank" title="open in sandbox" data-plunk-id="sEEU3SBRyEWT5rNFYm3f" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:530px" src="https://en.js.cx/article/testing-mocha/pow-nan/"></iframe>
  </div><p>The newly added tests fail, because our implementation does not support them. That's how BDD is done: first we write failing tests, and then make an implementation for them.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Other assertions</span></div>
            <div class="important__content"><p>Please note the assertion <code>assert.isNaN</code>: it checks for <code>NaN</code>.</p>
<p>There are other assertions in Chai as well, for instance:</p>
<ul>
<li><code>assert.equal(value1, value2)</code> – checks the equality  <code>value1 == value2</code>.</li>
<li><code>assert.strictEqual(value1, value2)</code> – checks the strict equality <code>value1 === value2</code>.</li>
<li><code>assert.notEqual</code>, <code>assert.notStrictEqual</code> – inverse checks to the ones above.</li>
<li><code>assert.isTrue(value)</code> – checks that <code>value === true</code></li>
<li><code>assert.isFalse(value)</code> – checks that <code>value === false</code></li>
<li>…the full list is in the 
<a href="http://chaijs.com/api/assert/">docs</a></li>
</ul>
</div></div>
<p>So we should add a couple of lines to <code>pow</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  if (n &lt; 0) return NaN;
  if (Math.round(n) != n) return NaN;

  let result = 1;

  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }

  return result;
}</code></pre>
        </div>
      </div>
      
      </div><p>Now it works, all tests pass:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/JrEQGLs7A5HStqLVDMPD?p=preview" target="_blank" title="open in sandbox" data-plunk-id="JrEQGLs7A5HStqLVDMPD" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/article/testing-mocha/pow-full/"></iframe>
  </div><p>
<a class="edit" target="_blank" href="http://plnkr.co/edit/JrEQGLs7A5HStqLVDMPD?p=preview">Open the full final example in the sandbox.</a></p><h2 id="chapter-214">
Summary</h2>
<p>In BDD, the spec goes first, followed by implementation. At the end we have both the spec and the code.</p>
<p>The spec can be used in three ways:</p>
<ol>
<li><strong>Tests</strong> guarantee that the code works correctly.</li>
<li><strong>Docs</strong> – the titles of <code>describe</code> and <code>it</code> tell what the function does.</li>
<li><strong>Examples</strong> – the tests are actually working examples showing how a function can be used.</li>
</ol>
<p>With the spec, we can safely improve, change, even rewrite the function from scratch and make sure it still works right.</p>
<p>That's especially important in large projects when a function is used in many places. When we change such a function, there's just no way to manually check if every place that uses it still works right.</p>
<p>Without tests, people have two ways:</p>
<ol>
<li>To perform the change, no matter what. And then our users meet bugs and report them. If we can afford that.</li>
<li>Or people become afraid to modify such functions, if the punishment for errors is harsh. Then it becomes old, overgrown with cobwebs, no one wants to get into it, and that's not good.</li>
</ol>
<p><strong>Automatically tested code is contrary to that!</strong></p>
<p>If the project is covered with tests, there's just no such problem. We can run tests and see a lot of checks made in a matter of seconds.</p>
<p><strong>Besides, a well-tested code has better architecture.</strong></p>
<p>Naturally, that's because it's easier to change and improve it. But not only that.</p>
<p>To write tests, the code should be organized in such a way that every function has a clearly described task, well-defined input and output. That means a good architecture from the beginning.</p>
<p>In real life that's sometimes not that easy. Sometimes it's difficult to write a spec before the actual code, because it's not yet clear how it should behave. But in general writing tests makes development faster and more stable.</p>
<h2 id="chapter-215">
What now?</h2>
<p>Later in the tutorial you will meet many tasks with tests baked-in. So you'll see more practical examples.</p>
<p>Writing tests requires good JavaScript knowledge. But we're just starting to learn it. So, to settle down everything, as of now you're not required to write tests, but you should already be able to read them even if they are a little bit more complex than in this chapter.</p>
<div class="tasks"><h2 id="chapter-216" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-s-wrong-in-the-test" name="what-s-wrong-in-the-test" class="main__anchor">What's wrong in the test?</a></h3>
<a href="http://javascript.info/task/pow-test-wrong" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What's wrong in the test of <code>pow</code> below?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">it("Raises x to the power n", function() {
  let x = 5;

  let result = x;
  assert.equal(pow(x, 1), result);

  result *= x;
  assert.equal(pow(x, 2), result);

  result *= x;
  assert.equal(pow(x, 3), result);
});</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Syntactically the test is correct and passes.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The test demonstrates one of the temptations a developer meets when writing tests.</p>
<p>What we have here is actually 3 tests, but layed out as a single function with 3 asserts.</p>
<p>Sometimes it's easier to write this way, but if an error occurs, it's much less obvious what went wrong.</p>
<p>If an error happens inside a complex execution flow, then we'll have to figure out the data at that point. We'll actually have to <em>debug the test</em>.</p>
<p>It would be much better to break the test into multiple <code>it</code> blocks with clearly written inputs and outputs.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("Raises x to power n", function() {
  it("5 in the power of 1 equals 5", function() {
    assert.equal(pow(5, 1), 5);
  });

  it("5 in the power of 2 equals 25", function() {
    assert.equal(pow(5, 2), 25);
  });

  it("5 in the power of 3 equals 125", function() {
    assert.equal(pow(5, 3), 125);
  });
});</code></pre>
        </div>
      </div>
      
      </div><p>We replaced the single <code>it</code> with <code>describe</code> and a group of <code>it</code> blocks. Now if something fails we would see clearly what the data was.</p>
<p>Also we can isolate a single test and run it in standalone mode by writing <code>it.only</code> instead of <code>it</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-8">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">describe("Raises x to power n", function() {
  it("5 in the power of 1 equals 5", function() {
    assert.equal(pow(5, 1), 5);
  });

  // Mocha will run only this block
  it.only("5 in the power of 2 equals 25", function() {
    assert.equal(pow(5, 2), 25);
  });

  it("5 in the power of 3 equals 125", function() {
    assert.equal(pow(5, 3), 125);
  });
});</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-217"></h6>
<h1 class="main__header-title" id="chapter-218">Polyfills</h1>
<p>The JavaScript language steadily evolves. New proposals to the language appear regularly, they are analyzed and, if considered worthy, are appended to the list at 
<a href="https://tc39.github.io/ecma262/">https://tc39.github.io/ecma262/</a> and then progress to the 
<a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">specification</a>.</p>
<p>Teams behind JavaScript engines have their own ideas about what to implement first. They may decide to implement proposals that are in draft and postpone things that are already in the spec, because they are less interesting or just harder to do.</p>
<p>So it's quite common for an engine to implement only the part of the standard.</p>
<p>A good page to see the current state of support for language features is 
<a href="https://kangax.github.io/compat-table/es6/">https://kangax.github.io/compat-table/es6/</a> (it's big, we have a lot to study yet).</p>
<h2 id="chapter-219">
Babel</h2>
<p>When we use modern features of the language, some engines may fail to support such code. Just as said, not all features are implemented everywhere.</p>
<p>Here Babel comes to the rescue.</p>
<p>
<a href="https://babeljs.io">Babel</a> is a 
<a href="https://en.wikipedia.org/wiki/Source-to-source_compiler">transpiler</a>. It rewrites modern JavaScript code into the previous standard.</p>
<p>Actually, there are two parts in Babel:</p>
<ol>
<li>
<p>First, the transpiler program, which rewrites the code. The developer runs it on his own computer. It rewrites the code into the older standard. And then the code is delivered to the website for users. Modern project build system like 
<a href="http://webpack.github.io/">webpack</a> or 
<a href="http://brunch.io/">brunch</a> provide means to run transpiler automatically on every code change, so that doesn't involve any time loss from our side.</p>
</li>
<li>
<p>Second, the polyfill.</p>
<p>The transpiler rewrites the code, so syntax features are covered. But for new functions we need to write a special script that implements them. JavaScript is a highly dynamic language, scripts may not just add new functions, but also modify built-in ones, so that they behave according to the modern standard.</p>
<p>There's a term “polyfill” for scripts that “fill in” the gap and add missing implementations.</p>
<p>Two interesting polyfills are:</p>
<ul>
<li>
<a href="https://babeljs.io/docs/usage/polyfill/">babel polyfill</a> that supports a lot, but is big.</li>
<li>
<a href="http://polyfill.io">polyfill.io</a> service that allows to load/construct polyfills on-demand, depending on the features we need.</li>
</ul>
</li>
</ol>
<p>So, we need to setup the transpiler and add the polyfill for old engines to support modern features.</p>
<p>If we orient towards modern engines and do not use features except those supported everywhere, then we don't need to use Babel.</p>
<h2 id="chapter-220">
Examples in the tutorial</h2>
<p>Most examples are runnable at-place, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('Press the "Play" button in the upper-right corner to run');</code></pre>
        </div>
      </div>
      
      </div><p>Examples that use modern JS will work only if your browser supports it.</p>
<p>
<a href="https://www.google.com/chrome/browser/canary.html">Chrome Canary</a> is good for all examples, but other modern browsers are mostly fine too.</p>
<p>Note that on production we can use Babel to translate the code into suitable for less recent browsers, so there will be no such limitation, the code will run everywhere.</p>

<h6 id="chapter-221"></h6>
<h1 class="main__header-title" id="chapter-222">Objects: the basics</h1>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/object" class="lessons-list__link">Objects</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/garbage-collection" class="lessons-list__link">Garbage collection</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/symbol" class="lessons-list__link">Symbol type</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/object-methods" class="lessons-list__link">Object methods, "this"</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/object-toprimitive" class="lessons-list__link">Object to primitive conversion</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/constructor-new" class="lessons-list__link">Constructor, operator "new"</a></li></ol></div>



<h6 id="chapter-223"></h6>
<h1 class="main__header-title" id="chapter-224">Objects</h1>
<p>As we know from the chapter 
<a href="http://javascript.info/types">Data types</a>, there are seven language types in JavaScript. Six of them are called “primitive”, because their values contain only a single thing (be it a string or a number or whatever).</p>
<p>In contrast, objects are used to store keyed collections of various data and more complex entities. In JavaScript, objects penetrate almost every aspect of the language. So we must understand them first before going in-depth anywhere else.</p>


<p>An object can be created with figure brackets <code>{…}</code> with an optional list of <em>properties</em>. A property is a “key: value” pair, where <code>key</code> is a string (also called a “property name”), and <code>value</code> can be anything.</p>
<p>We can imagine an object as a cabinet with signed files. Every piece of data is stored in it's file by the key. It's easy to find a file by it's name or add/remove a file.</p>
      <img src="http://javascript.info/article/object/object.png">
<p>An empty object (“empty cabinet”) can be created using one of two syntaxes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = new Object(); // "object constructor" syntax
let user = {};  // "object literal" syntax</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/object/object-user-empty.png"&gt;
<p>Usually, the figure brackets <code>{...}</code> are used. That declaration is called an <em>object literal</em>.</p>
<h2 id="chapter-225">
Literals and properties</h2>
<p>We can immediately put some properties into <code>{...}</code> as “key: value” pairs:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {     // an object
  name: "John",  // by key "name" store value "John"
  age: 30        // by key "age" store value 30
};</code></pre>
        </div>
      </div>
      
      </div><p>A property has a key (also known as “name” or “identifier”) before the colon <code>":"</code> and a value to the right of it.</p>
<p>In the <code>user</code> object, there are two properties:</p>
<ol>
<li>The first property has the name <code>"name"</code> and the value <code>"John"</code>.</li>
<li>The second one has the name <code>"age"</code> and the value <code>30</code>.</li>
</ol>
<p>The resulting <code>user</code> object can be imagined as a cabinet with two signed files labeled “name” and “age”.</p>
      <img src="http://javascript.info/article/object/object-user.png">
<p>We can add, remove and read files from it any time.</p>
<p>Property values are accessible using the dot notation:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// get fields of the object:
alert( user.name ); // John
alert( user.age ); // 30</code></pre>
        </div>
      </div>
      
      </div><p>The value can be of any type. Let's add a boolean one:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">user.isAdmin = true;</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/object/object-user-isadmin.png"&gt;
<p>To remove a property, we can use <code>delete</code> operator:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">delete user.age;</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/object/object-user-delete.png"&gt;
<p>We can also use multiword property names, but then they must be quoted:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30,
  "likes birds": true  // multiword property name must be quoted
};</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/object/object-user-props.png"&gt;
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Trailing comma</span></div>
            <div class="important__content"><p>The last property in the list may end with a comma:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:9-10">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30,
}</code></pre>
        </div>
      </div>
      
      </div><p>That is called a “trailing” or “hanging” comma. Makes it easier to add/remove/move around properties, because all lines become alike.</p>
</div></div>
<h2 id="chapter-226">
Square brackets</h2>
<p>For multiword properties, the dot access doesn't work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// this would give a syntax error
user.likes birds = true</code></pre>
        </div>
      </div>
      
      </div><p>That's because the dot requires the key to be a valid variable identifier. That is: no spaces and other limitations.</p>
<p>There's an alternative “square bracket notation” that works with any string:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {};

// set
user["likes birds"] = true;

// get
alert(user["likes birds"]); // true

// delete
delete user["likes birds"];</code></pre>
        </div>
      </div>
      
      </div><p>Now everything is fine. Please note that the string inside the brackets is properly quoted (any type of quotes will do).</p>
<p>Square brackets also provide a way to obtain the property name as the result of any expression – as opposed to a literal string – like from a variable as follows:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let key = "likes birds";

// same as user["likes birds"] = true;
user[key] = true;</code></pre>
        </div>
      </div>
      
      </div><p>Here, the variable <code>key</code> may be calculated at run-time or depend on the user input. And then we use it to access the property. That gives us a great deal of flexibility. The dot notation cannot be used in a similar way.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30
};

let key = prompt("What do you want to know about the user?", "name");

// access by variable
alert( user[key] ); // John (if enter "name")</code></pre>
        </div>
      </div>
      
      </div><h3>
Computed properties</a></h3><p>We can use square brackets in an object literal. That's called <em>computed properties</em>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruit = prompt("Which fruit to buy?", "apple");

let bag = {
  [fruit]: 5, // the name of the property is taken from the variable fruit
};

alert( bag.apple ); // 5 if fruit="apple"</code></pre>
        </div>
      </div>
      
      </div><p>The meaning of a computed property is simple: <code>[fruit]</code> means that the property name should be taken from <code>fruit</code>.</p>
<p>So, if a visitor enters <code>"apple"</code>, <code>bag</code> will become <code>{apple: 5}</code>.</p>
<p>Essentially, that works the same as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruit = prompt("Which fruit to buy?", "apple");
let bag = {};

// take property name from the fruit variable
bag[fruit] = 5;</code></pre>
        </div>
      </div>
      
      </div><p>…But looks nicer.</p>
<p>We can use more complex expressions inside square brackets:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruit = 'apple';
let bag = {
  [fruit + 'Computers']: 5 // bag.appleComputers = 5
};</code></pre>
        </div>
      </div>
      
      </div><p>Square brackets are much more powerful than the dot notation. They allow any property names and variables. But they are also more cumbersome to write.</p>
<p>So most of the time, when property names are known and simple, the dot is used. And if we need something more complex, then we switch to square brackets.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Reserved words are allowed as property names</span></div>
            <div class="important__content"><p>A variable cannot have a name equal to one of language-reserved words like “for”, “let”, “return” etc.</p>
<p>But for an object property, there's no such restriction. Any name is fine:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {
  for: 1,
  let: 2,
  return: 3
}

alert( obj.for + obj.let + obj.return );  // 6</code></pre>
        </div>
      </div>
      
      </div><p>Basically, any name is allowed, but there's a special one: <code>"__proto__"</code> that gets special treatment for historical reasons. For instance, we can't set it to a non-object value:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {};
obj.__proto__ = 5;
alert(obj.__proto__); // [object Object], didn't work as intended</code></pre>
        </div>
      </div>
      
      </div><p>As we see from the code, the assignment to a primitive <code>5</code> is ignored.</p>
<p>That can become a source of bugs and even vulnerabilies if we intent to store arbitrary key-value pairs in an object, and allow a visitor to specify the keys.</p>
<p>In that case the visitor may choose “<strong>proto</strong>” as the key, and the assignment logic will be ruined (as shown above).</p>
<p>There exist a way to make objects treat <code>__proto__</code> as a regular property, we'll cover it later, but first we need to know more about objects to understand it.
There's another data structure 
<a href="http://javascript.info/map-set-weakmap-weakset">Map</a>, that we'll learn in the chapter 
<a href="http://javascript.info/map-set-weakmap-weakset">Map, Set, WeakMap and WeakSet</a>, which supports arbitrary keys. Also</p>
</div></div>
<h2 id="chapter-227">
Property value shorthand</h2>
<p>In real code we often use existing variables as values for property names.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeUser(name, age) {
  return {
    name: name,
    age: age
    // ...other properties
  };
}

let user = makeUser("John", 30);
alert(user.name); // John</code></pre>
        </div>
      </div>
      
      </div><p>In the example above, properties have the same names as variables. The use-case of making a property from a variable is so common, that there's a special <em>property value shorthand</em> to make it shorter.</p>
<p>Instead of <code>name:name</code> we can just write <code>name</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeUser(name, age) {
  return {
    name, // same as name: name
    age   // same as age: age
    // ...
  };
}</code></pre>
        </div>
      </div>
      
      </div><p>We can use both normal properties and shorthands in the same object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name,  // same as name:name
  age: 30
};</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-228">
Existence check</h2>
<p>A notable objects feature is that it's possible to access any property. There will be no error if the property doesn't exist! Accessing a non-existing property just returns <code>undefined</code>. It provides a very common way to test whether the property exists – to get it and compare vs undefined:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {};

alert( user.noSuchProperty === undefined ); // true means "no such property"</code></pre>
        </div>
      </div>
      
      </div><p>There also exists a special operator <code>"in"</code> to check for the existence of a property.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">"key" in object</code></pre>
        </div>
      </div>
      
      </div><p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: "John", age: 30 };

alert( "age" in user ); // true, user.age exists
alert( "blabla" in user ); // false, user.blabla doesn't exist</code></pre>
        </div>
      </div>
      
      </div><p>Please note that on the left side of <code>in</code> there must be a <em>property name</em>. That's usually a quoted string.</p>
<p>If we omit quotes, that would mean a variable containing the actual name to be tested. For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:7-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { age: 30 };

let key = "age";
alert( key in user ); // true, takes the name from key and checks for such property</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Using “in” for properties that store <code>undefined</code></span></div>
            <div class="important__content"><p>Usually, the strict comparison <code>"=== undefined"</code> check works fine. But there's a special case when it fails, but <code>"in"</code> works correctly.</p>
<p>It's when an object property exists, but stores <code>undefined</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {
  test: undefined
};

alert( obj.test ); // it's undefined, so - no such property?

alert( "test" in obj ); // true, the property does exist!</code></pre>
        </div>
      </div>
      
      </div><p>In the code above, the property <code>obj.test</code> technically exists. So the <code>in</code> operator works right.</p>
<p>Situations like this happen very rarely, because <code>undefined</code> is usually not assigned. We mostly use <code>null</code> for “unknown” or “empty” values. So the <code>in</code> operator is an exotic guest in the code.</p>
</div></div>
<h2 id="chapter-229">
The “for…in” loop</h2>
<p>To walk over all keys of an object, there exists a special form of the loop: <code>for..in</code>. This is a completely different thing from the <code>for(;;)</code> construct that we studied before.</p>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for(key in object) {
  // executes the body for each key among object properties
}</code></pre>
        </div>
      </div>
      
      </div><p>For instance, let's output all properties of <code>user</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30,
  isAdmin: true
};

for(let key in user) {
  // keys
  alert( key );  // name, age, isAdmin
  // values for the keys
  alert( user[key] ); // John, 30, true
}</code></pre>
        </div>
      </div>
      
      </div><p>Note that all “for” constructs allow us to declare the looping variable inside the loop, like <code>let key</code> here.</p>
<p>Also, we could use another variable name here instead of <code>key</code>. For instance, <code>"for(let prop in obj)"</code> is also widely used.</p>
<h3>
Ordered like an object</a></h3><p>Are objects ordered? In other words, if we loop over an object, do we get all properties in the same order that they are added in it? Can we rely on it?</p>
<p>The short answer is: “ordered in a special fashion”: integer properties are sorted, others appear in creation order. The details follow.</p>
<p>As an example, let's consider an object with the phone codes:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let codes = {
  "49": "Germany",
  "41": "Switzerland",
  "44": "Great Britain",
  // ..,
  "1": "USA"
};

for(let code in codes) {
  alert(code); // 1, 41, 44, 49
}</code></pre>
        </div>
      </div>
      
      </div><p>The object may be used to suggest a list of options to the user. If we're making a site mainly for German audience then we probably want <code>49</code> to be the first.</p>
<p>But if we run the code, we see a totally different picture:</p>
<ul>
<li>USA (1) goes first</li>
<li>then Switzerland (41) and so on.</li>
</ul>
<p>The phone codes go in the ascending sorted order, because they are integers. So we see <code>1, 41, 44, 49</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Integer properties? What's that?</span></div>
            <div class="important__content"><p>The “integer property” term here means a string that can be converted to-and-from an integer without a change.</p>
<p>So, “49” is an integer property name, because when it's transformed to an integer number and back, it's still the same. But “+49” and “1.2” are not:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Math.trunc is a built-in function that removes the decimal part
alert( String(Math.trunc(Number("49"))) ); // "49", same, integer property
alert( String(Math.trunc(Number("+49"))) ); // "49", not same ⇒ not integer property
alert( String(Math.trunc(Number("1.2"))) ); // "1", not same ⇒ not integer property</code></pre>
        </div>
      </div>
      
      </div></div></div>
<p>…On the other hand, if the keys are non-integer, then they are listed in the creation order, for instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  surname: "Smith"
};
user.age = 25; // add one more

// non-integer properties are listed in the creation order
for (let prop in user) {
  alert( prop ); // name, surname, age
}</code></pre>
        </div>
      </div>
      
      </div><p>So, to fix the issue with the phone codes, we can “cheat” by making the codes non-integer. Adding a plus <code>"+"</code> sign before each code is enough.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let codes = {
  "+49": "Germany",
  "+41": "Switzerland",
  "+44": "Great Britain",
  // ..,
  "+1": "USA"
};

for(let code in codes) {
  alert( +code ); // 49, 41, 44, 1
}</code></pre>
        </div>
      </div>
      
      </div><p>Now it works as intended.</p>
<h2 id="chapter-230">
Copying by reference</h2>
<p>One of the fundamental differences of objects vs primitives is that they are stored and copied “by reference”.</p>
<p>Primitive values: strings, numbers, booleans – are assigned/copied “as a whole value”.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let message = "Hello!";
let phrase = message;</code></pre>
        </div>
      </div>
      
      </div><p>As a result we have two independent variables, each one is storing the string <code>"Hello!"</code>.</p>
      <img src="http://javascript.info/article/object/variable-copy-value.png">
<p>Objects are not like that.</p>
<p><strong>A variable stores not the object itself, but it's “address in memory”, in other words “a reference” to it.</strong></p>
<p>Here's the picture for the object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John"
};</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/object/variable-contains-reference.png"&gt;
<p>Here, the object is stored somewhere in memory. And the variable <code>user</code> has a “reference” to it.</p>
<p><strong>When an object variable is copied – the reference is copied, the object is not duplicated.</strong></p>
<p>If we imagine an object as a cabinet, then a variable is a key to it. Copying a variable duplicates the key, but not the cabinet itself.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: "John" };

let admin = user; // copy the reference</code></pre>
        </div>
      </div>
      
      </div><p>Now we have two variables, each one with the reference to the same object:</p>
      <img src="http://javascript.info/article/object/variable-copy-reference.png">
<p>We can use any variable to access the cabinet and modify its contents:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4" data-highlight-inline="6:6-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: 'John' };

let admin = user;

admin.name = 'Pete'; // changed by the "admin" reference

alert(user.name); // 'Pete', changes are seen from the "user" reference</code></pre>
        </div>
      </div>
      
      </div><p>The example above demonstrates that there is only one object. Like if we had a cabinet with two keys and used one of them (<code>admin</code>) to get into it. Then, if we later use the other key (<code>user</code>) we would see changes.</p>
<h3>
Comparison by reference</a></h3><p>The equality <code>==</code> and strict equality <code>===</code> operators for objects work exactly the same.</p>
<p><strong>Two objects are equal only if they are the same object.</strong></p>
<p>For instance, two variables reference the same object, they are equal:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = {};
let b = a; // copy the reference

alert( a == b ); // true, both variables reference the same object
alert( a === b ); // true</code></pre>
        </div>
      </div>
      
      </div><p>And here two independent objects are not equal, even though both are empty:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = {};
let b = {}; // two independent objects

alert( a == b ); // false</code></pre>
        </div>
      </div>
      
      </div><p>For comparisons like <code>obj1 &gt; obj2</code> or for a comparison against a primitive <code>obj == 5</code>, objects are converted to primitives. We'll study how object conversions work very soon, but to say the truth, such comparisons are necessary very rarely and usually are a result of a coding mistake.</p>
<h3>
Const object</a></h3><p>An object declared as <code>const</code> <em>can</em> be changed.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const user = {
  name: "John"
};

user.age = 25; // (*)

alert(user.age); // 25</code></pre>
        </div>
      </div>
      
      </div><p>It might seem that the line <code>(*)</code> would cause an error, but no, there's totally no problem. That's because <code>const</code> fixes the value of <code>user</code> itself. And here <code>user</code> stores the reference to the same object all the time. The line <code>(*)</code> goes <em>inside</em> the object, it doesn't reassign <code>user</code>.</p>
<p>The <code>const</code> would give an error if we try to set <code>user</code> to something else, for instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const user = {
  name: "John"
};

// Error (can't reassign user)
user = {
  name: "Pete"
};</code></pre>
        </div>
      </div>
      
      </div><p>…But what if we want to make constant object properties? So that <code>user.age = 25</code> would give an error. That's possible too. We'll cover it in the chapter 
<a href="http://javascript.info/property-descriptors">Property flags and descriptors</a>.</p>
<h2 id="chapter-231">
Cloning and merging, Object.assign</h2>
<p>So, copying an object variable creates one more reference to the same object.</p>
<p>But what if we need to duplicate an object? Create an independent copy, a clone?</p>
<p>That's also doable, but a little bit more difficult, because there's no built-in method for that in JavaScript. Actually, that's rarely needed. Copying by reference is good most of the time.</p>
<p>But if we really want that, then we need to create a new object and replicate the structure of the existing one by iterating over its properties and copying them on the primitive level.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30
};

let clone = {}; // the new empty object

// let's copy all user properties into it
for (let key in user) {
  clone[key] = user[key];
}

// now clone is a fully independant clone
clone.name = "Pete"; // changed the data in it

alert( user.name ); // still John in the original object</code></pre>
        </div>
      </div>
      
      </div><p>Also we can use the method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a> for that.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Object.assign(dest[, src1, src2, src3...])</code></pre>
        </div>
      </div>
      
      </div><ul>
<li>Arguments <code>dest</code>, and <code>src1, ..., srcN</code> (can be as many as needed) are objects.</li>
<li>It copies the properties of all objects <code>src1, ..., srcN</code> into <code>dest</code>. In other words, properties of all arguments starting from the 2nd are copied into the 1st. Then it returns <code>dest</code>.</li>
</ul>
<p>For instance, we can use it to merge several objects into one:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: "John" };

let permissions1 = { canView: true };
let permissions2 = { canEdit: true };

// copies all properties from permissions1 and permissions2 into user
Object.assign(user, permissions1, permissions2);

// now user = { name: "John", canView: true, canEdit: true }</code></pre>
        </div>
      </div>
      
      </div><p>If the receiving object (<code>user</code>) already has the same named property, it will be overwritten:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: "John" };

// overwrite name, add isAdmin
Object.assign(user, { name: "Pete", isAdmin: true });

// now user = { name: "Pete", isAdmin: true }</code></pre>
        </div>
      </div>
      
      </div><p>We also can use <code>Object.assign</code> to replace the loop for simple cloning:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30
};

let clone = Object.assign({}, user);</code></pre>
        </div>
      </div>
      
      </div><p>It copies all properties of <code>user</code> into the empty object and returns it. Actually, the same as the loop, but shorter.</p>
<p>Until now we assumed that all properties of <code>user</code> are primitive. But properties can be references to other objects. What to do with them?</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  sizes: {
    height: 182,
    width: 50
  }
};

alert( user.sizes.height ); // 182</code></pre>
        </div>
      </div>
      
      </div><p>Now it's not enough to copy <code>clone.sizes = user.sizes</code>, because the <code>user.sizes</code> is an object, it will be copied by reference. So <code>clone</code> and <code>user</code> will share the same sizes:</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  sizes: {
    height: 182,
    width: 50
  }
};

let clone = Object.assign({}, user);

alert( user.sizes === clone.sizes ); // true, same object

// user and clone share sizes
user.sizes.width++;       // change a property from one place
alert(clone.sizes.width); // 51, see the result from the other one</code></pre>
        </div>
      </div>
      
      </div><p>To fix that, we should use the cloning loop that examines each value of <code>user[key]</code> and, if it's an object, then replicate it's structure as well. That is called a “deep cloning”.</p>
<p>There's a standard algorithm for deep cloning that handles the case above and more complex cases, called the 
<a href="https://w3c.github.io/html/infrastructure.html#internal-structured-cloning-algorithm">Structured cloning algorithm</a>. In order not to reinvent the wheel, we can use a working implementation of it from the JavaScript library 
<a href="https://lodash.com">lodash</a>, the method is called 
<a href="https://lodash.com/docs#cloneDeep">_.cloneDeep(obj)</a>.</p>
<h2 id="chapter-232">
Summary</h2>
<p>Objects are associative arrays with several special features.</p>
<p>They store properties (key-value pairs), where:</p>
<ul>
<li>Property keys must be strings or symbols (usually strings).</li>
<li>Values can be of any type.</li>
</ul>
<p>To access a property, we can use:</p>
<ul>
<li>The dot notation: <code>obj.property</code>.</li>
<li>Square brackets notation <code>obj["property"]</code>. Square brackets allow to take the key from a variable, like <code>obj[varWithKey]</code>.</li>
</ul>
<p>Additional operators:</p>
<ul>
<li>To delete a property: <code>delete obj.prop</code>.</li>
<li>To check if a property with the given key exists: <code>"key" in obj</code>.</li>
<li>To iterate over an object: <code>for(let key in obj)</code> loop.</li>
</ul>
<p>Objects are assigned and copied by reference. In other words, a variable stores not the “object value”, but a “reference” (address in memory) for the value. So copying such a variable or passing it as a function argument copies that reference, not the object. All operations via copied references (like adding/removing properties) are performed on the same single object.</p>
<p>To make a “real copy” (a clone) we can use <code>Object.assign</code> or  
<a href="https://lodash.com/docs#cloneDeep">_.cloneDeep(obj)</a>.</p>
<p>What we've studied in this chapter is called a “plain object”, or just <code>Object</code>.</p>
<p>There are many other kinds of objects in JavaScript:</p>
<ul>
<li><code>Array</code> to store ordered data collections,</li>
<li><code>Date</code> to store the information about the date and time,</li>
<li><code>Error</code> to store the information about an error.</li>
<li>…And so on.</li>
</ul>
<p>They have their special features that we'll study later. Sometimes people say something like “Array type” or “Date type”, but formally they are not types of their own, but belong to a single “object” data type. And they extend it in various ways.</p>
<p>Objects in JavaScript are very powerful. Here we've just scratched the surface of the topic that is really huge. We'll be closely working with objects and learning more about them in further parts of the tutorial.</p>
<div class="tasks"><h2 id="chapter-233" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#hello-object" name="hello-object" class="main__anchor">Hello, object</a></h3>
<a href="http://javascript.info/task/hello-object" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write the code, one line for each action:</p>
<ol>
<li>Create an empty object <code>user</code>.</li>
<li>Add the property <code>name</code> with the value <code>John</code>.</li>
<li>Add the property <code>surname</code> with the value <code>Smith</code>.</li>
<li>Change the value of the <code>name</code> to <code>Pete</code>.</li>
<li>Remove the property <code>name</code> from the object.</li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {};
user.name = "John";
user.surname = "Smith";
user.name = "Pete";
delete user.name;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#check-for-emptiness" name="check-for-emptiness" class="main__anchor">Check for emptiness</a></h3>
<a href="http://javascript.info/task/is-empty" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write the function <code>isEmpty(obj)</code> which returns <code>true</code> if the object has no properties, <code>false</code> otherwise.</p>
<p>Should work like that:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let schedule = {};

alert( isEmpty(schedule) ); // true

schedule["8:30"] = "get up";

alert( isEmpty(schedule) ); // false</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/5O2A59knPcjvDZVmYNzO?p=preview" target="_blank" data-plunk-id="5O2A59knPcjvDZVmYNzO">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Just loop over the object and <code>return false</code> immediately if there's at least one property.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function isEmpty(obj) {
  for (let key in obj) {
    return false;
  }
  return true;
}</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/ghc5LgbADPtT435mU0Pm?p=preview" target="_blank" data-plunk-id="ghc5LgbADPtT435mU0Pm">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#constant-objects" name="constant-objects" class="main__anchor">Constant objects?</a></h3>
<a href="http://javascript.info/task/const-object" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Is it possible to change an object declared with <code>const</code>, how do you think?</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const user = {
  name: "John"
};

// does it work?
user.name = "Pete";</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Sure, it works, no problem.</p>
<p>The <code>const</code> only protects the variable itself from changing.</p>
<p>In other words, <code>user</code> stores a reference to the object. And it can't be changed. But the content of the object can.</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const user = {
  name: "John"
};

// works
user.name = "Pete";

// error
user = 123;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sum-object-properties" name="sum-object-properties" class="main__anchor">Sum object properties</a></h3>
<a href="http://javascript.info/task/sum-object" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We have an object storing salaries of our team:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let salaries = {
  John: 100,
  Ann: 160,
  Pete: 130
}</code></pre>
        </div>
      </div>
      
      </div><p>Write the code to sum all salaries and store in the variable <code>sum</code>. Should be <code>390</code> in the example above.</p>
<p>If <code>salaries</code> is empty, then the result must be <code>0</code>.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let salaries = {
  John: 100,
  Ann: 160,
  Pete: 130
};

let sum = 0;
for (let key in salaries) {
  sum += salaries[key];
}

alert(sum); // 390</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#multiply-numeric-properties-by-2" name="multiply-numeric-properties-by-2" class="main__anchor">Multiply numeric properties by 2</a></h3>
<a href="http://javascript.info/task/multiply-numeric" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>Create a function <code>multiplyNumeric(obj)</code> that multiplies all numeric properties of <code>obj</code> by <code>2</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// before the call
let menu = {
  width: 200,
  height: 300,
  title: "My menu"
};

multiplyNumeric(menu);

// after the call
menu = {
  width: 400,
  height: 600,
  title: "My menu"
};</code></pre>
        </div>
      </div>
      
      </div><p>Please note that <code>multiplyNumeric</code> does not need to return anything. It should modify the object in-place.</p>
<p>P.S. Use <code>typeof</code> to check for a number here.</p>
<p>
<a href="http://plnkr.co/edit/yGyyV03DPTdiVFdw82gL?p=preview" target="_blank" data-plunk-id="yGyyV03DPTdiVFdw82gL">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/v2QHwvKlIWHz35XMb8HA?p=preview" target="_blank" data-plunk-id="v2QHwvKlIWHz35XMb8HA">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-234"></h6>
<h1 class="main__header-title" id="chapter-235">Garbage collection</h1>
<p>Memory management in JavaScript is performed automatically and invisibly to us. We create primitives, objects, functions… All that takes memory.</p>
<p>What happens when something is not needed any more? How does the JavaScript engine discover it and clean it up?</p>


<h2 id="chapter-236">
Reachability</h2>
<p>The main concept of memory management in JavaScript is <em>reachability</em>.</p>
<p>Simply put, “reachable” values are those that are accessible or usable somehow. They are guaranteed to be stored in memory.</p>
<ol>
<li>
<p>There's a base set of inherently reachable values, that cannot be deleted for obvious reasons.</p>
<p>For instance:</p>
<ul>
<li>Local variables and parameters of the current function.</li>
<li>Variables and parameters for other functions on the current chain of nested calls.</li>
<li>Global variables.</li>
<li>(there are some other, internal ones as well)</li>
</ul>
<p>These values are called <em>roots</em>.</p>
</li>
<li>
<p>Any other value is considered reachable if it's reachable from a root by a reference or by a chain of references.</p>
<p>For instance, if there's an object in a local variable, and that object has a property referencing another object, that object is considered reachable. And those that it references are also reachable. Detailed examples to follow.</p>
</li>
</ol>
<p>There's a background process in the JavaScript engine that is called 
<a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">garbage collector</a>. It monitors all objects and removes those that have become unreachable.</p>
<h2 id="chapter-237">
A simple example</h2>
<p>Here's the simplest example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// user has a reference to the object
let user = {
  name: "John"
};</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/garbage-collection/memory-user-john.png"&gt;
<p>Here the arrow depicts an object reference. The global variable <code>"user"</code> references the object <code>{name: "John"}</code> (we'll call it John for brevity). The <code>"name"</code> property of John stores a primitive, so it's painted inside the object.</p>
<p>If the value of <code>user</code> is overwritten, the reference is lost:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">user = null;</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/garbage-collection/memory-user-john-lost.png"&gt;
<p>Now John becomes unreachable. There's no way to access it, no references to it. Garbage collector will junk the data and free the memory.</p>
<h2 id="chapter-238">
Two references</h2>
<p>Now let's imagine we copied the reference from <code>user</code> to <code>admin</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// user has a reference to the object
let user = {
  name: "John"
};

let admin = user;</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/garbage-collection/memory-user-john-admin.png"&gt;
<p>Now if we do the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">user = null;</code></pre>
        </div>
      </div>
      
      </div><p>…Then the object is still reachable via <code>admin</code> global variable, so it's in memory. If we overwrite <code>admin</code> too, then it can be removed.</p>
<h2 id="chapter-239">
Interlinked objects</h2>
<p>Now a more complex example. The family:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function marry(man, woman) {
  woman.husband = man;
  man.wife = woman;

  return {
    father: man,
    mother: woman
  }
}

let family = marry({
  name: "John"
}, {
  name: "Ann"
});</code></pre>
        </div>
      </div>
      
      </div><p>Function <code>marry</code> “marries” two objects by giving them references to each other and returns a new object that contains them both.</p>
<p>The resulting memory structure:</p>
      <img src="http://javascript.info/article/garbage-collection/family.png">
<p>As of now, all objects are reachable.</p>
<p>Now let's remove two references:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">delete family.father;
delete family.mother.husband;</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/garbage-collection/family-delete-refs.png"&gt;
<p>It's not enough to delete only one of these two references, because all objects would still be reachable.</p>
<p>But if we delete both, then we can see that John has no incoming reference any more:</p>
      <img src="http://javascript.info/article/garbage-collection/family-no-father.png">
<p>Outgoing references do not matter. Only incoming ones can make an object reachable. So, John is now unreachable and will be removed from the memory with all its data that also became unaccessible.</p>
<p>After garbage collection:</p>
      <img src="http://javascript.info/article/garbage-collection/family-no-father-2.png">
<h2 id="chapter-240">
Unreachable island</h2>
<p>It is possible that the whole island of interlinked objects becomes unreachable and is removed from the memory.</p>
<p>The source object is the same as above. Then:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">family = null;</code></pre>
        </div>
      </div>
      
      </div><p>The in-memory picture becomes:</p>
      <img src="http://javascript.info/article/garbage-collection/family-no-family.png">
<p>This example demonstrates how important the concept of reachability is.</p>
<p>It's obvious that John and Ann are still linked, both have incoming references. But that's not enough.</p>
<p>The former <code>"family"</code> object has been unlinked from the root, there's no reference to it any more, so the whole island becomes unreachable and will be removed.</p>
<h2 id="chapter-241">
Internal algorithms</h2>
<p>The basic garbage collection algorithm is called “mark-and-sweep”.</p>
<p>The following “garbage collection” steps are regularly performed:</p>
<ul>
<li>The garbage collector takes roots and “marks” (remembers) them.</li>
<li>Then it visits and “marks” all references from them.</li>
<li>Then it visits marked objects and marks <em>their</em> references. All visited objects are remembered, so as not to visit the same object twice in the future.</li>
<li>…And so on until there are unvisited references (reachable from the roots).</li>
<li>All objects except marked ones are removed.</li>
</ul>
<p>For instance, let our object structure look like this:</p>
      <img src="http://javascript.info/article/garbage-collection/garbage-collection-1.png">
<p>We can clearly see an “unreachable island” to the right side. Now let's see how “mark-and-sweep” garbage collector deals with it.</p>
<p>The first step marks the roots:</p>
      <img src="http://javascript.info/article/garbage-collection/garbage-collection-2.png">
<p>Then their references are marked:</p>
      <img src="http://javascript.info/article/garbage-collection/garbage-collection-3.png">
<p>…And their references, while possible:</p>
      <img src="http://javascript.info/article/garbage-collection/garbage-collection-4.png">
<p>Now the objects that could not be visited in the process are considered unreachable and will be removed:</p>
      <img src="http://javascript.info/article/garbage-collection/garbage-collection-5.png">
<p>That's the concept of how garbage collection works.</p>
<p>JavaScript engines apply many optimizations to make it run faster and not affect the execution.</p>
<p>Some of the optimizations:</p>
<ul>
<li><strong>Generational collection</strong> – objects are split into two sets: “new ones” and “old ones”. Many  objects appear, do their job and die fast, they can be cleaned up aggressively. Those that survive for long enough, become “old” and are examined less often.</li>
<li><strong>Incremental collection</strong> – if there are many objects, and we try to walk and mark the whole object set at once, it may take some time and introduce visible delays in the execution. So the engine tries to split the garbage collection into pieces. Then the pieces are executed one by one, separately. That requires some extra bookkeeping between them to track changes, but we have many tiny delays instead of a big one.</li>
<li><strong>Idle-time collection</strong> – the garbage collector tries to run only while the CPU is idle, to reduce the possible effect on the execution.</li>
</ul>
<p>There are other optimizations and flavours of garbage collection algorithms. As much as I'd like to describe them here, I have to hold off, because different engines implement different tweaks and techniques. And, what's even more important, things change as engines develop, so going deeper “in advance”, without a real need is probably not worth that. Unless, of course, it is a matter of pure interest, then there will be some links for you below.</p>
<h2 id="chapter-242">
Summary</h2>
<p>The main things to know:</p>
<ul>
<li>Garbage collection is performed automatically. We cannot force or prevent it.</li>
<li>Objects are retained in memory while they are reachable.</li>
<li>Being referenced is not the same as being reachable (from a root): a pack of interlinked objects can become unreachable as a whole.</li>
</ul>
<p>Modern engines implement advanced algorithms of garbage collection.</p>
<p>A general book “The Garbage Collection Handbook: The Art of Automatic Memory Management” (R. Jones et al) covers some of them.</p>
<p>If you are familiar with low-level programming, the more detailed information about V8 garbage collector is in the article 
<a href="http://jayconrod.com/posts/55/a-tour-of-v8-garbage-collection">A tour of V8: Garbage Collection</a>.</p>
<p>
<a href="http://v8project.blogspot.com/">V8 blog</a> also publishes articles about changes in memory management from time to time. Naturally, to learn the garbage collection, you'd better prepare by learning about V8 internals in general and read the blog of 
<a href="http://mrale.ph">Vyacheslav Egorov</a> who worked as one of V8 engineers. I'm saying: “V8”, because it is best covered with articles in the internet. For other engines, many approaches are similar, but garbage collection differs in many aspects.</p>
<p>In-depth knowledge of engines is good when you need low-level optimizations. It would be wise to plan that as the next step after you're familiar with the language.</p>

<h6 id="chapter-243"></h6>
<h1 class="main__header-title" id="chapter-244">Symbol type</h1>
<p>By specification, object property keys may be either of string type, or of symbol type. Not numbers, not booleans, only strings or symbols, these two types.</p>
<p>Till now we've only seen strings. Now let's see the advantages that symbols can give us.</p>


<h2 id="chapter-245">
Symbols</h2>
<p>“Symbol” value represents a unique identifier.</p>
<p>A value of this type can be created using <code>Symbol()</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// id is a new symbol
let id = Symbol();</code></pre>
        </div>
      </div>
      
      </div><p>We can also give symbol a description (also called a symbol name), mostly useful for debugging purposes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// id is a symbol with the description "id"
let id = Symbol("id");</code></pre>
        </div>
      </div>
      
      </div><p>Symbols are guaranteed to be unique. Even if we create many symbols with the same description, they are different values. The description is just a label that doesn't affect anything.</p>
<p>For instance, here are two symbols with the same description – they are not equal:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let id1 = Symbol("id");
let id2 = Symbol("id");

alert(id1 == id2); // false</code></pre>
        </div>
      </div>
      
      </div><p>If you are familiar with Ruby or another language that also has some sort of “symbols” – please don't be misguided. JavaScript symbols are different.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Symbols don't auto-convert to a string</span></div>
            <div class="important__content"><p>Most values in JavaScript support implicit conversion to a string. For instance, we can <code>alert</code> almost any value, and it will work. Symbols are special. They don't auto-convert.</p>
<p>For instance, this <code>alert</code> will show an error:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let id = Symbol("id");
alert(id); // TypeError: Cannot convert a Symbol value to a string</code></pre>
        </div>
      </div>
      
      </div><p>If we really want to show a symbol, we need to call <code>.toString()</code> on it, like here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let id = Symbol("id");
alert(id.toString()); // Symbol(id), now it works</code></pre>
        </div>
      </div>
      
      </div><p>That's a “language guard” against messing up, because strings and symbols are fundamentally different and should not occasionally convert one into another.</p>
</div></div>
<h2 id="chapter-246">
“Hidden” properties</h2>
<p>Symbols allow us to create “hidden” properties of an object, that no other part of code can occasionally access or overwrite.</p>
<p>For instance, if we want to store an “identifier” for the object <code>user</code>, we can use a symbol as a key for it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: "John" };
let id = Symbol("id");

user[id] = "ID Value";
alert( user[id] ); // we can access the data using the symbol as the key</code></pre>
        </div>
      </div>
      
      </div><p>What's the benefit over using <code>Symbol("id")</code> over a string <code>"id"</code>?</p>
<p>Let's make the example a bit deeper to see that.</p>
<p>Imagine that another script wants to have its own “id” property inside <code>user</code>, for its own purposes. That may be another JavaScript library, so the scripts are completely unaware of each other.</p>
<p>Then that script can create its own <code>Symbol("id")</code>, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// ...
let id = Symbol("id");

user[id] = "Their id value";</code></pre>
        </div>
      </div>
      
      </div><p>There will be no conflict, because symbols are always different, even if they have the same name.</p>
<p>Now note that if we used a string <code>"id"</code> instead of a symbol for the same purpose, then there <em>would</em> be a conflict:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: "John" };

// our script uses "id" property
user.id = "ID Value";

// ...if later another script the uses "id" for its purposes...

user.id = "Their id value"
// boom! overwritten! it did not mean to harm the colleague, but did it!</code></pre>
        </div>
      </div>
      
      </div><h3>
Symbols in a literal</a></h3><p>If we want to use a symbol in an object literal, we need square brackets.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let id = Symbol("id");

let user = {
  name: "John",
  [id]: 123 // not just "id: 123"
};</code></pre>
        </div>
      </div>
      
      </div><p>That's because we need the value from the variable <code>id</code> as the key, not the string “id”.</p>
<h3>
Symbols are skipped by for…in</a></h3><p>Symbolic properties do not participate in <code>for..in</code> loop.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let id = Symbol("id");
let user = {
  name: "John",
  age: 30,
  [id]: 123
};

for (let key in user) alert(key); // name, age (no symbols)

// the direct access by the symbol works
alert( "Direct: " + user[id] );</code></pre>
        </div>
      </div>
      
      </div><p>That's a part of the general “hiding” concept. If another script or a library loops over our object, it won't unexpectedly access a symbolic property.</p>
<p>In contrast, 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a> copies both string and symbol properties:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let id = Symbol("id");
let user = {
  [id]: 123
};

let clone = Object.assign({}, user);

alert( clone[id] ); // 123</code></pre>
        </div>
      </div>
      
      </div><p>There's no paradox here. That's by design. The idea is that when we clone an object or merge objects, we usually want <em>all</em> properties to be copied (including symbols like <code>id</code>).</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Property keys of other types are coerced to strings</span></div>
            <div class="important__content"><p>We can only use strings or symbols as keys in objects. Other types are converted to strings.</p>
<p>For instance, a number <code>0</code> becomes a string <code>"0"</code> when used as a property key:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {
  0: "test" // same as "0": "test"
};

// both alerts access the same property (the number 0 is converted to string "0")
alert( obj["0"] ); // test
alert( obj[0] ); // test (same property)</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-247">
Global symbols</h2>
<p>As we've seen, usually all symbols are different, even if they have the same names. But sometimes we want same-named symbols to be same entities.</p>
<p>For instance, different parts of our application want to access symbol <code>"id"</code> meaning exactly the same property.</p>
<p>To achieve that, there exists a <em>global symbol registry</em>. We can create symbols in it and access them later, and it guarantees that repeated accesses by the same name return exactly the same symbol.</p>
<p>In order to create or read a symbol in the registry, use <code>Symbol.for(key)</code>.</p>
<p>That call checks the global registry, and if there's a symbol described as <code>key</code>, then returns it, otherwise creates a new symbol <code>Symbol(key)</code> and stores it in the registry by the given <code>key</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// read from the global registry
let id = Symbol.for("id"); // if the symbol did not exist, it is created

// read it again
let idAgain = Symbol.for("id");

// the same symbol
alert( id === idAgain ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Symbols inside the registry are called <em>global symbols</em>. If we want an application-wide symbol, accessible everywhere in the code – that's what they are for.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">That sounds like Ruby</span></div>
            <div class="important__content"><p>In some programming languages, like Ruby, there's a single symbol per name.</p>
<p>In JavaScript, as we can see, that's right for global symbols.</p>
</div></div>
<h3>
Symbol.keyFor</a></h3><p>For global symbols, not only <code>Symbol.for(key)</code> returns a symbol by name, but there's a reverse call: <code>Symbol.keyFor(sym)</code>, that does the reverse: returns a name by a global symbol.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sym = Symbol.for("name");
let sym2 = Symbol.for("id");

// get name from symbol
alert( Symbol.keyFor(sym) ); // name
alert( Symbol.keyFor(sym2) ); // id</code></pre>
        </div>
      </div>
      
      </div><p>The <code>Symbol.keyFor</code> internally uses the global symbol registry to look up the key for the symbol. So it doesn't work for non-global symbols. If the symbol is not global, it won't be able to find it and return <code>undefined</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Symbol.keyFor(Symbol.for("name")) ); // name, global symbol

alert( Symbol.keyFor(Symbol("name2")) ); // undefined, the argument isn't a global symbol</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-248">
System symbols</h2>
<p>There exist many “system” symbols that JavaScript uses internally, and we can use them to fine-tune various aspects of our objects.</p>
<p>They are listed in the specification in the 
<a href="https://tc39.github.io/ecma262/#sec-well-known-symbols">Well-known symbols</a> table:</p>
<ul>
<li><code>Symbol.hasInstance</code></li>
<li><code>Symbol.isConcatSpreadable</code></li>
<li><code>Symbol.iterator</code></li>
<li><code>Symbol.toPrimitive</code></li>
<li>…and so on.</li>
</ul>
<p>For instance, <code>Symbol.toPrimitive</code> allows us to describe object to primitive conversion. We'll see its use very soon.</p>
<p>Other symbols will also become familiar when we study the corresponding language features.</p>
<h2 id="chapter-249">
Summary</h2>
<p><code>Symbol</code> is a primitive type for unique identifiers.</p>
<p>Symbols are created with <code>Symbol()</code> call with an optional description.</p>
<p>Symbols are always different values, even if they have the same name. If we want same-named symbols to be equal, then we should use the global registry: <code>Symbol.for(key)</code> returns (creates if needed) a global symbol with <code>key</code> as the name. Multiple calls of <code>Symbol.for</code> return exactly the same symbol.</p>
<p>Symbols have two main use cases:</p>
<ol>
<li>
<p>“Hidden” object properties.
If we want to add a property into an object that “belongs” to another script or a library, we can create a symbol and use it as a property key. A symbolic property does not appear in <code>for..in</code>, so it won't be occasionally listed. Also it won't be accessed directly, because another script does not have our symbol, so it will not occasionally intervene into its actions.</p>
<p>So we can “covertly” hide something into objects that we need, but others should not see, using symbolic properties.</p>
</li>
<li>
<p>There are many system symbols used by JavaScript which are accessible as <code>Symbol.*</code>. We can use them to alter some built-in behaviors. For instance, later in the tutorial we'll use <code>Symbol.iterator</code> for 
<a href="http://javascript.info/iterable">iterables</a>, <code>Symbol.toPrimitive</code> to setup 
<a href="http://javascript.info/object-toprimitive">object-to-primitive conversion</a> and so on.</p>
</li>
</ol>
<p>Technically, symbols are not 100% hidden. There is a built-in method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols(obj)</a> that allows us to get all symbols. Also there is a method named 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys">Reflect.ownKeys(obj)</a> that returns <em>all</em> keys of an object including symbolic ones. So they are not really hidden. But most libraries, built-in methods and syntax constructs adhere to a common agreement that they are. And the one who explicitly calls the aforementioned methods probably understands well what he's doing.</p>

<h6 id="chapter-250"></h6>
<h1 class="main__header-title" id="chapter-251">Object methods, "this"</h1>
<p>Objects are usually created to represent entities of the real world, like users, orders and so on:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30
};</code></pre>
        </div>
      </div>
      
      </div><p>And, in the real world, a user can <em>act</em>: select something from the shopping cart, login, logout etc.</p>
<p>Actions are represented in JavaScript by functions in properties.</p>


<h2 id="chapter-252">
Method examples</h2>
<p>For the start, let's teach the <code>user</code> to say hello:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30
};

user.sayHi = function() {
  alert("Hello!");
};

user.sayHi(); // Hello!</code></pre>
        </div>
      </div>
      
      </div><p>Here we've just used a Function Expression to create the function and assign it to the property <code>user.sayHi</code> of the object.</p>
<p>Then we can call it. The user can now speak!</p>
<p>A function that is the property of an object is called its <em>method</em>.</p>
<p>So, here we've got a method <code>sayHi</code> of the object <code>user</code>.</p>
<p>Of course, we could use a pre-declared function as a method, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  // ...
};

// first, declare
function sayHi() {
  alert("Hello!");
};

// then add as a method
user.sayHi = sayHi;

user.sayHi(); // Hello!</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Object-oriented programming</span></div>
            <div class="important__content"><p>When we write our code using objects to represent entities, that's called an 
<a href="https://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented programming</a>, in short: “OOP”.</p>
<p>OOP is a big thing, an interesting science of its own. How to choose the right entities? How to organize the interaction between them? That's architecture, and there are great books on that topic, like “Design Patterns: Elements of Reusable Object-Oriented Software” by E.Gamma, R.Helm, R.Johnson, J.Vissides or “Object-Oriented Analysis and Design with Applications” by G.Booch, and more. We'll scratch the surface of that topic later in the chapter 
<a href="http://javascript.info/object-oriented-programming">Objects, classes, inheritance</a>.</p>
</div></div>
<h3>
Method shorthand</a></h3><p>There exists a shorter syntax for methods in an object literal:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// these objects do the same

let user = {
  sayHi: function() {
    alert("Hello");
  }
};

// method shorthand looks better, right?
let user = {
  sayHi() { // same as "sayHi: function()"
    alert("Hello");
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>As demonstrated, we can omit <code>"function"</code> and just write <code>sayHi()</code>.</p>
<p>To tell the truth, the notations are not fully identical. There are subtle differences related to object inheritance (to be covered later), but for now they do not matter. In almost all cases the shorter syntax is preferred.</p>
<h2 id="chapter-253">
“this” in methods</h2>
<p>It's common that an object method needs to access the information stored in the object to do its job.</p>
<p>For instance, the code inside <code>user.sayHi()</code> may need the name of the <code>user</code>.</p>
<p><strong>To access the object, a method can use the <code>this</code> keyword.</strong></p>
<p>The value of <code>this</code> is the object “before dot”, the one used to call the method.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30,

  sayHi() {
    alert(this.name);
  }

};

user.sayHi(); // John</code></pre>
        </div>
      </div>
      
      </div><p>Here during the execution of <code>user.sayHi()</code>, the value of <code>this</code> will be <code>user</code>.</p>
<p>Technically, it's also possible to access the object without <code>this</code>, by referencing it via the outer variable:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30,

  sayHi() {
    alert(user.name); // "user" instead of "this"
  }

};</code></pre>
        </div>
      </div>
      
      </div><p>…But such code is unreliable. If we decide to copy <code>user</code> to another variable, e.g. <code>admin = user</code> and overwrite <code>user</code> with something else, then it will access the wrong object.</p>
<p>That's demonstrated below:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30,

  sayHi() {
    alert( user.name ); // leads to an error
  }

};


let admin = user;
user = null; // overwrite to make things obvious

admin.sayHi(); // Whoops! inside sayHi(), the old name is used! error!</code></pre>
        </div>
      </div>
      
      </div><p>If we used <code>this.name</code> instead of <code>user.name</code> inside the <code>alert</code>, then the code would work.</p>
<h2 id="chapter-254">
“this” is not bound</h2>
<p>In JavaScript, “this” keyword behaves unlike most other programming languages. First, it can be used in any function.</p>
<p>There's no syntax error in the code like that:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:9-13">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert( this.name );
}</code></pre>
        </div>
      </div>
      
      </div><p>The value of <code>this</code> is evaluated during the run-time. And it can be anything.</p>
<p>For instance, the same function may have different “this” when called from different objects:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: "John" };
let admin = { name: "Admin" };

function sayHi() {
  alert( this.name );
}

// use the same functions in two objects
user.f = sayHi;
admin.f = sayHi;

// these calls have different this
// "this" inside the function is the object "before the dot"
user.f(); // John  (this == user)
admin.f(); // Admin  (this == admin)

admin['f'](); // Admin (dot or square brackets access the method – doesn't matter)</code></pre>
        </div>
      </div>
      
      </div><p>Actually, we can call the function without an object at all:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert(this);
}

sayHi(); // undefined</code></pre>
        </div>
      </div>
      
      </div><p>In this case <code>this</code> is <code>undefined</code> in strict mode. If we try to access <code>this.name</code>, there will be an error.</p>
<p>In non-strict mode (if one forgets <code>use strict</code>) the value of <code>this</code> in such case will be the <em>global object</em> (<code>window</code> in a browser, we'll get to it later). This is a historical behavior that <code>"use strict"</code> fixes.</p>
<p>Please note that usually a call of a function that uses <code>this</code> without an object is not normal, but rather a programming mistake. If a function has <code>this</code>, then it is usually meant to be called in the context of an object.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The consequences of unbound <code>this</code></span></div>
            <div class="important__content"><p>If you come from another programming language, then you are probably used to the idea of a "bound <code>this</code>", where methods defined in an object always have <code>this</code> referencing that object.</p>
<p>In JavaScript <code>this</code> is “free”, its value is evaluated at call-time and does not depend on where the method was declared, but rather on what's the object “before the dot”.</p>
<p>The concept of run-time evaluated <code>this</code> has both pluses and minuses. On the one hand, a function can be reused for different objects. On the other hand, greater flexibility opens a place for mistakes.</p>
<p>Here our position is not to judge whether this language design decision is good or bad. We'll understand how to work with it, how to get benefits and evade problems.</p>
</div></div>
<h2 id="chapter-255">
Internals: Reference Type</h2>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">In-depth language feature</span></div>
            <div class="important__content"><p>This section covers an advanced topic, to understand certain edge-cases better.</p>
<p>If you want to go on faster, it can be skipped or postponed.</p>
</div></div>
<p>An intricate method call can lose <code>this</code>, for instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  hi() { alert(this.name); },
  bye() { alert("Bye"); }
};

user.hi(); // John (the simple call works)

// now let's call user.hi or user.bye depending on the name
(user.name == "John" ? user.hi : user.bye)(); // Error!</code></pre>
        </div>
      </div>
      
      </div><p>On the last line there is a ternary operator that chooses either <code>user.hi</code> or <code>user.bye</code>. In this case the result is <code>user.hi</code>.</p>
<p>The method is immediately called with parentheses <code>()</code>. But it doesn't work right!</p>
<p>You can see that the call results in an error, cause the value of <code>"this"</code> inside the call becomes <code>undefined</code>.</p>
<p>This works (object dot method):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">user.hi();</code></pre>
        </div>
      </div>
      
      </div><p>This doesn't (evaluated method):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">(user.name == "John" ? user.hi : user.bye)(); // Error!</code></pre>
        </div>
      </div>
      
      </div><p>Why? If we want to understand why it happens, let's get under the hood of how <code>obj.method()</code> call works.</p>
<p>Looking closely, we may notice two operations in <code>obj.method()</code> statement:</p>
<ol>
<li>First, the dot <code>'.'</code> retrieves the property <code>obj.method</code>.</li>
<li>Then parentheses <code>()</code> execute it.</li>
</ol>
<p>So, how does the information about <code>this</code> gets passed from the first part to the second one?</p>
<p>If we put these operations on separate lines, then <code>this</code> will be lost for sure:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  hi() { alert(this.name); }
}

// split getting and calling the method in two lines
let hi = user.hi;
hi(); // Error, because this is undefined</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>hi = user.hi</code> puts the function into the variable, and then on the last line it is completely standalone, and so there's no <code>this</code>.</p>
<p><strong>To make <code>user.hi()</code> calls work, JavaScript uses a trick – the dot <code>'.'</code> returns not a function, but a value of the special 
<a href="https://tc39.github.io/ecma262/#sec-reference-specification-type">Reference Type</a>.</strong></p>
<p>The Reference Type is a “specification type”. We can't explicitly use it, but it is used internally by the language.</p>
<p>The value of Reference Type is a three-value combination <code>(base, name, strict)</code>, where:</p>
<ul>
<li><code>base</code> is the object.</li>
<li><code>name</code> is the property.</li>
<li><code>strict</code> is true if <code>use strict</code> is in effect.</li>
</ul>
<p>The result of a property access <code>user.hi</code> is not a function, but a value of Reference Type. For <code>user.hi</code> in strict mode it is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Reference Type value
(user, "hi", true)</code></pre>
        </div>
      </div>
      
      </div><p>When parentheses <code>()</code> are called on the Reference Type, they receive the full information about the object and it's method, and can set the right <code>this</code> (<code>=user</code> in this case).</p>
<p>Any other operation like assignment <code>hi = user.hi</code> discards the reference type as a whole, takes the value of <code>user.hi</code> (a function) and passes it on. So any further operation “loses” <code>this</code>.</p>
<p>So, as the result, the value of <code>this</code> is only passed the right way if the function is called directly using a dot <code>obj.method()</code> or square brackets <code>obj[method]()</code> syntax (they do the same here).</p>
<h2 id="chapter-256">
Arrow functions have no “this”</h2>
<p>Arrow functions are special: they don't have their “own” <code>this</code>. If we reference <code>this</code> from such a function, it's taken from the outer “normal” function.</p>
<p>For instance, here <code>arrow()</code> uses <code>this</code> from the outer <code>user.sayHi()</code> method:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  firstName: "Ilya",
  sayHi() {
    let arrow = () =&gt; alert(this.firstName);
    arrow();
  }
};

user.sayHi(); // Ilya</code></pre>
        </div>
      </div>
      
      </div><p>That's a special feature of arrow functions, it's useful when we actually do not want to have a separate <code>this</code>, but rather to take it from the outer context. Later in the chapter 
<a href="http://javascript.info/arrow-functions">Arrow functions revisited</a> we'll go more deeply into arrow functions.</p>
<h2 id="chapter-257">
Summary</h2>
<ul>
<li>Functions that are stored in object properties are called “methods”.</li>
<li>Methods allow objects to “act” like <code>object.doSomething()</code>.</li>
<li>Methods can reference the object as <code>this</code>.</li>
</ul>
<p>The value of <code>this</code> is defined at run-time.</p>
<ul>
<li>When a function is declared, it may use <code>this</code>, but that <code>this</code> has no value until the function is called.</li>
<li>That function can be copied between objects.</li>
<li>When a function is called in the “method” syntax: <code>object.method()</code>, the value of <code>this</code> during the call is <code>object</code>.</li>
</ul>
<p>Please note that arrow functions are special: they have no <code>this</code>. When <code>this</code> is accessed inside an arrow function, it is taken from outside.</p>
<div class="tasks"><h2 id="chapter-258" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#syntax-check" name="syntax-check" class="main__anchor">Syntax check</a></h3>
<a href="http://javascript.info/task/check-syntax" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>What is the result of this code?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  go: function() { alert(this.name) }
}

(user.go)()</code></pre>
        </div>
      </div>
      
      </div><p>P.S. There's a pitfall :)</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p><strong>Error</strong>!</p>
<p>Try it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  go: function() { alert(this.name) }
}

(user.go)() // error!</code></pre>
        </div>
      </div>
      
      </div><p>The error message in most browsers does not give understanding what went wrong.</p>
<p><strong>The error appears because a semicolon is missing after <code>user = {...}</code>.</strong></p>
<p>JavaScript does not assume a semicolon before a bracket <code>(user.go)()</code>, so it reads the code like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { go:... }(user.go)()</code></pre>
        </div>
      </div>
      
      </div><p>Then we can also see that such a joint expression is syntactically a call of the object <code>{ go: ... }</code> as a function with the argument <code>(user.go)</code>. And that also happens on the same line with <code>let user</code>, so the <code>user</code> object has not yet even been defined, hence the error.</p>
<p>If we insert the semicolon, all is fine:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:1-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  go: function() { alert(this.name) }
};

(user.go)() // John</code></pre>
        </div>
      </div>
      
      </div><p>Please note that brackets around <code>(user.go)</code> do nothing here. Usually they setup the order of operations, but here the dot <code>.</code> works first anyway, so there's no effect. Only the semicolon thing matters.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#explain-the-value-of-this" name="explain-the-value-of-this" class="main__anchor">Explain the value of "this"</a></h3>
<a href="http://javascript.info/task/why-this" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>In the code below we intend to call <code>user.go()</code> method 4 times in a row.</p>
<p>But calls <code>(1)</code> and <code>(2)</code> works differently from <code>(3)</code> and <code>(4)</code>. Why?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj, method;

obj = {
  go: function() { alert(this); }
};

obj.go();               // (1) [object Object]

(obj.go)();             // (2) [object Object]

(method = obj.go)();    // (3) undefined

(obj.go || obj.stop)(); // (4) undefined</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Here's the explanations.</p>
<ol>
<li>
<p>That's a regular object method call.</p>
</li>
<li>
<p>The same, brackets do not change the order of operations here, the dot is first anyway.</p>
</li>
<li>
<p>Here we have a more complex call <code>(expression).method()</code>. The call works as if it were split into two lines:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">f = obj.go; // calculate the expression
f();        // call what we have</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>f()</code> is executed as a function, without <code>this</code>.</p>
</li>
<li>
<p>The similar thing as <code>(3)</code>, to the left of the dot <code>.</code> we have an expression.</p>
</li>
</ol>
<p>To explain the behavior of <code>(3)</code> and <code>(4)</code> we need to recall that property accessors (dot or square brackets) return a value of the Reference Type.</p>
<p>Any operation on it except a method call (like assignment <code>=</code> or <code>||</code>) turns it into an ordinary value, which does not carry the information allowing to set <code>this</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#using-this-in-object-literal" name="using-this-in-object-literal" class="main__anchor">Using "this" in object literal</a></h3>
<a href="http://javascript.info/task/object-property-this" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Here the function <code>makeUser</code> returns an object.</p>
<p>What is the result of accessing its <code>ref</code>? Why?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeUser() {
  return {
    name: "John",
    ref: this
  };
};

let user = makeUser();

alert( user.ref.name ); // What's the result?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p><strong>Answer: an error.</strong></p>
<p>Try it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeUser() {
  return {
    name: "John",
    ref: this
  };
};

let user = makeUser();

alert( user.ref.name ); // Error: Cannot read property 'name' of undefined</code></pre>
        </div>
      </div>
      
      </div><p>That's because rules that set <code>this</code> do not look at object literals.</p>
<p>Here the value of <code>this</code> inside <code>makeUser()</code> is <code>undefined</code>, because it is called as a function, not as a method.</p>
<p>And the object literal itself has no effect on <code>this</code>. The value of <code>this</code> is one for the whole function, code blocks and object literals do not affect it.</p>
<p>So <code>ref: this</code> actually takes current <code>this</code> of the function.</p>
<p>Here's the opposite case:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeUser() {
  return {
    name: "John",
    ref() {
      return this;
    }
  };
};

let user = makeUser();

alert( user.ref().name ); // John</code></pre>
        </div>
      </div>
      
      </div><p>Now it works, because <code>user.ref()</code> is a method. And the value of <code>this</code> is set to the object before dot <code>.</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-a-calculator" name="create-a-calculator" class="main__anchor">Create a calculator</a></h3>
<a href="http://javascript.info/task/calculator" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create an object <code>calculator</code> with three methods:</p>
<ul>
<li><code>read()</code> prompts for two values and saves them as object properties.</li>
<li><code>sum()</code> returns the sum of saved values.</li>
<li><code>mul()</code> multiplies saved values and returns the result.</li>
</ul>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let calculator = {
  // ... your code ...
};

calculator.read();
alert( calculator.sum() );
alert( calculator.mul() );</code></pre>
        </div>
      </div>
      
      </div><p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p><p>
<a href="http://plnkr.co/edit/H7av4KoTaAlB1T8nNpQ2?p=preview" target="_blank" data-plunk-id="H7av4KoTaAlB1T8nNpQ2">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let calculator = {
  sum() {
    return this.a + this.b;
  },

  mul() {
    return this.a * this.b;
  },

  read() {
    this.a = +prompt('a?', 0);
    this.b = +prompt('b?', 0);
  }
};

calculator.read();
alert( calculator.sum() );
alert( calculator.mul() );</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/lxBVlCgNJehVJljHrnGR?p=preview" target="_blank" data-plunk-id="lxBVlCgNJehVJljHrnGR">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title">
<a href="#chaining" name="chaining" class="main__anchor">Chaining</a></h3>
<a href="http://javascript.info/task/chain-calls" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>There's a <code>ladder</code> object that allows to go up and down:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let ladder = {
  step: 0,
  up() {
    this.step++;
  },
  down() {
    this.step--;
  },
  showStep: function() { // shows the current step
    alert( this.step );
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>Now, if we need to make several calls in sequence, can do it like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ladder.up();
ladder.up();
ladder.down();
ladder.showStep(); // 1</code></pre>
        </div>
      </div>
      
      </div><p>Modify the code of <code>up</code> and <code>down</code> to make the calls chainable, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ladder.up().up().down().showStep(); // 1</code></pre>
        </div>
      </div>
      
      </div><p>Such approach is widely used across JavaScript libraries.</p>
<p>
<a href="http://plnkr.co/edit/Sgw2uBVHOq9bza8ijp2k?p=preview" target="_blank" data-plunk-id="Sgw2uBVHOq9bza8ijp2k">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution is to return the object itself from every call.</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4,8-8,12-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let ladder = {
  step: 0,
  up() {
    this.step++;
    return this;
  },
  down() {
    this.step--;
    return this;
  },
  showStep() {
    alert( this.step );
    return this;
  }
}

ladder.up().up().down().up().down().showStep(); // 1</code></pre>
        </div>
      </div>
      
      </div><p>We also can write a single call per line. For long chains it's more readable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ladder
  .up()
  .up()
  .down()
  .up()
  .down()
  .showStep(); // 1</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/MUE9KTILdKfBhjGJ2lCI?p=preview" target="_blank" data-plunk-id="MUE9KTILdKfBhjGJ2lCI">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-259"></h6>
<h1 class="main__header-title" id="chapter-260">Object to primitive conversion</h1>
<p>What happens when objects are added <code>obj1 + obj2</code>, subtracted <code>obj1 - obj2</code> or printed using <code>alert(obj)</code>?</p>
<p>There are special methods in objects that do the conversion.</p>
<p>In the chapter 
<a href="http://javascript.info/type-conversions">Type Conversions</a> we've seen the rules for numeric, string and boolean conversions of primitives. But we left a gap for objects. Now, as we know about methods and symbols it becomes possible to close it.</p>


<p>For objects, there's no to-boolean conversion, because all objects are <code>true</code> in a boolean context. So there are only string and numeric conversions.</p>
<p>The numeric conversion happens when we subtract objects or apply mathematical functions. For instance, <code>Date</code> objects (to be covered in the chapter 
<a href="http://javascript.info/date">Date and time</a>) can be subtracted, and the result of <code>date1 - date2</code> is the time difference between two dates.</p>
<p>As for the string conversion – it usually happens when we output an object like <code>alert(obj)</code> and in similar contexts.</p>
<h2 id="chapter-261">
ToPrimitive</h2>
<p>When an object is used in the context where a primitive is required, for instance, in an <code>alert</code> or mathematical operations, it's converted to a primitive value using the <code>ToPrimitive</code> algorithm (
<a href="https://tc39.github.io/ecma262/#sec-toprimitive">specification</a>).</p>
<p>That algorithm allows us to customize the conversion using a special object method.</p>
<p>Depending on the context, the conversion has a so-called “hint”.</p>
<p>There are three variants:</p>
<dl>
<dt><code>"string"</code></dt>
<dd>
<p>When an operation expects a string, for object-to-string conversions, like <code>alert</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// output
alert(obj);

// using object as a property key
anotherObj[obj] = 123;</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>"number"</code></dt>
<dd>
<p>When an operation expects a number, for object-to-number conversions, like maths:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// explicit conversion
let num = Number(obj);

// maths (except binary plus)
let n = +obj; // unary plus
let delta = date1 - date2;

// less/greater comparison
let greater = user1 &gt; user2;</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>"default"</code></dt>
<dd>
<p>Occurs in rare cases when the operator is “not sure” what type to expect.</p>
<p>For instance, binary plus <code>+</code> can work both with strings (concatenates them) and numbers (adds them), so both strings and numbers would do. Or when an object is compared using <code>==</code> with a string, number or a symbol.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// binary plus
let total = car1 + car2;

// obj == string/number/symbol
if (user == 1) { ... };</code></pre>
        </div>
      </div>
      
      </div><p>The greater/less operator <code>&lt;&gt;</code> can work with both strings and numbers too. Still, it uses “number” hint, not “default”. That's for historical reasons.</p>
<p>In practice, all built-in objects except for one case (<code>Date</code> object, we'll learn it later) implement <code>"default"</code> conversion the same way as <code>"number"</code>. And probably we should do the same.</p>
</dd>
</dl>
<p>Please note – there are only three hints. It's that simple. There is no “boolean” hint (all objects are <code>true</code> in boolean context) or anything else. And if we treat <code>"default"</code> and <code>"number"</code> the same, like most built-ins do, then there are only two conversions.</p>
<p><strong>To do the conversion, JavaScript tries to find and call three object methods:</strong></p>
<ol>
<li>Call <code>obj[Symbol.toPrimitive](hint)</code> if the method exists,</li>
<li>Otherwise if hint is <code>"string"</code>
<ul>
<li>try <code>obj.toString()</code> and <code>obj.valueOf()</code>, whatever exists.</li>
</ul>
</li>
<li>Otherwise if hint is <code>"number"</code> or <code>"default"</code>
<ul>
<li>try <code>obj.valueOf()</code> and <code>obj.toString()</code>, whatever exists.</li>
</ul>
</li>
</ol>
<h2 id="chapter-262">
Symbol.toPrimitive</h2>
<p>Let's start from the first method. There's a built-in symbol named <code>Symbol.toPrimitive</code> that should be used to name the conversion method, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">obj[Symbol.toPrimitive] = function(hint) {
  // return a primitive value
  // hint = one of "string", "number", "default"
}</code></pre>
        </div>
      </div>
      
      </div><p>For instance, here <code>user</code> object implements it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  money: 1000,

  [Symbol.toPrimitive](hint) {
    alert(`hint: ${hint}`);
    return hint == "string" ? `{name: "${this.name}"}` : this.money;
  }
};

// conversions demo:
alert(user); // hint: string -&gt; {name: "John"}
alert(+user); // hint: number -&gt; 1000
alert(user + 500); // hint: default -&gt; 1500</code></pre>
        </div>
      </div>
      
      </div><p>As we can see from the code, <code>user</code> becomes a self-descriptive string or a money amount depending on the conversion. The single method <code>user[Symbol.toPrimitive]</code> handles all conversion cases.</p>
<h2 id="chapter-263">
toString/valueOf</h2>
<p>Methods <code>toString</code> and <code>valueOf</code> come from ancient times. They are not symbols (symbols did not exist that long ago), but rather “regular” string-named methods. They provide an alternative “old-style” way to implement the conversion.</p>
<p>If there's no <code>Symbol.toPrimitive</code> then JavaScript tries to find them and try in the order:</p>
<ul>
<li><code>toString -&gt; valueOf</code> for “string” hint.</li>
<li><code>valueOf -&gt; toString</code> otherwise.</li>
</ul>
<p>For instance, here <code>user</code> does the same as above using a combination of <code>toString</code> and <code>valueOf</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  money: 1000,

  // for hint="string"
  toString() {
    return `{name: "${this.name}"}`;
  },

  // for hint="number" or "default"
  valueOf() {
    return this.money;
  }

};

alert(user); // toString -&gt; {name: "John"}
alert(+user); // valueOf -&gt; 1000
alert(user + 500); // valueOf -&gt; 1500</code></pre>
        </div>
      </div>
      
      </div><p>Often we want a single “catch-all” place to handle all primitive conversions. In this case we can implement <code>toString</code> only, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",

  toString() {
    return this.name;
  }
};

alert(user); // toString -&gt; John
alert(user + 500); // toString -&gt; John500</code></pre>
        </div>
      </div>
      
      </div><p>In the absence of <code>Symbol.toPrimitive</code> and <code>valueOf</code>, <code>toString</code> will handle all primitive conversions.</p>
<h2 id="chapter-264">
ToPrimitive and ToString/ToNumber</h2>
<p>The important thing to know about all primitive-conversion methods is that they do not necessarily return the “hinted” primitive.</p>
<p>There is no control whether <code>toString()</code> returns exactly a string, or whether <code>Symbol.toPrimitive</code> method returns a number for a hint “number”.</p>
<p><strong>The only mandatory thing: these methods must return a primitive.</strong></p>
<p>An operation that initiated the conversion gets that primitive, and then continues to work with it, applying further conversions if necessary.</p>
<p>For instance:</p>
<ul>
<li>
<p>Mathematical operations (except binary plus) perform <code>ToNumber</code> conversion:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {
  toString() { // toString handles all conversions in the absence of other methods
    return "2";
  }
};

alert(obj * 2); // 4, ToPrimitive gives "2", then it becomes 2</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Binary plus checks the primitive – if it's a string, then it does concatenation, otherwise it performs <code>ToNumber</code> and works with numbers.</p>
<p>String example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {
  toString() {
    return "2";
  }
};

alert(obj + 2); // 22 (ToPrimitive returned string =&gt; concatenation)</code></pre>
        </div>
      </div>
      
      </div><p>Number example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {
  toString() {
    return true;
  }
};

alert(obj + 2); // 3 (ToPrimitive returned boolean, not string =&gt; ToNumber)</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Historical notes</span></div>
            <div class="important__content"><p>For historical reasons, methods <code>toString</code> or <code>valueOf</code> <em>should</em> return a primitive: if any of them returns an object, then there's no error, but that object is ignored (like if the method didn't exist).</p>
<p>In contrast, <code>Symbol.toPrimitive</code> <em>must</em> return a primitive, otherwise, there will be an error.</p>
</div></div>
<h2 id="chapter-265">
Summary</h2>
<p>The object-to-primitive conversion is called automatically by many built-in functions and operators that expect a primitive as a value.</p>
<p>There are 3 types (hints) of it:</p>
<ul>
<li><code>"string"</code> (for <code>alert</code> and other string conversions)</li>
<li><code>"number"</code> (for maths)</li>
<li><code>"default"</code> (few operators)</li>
</ul>
<p>The specification describes explicitly which operator uses which hint. There are very few operators that “don't know what to expect” and use the <code>"default"</code> hint. Usually for built-in objects <code>"default"</code> hint is handled the same way as <code>"number"</code>, so in practice the last two are often merged together.</p>
<p>The conversion algorithm is:</p>
<ol>
<li>Call <code>obj[Symbol.toPrimitive](hint)</code> if the method exists,</li>
<li>Otherwise if hint is <code>"string"</code>
<ul>
<li>try <code>obj.toString()</code> and <code>obj.valueOf()</code>, whatever exists.</li>
</ul>
</li>
<li>Otherwise if hint is <code>"number"</code> or <code>"default"</code>
<ul>
<li>try <code>obj.valueOf()</code> and <code>obj.toString()</code>, whatever exists.</li>
</ul>
</li>
</ol>
<p>In practice, it's often enough to implement only <code>obj.toString()</code> as a “catch-all” method for all conversions that return a “human-readable” representation of an object, for logging or debugging purposes.</p>

<h6 id="chapter-266"></h6>
<h1 class="main__header-title" id="chapter-267">Constructor, operator "new"</h1>
<p>The regular <code>{...}</code> syntax allows to create one object. But often we need to create many similar objects, like multiple users or menu items and so on.</p>
<p>That can be done using constructor functions and the <code>"new"</code> operator.</p>


<h2 id="chapter-268">
Constructor function</h2>
<p>Constructor functions technically are regular functions. There are two conventions though:</p>
<ol>
<li>They are named with capital letter first.</li>
<li>They should be executed only with <code>"new"</code> operator.</li>
</ol>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name) {
  this.name = name;
  this.isAdmin = false;
}

let user = new User("Jack");

alert(user.name); // Jack
alert(user.isAdmin); // false</code></pre>
        </div>
      </div>
      
      </div><p>When a function is executed as <code>new User(...)</code>, it does the following steps:</p>
<ol>
<li>A new empty object is created and assigned to <code>this</code>.</li>
<li>The function body executes. Usually it modifies <code>this</code>, adds new properties to it.</li>
<li>The value of <code>this</code> is returned.</li>
</ol>
<p>In other words, <code>new User(...)</code> does something like:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1,7-7">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name) {
  // this = {};  (implicitly)

  // add properties to this
  this.name = name;
  this.isAdmin = false;

  // return this;  (implicitly)
}</code></pre>
        </div>
      </div>
      
      </div><p>So the result of <code>new User("Jack")</code> is the same object as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "Jack",
  isAdmin: false
};</code></pre>
        </div>
      </div>
      
      </div><p>Now if we want to create other users, we can call <code>new User("Ann")</code>, <code>new User("Alice")</code> and so on. Much shorter than using literals every time, and also easy to read.</p>
<p>That's the main purpose of constructors – to implement reusable object creation code.</p>
<p>Let's note once again – technically, any function can be used as a constructor. That is: any function can be run with <code>new</code>, and it will execute the algorithm above. The “capital letter first” is a common agreement, to make it clear that a function is to be run with <code>new</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">new function() { … }</span></div>
            <div class="important__content"><p>If we have many lines of code all about creation of a single complex object, we can wrap them in constructor function, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = new function() {
  this.name = "John";
  this.isAdmin = false;

  // ...other code for user creation
  // maybe complex logic and statements
  // local variables etc
};</code></pre>
        </div>
      </div>
      
      </div><p>The constructor can't be called again, because it is not saved anywhere, just created and called. So this trick aims to encapsulate the code that constructs the single object, without future reuse.</p>
</div></div>
<h2 id="chapter-269">
Dual-syntax constructors: new.target</h2>
<p>Inside a function, we can check whether it was called with <code>new</code> or without it, using a special <code>new.target</code> property.</p>
<p>It is empty for regular calls and equals the function if called with <code>new</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User() {
  alert(new.target);
}

// without new:
User(); // undefined

// with new:
new User(); // function User { ... }</code></pre>
        </div>
      </div>
      
      </div><p>That can be used to allow both <code>new</code> and regular syntax to work the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name) {
  if (!new.target) { // if you run me without new
    return new User(name); // ...I will add new for you
  }

  this.name = name;
}

let john = User("John"); // redirects call to new User
alert(john.name); // John</code></pre>
        </div>
      </div>
      
      </div><p>This approach is sometimes used in libraries to make the syntax more flexible. Probably not a good thing to use everywhere though, because omitting <code>new</code> makes it a bit less obvious what's going on. With <code>new</code> we all know that the new object is being created, that's a good thing.</p>
<h2 id="chapter-270">
Return from constructors</h2>
<p>Usually, constructors do not have a <code>return</code> statement. Their task is to write all necessary stuff into <code>this</code>, and it automatically becomes the result.</p>
<p>But if there is a <code>return</code> statement, then the rule is simple:</p>
<ul>
<li>If <code>return</code> is called with object, then it is returned instead of <code>this</code>.</li>
<li>If <code>return</code> is called with a primitive, it's ignored.</li>
</ul>
<p>In other words, <code>return</code> with an object returns that object, in all other cases <code>this</code> is returned.</p>
<p>For instance, here <code>return</code> overrides <code>this</code> by returning an object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function BigUser() {

  this.name = "John";

  return { name: "Godzilla" };  // &lt;-- returns an object
}

alert( new BigUser().name );  // Godzilla, got that object ^^</code></pre>
        </div>
      </div>
      
      </div><p>And here's an example with an empty <code>return</code> (or we could place a primitive after it, doesn't matter):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function SmallUser() {

  this.name = "John";

  return; // finishes the execution, returns this

  // ...

}

alert( new SmallUser().name );  // John</code></pre>
        </div>
      </div>
      
      </div><p>Usually constructors don't have a <code>return</code> statement. Here we mention the special behavior with returning objects mainly for the sake of completeness.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Omitting parentheses</span></div>
            <div class="important__content"><p>By the way, we can omit parentheses after <code>new</code>, if it has no arguments:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = new User; // &lt;-- no parentheses
// same as
let user = new User();</code></pre>
        </div>
      </div>
      
      </div><p>Omitting parentheses here is not considered a “good style”, but the syntax is permitted by specification.</p>
</div></div>
<h2 id="chapter-271">
Methods in constructor</h2>
<p>Using constructor functions to create objects gives a great deal of flexibility. The constructor function may have parameters that define how to construct the object, and what to put in it.</p>
<p>Of course, we can add to <code>this</code> not only properties, but methods as well.</p>
<p>For instance, <code>new User(name)</code> below creates an object with the given <code>name</code> and the method <code>sayHi</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name) {
  this.name = name;

  this.sayHi = function() {
    alert( "My name is: " + this.name );
  };
}

let john = new User("John");

john.sayHi(); // My name is: John

/*
john = {
   name: "John",
   sayHi: function() { ... }
}
*/</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-272">
Summary</h2>
<ul>
<li>Constructor functions or, briefly, constructors, are regular functions, but there's a common agreement to name them with capital letter first.</li>
<li>Constructor functions should only be called using <code>new</code>. Such a call implies a creation of empty <code>this</code> at the start and returning the populated one at the end.</li>
</ul>
<p>We can use constructor functions to make multiple similar objects.</p>
<p>JavaScript provides constructor functions for many built-in language objects: like <code>Date</code> for dates, <code>Set</code> for sets and others that we plan to study.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Objects, we'll be back!</span></div>
            <div class="important__content"><p>In this chapter we only cover the basics about objects and constructors. They are essential for learning more about data types and functions in the next chapters.</p>
<p>After we learn that, in the chapter 
<a href="http://javascript.info/object-oriented-programming">Objects, classes, inheritance</a> we return to objects and cover them in-depth, including inheritance and classes.</p>
</div></div>
<div class="tasks"><h2 id="chapter-273" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#two-functions-one-object" name="two-functions-one-object" class="main__anchor">Two functions – one object</a></h3>
<a href="http://javascript.info/task/two-functions-one-object" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>Is it possible to create functions <code>A</code> and <code>B</code> such as <code>new A()==new B()</code>?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function A() { ... }
function B() { ... }

let a = new A;
let b = new B;

alert( a == b ); // true</code></pre>
        </div>
      </div>
      
      </div><p>If it is, then provide an example of their code.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Yes, it's possible.</p>
<p>If a function returns an object then <code>new</code> returns it instead of <code>this</code>.</p>
<p>So thay can, for instance, return the same externally defined object <code>obj</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {};

function A() { return obj; }
function B() { return obj; }

alert( new A() == new B() ); // true</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-new-calculator" name="create-new-calculator" class="main__anchor">Create new Calculator</a></h3>
<a href="http://javascript.info/task/calculator-constructor" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a constructor function <code>Calculator</code> that creates objects with 3 methods:</p>
<ul>
<li><code>read()</code> asks for two values using <code>prompt</code> and remembers them in object properties.</li>
<li><code>sum()</code> returns the sum of these properties.</li>
<li><code>mul()</code> returns the multiplication product of these properties.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let calculator = new Calculator();
calculator.read();

alert( "Sum=" + calculator.sum() );
alert( "Mul=" + calculator.mul() );</code></pre>
        </div>
      </div>
      
      </div><p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p><p>
<a href="http://plnkr.co/edit/vsilDmkdOZkftqI8eZIl?p=preview" target="_blank" data-plunk-id="vsilDmkdOZkftqI8eZIl">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Calculator() {

  this.read = function() {
    this.a = +prompt('a?', 0);
    this.b = +prompt('b?', 0);
  };

  this.sum = function() {
    return this.a + this.b;
  };

  this.mul = function() {
    return this.a * this.b;
  };
}

let calculator = new Calculator();
calculator.read();

alert( "Sum=" + calculator.sum() );
alert( "Mul=" + calculator.mul() );</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/adHC1ycmyjUICiSlsKAQ?p=preview" target="_blank" data-plunk-id="adHC1ycmyjUICiSlsKAQ">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-new-accumulator" name="create-new-accumulator" class="main__anchor">Create new Accumulator</a></h3>
<a href="http://javascript.info/task/accumulator" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a constructor function <code>Accumulator(startingValue)</code>.</p>
<p>Object that it creates should:</p>
<ul>
<li>Store the “current value” in the property <code>value</code>. The starting value is set to the argument of the constructor <code>startingValue</code>.</li>
<li>The <code>read()</code> method should use <code>prompt</code> to read a new number and add it to <code>value</code>.</li>
</ul>
<p>In other words, the <code>value</code> property is the sum of all user-entered values with the initial value  <code>startingValue</code>.</p>
<p>Here's the demo of the code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let accumulator = new Accumulator(1); // initial value 1
accumulator.read(); // adds the user-entered value
accumulator.read(); // adds the user-entered value
alert(accumulator.value); // shows the sum of these values</code></pre>
        </div>
      </div>
      
      </div><p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p><p>
<a href="http://plnkr.co/edit/uKdZnwR9KzNURvxZFzNs?p=preview" target="_blank" data-plunk-id="uKdZnwR9KzNURvxZFzNs">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Accumulator(startingValue) {
  this.value = startingValue;

  this.read = function() {
    this.value += +prompt('How much to add?', 0);
  };

}

let accumulator = new Accumulator(1);
accumulator.read();
accumulator.read();
alert(accumulator.value);</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/k4eKaquxqX68t7OTMnI6?p=preview" target="_blank" data-plunk-id="k4eKaquxqX68t7OTMnI6">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-an-extendable-calculator" name="create-an-extendable-calculator" class="main__anchor">Create an extendable calculator</a></h3>
<a href="http://javascript.info/task/calculator-extendable" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a constructor function <code>Calculator</code> that creates “extendable” calculator objects.</p>
<p>The task consists of two parts.</p>
<ol>
<li>
<p>First, implement the method <code>calculate(str)</code> that takes a string like <code>"1 + 2"</code> in the format “NUMBER operator NUMBER” (space-delimited) and returns the result. Should understand plus <code>+</code> and minus <code>-</code>.</p>
<p>Usage example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let calc = new Calculator;

alert( calc.calculate("3 + 7") ); // 10</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Then add the method <code>addOperator(name, func)</code> that teaches the calculator a new operation. It takes the operator <code>name</code> and the two-argument function <code>func(a,b)</code> that implements it.</p>
<p>For instance, let's add the multiplication <code>*</code>, division <code>/</code> and power <code>**</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let powerCalc = new Calculator;
powerCalc.addMethod("*", (a, b) =&gt; a * b);
powerCalc.addMethod("/", (a, b) =&gt; a / b);
powerCalc.addMethod("**", (a, b) =&gt; a ** b);

let result = powerCalc.calculate("2 ** 3");
alert( result ); // 8</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<ul>
<li>No brackets or complex expressions in this task.</li>
<li>The numbers and the operator are delimited with exactly one space.</li>
<li>There may be error handling if you'd like to add it.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/vCf22OGYDXKjjzwkh0jc?p=preview" target="_blank" data-plunk-id="vCf22OGYDXKjjzwkh0jc">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><ul>
<li>Please note how methods are stored. They are simply added to the internal object.</li>
<li>All tests and numeric conversions are done in the <code>calculate</code> method. In future it may be extended to support more complex expressions.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/KAgnUzk2uCspMmJIBZqN?p=preview" target="_blank" data-plunk-id="KAgnUzk2uCspMmJIBZqN">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-274"></h6>
<h1 class="main__header-title" id="chapter-275">Data types</h1>
<p>More data structures and more in-depth study of the types.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/primitives-methods" class="lessons-list__link">Methods of primitives</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/number" class="lessons-list__link">Numbers</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/string" class="lessons-list__link">Strings</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/array" class="lessons-list__link">Arrays</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/array-methods" class="lessons-list__link">Array methods</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/iterable" class="lessons-list__link">Iterables</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/map-set-weakmap-weakset" class="lessons-list__link">Map, Set, WeakMap and WeakSet</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/keys-values-entries" class="lessons-list__link">Object.keys, values, entries</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/destructuring-assignment" class="lessons-list__link">Destructuring assignment</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/date" class="lessons-list__link">Date and time</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/json" class="lessons-list__link">JSON methods, toJSON</a></li></ol></div>

<h6 id="chapter-276"></h6>
<h1 class="main__header-title" id="chapter-277">Methods of primitives</h1>
<p>JavaScript allows us to work with primitives (strings, numbers etc) as if they were objects.</p>
<p>They also provide methods to call and such. We will study those soon, but first we'll see how it works, because, of course, primitives are not objects (and here we will make it even more clear).</p>


<p>Let's look at the key distinction between primitives and objects.</p>
<p>A primitive</p>
<dl>
<dt>An object</dt>
<dd>Is capable of storing multiple values as properties.
Can be created with <code>{}</code>, for instance: <code>{name: "John", age: 30}</code>. There are other kinds of objects in JavaScript, e.g. functions are objects.</dd>
</dl>
<p>One of the best things about objects is that we can store a function as one of its properties:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = {
  name: "John",
  sayHi: function() {
    alert("Hi buddy!");
  }
};

john.sayHi(); // Hi buddy!</code></pre>
        </div>
      </div>
      
      </div><p>So here we've made an object <code>john</code> with the method <code>sayHi</code>.</p>
<p>Many built-in objects already exist, such as those that work with dates, errors, HTML elements etc. They have different properties and methods.</p>
<p>But, these features come with a cost!</p>
<p>Objects are “heavier” than primitives. They require additional resources to support the internal machinery. But as properties and methods are very useful in programming, JavaScript engines try to optimize them to reduce the additional burden.</p>
<h2 id="chapter-278">
A primitive as an object</h2>
<p>Here's the paradox faced by the creator of JavaScript:</p>
<ul>
<li>There are many things one would want to do with a primitive like a string or a number. It would be great to access them as methods.</li>
<li>Primitives must be as fast and lightweight as possible.</li>
</ul>
<p>The solution looks a little bit awkward, but here it is:</p>
<ol>
<li>Primitives are still primitive. A single value, as desired.</li>
<li>The language allows access to methods and properties of strings, numbers, booleans and symbols.</li>
<li>When this happens, a special “object wrapper” is created that provides the extra functionality, and then is destroyed.</li>
</ol>
<p>The “object wrappers” are different for each primitive type and are called: <code>String</code>, <code>Number</code>, <code>Boolean</code> and <code>Symbol</code>. Thus, they provide different sets of methods.</p>
<p>For instance, there exists a method 
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/toUpperCase">str.toUpperCase()</a> that returns a capitalized string.</p>
<p>Here's how it works:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Hello";

alert( str.toUpperCase() ); // HELLO</code></pre>
        </div>
      </div>
      
      </div><p>Simple, right? Here's what actually happens in <code>str.toUpperCase()</code>:</p>
<ol>
<li>The string <code>str</code> is a primitive. So in the moment of accessing its property, a special object is created that knows the value of the string, and has useful methods, like <code>toUpperCase()</code>.</li>
<li>That method runs and returns a new string (shown by <code>alert</code>).</li>
<li>The special object is destroyed, leaving the primitive <code>str</code> alone.</li>
</ol>
<p>So primitives can provide methods, but they still remain lightweight.</p>
<p>The JavaScript engine highly optimizes this process. It may even skip the creation of the extra object at all. But it must still adhere to the specification and behave as if it creates one.</p>
<p>A number has methods of its own, for instance, 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed">toFixed(n)</a> rounds the number to the given precision:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let n = 1.23456;

alert( n.toFixed(2) ); // 1.23</code></pre>
        </div>
      </div>
      
      </div><p>We'll see more specific methods in chapters 
<a href="http://javascript.info/number">Numbers</a> and 
<a href="http://javascript.info/string">Strings</a>.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Constructors <code>String/Number/Boolean</code> are for internal use only</span></div>
            <div class="important__content"><p>Some languages like Java allow us to create “wrapper objects” for primitives explicitly using a syntax like <code>new Number(1)</code> or <code>new Boolean(false)</code>.</p>
<p>In JavaScript, that's also possible for historical reasons, but highly <strong>unrecommended</strong>. Things will go crazy in several places.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( typeof 1 ); // "number"

alert( typeof new Number(1) ); // "object"!</code></pre>
        </div>
      </div>
      
      </div><p>And because what follows, <code>zero</code>, is an object, the alert will show up:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let zero = new Number(0);

if (zero) { // zero is true, because it's an object
  alert( "zero is truthy?!?" );
}</code></pre>
        </div>
      </div>
      
      </div><p>On the other hand, using the same functions <code>String/Number/Boolean</code> without <code>new</code> is a totally sane and useful thing. They convert a value to the corresponding type: to a string, a number, or a boolean (primitive).</p>
<p>For example, this is entirely valid:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = Number("123"); // convert a string to number</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">null/undefined have no methods</span></div>
            <div class="important__content"><p>The special primitives <code>null</code> and <code>undefined</code> are exceptions. They have no corresponding “wrapper objects” and provide no methods. In a sense, they are “the most primitive”.</p>
<p>An attempt to access a property of such value would give the error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(null.test); // error</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-279">
Summary</h2>
<ul>
<li>Primitives except <code>null</code> and <code>undefined</code> provide many helpful methods. We will study those in the upcoming chapters.</li>
<li>Formally, these methods work via temporary objects, but JavaScript engines are well tuned to optimize that internally, so they are not expensive to call.</li>
</ul>
<div class="tasks"><h2 id="chapter-280" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#can-i-add-a-string-property" name="can-i-add-a-string-property" class="main__anchor">Can I add a string property?</a></h3>
<a href="http://javascript.info/task/string-new-property" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Consider the following code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Hello";

str.test = 5;

alert(str.test);</code></pre>
        </div>
      </div>
      
      </div><p>How do you think, will it work? What will be shown?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Try running it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Hello";

str.test = 5; // (*)

alert(str.test);</code></pre>
        </div>
      </div>
      
      </div><p>There may be two kinds of result:</p>
<ol>
<li><code>undefined</code></li>
<li>An error.</li>
</ol>
<p>Why? Let's replay what's happening at line <code>(*)</code>:</p>
<ol>
<li>When a property of <code>str</code> is accessed, a “wrapper object” is created.</li>
<li>The operation with the property is carried out on it. So, the object gets the <code>test</code> property.</li>
<li>The operation finishes and the “wrapper object” disappears.</li>
</ol>
<p>So, on the last line, <code>str</code> has no trace of the property. A new wrapper object for every object operation on a string.</p>
<p>Some browsers though may decide to further limit the programmer and disallow to assign properties to primitives at all. That's why in practice we can also see errors at line <code>(*)</code>. It's a little bit farther from the specification though.</p>
<p><strong>This example clearly shows that primitives are not objects.</strong></p>
<p>They just can not store data.</p>
<p>All property/method operations are performed with the help of temporary objects.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-281"></h6>
<h1 class="main__header-title" id="chapter-282">Numbers</h1>
<p>All numbers in JavaScript are stored in 64-bit format 
<a href="http://en.wikipedia.org/wiki/IEEE_754-1985">IEEE-754</a>, also known as “double precision”.</p>
<p>Let's recap and expand upon what we currently know about them.</p>
<h2 id="chapter-283">
More ways to write a number</h2>
<p>Imagine we need to write 1 billion. The obvious way is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let billion = 1000000000;</code></pre>
        </div>
      </div>
      
      </div><p>But in real life we usually avoid writing a long string of zeroes as it's easy to mistype. Also, we are lazy. We will usually write something like <code>"1bn"</code> for a billion or <code>"7.3bn"</code> for 7 billion 300 million. The same is true for most large numbers.</p>
<p>In JavaScript, we shorten a number by appending the letter <code>"e"</code> to the number and specifying the zeroes count:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let billion = 1e9;  // 1 billion, literally: 1 and 9 zeroes

alert( 7.3e9 );  // 7.3 billions (7,300,000,000)</code></pre>
        </div>
      </div>
      
      </div><p>In other words, <code>"e"</code> multiplies the number by <code>1</code> with the given zeroes count.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">1e3 = 1 * 1000
1.23e6 = 1.23 * 1000000</code></pre>
        </div>
      </div>
      
      </div><p>Now let's write something very small. Say, 1 microsecond (one millionth of a second):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let ms = 0.000001;</code></pre>
        </div>
      </div>
      
      </div><p>Just like before, using <code>"e"</code> can help. If we'd like to avoid writing the zeroes explicitly, we could say:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let ms = 1e-6; // six zeroes to the left from 1</code></pre>
        </div>
      </div>
      
      </div><p>If we count the zeroes in <code>0.000001</code>, there are 6 of them. So naturally it's <code>1e-6</code>.</p>
<p>In other words, a negative number after <code>"e"</code> means a division by 1 with the given number of zeroes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// -3 divides by 1 with 3 zeroes
1e-3 = 1 / 1000 (=0.001)

// -6 divides by 1 with 6 zeroes
1.23e-6 = 1.23 / 1000000 (=0.00000123)</code></pre>
        </div>
      </div>
      
      </div><h3>
Hex, binary and octal numbers</a></h3><p>
<a href="https://en.wikipedia.org/wiki/Hexadecimal">Hexadecimal</a> numbers are widely used in JavaScript to represent colors, encode characters, and for many other things. So naturally, there exists a shorter way to write them: <code>0x</code> and then the number.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 0xff ); // 255
alert( 0xFF ); // 255 (the same, case doesn't matter)</code></pre>
        </div>
      </div>
      
      </div><p>Binary and octal numeral systems are rarely used, but also supported using the <code>0b</code> and <code>0o</code> prefixes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = 0b11111111; // binary form of 255
let b = 0o377; // octal form of 255

alert( a == b ); // true, the same number 255 at both sides</code></pre>
        </div>
      </div>
      
      </div><p>There are only 3 numeral systems with such support. For other numeral systems, we should use the function <code>parseInt</code> (which we will see later in this chapter).</p>
<h2 id="chapter-284">
toString(base)</h2>
<p>The method <code>num.toString(base)</code> returns a string representation of <code>num</code> in the numeral system with the given <code>base</code>.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = 255;

alert( num.toString(16) );  // ff
alert( num.toString(2) );   // 11111111</code></pre>
        </div>
      </div>
      
      </div><p>The <code>base</code> can vary from <code>2</code> to <code>36</code>. By default it's <code>10</code>.</p>
<p>Common use cases for this are:</p>
<ul>
<li>
<p><strong>base=16</strong> is used for hex colors, character encodings etc, digits can be <code>0..9</code> or <code>A..F</code>.</p>
</li>
<li>
<p><strong>base=2</strong> is mostly for debugging bitwise operations, digits can be <code>0</code> or <code>1</code>.</p>
</li>
<li>
<p><strong>base=36</strong> is the maximum, digits can be <code>0..9</code> or <code>A..Z</code>. The whole latin alphabet is used to represent a number. A funny, but useful case for <code>36</code> is when we need to turn a long numeric identifier into something shorter, for example to make a short url. Can simply represent it in the numeral system with base <code>36</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 123456..toString(36) ); // 2n9c</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Two dots to call a method</span></div>
            <div class="important__content"><p>Please note that two dots in <code>123456..toString(36)</code> is not a typo. If we want to call a method directly on a number, like <code>toString</code> in the example above, then we need to place two dots <code>..</code> after it.</p>
<p>If we placed a single dot: <code>123456.toString(36)</code>, then there would be an error, because JavaScript syntax implies the decimal part after the first dot. And if we place one more dot, then JavaScript knows that the decimal part is empty and now goes the method.</p>
<p>Also could write <code>(123456).toString(36)</code>.</p>
</div></div>
<h2 id="chapter-285">
Rounding</h2>
<p>One of the most used operations when working with numbers is rounding.</p>
<p>There are several built-in functions for rounding:</p>
<dl>
<dt><code>Math.floor</code></dt>
<dd>Rounds down: <code>3.1</code> becomes <code>3</code>, and <code>-1.1</code> becomes <code>-2</code>.</dd>
<dt><code>Math.ceil</code></dt>
<dd>Rounds up: <code>3.1</code> becomes <code>4</code>, and <code>-1.1</code> becomes <code>-1</code>.</dd>
<dt><code>Math.round</code></dt>
<dd>Rounds to the nearest integer: <code>3.1</code> becomes <code>3</code>, <code>3.6</code> becomes <code>4</code> and <code>-1.1</code> becomes <code>-1</code>.</dd>
<dt><code>Math.trunc</code> (not supported by Internet Explorer)</dt>
<dd>Removes anything after the decimal point without rounding: <code>3.1</code> becomes <code>3</code>, <code>-1.1</code> becomes <code>-1</code>.</dd>
</dl>
<p>Here's the table to summarize the differences between them:</p>
<table>
<thead>
<tr>
<th></th>
<th><code>Math.floor</code></th>
<th><code>Math.ceil</code></th>
<th><code>Math.round</code></th>
<th><code>Math.trunc</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>3.1</code></td>
<td><code>3</code></td>
<td><code>4</code></td>
<td><code>3</code></td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>3.6</code></td>
<td><code>3</code></td>
<td><code>4</code></td>
<td><code>4</code></td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>-1.1</code></td>
<td><code>-2</code></td>
<td><code>-1</code></td>
<td><code>-1</code></td>
<td><code>-1</code></td>
</tr>
<tr>
<td><code>-1.6</code></td>
<td><code>-2</code></td>
<td><code>-1</code></td>
<td><code>-2</code></td>
<td><code>-1</code></td>
</tr>
</tbody>
</table>
<p>These functions cover all of the possible ways to deal with the decimal part of a number. But what if we'd like to round the number to <code>n-th</code> digit after the decimal?</p>
<p>For instance, we have <code>1.2345</code> and want to round it to 2 digits, getting only <code>1.23</code>.</p>
<p>There are two ways to do so:</p>
<ol>
<li>
<p>Multiply-and-divide.</p>
<p>For example, to round the number to the 2nd digit after the decimal, we can multiply the number by <code>100</code>, call the rounding function and then divide it back.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = 1.23456;

alert( Math.floor(num * 100) / 100 ); // 1.23456 -&gt; 123.456 -&gt; 123 -&gt; 1.23</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>The method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed">toFixed(n)</a> rounds the number to <code>n</code> digits after the point and returns a string representation of the result.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = 12.34;
alert( num.toFixed(1) ); // "12.3"</code></pre>
        </div>
      </div>
      
      </div><p>This rounds up or down to the nearest value, similar to <code>Math.round</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = 12.36;
alert( num.toFixed(1) ); // "12.4"</code></pre>
        </div>
      </div>
      
      </div><p>Please note that result of <code>toFixed</code> is a string. If the decimal part is shorter than required, zeroes are appended to the end:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = 12.34;
alert( num.toFixed(5) ); // "12.34000", added zeroes to make exactly 5 digits</code></pre>
        </div>
      </div>
      
      </div><p>We can convert it to a number using the unary plus or a <code>Number()</code> call: <code>+num.toFixed(5)</code>.</p>
</li>
</ol>
<h2 id="chapter-286">
Imprecise calculations</h2>
<p>Internally, a number is represented in 64-bit format 
<a href="http://en.wikipedia.org/wiki/IEEE_754-1985">IEEE-754</a>, so there are exactly 64 bits to store a number: 52 of them are used to store the digits, 11 of them store the position of the decimal point (they are zero for integer numbers), and 1 bit is for the sign.</p>
<p>If a number is too big, it would overflow the 64-bit storage, potentially giving an infinity:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1e500 ); // Infinity</code></pre>
        </div>
      </div>
      
      </div><p>What may be a little less obvious, but happens quite often, is the loss of precision.</p>
<p>Consider this (falsy!) test:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:30-35">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 0.1 + 0.2 == 0.3 ); // false</code></pre>
        </div>
      </div>
      
      </div><p>That's right, if we check whether the sum of <code>0.1</code> and <code>0.2</code> is <code>0.3</code>, we get <code>false</code>.</p>
<p>Strange! What is it then if not <code>0.3</code>?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 0.1 + 0.2 ); // 0.30000000000000004</code></pre>
        </div>
      </div>
      
      </div><p>Ouch! There are more consequences than an incorrect comparison here. Imagine you're making an e-shopping site and the visitor puts <code>$0.10</code> and <code>$0.20</code> goods into his chart. The order total will be <code>$0.30000000000000004</code>. That would surprise anyone.</p>
<p>But why does this happen?</p>
<p>A number is stored in memory in its binary form, a sequence of ones and zeroes. But fractions like <code>0.1</code>, <code>0.2</code> that look simple in the decimal numeric system are actually unending fractions in their binary form.</p>
<p>In other words, what is <code>0.1</code>? It is one divided by ten <code>1/10</code>, one-tenth. In decimal numeral system such numbers are easily representable. Compare it to one-third: <code>1/3</code>. It becomes an endless fraction <code>0.33333(3)</code>.</p>
<p>So, division by powers <code>10</code> is guaranteed to work well in the decimal system, but division by <code>3</code> is not. For the same reason, in the binary numeral system, the division by powers of <code>2</code> is guaranteed to work, but <code>1/10</code> becomes an endless binary fraction.</p>
<p>There's just no way to store <em>exactly 0.1</em> or <em>exactly 0.2</em> using the binary system, just like there is no way to store one-third as a decimal fraction.</p>
<p>The numeric format IEEE-754 solves this by rounding to the nearest possible number. These rounding rules normally don't allow us to see that “tiny precision loss”, so the number shows up as <code>0.3</code>. But beware, the loss still exists.</p>
<p>We can see this in action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 0.1.toFixed(20) ); // 0.10000000000000000555</code></pre>
        </div>
      </div>
      
      </div><p>And when we sum two numbers, their “precision losses” add up.</p>
<p>That's why <code>0.1 + 0.2</code> is not exactly <code>0.3</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Not only JavaScript</span></div>
            <div class="important__content"><p>The same issue exists in many other programming languages.</p>
<p>PHP, Java, C, Perl, Ruby give exactly the same result, because they are based on the same numeric format.</p>
</div></div>
<p>Can we work around the problem? Sure, there're a number of ways:</p>
<ol>
<li>
<p>We can round the result with the help of a method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed">toFixed(n)</a>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sum = 0.1 + 0.2;
alert( sum.toFixed(2) ); // 0.30</code></pre>
        </div>
      </div>
      
      </div><p>Please note that <code>toFixed</code> always returns a string. It ensures that it has 2 digits after the decimal point. That's actually convenient if we have an e-shopping and need to show <code>$0.30</code>. For other cases, we can use the unary plus to coerce it into a number:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sum = 0.1 + 0.2;
alert( +sum.toFixed(2) ); // 0.3</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>We can temporarily turn numbers into integers for the maths and then revert it back. It works like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( (0.1 * 10 + 0.2 * 10) / 10 ); // 0.3</code></pre>
        </div>
      </div>
      
      </div><p>This works because when we do <code>0.1 * 10 = 1</code> and <code>0.2 * 10 = 2</code> then both numbers become integers, and there's no precision loss.</p>
</li>
<li>
<p>If we were dealing with a shop, then the most radical solution would be to store all prices in cents and use no fractions at all. But what if we apply a discount of 30%? In practice, totally evading fractions is rarely feasible, so the solutions above help avoid this pitfall.</p>
</li>
</ol>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The funny thing</span></div>
            <div class="important__content"><p>Try running this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Hello! I'm a self-increasing number!
alert( 9999999999999999 ); // shows 10000000000000000</code></pre>
        </div>
      </div>
      
      </div><p>This suffers from the same issue: a loss of precision. There are 64 bits for the number, 52 of them can be used to store digits, but that's not enough. So the least significant digits disappear.</p>
<p>JavaScript doesn't trigger an error in such events. It does its best to fit the number into the desired format, but unfortunately, this format is not big enough.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Two zeroes</span></div>
            <div class="important__content"><p>Another funny consequence of the internal representation of numbers is the existence of two zeroes: <code>0</code> and <code>-0</code>.</p>
<p>That's because a sign is represented by a single bit, so every number can be positive or negative, including a zero.</p>
<p>In most cases the distinction is unnoticeable, because operators are suited to treat them as the same.</p>
</div></div>
<h2 id="chapter-287">
Tests: isFinite and isNaN</h2>
<p>Remember these two special numeric values?</p>
<ul>
<li><code>Infinite</code> (and <code>-Infinite</code>) is a special numeric value that is greater (less) than anything.</li>
<li><code>NaN</code> represents an error.</li>
</ul>
<p>They belong to the type <code>number</code>, but are not “normal” numbers, so there are special functions to check for them:</p>
<ul>
<li>
<p><code>isNaN(value)</code> converts its argument to a number and then tests it for being <code>NaN</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( isNaN(NaN) ); // true
alert( isNaN("str") ); // true</code></pre>
        </div>
      </div>
      
      </div><p>But do we need this function? Can't we just use the comparison <code>=== NaN</code>? Sorry, but the answer is no. The value <code>NaN</code> is unique in that it does not equal anything, including itself:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( NaN === NaN ); // false</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p><code>isFinite(value)</code> converts its argument to a number and returns <code>true</code> if it's a regular number, not <code>NaN/Infinity/-Infinity</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( isFinite("15") ); // true
alert( isFinite("str") ); // false, because a special value: NaN
alert( isFinite(Infinity) ); // false, because a special value: Infinity</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<p>Sometimes <code>isFinite</code> is used to validate whether a string value is a regular number:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = +prompt("Enter a number", '');

// will be true unless you enter Infinity, -Infinity or not a number
alert( isFinite(num) );</code></pre>
        </div>
      </div>
      
      </div><p>Please note that an empty or a space-only string is treated as <code>0</code> in all numeric functions including <code>isFinite</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Compare with <code>Object.is</code></span></div>
            <div class="important__content"><p>There is a special built-in method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is">Object.is</a> that compares values like <code>===</code>, but is more reliable for two edge cases:</p>
<ol>
<li>It works with <code>NaN</code>: <code>Object.is(NaN, NaN) === true</code>, that's a good thing.</li>
<li>Values <code>0</code> and <code>-0</code> are different: <code>Object.is(0, -0) === false</code>, it rarely matters, but these values technically are different.</li>
</ol>
<p>In all other cases, <code>Object.is(a, b)</code> is the same as <code>a === b</code>.</p>
<p>This way of comparison is often used in JavaScript specification. When an internal algorithm needs to compare two values for being exactly the same, it uses <code>Object.is</code> (internally called 
<a href="https://tc39.github.io/ecma262/#sec-samevalue">SameValue</a>).</p>
</div></div>
<h2 id="chapter-288">
parseInt and parseFloat</h2>
<p>Numeric conversion using a plus <code>+</code> or <code>Number()</code> is strict. If a value is not exactly a number, it fails:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( +"100px" ); // NaN</code></pre>
        </div>
      </div>
      
      </div><p>The sole exception is spaces at the beginning or at the end of the string, as they are ignored.</p>
<p>But in real life we often have values in units, like <code>"100px"</code> or <code>"12pt"</code> in CSS. Also in many countries the currency symbol goes after the amount, so we have <code>"19€"</code> and would like to extract a numeric value out of that.</p>
<p>That's what <code>parseInt</code> and <code>parseFloat</code> are for.</p>
<p>They “read” a number from a string until they can. In case of an error, the gathered number is returned. The function <code>parseInt</code> returns an integer, whilst <code>parseFloat</code> will return a floating-point number:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( parseInt('100px') ); // 100
alert( parseFloat('12.5em') ); // 12.5

alert( parseInt('12.3') ); // 12, only the integer part is returned
alert( parseFloat('12.3.4') ); // 12.3, the second point stops the reading</code></pre>
        </div>
      </div>
      
      </div><p>There are situations when <code>parseInt/parseFloat</code> will return <code>NaN</code>. It happens when no digits could be read:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( parseInt('a123') ); // NaN, the first symbol stops the process</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">The second argument of <code>parseInt(str, radix)</code></span></div>
            <div class="important__content"><p>The <code>parseInt()</code> function has an optional second parameter. It specifies the base of the numeral system, so <code>parseInt</code> can also parse strings of hex numbers, binary numbers and so on:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( parseInt('0xff', 16) ); // 255
alert( parseInt('ff', 16) ); // 255, without 0x also works

alert( parseInt('2n9c', 36) ); // 123456</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-289">
Other math functions</h2>
<p>JavaScript has a built-in 
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Math">Math</a> object which contains a small library of mathematical functions and constants.</p>
<p>A few examples:</p>
<dl>
<dt><code>Math.random()</code></dt>
<dd>
<p>Returns a random number from 0 to 1 (not including 1)</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Math.random() ); // 0.1234567894322
alert( Math.random() ); // 0.5435252343232
alert( Math.random() ); // ... (any random numbers)</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>Math.max(a, b, c...)</code> / <code>Math.min(a, b, c...)</code></dt>
<dd>
<p>Returns the greatest/smallest from the arbitrary number of arguments.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Math.max(3, 5, -10, 0, 1) ); // 5
alert( Math.min(1, 2) ); // 1</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>Math.pow(n, power)</code></dt>
<dd>
<p>Returns <code>n</code> raised the given power</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Math.pow(2, 10) ); // 2 in power 10 = 1024</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<p>There are more functions and constants in <code>Math</code> object, including trigonometry, which you can find in the 
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Math">docs for the Math</a> object.</p>
<h2 id="chapter-290">
Summary</h2>
<p>To write big numbers:</p>
<ul>
<li>Append <code>"e"</code> with the zeroes count to the number. Like: <code>123e6</code> is <code>123</code> with 6 zeroes.</li>
<li>A negative number after <code>"e"</code> causes the number to be divided by 1 with given zeroes. That's for one-millionth or such.</li>
</ul>
<p>For different numeral systems:</p>
<ul>
<li>Can write numbers directly in hex (<code>0x</code>), octal (<code>0o</code>) and binary (<code>0b</code>) systems</li>
<li><code>parseInt(str, base)</code> parses an integer from any numeral system with base: <code>2 ≤ base ≤ 36</code>.</li>
<li><code>num.toString(base)</code> converts a number to a string in the numeral system with the given <code>base</code>.</li>
</ul>
<p>For converting values like <code>12pt</code> and <code>100px</code> to a number:</p>
<ul>
<li>Use <code>parseInt/parseFloat</code> for the “soft” conversion, which reads a number from a string and then returns the value they could read before the error.</li>
</ul>
<p>For fractions:</p>
<ul>
<li>Round using <code>Math.floor</code>, <code>Math.ceil</code>, <code>Math.trunc</code>, <code>Math.round</code> or <code>num.toFixed(precision)</code>.</li>
<li>Make sure to remember there's a loss of precision when working with fractions.</li>
</ul>
<p>More mathematical functions:</p>
<ul>
<li>See the 
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Math">Math</a> object when you need them. The library is very small, but can cover basic needs.</li>
</ul>
<div class="tasks"><h2 id="chapter-291" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sum-numbers-from-the-visitor" name="sum-numbers-from-the-visitor" class="main__anchor">Sum numbers from the visitor</a></h3>
<a href="http://javascript.info/task/sum-interface" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a script that prompts the visitor to enter two numbers and then shows their sum.</p>
<p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p><p>P.S. There is a gotcha with types.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let a = +prompt("The first number?", "");
let b = +prompt("The second number?", "");

alert( a + b );</code></pre>
        </div>
      </div>
      
      </div><p>Note the unary plus <code>+</code> before <code>prompt</code>. It immediately converts the value to a number.</p>
<p>Otherwise, <code>a</code> and <code>b</code> would be string their sum would be their concatenation, that is: <code>"1" + "2" = "12"</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#why-6-35-tofixed-1-6-3" name="why-6-35-tofixed-1-6-3" class="main__anchor">Why 6.35.toFixed(1) == 6.3?</a></h3>
<a href="http://javascript.info/task/why-rounded-down" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>According to the documentation <code>Math.round</code> and <code>toFixed</code> both round to the nearest number: <code>0..4</code> lead down while <code>5..9</code> lead up.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1.35.toFixed(1) ); // 1.4</code></pre>
        </div>
      </div>
      
      </div><p>In the similar example below, why is <code>6.35</code> rounded to <code>6.3</code>, not <code>6.4</code>?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 6.35.toFixed(1) ); // 6.3</code></pre>
        </div>
      </div>
      
      </div><p>How to round <code>6.35</code> the right way?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Internally the decimal fraction <code>6.35</code> is an endless binary. As always in such cases, it is stored with a precision loss.</p>
<p>Let's see:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 6.35.toFixed(20) ); // 6.34999999999999964473</code></pre>
        </div>
      </div>
      
      </div><p>The precision loss can cause both increase and decrease of a number. In this particular case the number becomes a tiny bit less, that's why it rounded down.</p>
<p>And what's for <code>1.35</code>?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 1.35.toFixed(20) ); // 1.35000000000000008882</code></pre>
        </div>
      </div>
      
      </div><p>Here the precision loss made the number a little bit greater, so it rounded up.</p>
<p><strong>How can we fix the problem with <code>6.35</code> if we want it to be rounded the right way?</strong></p>
<p>We should bring it closer to an integer prior to rounding:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( (6.35 * 10).toFixed(20) ); // 63.50000000000000000000</code></pre>
        </div>
      </div>
      
      </div><p>Note that <code>63.5</code> has no precision loss at all. That's because the decimal part <code>0.5</code> is actually <code>1/2</code>. Fractions divided by powers of <code>2</code> are exactly represented in the binary system, now we can round it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Math.round(6.35 * 10) / 10); // 6.35 -&gt; 63.5 -&gt; 64(rounded) -&gt; 6.4</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#repeat-until-the-input-is-a-number" name="repeat-until-the-input-is-a-number" class="main__anchor">Repeat until the input is a number</a></h3>
<a href="http://javascript.info/task/repeat-until-number" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a function <code>readNumber</code> which prompts for a number until the visitor enters a valid numeric value.</p>
<p>The resulting value must be returned as a number.</p>
<p>The visitor can also stop the process by entering an empty line or pressing “CANCEL”. In that case, the function should return <code>null</code>.</p>
<p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p><p>
<a href="http://plnkr.co/edit/UBlLg3VHdNALI7MfbnjS?p=preview" target="_blank" data-plunk-id="UBlLg3VHdNALI7MfbnjS">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function readNumber() {
  let num;

  do {
    num = prompt("Enter a number please?", 0);
  } while ( !isFinite(num) );

  if (num === null || num === '') return null;

  return +num;
}

alert(`Read: ${readNumber()}`);</code></pre>
        </div>
      </div>
      
      </div><p>The solution is a little bit more intricate that it could be because we need to handle <code>null</code>/empty lines.</p>
<p>So we actually accept the input until it is a “regular number”. Both <code>null</code> (cancel) and empty line also fit that condition, because in numeric form they are <code>0</code>.</p>
<p>After we stopped, we need to treat <code>null</code> and empty line specially (return <code>null</code>), because converting them to a number would return <code>0</code>.</p>
<p>
<a href="http://plnkr.co/edit/Kr22s0MIHmEaiPptXewM?p=preview" target="_blank" data-plunk-id="Kr22s0MIHmEaiPptXewM">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#an-occasional-infinite-loop" name="an-occasional-infinite-loop" class="main__anchor">An occasional infinite loop</a></h3>
<a href="http://javascript.info/task/endless-loop-error" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>This loop is infinite. It never ends. Why?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
while (i != 10) {
  i += 0.2;
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>That's because <code>i</code> would never equal <code>10</code>.</p>
<p>Run it to see the <em>real</em> values of <code>i</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;
while (i &lt; 11) {
  i += 0.2;
  if (i &gt; 9.8 &amp;&amp; i &lt; 10.2) alert( i );
}</code></pre>
        </div>
      </div>
      
      </div><p>None of them is exactly <code>10</code>.</p>
<p>Such things happen because of the precision losses when adding fractions like <code>0.2</code>.</p>
<p>Conclusion: evade equality checks when working with decimal fractions.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#a-random-number-from-min-to-max" name="a-random-number-from-min-to-max" class="main__anchor">A random number from min to max</a></h3>
<a href="http://javascript.info/task/random-min-max" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>The built-in function <code>Math.random()</code> creates a random value from <code>0</code> to <code>1</code> (not including <code>1</code>).</p>
<p>Write the function <code>random(min, max)</code> to generate a random floating-point number from <code>min</code> to <code>max</code> (not including <code>max</code>).</p>
<p>Examples of its work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( random(1, 5) ); // 1.2345623452
alert( random(1, 5) ); // 3.7894332423
alert( random(1, 5) ); // 4.3435234525</code></pre>
        </div>
      </div>
      
      </div><p>You can use the solution of the 
<a href="http://javascript.info/task/random-min-max">previous task</a> as the base.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We need to “map” all values from the interval 0…1 into values from <code>min</code> to <code>max</code>.</p>
<p>That can be done in two stages:</p>
<ol>
<li>If we multiply a random number from 0…1 by <code>max-min</code>, then it the interval of possible values increases <code>0..1</code> to <code>0..max-min</code>.</li>
<li>Now if we add <code>min</code>, the possible interval becomes from <code>min</code> to <code>max</code>.</li>
</ol>
<p>The function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function random(min, max) {
  return min + Math.random() * (max - min);
}

alert( random(1, 5) );
alert( random(1, 5) );
alert( random(1, 5) );</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#a-random-integer-from-min-to-max" name="a-random-integer-from-min-to-max" class="main__anchor">A random integer from min to max</a></h3>
<a href="http://javascript.info/task/random-int-min-max" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>Create a function <code>randomInteger(min, max)</code> that generates a random <em>integer</em> number from <code>min</code> to <code>max</code> including both <code>min</code> and <code>max</code> as possible values.</p>
<p>Any number from the interval <code>min..max</code> must appear with the same probability.</p>
<p>Examples of its work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( random(1, 5) ); // 1
alert( random(1, 5) ); // 3
alert( random(1, 5) ); // 5</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">The simple but wrong solution</button>
<div class="task__answer-content"><h4 class="task__step-title">The simple but wrong solution</h4><p>The simplest, but wrong solution would be to generate a value from <code>min</code> to <code>max</code> and round it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function randomInteger(min, max) {
  let rand = min + Math.random() * (max - min);
  return Math.round(rand);
}

alert( randomInteger(1, 3) );</code></pre>
        </div>
      </div>
      
      </div><p>The function works, but it is incorrect. The probability to get edge values <code>min</code> and <code>max</code> is two times less than any other.</p>
<p>If you run the example above many times, you would easily see that <code>2</code> appears the most often.</p>
<p>That happens because <code>Math.round()</code> gets random numbers from the interval <code>1..3</code> and rounds them as follows:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">values from 1    ... to 1.4999999999  become 1
values from 1.5  ... to 2.4999999999  become 2
values from 2.5  ... to 2.9999999999  become 3</code></pre>
        </div>
      </div>
      
      </div><p>Now we can clearly see that <code>1</code> gets twice less values than <code>2</code>. And the same with <code>3</code>.</p>
</div></div><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">The correct solution</button>
<div class="task__answer-content"><h4 class="task__step-title">The correct solution</h4><p>There are many correct solutions to the task. One of them is to adjust interval borders. To ensure the same intervals, we can generate values from <code>0.5 to 2.5</code>, thus adding the required probabilities to the edges:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function randomInteger(min, max) {
  // now rand is from  (min-0.5) to (max+0.5)
  let rand = min - 0.5 + Math.random() * (max - min + 1);
  return Math.round(rand);
}

alert( randomInteger(1, 3) );</code></pre>
        </div>
      </div>
      
      </div><p>An alternative way could be to use <code>Math.floor</code> for a random number from <code>min</code> to <code>max+1</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function randomInteger(min, max) {
  // here rand is from min to (max+1)
  let rand = min + Math.random() * (max + 1 - min);
  return Math.floor(rand);
}

alert( randomInteger(1, 3) );</code></pre>
        </div>
      </div>
      
      </div><p>Now all intervals are mapped this way:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">values from 1  ... to 1.9999999999  become 1
values from 2  ... to 2.9999999999  become 2
values from 3  ... to 3.9999999999  become 3</code></pre>
        </div>
      </div>
      
      </div><p>All intervals have the same length, making the final distribution uniform.</p>
</div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-292"></h6>
<h1 class="main__header-title" id="chapter-293">Strings</h1>
<p>In JavaScript, the textual data is stored as strings. There is no separate type for a single character.</p>
<p>The internal format for strings is always 
<a href="https://en.wikipedia.org/wiki/UTF-16">UTF-16</a>, it is not tied to the page encoding.</p>


<h2 id="chapter-294">
Quotes</h2>
<p>Let's recall the kinds of quotes.</p>
<p>Strings can be enclosed within either single quotes, double quotes or backticks:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let single = 'single-quoted';
let double = "double-quoted";

let backticks = `backticks`;</code></pre>
        </div>
      </div>
      
      </div><p>Single and double quotes are essentially the same. Backticks, however, allow us to embed any expression into the string, including function calls:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sum(a, b) {
  return a + b;
}

alert(`1 + 2 = ${sum(1, 2)}.`); // 1 + 2 = 3.</code></pre>
        </div>
      </div>
      
      </div><p>Another advantage of using backticks is that they allow a string to span multiple lines:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let guestList = `Guests:
 * John
 * Pete
 * Mary
`;

alert(guestList); // a list of guests, multiple lines</code></pre>
        </div>
      </div>
      
      </div><p>If we try to use single or double quotes in the same way, there will be an error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let guestList = "Guests:  // Error: Unexpected token ILLEGAL
  * John";</code></pre>
        </div>
      </div>
      
      </div><p>Single and double quotes come from ancient times of language creation when the need for multiline strings was not taken into account. Backticks appeared much later and thus are more versatile.</p>
<p>Backticks also allow us to specify a “template function” before the first backtick. The syntax is: <code>func`string`</code>. The function <code>func</code> is called automatically, receives the string and embedded expressions and can process them. You can read more about it in the 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_template_literals">docs</a>. This is called “tagged templates”. This feature makes it easier to wrap strings into custom templating or other functionality, but it is rarely used.</p>
<h2 id="chapter-295">
Special characters</h2>
<p>It is still possible to create multiline strings with single quotes by using a so-called “newline character”, written as <code>\n</code>, which denotes a line break:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let guestList = "Guests:\n * John\n * Pete\n * Mary";

alert(guestList); // a multiline list of guests</code></pre>
        </div>
      </div>
      
      </div><p>For example, these two lines describe the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Hello\nWorld" ); // two lines using a "newline symbol"

// two lines using a normal newline and backticks
alert( `Hello
World` );</code></pre>
        </div>
      </div>
      
      </div><p>There are other, less common “special” characters as well. Here's the list:</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\b</code></td>
<td>Backspace</td>
</tr>
<tr>
<td><code>\f</code></td>
<td>Form feed</td>
</tr>
<tr>
<td><code>\n</code></td>
<td>New line</td>
</tr>
<tr>
<td><code>\r</code></td>
<td>Carriage return</td>
</tr>
<tr>
<td><code>\t</code></td>
<td>Tab</td>
</tr>
<tr>
<td><code>\uNNNN</code></td>
<td>A unicode symbol with the hex code <code>NNNN</code>, for instance <code>\u00A9</code> – is a unicode for the copyright symbol <code>©</code>. It must be exactly 4 hex digits.</td>
</tr>
<tr>
<td><code>\u{NNNNNNNN}</code></td>
<td>Some rare characters are encoded with two unicode symbols, taking up to 4 bytes. This long unicode requires braces around it.</td>
</tr>
</tbody>
</table>
<p>Examples with unicode:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "\u00A9" ); // ©
alert( "\u{20331}" ); // 佫, a rare chinese hieroglyph (long unicode)
alert( "\u{1F60D}" ); // 😍, a smiling face symbol (another long unicode)</code></pre>
        </div>
      </div>
      
      </div><p>All special characters start with a backslash character <code>\</code>. It is also called an “escape character”.</p>
<p>We would also use it if we want to insert a quote into the string.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:9-11,0:32-35">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'I\'m the Walrus!' ); // I'm the Walrus!</code></pre>
        </div>
      </div>
      
      </div><p>As you can see, we have to prepend the inner quote by the backslash <code>\'</code>, because otherwise it would indicate the string end.</p>
<p>Of course, that refers only to the quotes that are same as the enclosing ones. So, as a more elegant solution, we could switch to double quotes or backticks instead:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( `I'm the Walrus!` ); // I'm the Walrus!</code></pre>
        </div>
      </div>
      
      </div><p>Note that the backslash <code>\</code> serves for the correct reading of the string by JavaScript, then disappears. The in-memory string has no <code>\</code>. You can clearly see that in <code>alert</code> from the examples above.</p>
<p>But what if we need to show an actual backslash <code>\</code> within the string?</p>
<p>That's possible, but we need to double it like <code>\\</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( `The backslash: \\` ); // The backslash: \</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-296">
String length</h2>
<p>The <code>length</code> property has the string length:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( `My\n`.length ); // 3</code></pre>
        </div>
      </div>
      
      </div><p>Note that <code>\n</code> is a single “special” character, so the length is indeed <code>3</code>.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><code>length</code> is a property</span></div>
            <div class="important__content"><p>People with a background in some other languages sometimes mistype by calling <code>str.length()</code> instead of just <code>str.length</code>. That doesn't work.</p>
<p>Please note that <code>str.length</code> is a numeric property, not a function. There is no need to add brackets after it.</p>
</div></div>
<h2 id="chapter-297">
Accessing characters</h2>
<p>To get a character at position <code>pos</code>, use square brackets <code>[pos]</code> or call the method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt">str.charAt(pos)</a>. The first character starts from the zero position:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = `Hello`;

// the first character
alert( str[0] ); // H
alert( str.charAt(0) ); // H

// the last character
alert( str[str.length - 1] ); // o</code></pre>
        </div>
      </div>
      
      </div><p>The square brackets are a modern way of getting a character, while <code>charAt</code> exists mostly for historical reasons.</p>
<p>The only difference between them is that if no character is found, <code>[]</code> returns <code>undefined</code>, and <code>charAt</code> returns an empty string:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = `Hello`;

alert( str[1000] ); // undefined
alert( str.charAt(1000) ); // '' (an empty string)</code></pre>
        </div>
      </div>
      
      </div><p>We can also iterate over characters using <code>for..of</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let char of "Hello") {
  alert(char); // H,e,l,l,o (char becomes "H", then "e", then "l" etc)
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-298">
Strings are immutable</h2>
<p>Strings can't be changed in JavaScript. It is impossible to change a character.</p>
<p>Let's try it to show that it doesn't work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = 'Hi';

str[0] = 'h'; // error
alert( str[0] ); // doesn't work</code></pre>
        </div>
      </div>
      
      </div><p>The usual workaround is to create a whole new string and assign it to <code>str</code> instead of the old one.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = 'Hi';

str = 'h' + str[1];  // replace the string

alert( str ); // hi</code></pre>
        </div>
      </div>
      
      </div><p>In the following sections we'll see more examples of this.</p>
<h2 id="chapter-299">
Changing the case</h2>
<p>Methods 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toLowerCase">toLowerCase()</a> and 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toUpperCase">toUpperCase()</a> change the case:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'Interface'.toUpperCase() ); // INTERFACE
alert( 'Interface'.toLowerCase() ); // interface</code></pre>
        </div>
      </div>
      
      </div><p>Or, if we want a single character lowercased:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'Interface'[0].toLowerCase() ); // 'i'</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-300">
Searching for a substring</h2>
<p>There are multiple ways to look for a substring within a string.</p>
<h3>
str.indexOf</a></h3><p>The first method is 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/indexOf">str.indexOf(substr, pos)</a>.</p>
<p>It looks for the <code>substr</code> in <code>str</code>, starting from the given position <code>pos</code>, and returns the position where the match was found or <code>-1</code> if nothing can be found.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = 'Widget with id';

alert( str.indexOf('Widget') ); // 0, because 'Widget' is found at the beginning
alert( str.indexOf('widget') ); // -1, not found, the search is case-sensitive

alert( str.indexOf("id") ); // 1, "id" is found at the position 1 (..idget with id)</code></pre>
        </div>
      </div>
      
      </div><p>The optional second parameter allows us to search starting from the given position.</p>
<p>For instance, the first occurrence of <code>"id"</code> is at position <code>1</code>. To look for the next occurrence, let's start the search from position <code>2</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = 'Widget with id';

alert( str.indexOf('id', 2) ) // 12</code></pre>
        </div>
      </div>
      
      </div><p>If we're interested in all occurrences, we can run <code>indexOf</code> in a loop. Every new call is made with the position after the previous match:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = 'As sly as a fox, as strong as an ox';

let target = 'as'; // let's look for it

let pos = 0;
while (true) {
  let foundPos = str.indexOf(target, pos);
  if (foundPos == -1) break;

  alert( `Found at ${foundPos}` );
  pos = foundPos + 1; // continue the search from the next position
}</code></pre>
        </div>
      </div>
      
      </div><p>The same algorithm can be layed out shorter:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "As sly as a fox, as strong as an ox";
let target = "as";

let pos = -1;
while ((pos = str.indexOf(target, pos + 1)) != -1) {
  alert( pos );
}</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>str.lastIndexOf(pos)</code></span></div>
            <div class="important__content"><p>There is also a similar method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/lastIndexOf">str.lastIndexOf(pos)</a> that searches from the end of a string to its beginning.</p>
<p>It would list the occurrences in the reverse order.</p>
</div></div>
<p>There is a slight inconvenience with <code>indexOf</code> in the <code>if</code> test. We can't put it in the <code>if</code> like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Widget with id";

if (str.indexOf("Widget")) {
    alert("We found it"); // doesn't work!
}</code></pre>
        </div>
      </div>
      
      </div><p>The <code>alert</code> in the example above doesn't show because <code>str.indexOf("Widget")</code> returns <code>0</code> (meaning that it found the match at the starting position). Right, but <code>if</code> considers <code>0</code> to be <code>false</code>.</p>
<p>So, we should actually check for <code>-1</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Widget with id";

if (str.indexOf("Widget") != -1) {
    alert("We found it"); // works now!
}</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">The bitwise NOT trick</span></div>
            <div class="important__content"><p>One of the old tricks used here is the 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Bitwise_NOT">bitwise NOT</a> <code>~</code> operator. It converts the number to a 32-bit integer (removes the decimal part if exists) and then reverses all bits in its binary representation.</p>
<p>For 32-bit integers the call <code>~n</code> means exactly the same as <code>-(n+1)</code> (due to IEEE-754 format).</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( ~2 ); // -3, the same as -(2+1)
alert( ~1 ); // -2, the same as -(1+1)
alert( ~0 ); // -1, the same as -(0+1)
alert( ~-1 ); // 0, the same as -(-1+1)</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, <code>~n</code> is zero only if <code>n == -1</code>.</p>
<p>So, the test <code>if ( ~str.indexOf("...") )</code> is truthy that the result of <code>indexOf</code> is not <code>-1</code>. In other words, when there is a match.</p>
<p>People use it to shorten <code>indexOf</code> checks:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Widget";

if (~str.indexOf("Widget")) {
  alert( 'Found it!' ); // works
}</code></pre>
        </div>
      </div>
      
      </div><p>It is usually not recommended to use language features in a non-obvious way, but this particular trick is widely used in old code, so we should understand it.</p>
<p>Just remember: <code>if (~str.indexOf(...))</code> reads as “if found”.</p>
</div></div>
<h3>
includes, startsWith, endsWith</a></h3><p>The more modern method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes">str.includes(substr, pos)</a> returns <code>true/false</code> depending on whether <code>str</code> contains <code>substr</code> within.</p>
<p>It's the right choice if we need to test for the match, but don't need its position:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Widget with id".includes("Widget") ); // true

alert( "Hello".includes("Bye") ); // false</code></pre>
        </div>
      </div>
      
      </div><p>The optional second argument of <code>str.includes</code> is the position to start searching from:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Midget".includes("id") ); // true
alert( "Midget".includes("id", 3) ); // false, from position 3 there is no "id"</code></pre>
        </div>
      </div>
      
      </div><p>The methods 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith">str.startsWith</a> and 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith">str.endsWith</a> do exactly what they say:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Widget".startsWith("Wid") ); // true, "Widget" starts with "Wid"
alert( "Widget".endsWith("get") );   // true, "Widget" ends with "get"</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-301">
Getting a substring</h2>
<p>There are 3 methods in JavaScript to get a substring: <code>substring</code>, <code>substr</code> and <code>slice</code>.</p>
<dl>
<dt><code>str.slice(start [, end])</code></dt>
<dd>
<p>Returns the part of the string from <code>start</code> to (but not including) <code>end</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "stringify";
alert( str.slice(0, 5) ); // 'strin', the substring from 0 to 5 (not including 5)
alert( str.slice(0, 1) ); // 's', from 0 to 1, but not including 1, so only character at 0</code></pre>
        </div>
      </div>
      
      </div><p>If there is no second argument, then <code>slice</code> goes till the end of the string:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:13-20">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "stringify";
alert( str.slice(2) ); // ringify, from the 2nd position till the end</code></pre>
        </div>
      </div>
      
      </div><p>Negative values for <code>start/end</code> are also possible. They mean the position is counted from the string end:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:16-19">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "stringify";

// start at the 4th position from the right, end at the 1st from the right
alert( str.slice(-4, -1) ); // gif</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>str.substring(start [, end])</code></dt>
<dd>
<p>Returns the part of the string <em>between</em> <code>start</code> and <code>end</code>.</p>
<p>This is almost the same as <code>slice</code>, but it allows <code>start</code> to be greater than <code>end</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:13-17">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "stringify";

// these are same for substring
alert( str.substring(2, 6) ); // "ring"
alert( str.substring(6, 2) ); // "ring"

// ...but not for slice:
alert( str.slice(2, 6) ); // "ring" (the same)
alert( str.slice(6, 2) ); // "" (an empty string)</code></pre>
        </div>
      </div>
      
      </div><p>Negative arguments are (unlike slice) not supported, they are treated as <code>0</code>.</p>
</dd>
<dt><code>str.substr(start [, length])</code></dt>
<dd>
<p>Returns the part of the string from <code>start</code>, with the given <code>length</code>.</p>
<p>In contrast with the previous methods, this one allows us to specify the <code>length</code> instead of the ending position:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:13-17">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "stringify";
alert( str.substr(2, 4) ); // ring, from the 2nd position get 4 characters</code></pre>
        </div>
      </div>
      
      </div><p>The first argument may be negative, to count from the end:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:16-18">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "stringify";
alert( str.substr(-4, 2) ); // gi, from the 4th position get 2 characters</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<p>Let's recap these methods to avoid any confusion:</p>
<table>
<thead>
<tr>
<th>method</th>
<th>selects…</th>
<th>negatives</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slice(start, end)</code></td>
<td>from <code>start</code> to <code>end</code></td>
<td>allows negatives</td>
</tr>
<tr>
<td><code>substring(start, end)</code></td>
<td>between <code>start</code> and <code>end</code></td>
<td>negative values mean <code>0</code></td>
</tr>
<tr>
<td><code>substr(start, length)</code></td>
<td>from <code>start</code> get <code>length</code> characters</td>
<td>allows negative <code>start</code></td>
</tr>
</tbody>
</table>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Which one to choose?</span></div>
            <div class="important__content"><p>All of them can do the job. Formally, <code>substr</code> has a minor drawback: it is described not in the core JavaScript specification, but in Annex B, which covers browser-only features that exist mainly for historical reasons. So, non-browser environments may fail to support it. But in practice it works everywhere.</p>
<p>The author finds himself using <code>slice</code> almost all the time.</p>
</div></div>
<h2 id="chapter-302">
Comparing strings</h2>
<p>As we know from the chapter 
<a href="http://javascript.info/comparison">Comparisons</a>, strings are compared character-by-character in alphabetical order.</p>
<p>Although, there are some oddities.</p>
<ol>
<li>
<p>A lowercase letter is always greater than the uppercase:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'a' &gt; 'Z' ); // true</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Letters with diacritical marks are “out of order”:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'Österreich' &gt; 'Zealand' ); // true</code></pre>
        </div>
      </div>
      
      </div><p>This may lead to strange results if we sort these country names. Usually people would expect <code>Zealand</code> to come after <code>Österreich</code> in the list.</p>
</li>
</ol>
<p>To understand what happens, let's review the internal representation of strings in JavaScript.</p>
<p>All strings are encoded using 
<a href="https://en.wikipedia.org/wiki/UTF-16">UTF-16</a>. That is: each character has a corresponding numeric code. There are special methods that allow to get the character for the code and back.</p>
<dl>
<dt><code>str.codePointAt(pos)</code></dt>
<dd>
<p>Returns the code for the character at position <code>pos</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// different case letters have different codes
alert( "z".codePointAt(0) ); // 122
alert( "Z".codePointAt(0) ); // 90</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>String.fromCodePoint(code)</code></dt>
<dd>
<p>Creates a character by its numeric <code>code</code></p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( String.fromCodePoint(90) ); // Z</code></pre>
        </div>
      </div>
      
      </div><p>We can also add unicode characters by their codes using <code>\u</code> followed by the hex code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// 90 is 5a in hexadecimal system
alert( '\u005a' ); // Z</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<p>Now let's see the characters with codes <code>65..220</code> (the latin alphabet and a little bit extra) by making a string of them:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '';

for (let i = 65; i &lt;= 220; i++) {
  str += String.fromCodePoint(i);
}
alert( str );
// ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~
// ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜ</code></pre>
        </div>
      </div>
      
      </div><p>See? Capital characters go first, then a few special ones, then lowercase characters.</p>
<p>Now it becomes obvious why <code>a &gt; Z</code>.</p>
<p>The characters are compared by their numeric code. The greater code means that the character is greater. The code for <code>a</code> (97) is greater than the code for <code>Z</code> (90).</p>
<ul>
<li>All lowercase letters go after uppercase letters because their codes are greater.</li>
<li>Some letters like <code>Ö</code> stand apart from the main alphabet. Here, it's code is greater than anything from <code>a</code> to <code>z</code>.</li>
</ul>
<h3>
Correct comparisons</a></h3><p>The “right” algorithm to do string comparisons is more complex than it may seem, because alphabets are different for different languages. The same-looking letter may be located differently in different alphabets.</p>
<p>So, the browser needs to know the language to compare.</p>
<p>Luckily, all modern browsers (IE10- requires the additional library 
<a href="https://github.com/andyearnshaw/Intl.js/">Intl.JS</a>) support the internationalization standard 
<a href="http://www.ecma-international.org/ecma-402/1.0/ECMA-402.pdf">ECMA 402</a>.</p>
<p>It provides a special method to compare strings in different languages, following their rules.</p>
<p>The call 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare">str.localeCompare(str2)</a>:</p>
<ul>
<li>Returns <code>1</code> if <code>str</code> is greater than <code>str2</code> according to the language rules.</li>
<li>Returns <code>-1</code> if <code>str</code> is less than <code>str2</code>.</li>
<li>Returns <code>0</code> if they are equal.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'Österreich'.localeCompare('Zealand') ); // -1</code></pre>
        </div>
      </div>
      
      </div><p>This method actually has two additional arguments specified in 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare">the documentation</a>, which allows it to specify the language (by default taken from the environment) and setup additional rules like case sensitivity or should <code>"a"</code> and <code>"á"</code> be treated as the same etc.</p>
<h2 id="chapter-303">
Internals, Unicode</h2>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Advanced knowledge</span></div>
            <div class="important__content"><p>The section goes deeper into string internals. This knowledge will be useful for you if you plan to deal with emoji, rare mathematical of hieroglyphs characters or other rare symbols.</p>
<p>You can skip the section if you don't plan to support them.</p>
</div></div>
<h3>
Surrogate pairs</a></h3><p>Most symbols have a 2-byte code. Letters in most european languages, numbers, and even most hieroglyphs, have a 2-byte representation.</p>
<p>But 2 bytes only allow 65536 combinations and that's not enough for every possible symbol. So rare symbols are encoded with a pair of 2-byte characters called “a surrogate pair”.</p>
<p>The length of such symbols is <code>2</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '𝒳'.length ); // 2, MATHEMATICAL SCRIPT CAPITAL X
alert( '😂'.length ); // 2, FACE WITH TEARS OF JOY
alert( '𩷶'.length ); // 2, a rare chinese hieroglyph</code></pre>
        </div>
      </div>
      
      </div><p>Note that surrogate pairs did not exist at the time when JavaScript was created, and thus are not correctly processed by the language!</p>
<p>We actually have a single symbol in each of the strings above, but the <code>length</code> shows a length of <code>2</code>.</p>
<p><code>String.fromCodePoint</code> and <code>str.codePointAt</code> are few rare methods that deal with surrogate pairs right. They recently appeared in the language. Before them, there were only 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/fromCharCode">String.fromCharCode</a> and 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charCodeAt">str.charCodeAt</a>. These methods are actually the same as <code>fromCodePoint/codePointAt</code>, but don't work with surrogate pairs.</p>
<p>But, for instance, getting a symbol can be tricky, because surrogate pairs are treated as two characters:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '𝒳'[0] ); // strange symbols...
alert( '𝒳'[1] ); // ...pieces of the surrogate pair</code></pre>
        </div>
      </div>
      
      </div><p>Note that pieces of the surrogate pair have no meaning without each other. So the alerts in the example above actually display garbage.</p>
<p>Technically, surrogate pairs are also detectable by their codes: if a character has the code in the interval of <code>0xd800..0xdbff</code>, then it is the first part of the surrogate pair. The next character (second part) must have the code in interval <code>0xdc00..0xdfff</code>. These intervals are reserved exclusively for surrogate pairs by the standard.</p>
<p>In the case above:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// charCodeAt is not surrogate-pair aware, so it gives codes for parts

alert( '𝒳'.charCodeAt(0).toString(16) ); // d835, between 0xd800 and 0xdbff
alert( '𝒳'.charCodeAt(1).toString(16) ); // dcb3, between 0xdc00 and 0xdfff</code></pre>
        </div>
      </div>
      
      </div><p>You will find more ways to deal with surrogate pairs later in the chapter 
<a href="http://javascript.info/iterable">Iterables</a>. There are probably special libraries for that too, but nothing famous enough to suggest here.</p>
<h3>
Diacritical marks and normalization</a></h3><p>In many languages there are symbols that are composed of the base character with a mark above/under it.</p>
<p>For instance, the letter <code>a</code> can be the base character for: <code>àáâäãåā</code>. Most common “composite” character have their own code in the UTF-16 table. But not all of them, because there are too many possible combinations.</p>
<p>To support arbitrary compositions, UTF-16 allows us to use several unicode characters. The base character and one or many “mark” characters that “decorate” it.</p>
<p>For instance, if we have <code>S</code> followed by the special “dot above” character (code <code>\u0307</code>), it is shown as Ṡ.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'S\u0307' ); // Ṡ</code></pre>
        </div>
      </div>
      
      </div><p>If we need an additional mark above the letter (or below it) – no problem, just add the necessary mark character.</p>
<p>For instance, if we append a character “dot below” (code <code>\u0323</code>), then we'll have “S with dots above and below”: <code>Ṩ</code>.</p>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'S\u0307\u0323' ); // Ṩ</code></pre>
        </div>
      </div>
      
      </div><p>This provides great flexibility, but also an interesting problem: two characters may visually look the same, but be represented with different unicode compositions.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'S\u0307\u0323' ); // Ṩ, S + dot above + dot below
alert( 'S\u0323\u0307' ); // Ṩ, S + dot below + dot above

alert( 'S\u0307\u0323' == 'S\u0323\u0307' ); // false</code></pre>
        </div>
      </div>
      
      </div><p>To solve this, there exists a “unicode normalization” algorithm that brings each string to the single “normal” form.</p>
<p>It is implemented by 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize">str.normalize()</a>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "S\u0307\u0323".normalize() == "S\u0323\u0307".normalize() ); // true</code></pre>
        </div>
      </div>
      
      </div><p>It's funny that in our situation <code>normalize()</code> actually brings together a sequence of 3 characters to one: <code>\u1e68</code> (S with two dots).</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "S\u0307\u0323".normalize().length ); // 1

alert( "S\u0307\u0323".normalize() == "\u1e68" ); // true</code></pre>
        </div>
      </div>
      
      </div><p>In reality, this is not always the case. The reason being that the symbol <code>Ṩ</code> is “common enough”, so UTF-16 creators included it in the main table and gave it the code.</p>
<p>If you want to learn more about normalization rules and variants – they are described in the appendix of the Unicode standard: 
<a href="http://www.unicode.org/reports/tr15/">Unicode Normalization Forms</a>, but for most practical purposes the information from this section is enough.</p>
<h2 id="chapter-304">
Summary</h2>
<ul>
<li>There are 3 types of quotes. Backticks allow a string to span multiple lines and embed expressions.</li>
<li>Strings in JavaScript are encoded using UTF-16.</li>
<li>We can use special characters like <code>\n</code> and insert letters by their unicode using <code>\u...</code>.</li>
<li>To get a character, use: <code>[]</code>.</li>
<li>To get a substring, use: <code>slice</code> or <code>substring</code>.</li>
<li>To lowercase/uppercase a string, use: <code>toLowerCase/toUpperCase</code>.</li>
<li>To look for a substring, use: <code>indexOf</code>, or <code>includes/startsWith/endsWith</code> for simple checks.</li>
<li>To compare strings according to the language, use: <code>localeCompare</code>, otherwise they are compared by character codes.</li>
</ul>
<p>There are several other helpful methods in strings:</p>
<ul>
<li><code>str.trim()</code> – removes (“trims”) spaces from the beginning and end of the string.</li>
<li><code>str.repeat(n)</code> – repeats the string <code>n</code> times.</li>
<li>…and more. See the 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">manual</a> for details.</li>
</ul>
<p>Strings also have methods for doing search/replace with regular expressions. But that topic deserves a separate chapter, so we'll return to that later.</p>
<div class="tasks"><h2 id="chapter-305" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#uppercast-the-first-character" name="uppercast-the-first-character" class="main__anchor">Uppercast the first character</a></h3>
<a href="http://javascript.info/task/ucfirst" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>ucFirst(str)</code> that returns the string <code>str</code> with the uppercased first character, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ucFirst("john") == "John";</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/jkpZQpTFUjZoY3nFhzfm?p=preview" target="_blank" data-plunk-id="jkpZQpTFUjZoY3nFhzfm">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We can't “replace” the first character, because strings in JavaScript are immutable.</p>
<p>But we can make a new string based on the existing one, with the uppercased first character:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let newStr = str[0].toUpperCase() + str.slice(1);</code></pre>
        </div>
      </div>
      
      </div><p>There's a small problem though. If <code>str</code> is empty, then <code>str[0]</code> is undefined, so we'll get an error.</p>
<p>There are two variants here:</p>
<ol>
<li>Use <code>str.charAt(0)</code>, as it always returns a string (maybe empty).</li>
<li>Add a test for an empty string.</li>
</ol>
<p>Here's the 2nd variant:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function ucFirst(str) {
  if (!str) return str;

  return str[0].toUpperCase() + str.slice(1);
}

alert( ucFirst("john") ); // John</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/L846AsiE1zo0jJxT1T9D?p=preview" target="_blank" data-plunk-id="L846AsiE1zo0jJxT1T9D">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#check-for-spam" name="check-for-spam" class="main__anchor">Check for spam</a></h3>
<a href="http://javascript.info/task/check-spam" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>checkSpam(str)</code> that returns <code>true</code> if <code>str</code> contains ‘viagra' or ‘XXX', otherwise `false.</p>
<p>The function must be case-insensitive:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">checkSpam('buy ViAgRA now') == true
checkSpam('free xxxxx') == true
checkSpam("innocent rabbit") == false</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/cwgXbZg4juEn9vtteRDl?p=preview" target="_blank" data-plunk-id="cwgXbZg4juEn9vtteRDl">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To make the search case-insensitive, let's bring the stirng to lower case and then search:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function checkSpam(str) {
  let lowerStr = str.toLowerCase();

  return lowerStr.includes('viagra') || lowerStr.includes('xxx');
}

alert( checkSpam('buy ViAgRA now') );
alert( checkSpam('free xxxxx') );
alert( checkSpam("innocent rabbit") );</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/zsYta2ZnunXtzA7JzgCb?p=preview" target="_blank" data-plunk-id="zsYta2ZnunXtzA7JzgCb">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#truncate-the-text" name="truncate-the-text" class="main__anchor">Truncate the text</a></h3>
<a href="http://javascript.info/task/truncate" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a function <code>truncate(str, maxlength)</code> that checks the length of the <code>str</code> and, if it exceeds <code>maxlength</code> – replaces the end of <code>str</code> with the ellipsis character <code>"…"</code>, to make its length equal to <code>maxlength</code>.</p>
<p>The result of the function should be the truncated (if needed) string.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">truncate("What I'd like to tell on this topic is:", 20) = "What I'd like to te…"

truncate("Hi everyone!", 20) = "Hi everyone!"</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/WtKSHCRrcylXOBhfWsyd?p=preview" target="_blank" data-plunk-id="WtKSHCRrcylXOBhfWsyd">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The maximal length must be <code>maxlength</code>, so we need to cut it a little shorter, to give space for the ellipsis.</p>
<p>Note that there is actually a single unicode character for an ellipsis. That's not three dots.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function truncate(str, maxlength) {
  return (str.length &gt; maxlength) ?
    str.slice(0, maxlength - 1) + '…' : str;
}</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/cBh7vhFKodMBs0Cw3WFV?p=preview" target="_blank" data-plunk-id="cBh7vhFKodMBs0Cw3WFV">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#extract-the-money" name="extract-the-money" class="main__anchor">Extract the money</a></h3>
<a href="http://javascript.info/task/extract-currency" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>We have a cost in the form <code>"$120"</code>. That is: the dollar sign goes first, and then the number.</p>
<p>Create a function <code>extractCurrencyValue(str)</code> that would extract the numeric value from such string and return it.</p>
<p>The example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( extractCurrencyValue('$120') === 120 ); // true</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/DgSPKmfmQC18ApAYLxMr?p=preview" target="_blank" data-plunk-id="DgSPKmfmQC18ApAYLxMr">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/ME8EVErxR2UErybCOKIz?p=preview" target="_blank" data-plunk-id="ME8EVErxR2UErybCOKIz">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-306"></h6>
<h1 class="main__header-title" id="chapter-307">Arrays</h1>
<p>Objects allow to store keyed collections of values. That's fine.</p>
<p>But quite often we find that we need an <em>ordered collection</em>, where we have a 1st, a 2nd, a 3rd element and so on. For example, we need that to store a list of something: users, goods, HTML elements etc.</p>
<p>It is not convenient to use an object here, because it provides no methods to manage the order of elements. We can't insert a new property “between” the existing ones. Objects are just not meant for such use.</p>
<p>There exists a special data structure named <code>Array</code>, to store ordered collections.</p>


<h2 id="chapter-308">
Declaration</h2>
<p>There are two syntaxes for creating an empty array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = new Array();
let arr = [];</code></pre>
        </div>
      </div>
      
      </div><p>Almost all the time, the second syntax is used. We can supply initial elements in the brackets:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple", "Orange", "Plum"];</code></pre>
        </div>
      </div>
      
      </div><p>Array elements are numbered, starting with zero.</p>
<p>We can get an element by its number in square brackets:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple", "Orange", "Plum"];

alert( fruits[0] ); // Apple
alert( fruits[1] ); // Orange
alert( fruits[2] ); // Plum</code></pre>
        </div>
      </div>
      
      </div><p>We can replace an element:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fruits[2] = 'Pear'; // now ["Apple", "Orange", "Pear"]</code></pre>
        </div>
      </div>
      
      </div><p>…Or add a new one to the array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fruits[3] = 'Lemon'; // now ["Apple", "Orange", "Pear", "Lemon"]</code></pre>
        </div>
      </div>
      
      </div><p>The total count of the elements in the array is its <code>length</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple", "Orange", "Plum"];

alert( fruits.length ); // 3</code></pre>
        </div>
      </div>
      
      </div><p>We can also use <code>alert</code> to show the whole array.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple", "Orange", "Plum"];

alert( fruits ); // Apple,Orange,Plum</code></pre>
        </div>
      </div>
      
      </div><p>An array can store elements of any type.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// mix of values
let arr = [ 'Apple', { name: 'John' }, true, function() { alert('hello'); } ];

// get the object at index 1 and then show its name
alert( arr[1].name ); // John

// get the function at index 3 and run it
arr[3](); // hello</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Trailing comma</span></div>
            <div class="important__content"><p>An array, just like an object, may end with a comma:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:8-9">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = [
  "Apple",
  "Orange",
  "Plum",
];</code></pre>
        </div>
      </div>
      
      </div><p>The “trailing comma” style makes it easier to insert/remove items, because all lines become alike.</p>
</div></div>
<h2 id="chapter-309">
Methods pop/push, shift/unshift</h2>
<p>A 
<a href="https://en.wikipedia.org/wiki/Queue_(abstract_data_type)">queue</a> is one of most common uses of an array. In computer science, this means an ordered collection of elements which supports two operations:</p>
<ul>
<li><code>push</code> appends an element to the end.</li>
<li><code>shift</code> get an element from the beginning, advancing the queue, so that the 2nd element becomes the 1st.</li>
</ul>
      <img src="http://javascript.info/article/array/queue.png">
<p>Arrays support both operations.</p>
<p>In practice we meet it very often. For example, a queue of messages that need to be shown on-screen.</p>
<p>There's another use case for arrays – the data structure named 
<a href="https://en.wikipedia.org/wiki/Stack_(abstract_data_type)">stack</a>.</p>
<p>It supports two operations:</p>
<ul>
<li><code>push</code> adds an element to the end.</li>
<li><code>pop</code> takes an element from the end.</li>
</ul>
<p>So new elements are added or taken always from the “end”.</p>
<p>A stack is usually illustrated as a pack of cards: new cards are added to the top or taken from the top:</p>
      <img src="http://javascript.info/article/array/stack.png">
<p>For stacks, the latest pushed item is received first, that's also called LIFO (Last-In-First-Out) principle. For queues, we have FIFO (First-In-First-Out).</p>
<p>Arrays in JavaScript can work both as a queue and as a stack. They allow to add/remove elements both to/from the beginning or the end.</p>
<p>In computer science the data structure that allows it is called 
<a href="https://en.wikipedia.org/wiki/Double-ended_queue">deque</a>.</p>
<p><strong>Methods that work with the end of the array:</strong></p>
<dl>
<dt><code>pop</code></dt>
<dd>
<p>Extracts the last element of the array and returns it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple", "Orange", "Pear"];

alert( fruits.pop() ); // remove "Pear" and alert it

alert( fruits ); // Apple, Orange</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>push</code></dt>
<dd>
<p>Append the element to the end of the array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple", "Orange"];

fruits.push("Pear");

alert( fruits ); // Apple, Orange, Pear</code></pre>
        </div>
      </div>
      
      </div><p>The call <code>fruits.push(...)</code> is equal to <code>fruits[fruits.length] = ...</code>.</p>
</dd>
</dl>
<p><strong>Methods that work with the beginning of the array:</strong></p>
<dl>
<dt><code>shift</code></dt>
<dd>
<p>Extracts the first element of the array and returns it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple", "Orange", "Pear"];

alert( fruits.shift() ); // remove Apple and alert it

alert( fruits ); // Orange, Pear</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>unshift</code></dt>
<dd>
<p>Add the element to the beginning of the array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Orange", "Pear"];

fruits.unshift('Apple');

alert( fruits ); // Apple, Orange, Pear</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<p>Methods <code>push</code> and <code>unshift</code> can add multiple elements at once:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple"];

fruits.push("Orange", "Peach");
fruits.unshift("Pineapple", "Lemon");

// ["Pineapple", "Lemon", "Apple", "Orange", "Peach"]
alert( fruits );</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-310">
Internals</h2>
<p>An array is a special kind of object. The square brackets used to access a property <code>arr[0]</code> actually come from the object syntax. Numbers are used as keys.</p>
<p>They extend objects providing special methods to work with ordered collections of data and also the <code>length</code> property. But at the core it's still an object.</p>
<p>Remember, there are only 7 basic types in JavaScript. Array is an object and thus behaves like an object.</p>
<p>For instance, it is copied by reference:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Banana"]

let arr = fruits; // copy by reference (two variables reference the same array)

alert( arr === fruits ); // true

arr.push("Pear"); // modify the array by reference

alert( fruits ); // Banana, Pear - 2 items now</code></pre>
        </div>
      </div>
      
      </div><p>…But what makes arrays really  special is their internal representation. The engine tries to store its elements in the contiguous memory area, one after another, just as depicted on the illustrations in this chapter, and there are other optimizations as well, to make arrays work really fast.</p>
<p>But they all break if we quit working with an array as with an “ordered collection” and start working with it as if it were a regular object.</p>
<p>For instance, technically we can do this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = []; // make an array

fruits[99999] = 5; // assign a property with the index far greater than its length

fruits.age = 25; // create a property with an arbitrary name</code></pre>
        </div>
      </div>
      
      </div><p>That's possible, because arrays are objects at their base. We can add any properties to them.</p>
<p>But the engine will see that we're working with the array as with a regular object. Array-specific optimizations are not suited for such cases and will be turned off, their benefits disappear.</p>
<p>The ways to misuse an array:</p>
<ul>
<li>Add a non-numeric property like <code>arr.test = 5</code>.</li>
<li>Make holes, like: add <code>arr[0]</code> and then <code>arr[1000]</code> (and nothing between them).</li>
<li>Fill the array in the reverse order, like <code>arr[1000]</code>, <code>arr[999]</code> and so on.</li>
</ul>
<p>Please think of arrays as special structures to work with the <em>ordered data</em>. They provide special methods for that. Arrays are carefully tuned inside JavaScript engines to work with contiguous ordered data, please use them this way. And if you need arbitrary keys, chances are high that you actually require a regular object <code>{}</code>.</p>
<h2 id="chapter-311">
Performance</h2>
<p>Methods <code>push/pop</code> run fast, while <code>shift/unshift</code> are slow.</p>
      <img src="http://javascript.info/article/array/array-speed.png">
<p>Why is it faster to work with the end of an array than with its beginning? Let's see what happens during the execution:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fruits.shift(); // take 1 element from the start</code></pre>
        </div>
      </div>
      
      </div><p>It's not enough to take and remove the element with the number <code>0</code>. Other elements need to be renumbered as well.</p>
<p>The <code>shift</code> operation must do 3 things:</p>
<ol>
<li>Remove the element with the index <code>0</code>.</li>
<li>Move all elements to the left, renumber them from the index <code>1</code> to <code>0</code>, from <code>2</code> to <code>1</code> and so on.</li>
<li>Update the <code>length</code> property.</li>
</ol>
      <img src="http://javascript.info/article/array/array-shift.png">
<p><strong>The more elements in the array, the more time to move them, more in-memory operations.</strong></p>
<p>The similar thing happens with <code>unshift</code>: to add an element to the beginning of the array, we need first to move existing elements to the right, increasing their indexes.</p>
<p>And what's with <code>push/pop</code>? They do not need to move anything. To extract an element from the end, the <code>pop</code> method cleans the index and shortens <code>length</code>.</p>
<p>The actions for the <code>pop</code> operation:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fruits.pop(); // take 1 element from the end</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/array/array-pop.png"&gt;
<p><strong>The <code>pop</code> method does not need to move anything, because other elements keep their indexes. That's why it's blazingly fast.</strong></p>
<p>The similar thing with the <code>push</code> method.</p>
<h2 id="chapter-312">
Loops</h2>
<p>One of the oldest ways to cycle array items is the <code>for</code> loop over indexes:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["Apple", "Orange", "Pear"];

for (let i = 0; i &lt; arr.length; i++) {
  alert( arr[i] );
}</code></pre>
        </div>
      </div>
      
      </div><p>But for arrays there is another form of loop, <code>for..of</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apple", "Orange", "Plum"];

// iterates over array elements
for (let fruit of fruits) {
  alert( fruit );
}</code></pre>
        </div>
      </div>
      
      </div><p>The <code>for..of</code> doesn't give access to the number of the current element, just its value, but in most cases that's enough. And it's shorter.</p>
<p>Technically, because arrays are objects, it is also possible to use <code>for..in</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["Apple", "Orange", "Pear"];

for (let key in arr) {
  alert( arr[key] ); // Apple, Orange, Pear
}</code></pre>
        </div>
      </div>
      
      </div><p>But that's actually a bad idea. There are potential problems with it:</p>
<ol>
<li>
<p>The loop <code>for..in</code> iterates over <em>all properties</em>, not only the numeric ones.</p>
<p>There are so-called “array-like” objects in the browser and in other environments, that <em>look like arrays</em>. That is, they have <code>length</code> and indexes properties, but they may also have other non-numeric properties and methods, which we usually don't need. The <code>for..in</code> loop will list them though. So if we need to work with array-like objects, then these “extra” properties can become a problem.</p>
</li>
<li>
<p>The <code>for..in</code> loop is optimized for generic objects, not arrays, and thus is 10-100 times slower. Of course, it's still very fast. The speedup may matter only in bottlenecks or just irrelevant. But still we should be aware of the difference.</p>
</li>
</ol>
<p>Generally, we shouldn't use <code>for..in</code> for arrays.</p>
<h2 id="chapter-313">
A word about “length”</h2>
<p>The <code>length</code> property automatically updates when we modify the array. To be precise, it is actually not the count of values in the array, but the greatest numeric index plus one.</p>
<p>For instance, a single element with a large index gives a big length:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = [];
fruits[123] = "Apple";

alert( fruits.length ); // 124</code></pre>
        </div>
      </div>
      
      </div><p>Note that we usually don't use arrays like that.</p>
<p>Another interesting thing about the <code>length</code> property is that it's writable.</p>
<p>If we increase it manually, nothing interesting happens. But if we decrease it, the array is truncated. The process is irreversible, here's the example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3, 4, 5];

arr.length = 2; // truncate to 2 elements
alert( arr ); // [1, 2]

arr.length = 5; // return length back
alert( arr[3] ); // undefined: the values do not return</code></pre>
        </div>
      </div>
      
      </div><p>So, the simplest way to clear the array is: <code>arr.length = 0;</code>.</p>
<h2 id="chapter-314">
new Array()</h2>
<p>There is one more syntax to create an array:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:10-19">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = new Array("Apple", "Pear", "etc");</code></pre>
        </div>
      </div>
      
      </div><p>It's rarely used, because square brackets <code>[]</code> are shorter. Also there's a tricky feature with it.</p>
<p>If <code>new Array</code> is called with a single argument which is a number, then it creates an array <em>without items, but with the given length</em>.</p>
<p>Let's see how one can shoot himself in the foot:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = new Array(2); // will it create an array of [2] ?

alert( arr[0] ); // undefined! no elements.

alert( arr.length ); // length 2</code></pre>
        </div>
      </div>
      
      </div><p>In the code above, <code>new Array(number)</code> has all elements <code>undefined</code>.</p>
<p>To evade such surprises, we usually use square brackets, unless we really know what we're doing.</p>
<h2 id="chapter-315">
Multidimensional arrays</h2>
<p>Arrays can have items that are also arrays. We can use it for multidimensional arrays, to store matrices:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let matrix = [
  [1, 2, 3],
  [4, 5, 6],
  [7, 8, 9]
];

alert( matrix[1][1] ); // the central element</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-316">
toString</h2>
<p>Arrays have their own implementation of <code>toString</code> method that returns a comma-separated list of elements.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3];

alert( arr ); // 1,2,3
alert( String(arr) === '1,2,3' ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Also, let's try this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( [] + 1 ); // "1"
alert( [1] + 1 ); // "11"
alert( [1,2] + 1 ); // "1,21"</code></pre>
        </div>
      </div>
      
      </div><p>Arrays do not have <code>Symbol.toPrimitive</code>, neither a viable <code>valueOf</code>, they implement only <code>toString</code> conversion, so here <code>[]</code> becomes an empty string, <code>[1]</code> becomes <code>"1"</code> and <code>[1,2]</code> becomes <code>"1,2"</code>.</p>
<p>When the binary plus <code>"+"</code> operator adds something to a string, it converts it to a string as well, so the next step looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "" + 1 ); // "1"
alert( "1" + 1 ); // "11"
alert( "1,2" + 1 ); // "1,21"</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-317">
Summary</h2>
<p>Array is a special kind of objects, suited to store and manage ordered data items.</p>
<ul>
<li>
<p>The declaration:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// square brackets (usual)
let arr = [item1, item2...];

// new Array (exceptionally rare)
let arr = new Array(item1, item2...);</code></pre>
        </div>
      </div>
      
      </div><p>The call to <code>new Array(number)</code> creates an array with the given length, but without elements.</p>
</li>
<li>
<p>The <code>length</code> property is the array length or, to be precise, its last numeric index plus one. It is auto-adjusted by array methods.</p>
</li>
<li>
<p>If we shorten <code>length</code> manually, the array is truncated.</p>
</li>
</ul>
<p>We can use an array as a deque with the following operations:</p>
<ul>
<li><code>push(...items)</code> adds <code>items</code> to the end.</li>
<li><code>pop()</code> removes the element from the end and returns it.</li>
<li><code>shift()</code> removes the element from the beginning and returns it.</li>
<li><code>unshift(...items)</code> adds items to the beginning.</li>
</ul>
<p>To loop over the elements of the array:</p>
<ul>
<li><code>for (let i=0; i&lt;arr.length; i++)</code> – works fastest, old-browser-compatible.</li>
<li><code>for (let item of arr)</code> – the modern syntax for items only,</li>
<li><code>for (let i in arr)</code> – never use.</li>
</ul>
<p>We will return to arrays and study more methods to add, remove, extract elements and sort arrays in the chapter 
<a href="http://javascript.info/array-methods">Array methods</a>.</p>
<div class="tasks"><h2 id="chapter-318" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#is-array-copied" name="is-array-copied" class="main__anchor">Is array copied?</a></h3>
<a href="http://javascript.info/task/item-value" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>What is this code going to show?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apples", "Pear", "Orange"];

// push a new value into the "copy"
let shoppingCart = fruits;
shoppingCart.push("Banana");

// what's in fruits?
alert( fruits.length ); // ?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The result is <code>4</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let fruits = ["Apples", "Pear", "Orange"];

let shoppingCart = fruits;

shoppingCart.push("Banana");

alert( fruits.length ); // 4</code></pre>
        </div>
      </div>
      
      </div><p>That's because arrays are objects. So both <code>shoppingCart</code> and <code>fruits</code> are the references to the same array.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#array-operations" name="array-operations" class="main__anchor">Array operations.</a></h3>
<a href="http://javascript.info/task/create-array" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Let's try 5 array operations.</p>
<ol>
<li>Create an array <code>styles</code> with items “Jazz” and “Blues”.</li>
<li>Append “Rock-n-Roll” to the end.</li>
<li>Replace the value in the middle by “Classics”. Your code for finding the middle value should work for any arrays with odd length.</li>
<li>Strip off the first value of the array and show it.</li>
<li>Prepend <code>Rap</code> and <code>Reggae</code> to the array.</li>
</ol>
<p>The array in the process:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Jazz, Blues
Jazz, Bues, Rock-n-Roll
Jazz, Classics, Rock-n-Roll
Classics, Rock-n-Roll
Rap, Reggae, Classics, Rock-n-Roll</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let styles = ["Jazz", "Blues"];
styles.push("Rock-n-Roll");
styles[Math.floor((styles.length - 1) / 2)] = "Classics";
alert( styles.shift() );
styles.unshift("Rap", "Reggie");</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#calling-in-an-array-context" name="calling-in-an-array-context" class="main__anchor">Calling in an array context</a></h3>
<a href="http://javascript.info/task/call-array-this" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What is the result? Why?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["a", "b"];

arr.push(function() {
  alert( this );
})

arr[2](); // ?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The call <code>arr[2]()</code> is syntactically the good old <code>obj[method]()</code>, in the role of <code>obj</code> we have <code>arr</code>, and in the role of <code>method</code> we have <code>2</code>.</p>
<p>So we have a call of the function <code>arr[2]</code> as an object method. Naturally, it receives <code>this</code> referencing the object <code>arr</code> and outputs the array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["a", "b"];

arr.push(function() {
  alert( this );
})

arr[2](); // "a","b",function</code></pre>
        </div>
      </div>
      
      </div><p>The array has 3 values: initially it had two, plus the function.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sum-input-numbers" name="sum-input-numbers" class="main__anchor">Sum input numbers</a></h3>
<a href="http://javascript.info/task/array-input-sum" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write the function <code>sumInput()</code> that:</p>
<ul>
<li>Asks the user for values using <code>prompt</code> and stores the values in the array.</li>
<li>Finishes asking when the user enters a non-numeric value, an empty string, or presses “Cancel”.</li>
<li>Calculates and returns the sum of array items.</li>
</ul>
<p>P.S. A zero <code>0</code> is a valid number, please don't stop the input on zero.</p>
<p><a href="#" onclick="event.preventDefault(); runDemo(this)">Run the demo</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Please note the subtle, but important detail of the solution. We don't convert <code>value</code> to number instantly after <code>prompt</code>, because after <code>value = +value</code> we would not be able to tell an empty string (stop sign) from the zero (valid number). We do it later instead.</p>
<div data-trusted="1" class="code-example" data-demo="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sumInput() {

  let numbers = [];

  while (true) {

    let value = prompt("A number please?", 0);

    // should we cancel?
    if (value === "" || value === null || !isFinite(value)) break;

    numbers.push(+value);
  }

  let sum = 0;
  for (let number of numbers) {
    sum += number;
  }
  return sum;
}

alert( sumInput() );</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#a-maximal-subarray" name="a-maximal-subarray" class="main__anchor">A maximal subarray</a></h3>
<a href="http://javascript.info/task/maximal-subarray" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>The input is an array of numbers, e.g. <code>arr = [1, -2, 3, 4, -9, 6]</code>.</p>
<p>The task is: find the contiguous subarray of <code>arr</code> with the maximal sum of items.</p>
<p>Write the function <code>getMaxSubSum(arr)</code> that will find return that sum.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:18-22,1:14-25,2:28-30,3:22-26,4:14-17,5:14-21">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">getMaxSubSum([-1, 2, 3, -9]) = 5 (the sum of highlighted items)
getMaxSubSum([2, -1, 2, 3, -9]) = 6
getMaxSubSum([-1, 2, 3, -9, 11]) = 11
getMaxSubSum([-2, -1, 1, 2]) = 3
getMaxSubSum([100, -9, 2, -3, 5]) = 100
getMaxSubSum([1, 2, 3]) = 6 (take all)</code></pre>
        </div>
      </div>
      
      </div><p>If all items are negative, it means that we take none (the subarray is empty), so the sum is zero:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">getMaxSubSum([-1, -2, -3]) = 0</code></pre>
        </div>
      </div>
      
      </div><p>Please try to think of a fast solution: 
<a href="https://en.wikipedia.org/wiki/Big_O_notation">O(n<sup>2</sup>)</a> or even O(n) if you can.</p>
<p>
<a href="http://plnkr.co/edit/UHrd7pOZxSmJgM2hvLyU?p=preview" target="_blank" data-plunk-id="UHrd7pOZxSmJgM2hvLyU">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">The slow solution</button>
<div class="task__answer-content"><h4 class="task__step-title">The slow solution</h4><p>We can calculate all possible subsums.</p>
<p>The simplest way is to take every element and calculate sums of all subarrays starting from it.</p>
<p>For instance, for <code>[-1, 2, 3, -9, 11]</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Starting from -1:
-1
-1 + 2
-1 + 2 + 3
-1 + 2 + 3 + (-9)
-1 + 2 + 3 + (-9) + 11

// Starting from 2:
2
2 + 3
2 + 3 + (-9)
2 + 3 + (-9) + 11

// Starting from 3:
3
3 + (-9)
3 + (-9) + 11

// Starting from -9
-9
-9 + 11

// Starting from -11
-11</code></pre>
        </div>
      </div>
      
      </div><p>The code is actually a nested loop: the external loop over array elements, and the internal counts subsums starting with the current element.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getMaxSubSum(arr) {
  let maxSum = 0; // if we take no elements, zero will be returned

  for (let i = 0; i &lt; arr.length; i++) {
    let sumFixedStart = 0;
    for (let j = i; j &lt; arr.length; j++) {
      sumFixedStart += arr[j];
      maxSum = Math.max(maxSum, sumFixedStart);
    }
  }

  return maxSum;
}

alert( getMaxSubSum([-1, 2, 3, -9]) ); // 5
alert( getMaxSubSum([-1, 2, 3, -9, 11]) ); // 11
alert( getMaxSubSum([-2, -1, 1, 2]) ); // 3
alert( getMaxSubSum([1, 2, 3]) ); // 6
alert( getMaxSubSum([100, -9, 2, -3, 5]) ); // 100</code></pre>
        </div>
      </div>
      
      </div><p>The solution has a time complexety of 
<a href="https://en.wikipedia.org/wiki/Big_O_notation">O(n<sup>2</sup>)</a>. In other words, if we increase the array size 2 times, the algorithm will work 4 times longer.</p>
<p>For big arrays (1000, 10000 or more items) such algorithms can lead to a seroius sluggishness.</p>
</div></div><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Fast solution</button>
<div class="task__answer-content"><h4 class="task__step-title">Fast solution</h4><p>Let's walk the array and keep the current partial sum of elements in the variable <code>s</code>. If <code>s</code> becomes negative at some point, then assign <code>s=0</code>. The maximum of all such <code>s</code> will be the answer.</p>
<p>If the description is too vague, please see the code, it's short enough:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getMaxSubSum(arr) {
  let maxSum = 0;
  let partialSum = 0;

  for (let item of arr) { // for each item of arr
    partialSum += item; // add it to partialSum
    maxSum = Math.max(maxSum, partialSum); // remember the maximum
    if (partialSum &lt; 0) partialSum = 0; // zero if negative
  }

  return maxSum;
}

alert( getMaxSubSum([-1, 2, 3, -9]) ); // 5
alert( getMaxSubSum([-1, 2, 3, -9, 11]) ); // 11
alert( getMaxSubSum([-2, -1, 1, 2]) ); // 3
alert( getMaxSubSum([100, -9, 2, -3, 5]) ); // 100
alert( getMaxSubSum([1, 2, 3]) ); // 6
alert( getMaxSubSum([-1, -2, -3]) ); // 0</code></pre>
        </div>
      </div>
      
      </div><p>The algorithm requires exactly 1 array pass, so the time complexity is O(n).</p>
<p>You can find more detail information about the algorithm here: 
<a href="http://en.wikipedia.org/wiki/Maximum_subarray_problem">Maximum subarray problem</a>. If it's still not obvious why that works, then please trace the algorithm on the examples above, see how it works, that's better than any words.</p>
<p>
<a href="http://plnkr.co/edit/6cxNY5xLMMtuoEYfgeD5?p=preview" target="_blank" data-plunk-id="6cxNY5xLMMtuoEYfgeD5">Open the solution with tests in the sandbox.</a></p></div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-319"></h6>
<h1 class="main__header-title" id="chapter-320">Array methods</h1>
<p>Arrays provide a lot of methods. To make things easier, in this chapter they are split into groups.</p>


<h2 id="chapter-321">
Add/remove items</h2>
<p>We already know methods that add and remove items from the beginning or the end:</p>
<ul>
<li><code>arr.push(...items)</code> – adds items to the end,</li>
<li><code>arr.pop()</code> – extracts an item from the end,</li>
<li><code>arr.shift()</code> – extracts an item from the beginning,</li>
<li><code>arr.unshift(...items)</code> – adds items to the beginning.</li>
</ul>
<p>Here are few others.</p>
<h3>
splice</a></h3><p>How to delete an element from the array?</p>
<p>The arrays are objects, so we can try to use <code>delete</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["I", "go", "home"];

delete arr[1]; // remove "go"

alert( arr[1] ); // undefined

// now arr = ["I",  , "home"];
alert( arr.length ); // 3</code></pre>
        </div>
      </div>
      
      </div><p>The element was removed, but the array still has 3 elements, we can see that <code>arr.length == 3</code>.</p>
<p>That's natural, because <code>delete obj.key</code> removes a value by the <code>key</code>. It's all it does. Fine for objects. But for arrays we usually want the rest of elements to shift and occupy the freed place. We expect to have a shorter array now.</p>
<p>So, special methods should be used.</p>
<p>The 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/splice">arr.splice(str)</a> method is a swiss army knife for arrays. It can do everything: add, remove and insert elements.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">arr.splice(index[, deleteCount, elem1, ..., elemN])</code></pre>
        </div>
      </div>
      
      </div><p>It starts from the position <code>index</code>: removes <code>deleteCount</code> elements and then inserts <code>elem1, ..., elemN</code> at their place. Returns the array of removed elements.</p>
<p>This method is easy to grasp by examples.</p>
<p>Let's start with the deletion:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["I", "study", "JavaScript"];

arr.splice(1, 1); // from index 1 remove 1 element

alert( arr ); // ["I", "JavaScript"]</code></pre>
        </div>
      </div>
      
      </div><p>Easy, right? Starting from the index <code>1</code> it removed <code>1</code> element.</p>
<p>In the next example we remove 3 elements and replace them with the other two:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:11-38,5:21-37">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["I", "study", "JavaScript", "right", "now"];

// remove 3 first elements and replace them with another
arr.splice(0, 3, "Let's", "dance");

alert( arr ) // now ["Let's", "dance", "right", "now"]</code></pre>
        </div>
      </div>
      
      </div><p>Here we can see that <code>splice</code> returns the array of removed elements:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:11-24">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["I", "study", "JavaScript", "right", "now"];

// remove 2 first elements
let removed = arr.splice(0, 2);

alert( removed ); // "I", "study" &lt;-- array of removed elements</code></pre>
        </div>
      </div>
      
      </div><p>The <code>splice</code> method is also able to insert the elements without any removals. For that we need to set <code>deleteCount</code> to <code>0</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["I", "study", "JavaScript"];

// from index 2
// delete 0
// then insert "complex" and "language"
arr.splice(2, 0, "complex", "language");

alert( arr ); // "I", "study", "complex", "language", "JavaScript"</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Negative indexes allowed</span></div>
            <div class="important__content"><p>Here and in other array methods, negative indexes are allowed. They specify the position from the end of the array, like here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 5];

// from index -1 (one step from the end)
// delete 0 elements,
// then insert 3 and 4
arr.splice(-1, 0, 3, 4);

alert( arr ); // 1,2,3,4,5</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h3>
slice</a></h3><p>The method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">arr.slice</a> is much simpler than similar-looking <code>arr.splice</code>.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">arr.slice(start, end)</code></pre>
        </div>
      </div>
      
      </div><p>It returns a new array where it copies all items start index <code>"start"</code> to <code>"end"</code> (not including <code>"end"</code>). Both <code>start</code> and <code>end</code> can be negative, in that case position from array end is assumed.</p>
<p>It works like <code>str.slice</code>, but makes subarrays instead of substrings.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "test";
let arr = ["t", "e", "s", "t"];

alert( str.slice(1, 3) ); // es
alert( arr.slice(1, 3) ); // e,s

alert( str.slice(-2) ); // st
alert( arr.slice(-2) ); // s,t</code></pre>
        </div>
      </div>
      
      </div><h3>
concat</a></h3><p>The method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/concat">arr.concat</a> joins the array with other arrays and/or items.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">arr.concat(arg1, arg2...)</code></pre>
        </div>
      </div>
      
      </div><p>It accepts any number of arguments – either arrays or values.</p>
<p>The result is a new array containing items from <code>arr</code>, then <code>arg1</code>, <code>arg2</code> etc.</p>
<p>If an argument is an array or has <code>Symbol.isConcatSpreadable</code> property, then all its elements are copied. Otherwise, the argument itself is copied.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2];

// merge arr with [3,4]
alert( arr.concat([3, 4])); // 1,2,3,4

// merge arr with [3,4] and [5,6]
alert( arr.concat([3, 4], [5, 6])); // 1,2,3,4,5,6

// merge arr with [3,4], then add values 5 and 6
alert( arr.concat([3, 4], 5, 6)); // 1,2,3,4,5,6</code></pre>
        </div>
      </div>
      
      </div><p>Normally, it only copies elements from arrays (“spreads” them). Other objects, even if they look like arrays, added as a whole:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2];

let arrayLike = {
  0: "something",
  length: 1
};

alert( arr.concat(arrayLike) ); // 1,2,[object Object]
//[1, 2, arrayLike]</code></pre>
        </div>
      </div>
      
      </div><p>…But if an array-like object has <code>Symbol.isConcatSpreadable</code> property, then its elements are added instead:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2];

let arrayLike = {
  0: "something",
  1: "else",
  [Symbol.isConcatSpreadable]: true,
  length: 2
};

alert( arr.concat(arrayLike) ); // 1,2,something,else</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-322">
Searching in array</h2>
<p>These are methods to search for something in an array.</p>
<h3>
indexOf/lastIndexOf and includes</a></h3><p>The methods 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf">arr.indexOf</a>, 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/lastIndexOf">arr.lastIndexOf</a> and 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes">arr.includes</a> have the same syntax and do essentially the same as their string counterparts, but operate on items instead of characters:</p>
<ul>
<li><code>arr.indexOf(item, from)</code> looks for <code>item</code> starting from index <code>from</code>, and returns the index where it was found, otherwise <code>-1</code>.</li>
<li><code>arr.lastIndexOf(item, from)</code> – same, but looks from right to left.</li>
<li><code>arr.includes(item, from)</code> – looks for <code>item</code> starting from index <code>from</code>, returns <code>true</code> if found.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 0, false];

alert( arr.indexOf(0) ); // 1
alert( arr.indexOf(false) ); // 2
alert( arr.indexOf(null) ); // -1

alert( arr.includes(1) ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Note that the methods use <code>===</code> comparison. So, if we look for <code>false</code>, it finds exactly <code>false</code> and not the zero.</p>
<p>If we want to check for inclusion, and don't want to know the exact index, then <code>arr.includes</code> is preferred.</p>
<p>Also, a very minor difference of <code>include</code> is that it correctly handles <code>NaN</code>, unlike <code>indexOf/lastIndexOf</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">const arr = [NaN];
alert( arr.indexOf(NaN) ); // -1 (should be 0, but === equality doesn't work for NaN)
alert( arr.includes(NaN) );// true (correct)</code></pre>
        </div>
      </div>
      
      </div><h3>
find and findIndex</a></h3><p>Imagine we have an array of objects. How do we find an object with the specific condition?</p>
<p>Here the 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find">arr.find</a> method comes in handy.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let result = arr.find(function(item, index, array) {
  // should return true if the item is what we are looking for
});</code></pre>
        </div>
      </div>
      
      </div><p>The function is called repetitively for each element of the array:</p>
<ul>
<li><code>item</code> is the element.</li>
<li><code>index</code> is its index.</li>
<li><code>array</code> is the array itself.</li>
</ul>
<p>If it returns <code>true</code>, the search is stopped, the <code>item</code> is returned. If nothing found, <code>undefined</code> is returned.</p>
<p>For example, we have an array of users, each with the fields <code>id</code> and <code>name</code>. Let's find the one with <code>id == 1</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let users = [
  {id: 1, name: "John"},
  {id: 2, name: "Pete"},
  {id: 3, name: "Mary"}
];

let user = users.find(item =&gt; item.id == 1);

alert(user.name); // John</code></pre>
        </div>
      </div>
      
      </div><p>In real life arrays of objects is a common thing, so the <code>find</code> method is very useful.</p>
<p>Note that in the example we provide to <code>find</code> a single-argument function <code>item =&gt; item.id == 1</code>. Other parameters of <code>find</code> are rarely used.</p>
<p>The 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex">arr.findIndex</a> method is essentially the same, but it returns the index where the element was found instead of the element itself.</p>
<h3>
filter</a></h3><p>The <code>find</code> method looks for a single (first) element that makes the function return <code>true</code>.</p>
<p>If there may be many, we can use 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">arr.filter(fn)</a>.</p>
<p>The syntax is roughly the same as <code>find</code>, but it returns an array of matching elements:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let results = arr.filter(function(item, index, array) {
  // should return true if the item passes the filter
});</code></pre>
        </div>
      </div>
      
      </div><p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let users = [
  {id: 1, name: "John"},
  {id: 2, name: "Pete"},
  {id: 3, name: "Mary"}
];

// returns array of the first two users
let someUsers = users.filter(item =&gt; item.id &lt; 3);

alert(someUsers.length); // 2</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-323">
Transform an array</h2>
<p>This section is about the methods transforming or reordering the array.</p>
<h3>
map</a></h3><p>The 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">arr.map</a> method is one of the most useful and often used.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let result = arr.map(function(item, index, array) {
  // returns the new value instead of item
})</code></pre>
        </div>
      </div>
      
      </div><p>It calls the function for each element of the array and returns the array of results.</p>
<p>For instance, here we transform each element into its length:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let lengths = ["Bilbo", "Gandalf", "Nazgul"].map(item =&gt; item.length)
alert(lengths); // 5,7,6</code></pre>
        </div>
      </div>
      
      </div><h3>
sort(fn)</a></h3><p>The method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">arr.sort</a> sorts the array <em>in place</em>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="5:18-26">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [ 1, 2, 15 ];

// the method reorders the content of arr (and returns it)
arr.sort();

alert( arr );  // 1, 15, 2</code></pre>
        </div>
      </div>
      
      </div><p>Did you notice anything strange in the outcome?</p>
<p>The order became <code>1, 15, 2</code>. Incorrect. But why?</p>
<p><strong>The items are sorted as strings by default.</strong></p>
<p>Literally, all elements are converted to strings and then compared. So, the lexicographic ordering is applied and indeed <code>"2" &gt; "15"</code>.</p>
<p>To use our own sorting order, we need to supply a function of two arguments as the argument of <code>arr.sort()</code>.</p>
<p>The function should work like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function compare(a, b) {
  if (a &gt; b) return 1;
  if (a == b) return 0;
  if (a &lt; b) return -1;
}</code></pre>
        </div>
      </div>
      
      </div><p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-8" data-highlight-inline="10:16-24">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function compareNumeric(a, b) {
  if (a &gt; b) return 1;
  if (a == b) return 0;
  if (a &lt; b) return -1;
}

let arr = [ 1, 2, 15 ];

arr.sort(compareNumeric);

alert(arr);  // 1, 2, 15</code></pre>
        </div>
      </div>
      
      </div><p>Now it works as intended.</p>
<p>Let's step aside and think what's happening. The <code>arr</code> can be array of anything, right? It may contain numbers or strings or html elements or whatever. We have a set of <em>something</em>. To sort it, we need an <em>ordering function</em> that knows how to compare its elements. The default is a string order.</p>
<p>The <code>arr.sort(fn)</code> method has a built-in implementation of sorting algorithm. We don't need to care how it exactly works (an optimized 
<a href="https://en.wikipedia.org/wiki/Quicksort">quicksort</a> most of the time). It will walk the array, compare its elements using the provided function and reorder them, all we need is to provide the <code>fn</code> which does the comparison.</p>
<p>By the way, if we ever want to know which elements are compared – nothing prevents from alerting them:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">[1, -2, 15, 2, 0, 8].sort(function(a, b) {
  alert( a + " &lt;&gt; " + b );
});</code></pre>
        </div>
      </div>
      
      </div><p>The algorithm may compare an element multiple times in the process, but it tries to make as few comparisons as possible.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">A comparison function may return any number</span></div>
            <div class="important__content"><p>Actually, a comparison function is only required to return a positive number to say “greater” and a negative number to say “less”.</p>
<p>That allows to write shorter functions:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="4:16-24">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [ 1, 2, 15 ];

arr.sort(function(a, b) { return a - b; });

alert(arr);  // 1, 2, 15</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Arrow functions for the best</span></div>
            <div class="important__content"><p>Remember <span class="markdown-error">Article "function-expression" not found</span>? We can use them here for neater sorting:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">arr.sort( (a, b) =&gt; a - b );</code></pre>
        </div>
      </div>
      
      </div><p>This works exactly the same as the other, longer, version above.</p>
</div></div>
<h3>
reverse</a></h3><p>The method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reverse">arr.reverse</a> reverses the order of elements in <code>arr</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3, 4, 5];
arr.reverse();

alert( arr ); // 5,4,3,2,1</code></pre>
        </div>
      </div>
      
      </div><p>It also returns the array <code>arr</code> after the reversal.</p>
<h3>
split and join</a></h3><p>Here's the situation from the real life. We are writing a messaging app, and the person enters the comma-delimited list of receivers: <code>John, Pete, Mary</code>. But for us an array of names would be much more comfortable than a single string. How to get it?</p>
<p>The 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split">str.split(delim)</a> method does exactly that. It splits the string into an array by the given delimiter <code>delim</code>.</p>
<p>In the example below, we split by a comma followed by space:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let names = 'Bilbo, Gandalf, Nazgul';

let arr = names.split(', ');

for (let name of arr) {
  alert( `A message to ${name}.` ); // A message to Bilbo  (and other names)
}</code></pre>
        </div>
      </div>
      
      </div><p>The <code>split</code> method has an optional second numeric argument – a limit on the array length. If it is provided, then the extra elements are ignored. In practice it is rarely used though:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = 'Bilbo, Gandalf, Nazgul, Saruman'.split(', ', 2);

alert(arr); // Bilbo, Gandalf</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Split into letters</span></div>
            <div class="important__content"><p>The call to <code>split(s)</code> with an empty <code>s</code> would split the string into an array of letters:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "test";

alert( str.split('') ); // t,e,s,t</code></pre>
        </div>
      </div>
      
      </div></div></div>
<p>The call 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join">arr.join(str)</a> does the reverse to <code>split</code>. It creates a string of <code>arr</code> items glued by <code>str</code> between them.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ['Bilbo', 'Gandalf', 'Nazgul'];

let str = arr.join(';');

alert( str ); // Bilbo;Gandalf;Nazgul</code></pre>
        </div>
      </div>
      
      </div><h3>
reduce/reduceRight</a></h3><p>When we need to iterate over an array – we can use <code>forEach</code>.</p>
<p>When we need to iterate and return the data for each element – we can use <code>map</code>.</p>
<p>The methods 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce">arr.reduce</a> and 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduceRight">arr.reduceRight</a> also belong to that breed, but are a little bit more intricate. They are used to calculate a single value based on the array.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let value = arr.reduce(function(previousValue, item, index, arr) {
  // ...
}, initial);</code></pre>
        </div>
      </div>
      
      </div><p>The function is applied to the elements. You may notice the familiar arguments, starting from the 2nd:</p>
<ul>
<li><code>item</code> – is the current array item.</li>
<li><code>index</code> – is its position.</li>
<li><code>arr</code> – is the array.</li>
</ul>
<p>So far, like <code>forEach/map</code>. But there's one more argument:</p>
<ul>
<li><code>previousValue</code> – is the result of the previous function call, <code>initial</code> for the first call.</li>
</ul>
<p>The easiest way to grasp that is by example.</p>
<p>Here we get a sum of array in one line:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3, 4, 5];

let result = arr.reduce((sum, current) =&gt; sum + current, 0);

alert(result); // 15</code></pre>
        </div>
      </div>
      
      </div><p>Here we used the most common variant of <code>reduce</code> which uses only 2 arguments.</p>
<p>Let's see the details of what's going on.</p>
<ol>
<li>On the first run, <code>sum</code> is the initial value (the last argument of <code>reduce</code>), equals <code>0</code>, and <code>current</code> is the first array element, equals <code>1</code>. So the result is <code>1</code>.</li>
<li>On the second run, <code>sum = 1</code>, we add the second array element (<code>2</code>) to it and return.</li>
<li>On the 3rd run, <code>sum = 3</code> and we add one more element to it, and so on…</li>
</ol>
<p>The calculation flow:</p>
      <img src="http://javascript.info/article/array-methods/reduce.png">
<p>Or in the form of a table, where each row represents is a function call on the next array element:</p>
<table>
<thead>
<tr>
<th></th>
<th><code>sum</code></th>
<th><code>current</code></th>
<th><code>result</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>the first call</td>
<td><code>0</code></td>
<td><code>1</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td>the second call</td>
<td><code>1</code></td>
<td><code>2</code></td>
<td><code>3</code></td>
</tr>
<tr>
<td>the third call</td>
<td><code>3</code></td>
<td><code>3</code></td>
<td><code>6</code></td>
</tr>
<tr>
<td>the fourth call</td>
<td><code>6</code></td>
<td><code>4</code></td>
<td><code>10</code></td>
</tr>
<tr>
<td>the fifth call</td>
<td><code>10</code></td>
<td><code>5</code></td>
<td><code>15</code></td>
</tr>
</tbody>
</table>
<p>As we can see, the result of the previous call becomes the first argument of the next one.</p>
<p>We also can omit the initial value:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3, 4, 5];

// removed initial value from reduce (no 0)
let result = arr.reduce((sum, current) =&gt; sum + current);

alert( result ); // 15</code></pre>
        </div>
      </div>
      
      </div><p>The result is the same. That's because if there's no initial, then <code>reduce</code> takes the first element of the array as the initial value and starts the iteration from the 2nd element.</p>
<p>The calculation table is the same as above, minus the first row.</p>
<p>But such use requires an extreme care. If the array is empty, then <code>reduce</code> call without initial value gives an error.</p>
<p>Here's an example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [];

// Error: Reduce of empty array with no initial value
// if the initial value existed, reduce would return it for the empty arr.
arr.reduce((sum, current) =&gt; sum + current);</code></pre>
        </div>
      </div>
      
      </div><p>So it's advised to always specify the initial value.</p>
<p>The method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduceRight">arr.reduceRight</a> does the same, but goes from right to left.</p>
<h2 id="chapter-324">
Iterate: forEach</h2>
<p>The 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">arr.forEach</a> method allows to run a function for every element of the array.</p>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">arr.forEach(function(item, index, array) {
  // ... do something with item
});</code></pre>
        </div>
      </div>
      
      </div><p>For instance, this shows each element of the array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// for each element call alert
["Bilbo", "Gandalf", "Nazgul"].forEach(alert);</code></pre>
        </div>
      </div>
      
      </div><p>And this code is more elaborate about their positions in the target array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">["Bilbo", "Gandalf", "Nazgul"].forEach((item, index, array) =&gt; {
  alert(`${item} is at index ${index} in ${array}`);
});</code></pre>
        </div>
      </div>
      
      </div><p>The result of the function (if it returns any) is thrown away and ignored.</p>
<h2 id="chapter-325">
Array.isArray</h2>
<p>Arrays do not form a separate language type. They are based on objects.</p>
<p>So <code>typeof</code> does not help to distinguish a plain object from an array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(typeof {}); // object
alert(typeof []); // same</code></pre>
        </div>
      </div>
      
      </div><p>…But arrays are used so often that there's a special method for that: 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray">Array.isArray(value)</a>. It returns <code>true</code> if the <code>value</code> is an array, and <code>false</code> otherwise.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(Array.isArray({})); // false

alert(Array.isArray([])); // true</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-326">
Most methods support “thisArg”</h2>
<p>Almost all array methods that call functions – like <code>find</code>, <code>filter</code>, <code>map</code>, with a notable exception of <code>sort</code>, accept an optional additional parameter <code>thisArg</code>.</p>
<p>That parameter is not explained in the sections above, because it's rarely used. But for completeness we have to cover it.</p>
<p>Here's the full syntax of these methods:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">arr.find(func, thisArg);
arr.filter(func, thisArg);
arr.map(func, thisArg);
// ...
// thisArg is the optional last argument</code></pre>
        </div>
      </div>
      
      </div><p>The value of <code>thisArg</code> parameter becomes <code>this</code> for <code>func</code>.</p>
<p>For instance, here we use an object method as a filter and <code>thisArg</code> comes in handy:</p>
<div data-trusted="1" class="code-example" data-highlight-block="13-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  age: 18,
  younger(otherUser) {
    return otherUser.age &lt; this.age;
  }
};

let users = [
  {age: 12},
  {age: 16},
  {age: 32}
];

// find all users younger than user
let youngerUsers = users.filter(user.younger, user);

alert(youngerUsers.length); // 2</code></pre>
        </div>
      </div>
      
      </div><p>In the call above, we use <code>user.younger</code> as a filter and also provide <code>user</code> as the context for it. If we didn't provide the context, <code>users.filter(user.younger)</code> would call <code>user.younger</code> as a standalone function, with <code>this=undefined</code>. That would mean an instant error.</p>
<h2 id="chapter-327">
Summary</h2>
<p>A cheatsheet of array methods:</p>
<ul>
<li>
<p>To add/remove elements:</p>
<ul>
<li><code>push(...items)</code> – adds items to the end,</li>
<li><code>pop()</code> – extracts an item from the end,</li>
<li><code>shift()</code> – extracts an item from the beginning,</li>
<li><code>unshift(...items)</code> – adds items to the beginning.</li>
<li><code>splice(pos, deleteCount, ...items)</code> – at index <code>pos</code> delete <code>deleteCount</code> elements and insert <code>items</code>.</li>
<li><code>slice(start, end)</code> – creates a new array, copies elements from position <code>start</code> till <code>end</code> (not inclusive) into it.</li>
<li><code>concat(...items)</code> – returns a new array: copies all members of the current one and adds <code>items</code> to it. If any of <code>items</code> is an array, then its elements are taken.</li>
</ul>
</li>
<li>
<p>To search among elements:</p>
<ul>
<li><code>indexOf/lastIndexOf(item, pos)</code> – look for <code>item</code> starting from position <code>pos</code>, return the index or <code>-1</code> if not found.</li>
<li><code>includes(value)</code> – returns <code>true</code> if the array has <code>value</code>, otherwise <code>false</code>.</li>
<li><code>find/filter(func)</code> – filter elements through the function, return first/all values that make it return <code>true</code>.</li>
<li><code>findIndex</code> is like <code>find</code>, but returns the index instead of a value.</li>
</ul>
</li>
<li>
<p>To transform the array:</p>
<ul>
<li><code>map(func)</code> – creates a new array from results of calling <code>func</code> for every element.</li>
<li><code>sort(func)</code> – sorts the array in-place, then returns it.</li>
<li><code>reverse()</code> – reverses the array in-place, then returns it.</li>
<li><code>split/join</code> – convert a string to array and back.</li>
<li><code>reduce(func, initial)</code> – calculate a single value over the array by calling <code>func</code> for each element and passing an intermediate result between the calls.</li>
</ul>
</li>
<li>
<p>To iterate over elements:</p>
<ul>
<li><code>forEach(func)</code> – calls <code>func</code> for every element, does not return anything.</li>
</ul>
</li>
<li>
<p>Additionally:</p>
<ul>
<li><code>Array.isArray(arr)</code> checks <code>arr</code> for being an array.</li>
</ul>
</li>
</ul>
<p>Please note that methods <code>sort</code>, <code>reverse</code> and <code>splice</code> modify the array itself.</p>
<p>These methods are the most used ones, they cover 99% of use cases. But there are few others:</p>
<ul>
<li>
<p>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some">arr.some(fn)</a>/
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/every">arr.every(fn)</a> checks the array.</p>
<p>The function <code>fn</code> is called on each element of the array similar to <code>map</code>. If any/all results are <code>true</code>, returns <code>true</code>, otherwise <code>false</code>.</p>
</li>
<li>
<p>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill">arr.fill(value, start, end)</a> – fills the array with repeating <code>value</code> from index <code>start</code> to <code>end</code>.</p>
</li>
<li>
<p>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/copyWithin">arr.copyWithin(target, start, end)</a> – copies its elements from position <code>start</code> till position <code>end</code> into <em>itself</em>, at position <code>target</code> (overwrites existing).</p>
</li>
</ul>
<p>For the full list, see the 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">manual</a>.</p>
<p>From the first sight it may seem that there are so many methods, quite difficult to remember. But actually that's much easier than it seems.</p>
<p>Look through the cheatsheet just to be aware of them. Then solve the tasks of this chapter to practice, so that you have experience with array methods.</p>
<p>Afterwards whenever you need to do something with an array, and you don't know how – come here, look at the cheatsheet and find the right method. Examples will help you to write it correctly. Soon you'll automatically remember the methods, without specific efforts from your side.</p>
<div class="tasks"><h2 id="chapter-328" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#translate-border-left-width-to-borderleftwidth" name="translate-border-left-width-to-borderleftwidth" class="main__anchor">Translate border-left-width to borderLeftWidth</a></h3>
<a href="http://javascript.info/task/camelcase" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write the function <code>camelize(str)</code> that changes dash-separated words like “my-short-string” into camel-cased “myShortString”.</p>
<p>That is: removes all dashes, each word after dash becomes uppercased.</p>
<p>Examples:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">camelize("background-color") == 'backgroundColor';
camelize("list-style-image") == 'listStyleImage';
camelize("-webkit-transition") == 'WebkitTransition';</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Hint: use <code>split</code> to split the string into an array, transform it and <code>join</code> back.</p>
<p>
<a href="http://plnkr.co/edit/9vtkVJmOXuF8VxfIxKaK?p=preview" target="_blank" data-plunk-id="9vtkVJmOXuF8VxfIxKaK">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/vjrhuOwdHtdDKcst5dLK?p=preview" target="_blank" data-plunk-id="vjrhuOwdHtdDKcst5dLK">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#filter-range" name="filter-range" class="main__anchor">Filter range</a></h3>
<a href="http://javascript.info/task/filter-range" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write a function <code>filterRange(arr, a, b)</code> that gets an array <code>arr</code>, looks for elements between <code>a</code> and <code>b</code> in it and returns an array of them.</p>
<p>The function should not modify the array. It should return the new array.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [5, 3, 8, 1];

let filtered = filterRange(arr, 1, 4);

alert( filtered ); // 3,1 (matching values)

alert( arr ); // 5,3,8,1 (not modified)</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/QrSggoIfdmUasaiV9Qoj?p=preview" target="_blank" data-plunk-id="QrSggoIfdmUasaiV9Qoj">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/YT1qYB7OKLJ3Mh1yhv4l?p=preview" target="_blank" data-plunk-id="YT1qYB7OKLJ3Mh1yhv4l">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#filter-range-in-place" name="filter-range-in-place" class="main__anchor">Filter range "in place"</a></h3>
<a href="http://javascript.info/task/filter-range-in-place" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write a function <code>filterRangeInPlace(arr, a, b)</code> that gets an array <code>arr</code> and removes from it all values except those that are between <code>a</code> and <code>b</code>. The test is: <code>a ≤ arr[i] ≤ b</code>.</p>
<p>The function should only modify the array. It should not return anything.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [5, 3, 8, 1];

filterRangeInPlace(arr, 1, 4); // removed the numbers except from 1 to 4

alert( arr ); // [3, 1]</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/4fOH0XLlmVAeQk8FrNoo?p=preview" target="_blank" data-plunk-id="4fOH0XLlmVAeQk8FrNoo">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/AL5wsoTXl4I1fVC9n8CQ?p=preview" target="_blank" data-plunk-id="AL5wsoTXl4I1fVC9n8CQ">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sort-in-the-reverse-order" name="sort-in-the-reverse-order" class="main__anchor">Sort in the reverse order</a></h3>
<a href="http://javascript.info/task/sort-back" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [5, 2, 1, -10, 8];

// ... your code to sort it in the reverse order

alert( arr ); // 8, 5, 2, 1, -10</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [5, 2, 1, -10, 8];

arr.sort((a, b) =&gt; b - a);

alert( arr );</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#copy-and-sort-array" name="copy-and-sort-array" class="main__anchor">Copy and sort array</a></h3>
<a href="http://javascript.info/task/copy-sort-array" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We have an array of strings <code>arr</code>. We'd like to have a sorted copy of it, but keep <code>arr</code> unmodified.</p>
<p>Create a function <code>copySorted(arr)</code> that returns such a copy.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["HTML", "JavaScript", "CSS"];

let sorted = copySorted(arr);

alert( sorted ); // CSS, HTML, JavaScript
alert( arr ); // HTML, JavaScript, CSS (no changes)</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We can use <code>slice()</code> to make a copy and run the sort on it:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function copySorted(arr) {
  return arr.slice().sort();
}

let arr = ["HTML", "JavaScript", "CSS"];

let sorted = copySorted(arr);

alert( sorted );
alert( arr );</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#map-to-names" name="map-to-names" class="main__anchor">Map to names</a></h3>
<a href="http://javascript.info/task/array-get-names" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>You have an array of <code>user</code> objects, each one has <code>user.name</code>. Write the code that converts it into an array of names.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John", age: 25 };
let pete = { name: "Pete", age: 30 };
let mary = { name: "Mary", age: 28 };

let users = [ john, pete, mary ];

let names = /* ... your code */

alert( names ); // John, Pete, Mary</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John", age: 25 };
let pete = { name: "Pete", age: 30 };
let mary = { name: "Mary", age: 28 };

let users = [ john, pete, mary ];

let names = users.map(item =&gt; item.name);

alert( names ); // John, Pete, Mary</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#map-to-objects" name="map-to-objects" class="main__anchor">Map to objects</a></h3>
<a href="http://javascript.info/task/map-objects" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>You have an array of <code>user</code> objects, each one has <code>name</code>, <code>surname</code> and <code>id</code>.</p>
<p>Write the code to create another array from it, of objects with <code>id</code> and <code>fullName</code>, where <code>fullName</code> is generated from <code>name</code> and <code>surname</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John", surname: "Smith", id: 1 };
let pete = { name: "Pete", surname: "Hunt", id: 2 };
let mary = { name: "Mary", surname: "Key", id: 3 };

let users = [ john, pete, mary ];

let usersMapped = /* ... your code ... */

/*
usersMapped = [
  { fullName: "John Smith", id: 1 },
  { fullName: "Pete Hunt", id: 2 },
  { fullName: "Mary Key", id: 3 }
]
*/

alert( usersMapped[0].id ) // 1
alert( usersMapped[0].fullName ) // John Smith</code></pre>
        </div>
      </div>
      
      </div><p>So, actually you need to map one array of objects to another. Try using <code>=&gt;</code> here. There's a small catch.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-highlight-block="6-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John", surname: "Smith", id: 1 };
let pete = { name: "Pete", surname: "Hunt", id: 2 };
let mary = { name: "Mary", surname: "Key", id: 3 };

let users = [ john, pete, mary ];

let usersMapped = users.map(user =&gt; ({
  fullName: `${user.name} ${user.surname}`,
  id: user.id
}));

/*
usersMapped = [
  { fullName: "John Smith", id: 1 },
  { fullName: "Pete Hunt", id: 2 },
  { fullName: "Mary Key", id: 3 }
]
*/

alert( usersMapped[0].id ); // 1
alert( usersMapped[0].fullName ); // John Smith</code></pre>
        </div>
      </div>
      
      </div><p>Please note that in for the arrow functions we need to use additional brackets.</p>
<p>We can't write like this:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:36-37">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let usersMapped = users.map(user =&gt; {
  fullName: `${user.name} ${user.surname}`,
  id: user.id
});</code></pre>
        </div>
      </div>
      
      </div><p>As we remember, there are two arrow functions: without body <code>value =&gt; expr</code> and with body <code>value =&gt; {...}</code>.</p>
<p>Here JavaScript would treat <code>{</code> as the start of function body, not the start of the object. The workaround is to wrap them in the “normal” brackets:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:36-38">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let usersMapped = users.map(user =&gt; ({
  fullName: `${user.name} ${user.surname}`,
  id: user.id
}));</code></pre>
        </div>
      </div>
      
      </div><p>Now fine.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sort-objects" name="sort-objects" class="main__anchor">Sort objects</a></h3>
<a href="http://javascript.info/task/sort-objects" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write the function <code>sortByName(users)</code> that gets an array of objects with property <code>name</code> and sorts it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John", age: 25 };
let pete = { name: "Pete", age: 30 };
let mary = { name: "Mary", age: 28 };

let arr = [ john, pete, mary ];

sortByName(arr);

// now: [john, mary, pete]
alert(arr[1].name); // Mary</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sortByName(arr) {
  arr.sort((a, b) =&gt; a.name &gt; b.name);
}

let john = { name: "John", age: 25 };
let pete = { name: "Pete", age: 30 };
let mary = { name: "Mary", age: 28 };

let arr = [ john, pete, mary ];

sortByName(arr);

// now sorted is: [john, mary, pete]
alert(arr[1].name); // Mary</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#shuffle-an-array" name="shuffle-an-array" class="main__anchor">Shuffle an array</a></h3>
<a href="http://javascript.info/task/shuffle" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>Write the function <code>shuffle(array)</code> that shuffles (randomly reorders) elements of the array.</p>
<p>Multiple runs of <code>shuffle</code> may lead to different orders of elements. For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3];

shuffle(arr);
// arr = [3, 2, 1]

shuffle(arr);
// arr = [2, 1, 3]

shuffle(arr);
// arr = [3, 1, 2]
// ...</code></pre>
        </div>
      </div>
      
      </div><p>All element orders should have an equal probability. For instance, <code>[1,2,3]</code> can be reordered as <code>[1,2,3]</code> or <code>[1,3,2]</code> or <code>[3,1,2]</code> etc, with equal probability of each case.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The simple solution could be:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function shuffle(array) {
  array.sort(() =&gt; Math.random() - 0.5);
}

let arr = [1, 2, 3];
shuffle(arr);
alert(arr);</code></pre>
        </div>
      </div>
      
      </div><p>That somewhat works, because <code>Math.random() - 0.5</code> is a random number that may be positive or negative, so the sorting function reorders elements randomly.</p>
<p>But because the sorting function is not meant to be used this way, not all permutations have the same probability.</p>
<p>For instance, consider the code below. It runs <code>shuffle</code> 1000000 times and counts appearances of all possible results:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function shuffle(array) {
  array.sort(() =&gt; Math.random() - 0.5);
}

// counts of appearances for all possible permutations
let count = {
  '123': 0,
  '132': 0,
  '213': 0,
  '231': 0,
  '321': 0,
  '312': 0
};

for (let i = 0; i &lt; 1000000; i++) {
  let array = [1, 2, 3];
  shuffle(array);
  count[array.join('')]++;
}

// show counts of all possible permutations
for (let key in count) {
  alert(`${key}: ${count[key]}`);
}</code></pre>
        </div>
      </div>
      
      </div><p>An example result (for V8, July 2017):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">123: 250706
132: 124425
213: 249618
231: 124880
312: 125148
321: 125223</code></pre>
        </div>
      </div>
      
      </div><p>We can see the bias clearly: <code>123</code> and <code>213</code> appear much more often than others.</p>
<p>The result of the code may vary between JavaScript engines, but we can already see that the approach is unreliable.</p>
<p>Why it doesn't work? Generally speaking, <code>sort</code> is a “black box”: we throw an array and a comparison function into it and expect the array to be sorted. But due to the utter randomness of the comparison the black box goes mad, and how exactly it goes mad depends on the concrete implementation that differs between engines.</p>
<p>There are other good ways to do the task. For instance, there's a great algorithm called 
<a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle">Fisher-Yates shuffle</a>. The idea is to walk the array in the reverse order and swap each element with a random one before it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function shuffle(array) {
  for (let i = array.length - 1; i &gt; 0; i--) {
    let j = Math.floor(Math.random() * (i + 1)); // random index from 0 to i
    [array[i], array[j]] = [array[j], array[i]]; // swap elements
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>Let's test it the same way:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function shuffle(array) {
  for (let i = array.length - 1; i &gt; 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// counts of appearances for all possible permutations
let count = {
  '123': 0,
  '132': 0,
  '213': 0,
  '231': 0,
  '321': 0,
  '312': 0
};

for (let i = 0; i &lt; 1000000; i++) {
  let array = [1, 2, 3];
  shuffle(array);
  count[array.join('')]++;
}

// show counts of all possible permutations
for (let key in count) {
  alert(`${key}: ${count[key]}`);
}</code></pre>
        </div>
      </div>
      
      </div><p>The example output:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">123: 166693
132: 166647
213: 166628
231: 167517
312: 166199
321: 166316</code></pre>
        </div>
      </div>
      
      </div><p>Looks good now: all permutations appear with the same probability.</p>
<p>Also, performance-wise the Fisher-Yates algorithm is much better, there's no “sorting” overhead.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#get-average-age" name="get-average-age" class="main__anchor">Get average age</a></h3>
<a href="http://javascript.info/task/average-age" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write the function <code>getAverageAge(users)</code> that gets an array of objects with property <code>age</code> and gets the average.</p>
<p>The formula for the average is <code>(age1 + age2 + ... + ageN) / N</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John", age: 25 };
let pete = { name: "Pete", age: 30 };
let mary = { name: "Mary", age: 29 };

let arr = [ john, pete, mary ];

alert( getAverageAge(arr) ); // (25 + 30 + 29) / 3 = 28</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getAverageAge(users) {
  return users.reduce((prev, user) =&gt; prev + user.age, 0) / users.length;
}

let john = { name: "John", age: 25 };
let pete = { name: "Pete", age: 30 };
let mary = { name: "Mary", age: 29 };

let arr = [ john, pete, mary ];

alert( getAverageAge(arr) ); // 28</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#filter-unique-array-members" name="filter-unique-array-members" class="main__anchor">Filter unique array members</a></h3>
<a href="http://javascript.info/task/array-unique" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Let <code>arr</code> be an array.</p>
<p>Create a function <code>unique(arr)</code> that should return an array with unique items of <code>arr</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function unique(arr) {
  /* your code */
}

let strings = ["Hare", "Krishna", "Hare", "Krishna",
  "Krishna", "Krishna", "Hare", "Hare", ":-O"
];

alert( unique(strings) ); // Hare, Krishna, :-O</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/WCPR3saRXAFj0v8g52su?p=preview" target="_blank" data-plunk-id="WCPR3saRXAFj0v8g52su">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Let's walk the array items:</p>
<ul>
<li>For each item we'll check if the resulting array already has that item.</li>
<li>If it is so, then ignore, otherwise add to results.</li>
</ul>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function unique(arr) {
  let result = [];

  for (let str of arr) {
    if (!result.includes(str)) {
      result.push(str);
    }
  }

  return result;
}

let strings = ["Hare", "Krishna", "Hare", "Krishna",
  "Krishna", "Krishna", "Hare", "Hare", ":-O"
];

alert( unique(strings) ); // Hare, Krishna, :-O</code></pre>
        </div>
      </div>
      
      </div><p>The code works, but there's a potential performance problem in it.</p>
<p>The method <code>result.includes(str)</code> internally walks the array <code>result</code> and compares each element against <code>str</code> to find the match.</p>
<p>So if there are <code>100</code> elements in <code>result</code> and no one matches <code>str</code>, then it will walk the whole <code>result</code> and do exactly <code>100</code> comparisons. And if <code>result</code> is large, like <code>10000</code>, then there would be <code>10000</code> comparisons.</p>
<p>That's not a problem by itself, because JavaScript engines are very fast, so walk <code>10000</code> array is a matter of microseconds.</p>
<p>But we do such test for each element of <code>arr</code>, in the <code>for</code> loop.</p>
<p>So if <code>arr.length</code> is <code>10000</code> we'll have something like <code>10000*10000</code> = 100 millions of comparisons. That's a lot.</p>
<p>So the solution is only good for small arrays.</p>
<p>Further in the chapter 
<a href="http://javascript.info/map-set-weakmap-weakset">Map, Set, WeakMap and WeakSet</a> we'll see how to optimize it.</p>
<p>
<a href="http://plnkr.co/edit/lTSytTlmQq8knrv9umpJ?p=preview" target="_blank" data-plunk-id="lTSytTlmQq8knrv9umpJ">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-329"></h6>
<h1 class="main__header-title" id="chapter-330">Iterables</h1>
<p><em>Iterable</em> objects is a generalization of arrays. That's a concept that allows to make any object useable in a <code>for..of</code> loop.</p>
<p>Arrays by themselves are iterable. But not only arrays. Strings are iterable too, and many other built-in objects as well.</p>
<p>Iterables are widely used by the core JavaScript. As we'll see many built-in operators and methods rely on them.</p>


<h2 id="chapter-331">
Symbol.iterator</h2>
<p>We can easily grasp the concept of iterables by making one of our own.</p>
<p>For instance, we have an object, that is not an array, but looks suitable for <code>for..of</code>.</p>
<p>Like a <code>range</code> object that represents an interval of numbers:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let range = {
  from: 1,
  to: 5
};

// We want the for..of to work:
// for(let num of range) ... num=1,2,3,4,5</code></pre>
        </div>
      </div>
      
      </div><p>To make the <code>range</code> iterable (and thus let <code>for..of</code> work) we need to add a method to the object named <code>Symbol.iterator</code> (a special built-in symbol just for that).</p>
<ul>
<li>When <code>for..of</code> starts, it calls that method (or errors if not found).</li>
<li>The method must return an <em>iterator</em> – an object with the method <code>next</code>.</li>
<li>When <code>for..of</code> wants the next value, it calls <code>next()</code> on that object.</li>
<li>The result of <code>next()</code> must have the form <code>{done: Boolean, value: any}</code>, where <code>done=true</code>  means that the iteration is finished, otherwise <code>value</code> must be the new value.</li>
</ul>
<p>Here's the full implementation for <code>range</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let range = {
  from: 1,
  to: 5
};

// 1. call to for..of initially calls this
range[Symbol.iterator] = function() {

  // 2. ...it returns the iterator:
  return {
    current: this.from,
    last: this.to,

    // 3. next() is called on each iteration by the for..of loop
    next() {
      // 4. it should return the value as an object {done:.., value :...}
      if (this.current &lt;= this.last) {
        return { done: false, value: this.current++ };
      } else {
        return { done: true };
      }
    }
  };
};

// now it works!
for (let num of range) {
  alert(num); // 1, then 2, 3, 4, 5
}</code></pre>
        </div>
      </div>
      
      </div><p>There is an important separation of concerns in this code:</p>
<ul>
<li>The <code>range</code> itself does not have the <code>next()</code> method.</li>
<li>Instead, another object, a so-called “iterator” is created by the call to <code>range[Symbol.iterator]()</code>, and it handles the iteration.</li>
</ul>
<p>So, the iterator object is separate from the object it iterates over.</p>
<p>Technically, we may merge them and use <code>range</code> itself as the iterator to make the code simpler.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let range = {
  from: 1,
  to: 5,

  [Symbol.iterator]() {
    this.current = this.from;
    return this;
  },

  next() {
    if (this.current &lt;= this.to) {
      return { done: false, value: this.current++ };
    } else {
      return { done: true };
    }
  }
};

for (let num of range) {
  alert(num); // 1, then 2, 3, 4, 5
}</code></pre>
        </div>
      </div>
      
      </div><p>Now <code>range[Symbol.iterator]()</code> returns the <code>range</code> object itself:  it has the necessary <code>next()</code> method and remembers the current iteration progress in <code>this.current</code>. Sometimes that's fine too. The downside is that now it's impossible to have two <code>for..of</code> loops running over the object simultaneously: they'll share the iteration state, because there's only one iterator – the object itself.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Infinite iterators</span></div>
            <div class="important__content"><p>Infinite iterators are also doable. For instance, the <code>range</code> becomes infinite for <code>range.to = Infinity</code>. Or we can make an iterable object that generates an infinite sequence of pseudorandom numbers. Also can be useful.</p>
<p>There are no limitations on <code>next</code>, it can return more and more values, that's normal.</p>
<p>Of course, the <code>for..of</code> loop over such an iterable would be endless. But we can always stop it using <code>break</code>.</p>
</div></div>
<h2 id="chapter-332">
String is iterable</h2>
<p>Arrays and strings are most widely used built-in iterables.</p>
<p>For a string, <code>for..of</code> loops over its characters:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let char of "test") {
  alert( char ); // t, then e, then s, then t
}</code></pre>
        </div>
      </div>
      
      </div><p>And it works right with surrogate pairs!</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '𝒳😂';
for (let char of str) {
    alert( char ); // 𝒳, and then 😂
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-333">
Calling an iterator explicitly</h2>
<p>Normally, internals of iterables are hidden from the external code. There's a <code>for..of</code> loop, that works, that's all it needs to know.</p>
<p>But to understand things a little bit deeper let's see how to create an iterator explicitly.</p>
<p>We'll iterate over a string the same way as <code>for..of</code>, but with direct calls. This code gets a string iterator and calls it “manually”:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Hello";

// does the same as
// for (let char of str) alert(char);

let iterator = str[Symbol.iterator]();

while (true) {
  let result = iterator.next();
  if (result.done) break;
  alert(result.value); // outputs characters one by one
}</code></pre>
        </div>
      </div>
      
      </div><p>That is rarely needed, but gives us more control over the process than <code>for..of</code>. For instance, we can split the iteration process: iterate a bit, then stop, do something else, and then resume later.</p>
<h2 id="chapter-334">
Iterables and array-likes</h2>
<p>There are two official terms that look similar, but are very different. Please make sure you understand them well to avoid the confusion.</p>
<ul>
<li><em>Iterables</em> are objects that implement the <code>Symbol.iterator</code> method, as described above.</li>
<li><em>Array-likes</em> are objects that have indexes and <code>length</code>, so they look like arrays.</li>
</ul>
<p>Naturally, these properties can combine. For instance, strings are both iterable (<code>for..of</code> works on them) and array-like (they have numeric indexes and <code>length</code>).</p>
<p>But an iterable may be not array-like. And vice versa an array-like may be not iterable.</p>
<p>For example, the <code>range</code> in the example above is iterable, but not array-like, because it does not have indexed properties and <code>length</code>.</p>
<p>And here's the object that is array-like, but not iterable:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arrayLike = { // has indexes and length =&gt; array-like
  0: "Hello",
  1: "World",
  length: 2
};

// Error (no Symbol.iterator)
for (let item of arrayLike) {}</code></pre>
        </div>
      </div>
      
      </div><p>What they share in common – both iterables and array-likes are usually <em>not arrays</em>, they don't have <code>push</code>, <code>pop</code> etc. That's rather inconvenient if we have such an object and want to work with it as with an array.</p>
<h2 id="chapter-335">
Array.from</h2>
<p>There's a universal method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from">Array.from</a> that brings them together. It takes an iterable or array-like value and makes a “real” <code>Array</code> from it. Then we can call array methods on it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arrayLike = {
  0: "Hello",
  1: "World",
  length: 2
};

let arr = Array.from(arrayLike); // (*)
alert(arr.pop()); // World (method works)</code></pre>
        </div>
      </div>
      
      </div><p><code>Array.from</code> at the line <code>(*)</code> takes the object, examines it for being an iterable or array-like, then makes a new array and copies there all items.</p>
<p>The same happens for an iterable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// assuming that range is taken from the example above
let arr = Array.from(range);
alert(arr); // 1,2,3,4,5 (array toString conversion works)</code></pre>
        </div>
      </div>
      
      </div><p>The full syntax for <code>Array.from</code> allows to provide an optional “mapping” function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Array.from(obj[, mapFn, thisArg])</code></pre>
        </div>
      </div>
      
      </div><p>The second argument <code>mapFn</code> should be the function to apply to each element before adding to the array, and <code>thisArg</code> allows to set <code>this</code> for it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// assuming that range is taken from the example above

// square each number
let arr = Array.from(range, num =&gt; num * num);

alert(arr); // 1,4,9,16,25</code></pre>
        </div>
      </div>
      
      </div><p>Here we use <code>Array.from</code> to turn a string into an array of characters:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '𝒳😂';

// splits str into array of characters
let chars = Array.from(str);

alert(chars[0]); // 𝒳
alert(chars[1]); // 😂
alert(chars.length); // 2</code></pre>
        </div>
      </div>
      
      </div><p>Unlike <code>str.split</code>, it relies on the iterable nature of the string and so, just like <code>for..of</code>, correctly works with surrogate pairs.</p>
<p>Technically here it does the same as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '𝒳😂';

let chars = []; // Array.from internally does the same loop
for (let char of str) {
  chars.push(char);
}

alert(chars);</code></pre>
        </div>
      </div>
      
      </div><p>…But is shorter.</p>
<p>We can even build surrogate-aware <code>slice</code> on it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function slice(str, start, end) {
  return Array.from(str).slice(start, end).join('');
}

let str = '𝒳😂𩷶';

alert( slice(str, 1, 3) ); // 😂𩷶

// native method does not support surrogate pairs
alert( str.slice(1, 3) ); // garbage (two pieces from different surrogate pairs)</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-336">
Summary</h2>
<p>Objects that can be used in <code>for..of</code> are called <em>iterable</em>.</p>
<ul>
<li>Technically, iterables must implement the method named <code>Symbol.iterator</code>.
<ul>
<li>The result of <code>obj[Symbol.iterator]</code> is called an <em>iterator</em>. It handles the further iteration process.</li>
<li>An iterator must have the method named <code>next()</code> that returns an object <code>{done: Boolean, value: any}</code>, here <code>done:true</code> denotes the iteration end, otherwise the <code>value</code> is the next value.</li>
</ul>
</li>
<li>The <code>Symbol.iterator</code> method is called automatically by <code>for..of</code>, but we also can do it directly.</li>
<li>Built-in iterables like strings or arrays, also implement <code>Symbol.iterator</code>.</li>
<li>String iterator knows about surrogate pairs.</li>
</ul>
<p>Objects that have indexed properties and <code>length</code> are called <em>array-like</em>. Such objects may also have other properties and methods, but lack built-in methods of arrays.</p>
<p>If we look inside the specification – we'll see that most built-in methods assume that they work with iterables or array-likes instead of “real” arrays, because that's more abstract.</p>
<p><code>Array.from(obj[, mapFn, thisArg])</code> makes a real <code>Array</code> of an iterable or array-like <code>obj</code>, and then we can use array methods on it. The optional arguments <code>mapFn</code> and <code>thisArg</code> allow to apply a function to each item.</p>

<h6 id="chapter-337"></h6>
<h1 class="main__header-title" id="chapter-338">Map, Set, WeakMap and WeakSet</h1>
<p>Now we know the following complex data structures:</p>
<ul>
<li>Objects for storing keyed collections.</li>
<li>Arrays for storing ordered collections.</li>
</ul>
<p>But that's not enough for real life. That's why there also exist <code>Map</code> and <code>Set</code>.</p>
<h2 id="chapter-339">
Map</h2>
<p>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a> is a collection of keyed data items. Just like an <code>Object</code>. But the main difference is that <code>Map</code> allows keys of any type.</p>
<p>The main methods are:</p>
<ul>
<li><code>new Map()</code> – creates the map.</li>
<li><code>map.set(key, value)</code> – stores the value by the key.</li>
<li><code>map.get(key)</code> – returns the value by the key, <code>undefined</code> if <code>key</code> doesn't exist in map.</li>
<li><code>map.has(key)</code> – returns <code>true</code> if the <code>key</code> exists, <code>false</code> otherwise.</li>
<li><code>map.delete(key)</code> – removes the value by the key.</li>
<li><code>map.clear()</code> – clears the map</li>
<li><code>map.size</code> – is the current elements count.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let map = new Map();

map.set('1', 'str1');   // a string key
map.set(1, 'num1');     // a numeric key
map.set(true, 'bool1'); // a boolean key

// remember the regular Object? it would convert keys to string
// Map keeps the type, so these two are different:
alert( map.get(1)   ); // 'num1'
alert( map.get('1') ); // 'str1'

alert( map.size ); // 3</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, unlike objects, keys are not converted to strings. Any type of key is possible.</p>
<p><strong>Map can also use objects as keys.</strong></p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John" };

// for every user, let's store his visits count
let visitsCountMap = new Map();

// john is the key for the map
visitsCountMap.set(john, 123);

alert( visitsCountMap.get(john) ); // 123</code></pre>
        </div>
      </div>
      
      </div><p>Using objects as keys is one of most notable and important <code>Map</code> features. For string keys, <code>Object</code> can be fine, but it would be difficult to replace the <code>Map</code> with a regular <code>Object</code> in the example above.</p>
<p>In the old times, before <code>Map</code> existed, people added unique identifiers to objects for that:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:27-32">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// we add the id field
let john = { name: "John", id: 1 };

let visitsCounts = {};

// now store the value by id
visitsCounts[john.id] = 123;

alert( visitsCounts[john.id] ); // 123</code></pre>
        </div>
      </div>
      
      </div><p>…But <code>Map</code> is much more elegant.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">How <code>Map</code> compares keys</span></div>
            <div class="important__content"><p>To test values for equivalence, <code>Map</code> uses the algorithm 
<a href="https://tc39.github.io/ecma262/#sec-samevaluezero">SameValueZero</a>. It is roughly the same as the strict equality <code>===</code>, but the difference is that <code>NaN</code> is considered equal to <code>NaN</code>. So <code>NaN</code> can be used as the key as well.</p>
<p>This algorithm can't be changed or customized.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Chaining</span></div>
            <div class="important__content"><p>Every <code>map.set</code> call returns the map itself, so we can “chain” the calls:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">map.set('1', 'str1')
  .set(1, 'num1')
  .set(true, 'bool1');</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-340">
Map from Object</h2>
<p>When a <code>Map</code> is created, we can pass an array (or another iterable) with key-value pairs, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// array of [key, value] pairs
let map = new Map([
  ['1',  'str1'],
  [1,    'num1'],
  [true, 'bool1']
]);</code></pre>
        </div>
      </div>
      
      </div><p>There is a built-in method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">Object.entries(obj)</a> that returns the array of key/value pairs for an object exactly in that format.</p>
<p>So we can initialize a map from an object like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let map = new Map(Object.entries({
  name: "John",
  age: 30
}));</code></pre>
        </div>
      </div>
      
      </div><p>Here, <code>Object.entries</code> returns the array of key/value pairs: <code>[ ["name","John"], ["age", 30] ]</code>. That's what <code>Map</code> needs.</p>
<h2 id="chapter-341">
Iteration over Map</h2>
<p>For looping over a <code>map</code>, there are 3 methods:</p>
<ul>
<li><code>map.keys()</code> – returns an iterable for keys,</li>
<li><code>map.values()</code> – returns an iterable for values,</li>
<li><code>map.entries()</code> – returns an iterable for entries <code>[key, value]</code>, it's used by default in <code>for..of</code>.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let recipeMap = new Map([
  ['cucumber', 500],
  ['tomatoes', 350],
  ['onion',    50]
]);

// iterate over keys (vegetables)
for (let vegetable of recipeMap.keys()) {
  alert(vegetable); // cucumber, tomateos, onion
}

// iterate over values (amounts)
for (let amount of recipeMap.values()) {
  alert(amount); // 500, 350, 50
}

// iterate over [key, value] entries
for (let entry of recipeMap) { // the same as of recipeMap.entries()
  alert(entry); // cucumber,500 (and so on)
}</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">The insertion order is used</span></div>
            <div class="important__content"><p>The iteration goes in the same order as the values were inserted. <code>Map</code> preserves this order, unlike a regular <code>Object</code>.</p>
</div></div>
<p>Besides that, <code>Map</code> has a built-in <code>forEach</code> method, similar to <code>Array</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">recipeMap.forEach( (value, key, map) =&gt; {
  alert(`${key}: ${value}`); // cucumber: 500 etc
});</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-342">
Set</h2>
<p><code>Set</code> – is a collection of values, where each value may occur only once.</p>
<p>The main methods are:</p>
<ul>
<li><code>new Set(iterable)</code> – creates the set, optionally from an array of values (any iterable will do).</li>
<li><code>set.add(value)</code> – adds a value, returns the set itself.</li>
<li><code>set.delete(value)</code> – removes the value, returns <code>true</code> if <code>value</code> existed at the moment of the call, otherwise <code>false</code>.</li>
<li><code>set.has(value)</code> – returns <code>true</code> if the value exists in the set, otherwise <code>false</code>.</li>
<li><code>set.clear()</code> – removes everything from the set.</li>
<li><code>set.size</code> – is the elements count.</li>
</ul>
<p>For example, we have visitors coming, and we'd like to remember everyone. But repeated visits should not lead to duplicates. A visitor must be “counted” only once.</p>
<p><code>Set</code> is just the right thing for that:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let set = new Set();

let john = { name: "John" };
let pete = { name: "Pete" };
let mary = { name: "Mary" };

// visits, some users come multiple times
set.add(john);
set.add(pete);
set.add(mary);
set.add(john);
set.add(mary);

// set keeps only unique values
alert( set.size ); // 3

for (let user of set) {
  alert(user.name); // John (then Pete and Mary)
}</code></pre>
        </div>
      </div>
      
      </div><p>The alternative to <code>Set</code> could be an array of users, and the code to check for duplicates on every insertion using 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find">arr.find</a>. But the performance would be much worse, because this method walks through the whole array checking every element. <code>Set</code> is much better optimized internally for uniqueness checks.</p>
<h2 id="chapter-343">
Iteration over Set</h2>
<p>We can loop over a set either with <code>for..of</code> or using <code>forEach</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let set = new Set(["oranges", "apples", "bananas"]);

for (let value of set) alert(value);

// the same with forEach:
set.forEach((value, valueAgain, set) =&gt; {
  alert(value);
});</code></pre>
        </div>
      </div>
      
      </div><p>Note the funny thing. The <code>forEach</code> function in the <code>Set</code> has 3 arguments: a value, then <em>again a value</em>, and then the target object. Indeed, the same value appears in the arguments twice.</p>
<p>That's made for compatibility with <code>Map</code> where <code>forEach</code> has three arguments.</p>
<p>The same methods as <code>Map</code> has for iterators are also supported:</p>
<ul>
<li><code>set.keys()</code> – returns an iterable object for values,</li>
<li><code>set.values()</code> – same as <code>set.keys</code>, for compatibility with <code>Map</code>,</li>
<li><code>set.entries()</code> – returns an iterable object for entries <code>[value, value]</code>, exists for compatibility with <code>Map</code>.</li>
</ul>
<h2 id="chapter-344">
WeakMap and WeakSet</h2>
<p><code>WeakSet</code> is a special kind of <code>Set</code> that does not prevent JavaScript from removing its items from memory. <code>WeakMap</code> is the same thing for <code>Map</code>.</p>
<p>As we know from the chapter 
<a href="http://javascript.info/garbage-collection">Garbage collection</a>, JavaScript engine stores a value in memory while it is reachable (and can potentially be used).</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John" };

// the object can be accessed, john is the reference to it

// overwrite the reference
john = null;

// the object will be removed from memory</code></pre>
        </div>
      </div>
      
      </div><p>Usually, properties of an object or elements of an array or another data structure are considered reachable and kept in memory while that data structure is in memory.</p>
<p>In a regular <code>Map</code>, it does not matter if we store an object as a key or as a value. It's kept in memory even if there are no more references to it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-8">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John" };

let map = new Map();
map.set(john, "...");

john = null; // overwrite the reference

// john is stored inside the map
// we can get it by using map.keys()</code></pre>
        </div>
      </div>
      
      </div><p>With the exception of <code>WeakMap/WeakSet</code>.</p>
<p><strong><code>WeakMap/WeakSet</code> does not prevent the object removal from the memory.</strong></p>
<p>Let's start with <code>WeakMap</code>.</p>
<p>The first difference from <code>Map</code> is that its keys must be  objects, not primitive values:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let weakMap = new WeakMap();

let obj = {};

weakMap.set(obj, "ok"); // works fine (object key)

weakMap.set("test", "Whoops"); // Error, because "test" is a primitive</code></pre>
        </div>
      </div>
      
      </div><p>Now, if we use an object as the key in it, and there are no other references to that object – it will be removed from memory (and from the map) automatically.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John" };

let weakMap = new WeakMap();
weakMap.set(john, "...");

john = null; // overwrite the reference

// john is removed from memory!</code></pre>
        </div>
      </div>
      
      </div><p>Compare it with the regular <code>Map</code> example above. Now if <code>john</code> only exists as the key of <code>WeakMap</code> – it is to be automatically deleted.</p>
<p>…And <code>WeakMap</code> does not support methods <code>keys()</code>, <code>values()</code>, <code>entries()</code>, we can not iterate over it. So there's really no way to receive all keys or values from it.</p>
<p><code>WeakMap</code> has only the following methods:</p>
<ul>
<li><code>weakMap.get(key)</code></li>
<li><code>weakMap.set(key, value)</code></li>
<li><code>weakMap.delete(key, value)</code></li>
<li><code>weakMap.has(key)</code></li>
</ul>
<p>Why such a limitation? That's for technical reasons. If the object has lost all other references (like <code>john</code> in the code above), then it is to be deleted automatically. But technically it's not exactly specified <em>when the cleanup happens</em>.</p>
<p>The JavaScript engine decides that. It may choose to perform the memory cleanup immediately or to wait and do the cleaning later when more deletions happen. So, technically the current element count of the <code>WeakMap</code> is not known. The engine may have cleaned it up or not, or did it partially. For that reason, methods that access <code>WeakMap</code> as a whole are not supported.</p>
<p>Now where do we need such thing?</p>
<p>The idea of <code>WeakMap</code> is that we can store something for an object that exists only while the object exists. But we do not force the object to live by the mere fact that we store something for it.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">weakMap.put(john, "secret documents");
// if john dies, secret documents will be destroyed</code></pre>
        </div>
      </div>
      
      </div><p>That's useful for situations when we have a main storage for the objects somewhere and need to keep additional information that is only relevant while the object lives.</p>
<p>Let's see an example.</p>
<p>For instance, we have a code that keeps a visit count for each user. The information is stored in a map: a user is the key and the visit count is the value. When a user leaves, we don't want to store his visit count anymore.</p>
<p>One way would be to keep track of leaving users and clean up the storage manually:</p>
<div data-trusted="1" class="code-example" data-highlight-block="11-11">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John" };

// map: user =&gt; visits count
let visitsCountMap = new Map();

// john is the key for the map
visitsCountMap.set(john, 123);

// now john leaves us, we don't need him anymore
john = null;

// but it's still in the map, we need to clean it!
alert( visitsCountMap.size ); // 1
// it's also in the memory, because Map uses it as the key</code></pre>
        </div>
      </div>
      
      </div><p>Another way would be to use <code>WeakMap</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let john = { name: "John" };

let visitsCountMap = new WeakMap();

visitsCountMap.set(john, 123);

// now john leaves us, we don't need him anymore
john = null;

// there are no references except WeakMap,
// so the object is removed both from the memory and from visitsCountMap automatically</code></pre>
        </div>
      </div>
      
      </div><p>With a regular <code>Map</code>, cleaning up after a user has left becomes a tedious task: we not only need to remove the user from its main storage (be it a variable or an array), but also need to clean up the additional stores like <code>visitsCountMap</code>. And it can become cumbersome in more complex cases when users are managed in one place of the code and the additional structure is at another place and is getting no information about removals.</p>
<p><code>WeakMap</code> can make things simpler, because it is cleaned up automatically. The information in it like visits count in the example above lives only while the key object exists.</p>
<p><code>WeakSet</code> behaves similarly:</p>
<ul>
<li>It is analogous to <code>Set</code>, but we may only add objects to <code>WeakSet</code> (not primitives).</li>
<li>An object exists in the set while it has reachable from somewhere else.</li>
<li>Like <code>Set</code>, it supports <code>add</code>, <code>has</code> and <code>delete</code>, but not <code>size</code>, <code>keys()</code> and no iterations.</li>
</ul>
<p>For instance, we can use it to keep track of whether an item is checked:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let messages = [
    {text: "Hello", from: "John"},
    {text: "How goes?", from: "John"},
    {text: "See you soon", from: "Alice"}
];

// fill it with array elements (3 items)
let unreadSet = new WeakSet(messages);

// we can use unreadSet to see whether a message is unread
alert(unreadSet.has(messages[1])); // true
// remove it from the set after reading
unreadSet.delete(messages[1]); // true

// and when we shift our messages history, the set is cleaned up automatically
messages.shift();
// no need to clean unreadSet, it now has 2 items
// unfortunately, there's no method to get the exact count of items, so can't show it</code></pre>
        </div>
      </div>
      
      </div><p>The most notable limitation of <code>WeakMap</code> and <code>WeakSet</code> is the absence of iterations, and inability to get all current content. That may appear inconvenient, but actually does not prevent <code>WeakMap/WeakSet</code> from doing their main job – be an “additional” storage of data for objects which are stored/managed at another place.</p>
<h2 id="chapter-345">
Summary</h2>
<ul>
<li>
<p><code>Map</code> – is a collection of keyed values.</p>
<p>The differences from a regular <code>Object</code>:</p>
<ul>
<li>Any keys, objects can be keys.</li>
<li>Iterates in the insertion order.</li>
<li>Additional convenient methods, the <code>size</code> property.</li>
</ul>
</li>
<li>
<p><code>Set</code> – is a collection of unique values.</p>
<ul>
<li>Unlike an array, does not allow to reorder elements.</li>
<li>Keeps the insertion order.</li>
</ul>
</li>
<li>
<p><code>WeakMap</code> – a variant of <code>Map</code> that allows only objects as keys and removes them once they become inaccessible by other means.</p>
<ul>
<li>It does not support operations on the structure as a whole: no <code>size</code>, no <code>clear()</code>, no iterations.</li>
</ul>
</li>
<li>
<p><code>WeakSet</code> – is a variant of <code>Set</code> that only stores objects and removes them once they become inaccessible by other means.</p>
<ul>
<li>Also does not support <code>size/clear()</code> and iterations.</li>
</ul>
</li>
</ul>
<p><code>WeakMap</code> and <code>WeakSet</code> are used as “secondary” data structures in addition to the “main” object storage. Once the object is removed from the main storage, so it only stays in <code>WeakMap/WeakSet</code>, they clean up automatically.</p>
<div class="tasks"><h2 id="chapter-346" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#filter-unique-array-members" name="filter-unique-array-members" class="main__anchor">Filter unique array members</a></h3>
<a href="http://javascript.info/task/array-unique-map" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Let <code>arr</code> be an array.</p>
<p>Create a function <code>unique(arr)</code> that should return an array with unique items of <code>arr</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function unique(arr) {
  /* your code */
}

let values = ["Hare", "Krishna", "Hare", "Krishna",
  "Krishna", "Krishna", "Hare", "Hare", ":-O"
];

alert( unique(values) ); // Hare, Krishna, :-O</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Here strings are used, but can be values of any type.</p>
<p>P.P.S. Use <code>Set</code> to store unique values.</p>
<p>
<a href="http://plnkr.co/edit/5723QOW4plHd72CFnXkt?p=preview" target="_blank" data-plunk-id="5723QOW4plHd72CFnXkt">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/K1mUBA0aoBVuzuGORbwa?p=preview" target="_blank" data-plunk-id="K1mUBA0aoBVuzuGORbwa">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#filter-anagrams" name="filter-anagrams" class="main__anchor">Filter anagrams</a></h3>
<a href="http://javascript.info/task/filter-anagrams" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>
<a href="https://en.wikipedia.org/wiki/Anagram">Anagrams</a> are words that have the same number of same letters, but in different order.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">nap - pan
ear - are - era
cheaters - hectares - teachers</code></pre>
        </div>
      </div>
      
      </div><p>Write a function <code>aclean(arr)</code> that returns an array cleaned from anagrams.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = ["nap", "teachers", "cheaters", "PAN", "ear", "era", "hectares"];

alert( aclean(arr) ); // "nap,teachers,ear" or "PAN,cheaters,era"</code></pre>
        </div>
      </div>
      
      </div><p>From every anagram group should remain only one word, no matter which one.</p>
<p>
<a href="http://plnkr.co/edit/mOXBagh2btVcbeVvyR6s?p=preview" target="_blank" data-plunk-id="mOXBagh2btVcbeVvyR6s">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To find all anagrams, let's split every word to letters and sort them. When letter-sorted, all anagrams are same.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">nap, pan -&gt; anp
ear, era, are -&gt; aer
cheaters, hectares, teachers -&gt; aceehrst
...</code></pre>
        </div>
      </div>
      
      </div><p>We'll use the letter-sorted variants as map keys to store only one value per each key:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function aclean(arr) {
  let map = new Map();

  for (let word of arr) {
    // split the word by letters, sort them and join back
    let sorted = word.toLowerCase().split('').sort().join(''); // (*)
    map.set(sorted, word);
  }

  return Array.from(map.values());
}

let arr = ["nap", "teachers", "cheaters", "PAN", "ear", "era", "hectares"];

alert( aclean(arr) );</code></pre>
        </div>
      </div>
      
      </div><p>Letter-sorting is done by the chain of calls in the line <code>(*)</code>.</p>
<p>For convenience let's split it into multiple lines:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sorted = arr[i] // PAN
  .toLowerCase() // pan
  .split('') // ['p','a','n']
  .sort() // ['a','n','p']
  .join(''); // anp</code></pre>
        </div>
      </div>
      
      </div><p>Two different words <code>'PAN'</code> and <code>'nap'</code> receive the same letter-sorted form <code>'anp'</code>.</p>
<p>The next line put the word into the map:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">map.set(sorted, word);</code></pre>
        </div>
      </div>
      
      </div><p>If we ever meet a word the same letter-sorted form again, then it would overwrite the previous value with the same key in the map. So we'll always have at maximum one word per letter-form.</p>
<p>At the end <code>Array.from(map.values())</code> takes an iterable over map values (we don't need keys in the result) and returns an array of them.</p>
<p>Here we could also use a plain object instead of the <code>Map</code>, because keys are strings.</p>
<p>That's how the solution can look:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function aclean(arr) {
  let obj = {};

  for (let i = 0; i &lt; arr.length; i++) {
    let sorted = arr[i].toLowerCase().split("").sort().join("");
    obj[sorted] = arr[i];
  }

  return Array.from(Object.values(obj));
}

let arr = ["nap", "teachers", "cheaters", "PAN", "ear", "era", "hectares"];

alert( aclean(arr) );</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/aRcFAWDuMSZOOwfJVIrR?p=preview" target="_blank" data-plunk-id="aRcFAWDuMSZOOwfJVIrR">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#iterable-keys" name="iterable-keys" class="main__anchor">Iterable keys</a></h3>
<a href="http://javascript.info/task/iterable-keys" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We want to get an array of <code>map.keys()</code> and go on working with it (apart from the map itself).</p>
<p>But there's a problem:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let map = new Map();

map.set("name", "John");

let keys = map.keys();

// Error: numbers.push is not a function
keys.push("more");</code></pre>
        </div>
      </div>
      
      </div><p>Why? How can we fix the code to make <code>keys.push</code> work?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>That's because <code>map.keys()</code> returns an iterable, but not an array.</p>
<p>We can convert it into an array using <code>Array.from</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let map = new Map();

map.set("name", "John");

let keys = Array.from(map.keys());

keys.push("more");

alert(keys); // name, more</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#store-unread-flags" name="store-unread-flags" class="main__anchor">Store "unread" flags</a></h3>
<a href="http://javascript.info/task/recipients-read" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's an array of messages:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let messages = [
    {text: "Hello", from: "John"},
    {text: "How goes?", from: "John"},
    {text: "See you soon", from: "Alice"}
];</code></pre>
        </div>
      </div>
      
      </div><p>Your code can access it, but the messages are managed by someone else's code. New messages are added, old ones are removed regularly by that code, and you don't know the exact moments when it happens.</p>
<p>Now, which data structure you could use to store information whether the message “have been read”? The structure must be well-suited to give the answer “was it read?” for the given message object.</p>
<p>P.S. When a message is removed from <code>messages</code>, it should disappear from your structure as well.</p>
<p>P.P.S. We shouldn't modify message objects directly. If they are managed by someone else's code, then adding extra properties to them may have bad consequences.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The sane choice here is a <code>WeakSet</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let messages = [
    {text: "Hello", from: "John"},
    {text: "How goes?", from: "John"},
    {text: "See you soon", from: "Alice"}
];

let readMessages = new WeakSet();

// two messages have been read
readMessages.add(messages[0]);
readMessages.add(messages[1]);
// readMessages has 2 elements

// ...let's read the first message again!
readMessages.add(messages[0]);
// readMessages still has 2 unique elements

// answer: was the message[0] read?
alert("Read message 0: " + readMessages.has(messages[0])); // true

messages.shift();
// now readMessages has 1 element (technically memory may be cleaned later)</code></pre>
        </div>
      </div>
      
      </div><p>The <code>WeakSet</code> allows to store a set of messages and easily check for the existance of a message in it.</p>
<p>It cleans up itself automatically. The tradeoff is that we can't iterate over it. We can't get “all read messages” directly. But we can do it by iterating over all messages and filtering those that are in the set.</p>
<p>P.S. Adding a property of our own to each message may be dangerous if messages are managed by someone else's code, but we can make it a symbol to evade conflicts.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// the symbolic property is only known to our code
let isRead = Symbol("isRead");
messages[0][isRead] = true;</code></pre>
        </div>
      </div>
      
      </div><p>Now even if someone else's code uses <code>for..in</code> loop for message properties, our secret flag won't appear.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#store-read-dates" name="store-read-dates" class="main__anchor">Store read dates</a></h3>
<a href="http://javascript.info/task/recipients-when-read" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's an array of messages as in the 
<a href="http://javascript.info/task/recipients-read">previous task</a>. The situation is similar.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let messages = [
    {text: "Hello", from: "John"},
    {text: "How goes?", from: "John"},
    {text: "See you soon", from: "Alice"}
];</code></pre>
        </div>
      </div>
      
      </div><p>The question now is: which data structure you'd suggest to store the information: “when the message was read?”.</p>
<p>In the previous task we only needed to store the “yes/no” fact. Now we need to store the date and it, once again, should disappear if the message is gone.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To store a date, we can use <code>WeakMap</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let messages = [
    {text: "Hello", from: "John"},
    {text: "How goes?", from: "John"},
    {text: "See you soon", from: "Alice"}
];

let readMap = new WeakMap();

readMap.set(messages[0], new Date(2017, 1, 1));
// Date object we'll study later</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-347"></h6>
<h1 class="main__header-title" id="chapter-348">Object.keys, values, entries</h1>
<p>Let's step away from the individual data structures and talk about the iterations over them.</p>
<p>In the previous chapter we saw methods <code>map.keys()</code>, <code>map.values()</code>, <code>map.entries()</code>.</p>
<p>These methods are generic, there is a common agreement to use them for data structures. If we ever create a data structure of our own, we should implement them too.</p>
<p>They are supported for:</p>
<ul>
<li><code>Map</code></li>
<li><code>Set</code></li>
<li><code>Array</code> (except <code>arr.values()</code>)</li>
</ul>
<p>Plain objects also support similar methods, but the syntax is a bit different.</p>
<h2 id="chapter-349">
Object.keys, values, entries</h2>
<p>For plain objects, the following methods are available:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys">Object.keys(obj)</a> – returns an array of keys.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/values">Object.values(obj)</a> – returns an array of values.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">Object.entries(obj)</a> – returns an array of <code>[key, value]</code> pairs.</li>
</ul>
<p>…But please note the distinctions (compared to map for example):</p>
<table>
<thead>
<tr>
<th></th>
<th>Map</th>
<th>Object</th>
</tr>
</thead>
<tbody>
<tr>
<td>Call syntax</td>
<td><code>map.keys()</code></td>
<td><code>Object.keys(obj)</code>, but not <code>obj.keys()</code></td>
</tr>
<tr>
<td>Returns</td>
<td>iterable</td>
<td>“real” Array</td>
</tr>
</tbody>
</table>
<p>The first difference is that we have to call <code>Object.keys(obj)</code>, and not <code>obj.keys()</code>.</p>
<p>Why so? The main reason is flexibility. Remember, objects are a base of all complex structures in JavaScript. So we may have an object of our own like <code>order</code> that implements its own <code>order.values()</code> method. And we still can call <code>Object.values(order)</code> on it.</p>
<p>The second difference is that <code>Object.*</code> methods return “real” array objects, not just an iterable. That's mainly for historical reasons.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30
};</code></pre>
        </div>
      </div>
      
      </div><ul>
<li><code>Object.keys(user) = [name, age]</code></li>
<li><code>Object.values(user) = ["John", 30]</code></li>
<li><code>Object.entries(user) = [ ["name","John"], ["age",30] ]</code></li>
</ul>
<p>Here's an example of using <code>Object.values</code> to loop over property values:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30
};

// loop over values
for (let value of Object.values(user)) {
  alert(value); // John, then 30
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-350">
Object.keys/values/entries ignore symbolic properties</h2>
<p>Just like a <code>for..in</code> loop, these methods ignore properties that use <code>Symbol(...)</code> as keys.</p>
<p>Usually that's convenient. But if we want symbolic keys too, then there's a separate method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols</a> that returns an array of only symbolic keys. Also, the method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys">Reflect.ownKeys(obj)</a> returns <em>all</em> keys.</p>
<div class="tasks"><h2 id="chapter-351" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sum-the-properties" name="sum-the-properties" class="main__anchor">Sum the properties</a></h3>
<a href="http://javascript.info/task/sum-salaries" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There is a <code>salaries</code> object with arbitrary number of salaries.</p>
<p>Write the function <code>sumSalaries(salaries)</code> that returns the sum of all salaries using <code>Object.values</code> and the <code>for..of</code> loop.</p>
<p>If <code>salaries</code> is empty, then the result must be <code>0</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let salaries = {
  "John": 100,
  "Pete": 300,
  "Mary": 250
};

alert( sumSalaries(salaries) ); // 650</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/zAop4fRA5aFSzxDkiK6o?p=preview" target="_blank" data-plunk-id="zAop4fRA5aFSzxDkiK6o">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/2CbjEnAipkl3SEeeaWOA?p=preview" target="_blank" data-plunk-id="2CbjEnAipkl3SEeeaWOA">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#count-properties" name="count-properties" class="main__anchor">Count properties</a></h3>
<a href="http://javascript.info/task/count-properties" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>count(obj)</code> that returns the number of properties in the object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: 'John',
  age: 30
};

alert( count(user) ); // 2</code></pre>
        </div>
      </div>
      
      </div><p>Try to make the code as short as possible.</p>
<p>P.S. Ignore symbolic properties, count only “regular” ones.</p>
<p>
<a href="http://plnkr.co/edit/1FEVH791nOxCZrF6pYLQ?p=preview" target="_blank" data-plunk-id="1FEVH791nOxCZrF6pYLQ">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/KmsTIL7INmcRlaCbrKrz?p=preview" target="_blank" data-plunk-id="KmsTIL7INmcRlaCbrKrz">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-352"></h6>
<h1 class="main__header-title" id="chapter-353">Destructuring assignment</h1>

<p>The two most used data structures in JavaScript are <code>Object</code> and <code>Array</code>.</p>
<p>Objects allow us to pack many pieces of information into a single entity and arrays allow us to store ordered collections. So we can make an object or an array and handle it as a single entity, or maybe pass it to a function call.</p>
<p><em>Destructuring assignment</em> is a special syntax that allows us to “unpack” arrays or objects into a bunch of variables, as sometimes they are more convenient. Destructuring also works great with complex functions that have a lot of parameters, default values, and soon we'll see how these are handled too.</p>


<h2 id="chapter-354">
Array destructuring</h2>
<p>An example of how the array is destructured into variables:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// we have an array with the name and surname
let arr = ["Ilya", "Kantor"]

// destructuring assignment
let [firstName, surname] = arr;

alert(firstName); // Ilya
alert(surname);  // Kantor</code></pre>
        </div>
      </div>
      
      </div><p>Now we can work with variables instead of array members.</p>
<p>It looks great when combined with <code>split</code> or other array-returning methods:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let [firstName, surname] = "Ilya Kantor".split(' ');</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">“Destructuring” does not mean “destructive”</span></div>
            <div class="important__content"><p>It's called “destructuring assignment”, because it “destructurizes” by copying items into variables. But the array itself is not modified.</p>
<p>It's just a shorter way to write:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// let [firstName, surname] = arr;
let firstName = arr[0];
let surname = arr[1];</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Ignore first elements</span></div>
            <div class="important__content"><p>Unwanted elements of the array can also be thrown away via an extra comma:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// first and second elements are not needed
let [, , title] = ["Julius", "Caesar", "Consul", "of the Roman Republic"];

alert( title ); // Consul</code></pre>
        </div>
      </div>
      
      </div><p>In the code above, although the first and second elements of the array are skipped, the third one is assigned to <code>title</code>, and the rest are also skipped.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Works with any iterable on the right-side</span></div>
            <div class="important__content"><p>…Actually, we can use it with any iterable, not only arrays:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let [a, b, c] = "abc"; // ["a", "b", "c"]
let [one, two, three] = new Set([1, 2, 3]);</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Assign to anything at the left-side</span></div>
            <div class="important__content"><p>We can use any “assignables” at the left side.</p>
<p>For instance, an object property:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {};
[user.name, user.surname] = "Ilya Kantor".split(' ');

alert(user.name); // Ilya</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Looping with .entries()</span></div>
            <div class="important__content"><p>In the previous chapter we saw the 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">Object.entries(obj)</a> method.</p>
<p>We can use it with destructuring to loop over keys-and-values of an object:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30
};

// loop over keys-and-values
for (let [key, value] of Object.entries(user)) {
  alert(`${key}:${value}`); // name:John, then age:30
}</code></pre>
        </div>
      </div>
      
      </div><p>…And the same for a map:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = new Map();
user.set("name", "John");
user.set("age", "30");

for (let [key, value] of user.entries()) {
  alert(`${key}:${value}`); // name:John, then age:30
}</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h3>
The rest ‘…'</a></h3><p>If we want not just to get first values, but also to gather all that follows – we can add one more parameter that gets “the rest” using three dots <code>"..."</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-7" data-highlight-inline="0:19-26,0:51-84">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let [name1, name2, ...rest] = ["Julius", "Caesar", "Consul", "of the Roman Republic"];

alert(name1); // Julius
alert(name2); // Caesar

alert(rest[0]); // Consul
alert(rest[1]); // of the Roman Republic
alert(rest.length); // 2</code></pre>
        </div>
      </div>
      
      </div><p>The value of <code>rest</code> is the array of the remaining array elements. We can use any other variable name in place of <code>rest</code>, just make sure it has three dots before it and goes last in the destructuring assignment.</p>
<h3>
Default values</a></h3><p>If there are fewer values in the array than variables in the assignment, there will be no error. Absent values are considered undefined:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let [firstName, surname] = [];

alert(firstName); // undefined</code></pre>
        </div>
      </div>
      
      </div><p>If we want a “default” value to replace the missing one, we can provide it using <code>=</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// default values
let [name = "Guest", surname = "Anonymous"] = ["Julius"];

alert(name);    // Julius (from array)
alert(surname); // Anonymous (default used)</code></pre>
        </div>
      </div>
      
      </div><p>Default values can be more complex expressions or even function calls. They are evaluated only if the value is not provided.</p>
<p>For instance, here we use the <code>prompt</code> function for two defaults. But it will run only for the missing one:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// runs only prompt for surname
let [name = prompt('name?'), surname = prompt('surname?')] = ["Julius"];

alert(name);    // Julius (from array)
alert(surname); // whatever prompt gets</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-355">
Object destructuring</h2>
<p>The destructuring assignment also works with objects.</p>
<p>The basic syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let {var1, var2} = {var1:…, var2…}</code></pre>
        </div>
      </div>
      
      </div><p>We have an existing object at the right side, that we want to split into variables. The left side contains a “pattern” for corresponding properties. In the simple case, that's a list of variable names in <code>{...}</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let options = {
  title: "Menu",
  width: 100,
  height: 200
};

let {title, width, height} = options;

alert(title);  // Menu
alert(width);  // 100
alert(height); // 200</code></pre>
        </div>
      </div>
      
      </div><p>Properties <code>options.title</code>, <code>options.width</code> and <code>options.height</code> are assigned to the corresponding variables. The order does not matter. This works too:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// changed the order of properties in let {...}
let {height, width, title} = { title: "Menu", height: 200, width: 100 }</code></pre>
        </div>
      </div>
      
      </div><p>The pattern on the left side may be more complex and specify the mapping between properties and variables.</p>
<p>If we want to assign a property to a variable with another name, for instance, <code>options.width</code> to go into the variable named <code>w</code>, then we can set it using a colon:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let options = {
  title: "Menu",
  width: 100,
  height: 200
};

// { sourceProperty: targetVariable }
let {width: w, height: h, title} = options;

// width -&gt; w
// height -&gt; h
// title -&gt; title

alert(title);  // Menu
alert(w);      // 100
alert(h);      // 200</code></pre>
        </div>
      </div>
      
      </div><p>The colon shows “what : goes where”. In the example above the property <code>width</code> goes to <code>w</code>, property <code>height</code> goes to <code>h</code>, and <code>title</code> is assigned to the same name.</p>
<p>For potentially missing properties we can set default values using <code>"="</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let options = {
  title: "Menu"
};

let {width = 100, height = 200, title} = options;

alert(title);  // Menu
alert(width);  // 100
alert(height); // 200</code></pre>
        </div>
      </div>
      
      </div><p>Just like with arrays or function parameters, default values can be any expressions or even function calls. They will be evaluated if the value is not provided.</p>
<p>The code below asks for width, but not the title.</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let options = {
  title: "Menu"
};

let {width = prompt("width?"), title = prompt("title?")} = options;

alert(title);  // Menu
alert(width);  // (whatever you the result of prompt is)</code></pre>
        </div>
      </div>
      
      </div><p>We also can combine both the colon and equality:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let options = {
  title: "Menu"
};

let {width: w = 100, height: h = 200, title} = options;

alert(title);  // Menu
alert(w);      // 100
alert(h);      // 200</code></pre>
        </div>
      </div>
      
      </div><h3>
The rest operator</a></h3><p>What if the object has more properties than we have variables? Can we take some and then assign the “rest” somewhere?</p>
<p>The specification for using the rest operator (three dots) here is almost in the standard, but most browsers do not support it yet.</p>
<p>It looks like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let options = {
  title: "Menu",
  height: 200,
  width: 100
};

let {title, ...rest} = options;

// now title="Menu", rest={height: 200, width: 100}
alert(rest.height);  // 200
alert(rest.width);   // 100</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Gotcha without <code>let</code></span></div>
            <div class="important__content"><p>In the examples above variables were declared right before the assignment: <code>let {…} = {…}</code>. Of course, we could use existing variables too. But there's a catch.</p>
<p>This won't work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let title, width, height;

// error in this line
{title, width, height} = {title: "Menu", width: 200, height: 100};</code></pre>
        </div>
      </div>
      
      </div><p>The problem is that JavaScript treats <code>{...}</code> in the main code flow (not inside another expression) as a code block. Such code blocks can be used to group statements, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">{
  // a code block
  let message = "Hello";
  // ...
  alert( message );
}</code></pre>
        </div>
      </div>
      
      </div><p>To show JavaScript that it's not a code block, we can wrap the whole assignment in brackets <code>(...)</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:0-1,3:66-67">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let title, width, height;

// okay now
({title, width, height} = {title: "Menu", width: 200, height: 100});

alert( title ); // Menu</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-356">
Nested destructuring</h2>
<p>If an object or an array contain other objects and arrays, we can use more complex left-side patterns to extract deeper portions.</p>
<p>In the code below <code>options</code> has another object in the property <code>size</code> and an array in the property <code>items</code>. The pattern at the left side of the assignment has the same structure:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let options = {
  size: {
    width: 100,
    height: 200
  },
  items: ["Cake", "Donut"],
  extra: true    // something extra that we will not destruct
};

// destructuring assignment on multiple lines for clarity
let {
  size: { // put size here
    width,
    height
  },
  items: [item1, item2], // assign items here
  title = "Menu" // not present in the object (default value is used)
} = options;

alert(title);  // Menu
alert(width);  // 100
alert(height); // 200
alert(item1);  // Cake
alert(item2);  // Donut</code></pre>
        </div>
      </div>
      
      </div><p>The whole <code>options</code> object except <code>extra</code> that was not mentioned, is assigned to corresponding variables.</p>
      <img src="http://javascript.info/article/destructuring-assignment/destructuring-complex.png">
<p>Finally, we have <code>width</code>, <code>height</code>, <code>item1</code>, <code>item2</code> and <code>title</code> from the default value.</p>
<p>That often happens with destructuring assignments. We have a complex object with many properties and want to extract only what we need.</p>
<p>Even here it happens:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// take size as a whole into a variable, ignore the rest
let { size } = options;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-357">
Smart function parameters</h2>
<p>There are times when a function may have many parameters, most of which are optional. That's especially true for user interfaces. Imagine a function that creates a menu. It may have a width, a height, a title, items list and so on.</p>
<p>Here's a bad way to write such function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showMenu(title = "Untitled", width = 200, height = 100, items = []) {
  // ...
}</code></pre>
        </div>
      </div>
      
      </div><p>In real-life the problem is how to remember the order of arguments. Usually IDEs try to help us, especially if the code is well-documented, but still… Another problem is how to call a function when most parameters are ok by default.</p>
<p>Like this?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">showMenu("My Menu", undefined, undefined, ["Item1", "Item2"])</code></pre>
        </div>
      </div>
      
      </div><p>That's ugly. And becomes unreadable when we deal with more parameters.</p>
<p>Destructuring comes to the rescue!</p>
<p>We can pass parameters as an object, and the function immediately destructurizes them into variables:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="7:18-77">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// we pass object to function
let options = {
  title: "My menu",
  items: ["Item1", "Item2"]
};

// ...and it immediately expands it to variables
function showMenu({title = "Untitled", width = 200, height = 100, items = []}) {
  // title, items – taken from options,
  // width, height – defaults used
  alert( `${title} ${width} ${height}` ); // My Menu 200 100
  alert( items ); // Item1, Item2
}

showMenu(options);</code></pre>
        </div>
      </div>
      
      </div><p>We can also use more complex destructuring with nested objects and colon mappings:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let options = {
  title: "My menu",
  items: ["Item1", "Item2"]
};

function showMenu({
  title = "Untitled",
  width: w = 100,  // width goes to w
  height: h = 200, // height goes to h
  items: [item1, item2] // items first element goes to item1, second to item2
}) {
  alert( `${title} ${w} ${h}` ); // My Menu 100 200
  alert( item1 ); // Item1
  alert( item2 ); // Item2
}

showMenu(options);</code></pre>
        </div>
      </div>
      
      </div><p>The syntax is the same as for a destructuring assignment:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function({
  incomingProperty: parameterName = defaultValue
  ...
})</code></pre>
        </div>
      </div>
      
      </div><p>Please note that such destructuring assumes that <code>showMenu()</code> does have an argument. If we want all values by default, then we should specify an empty object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">showMenu({});

// that would give an error
showMenu();</code></pre>
        </div>
      </div>
      
      </div><p>We can fix this by making <code>{}</code> the default value for the whole destructuring thing:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:18-68">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// simplified parameters a bit for clarity
function showMenu({ title = "Menu", width = 100, height = 200 } = {}) {
  alert( `${title} ${width} ${height}` );
}

showMenu(); // Menu 100 200</code></pre>
        </div>
      </div>
      
      </div><p>In the code above, the whole arguments object is <code>{}</code> by default, so there's always something to destructurize.</p>
<h2 id="chapter-358">
Summary</h2>
<ul>
<li>
<p>Destructuring assignment allows for instantly mapping an object or array onto many variables.</p>
</li>
<li>
<p>The object syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let {prop : varName = default, ...} = object</code></pre>
        </div>
      </div>
      
      </div><p>This means that property <code>prop</code> should go into the variable <code>varName</code> and, if no such property exists, then <code>default</code> value should be used.</p>
</li>
<li>
<p>The array syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let [item1 = default, item2, ...rest] = array</code></pre>
        </div>
      </div>
      
      </div><p>The first item goes to <code>item1</code>, the second goes into <code>item2</code>, all the rest makes the array <code>rest</code>.</p>
</li>
<li>
<p>For more complex cases, the left side must have the same structure as the right one.</p>
</li>
</ul>
<div class="tasks"><h2 id="chapter-359" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#destructuring-assignment" name="destructuring-assignment" class="main__anchor">Destructuring assignment</a></h3>
<a href="http://javascript.info/task/destructuring-assignment" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We have an object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  years: 30
};</code></pre>
        </div>
      </div>
      
      </div><p>Write the destructuring assignment that reads:</p>
<ul>
<li><code>name</code> property into the variable <code>name</code>.</li>
<li><code>years</code> property into the variable <code>age</code>.</li>
<li><code>isAdmin</code> property into the variable <code>isAdmin</code> (false if absent)</li>
</ul>
<p>The values after the assignment should be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { name: "John", years: 30 };

// your code to the left side:
// ... = user

alert( name ); // John
alert( age ); // 30
alert( isAdmin ); // false</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  years: 30
};

let {name, years: age, isAdmin = false} = user;

alert( name ); // John
alert( age ); // 30
alert( isAdmin ); // false</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#the-maximal-salary" name="the-maximal-salary" class="main__anchor">The maximal salary</a></h3>
<a href="http://javascript.info/task/max-salary" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There is a <code>salaries</code> object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let salaries = {
  "John": 100,
  "Pete": 300,
  "Mary": 250
};</code></pre>
        </div>
      </div>
      
      </div><p>Create the function <code>topSalary(salaries)</code> that returns the name of the top-paid person.</p>
<ul>
<li>If <code>salaries</code> is empty, it should return <code>null</code>.</li>
<li>If there are multiple top-paid persons, return any of them.</li>
</ul>
<p>P.S. Use <code>Object.entries</code> and destructuring to iterate over key/value pairs.</p>
<p>
<a href="http://plnkr.co/edit/aePioeOVl8dRbT28tE1d?p=preview" target="_blank" data-plunk-id="aePioeOVl8dRbT28tE1d">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/TqVaqM3Hk0VFSA1pEtUa?p=preview" target="_blank" data-plunk-id="TqVaqM3Hk0VFSA1pEtUa">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-360"></h6>
<h1 class="main__header-title" id="chapter-361">Date and time</h1>

<p>Let's meet a new built-in object: 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a>. It stores the date, time and provides methods for date/time management.</p>
<p>For instance, we can use it to store creation/modification times, or to measure time, or just to print out the current date.</p>


<h2 id="chapter-362">
Creation</h2>
<p>To create a new <code>Date</code> object call <code>new Date()</code> with one of the following arguments:</p>
<dl>
<dt><code>new Date()</code></dt>
<dd>
<p>Without arguments – create a <code>Date</code> object for the current date and time:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let now = new Date();
alert( now ); // shows current date/time</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>new Date(milliseconds)</code></dt>
<dd>
<p>Create a <code>Date</code> object with the time equal to number of milliseconds (1/1000 of a second) passed after the Jan 1st of 1970 UTC+0.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// 0 means 01.01.1970 UTC+0
let Jan01_1970 = new Date(0);
alert( Jan01_1970 );

// now add 24 hours, get 02.01.1970 UTC+0
let Jan02_1970 = new Date(24 * 3600 * 1000);
alert( Jan02_1970 );</code></pre>
        </div>
      </div>
      
      </div><p>The number of milliseconds that has passed since the beginning of 1970 is called a <em>timestamp</em>.</p>
<p>It's a lightweight numeric representation of a date. We can always create a date from a timestamp using <code>new Date(timestamp)</code> and convert the existing <code>Date</code> object to a timestamp using the <code>date.getTime()</code> method (see below).</p>
</dd>
<dt><code>new Date(datestring)</code></dt>
<dd>
<p>If there is a single argument, and it's a string, then it is parsed with the <code>Date.parse</code> algorithm (see below).</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date("2017-01-26");
alert(date); // Thu Jan 26 2017 ...</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>new Date(year, month, date, hours, minutes, seconds, ms)</code></dt>
<dd>
<p>Create the date with the given components in the local time zone. Only two first arguments are obligatory.</p>
<p>Note:</p>
<ul>
<li>The <code>year</code> must have 4 digits: <code>2013</code> is okay, <code>98</code> is not.</li>
<li>The <code>month</code> count starts with <code>0</code> (Jan), up to <code>11</code> (Dec).</li>
<li>The <code>date</code> parameter is actually the day of month, if absent then <code>1</code> is assumed.</li>
<li>If <code>hours/minutes/seconds/ms</code> is absent, they are assumed to be equal <code>0</code>.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Date(2011, 0, 1, 0, 0, 0, 0); // // 1 Jan 2011, 00:00:00
new Date(2011, 0, 1); // the same, hours etc are 0 by default</code></pre>
        </div>
      </div>
      
      </div><p>The minimal precision is 1 ms (1/1000 sec):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date(2011, 0, 1, 2, 3, 4, 567);
alert( date ); // 1.01.2011, 02:03:04.567</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<h2 id="chapter-363">
Access date components</h2>
<p>There are many methods to access the year, month and so on from the <code>Date</code> object. But they can be easily remembered when categorized.</p>
<dl>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getFullYear">getFullYear()</a></dt>
<dd>Get the year (4 digits)</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getMonth">getMonth()</a></dt>
<dd>Get the month, <strong>from 0 to 11</strong>.</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getDate">getDate()</a></dt>
<dd>Get the day of month, from 1 to 31, the name of the method does look a little bit strange.</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getHours">getHours()</a>, 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getMinutes">getMinutes()</a>, 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getSeconds">getSeconds()</a>, 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getMilliseconds">getMilliseconds()</a></dt>
<dd>Get the corresponding time components.</dd>
</dl>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Not <code>getYear()</code>, but <code>getFullYear()</code></span></div>
            <div class="important__content"><p>Many JavaScript engines implement a non-standard method <code>getYear()</code>. This method is deprecated. It returns 2-digit year sometimes. Please never use it. There is <code>getFullYear()</code> for the year.</p>
</div></div>
<p>Additionally, we can get a day of week:</p>
<dl>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getDay">getDay()</a></dt>
<dd>Get the day of week, from <code>0</code> (Sunday) to <code>6</code> (Saturday). The first day is always Sunday, in some countries that's not so, but can't be changed.</dd>
</dl>
<p><strong>All the methods above return the components relative to the local time zone.</strong></p>
<p>There are also their UTC-counterparts, that return day, month, year and so on for the time zone UTC+0: 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getUTCFullYear">getUTCFullYear()</a>, 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getUTCMonth">getUTCMonth()</a>, 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getUTCDay">getUTCDay()</a>. Just insert the <code>"UTC"</code> right after <code>"get"</code>.</p>
<p>If your local time zone is shifted relative to UTC, then the code below shows different hours:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// current date
let date = new Date();

// the hour in your current time zone
alert( date.getHours() );

// the hour in UTC+0 time zone (London time without daylight savings)
alert( date.getUTCHours() );</code></pre>
        </div>
      </div>
      
      </div><p>Besides the given methods, there are two special ones, that do not have a UTC-variant:</p>
<dl>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime">getTime()</a></dt>
<dd>
<p>Returns the timestamp for the date – a number of milliseconds passed from the January 1st of 1970 UTC+0.</p>
</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTimezoneOffset">getTimezoneOffset()</a></dt>
<dd>
<p>Returns the difference between the local time zone and UTC, in minutes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// if you are in timezone UTC-1, outputs 60
// if you are in timezone UTC+3, outputs -180
alert( new Date().getTimezoneOffset() );</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<h2 id="chapter-364">
Setting date components</h2>
<p>The following methods allow to set date/time components:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setFullYear"><code>setFullYear(year [, month, date])</code></a></li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setMonth"><code>setMonth(month [, date])</code></a></li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setDate"><code>setDate(date)</code></a></li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setHours"><code>setHours(hour [, min, sec, ms])</code></a></li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setMinutes"><code>setMinutes(min [, sec, ms])</code></a></li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setSeconds"><code>setSeconds(sec [, ms])</code></a></li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setMilliseconds"><code>setMilliseconds(ms)</code></a></li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setTime"><code>setTime(milliseconds)</code></a> (sets the whole date by milliseconds since 01.01.1970 UTC)</li>
</ul>
<p>Every one of them except <code>setTime()</code> has a UTC-variant, for instance: <code>setUTCHours()</code>.</p>
<p>As we can see, some methods can set multiple components at once, for example <code>setHours</code>. The components that are not mentioned are not modified.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let today = new Date();

today.setHours(0);
alert(today); // still today, but the hour is changed to 0

today.setHours(0, 0, 0, 0);
alert(today); // still today, now 00:00:00 sharp.</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-365">
Autocorrection</h2>
<p>The <em>autocorrection</em> is a very handy feature of <code>Date</code> objects. We can set out-of-range values, and it will auto-adjust itself.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:29-31">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date(2013, 0, 32); // 32 Jan 2013 ?!?
alert(date); // ...is 1st Feb 2013!</code></pre>
        </div>
      </div>
      
      </div><p>Out-of-range date components are distributed automatically.</p>
<p>Let's say we need to increase the date “28 Feb 2016” by 2 days. It may be “2 Mar” or “1 Mar” in case of a leap-year. We don't need to think about it. Just add 2 days. The <code>Date</code> object will do the rest:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date(2016, 1, 28);
date.setDate(date.getDate() + 2);

alert( date ); // 1 Mar 2016</code></pre>
        </div>
      </div>
      
      </div><p>That feature is often used to get the date after the given period of time. For instance, let's get the date for “70 seconds after now”:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date();
date.setSeconds(date.getSeconds() + 70);

alert( date ); // shows the correct date</code></pre>
        </div>
      </div>
      
      </div><p>We can also set zero or even negative values. For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date(2016, 0, 2); // 2 Jan 2016

date.setDate(1); // set day 1 of month
alert( date );

date.setDate(0); // min day is 1, so the last day of the previous month is assumed
alert( date ); // 31 Dec 2015</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-366">
Date to number, date diff</h2>
<p>When a <code>Date</code> object is converted to number, it becomes the timestamp same as <code>date.getTime()</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date();
alert(+date); // the number of milliseconds, same as date.getTime()</code></pre>
        </div>
      </div>
      
      </div><p>The important side effect: dates can be subtracted, the result is their difference in ms.</p>
<p>That can be used for time measurements:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let start = new Date(); // start counting

// do the job
for (let i = 0; i &lt; 100000; i++) {
  let doSomething = i * i * i;
}

let end = new Date(); // done

alert( `The loop took ${end - start} ms` );</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-367">
Date.now()</h2>
<p>If we only want to measure the difference, we don't need the <code>Date</code> object.</p>
<p>There's a special method <code>Date.now()</code> that returns the current timestamp.</p>
<p>It is semantically equivalent to <code>new Date().getTime()</code>, but it doesn't create an intermediate <code>Date</code> object. So it's faster and doesn't put pressure on garbage collection.</p>
<p>It is used mostly for convenience or when performance matters, like in games in JavaScript or other specialized applications.</p>
<p>So this is probably better:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0,7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let start = Date.now(); // milliseconds count from 1 Jan 1970

// do the job
for (let i = 0; i &lt; 100000; i++) {
  let doSomething = i * i * i;
}

let end = Date.now(); // done

alert( `The loop took ${end - start} ms` ); // subtract numbers, not dates</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-368">
Benchmarking</h2>
<p>If we want a reliable benchmark of CPU-hungry function, we should be careful.</p>
<p>For instance, let's measure two functions that calculate the difference between two dates: which one is faster?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// we have date1 and date2, which function faster returns their difference in ms?
function diffSubtract(date1, date2) {
  return date2 - date1;
}

// or
function diffGetTime(date1, date2) {
  return date2.getTime() - date1.getTime();
}</code></pre>
        </div>
      </div>
      
      </div><p>These two do exactly the same thing, but one of them uses an explicit <code>date.getTime()</code> to get the date in ms, and the other one relies on a date-to-number transform. Their result is always the same.</p>
<p>So, which one is faster?</p>
<p>The first idea may be to run them many times in a row and measure the time difference. For our case, functions are very simple, so we have to do it around 100000 times.</p>
<p>Let's measure:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function diffSubtract(date1, date2) {
  return date2 - date1;
}

function diffGetTime(date1, date2) {
  return date2.getTime() - date1.getTime();
}

function bench(f) {
  let date1 = new Date(0);
  let date2 = new Date();

  let start = Date.now();
  for (let i = 0; i &lt; 100000; i++) f(date1, date2);
  return Date.now() - start;
}

alert( 'Time of diffSubtract: ' + bench(diffSubtract) + 'ms' );
alert( 'Time of diffGetTime: ' + bench(diffGetTime) + 'ms' );</code></pre>
        </div>
      </div>
      
      </div><p>Wow! Using <code>getTime()</code> is so much faster! That's because there's no type conversion, it is much easier for engines to optimize.</p>
<p>Okay, we have something. But that's not a good benchmark yet.</p>
<p>Imagine that at the time of running <code>bench(diffSubtract)</code> CPU was doing something in parallel, and it was taking resources. And by the time of running <code>bench(diffGetTime)</code> the work has finished.</p>
<p>A pretty real scenario for a modern multi-process OS.</p>
<p>As a result, the first benchmark will have less CPU resources than the second. That may lead to wrong results.</p>
<p><strong>For more reliable benchmarking, the whole pack of benchmarks should be rerun multiple times.</strong></p>
<p>Here's the code example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="20-24">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function diffSubtract(date1, date2) {
  return date2 - date1;
}

function diffGetTime(date1, date2) {
  return date2.getTime() - date1.getTime();
}

function bench(f) {
  let date1 = new Date(0);
  let date2 = new Date();

  let start = Date.now();
  for (let i = 0; i &lt; 100000; i++) f(date1, date2);
  return Date.now() - start;
}

let time1 = 0;
let time2 = 0;

// run bench(upperSlice) and bench(upperLoop) each 10 times alternating
for (let i = 0; i &lt; 10; i++) {
  time1 += bench(diffSubtract);
  time2 += bench(diffGetTime);
}

alert( 'Total time for diffSubtract: ' + time1 );
alert( 'Total time for diffGetTime: ' + time2 );</code></pre>
        </div>
      </div>
      
      </div><p>Modern JavaScript engines start applying advanced optimizations only to “hot code” that executes many times (no need to optimize rarely executed things). So, in the example above, first executions are not well-optimized. We may want to add a heat-up run:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// added for "heating up" prior to the main loop
bench(diffSubtract);
bench(diffGetTime);

// now benchmark
for (let i = 0; i &lt; 10; i++) {
  time1 += bench(diffSubtract);
  time2 += bench(diffGetTime);
}</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Be careful doing microbenchmarking</span></div>
            <div class="important__content"><p>Modern JavaScript engines perform many optimizations. They may tweak results of “artificial tests” compared to “normal usage”, especially when we benchmark something very small. So if you seriously want to understand performance, then please study how the JavaScript engine works. And then you probably won't need microbenchmarks at all.</p>
<p>The great pack of articles about V8 can be found at 
<a href="http://mrale.ph">http://mrale.ph</a>.</p>
</div></div>
<h2 id="chapter-369">
Date.parse from a string</h2>
<p>The method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/parse">Date.parse(str)</a> can read a date from a string.</p>
<p>The string format should be: <code>YYYY-MM-DDTHH:mm:ss.sssZ</code>, where:</p>
<ul>
<li><code>YYYY-MM-DD</code> – is the date: year-month-day.</li>
<li>The character <code>"T"</code> is used as the delimiter.</li>
<li><code>HH:mm:ss.sss</code> – is the time: hours, minutes, seconds and milliseconds.</li>
<li>The optional <code>'Z'</code> part denotes the time zone in the format <code>+-hh:mm</code>. A single letter <code>Z</code> that would mean UTC+0.</li>
</ul>
<p>Shorter variants are also possible, like <code>YYYY-MM-DD</code> or <code>YYYY-MM</code> or even <code>YYYY</code>.</p>
<p>The call to <code>Date.parse(str)</code> parses the string in the given format and returns the timestamp (number of milliseconds from 1 Jan 1970 UTC+0). If the format is invalid, returns <code>NaN</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let ms = Date.parse('2012-01-26T13:51:50.417-07:00');

alert(ms); // 1327611110417  (timestamp)</code></pre>
        </div>
      </div>
      
      </div><p>We can instantly create a <code>new Date</code> object from the timestamp:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date( Date.parse('2012-01-26T13:51:50.417-07:00') );

alert(date);</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-370">
Summary</h2>
<ul>
<li>Date and time in JavaScript are represented with the 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a> object. We can't create “only date” or “only time”: <code>Date</code> objects always carry both.</li>
<li>Months are counted from zero (yes, January is a zero month).</li>
<li>Days of week in <code>getDay()</code> are also counted from zero (that's Sunday).</li>
<li><code>Date</code> auto-corrects itself when out-of-range components are set. Good for adding/subtracting days/months/hours.</li>
<li>Dates can be subtracted, giving their difference in milliseconds. That's because a <code>Date</code> becomes the timestamp when converted to a number.</li>
<li>Use <code>Date.now()</code> to get the current timestamp fast.</li>
</ul>
<p>Note that unlike many other systems, timestamps in JavaScript are in milliseconds, not in seconds.</p>
<p>Also, sometimes we need more precise time measurements. JavaScript itself does not have a way to measure time in microseconds (1 millionth of a second), but most environments provide it. For instance, browser has 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now">performance.now()</a> that gives the number of milliseconds from the start of page loading with microsecond precision (3 digits after the point):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(`Loading started ${performance.now()}ms ago`);
// Something like: "Loading started 34731.26000000001ms ago"
// .26 is microseconds (260 microseconds)
// more than 3 digits after the decimal point are precision errors, but only the first 3 are correct</code></pre>
        </div>
      </div>
      
      </div><p>Node.JS has <code>microtime</code> module and other ways. Technically, any device and environment allows to get more precision, it's just not in <code>Date</code>.</p>
<div class="tasks"><h2 id="chapter-371" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-a-date" name="create-a-date" class="main__anchor">Create a date</a></h3>
<a href="http://javascript.info/task/new-date" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a <code>Date</code> object for the date: Feb 20, 2012, 3:12am. The time zone is local.</p>
<p>Show it using <code>alert</code>.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The <code>new Date</code> constructor uses the local time zone by default. So the only important thing to remember is that months start from zero.</p>
<p>So February has number 1.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let d = new Date(2012, 1, 20, 3, 12);
alert( d );</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#show-a-weekday" name="show-a-weekday" class="main__anchor">Show a weekday</a></h3>
<a href="http://javascript.info/task/get-week-day" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>getWeekDay(date)</code> to show the weekday in short format: ‘MO', ‘TU', ‘WE', ‘TH', ‘FR', ‘SA', ‘SU'.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date(2012, 0, 3);  // 3 Jan 2012
alert( getWeekDay(date) );        // should output "TU"</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/SRHlW0yuwHfK7OUnaBZ3?p=preview" target="_blank" data-plunk-id="SRHlW0yuwHfK7OUnaBZ3">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The method <code>date.getDay()</code> returns the number of the weekday, starting from sunday.</p>
<p>Let's make an array of weekdays, so that we can get the proper day name by its number:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getWeekDay(date) {
  let days = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];

  return days[date.getDay()];
}

let date = new Date(2014, 0, 3); // 3 Jan 2014
alert( getWeekDay(date) ); // FR</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/y9vVaC2RDgfZbtByXd03?p=preview" target="_blank" data-plunk-id="y9vVaC2RDgfZbtByXd03">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#european-weekday" name="european-weekday" class="main__anchor">European weekday</a></h3>
<a href="http://javascript.info/task/weekday" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>European countries have days of week starting with monday (number 1), then tuesday (number 2) and till sunday (number 7). Write a function <code>getLocalDay(date)</code> that returns the “european” day of week for <code>date</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date(2012, 0, 3);  // 3 Jan 2012
alert( getLocalDay(date) );       // tuesday, should show 2</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/hJFIBCvZMUBncBwLU1Y2?p=preview" target="_blank" data-plunk-id="hJFIBCvZMUBncBwLU1Y2">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getLocalDay(date) {

  let day = date.getDay();

  if (day == 0) { // 0 becomes 7
    day = 7;
  }

  return day;
}

alert( getLocalDay(new Date(2012, 0, 3)) ); // 2</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/rQzokFiAwOXAIxtxYSCG?p=preview" target="_blank" data-plunk-id="rQzokFiAwOXAIxtxYSCG">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#which-day-of-month-was-many-days-ago" name="which-day-of-month-was-many-days-ago" class="main__anchor">Which day of month was many days ago?</a></h3>
<a href="http://javascript.info/task/get-date-ago" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Create a function <code>getDateAgo(date, days)</code> to return the day of month <code>days</code> ago from the <code>date</code>.</p>
<p>For instance, if today is 20th, then <code>getDateAgo(new Date(), 1)</code> should be 19th and <code>getDateAgo(new Date(), 2)</code> should be 18th.</p>
<p>Should also work over months/years reliably:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let date = new Date(2015, 0, 2);

alert( getDateAgo(date, 1) ); // 1, (1 Jan 2015)
alert( getDateAgo(date, 2) ); // 31, (31 Dec 2014)
alert( getDateAgo(date, 365) ); // 2, (2 Jan 2014)</code></pre>
        </div>
      </div>
      
      </div><p>P.S. The function should not modify the given <code>date</code>.</p>
<p>
<a href="http://plnkr.co/edit/1UsWlTJtd6exGZRAmAPf?p=preview" target="_blank" data-plunk-id="1UsWlTJtd6exGZRAmAPf">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The idea is simple: to substract given number of days from <code>date</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getDateAgo(date, days) {
  date.setDate(date.getDate() - days);
  return date.getDate();
}</code></pre>
        </div>
      </div>
      
      </div><p>…But the function should not change <code>date</code>. That's an important thing, because the outer code which gives us the date does not expect it to change.</p>
<p>To implement it let's clone the date, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getDateAgo(date, days) {
  let dateCopy = new Date(date);

  dateCopy.setDate(date.getDate() - days);
  return dateCopy.getDate();
}

let date = new Date(2015, 0, 2);

alert( getDateAgo(date, 1) ); // 1, (1 Jan 2015)
alert( getDateAgo(date, 2) ); // 31, (31 Dec 2014)
alert( getDateAgo(date, 365) ); // 2, (2 Jan 2014)</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/FJCM2tlMY0l68zZ4zroJ?p=preview" target="_blank" data-plunk-id="FJCM2tlMY0l68zZ4zroJ">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#last-day-of-month" name="last-day-of-month" class="main__anchor">Last day of month?</a></h3>
<a href="http://javascript.info/task/last-day-of-month" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>getLastDayOfMonth(year, month)</code> that returns the last day of month. Sometimes it is 30th, 31st or even 28/29th for Feb.</p>
<p>Parameters:</p>
<ul>
<li><code>year</code> – four-digits year, for instance 2012.</li>
<li><code>month</code> – month, from 0 to 11.</li>
</ul>
<p>For instance, <code>getLastDayOfMonth(2012, 1) = 29</code> (leap year, Feb).</p>
<p>
<a href="http://plnkr.co/edit/9Uxmi7diINm08sJd8UlA?p=preview" target="_blank" data-plunk-id="9Uxmi7diINm08sJd8UlA">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Let's create a date using the next month, but pass zero as the day:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getLastDayOfMonth(year, month) {
  let date = new Date(year, month + 1, 0);
  return date.getDate();
}

alert( getLastDayOfMonth(2012, 0) ); // 31
alert( getLastDayOfMonth(2012, 1) ); // 29
alert( getLastDayOfMonth(2013, 1) ); // 28</code></pre>
        </div>
      </div>
      
      </div><p>Normally, dates start from 1, but technically we can pass any number, the date will autoadjust itself. So when we pass 0, then it means “one day before 1st day of the month”, in other words: “the last day of the previous month”.</p>
<p>
<a href="http://plnkr.co/edit/cwFfgJPeCnO4HSWpqVEr?p=preview" target="_blank" data-plunk-id="cwFfgJPeCnO4HSWpqVEr">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#how-many-seconds-has-passed-today" name="how-many-seconds-has-passed-today" class="main__anchor">How many seconds has passed today?</a></h3>
<a href="http://javascript.info/task/get-seconds-today" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>getSecondsToday()</code> that returns the number of seconds from the beginning of today.</p>
<p>For instance, if now <code>10:00 am</code>, and there was no daylight savings shift, then:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">getSecondsToday() == 36000 // (3600 * 10)</code></pre>
        </div>
      </div>
      
      </div><p>The function should work in any day. That is, it should not have a hard-coded value of “today”.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To get the number of seconds, we can generate a date using the current day and time 00:00:00, then substract it from “now”.</p>
<p>The difference is the number of milliseconds from the beginning of the day, that we should divide by 1000 to get seconds:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getSecondsToday() {
  let now = new Date();

  // create an object using the current day/month/year
  let today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

  let diff = now - today; // ms difference
  return Math.round(diff / 1000); // make seconds
}

alert( getSecondsToday() );</code></pre>
        </div>
      </div>
      
      </div><p>An alternative solution would be to get hours/minutes/seconds and convert them to seconds:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getSecondsToday() {
  let d = new Date();
  return d.getHours() * 3600 + d.getMinutes() * 60 + d.getSeconds();
};</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#how-many-seconds-till-tomorrow" name="how-many-seconds-till-tomorrow" class="main__anchor">How many seconds till tomorrow?</a></h3>
<a href="http://javascript.info/task/get-seconds-to-tomorrow" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a function <code>getSecondsToTomorrow()</code> that returns the number of seconds till tomorrow.</p>
<p>For instance, if now is <code>23:00</code>, then:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">getSecondsToTomorrow() == 3600</code></pre>
        </div>
      </div>
      
      </div><p>P.S. The function should work at any day, the “today” is not hardcoded.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To get the number of milliseconds till tomorrow, we can from “tomorrow 00:00:00” substract the current date.</p>
<p>First, we generate that “tomorrow”, and then do it:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="4:61-76">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getSecondsToTomorrow() {
  let now = new Date();

  // tomorrow date
  let tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1);

  let diff = tomorrow - now; // difference in ms
  return Math.round(diff / 1000); // convert to seconds
}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#format-the-relative-date" name="format-the-relative-date" class="main__anchor">Format the relative date</a></h3>
<a href="http://javascript.info/task/format-date-relative" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write a function <code>formatDate(date)</code> that should format <code>date</code> as follows:</p>
<ul>
<li>If since <code>date</code> passed less than 1 second, then <code>"right now"</code>.</li>
<li>Otherwise, if since <code>date</code> passed less than 1 minute, then <code>"n sec. ago"</code>.</li>
<li>Otherwise, if less than an hour, then <code>"m min. ago"</code>.</li>
<li>Otherwise, the full date in the format <code>"DD.MM.YY HH:mm"</code>. That is: <code>"day.month.year hours:minutes"</code>, all in 2-digit format, e.g. <code>31.12.16 10:00</code>.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( formatDate(new Date(new Date - 1)) ); // "right now"

alert( formatDate(new Date(new Date - 30 * 1000)) ); // "30 sec. ago"

alert( formatDate(new Date(new Date - 5 * 60 * 1000)) ); // "5 min. ago"

// yesterday's date like 31.12.2016, 20:00
alert( formatDate(new Date(new Date - 86400 * 1000)) );</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/EVi38ofsvqRzIyri0duv?p=preview" target="_blank" data-plunk-id="EVi38ofsvqRzIyri0duv">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To get the time from <code>date</code> till now – let's substract the dates.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function formatDate(date) {
  let diff = new Date() - date; // the difference in milliseconds

  if (diff &lt; 1000) { // less than 1 second
    return 'right now';
  }

  let sec = Math.floor(diff / 1000); // convert diff to seconds

  if (sec &lt; 60) {
    return sec + ' sec. ago';
  }

  let min = Math.floor(diff / 60000); // convert diff to minutes
  if (min &lt; 60) {
    return min + ' min. ago';
  }

  // format the date
  // add leading zeroes to single-digit day/month/hours/minutes
  let d = date;
  d = [
    '0' + d.getDate(),
    '0' + (d.getMonth() + 1),
    '' + d.getFullYear(),
    '0' + d.getHours(),
    '0' + d.getMinutes()
  ].map(component =&gt; component.slice(-2)); // take last 2 digits of every component

  // join the components into date
  return d.slice(0, 3).join('.') + ' ' + d.slice(3).join(':');
}

alert( formatDate(new Date(new Date - 1)) ); // "right now"

alert( formatDate(new Date(new Date - 30 * 1000)) ); // "30 sec. ago"

alert( formatDate(new Date(new Date - 5 * 60 * 1000)) ); // "5 min. ago"

// yesterday's date like 31.12.2016, 20:00
alert( formatDate(new Date(new Date - 86400 * 1000)) );</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/6VSJDxqff7UB0cEwjoDs?p=preview" target="_blank" data-plunk-id="6VSJDxqff7UB0cEwjoDs">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-372"></h6>
<h1 class="main__header-title" id="chapter-373">JSON methods, toJSON</h1>
<p>Let's say we have a complex object, and we'd like to convert it into a string, to send it over a network, or just to output it for logging purposes.</p>
<p>Naturally, such a string should include all important properties.</p>
<p>We could implement the conversion like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 30,

  toString() {
    return `{name: "${this.name}", age: ${this.age}}`;
  }
};

alert(user); // {name: "John", age: 30}</code></pre>
        </div>
      </div>
      
      </div><p>…But in the process of development, new properties are added, old properties are renamed and removed. Updating such <code>toString</code> every time can become a pain. We could try to loop over properties in it, but what if the object is complex and has nested objects in properties? We'd need to implement their conversion as well. And, if we're sending the object over a network, then we also need to supply the code to “read” our object on the receiving side.</p>
<p>Luckily, there's no need to write the code to handle all this. The task has been solved already.</p>


<h2 id="chapter-374">
JSON.stringify</h2>
<p>The 
<a href="http://en.wikipedia.org/wiki/JSON">JSON</a> (JavaScript Object Notation) is a general format to represent values and objects. It is described as in 
<a href="http://tools.ietf.org/html/rfc4627">RFC 4627</a> standard. Initially it was made for JavaScript, but many other languages have libraries to handle it as well.  So it's easy to use JSON for data exchange when the client uses JavaScript and the server is written on Ruby/PHP/Java/Whatever.</p>
<p>JavaScript provides methods:</p>
<ul>
<li><code>JSON.stringify</code> to convert objects into JSON.</li>
<li><code>JSON.parse</code> to convert JSON back into an object.</li>
</ul>
<p>For instance, here we <code>JSON.stringify</code> a student:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-8,13-21">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let student = {
  name: 'John',
  age: 30,
  isAdmin: false,
  courses: ['html', 'css', 'js'],
  wife: null
};

let json = JSON.stringify(student);

alert(typeof json); // we've got a string!

alert(json);
/* JSON-encoded object:
{
  "name": "John",
  "age": 30,
  "isAdmin": false,
  "courses": ["html", "css", "js"],
  "wife": null
}
*/</code></pre>
        </div>
      </div>
      
      </div><p>The method <code>JSON.stringify(student)</code> takes the object and converts it into a string.</p>
<p>The resulting <code>json</code> string is a called <em>JSON-encoded</em> or <em>serialized</em> or <em>stringified</em> or <em>marshalled</em> object. We are ready to send it over the wire or put into plain data store.</p>
<p>Please note that JSON-encoded object has several important differences from the object literal:</p>
<ul>
<li>Strings use double quotes. No single quotes or backticks in JSON. So <code>'John'</code> becomes <code>"John"</code>.</li>
<li>Object property names are double-quoted also. That's obligatory. So <code>age:30</code> becomes <code>"age":30</code>.</li>
</ul>
<p><code>JSON.stringify</code> can be applied to primitives as well.</p>
<p>Natively supported JSON types are:</p>
<ul>
<li>Objects <code>{ ... }</code></li>
<li>Arrays <code>[ ... ]</code></li>
<li>Primitives:
<ul>
<li>strings,</li>
<li>numbers,</li>
<li>boolean values <code>true/false</code>,</li>
<li><code>null</code>.</li>
</ul>
</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// a number in JSON is just a number
alert( JSON.stringify(1) ) // 1

// a string in JSON is still a string, but double-quoted
alert( JSON.stringify('test') ) // "test"

alert( JSON.stringify(true) ); // true

alert( JSON.stringify([1, 2, 3]) ); // [1,2,3]</code></pre>
        </div>
      </div>
      
      </div><p>JSON is data-only cross-language specification, so some JavaScript-specific object properties are skipped by <code>JSON.stringify</code>.</p>
<p>Namely:</p>
<ul>
<li>Function properties (methods).</li>
<li>Symbolic properties.</li>
<li>Properties that store <code>undefined</code>.</li>
</ul>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  sayHi() { // ignored
    alert("Hello");
  },
  [Symbol("id")]: 123, // ignored
  something: undefined // ignored
};

alert( JSON.stringify(user) ); // {} (empty object)</code></pre>
        </div>
      </div>
      
      </div><p>Usually that's fine. If that's not what we want, then soon we'll see how to customize the process.</p>
<p>The great thing is that nested objects are supported and converted automatically.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let meetup = {
  title: "Conference",
  room: {
    number: 123,
    participants: ["john", "ann"]
  }
};

alert( JSON.stringify(meetup) );
/* The whole structure is stringified:
{
  "title":"Conference",
  "room":{"number":23,"participants":["john","ann"]},
}
*/</code></pre>
        </div>
      </div>
      
      </div><p>The important limitation: there must be no circular references.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="12-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: ["john", "ann"]
};

meetup.place = room;       // meetup references room
room.occupiedBy = meetup; // room references meetup

JSON.stringify(meetup); // Error: Converting circular structure to JSON</code></pre>
        </div>
      </div>
      
      </div><p>Here, the conversion fails, because of circular reference: <code>room.occupiedBy</code> references <code>meetup</code>, and <code>meetup.place</code> references <code>room</code>:</p>
      <img src="http://javascript.info/article/json/json-meetup.png">
<h2 id="chapter-375">
Excluding and transforming: replacer</h2>
<p>The full syntax of <code>JSON.stringify</code> is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = JSON.stringify(value[, replacer, space])</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt>value</dt>
<dd>A value to encode.</dd>
<dt>replacer</dt>
<dd>Array of properties to encode or a mapping function <code>function(key, value)</code>.</dd>
<dt>space</dt>
<dd>Amount of space to use for formatting</dd>
</dl>
<p>Most of time, <code>JSON.stringify</code> is used with first argument only. But if we need to fine-tune the replacement process, like to filter out circular references, we can use the second argument of <code>JSON.stringify</code>.</p>
<p>If we pass an array of properties to it, only these properties will be encoded.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="12:30-55">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: [{name: "John"}, {name: "Alice"}],
  place: room // meetup references room
};

room.occupiedBy = meetup; // room references meetup

alert( JSON.stringify(meetup, ['title', 'participants']) );
// {"title":"Conference","participants":[{},{}]}</code></pre>
        </div>
      </div>
      
      </div><p>Here we are probably too strict. The property list is applied to the whole object structure. So participants are empty, because <code>name</code> is not in the list.</p>
<p>Let's include every property except <code>room.occupiedBy</code> that would cause the circular reference:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="12:30-82">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: [{name: "John"}, {name: "Alice"}],
  place: room // meetup references room
};

room.occupiedBy = meetup; // room references meetup

alert( JSON.stringify(meetup, ['title', 'participants', 'place', 'name', 'number']) );
/*
{
  "title":"Conference",
  "participants":[{"name":"John"},{"name":"Alice"}],
  "place":{"number":23}
}
*/</code></pre>
        </div>
      </div>
      
      </div><p>Now everything except <code>occupiedBy</code> is serialized. But the list of properties is quite long.</p>
<p>Fortunately, we can use a function instead of an array as the <code>replacer</code>.</p>
<p>The function will be called for every <code>(key,value)</code> pair and should return the “replaced” value, which will be used instead of the original one.</p>
<p>In our case, we can return <code>value</code> “as is” for everything except <code>occupiedBy</code>. To ignore <code>occupiedBy</code>, the code below returns <code>undefined</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: [{name: "John"}, {name: "Alice"}],
  place: room // meetup references room
};

room.occupiedBy = meetup; // room references meetup

alert( JSON.stringify(meetup, function replacer(key, value) {
  alert(`${key}: ${value}`); // to see what replacer gets
  return (key == 'occupiedBy') ? undefined : value;
}));

/* key:value pairs that come to replacer:
:             [object Object]
title:        Conference
participants: [object Object],[object Object]
0:            [object Object]
name:         John
1:            [object Object]
name:         Alice
place:        [object Object]
number:       23
*/</code></pre>
        </div>
      </div>
      
      </div><p>Please note that <code>replacer</code> function gets every key/value pair including nested objects and array items. It is applied recursively. The value of <code>this</code> inside <code>replacer</code> is the object that contains the current property.</p>
<p>The first call is special. It is made using a special “wrapper object”: <code>{"": meetup}</code>. In other words, the first <code>(key,value)</code> pair has an empty key, and the value is the target object as a whole. That's why the first line is <code>":[object Object]"</code> in the example above.</p>
<p>The idea is to provide as much power for <code>replacer</code> as possible: it has a chance to analyze and replace/skip the whole object if necessary.</p>
<h2 id="chapter-376">
Formatting: spacer</h2>
<p>The third argument of <code>JSON.stringify(value, replacer, spaces)</code> is the number of spaces to use for pretty formatting.</p>
<p>Previously, all stringified objects had no indents and extra spaces. That's fine if we want to send an object over a network. The <code>spacer</code> argument is used exclusively for a nice output.</p>
<p>Here <code>spacer = 2</code> tells JavaScript to show nested objects on multiple lines, with indentation of 2 spaces inside an object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  age: 25,
  roles: {
    isAdmin: false,
    isEditor: true
  }
};

alert(JSON.stringify(user, null, 2));
/* two-space indents:
{
  "name": "John",
  "age": 25,
  "roles": {
    "isAdmin": false,
    "isEditor": true
  }
}
*/

/* for JSON.stringify(user, null, 4) the result would be more indented:
{
    "name": "John",
    "age": 25,
    "roles": {
        "isAdmin": false,
        "isEditor": true
    }
}
*/</code></pre>
        </div>
      </div>
      
      </div><p>The <code>spaces</code> parameter is used solely for logging and nice-output purposes.</p>
<h2 id="chapter-377">
Custom “toJSON”</h2>
<p>Like <code>toString</code> for a string conversion, an object may provide method <code>toJSON</code> for to-JSON conversion. <code>JSON.stringify</code> automatically calls it if available.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="14-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  date: new Date(Date.UTC(2017, 0, 1)),
  room
};

alert( JSON.stringify(meetup) );
/*
  {
    "title":"Conference",
    "date":"2017-01-01T00:00:00.000Z",  // (1)
    "room": {"number":23}               // (2)
  }
*/</code></pre>
        </div>
      </div>
      
      </div><p>Here we can see that <code>date</code> <code>(1)</code> became a string. That's because all dates have a built-in <code>toJSON</code> method which returns such kind of string.</p>
<p>Now let's add a custom <code>toJSON</code> for our object <code>room</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-4,12-12,18-18">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let room = {
  number: 23,
  toJSON() {
    return this.number;
  }
};

let meetup = {
  title: "Conference",
  room
};

alert( JSON.stringify(room) ); // 23

alert( JSON.stringify(meetup) );
/*
  {
    "title":"Conference",
    "room": 23
  }
*/</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, <code>toJSON</code> is used both for the direct call <code>JSON.stringify(room)</code> and for the nested object.</p>
<h2 id="chapter-378">
JSON.parse</h2>
<p>To decode a JSON-string, we need another method named 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse</a>.</p>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let value = JSON.parse(str[, reviver]);</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt>str</dt>
<dd>JSON-string to parse.</dd>
<dt>reviver</dt>
<dd>Optional function(key,value) that will be called for each <code>(key,value)</code> pair and can transform the value.</dd>
</dl>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// stringified array
let numbers = "[0, 1, 2, 3]";

numbers = JSON.parse(numbers);

alert( numbers[1] ); // 1</code></pre>
        </div>
      </div>
      
      </div><p>Or for nested objects:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = '{ "name": "John", "age": 35, "isAdmin": false, "friends": [0,1,2,3] }';

user = JSON.parse(user);

alert( user.friends[1] ); // 1</code></pre>
        </div>
      </div>
      
      </div><p>The JSON may be as complex as necessary, objects and arrays can include other objects and arrays. But they must obey the format.</p>
<p>Here are typical mistakes in hand-written JSON (sometimes we have to write it for debugging purposes):</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:2-6,2:13-20,3:2-11,4:14-34">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = `{
  name: "John",                     // mistake: property name without quotes
  "surname": 'Smith',               // mistake: single quotes in value (must be double)
  'isAdmin': false                  // mistake: single quotes in key (must be double)
  "birthday": new Date(2000, 2, 3), // mistake: no "new" is allowed, only bare values
  "friends": [0,1,2,3]              // here all fine
}`;</code></pre>
        </div>
      </div>
      
      </div><p>Besides, JSON does not support comments. Adding a comment to JSON makes it invalid.</p>
<p>There's another format named 
<a href="http://json5.org/">JSON5</a>, which allows unquoted keys, comments etc. But this is a standalone library, not in the specification of the language.</p>
<p>The regular JSON is that strict not because its developers are lazy, but to allow easy, reliable and very fast implementations of the parsing algorithm.</p>
<h2 id="chapter-379">
Using reviver</h2>
<p>Imagine, we got a stringified <code>meetup</code> object from the server.</p>
<p>It looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// title: (meetup title), date: (meetup date)
let str = '{"title":"Conference","date":"2017-11-30T12:00:00.000Z"}';</code></pre>
        </div>
      </div>
      
      </div><p>…And now we need to <em>deserialize</em> it, to turn back into JavaScript object.</p>
<p>Let's do it by calling <code>JSON.parse</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '{"title":"Conference","date":"2017-11-30T12:00:00.000Z"}';

let meetup = JSON.parse(str);

alert( meetup.date.getDate() ); // Error!</code></pre>
        </div>
      </div>
      
      </div><p>Whoops! An error!</p>
<p>The value of <code>meetup.date</code> is a string, not a <code>Date</code> object. How could <code>JSON.parse</code> know that it should transform that string into a <code>Date</code>?</p>
<p>Let's pass to <code>JSON.parse</code> the reviving function that returns all values “as is”, but <code>date</code> will become a <code>Date</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '{"title":"Conference","date":"2017-11-30T12:00:00.000Z"}';

let meetup = JSON.parse(str, function(key, value) {
  if (key == 'date') return new Date(value);
  return value;
});

alert( meetup.date.getDate() ); // now works!</code></pre>
        </div>
      </div>
      
      </div><p>By the way, that works for nested objects as well:</p>
<div data-trusted="1" class="code-example" data-highlight-block="12-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let schedule = `{
  "meetups": [
    {"title":"Conference","date":"2017-11-30T12:00:00.000Z"},
    {"title":"Birthday","date":"2017-04-18T12:00:00.000Z"}
  ]
}`;

schedule = JSON.parse(schedule, function(key, value) {
  if (key == 'date') return new Date(value);
  return value;
});

alert( schedule.meetups[1].date.getDate() ); // works!</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-380">
Summary</h2>
<ul>
<li>JSON is a data format that has its own independent standard and libraries for most programming languages.</li>
<li>JSON supports plain objects, arrays, strings, numbers, booleans and <code>null</code>.</li>
<li>JavaScript provides methods 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">JSON.stringify</a> to serialize into JSON and 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse</a> to read from JSON.</li>
<li>Both methods support transformer functions for smart reading/writing.</li>
<li>If an object has <code>toJSON</code>, then it is called by <code>JSON.stringify</code>.</li>
</ul>
<div class="tasks"><h2 id="chapter-381" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#turn-the-object-into-json-and-back" name="turn-the-object-into-json-and-back" class="main__anchor">Turn the object into JSON and back</a></h3>
<a href="http://javascript.info/task/serialize-object" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Turn the <code>user</code> into JSON and then read it back into another variable.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John Smith",
  age: 35
};</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John Smith",
  age: 35
};

let user2 = JSON.parse(JSON.stringify(user));</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#exclude-backreferences" name="exclude-backreferences" class="main__anchor">Exclude backreferences</a></h3>
<a href="http://javascript.info/task/serialize-event-circular" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>In simple cases of circular references, we can exclude an offending property from serialization by its name.</p>
<p>But sometimes there are many backreferences. And names may be used both in circular references and normal properties.</p>
<p>Write <code>replacer</code> function to stringify everything, but remove properties that reference <code>meetup</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  occupiedBy: [{name: "John"}, {name: "Alice"}],
  place: room
};

// circular references
room.occupiedBy = meetup;
meetup.self = meetup;

alert( JSON.stringify(meetup, function replacer(key, value) {
  /* your code */
}));

/* result should be:
{
  "title":"Conference",
  "occupiedBy":[{"name":"John"},{"name":"Alice"}],
  "place":{"number":23}
}
*/</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  occupiedBy: [{name: "John"}, {name: "Alice"}],
  place: room
};

room.occupiedBy = meetup;
meetup.self = meetup;

alert( JSON.stringify(meetup, function replacer(key, value) {
  return (key != "" &amp;&amp; value == meetup) ? undefined : value;
}));

/*
{
  "title":"Conference",
  "occupiedBy":[{"name":"John"},{"name":"Alice"}],
  "place":{"number":23}
}
*/</code></pre>
        </div>
      </div>
      
      </div><p>Here we also need to test <code>key==""</code> to exclude the first call where it is normal that <code>value</code> is <code>meetup</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-382"></h6>
<h1 class="main__header-title" id="chapter-383">Advanced working with functions</h1>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/recursion" class="lessons-list__link">Recursion and stack</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/rest-parameters-spread-operator" class="lessons-list__link">Rest parameters and spread operator</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/closure" class="lessons-list__link">Closure</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/var" class="lessons-list__link">The old "var"</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/global-object" class="lessons-list__link">Global object</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/function-object" class="lessons-list__link">Function object, NFE</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/new-function" class="lessons-list__link">The "new Function" syntax</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/settimeout-setinterval" class="lessons-list__link">Scheduling: setTimeout and setInterval</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/call-apply-decorators" class="lessons-list__link">Decorators and forwarding, call/apply</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/bind" class="lessons-list__link">Function binding</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/currying-partials" class="lessons-list__link">Currying and partials</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/arrow-functions" class="lessons-list__link">Arrow functions revisited</a></li></ol></div>


<h6 id="chapter-384"></h6>
<h1 class="main__header-title" id="chapter-385">Recursion and stack</h1>
<p>Let's return to functions and study them more in-depth.</p>
<p>Our first topic will be <em>recursion</em>.</p>
<p>If you are not new to programming, then it is probably familiar and you could skip this chapter.</p>
<p>Recursion is a programming pattern that is useful in situations when a task can be naturally split into several tasks of the same kind, but simpler. Or when a task can be simplified into an easy action plus a simpler variant of the same task. Or, as we'll see soon, to deal with certain data structures.</p>
<p>When a function solves a task, in the process it can call many other functions. A partial case of this is when a function calls <em>itself</em>. That's called <em>recursion</em>.</p>


<h2 id="chapter-386">
Two ways of thinking</h2>
<p>For something simple to start with – let's write a function <code>pow(x, n)</code> that raises <code>x</code> to a natural power of <code>n</code>. In other words, multiplies <code>x</code> by itself <code>n</code> times.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">pow(2, 2) = 4
pow(2, 3) = 8
pow(2, 4) = 16</code></pre>
        </div>
      </div>
      
      </div><p>There are two ways to implement it.</p>
<ol>
<li>
<p>Iterative thinking: the <code>for</code> loop:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  let result = 1;

  // multiply result by x n times in the loop
  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }

  return result;
}

alert( pow(2, 3) ); // 8</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Recursive thinking: simplify the task and call self:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  if (n == 1) {
    return x;
  } else {
    return x * pow(x, n - 1);
  }
}

alert( pow(2, 3) ); // 8</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>Please note how the recursive variant is fundamentally different.</p>
<p>When <code>pow(x, n)</code> is called, the execution splits into two branches:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">              if n==1  = x
             /
pow(x, n) =
             \
              else     = x * pow(x, n - 1)</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>If <code>n == 1</code>, then everything is trivial. It is called <em>the base</em> of recursion, because it immediately produces the obvious result: <code>pow(x, 1)</code> equals <code>x</code>.</li>
<li>Otherwise, we can represent <code>pow(x, n)</code> as <code>x * pow(x, n - 1)</code>. In maths, one would write <code>x<sup>n</sup> = x * x<sup>n-1</sup></code>. This is called <em>a recursive step</em>: we transform the task into a simpler action (multiplication by <code>x</code>) and a simpler call of the same task (<code>pow</code> with lower <code>n</code>). Next steps simplify it further and further until <code>n</code> reaches <code>1</code>.</li>
</ol>
<p>We can also say that <code>pow</code> <em>recursively calls itself</em> till <code>n == 1</code>.</p>
      <img src="http://javascript.info/article/recursion/recursion-pow.png">
<p>For example, to calculate <code>pow(2, 4)</code> the recursive variant does these steps:</p>
<ol>
<li><code>pow(2, 4) = 2 * pow(2, 3)</code></li>
<li><code>pow(2, 3) = 2 * pow(2, 2)</code></li>
<li><code>pow(2, 2) = 2 * pow(2, 1)</code></li>
<li><code>pow(2, 1) = 2</code></li>
</ol>
<p>So, the recursion reduces a function call to a simpler one, and then – to even more simpler, and so on, until the result becomes obvious.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Recursion is usually shorter</span></div>
            <div class="important__content"><p>A recursive solution is usually shorter than an iterative one.</p>
<p>Here we can rewrite the same using the ternary <code>?</code> operator instead of <code>if</code> to make <code>pow(x, n)</code> more terse and still very readable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  return (n == 1) ? x : (x * pow(x, n - 1));
}</code></pre>
        </div>
      </div>
      
      </div></div></div>
<p>The maximal number of nested calls (including the first one) is called <em>recursion depth</em>. In our case, it will be exactly <code>n</code>.</p>
<p>The maximal recursion depth is limited by JavaScript engine. We can make sure about 10000, some engines allow more, but 100000 is probably out of limit for the majority of them. There are automatic optimizations that help alleviate this (“tail calls optimizations”), but they are not yet supported everywhere and work only in simple cases.</p>
<p>That limits the application of recursion, but it still remains very wide. There are many tasks where recursive way of thinking gives simpler code, easier to maintain.</p>
<h2 id="chapter-387">
The execution stack</h2>
<p>Now let's examine how recursive calls work. For that we'll look under the hood of functions.</p>
<p>The information about a function run is stored in its <em>execution context</em>.</p>
<p>The 
<a href="https://tc39.github.io/ecma262/#sec-execution-contexts">execution context</a> is an internal data structure that contains details about the execution of a function: where the control flow is now, the current variables, the value of <code>this</code> (we don't use it here) and few other internal details.</p>
<p>One function call has exactly one execution context associated with it.</p>
<p>When a function makes a nested call, the following happens:</p>
<ul>
<li>The current function is paused.</li>
<li>The execution context associated with it is remembered in a special data structure called <em>execution context stack</em>.</li>
<li>The nested call executes.</li>
<li>After it ends, the old execution context is retrieved from the stack, and the outer function is resumed from where it stopped.</li>
</ul>
<p>Let's see what happens during the <code>pow(2, 3)</code> call.</p>
<h3>
pow(2, 3)</a></h3><p>In the beginning of the call <code>pow(2, 3)</code> the execution context will store variables: <code>x = 2, n = 3</code>, the execution flow is at line <code>1</code> of the function.</p>
<p>We can sketch it as:</p>
<ul class="function-execution-context-list">
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 3, at line 1 }</span>
    <span class="function-execution-context-call">pow(2, 3)</span>
  </li>
</ul>
<p>That's when the function starts to execute. The condition <code>n == 1</code> is false, so the flow continues into the second branch of <code>if</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  if (n == 1) {
    return x;
  } else {
    return x * pow(x, n - 1);
  }
}

alert( pow(2, 3) );</code></pre>
        </div>
      </div>
      
      </div><p>The variables are same, but the line changes, so the context is now:</p>
<ul class="function-execution-context-list">
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 3, at line 5 }</span>
    <span class="function-execution-context-call">pow(2, 3)</span>
  </li>
</ul>
<p>To calculate <code>x * pow(x, n - 1)</code>, we need to make a subcall of <code>pow</code> with new arguments <code>pow(2, 2)</code>.</p>
<h3>
pow(2, 2)</a></h3><p>To do a nested call, JavaScript remembers the current execution context in the <em>execution context stack</em>.</p>
<p>Here we call the same function <code>pow</code>, but it absolutely doesn't matter. The process is the same for all functions:</p>
<ol>
<li>The current context is “remembered” on top of the stack.</li>
<li>The new context is created for the subcall.</li>
<li>When the subcall is finished – the previous context is popped from the stack, and its execution continues.</li>
</ol>
<p>Here's the context stack when we entered the subcall <code>pow(2, 2)</code>:</p>
<ul class="function-execution-context-list">
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 2, at line 1 }</span>
    <span class="function-execution-context-call">pow(2, 2)</span>
  </li>
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 3, at line 5 }</span>
    <span class="function-execution-context-call">pow(2, 3)</span>
  </li>
</ul>
<p>The new current execution context is on top (and bold), and previous remembered contexts are below.</p>
<p>When we finish the subcall – it is easy to resume the previous context, because it keeps both variables and the exact place of the code where it stopped. Here in the picture we use the word “line”, but of course it's more precise.</p>
<h3>
pow(2, 1)</a></h3><p>The process repeats: a new subcall is made at line <code>5</code>, now with arguments <code>x=2</code>, <code>n=1</code>.</p>
<p>A new execution context is created, the previous one is pushed on top of the stack:</p>
<ul class="function-execution-context-list">
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 1, at line 1 }</span>
    <span class="function-execution-context-call">pow(2, 1)</span>
  </li>
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 2, at line 5 }</span>
    <span class="function-execution-context-call">pow(2, 2)</span>
  </li>
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 3, at line 5 }</span>
    <span class="function-execution-context-call">pow(2, 3)</span>
  </li>
</ul>
<p>There are 2 old contexts now and 1 currently running for <code>pow(2, 1)</code>.</p>
<h3>
The exit</a></h3><p>During the execution of <code>pow(2, 1)</code>, unlike before, the condition <code>n == 1</code> is truthy, so the first branch of <code>if</code> works:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  if (n == 1) {
    return x;
  } else {
    return x * pow(x, n - 1);
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>There are no more nested calls, so the function finishes, returning <code>2</code>.</p>
<p>As the function finishes, its execution context is not needed anymore, so it's removed from the memory. The previous one is restored off the top of the stack:</p>
<ul class="function-execution-context-list">
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 2, at line 5 }</span>
    <span class="function-execution-context-call">pow(2, 2)</span>
  </li>
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 3, at line 5 }</span>
    <span class="function-execution-context-call">pow(2, 3)</span>
  </li>
</ul>
<p>The execution of <code>pow(2, 2)</code> is resumed. It has the result of the subcall <code>pow(2, 1)</code>, so it also can finish the evaluation of <code>x * pow(x, n - 1)</code>, returning <code>4</code>.</p>
<p>Then the previous context is restored:</p>
<ul class="function-execution-context-list">
  <li>
    <span class="function-execution-context">Context: { x: 2, n: 3, at line 5 }</span>
    <span class="function-execution-context-call">pow(2, 3)</span>
  </li>
</ul>
<p>When it finishes, we have a result of <code>pow(2, 3) = 8</code>.</p>
<p>The recursion depth in this case was: <strong>3</strong>.</p>
<p>As we can see from the illustrations above, recursion depth equals the maximal number of context in the stack.</p>
<p>Note the memory requirements. Contexts take memory. In our case, raising to the power of <code>n</code> actually requires the memory for <code>n</code> contexts, for all lower values of <code>n</code>.</p>
<p>A loop-based algorithm is more memory-saving:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  let result = 1;

  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }

  return result;
}</code></pre>
        </div>
      </div>
      
      </div><p>The iterative <code>pow</code> uses a single context changing <code>i</code> and <code>result</code> in the process. Its memory requirements are small, fixed and do not depend on <code>n</code>.</p>
<p><strong>Any recursion can be rewritten as a loop. The loop variant usually can be made more effective.</strong></p>
<p>…But sometimes the rewrite is non-trivial, especially when function uses different recursive subcalls depending on conditions and merges their results or when the branching is more intricate. And the optimization may be unneeded and totally not worth the efforts.</p>
<p>Recursion can give a shorter code, easier to understand and support. Optimizations are not required in every place, mostly we need a good code, that's why it's used.</p>
<h2 id="chapter-388">
Recursive traversals</h2>
<p>Another great application of the recursion is a recursive traversal.</p>
<p>Imagine, we have a company. The staff structure can be presented as an object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let company = {
  sales: [{
    name: 'John',
    salary: 1000
  }, {
    name: 'Alice',
    salary: 600
  }],

  development: {
    sites: [{
      name: 'Peter',
      salary: 2000
    }, {
      name: 'Alex',
      salary: 1800
    }],

    internals: [{
      name: 'Jack',
      salary: 1300
    }]
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>In other words, a company has departments.</p>
<ul>
<li>
<p>A department may have an array of staff. For instance, <code>sales</code> department has 2 employees: John and Alice.</p>
</li>
<li>
<p>Or a department may split into subdepartments, like <code>development</code> has two branches: <code>sites</code> and <code>internals</code>. Each of them has the own staff.</p>
</li>
<li>
<p>It is also possible that when a subdepartment grows, it divides into subsubdepartments (or teams).</p>
<p>For instance, the <code>sites</code> department in the future may be split into teams for <code>siteA</code> and <code>siteB</code>. And they, potentially, can split even more. That's not on the picture, just something to have in mind.</p>
</li>
</ul>
<p>Now let's say we want a function to get the sum of all salaries. How can we do that?</p>
<p>An iterative approach is not easy, because the structure is not simple. The first idea may be to make a <code>for</code> loop over <code>company</code> with nested subloop over 1st level departments. But then we need more nested subloops to iterate over the staff in 2nd level departments like <code>sites</code>. …And then another subloop inside those for 3rd level departments that might appear in the future? Should we stop on level 3 or make 4 levels of loops? If we put 3-4 nested subloops in the code to traverse a single object, it becomes rather ugly.</p>
<p>Let's try recursion.</p>
<p>As we can see, when our function gets a department to sum, there are two possible cases:</p>
<ol>
<li>Either it's a “simple” department with an <em>array of people</em> – then we can sum the salaries in a simple loop.</li>
<li>Or it's <em>an object with <code>N</code> subdepartments</em> – then we can make <code>N</code> recursive calls to get the sum for each of the subdeps and combine the results.</li>
</ol>
<p>The (1) is the base of recursion, the trivial case.</p>
<p>The (2) is the recursive step. A complex task is split into subtasks for smaller departments. They may in turn split again, but sooner or later the split will finish at (1).</p>
<p>The algorithm is probably even easier to read from the code:</p>
<div data-trusted="1" class="code-example" data-highlight-block="9-19">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let company = { // the same object, compressed for brevity
  sales: [{name: 'John', salary: 1000}, {name: 'Alice', salary: 600 }],
  development: {
    sites: [{name: 'Peter', salary: 2000}, {name: 'Alex', salary: 1800 }],
    internals: [{name: 'Jack', salary: 1300}]
  }
};

// The function to do the job
function sumSalaries(department) {
  if (Array.isArray(department)) { // case (1)
    return department.reduce((prev, current) =&gt; prev + current.salary, 0); // sum the array
  } else { // case (2)
    let sum = 0;
    for (let subdep of Object.values(department)) {
      sum += sumSalaries(subdep); // recursively call for subdepartments, sum the results
    }
    return sum;
  }
}

alert(sumSalaries(company)); // 6700</code></pre>
        </div>
      </div>
      
      </div><p>The code is short and easy to understand (hopefully?). That's the power of recursion. It also works for any level of subdepartment nesting.</p>
<p>Here's the diagram of calls:</p>
      <img src="http://javascript.info/article/recursion/recursive-salaries.png">
<p>We can easily see the principle: for an object <code>{...}</code> subcalls are made, while arrays <code>[...]</code> are the “leaves” of the recursion tree, they give immediate result.</p>
<p>Note that the code uses smart features that we've covered before:</p>
<ul>
<li>Method <code>arr.reduce</code> explained in the chapter 
<a href="http://javascript.info/array-methods">Array methods</a> to get the sum of the array.</li>
<li>Loop <code>for(val of Object.values(obj))</code> to iterate over object values: <code>Object.values</code> returns an array of them.</li>
</ul>
<h2 id="chapter-389">
Recursive structures</h2>
<p>A recursive (recursively-defined) data structure is a structure that replicates itself in parts.</p>
<p>We've just seen it in the example of a company structure above.</p>
<p>A company <em>department</em> is:</p>
<ul>
<li>Either an array of people.</li>
<li>Or an object with <em>departments</em>.</li>
</ul>
<p>For web-developers there are much better-known examples: HTML and XML documents.</p>
<p>In the HTML document, an <em>HTML-tag</em> may contain a list of:</p>
<ul>
<li>Text pieces.</li>
<li>HTML-comments.</li>
<li>Other <em>HTML-tags</em> (that in turn may contain text pieces/comments or other tags etc).</li>
</ul>
<p>That's once again a recursive definition.</p>
<p>For better understanding, we'll cover one more recursive structure named “Linked list” that might be a better alternative for arrays in some cases.</p>
<h3>
Linked list</a></h3><p>Imagine, we want to store an ordered list of objects.</p>
<p>The natural choice would be an array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [obj1, obj2, obj3];</code></pre>
        </div>
      </div>
      
      </div><p>…But there's a problem with arrays. The “delete element” and “insert element” operations are expensive. For instance, <code>arr.unshift(obj)</code> operation has to renumber all elements to make room for a new <code>obj</code>, and if the array is big, it takes time. Same with <code>arr.shift()</code>.</p>
<p>The only structural modifications that do not require mass-renumbering are those that operate with the end of array: <code>arr.push/pop</code>. So an array can be quite slow for big queues.</p>
<p>Alternatively, if we really need fast insertion/deletion, we can choose another data structure called a 
<a href="https://en.wikipedia.org/wiki/Linked_list">linked list</a>.</p>
<p>The <em>linked list element</em> is recursively defined as an object with:</p>
<ul>
<li><code>value</code>.</li>
<li><code>next</code> property referencing the next <em>linked list element</em> or <code>null</code> if that's the end.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let list = {
  value: 1,
  next: {
    value: 2,
    next: {
      value: 3,
      next: {
        value: 4,
        next: null
      }
    }
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>Graphical representation of the list:</p>
      <img src="http://javascript.info/article/recursion/linked-list.png">
<p>An alternative code for creation:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let list = { value: 1 };
list.next = { value: 2 };
list.next.next = { value: 3 };
list.next.next.next = { value: 4 };</code></pre>
        </div>
      </div>
      
      </div><p>Here we can even more clearer see that there are multiple objects, each one has the <code>value</code> and <code>next</code> pointing to the neighbour. The <code>list</code> variable is the first object in the chain, so following <code>next</code> pointers from it we can reach any element.</p>
<p>The list can be easily split into multiple parts and later joined back:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let secondList = list.next.next;
list.next.next = null;</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/recursion/linked-list-split.png"&gt;
<p>To join:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">list.next.next = secondList;</code></pre>
        </div>
      </div>
      
      </div><p>And surely we can insert or remove items in any place.</p>
<p>For instance, to prepend a new value, we need to update the head of the list:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let list = { value: 1 };
list.next = { value: 2 };
list.next.next = { value: 3 };
list.next.next.next = { value: 4 };

// prepend the new value to the list
list = { value: "new item", next: list };</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/recursion/linked-list-0.png"&gt;
<p>To remove a value from the middle, change <code>next</code> of the previous one:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">list.next = list.next.next;</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/recursion/linked-list-remove-1.png"&gt;
<p>We made <code>list.next</code> jump over <code>1</code> to value <code>2</code>. The value <code>1</code> is now excluded from the chain. If it's not stored anywhere else, it will be automatically removed from the memory.</p>
<p>Unlike arrays, there's no mass-renumbering, we can easily rearrange elements.</p>
<p>Naturally, lists are not always better than arrays. Otherwise everyone would use only lists.</p>
<p>The main drawback is that we can't easily access an element by its number. In an array that's easy: <code>arr[n]</code> is a direct reference. But in the list we need to start from the first item and go <code>next</code> <code>N</code> times to get the Nth element.</p>
<p>…But we don't always need such operations. For instance, when we need a queue or even a 
<a href="https://en.wikipedia.org/wiki/Double-ended_queue">deque</a> – the ordered structure that must allow very fast adding/removing elements from both ends.</p>
<p>Sometimes it's worth to add another variable named <code>tail</code> to track the last element of the list (and update it when adding/removing elements from the end). For large sets of elements the speed difference versus arrays is huge.</p>
<h2 id="chapter-390">
Summary</h2>
<p>Terms:</p>
<ul>
<li>
<p><em>Recursion</em>  is a programming term that means a “self-calling” function. Such functions can be used to solve certain tasks in elegant ways.</p>
<p>When a function calls itself, that's called a <em>recursion step</em>. The <em>basis</em> of recursion is function arguments that make the task so simple that the function does not make further calls.</p>
</li>
<li>
<p>A 
<a href="https://en.wikipedia.org/wiki/Recursive_data_type">recursively-defined</a> data structure is a data structure that can be defined using itself.</p>
<p>For instance, the linked list can be defined as a data structure consisting of an object referencing a list (or null).</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">list = { value, next -&gt; list }</code></pre>
        </div>
      </div>
      
      </div><p>Trees like HTML elements tree or the department tree from this chapter are also naturally recursive: they branch and every branch can have other branches.</p>
<p>Recursive functions can be used to walk them as we've seen in the <code>sumSalary</code> example.</p>
</li>
</ul>
<p>Any recursive function can be rewritten into an iterative one. And that's sometimes required to optimize stuff. But for many tasks a recursive solution is fast enough and easier to write and support.</p>
<div class="tasks"><h2 id="chapter-391" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sum-all-numbers-till-the-given-one" name="sum-all-numbers-till-the-given-one" class="main__anchor">Sum all numbers till the given one</a></h3>
<a href="http://javascript.info/task/sum-to" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>sumTo(n)</code> that calculates the sum of numbers <code>1 + 2 + ... + n</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">sumTo(1) = 1
sumTo(2) = 2 + 1 = 3
sumTo(3) = 3 + 2 + 1 = 6
sumTo(4) = 4 + 3 + 2 + 1 = 10
...
sumTo(100) = 100 + 99 + ... + 2 + 1 = 5050</code></pre>
        </div>
      </div>
      
      </div><p>Make 3 solution variants:</p>
<ol>
<li>Using a for loop.</li>
<li>Using a recursion, cause <code>sumTo(n) = n + sumTo(n-1)</code> for <code>n &gt; 1</code>.</li>
<li>Using the 
<a href="https://en.wikipedia.org/wiki/Arithmetic_progression">arithmetic progression</a> formula.</li>
</ol>
<p>An example of the result:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sumTo(n) { /*... your code ... */ }

alert( sumTo(100) ); // 5050</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Which solution variant is the fastest? The slowest? Why?</p>
<p>P.P.S. Can we use recursion to count <code>sumTo(100000)</code>?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution using a loop:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sumTo(n) {
  let sum = 0;
  for (let i = 1; i &lt;= n; i++) {
    sum += i;
  }
  return sum;
}

alert( sumTo(100) );</code></pre>
        </div>
      </div>
      
      </div><p>The solution using recursion:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sumTo(n) {
  if (n == 1) return 1;
  return n + sumTo(n - 1);
}

alert( sumTo(100) );</code></pre>
        </div>
      </div>
      
      </div><p>The solution using the formula: <code>sumTo(n) = n*(n+1)/2</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sumTo(n) {
  return n * (n + 1) / 2;
}

alert( sumTo(100) );</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Naturally, the formula is the fastest solution. It uses only 3 operations for any number <code>n</code>. The math helps!</p>
<p>The loop variant is the second in terms of speed. In both the recursive and the loop variant we sum the same numbers. But the recursion involves nested calls and execution stack management. That also takes resources, so it's slower.</p>
<p>P.P.S. The standard describes a “tail call” optimization: if the recursive call is the very last one in the function (like in <code>sumTo</code> above), then the outer function will not need to resume the execution and we don't need to remember its execution context. In that case <code>sumTo(100000)</code> is countable. But if your JavaScript engine does not support it, there will be an error: maximum stack size exceeded, because there's usually a limitation on the total stack size.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#calculate-factorial" name="calculate-factorial" class="main__anchor">Calculate factorial</a></h3>
<a href="http://javascript.info/task/factorial" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>The 
<a href="https://en.wikipedia.org/wiki/Factorial">factorial</a> of a natural number is a number multiplied by <code>"number minus one"</code>, then by <code>"number minus two"</code>, and so on till <code>1</code>. The factorial of <code>n</code> is denoted as <code>n!</code></p>
<p>We can write a definition of factorial like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">n! = n * (n - 1) * (n - 2) * ...*1</code></pre>
        </div>
      </div>
      
      </div><p>Values of factorials for different <code>n</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">1! = 1
2! = 2 * 1 = 2
3! = 3 * 2 * 1 = 6
4! = 4 * 3 * 2 * 1 = 24
5! = 5 * 4 * 3 * 2 * 1 = 120</code></pre>
        </div>
      </div>
      
      </div><p>The task is to write a function <code>factorial(n)</code> that calculates <code>n!</code> using recursive calls.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( factorial(5) ); // 120</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Hint: <code>n!</code> can be written as <code>n * (n-1)!</code> For instance: <code>3! = 3*2! = 3*2*1! = 6</code></p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>By definition, a factorial is <code>n!</code> can be written as <code>n * (n-1)!</code>.</p>
<p>In other words, the result of <code>factorial(n)</code> can be calculated as <code>n</code> multiplied by the result of <code>factorial(n-1)</code>. And the call for <code>n-1</code> can recursively descend lower, and lower, till <code>1</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function factorial(n) {
  return (n != 1) ? n * factorial(n - 1) : 1;
}

alert( factorial(5) ); // 120</code></pre>
        </div>
      </div>
      
      </div><p>The basis of recursion is the value <code>1</code>. We can also make <code>0</code> the basis here, doesn't matter much, but gives one more recursive step:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function factorial(n) {
  return n ? n * factorial(n - 1) : 1;
}

alert( factorial(5) ); // 120</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#fibonacci-numbers" name="fibonacci-numbers" class="main__anchor">Fibonacci numbers</a></h3>
<a href="http://javascript.info/task/fibonacci-numbers" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The sequence of 
<a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci numbers</a> has the formula <code>F<sub>n</sub> = F<sub>n-1</sub> + F<sub>n-2</sub></code>. In other words, the next number is a sum of the two preceding ones.</p>
<p>First two numbers are <code>1</code>, then <code>2(1+1)</code>, then <code>3(1+2)</code>, <code>5(2+3)</code> and so on: <code>1, 1, 2, 3, 5, 8, 13, 21...</code>.</p>
<p>Fibonacci numbers are related to the 
<a href="https://en.wikipedia.org/wiki/Golden_ratio">Golden ratio</a> and many natural phenomena around us.</p>
<p>Write a function <code>fib(n)</code> that returns the <code>n-th</code> Fibonacci number.</p>
<p>An example of work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function fib(n) { /* your code */ }

alert(fib(3)); // 2
alert(fib(7)); // 13
alert(fib(77)); // 5527939700884757</code></pre>
        </div>
      </div>
      
      </div><p>P.S. The function should be fast. The call to <code>fib(77)</code> should take no more than a fraction of a second.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The first solution we could try here is the recursive one.</p>
<p>Fibonacci numbers are recursive by definition:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function fib(n) {
  return n &lt;= 1 ? n : fib(n - 1) + fib(n - 2);
}

alert( fib(3) ); // 2
alert( fib(7) ); // 13
// fib(77); // will be extremely slow!</code></pre>
        </div>
      </div>
      
      </div><p>…But for big values of <code>n</code> it's very slow. For instance, <code>fib(77)</code> may hang up the engine for some time eating all CPU resources.</p>
<p>That's because the function makes too many subcalls. The same values are re-evaluated again and again.</p>
<p>For instance, let's see a piece of calculations for <code>fib(5)</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">...
fib(5) = fib(4) + fib(3)
fib(4) = fib(3) + fib(2)
...</code></pre>
        </div>
      </div>
      
      </div><p>Here we can see that the value of <code>fib(3)</code> is needed for both <code>fib(5)</code> and <code>fib(4)</code>. So <code>fib(3)</code> will be called and evaluated two times completely independently.</p>
<p>Here's the full recursion tree:</p>
      <img src="http://javascript.info/task/fibonacci-numbers/fibonacci-recursion-tree.png">
<p>We can clearly notice that <code>fib(3)</code> is evaluated two times and <code>fib(2)</code> is evaluated three times. The total amount of computations grows much faster than <code>n</code>, making it enormous even for <code>n=77</code>.</p>
<p>We can optimize that by remembering already-evaluated values: if a value of say <code>fib(3)</code> is calculated once, then we can just reuse it in future computations.</p>
<p>Another variant would be to give up recursion and use a totally different loop-based algorithm.</p>
<p>Instead of going from <code>n</code> down to lower values, we can make a loop that starts from <code>1</code> and <code>2</code>, then gets <code>fib(3)</code> as their sum, then <code>fib(4)</code> as the sum of two previous values, then <code>fib(5)</code> and goes up and up, till it gets to the needed value. On each step we only need to remember two previous values.</p>
<p>Here are the steps of the new algorithm in details.</p>
<p>The start:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// a = fib(1), b = fib(2), these values are by definition 1
let a = 1, b = 1;

// get c = fib(3) as their sum
let c = a + b;

/* we now have fib(1), fib(2), fib(3)
a  b  c
1, 1, 2
*/</code></pre>
        </div>
      </div>
      
      </div><p>Now we want to get <code>fib(4) = fib(2) + fib(3)</code>.</p>
<p>Let's shift the variables: <code>a,b</code> will get <code>fib(2),fib(3)</code>, and <code>c</code> will get their sum:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">a = b; // now a = fib(2)
b = c; // now b = fib(3)
c = a + b; // c = fib(4)

/* now we have the sequence:
   a  b  c
1, 1, 2, 3
*/</code></pre>
        </div>
      </div>
      
      </div><p>The next step gives another sequence number:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">a = b; // now a = fib(3)
b = c; // now b = fib(4)
c = a + b; // c = fib(5)

/* now the sequence is (one more number):
      a  b  c
1, 1, 2, 3, 5
*/</code></pre>
        </div>
      </div>
      
      </div><p>…And so on until we get the needed value. That's much faster than recursion and involves no duplicate computations.</p>
<p>The full code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function fib(n) {
  let a = 1;
  let b = 1;
  for (let i = 3; i &lt;= n; i++) {
    let c = a + b;
    a = b;
    b = c;
  }
  return b;
}

alert( fib(3) ); // 2
alert( fib(7) ); // 13
alert( fib(77) ); // 5527939700884757</code></pre>
        </div>
      </div>
      
      </div><p>The loop starts with <code>i=3</code>, because the first and the second sequence values are hard-coded into variables <code>a=1</code>, <code>b=1</code>.</p>
<p>The approach is called 
<a href="https://en.wikipedia.org/wiki/Dynamic_programming">dynamic programming bottom-up</a>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#output-a-single-linked-list" name="output-a-single-linked-list" class="main__anchor">Output a single-linked list</a></h3>
<a href="http://javascript.info/task/output-single-linked-list" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Let's say we have a single-linked list (as described in the chapter 
<a href="http://javascript.info/recursion">Recursion and stack</a>):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let list = {
  value: 1,
  next: {
    value: 2,
    next: {
      value: 3,
      next: {
        value: 4,
        next: null
      }
    }
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>Write a function <code>printList(list)</code> that outputs list items one-by-one.</p>
<p>Make two variants of the solution: using a loop and using recursion.</p>
<p>What's better: with recursion or without it?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Loop-based solution</button>
<div class="task__answer-content"><h4 class="task__step-title">Loop-based solution</h4><p>The loop-based variant of the solution:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let list = {
  value: 1,
  next: {
    value: 2,
    next: {
      value: 3,
      next: {
        value: 4,
        next: null
      }
    }
  }
};

function printList(list) {
  let tmp = list;

  while (tmp) {
    alert(tmp.value);
    tmp = tmp.next;
  }

}

printList(list);</code></pre>
        </div>
      </div>
      
      </div><p>Please note that we use a temporary variable <code>tmp</code> to walk over the list. Technically, we could use a function parameter <code>list</code> instead:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:8-12">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function printList(list) {

  while(list) {
    alert(list.value);
    list = list.next;
  }

}</code></pre>
        </div>
      </div>
      
      </div><p>…But that would be unwise. In the future we may need to extend a function, do something else with the list. If we change <code>list</code>, then we loose such ability.</p>
<p>Talking about good variable names, <code>list</code> here is the list itself. The first element of it. And it should remain like that. That's clear and reliable.</p>
<p>From the other side, the role of <code>tmp</code> is exclusively a list traversal, like <code>i</code> in the <code>for</code> loop.</p>
</div></div><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Recursive solution</button>
<div class="task__answer-content"><h4 class="task__step-title">Recursive solution</h4><p>The recursive variant of <code>printList(list)</code> follows a simple logic: to output a list we should output the current element <code>list</code>, then do the same for <code>list.next</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let list = {
  value: 1,
  next: {
    value: 2,
    next: {
      value: 3,
      next: {
        value: 4,
        next: null
      }
    }
  }
};

function printList(list) {

  alert(list.value); // output the current item

  if (list.next) {
    printList(list.next); // do the same for the rest of the list
  }

}

printList(list);</code></pre>
        </div>
      </div>
      
      </div><p>Now what's better?</p>
<p>Technically, the loop is more effective. These two variants do the same, but the loop does not spend resources for nested function calls.</p>
<p>From the other side, the recursive variant is shorter and sometimes easier to understand.</p>
</div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#output-a-single-linked-list-in-the-reverse-order" name="output-a-single-linked-list-in-the-reverse-order" class="main__anchor">Output a single-linked list in the reverse order</a></h3>
<a href="http://javascript.info/task/output-single-linked-list-reverse" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Output a single-linked list from the previous task 
<a href="http://javascript.info/task/output-single-linked-list">Output a single-linked list</a> in the reverse order.</p>
<p>Make two solutions: using a loop and using a recursion.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Using a recursion</button>
<div class="task__answer-content"><h4 class="task__step-title">Using a recursion</h4><p>The recursive logic is a little bit tricky here.</p>
<p>We need to first output the rest of the list and <em>then</em> output the current one:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let list = {
  value: 1,
  next: {
    value: 2,
    next: {
      value: 3,
      next: {
        value: 4,
        next: null
      }
    }
  }
};

function printReverseList(list) {

  if (list.next) {
    printReverseList(list.next);
  }

  alert(list.value);
}

printReverseList(list);</code></pre>
        </div>
      </div>
      
      </div></div></div><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Using a loop</button>
<div class="task__answer-content"><h4 class="task__step-title">Using a loop</h4><p>The loop variant is also a little bit more complicated then the direct output.</p>
<p>There is no way to get the last value in our <code>list</code>. We also can't “go back”.</p>
<p>So what we can do is to first go through the items in the direct order and rememeber them in an array, and then output what we remembered in the reverse order:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let list = {
  value: 1,
  next: {
    value: 2,
    next: {
      value: 3,
      next: {
        value: 4,
        next: null
      }
    }
  }
};

function printReverseList(list) {
  let arr = [];
  let tmp = list;

  while (tmp) {
    arr.push(tmp.value);
    tmp = tmp.next;
  }

  for (let i = arr.length - 1; i &gt;= 0; i--) {
    alert( arr[i] );
  }
}

printReverseList(list);</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the recursive solution actually does exactly the same: it follows the list, remembers the items in the chain of nested calls (in the execution context stack), and then outputs them.</p>
</div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-392"></h6>
<h1 class="main__header-title" id="chapter-393">Rest parameters and spread operator</h1>
<p>Many JavaScript built-in functions support an arbitrary number of arguments.</p>
<p>For instance:</p>
<ul>
<li><code>Math.max(arg1, arg2, ..., argN)</code> – returns the greatest of the arguments.</li>
<li><code>Object.assign(dest, src1, ..., srcN)</code> – copies properties from <code>src1..N</code> into <code>dest</code>.</li>
<li>…and so on.</li>
</ul>
<p>In this chapter we'll see how to do the same. And, more important, how to feel comfortable working with such functions and arrays.</p>


<h2 id="chapter-394">
Rest parameters <code>...</code></h2>
<p>A function can be called with any number of arguments, no matter how it is defined.</p>
<p>Like here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sum(a, b) {
  return a + b;
}

alert( sum(1, 2, 3, 4, 5) );</code></pre>
        </div>
      </div>
      
      </div><p>There will be no error because of “excessive” arguments. But of course in the result only the first two will be counted.</p>
<p>The rest parameters can be mentioned in a function definition with three dots <code>...</code>. They literally mean: “gather the remaining parameters into an array”.</p>
<p>For instance, to gather all arguments into array <code>args</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sumAll(...args) { // args is the name for the array
  let sum = 0;

  for (let arg of args) sum += arg;

  return sum;
}

alert( sumAll(1) ); // 1
alert( sumAll(1, 2) ); // 3
alert( sumAll(1, 2, 3) ); // 6</code></pre>
        </div>
      </div>
      
      </div><p>We can choose to get first parameters as variables, and gather only the rest.</p>
<p>Here the first two arguments go into variables and the rest goes to <code>titles</code> array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showName(firstName, lastName, ...titles) {
  alert( firstName + ' ' + lastName ); // Julius Caesar

  // the rest go into titles array
  // i.e. titles = ["Consul", "Imperator"]
  alert( titles[0] ); // Consul
  alert( titles[1] ); // Imperator
  alert( titles.length ); // 2
}

showName("Julius", "Caesar", "Consul", "Imperator");</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">The rest parameters must be at the end</span></div>
            <div class="important__content"><p>The rest parameters gather all remaining arguments, so the following has no sense:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(arg1, ...rest, arg2) { // arg2 after ...rest ?!
  // error
}</code></pre>
        </div>
      </div>
      
      </div><p>The <code>...rest</code> must always be the last.</p>
</div></div>
<h2 id="chapter-395">
The “arguments” variable</h2>
<p>There is also a special array-like object named <code>arguments</code> that contains all arguments by their index.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showName() {
  alert( arguments.length );
  alert( arguments[0] );
  alert( arguments[1] );

  // it's iterable
  // for(let arg of arguments) alert(arg);
}

// shows: 2, Julius, Caesar
showName("Julius", "Caesar");

// shows: 1, Ilya, undefined (no second argument)
showName("Ilya");</code></pre>
        </div>
      </div>
      
      </div><p>In old times, rest parameters did not exist in the language, and <code>arguments</code> was the only way to get all arguments of the function no matter of their total number.</p>
<p>And it still works, we can use it.</p>
<p>But the downside is that although <code>arguments</code> is both array-like and iterable, it's not an array. It does not support array methods, so we can't say call <code>arguments.map(...)</code>.</p>
<p>Also, it always has all arguments in it, we can't capture them partially, like we did with rest parameters.</p>
<p>So when we need these features, then rest parameters are preferred.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Arrow functions do not have <code>"arguments"</code></span></div>
            <div class="important__content"><p>If we access the <code>arguments</code> object from an arrow function, it takes them from the outer “normal” function.</p>
<p>Here's an example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  let showArg = () =&gt; alert(arguments[0]);
  showArg();
}

f(1); // 1</code></pre>
        </div>
      </div>
      
      </div><p>As we remember, arrow functions don't have their own <code>this</code>. Now we know they don't have the special <code>arguments</code> object either.</p>
</div></div>
<h2 id="chapter-396">
Spread operator</h2>
<p>We've just seen how to get an array from the list of parameters.</p>
<p>But sometimes we need to do exactly the reverse.</p>
<p>For instance, there's a built-in function 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/max">Math.max</a> that returns the greatest number from the list:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Math.max(3, 5, 1) ); // 5</code></pre>
        </div>
      </div>
      
      </div><p>Now let's say we have an array <code>[3, 5, 1]</code>. How to call <code>Math.max</code> with it?</p>
<p>Passing it “as it” won't work, because <code>Math.max</code> expects a list of numeric arguments, not a single array:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [3, 5, 1];

alert( Math.max(arr) ); // NaN</code></pre>
        </div>
      </div>
      
      </div><p>…And surely we can't manually list items in the code <code>Math.max(arg[0], arg[1], arg[2])</code>, because we may be unsure how much are there. As our script executes, there might be many, or there might be none. Also that would be ugly.</p>
<p><em>Spread operator</em> to the rescue. It looks similar to rest parameters, also using <code>...</code>, but does quite the opposite.</p>
<p>When <code>...arr</code> is used in the function call, it “expands” an iterable object <code>arr</code> into the list of arguments.</p>
<p>For <code>Math.max</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [3, 5, 1];

alert( Math.max(...arr) ); // 5 (spread turns array into a list of arguments)</code></pre>
        </div>
      </div>
      
      </div><p>We also can pass multiple iterables this way:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr1 = [1, -2, 3, 4];
let arr2 = [8, 3, -8, 1];

alert( Math.max(...arr1, ...arr2) ); // 8</code></pre>
        </div>
      </div>
      
      </div><p>…And even combine the spread operator with normal values:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr1 = [1, -2, 3, 4];
let arr2 = [8, 3, -8, 1];

alert( Math.max(1, ...arr1, 2, ...arr2, 25) ); // 25</code></pre>
        </div>
      </div>
      
      </div><p>Also spread operator can be used to merge arrays:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [3, 5, 1];
let arr2 = [8, 9, 15];

let merged = [0, ...arr, 2, ...arr2];

alert(merged); // 0,3,5,1,2,8,9,15 (0, then arr, then 2, then arr2)</code></pre>
        </div>
      </div>
      
      </div><p>In the examples above we used an array to demonstrate the spread operator, but any iterable will do.</p>
<p>For instance, here we use spread operator to turn the string into array of characters:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Hello";

alert( [...str] ); // H,e,l,l,o</code></pre>
        </div>
      </div>
      
      </div><p>The spread operator internally uses iterators to gather elements, the same way as <code>for..of</code> does.</p>
<p>So, for a string, <code>for..of</code> returns characters and <code>...str</code> becomes <code>"H","e","l","l","o"</code>. The list of characters is passed to array initializer <code>[...str]</code>.</p>
<p>For this particular task we could also use <code>Array.from</code>, because it converts an iterable (like a string) into an array:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Hello";

// Array.from converts an iterable into an array
alert( Array.from(str) ); // H,e,l,l,o</code></pre>
        </div>
      </div>
      
      </div><p>The result is the same as <code>[...str]</code>.</p>
<p>But there's a subtle difference between <code>Array.from(obj)</code> and <code>[...obj]</code>:</p>
<ul>
<li><code>Array.from</code> operates on both array-likes and iterables.</li>
<li>The spread operator operates only on iterables.</li>
</ul>
<p>So, for the task of turning something into an array, <code>Array.from</code> appears more universal.</p>
<h2 id="chapter-397">
Summary</h2>
<p>When we see <code>"..."</code> in the code, it is either rest parameters or the spread operator.</p>
<p>There's an easy way to distinguish between them:</p>
<ul>
<li>When <code>...</code> is at the end of function parameters, it's “rest parameters” and gathers the rest of the list into the array.</li>
<li>When <code>...</code> occurs in a function call or alike, it's called a “spread operator” and expands an array into the list.</li>
</ul>
<p>Use patterns:</p>
<ul>
<li>Rest parameters are used to create functions that accept any number of arguments.</li>
<li>The spread operator is used to pass an array to functions that normally require a list of many arguments.</li>
</ul>
<p>Together they help to travel between a list and an array of parameters with ease.</p>
<p>All arguments of a function call are also available in “old-style” <code>arguments</code>: array-like iterable object.</p>

<h6 id="chapter-398"></h6>
<h1 class="main__header-title" id="chapter-399">Closure</h1>
<p>JavaScript is a very function-oriented language. It gives a lot of freedom. A function can be created at one moment, then copied to another variable or passed as an argument to another function and called from a totally different place later.</p>
<p>We know that a function can access variables outside of it. And this feature is used quite often.</p>
<p>But what happens when an outer variables changes? Does a function get a most recent value or the one that existed when the function was created?</p>
<p>Also, what happens when a function travels to another place of the code and is called from there – does it get access to outer variables in the new place?</p>
<p>Different languages behave differently here, in this chapter we cover JavaScript.</p>


<h2 id="chapter-400">
A couple of questions</h2>
<p>Let's formulate two questions for the seed, and then study the internal mechanics piece-by-piece, so that you'll be able to answer these questions and more complex ones in the future.</p>
<ol>
<li>
<p>The function <code>sayHi</code> uses an external variable <code>name</code>. When the function runs, which value of these two it's going to use?</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-8">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let name = "John";

function sayHi() {
  alert("Hi, " + name);
}

name = "Pete";

sayHi(); // what will it show: "John" or "Pete"?</code></pre>
        </div>
      </div>
      
      </div><p>Such situations are common in both browser and server-side development. A function may be scheduled to execute later than it is created, for instance after a user action or a network request.</p>
<p>So, the question is: does it pick up latest changes?</p>
</li>
<li>
<p>The function <code>makeWorker</code> makes another function and returns it. That new function can be called from somewhere else. Will it have access to outer variables from its creation place or the invocation place or maybe both?</p>
<div data-trusted="1" class="code-example" data-highlight-block="14-14">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeWorker() {
  let name = "Pete";

  return function() {
    alert(name);
  };
}

let name = "John";

// create a function
let work = makeWorker();

// call it
work(); // what will it show? "Pete" (name where created) or "John" (name where called)?</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<h2 id="chapter-401">
Lexical Environment</h2>
<p>To understand what's going on, let's first discuss what a “variable” technically is.</p>
<p>In JavaScript, every running function, code block and the script as a whole have an associated object named <em>Lexical Environment</em>.</p>
<p>The Lexical Environment object consists of two parts:</p>
<ol>
<li><em>Environment Record</em> – an object that has all local variables as its properties (and some other information like the value of <code>this</code>).</li>
<li>A reference to the <em>outer lexical environment</em>, usually the one associated with the code lexically right outside of it (outside of the current figure brackets).</li>
</ol>
<p>So, a “variable” is just a property of the special internal object, Environment Record. “To get or change a variable” means “to get or change the property of that object”.</p>
<p>For instance, in this simple code, there is only one Lexical Environment:</p>
      <img src="http://javascript.info/article/closure/lexical-environment-global.png">
<p>This is a so-called global Lexical Environment, associated with the whole script. For browsers, all <code>&lt;script&gt;</code> tags share the same global environment.</p>
<p>On the picture above, the rectangle means Environment Record (variable store) and the arrow means the outer reference. The global Lexical Environment has no outer one, so that's <code>null</code>.</p>
<p>Here's the bigger picture of how <code>let</code> variables work:</p>
      <img src="http://javascript.info/article/closure/lexical-environment-global-2.png">
<p>Rectangles on the right-hand side demonstrate how the global Lexical Environment changes during the execution:</p>
<ol>
<li>When the script starts, the Lexical Environment is empty.</li>
<li>The <code>let phrase</code> definition appears. Now it initially has no value, so <code>undefined</code> is stored.</li>
<li><code>phrase</code> is assigned.</li>
<li><code>phrase</code> refers to a new value.</li>
</ol>
<p>Everything looks simple for now, right?</p>
<p>To summarize:</p>
<ul>
<li>A variable is a property of a special internal object, associated with the currently executing block/function/script.</li>
<li>Working with variables is actually working with the properties of that object.</li>
</ul>
<h3>
Function Declaration</a></h3><p>Function Declarations are special. Unlike <code>let</code> variables, they are processed not when the execution reaches them, but when a Lexical Environment is created. For the global Lexical Environment, it means the moment when the script is started.</p>
<p>…And that is why we can call a function declaration before it is defined.</p>
<p>The code below demonstrates that the Lexical Environment is non-empty from the beginning. It has <code>say</code>, because that's a Function Declaration. And later it gets <code>phrase</code>, declared with <code>let</code>:</p>
      <img src="http://javascript.info/article/closure/lexical-environment-global-3.png">
<h3>
Inner and outer Lexical Environment</a></h3><p>During the call <code>say()</code> uses an outer variable, so let's see the details of what's going on.</p>
<p>First, when a function runs, a new function Lexical Environment is created automatically. That's a general rule for all functions. That Lexical Environment is used to store local variables and parameters of the call.</p>
<!--
```js
let phrase = "Hello";

function say(name) {
  alert( `${phrase}, ${name}` );
}

say("John"); // Hello, John
```
-->
<p>Here's the picture of Lexical Environments when the execution is inside <code>say("John")</code>, at the line labelled with an arrow:</p>
      <img src="http://javascript.info/article/closure/lexical-environment-simple.png">
<p>During the function call we have two Lexical Environments: the inner one (for the function call) and the outer one (global):</p>
<ul>
<li>The inner Lexical Environment corresponds to the current execution of  <code>say</code>. It has a single variable: <code>name</code>, the function argument. We called <code>say("John")</code>, so the value of <code>name</code> is <code>"John"</code>.</li>
<li>The outer Lexical Environment is the global Lexical Environment.</li>
</ul>
<p>The inner Lexical Environment has the <code>outer</code> reference to the outer one.</p>
<p><strong>When a code wants to access a variable – it is first searched in the inner Lexical Environment, then in the outer one, then the more outer one and so on until the end of the chain.</strong></p>
<p>If a variable is not found anywhere, that's an error in strict mode. Without <code>use strict</code>, an assignment to an undefined variable creates a new global variable, for backwards compatibility.</p>
<p>Let's see how the search proceeds in our example:</p>
<ul>
<li>When the <code>alert</code> inside <code>say</code> wants to access <code>name</code>, it finds it immediately in the function Lexical Environment.</li>
<li>When it wants to access <code>phrase</code>, then there is no <code>phrase</code> locally, so it follows the <code>outer</code> reference and finds it globally.</li>
</ul>
      <img src="http://javascript.info/article/closure/lexical-environment-simple-lookup.png">
<p>Now we can give the answer to the first seed question from the beginning of the chapter.</p>
<p><strong>A function gets outer variables as they are now, the most recent values.</strong></p>
<p>That's because of the described mechanism. Old variable values are not saved anywhere. When a function wants them, it takes the current values from its own or an outer Lexical Environment.</p>
<p>So the answer to the first question is <code>Pete</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let name = "John";

function sayHi() {
  alert("Hi, " + name);
}

name = "Pete"; // (*)

sayHi(); // Pete</code></pre>
        </div>
      </div>
      
      </div><p>The execution flow of the code above:</p>
<ol>
<li>The global Lexical Environment has <code>name: "John"</code>.</li>
<li>At the line <code>(*)</code> the global variable is changed, now it has <code>name: "Pete"</code>.</li>
<li>When the function <code>say()</code>, is executed and takes <code>name</code> from outside. Here that's from the global Lexical Environment where it's already <code>"Pete"</code>.</li>
</ol>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">One call – one Lexical Environment</span></div>
            <div class="important__content"><p>Please note that a new function Lexical Environment is created each time a function runs.</p>
<p>And if a function is called multiple times, then each invocation will have its own Lexical Environment, with local variables and parameters specific for that very run.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Lexical Environment is a specification object</span></div>
            <div class="important__content"><p>“Lexical Environment” is a specification object. We can't get this object in our code and manipulate it directly. JavaScript engines also may optimize it, discard variables that are unused to save memory and perform other internal tricks, but the visible behavior should be as described.</p>
</div></div>
<h2 id="chapter-402">
Nested functions</h2>
<p>A function is called “nested” when it is created inside another function.</p>
<p>Technically, that is easily possible.</p>
<p>We can use it to organize the code, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHiBye(firstName, lastName) {

  // helper nested function to use below
  function getFullName() {
    return firstName + " " + lastName;
  }

  alert( "Hello, " + getFullName() );
  alert( "Bye, " + getFullName() );

}</code></pre>
        </div>
      </div>
      
      </div><p>Here the <em>nested</em> function <code>getFullName()</code> is made for convenience. It can access the outer variables and so can return the full name.</p>
<p>What's more interesting, a nested function can be returned: as a property of a new object (if the outer function creates an object with methods) or as a result by itself. And then used somewhere else. No matter where, it still keeps the access to the same outer variables.</p>
<p>An example with the constructor function (see the chapter 
<a href="http://javascript.info/constructor-new">Constructor, operator "new"</a>):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// constructor function returns a new object
function User(name) {

  // the object method is created as a nested function
  this.sayHi = function() {
    alert(name);
  };
}

let user = new User("John");
user.sayHi(); // the method code has access to the outer "name"</code></pre>
        </div>
      </div>
      
      </div><p>An example with returning a function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeCounter() {
  let count = 0;

  return function() {
    return count++; // has access to the outer counter
  };
}

let counter = makeCounter();

alert( counter() ); // 0
alert( counter() ); // 1
alert( counter() ); // 2</code></pre>
        </div>
      </div>
      
      </div><p>Let's go on with the <code>makeCounter</code> example. It creates the “counter” function that returns the next number on each invocation. Despite being simple, slightly modified variants of that code have practical uses, for instance, as a 
<a href="https://en.wikipedia.org/wiki/Pseudorandom_number_generator">pseudorandom number generator</a>, and more. So the example is not quite artificial.</p>
<p>How does the counter work internally?</p>
<p>When the inner function runs, the variable in <code>count++</code> is searched from inside out. For the example above, the order will be:</p>
      <img src="http://javascript.info/article/closure/lexical-search-order.png">
<ol>
<li>The locals of the nested function.</li>
<li>The variables of the outer function.</li>
<li>…And further until it reaches globals.</li>
</ol>
<p>In that example <code>count</code> is found on the step <code>2</code>. When an outer variable is modified, it's changed where it's found. So <code>count++</code> finds the outer variable and increases it in the Lexical Environment where it belongs. Like if we had <code>let count = 1</code>.</p>
<p>Here are two questions for you:</p>
<ol>
<li>Can we somehow reset the <code>counter</code> from the code that doesn't belong to <code>makeCounter</code>? E.g. after <code>alert</code> calls in the example above.</li>
<li>If we call <code>makeCounter()</code> multiple times – it returns many <code>counter</code> functions. Are they independent or do they share the same <code>count</code>?</li>
</ol>
<p>Try to answer them before going on reading.</p>
<p>…Are you done?</p>
<p>Okay, here we go with the answers.</p>
<ol>
<li>There is no way. The <code>counter</code> is a local function variable, we can't access it from the outside.</li>
<li>For every call to <code>makeCounter()</code> a new function Lexical Environment is created, with its own <code>counter</code>. So the resulting <code>counter</code> functions are independent.</li>
</ol>
<p>Here's the demo:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeCounter() {
  let count = 0;
  return function() {
    return count++;
  };
}

let counter1 = makeCounter();
let counter2 = makeCounter();

alert( counter1() ); // 0
alert( counter1() ); // 1

alert( counter2() ); // 0 (independent)</code></pre>
        </div>
      </div>
      
      </div><p>Probably, the situation with outer variables is quite clear for you as of now. But in more complex situations a deeper understanding of internals may be required. So let's go ahead.</p>
<h2 id="chapter-403">
Environments in detail</h2>
<p>Now as you understand how closures work generally, we may finally descend to the very nuts and bolts.</p>
<p>Here's what's going on in the <code>makeCounter</code> example step-by-step, follow it to make sure that you understand everything. Please note the additional <code>[[Environment]]</code> property that we didn't cover yet.</p>
<ol>
<li>
<p>When the script has just started, there is only global Lexical Environment:</p>
      <img src="http://javascript.info/article/closure/lexenv-nested-makecounter-1.png">
<p>At that starting moment there is only <code>makeCounter</code> function, because it's a Function Declaration. It did not run yet.</p>
<p>All functions “on birth” receive a hidden property <code>[[Environment]]</code> with the reference to the Lexical Environment of their creation. We didn't talk about it yet, but technically that's a way how the function knows where it was made.</p>
<p>Here, <code>makeCounter</code> is created in the global Lexical Environment, so <code>[[Environment]]</code> keeps the reference to it.</p>
<p>In other words, a function is “imprinted” with a reference to the Lexical Environment where it was born. And <code>[[Environment]]</code> is the hidden function property that has that reference.</p>
</li>
<li>
<p>Then the code runs on, and the call to <code>makeCounter()</code> is performed. Here's the picture for the moment when the execution is on the first line inside <code>makeCounter()</code>:</p>
      <img src="http://javascript.info/article/closure/lexenv-nested-makecounter-2.png">
<p>At the moment of the call of <code>makeCounter()</code>, the Lexical Environment is created, to hold its variables and arguments.</p>
<p>As all Lexical Environments, it stores two things:</p>
<ol>
<li>An Environment Record with local variables. In our case <code>count</code> is the only local variable (appears in it when the line with <code>let count</code> is executed).</li>
<li>The outer lexical reference, which is set to <code>[[Environment]]</code> of the function. Here <code>[[Environment]]</code> of <code>makeCounter</code> references the global Lexical Environment.</li>
</ol>
<p>So, now we have two Lexical Environments: the first one is global, the second one is for the current <code>makeCounter</code> call, with the outer reference to global.</p>
</li>
<li>
<p>During the execution of <code>makeCounter()</code>, a tiny nested function is created.</p>
<p>It doesn't matter whether the function is created using Function Declaration or Function Expression. All functions get the <code>[[Environment]]</code> property that references the Lexical Environment where they were made. So that new tiny nested function gets it as well.</p>
<p>For our new nested function the value of <code>[[Environment]]</code> is the current Lexical Environment of <code>makeCounter()</code> (where it was born):</p>
      <img src="http://javascript.info/article/closure/lexenv-nested-makecounter-3.png">
<p>Please note that on this step the inner function was created, but not yet called. The code inside <code>function() { return count++; }</code> is not running, we're going to return it.</p>
</li>
<li>
<p>As the execution goes on, the call to <code>makeCounter()</code> finishes, and the result (the tiny nested function) is assigned to the global variable <code>counter</code>:</p>
      <img src="http://javascript.info/article/closure/lexenv-nested-makecounter-4.png">
<p>That function has only one line: <code>return count++</code>, that will be executed when we run it.</p>
</li>
<li>
<p>When the <code>counter()</code> is called, an “empty” Lexical Environment is created for it. It has no local variables by itself. But the <code>[[Environment]]</code> of <code>counter</code> is used as the outer reference for it, so it has access to the variables of the former <code>makeCounter()</code> call, where it was created:</p>
      <img src="http://javascript.info/article/closure/lexenv-nested-makecounter-5.png">
<p>Now if it accesses a variable, it first searches its own Lexical Environment (empty), then the Lexical Environment of the former <code>makeCounter()</code> call, then the global one.</p>
<p>When it looks for <code>count</code>, it finds it among the variables <code>makeCounter</code>, in the nearest outer Lexical Environment.</p>
<p>Please note how memory management works here. When <code>makeCounter()</code> call finished some time ago, its Lexical Environment was retained in memory, because there's a nested function with <code>[[Environment]]</code> referencing it.</p>
<p>Generally, a Lexical Environment object lives as long as there is a function which may use it. And when there are none, it is cleared.</p>
</li>
<li>
<p>The call to <code>counter()</code> not only returns the value of <code>count</code>, but also increases it. Note that the modification is done “in place”. The value of <code>count</code> is modified exactly in the environment where it was found.</p>
      <img src="http://javascript.info/article/closure/lexenv-nested-makecounter-6.png">
<p>So we return to the previous step with the only change – the new value of <code>count</code>. The following calls all do the same.</p>
</li>
<li>
<p>Next <code>counter()</code> invocations do the same.</p>
</li>
</ol>
<p>The answer to the second seed question from the beginning of the chapter should now be obvious.</p>
<p>The <code>work()</code> function in the code below uses the <code>name</code> from the place of its origin through the outer lexical environment reference:</p>
      <img src="http://javascript.info/article/closure/lexenv-nested-work.png">
<p>So, the result is <code>"Pete"</code> here.</p>
<p>…But if there were no <code>let name</code> in <code>makeWorker()</code>, then the search would go outside and take the global variable as we can see from the chain above. In that case it would be <code>"John"</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Closures</span></div>
            <div class="important__content"><p>There is a general programming term “closure”, that developers generally should know.</p>
<p>A 
<a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">closure</a> is a function that remembers its outer variables and can access them. In some languages, that's not possible, or a function should be written in a special way to make it happen. But as explained above, in JavaScript all functions are naturally closures (there is only one exclusion, to be covered in 
<a href="http://javascript.info/new-function">The "new Function" syntax</a>).</p>
<p>That is: they automatically remember where they are created using a hidden <code>[[Environment]]</code> property, and all of them can access outer variables.</p>
<p>When on an interview a frontend developer gets a question about “what's a closure?”, a valid answer would be a definition of the closure and an explanation that all functions in JavaScript are closures, and maybe few more words about technical details: the <code>[[Environment]]</code> property and how Lexical Environments work.</p>
</div></div>
<h2 id="chapter-404">
Code blocks and loops, IIFE</h2>
<p>The examples above concentrated on functions. But Lexical Environments also exist for code blocks <code>{...}</code>.</p>
<p>They are created when a code block runs and contain block-local variables. Here's a couple of examples.</p>
<h2 id="chapter-405">
If</h2>
<p>In the example below, when the execution goes into <code>if</code> block, the new “if-only” Lexical Environment is created for it:</p>
<!--
```js run
let phrase = "Hello";

if (true) {
  let user = "John";

  alert(`${phrase}, ${user}`); // Hello, John
}

alert(user); // Error, can't see such variable!
```
-->
      <img src="http://javascript.info/article/closure/lexenv-if.png">
<p>The new Lexical Environment gets the enclosing one as the outer reference, so <code>phrase</code> can be found. But all variables and Function Expressions declared inside <code>if</code> reside in that Lexical Environment and can't be seen from the outside.</p>
<p>For instance, after <code>if</code> finishes, the <code>alert</code> below won't see the <code>user</code>, hence the error.</p>
<h2 id="chapter-406">
For, while</h2>
<p>For a loop, every run has a separate Lexical Environment. If the variable is declared in <code>for</code>, then it's also local to that Lexical Environment:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let i = 0; i &lt; 10; i++) {
  // Each loop has its own Lexical Environment
  // {i: value}
}

alert(i); // Error, no such variable</code></pre>
        </div>
      </div>
      
      </div><p>That's actually an exception, because <code>let i</code> is visually outside of <code>{...}</code>. But in fact each run of the loop has its own Lexical Environment with the current <code>i</code> in it.</p>
<p>After the loop, <code>i</code> is not visible.</p>
<h3>
Code blocks</a></h3><p>We also can use a “bare” code block <code>{…}</code> to isolate variables into a “local scope”.</p>
<p>For instance, in a web browser all scripts share the same global area. So if we create a global variable in one script, it becomes available to others. But that becomes a source of conflicts if two scripts use the same variable name and overwrite each other.</p>
<p>That may happen if the variable name is a widespread word, and script authors are unaware of each other.</p>
<p>If we'd like to evade that, we can use a code block to isolate the whole script or an area in it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">{
  // do some job with local variables that should not be seen outside

  let message = "Hello";

  alert(message); // Hello
}

alert(message); // Error: message is not defined</code></pre>
        </div>
      </div>
      
      </div><p>The code outside of the block (or inside another script) doesn't see variables in it, because a code block has its own Lexical Environment.</p>
<h3>
IIFE</a></h3><p>In old scripts, one can find so-called “immediately-invoked function expressions” (abbreviated as IIFE) used for this purpose.</p>
<p>They look like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">(function() {

  let message = "Hello";

  alert(message); // Hello

})();</code></pre>
        </div>
      </div>
      
      </div><p>Here a Function Expression is created and immediately called. So the code executes right now and has its own private variables.</p>
<p>The Function Expression is wrapped with brackets <code>(function {...})</code>, because when JavaScript meets <code>"function"</code> in the main code flow, it understands it as a start of Function Declaration. But a Function Declaration must have a name, so there will be an error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Error: Unexpected token (
function() { // &lt;-- JavaScript cannot find function name, meets ( and gives error

  let message = "Hello";

  alert(message); // Hello

}();</code></pre>
        </div>
      </div>
      
      </div><p>We can say “okay, let it be Function Declaration, let's add a name”, but it won't work. JavaScript does not allow Function Declarations to be called immediately:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// syntax error because of brackets below
function go() {

}(); // &lt;-- can't call Function Declaration immediately</code></pre>
        </div>
      </div>
      
      </div><p>…So the brackets are needed to show JavaScript that the function is created in the context of another expression, and hence it's a Function Expression. Needs no name and can be called immediately.</p>
<p>There are other ways to tell JavaScript that we mean Function Expression:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="4:1-2,8:3-4,10:0-1,14:0-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Ways to create IIFE

(function() {
  alert("Brackets around the function");
})();

(function() {
  alert("Brackets around the whole thing");
}());

!function() {
  alert("Bitwise NOT operator starts the expression");
}();

+function() {
  alert("Unary plus starts the expression");
}();</code></pre>
        </div>
      </div>
      
      </div><p>In all cases above we declare a Function Expression and run it immediately.</p>
<h2 id="chapter-407">
Garbage collection</h2>
<p>Lexical Environment objects that we've been talking about are subjects to same memory management rules as regular values.</p>
<ul>
<li>
<p>Usually, Lexical Environment is cleaned up after the function run. For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  let value1 = 123;
  let value2 = 456;
}

f();</code></pre>
        </div>
      </div>
      
      </div><p>Here two values are technically the properties of the Lexical Environment. But after <code>f()</code> finishes that Lexical Environment becomes unreachable, so it's deleted from the memory.</p>
</li>
<li>
<p>…But if there's a nested function that is still reachable after the end of <code>f</code>, then its <code>[[Environment]]</code> reference keeps the outer lexical environment alive as well:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  let value = 123;

  function g() { alert(value); }

  return g;
}

let g = f(); // g is reachable, and keeps the outer lexical environment in memory</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Please note that if <code>f()</code> is called many times, and resulting functions are saved, then the corresponding Lexical Environment objects will also be retained in memory. All 3 of them in the code below:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  let value = Math.random();

  return function() { alert(value); };
}

// 3 functions in array, every one of them links to Lexical Environment
// from the corresponding f() run
//         LE   LE   LE
let arr = [f(), f(), f()];</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>A Lexical Environment object dies when it becomes unreachable. That is: when no nested functions remain that reference it. In the code below, after <code>g</code> becomes unreachable, the <code>value</code> is also cleaned from the memory;</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  let value = 123;

  function g() { alert(value); }

  return g;
}

let g = f(); // while g is alive
// there corresponding Lexical Environment lives

g = null; // ...and now the memory is cleaned up</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<h3>
Real-life optimizations</a></h3><p>As we've seen, in theory while a function is alive, all outer variables are also retained.</p>
<p>But in practice, JavaScript engines try to optimize that. They analyze variable usage and if it's easy to see that an outer variable is not used – it is removed.</p>
<p><strong>An important side effect in V8 (Chrome, Opera) is that such variable will become unavailable in debugging.</strong></p>
<p>Try running the example below with the open Developer Tools in Chrome.</p>
<p>When it pauses, in console type <code>alert(value)</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  let value = Math.random();

  function g() {
    debugger; // in console: type alert( value ); No such variable!
  }

  return g;
}

let g = f();
g();</code></pre>
        </div>
      </div>
      
      </div><p>As you could see – there is no such variable! In theory, it should be accessible, but the engine optimized it out.</p>
<p>That may lead to funny (if not such time-consuming) debugging issues. One of them – we can see a same-named outer variable instead of the expected one:</p>
<div data-trusted="1" data-global="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let value = "Surprise!";

function f() {
  let value = "the closest value";

  function g() {
    debugger; // in console: type alert( value ); Surprise!
  }

  return g;
}

let g = f();
g();</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">See ya!</span></div>
            <div class="important__content"><p>This feature of V8 is good to know. If you are debugging with Chrome/Opera, sooner or later you will meet it.</p>
<p>That is not a bug of debugger, but a special feature of V8. Maybe it will be changed sometime.
You always can check for it by running examples on this page.</p>
</div></div>
<div class="tasks"><h2 id="chapter-408" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#are-counters-independent" name="are-counters-independent" class="main__anchor">Are counters independent?</a></h3>
<a href="http://javascript.info/task/counter-independent" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Here we make two counters: <code>counter</code> and <code>counter2</code> using the same <code>makeCounter</code> function.</p>
<p>Are they independent? What is the second counter going to show? <code>0,1</code> or <code>2,3</code> or something else?</p>
<div data-trusted="1" class="code-example" data-highlight-block="14-15">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeCounter() {
  let count = 0;

  return function() {
    return count++;
  };
}

let counter = makeCounter();
let counter2 = makeCounter();

alert( counter() ); // 0
alert( counter() ); // 1

alert( counter2() ); // ?
alert( counter2() ); // ?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <strong>0,1.</strong></p>
<p>Functions <code>counter</code> and <code>counter2</code> are created by different invocations of <code>makeCounter</code>.</p>
<p>So they have independent outer Lexical Environments, each one has it's own <code>count</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#counter-object" name="counter-object" class="main__anchor">Counter object</a></h3>
<a href="http://javascript.info/task/counter-object-independent" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Here a counter object is made with the help of the constructor function.</p>
<p>Will it work? What will it show?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Counter() {
  let count = 0;

  this.up = function() {
    return ++count;
  };
  this.down = function() {
    return --count;
  };
}

let counter = new Counter();

alert( counter.up() ); // ?
alert( counter.up() ); // ?
alert( counter.down() ); // ?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Surely it will work just fine.</p>
<p>Both nested functions are created within the same outer Lexical Environment, so they share access to the same <code>count</code> variable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Counter() {
  let count = 0;

  this.up = function() {
    return ++count;
  };

  this.down = function() {
    return --count;
  };
}

let counter = new Counter();

alert( counter.up() ); // 1
alert( counter.up() ); // 2
alert( counter.down() ); // 1</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#function-in-if" name="function-in-if" class="main__anchor">Function in if</a></h3>
<a href="http://javascript.info/task/function-in-if" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Look at the code. What will be result of the call at the last line?</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let phrase = "Hello";

if (true) {
  let user = "John";

  function sayHi() {
    alert(`${phrase}, ${user}`);
  }
}

sayHi();</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The result is <strong>an error</strong>.</p>
<p>The function <code>sayHi</code> is declared inside the <code>if</code>, so it only lives inside it. There is no <code>sayHi</code> outside.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sum-with-closures" name="sum-with-closures" class="main__anchor">Sum with closures</a></h3>
<a href="http://javascript.info/task/closure-sum" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write function <code>sum</code> that works like this: <code>sum(a)(b) = a+b</code>.</p>
<p>Yes, exactly this way, via double brackets (not a mistype).</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">sum(1)(2) = 3
sum(5)(-1) = 4</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>For the second brackets to work, the first ones must return a function.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sum(a) {

  return function(b) {
    return a + b; // takes "a" from the outer lexical environment
  };

}

alert( sum(1)(2) ); // 3
alert( sum(5)(-1) ); // 4</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#filter-through-function" name="filter-through-function" class="main__anchor">Filter through function</a></h3>
<a href="http://javascript.info/task/filter-through-function" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We have a built-in method <code>arr.filter(f)</code> for arrays. It filters all elements through the function <code>f</code>. If it returns <code>true</code>, then that element is returned in the resulting array.</p>
<p>Make a set of “ready to use” filters:</p>
<ul>
<li><code>inBetween(a, b)</code> – between <code>a</code> and <code>b</code> or equal to them (inclusively).</li>
<li><code>inArray([...])</code> – in the given array.</li>
</ul>
<p>The usage must be like this:</p>
<ul>
<li><code>arr.filter(inBetween(3,6))</code> – selects only values between 3 and 6.</li>
<li><code>arr.filter(inArray([1,2,3]))</code> – selects only elements matching with one of the members of <code>[1,2,3]</code>.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">/* .. your code for inBetween and inArray */
let arr = [1, 2, 3, 4, 5, 6, 7];

alert( arr.filter(inBetween(3, 6)) ); // 3,4,5,6

alert( arr.filter(inArray([1, 2, 10])) ); // 1,2</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/ISIjrKehp65M3KQmIwte?p=preview" target="_blank" data-plunk-id="ISIjrKehp65M3KQmIwte">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Filter inBetween</button>
<div class="task__answer-content"><h4 class="task__step-title">Filter inBetween</h4><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function inBetween(a, b) {
  return function(x) {
    return x &gt;= a &amp;&amp; x &lt;= b;
  };
}

let arr = [1, 2, 3, 4, 5, 6, 7];
alert( arr.filter(inBetween(3, 6)) ); // 3,4,5,6</code></pre>
        </div>
      </div>
      
      </div></div></div><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Filter inArray</button>
<div class="task__answer-content"><h4 class="task__step-title">Filter inArray</h4><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function inArray(arr) {
  return function(x) {
    return arr.includes(x);
  };
}

let arr = [1, 2, 3, 4, 5, 6, 7];
alert( arr.filter(inArray([1, 2, 10])) ); // 1,2</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/hZOKDoUE3UixVYLJisFy?p=preview" target="_blank" data-plunk-id="hZOKDoUE3UixVYLJisFy">Open the solution with tests in the sandbox.</a></p></div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sort-by-field" name="sort-by-field" class="main__anchor">Sort by field</a></h3>
<a href="http://javascript.info/task/sort-by-field" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We've got an array of objects to sort:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let users = [
  { name: "John", age: 20, surname: "Johnson" },
  { name: "Pete", age: 18, surname: "Peterson" },
  { name: "Ann", age: 19, surname: "Hathaway" }
];</code></pre>
        </div>
      </div>
      
      </div><p>The usual way to do that would be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// by name (Ann, John, Pete)
users.sort((a, b) =&gt; a.name &gt; b.name ? 1 : -1);

// by age (Pete, Ann, John)
users.sort((a, b) =&gt; a.age &gt; b.age ? 1 : -1);</code></pre>
        </div>
      </div>
      
      </div><p>Can we make it even less verbose, like this?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">users.sort(byField('name'));
users.sort(byField('age'));</code></pre>
        </div>
      </div>
      
      </div><p>So, instead of writing a function, just put <code>byField(fieldName)</code>.</p>
<p>Write the function <code>byField</code> that can be used for that.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-highlight-block="6-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let users = [
  { name: "John", age: 20, surname: "Johnson" },
  { name: "Pete", age: 18, surname: "Peterson" },
  { name: "Ann", age: 19, surname: "Hathaway" }
];

function byField(field) {
  return (a, b) =&gt; a[field] &gt; b[field] ? 1 : -1;
}

users.sort(byField('name'));
users.forEach(user =&gt; alert(user.name)); // Ann, John, Pete

users.sort(byField('age'));
users.forEach(user =&gt; alert(user.name)); // Pete, Ann, John</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#army-of-functions" name="army-of-functions" class="main__anchor">Army of functions</a></h3>
<a href="http://javascript.info/task/make-army" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The following code creates an array of <code>shooters</code>.</p>
<p>Every function is meant to output its number. But something is wrong…</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeArmy() {
  let shooters = [];

  let i = 0;
  while (i &lt; 10) {
    let shooter = function() { // shooter function
      alert( i ); // should show its number
    };
    shooters.push(shooter);
    i++;
  }

  return shooters;
}

let army = makeArmy();

army[0](); // the shooter number 0 shows 10
army[5](); // and number 5 also outputs 10...
// ... all shooters show 10 instead of their 0, 1, 2, 3...</code></pre>
        </div>
      </div>
      
      </div><p>Why all shooters show the same? Fix the code so that they work as intended.</p>
<p>
<a href="http://plnkr.co/edit/sdw9JMeicGMnAh8aRA6D?p=preview" target="_blank" data-plunk-id="sdw9JMeicGMnAh8aRA6D">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Let's examine what's done inside <code>makeArmy</code>, and the solution will become obvious.</p>
<ol>
<li>
<p>It creates an empty array <code>shooters</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let shooters = [];</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Fills it in the loop via <code>shooters.push(function...)</code>.</p>
<p>Every element is a function, so the resulting array looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">shooters = [
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); },
  function () { alert(i); }
];</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>The array is returned from the function.</p>
</li>
</ol>
<p>Then, later, the call to <code>army[5]()</code> will get the element <code>army[5]</code> from the array (it will be a function) and call it.</p>
<p>Now why all such functions show the same?</p>
<p>That's because there's no local variable <code>i</code> inside <code>shooter</code> functions. When such a function is called, it takes <code>i</code> from its outer lexical environment.</p>
<p>What will be the value of <code>i</code>?</p>
<p>If we look at the source:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeArmy() {
  ...
  let i = 0;
  while (i &lt; 10) {
    let shooter = function() { // shooter function
      alert( i ); // should show its number
    };
    ...
  }
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>…We can see that it lives in the lexical environment associated with the current <code>makeArmy()</code> run. But when <code>army[5]()</code> is called, <code>makeArmy</code> has already finished its job, and <code>i</code> has the last value: <code>10</code> (the end of <code>while</code>).</p>
<p>As a result, all <code>shooter</code> functions get from the outer lexical envrironment the same, last value <code>i=10</code>.</p>
<p>The fix can be very simple:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeArmy() {

  let shooters = [];

  for(let i = 0; i &lt; 10; i++) {
    let shooter = function() { // shooter function
      alert( i ); // should show its number
    };
    shooters.push(shooter);
  }

  return shooters;
}

let army = makeArmy();

army[0](); // 0
army[5](); // 5</code></pre>
        </div>
      </div>
      
      </div><p>Now it works correctly, because every time the code block in <code>for (..) {...}</code> is executed, a new Lexical Environment is created for it, with the corresponding value of <code>i</code>.</p>
<p>So, the value of <code>i</code> now lives a little bit closer. Not in <code>makeArmy()</code> Lexical Environment, but in the Lexical Environment that corresponds the current loop iteration. A <code>shooter</code> gets the value exactly from the one where it was created.</p>
      <img src="http://javascript.info/task/make-army/lexenv-makearmy.png">
<p>Here we rewrote <code>while</code> into <code>for</code>.</p>
<p>Another trick could be possible, let's see it for better understanding of the subject:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5" data-highlight-inline="7:13-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeArmy() {
  let shooters = [];

  let i = 0;
  while (i &lt; 10) {
    let j = i;
    let shooter = function() { // shooter function
      alert( j ); // should show its number
    };
    shooters.push(shooter);
    i++;
  }

  return shooters;
}

let army = makeArmy();

army[0](); // 0
army[5](); // 5</code></pre>
        </div>
      </div>
      
      </div><p>The <code>while</code> loop, just like <code>for</code>, makes a new Lexical Environment for each run. So here we make sure that it gets the right value for a <code>shooter</code>.</p>
<p>We copy <code>let j = i</code>. This makes a loop body local <code>j</code> and copies the value of <code>i</code> to it. Primitives are copied “by value”, so we actually get a complete independent copy of <code>i</code>, belonging to the current loop iteration.</p>
<p>
<a href="http://plnkr.co/edit/k3o1vZs45MG44WMmOuRg?p=preview" target="_blank" data-plunk-id="k3o1vZs45MG44WMmOuRg">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-409"></h6>
<h1 class="main__header-title" id="chapter-410">The old "var"</h1>
<p>In the very first chapter about 
<a href="http://javascript.info/variables">variables</a>, we mentioned three ways of variable declaration:</p>
<ol>
<li><code>let</code></li>
<li><code>const</code></li>
<li><code>var</code></li>
</ol>
<p><code>let</code> and <code>const</code> behave exactly the same way in terms of Lexical Environments.</p>
<p>But <code>var</code> is a very different beast, that originates from very old times. It's generally not used in modern scripts, but still lurks in the old ones.</p>
<p>If you don't plan meeting such scripts you may even skip this chapter or postpone it, but then there's a chance that it bites you later.</p>


<p>From the first sight, <code>var</code> behaves similar to <code>let</code>. That is, declares a variable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  var phrase = "Hello"; // local variable, "var" instead of "let"

  alert(phrase); // Hello
}

sayHi();

alert(phrase); // Error, phrase is not defined</code></pre>
        </div>
      </div>
      
      </div><p>…But here are the differences.</p>
<h2 id="chapter-411">
“var” has no block scope</h2>
<p><code>var</code> variables are either function-wide or global, they are visible through blocks.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (true) {
  var test = true; // use "var" instead of "let"
}

alert(test); // true, the variable lives after if</code></pre>
        </div>
      </div>
      
      </div><p>If we used <code>let test</code> on the 2nd line, then it wouldn't be visible to <code>alert</code>. But <code>var</code> ignores code blocks, so we've got a global <code>test</code>.</p>
<p>The same thing for loops: <code>var</code> cannot be block- or loop-local:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (var i = 0; i &lt; 10; i++) {
  // ...
}

alert(i); // 10, "i" is visible after loop, it's a global variable</code></pre>
        </div>
      </div>
      
      </div><p>If a code block is inside a function, then <code>var</code> becomes a function-level variable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  if (true) {
    var phrase = "Hello";
  }

  alert(phrase); // works
}

sayHi();
alert(phrase); // Error: phrase is not defined</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, <code>var</code> pierces through <code>if</code>, <code>for</code> or other code blocks. That's because a long time ago in JavaScript blocks had no Lexical Environments. And <code>var</code> is a reminiscence of that.</p>
<h2 id="chapter-412">
“var” are processed at the function start</h2>
<p><code>var</code> declarations are processed when the function starts (or script starts for globals).</p>
<p>In other words, <code>var</code> variables are defined from the beginning of the function, no matter where the definition is (assuming that the definition is not in the nested function).</p>
<p>So this code:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  phrase = "Hello";

  alert(phrase);

  var phrase;
}</code></pre>
        </div>
      </div>
      
      </div><p>…Is technically the same as this (moved <code>var phrase</code> above):</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  var phrase;

  phrase = "Hello";

  alert(phrase);
}</code></pre>
        </div>
      </div>
      
      </div><p>…Or even as this (remember, code blocks are ignored):</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  phrase = "Hello"; // (*)

  if (false) {
    var phrase;
  }

  alert(phrase);
}</code></pre>
        </div>
      </div>
      
      </div><p>People also call such behavior “hoisting” (raising), because all <code>var</code> are “hoisted” (raised) to the top of the function.</p>
<p>So in the example above, <code>if (false)</code> branch never executes, but that doesn't matter. The <code>var</code> inside it is processed in the beginning of the function, so at the moment of <code>(*)</code> the variable exists.</p>
<p><strong>Declarations are hoisted, but assignments are not.</strong></p>
<p>That's better to demonstrate with an example, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert(phrase);

  var phrase = "Hello";
}

sayHi();</code></pre>
        </div>
      </div>
      
      </div><p>The line <code>var phrase = "Hello"</code> has two actions in it:</p>
<ol>
<li>Variable declaration <code>var</code></li>
<li>Variable assignment <code>=</code>.</li>
</ol>
<p>The declaration is processed at the start of function execution (“hoisted”), but the assignment always works at the place where it appears. So the code works essentially like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1,5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  var phrase; // declaration works at the start...

  alert(phrase); // undefined

  phrase = "Hello"; // ...assignment - when the execution reaches it.
}

sayHi();</code></pre>
        </div>
      </div>
      
      </div><p>Because all <code>var</code> declarations are processed at the function start, we can reference them at any place. But variables are undefined until the assignments.</p>
<p>In both examples above <code>alert</code> runs without an error, because the variable <code>phrase</code> exists. But its value is not yet assigned, so it shows <code>undefined</code>.</p>
<h2 id="chapter-413">
Summary</h2>
<p>There are two main differences of <code>var</code>:</p>
<ol>
<li>Variables have no block scope, they are visible minimum at the function level.</li>
<li>Variable declarations are processed at function start.</li>
</ol>
<p>There's one more minor difference related to the global object, we'll cover that in the next chapter.</p>
<p>These differences are actually a bad thing most of the time. First, we can't create block-local variables. And hoisting just creates more space for errors. So, for new scripts <code>var</code> is used exceptionally rarely.</p>

<h6 id="chapter-414"></h6>
<h1 class="main__header-title" id="chapter-415">Global object</h1>
<p>When JavaScript was created, there was an idea of a “global object” that provides all global variables and functions. It was planned that multiple in-browser scripts would use that single global object and share variables through it.</p>
<p>Since then, JavaScript greatly evolved, and that idea of linking code through global variables became much less appealing. In modern JavaScript, the concept of modules took its place.</p>
<p>But the global object still remains in the specification.</p>
<p>In a browser it is named “window”, for Node.JS it is “global”, for other environments it may have another name.</p>
<p>It does two things:</p>
<ol>
<li>
<p>Provides access to built-in functions and values, defined by the specification and the environment.
For instance, we can call <code>alert</code> directly or as a method of <code>window</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("Hello");

// the same as
window.alert("Hello");</code></pre>
        </div>
      </div>
      
      </div><p>The same applies to other built-ins. E.g. we can use <code>window.Array</code> instead of <code>Array</code>.</p>
</li>
<li>
<p>Provides access to global Function Declarations and <code>var</code> variables. We can read and write them using its properties, for instance:</p>
 <!-- no-strict to move variables out of eval -->
<div data-trusted="0" class="code-example" data-no-strict="1" data-refresh="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var phrase = "Hello";

function sayHi() {
  alert(phrase);
}

// can read from window
alert( window.phrase ); // Hello (global var)
alert( window.sayHi ); // function (global function declaration)

// can write to window (creates a new global variable)
window.test = 5;

alert(test); // 5</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>…But the global object does not have variables declared with <code>let/const</code>!</p>
<div data-trusted="0" class="code-example" data-no-strict="1" data-refresh="1" data-highlight-inline="0:0-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = "John";
alert(user); // John

alert(window.user); // undefined, don't have let
alert("user" in window); // false</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">The global object is not a global Environment Record</span></div>
            <div class="important__content"><p>In versions of ECMAScript prior to ES-2015, there were no <code>let/const</code> variables, only <code>var</code>. And global object was used as a global Environment Record (wordings were a bit different, but that's the gist).</p>
<p>But starting from ES-2015, these entities are split apart. There's a global Lexical Environment with its Environment Record. And there's a global object that provides <em>some</em> of the global variables.</p>
<p>As a practical difference, global <code>let/const</code> variables are definitively properties of the global Environment Record, but they do not exist in the global object.</p>
<p>Naturally, that's because the idea of a global object as a way to access “all global things” comes from ancient times. Nowadays is not considered to be a good thing. Modern language features like <code>let/const</code> do not make friends with it, but old ones are still compatible.</p>
</div></div>
<h2 id="chapter-416">
Uses of “window”</h2>
<p>In server-side environments like Node.JS, the <code>global</code> object is used exceptionally rarely. Probably it would be fair to say “never”.</p>
<p>In-browser <code>window</code> is sometimes used though.</p>
<p>Usually, it's not a good idea to use it, but here are some examples you can meet.</p>
<ol>
<li>
<p>To access exactly the global variable if the function has the local one with the same name.</p>
<div data-trusted="0" class="code-example" data-no-strict="1" data-refresh="1" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var user = "Global";

function sayHi() {
  var user = "Local";

  alert(window.user); // Global
}

sayHi();</code></pre>
        </div>
      </div>
      
      </div><p>Such use is a workaround. Would be better to name variables differently, that won't require use to write the code it this way. And please note <code>"var"</code> before <code>user</code>. The trick doesn't work with <code>let</code> variables.</p>
</li>
<li>
<p>To check if a certain global variable or a builtin exists.</p>
<p>For instance, we want to check whether a global function <code>XMLHttpRequest</code> exists.</p>
<p>We can't write <code>if (XMLHttpRequest)</code>, because if there's no <code>XMLHttpRequest</code>, there will be an error (variable not defined).</p>
<p>But we can read it from <code>window.XMLHttpRequest</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (window.XMLHttpRequest) {
  alert('XMLHttpRequest exists!')
}</code></pre>
        </div>
      </div>
      
      </div><p>If there is no such global function then <code>window.XMLHttpRequest</code> is just a non-existing object property. That's <code>undefined</code>, no error, so it works.</p>
<p>We can also write the test without <code>window</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (typeof XMLHttpRequest == 'function') {
  /* is there a function XMLHttpRequest? */
}</code></pre>
        </div>
      </div>
      
      </div><p>This doesn't use <code>window</code>, but is (theoretically) less reliable, because <code>typeof</code> may use a local XMLHttpRequest, and we want the global one.</p>
</li>
<li>
<p>To take the variable from the right window. That's probably the most valid use case.</p>
<p>A browser may open multiple windows and tabs. A window may also embed another one in <code>&lt;iframe&gt;</code>. Every browser window has its own <code>window</code> object and global variables. JavaScript allows windows that come from the same site (same protocol, host, port) to access variables from each other.</p>
<p>That use is a little bit beyond our scope for now, but it looks like:</p>
<div data-trusted="1" class="code-example" data-highlight-block="9-9,11-11">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="/" id="iframe"&gt;&lt;/iframe&gt;

&lt;script&gt;
  alert( innerWidth ); // get innerWidth property of the current window (browser only)
  alert( Array ); // get Array of the current window (javascript core builtin)

  // when the iframe loads...
  iframe.onload = function() {
    // get width of the iframe window
    alert( iframe.contentWindow.innerWidth );
    // get the builtin Array from the iframe window
    alert( iframe.contentWindow.Array );
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Here, first two alerts use the current window, and the latter two take variables from <code>iframe</code> window. Can be any variables if <code>iframe</code> originates from the same protocol/host/port.</p>
</li>
</ol>
<h2 id="chapter-417">
“this” and global object</h2>
<p>Sometimes, the value of <code>this</code> is exactly the global object. That's rarely used, but some scripts rely on that.</p>
<ol>
<li>
<p>In the browser, the value of <code>this</code> in the global area is <code>window</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// outside of functions
alert( this === window ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Other, non-browser environments, may use another value for <code>this</code> in such cases.</p>
</li>
<li>
<p>When a function with <code>this</code> is called in non-strict mode, it gets the global object as <code>this</code>:</p>
<div data-trusted="1" class="code-example" data-no-strict="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// not in strict mode (!)
function f() {
  alert(this); // [object Window]
}

f(); // called without an object</code></pre>
        </div>
      </div>
      
      </div><p>By specification, <code>this</code> in this case must be the global object, even in non-browser environments like Node.JS. That's for compatibility with old scripts, in strict mode <code>this</code> would be <code>undefined</code>.</p>
</li>
</ol>

<h6 id="chapter-418"></h6>
<h1 class="main__header-title" id="chapter-419">Function object, NFE</h1>
<p>As we already know, functions in JavaScript are values.</p>
<p>Every value in JavaScript has the type. What type of value is a function?</p>
<p>In JavaScript, a function is an object.</p>
<p>A good way to imagine functions is as callable “action objects”. We can not only call them, but also treat them as objects: add/remove properties, pass by reference etc.</p>
<h2 id="chapter-420">
The “name” property</h2>
<p>Function objects contain few sometimes-useable properties.</p>
<p>For instance, a function name is accessible as the “name” property:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert("Hi");
}

alert(sayHi.name); // sayHi</code></pre>
        </div>
      </div>
      
      </div><p>What's more funny, the name-assigning logic is smart. It also sticks the right name to function that are used in assignments:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function() {
  alert("Hi");
}

alert(sayHi.name); // sayHi (works!)</code></pre>
        </div>
      </div>
      
      </div><p>Also works if the assignment is done via a default value:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(sayHi = function() {}) {
  alert(sayHi.name); // sayHi (works!)
}

f();</code></pre>
        </div>
      </div>
      
      </div><p>In the specification, this feature is called a “contextual name”. If the function does not provide one, then in an assignment it is figured out from the context.</p>
<p>Object methods have names too:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {

  sayHi() {
    // ...
  },

  sayBye: function() {
    // ...
  }

}

alert(user.sayHi.name); // sayHi
alert(user.sayBye.name); // sayBye</code></pre>
        </div>
      </div>
      
      </div><p>There's no magic though. There are cases when there's no way to figure out the right name.</p>
<p>Then it's empty, like here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// function created inside array
let arr = [function() {}];

alert( arr[0].name ); // &lt;empty string&gt;
// the engine has no way to set up the right name, so there is none</code></pre>
        </div>
      </div>
      
      </div><p>In practice, most functions do have a name.</p>
<h2 id="chapter-421">
The “length” property</h2>
<p>There is another built-in property “length” that returns the number of function parameters, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f1(a) {}
function f2(a, b) {}
function many(a, b, ...more) {}

alert(f1.length); // 1
alert(f2.length); // 2
alert(many.length); // 2</code></pre>
        </div>
      </div>
      
      </div><p>Here we can see that rest parameters are not counted.</p>
<p>The <code>length</code> property is sometimes used for introspection in functions that operate on other functions.</p>
<p>For instance, in the code below <code>ask</code> function accepts a <code>question</code> to ask and an arbitrary number of <code>handler</code> functions to call.</p>
<p>When a user answers, it calls the handlers. We can pass two kinds of handlers:</p>
<ul>
<li>A zero-argument function, then it is only called for a positive answer.</li>
<li>A function with arguments, then it is called in any case and gets the answer.</li>
</ul>
<p>The idea is that we have a simple no-arguments handler syntax for positive cases (most frequent variant), but allow to provide universal handlers as well.</p>
<p>To call <code>handlers</code> the right way, we examine the <code>length</code> property:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function ask(question, ...handlers) {
  let isYes = confirm(question);

  for(let handler of handlers) {
    if (handler.length == 0) {
      if (isYes) handler();
    } else {
      handler(isYes);
    }
  }

}

// for positive answer, both handlers are called
// for negative answer, only the second one
ask("Question?", () =&gt; alert('You said yes'), result =&gt; alert(result));</code></pre>
        </div>
      </div>
      
      </div><p>This is a particular case of so-called 
<a href="https://en.wikipedia.org/wiki/Polymorphism_(computer_science)">polymorphism</a> – treating arguments differently depending on their type or, in our case depending on the <code>length</code>. The idea does have a use in JavaScript libraries.</p>
<h2 id="chapter-422">
Custom properties</h2>
<p>We can also add properties of our own.</p>
<p>Here we add the <code>counter</code> property to track the total calls count:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert("Hi");

  // let's count how many times we run
  sayHi.counter++;
}
sayHi.counter = 0; // initial value

sayHi(); // Hi
sayHi(); // Hi

alert( `Called ${sayHi.counter} times` ); // Called 2 times</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">A property is not a variable</span></div>
            <div class="important__content"><p>A property assigned to a function like <code>sayHi.counter = 0</code> does <em>not</em> define a local variable <code>counter</code> inside it. In other words, a property <code>counter</code> and a variable <code>let counter</code> are two unrelated things.</p>
<p>We can treat a function as an object, store properties in it, but that has no effect on its execution. Variables never use function properties and vice versa. These are just parallel words.</p>
</div></div>
<p>Function properties can replace the closure sometimes. For instance, we can rewrite the counter example from the chapter 
<a href="http://javascript.info/closure">Closure</a> to use a function property:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeCounter() {
  // instead of:
  // let count = 0

  function counter() {
    return counter.count++;
  };

  counter.count = 0;

  return counter;
}

let counter = makeCounter();
alert( counter() ); // 0
alert( counter() ); // 1</code></pre>
        </div>
      </div>
      
      </div><p>The <code>count</code> is now stored in the function directly, not in its outer Lexical Environment.</p>
<p>Is it worse or better than using the closure?</p>
<p>The main difference is that if the value of <code>count</code> lives in an outer variable, then an external code is unable to access it. Only nested functions may modify it. And if it's bound to function, then such thing is possible:</p>
<div data-trusted="1" class="code-example" data-highlight-block="13-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeCounter() {

  function counter() {
    return counter.count++;
  };

  counter.count = 0;

  return counter;
}

let counter = makeCounter();

counter.count = 10;
alert( counter() ); // 10</code></pre>
        </div>
      </div>
      
      </div><p>So it depends on our aims which variant to choose.</p>
<h2 id="chapter-423">
Named Function Expression</h2>
<p>Named Function Expression or, shortly, NFE, is a term for Function Expressions that have a name.</p>
<p>For instance, let's take an ordinary Function Expression:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function(who) {
  alert(`Hello, ${who}`);
};</code></pre>
        </div>
      </div>
      
      </div><p>…And add a name to it:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:21-25">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function func(who) {
  alert(`Hello, ${who}`);
};</code></pre>
        </div>
      </div>
      
      </div><p>Did we do anything sane here? What's the role of that additional <code>"func"</code> name?</p>
<p>First let's note, that we still have a Function Expression. Adding the name <code>"func"</code> after <code>function</code> did not make it a Function Declaration, because it is still created as a part of an assignment expression.</p>
<p>Adding such a name also did not break anything.</p>
<p>The function is still available as <code>sayHi()</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:21-25">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function func(who) {
  alert(`Hello, ${who}`);
};

sayHi("John"); // Hello, John</code></pre>
        </div>
      </div>
      
      </div><p>There are two special things about the name <code>func</code>:</p>
<ol>
<li>It allows to reference the function from inside itself.</li>
<li>It is not visible outside of the function.</li>
</ol>
<p>For instance, the function <code>sayHi</code> below re-calls itself with <code>"Guest"</code> if no <code>who</code> is provided:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4" data-highlight-inline="0:21-25">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function func(who) {
  if (who) {
    alert(`Hello, ${who}`);
  } else {
    func("Guest"); // use func to re-call itself
  }
};

sayHi(); // Hello, Guest

// But this won't work:
func(); // Error, func is not defined (not visible outside of the function)</code></pre>
        </div>
      </div>
      
      </div><p>Why do we use <code>func</code>? Maybe just use <code>sayHi</code> for the nested call?</p>
<p>Actually, in most cases we can:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function(who) {
  if (who) {
    alert(`Hello, ${who}`);
  } else {
    sayHi("Guest");
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>The problem with that code is that the value of <code>sayHi</code> may change. The function may go to another variable, and the code will start to give errors:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function(who) {
  if (who) {
    alert(`Hello, ${who}`);
  } else {
    sayHi("Guest"); // Error: sayHi is not a function
  }
};

let welcome = sayHi;
sayHi = null;

welcome(); // Error, the nested sayHi call doesn't work any more!</code></pre>
        </div>
      </div>
      
      </div><p>That happens because the function takes <code>sayHi</code> from its outer lexical environment. There's no local <code>sayHi</code>, so the outer variable is used. And at the moment of the call that outer <code>sayHi</code> is <code>null</code>.</p>
<p>The optional name which we can put into the Function Expression is exactly meant to solve this kind of problems.</p>
<p>Let's use it to fix the code:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4" data-highlight-inline="0:21-25">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = function func(who) {
  if (who) {
    alert(`Hello, ${who}`);
  } else {
    func("Guest"); // Now all fine
  }
};

let welcome = sayHi;
sayHi = null;

welcome(); // Hello, Guest (nested call works)</code></pre>
        </div>
      </div>
      
      </div><p>Now it works, because the name <code>"func"</code> is function-local. It is not taken from outside (and not visible there). The specification guarantees that it always references the current function.</p>
<p>The outer code still has it's variable <code>sayHi</code> or <code>welcome</code> later. And <code>func</code> is an “internal function name”, how it calls itself privately.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">There's no such thing for Function Declaration</span></div>
            <div class="important__content"><p>The “internal name” feature described here is only available for Function Expressions, not to Function Declarations. For Function Declarations, there's just no syntax possibility to add a one more “internal” name.</p>
<p>Sometimes, when we need a reliable internal name, it's the reason to rewrite a Function Declaration to Named Function Expression form.</p>
</div></div>
<h2 id="chapter-424">
Summary</h2>
<p>Functions are objects.</p>
<p>Here we covered their properties:</p>
<ul>
<li><code>name</code> – the function name. Exists not only when given in the function definition, but also for assignments and object properties.</li>
<li><code>length</code> – the number of arguments in the function definition. Rest parameters are not counted.</li>
</ul>
<p>If the function is declared as a Function Expression (not in the main code flow), and it carries the name, then it is called Named Function Expression. The name can be used inside to reference itself, for recursive calls or such.</p>
<p>Also, functions may carry additional properties. Many well-known JavaScript libraries make a great use of this feature.</p>
<p>They create a “main” function and attach many other “helper” functions to it. For instance, the 
<a href="https://jquery.com">jquery</a> library creates a function named <code>$</code>. The 
<a href="https://lodash.com">lodash</a> library creates a function <code>_</code>. And then adds <code>_.clone</code>, <code>_.keyBy</code> and other properties to (see the 
<a href="https://lodash.com/docs">docs</a> when you want learn more about them). Actually, they do it to less pollute the global space, so that a single library gives only one global variable. That lowers the chance of possible naming conflicts.</p>
<p>So, a function can do a useful job by itself and also carry a bunch of other functionality in properties.</p>
<div class="tasks"><h2 id="chapter-425" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#set-and-decrease-for-counter" name="set-and-decrease-for-counter" class="main__anchor">Set and decrease for counter</a></h3>
<a href="http://javascript.info/task/counter-inc-dec" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Modify the code of <code>makeCounter()</code> so that the counter can also decrease and set the number:</p>
<ul>
<li><code>counter()</code> should return the next number (as before).</li>
<li><code>counter.set(value)</code> should set the <code>count</code> to <code>value</code>.</li>
<li><code>counter.decrease(value)</code> should decrease the <code>count</code> by 1.</li>
</ul>
<p>See the sandbox code for the complete usage example.</p>
<p>P.S. You can use either a closure or the function property to keep the current count. Or write both variants.</p>
<p>
<a href="http://plnkr.co/edit/KNXgaGgXsHDySyBhHmp5?p=preview" target="_blank" data-plunk-id="KNXgaGgXsHDySyBhHmp5">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution uses <code>count</code> in the local variable, but addition methods are written right into the <code>counter</code>. They share the same outer lexical environment and also can access the current <code>count</code>.</p>
<p>
<a href="http://plnkr.co/edit/tosTNMw0flKioNx8mPHd?p=preview" target="_blank" data-plunk-id="tosTNMw0flKioNx8mPHd">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sum-with-an-arbitrary-amount-of-brackets" name="sum-with-an-arbitrary-amount-of-brackets" class="main__anchor">Sum with an arbitrary amount of brackets</a></h3>
<a href="http://javascript.info/task/sum-many-brackets" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 2</span></div><div class="task__content"><p>Write function <code>sum</code> that would work like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">sum(1)(2) == 3; // 1 + 2
sum(1)(2)(3) == 6; // 1 + 2 + 3
sum(5)(-1)(2) == 6
sum(6)(-1)(-2)(-3) == 0
sum(0)(1)(2)(3)(4)(5) == 15</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Hint: you may need to setup custom object to primitive conversion for your function.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><ol>
<li>For the whole thing to work <em>anyhow</em>, the result of <code>sum</code> must be function.</li>
<li>That function must keep in memory the current value between calls.</li>
<li>According to the task, the function must become the number when used in <code>==</code>. Functions are objects, so the conversion happens as described in the chapter 
<a href="http://javascript.info/object-toprimitive">Object to primitive conversion</a>, and we can provide our own method that returns the number.</li>
</ol>
<p>Now the code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sum(a) {

  let currentSum = a;

  function f(b) {
    currentSum += b;
    return f;
  }

  f.toString = function() {
    return currentSum;
  };

  return f;
}

alert( sum(1)(2) ); // 3
alert( sum(5)(-1)(2) ); // 6
alert( sum(6)(-1)(-2)(-3) ); // 0
alert( sum(0)(1)(2)(3)(4)(5) ); // 15</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the <code>sum</code> function actually works only once. It returns function <code>f</code>.</p>
<p>Then, on each subsequent call, <code>f</code> adds its parameter to the sum <code>currentSum</code>, and returns itself.</p>
<p><strong>There is no recursion in the last line of <code>f</code>.</strong></p>
<p>Here is what recursion looks like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(b) {
  currentSum += b;
  return f(); // &lt;-- recursive call
}</code></pre>
        </div>
      </div>
      
      </div><p>And in our case, we just return the function, without calling it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(b) {
  currentSum += b;
  return f; // &lt;-- does not call itself, returns itself
}</code></pre>
        </div>
      </div>
      
      </div><p>This <code>f</code> will be used in the next call, again return itself, so many times as needed. Then, when used as a number or a string – the <code>toString</code> returns the <code>currentSum</code>. We could also use <code>Symbol.toPrimitive</code> or <code>valueOf</code> here for the conversion.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-426"></h6>
<h1 class="main__header-title" id="chapter-427">The "new Function" syntax</h1>
<p>There's one more way to create a function. It's rarely used, but sometimes there's no alternative.</p>


<h2 id="chapter-428">
The syntax</h2>
<p>The syntax for creating a function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let func = new Function ([arg1[, arg2[, ...argN]],] functionBody)</code></pre>
        </div>
      </div>
      
      </div><p>In other words, function parameters (or, more precise, names for them) go first, and the body is the last. All arguments are strings.</p>
<p>That's easy to understand by example.</p>
<p>For instance, here's a function with two arguments:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sum = new Function('a', 'b', 'return a + b');

alert( sum(1, 2) ); // 3</code></pre>
        </div>
      </div>
      
      </div><p>If there are no arguments, then there's only one single argument, function body:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayHi = new Function('alert("Hello")');

sayHi(); // Hello</code></pre>
        </div>
      </div>
      
      </div><p>The major difference from other ways we've seen – the function is created literally from a string, that is passed at run time.</p>
<p>All previous declarations required us, programmers, to write the function code in the script.</p>
<p>But <code>new Function</code> allows to turn any string into a function, for example we can receive a new function from the server and then execute it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = ... receive the code from the server dynamically ...

let func = new Function(str);
func();</code></pre>
        </div>
      </div>
      
      </div><p>It is used in very specific cases, like when we receive the code from the server, or to dynamically compile a function from a template. The need for that usually arises at advanced stages of development.</p>
<h2 id="chapter-429">
The closure</h2>
<p>Usually, a function remembers where it was born in the special property <code>[[Environment]]</code>. It references the Lexical Environment from where it's created.</p>
<p>But when a function is created using <code>new Function</code>, its <code>[[Environment]]</code> references not the current Lexical Environment, but instead the global one.</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getFunc() {
  let value = "test";

  let func = new Function('alert(value)');

  return func;
}

getFunc()(); // error: value is not defined</code></pre>
        </div>
      </div>
      
      </div><p>Compare it with the regular behavior:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3" data-highlight-inline="8:16-22">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function getFunc() {
  let value = "test";

  let func = function() { alert(value); };

  return func;
}

getFunc()(); // "test", from the Lexical Environment of getFunc</code></pre>
        </div>
      </div>
      
      </div><p>This special feature of <code>new Function</code> looks strange, but appears very useful in practice.</p>
<p>Imagine that we really have to create a function from the string. The code of that function is not known at the time of writing the script (that's why we don't use regular functions), but will be known in the process of execution. We may receive it from the server or from another source.</p>
<p>Our new function needs to interact with the main script.</p>
<p>Maybe we want it to be able to access outer local variables?</p>
<p>But the problem is that before JavaScript is published to production, it's compressed using a <em>minifier</em> – a special program that shrinks code by removing extra comments, spaces and – what's important, renames local variables into shorter ones.</p>
<p>For instance, if a function has <code>let userName</code>, minifier replaces it <code>let a</code> (or another letter if this one is occupied), and does it everywhere. That's usually a safe thing to do, because the variable is local, nothing outside the function can access it. And inside the function minifier replaces every mention of it. Minifiers are smart, they analyze the code structure, not just find-and-replace, so that's ok.</p>
<p>…But if <code>new Function</code> could access outer variables, then it would be unable to find <code>userName</code>.</p>
<p><strong>Even if we could access outer lexical environment in <code>new Function</code>, we would have problems with minifiers.</strong></p>
<p>The “special feature” of <code>new Function</code> saves us from mistakes.</p>
<p>And it enforces better code. If we need to pass something to a function, created by <code>new Function</code>, we should pass it explicitly as arguments.</p>
<p>The “sum” function actually does that right:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0,4-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sum = new Function('a', 'b', ' return a + b; ');

let a = 1, b = 2;

// outer values are passed as arguments
alert( sum(a, b) ); // 3</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-430">
Summary</h2>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let func = new Function(arg1, arg2, ..., body);</code></pre>
        </div>
      </div>
      
      </div><p>For historical reasons, arguments can also be given as a comma-separated list.</p>
<p>These three mean the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Function('a', 'b', ' return a + b; '); // basic syntax
new Function('a,b', ' return a + b; '); // comma-separated
new Function('a , b', ' return a + b; '); // comma-separated with spaces</code></pre>
        </div>
      </div>
      
      </div><p>Functions created with <code>new Function</code>, have <code>[[Environment]]</code> referencing the global Lexical Environment, not the outer one. Hence, they can not use outer variables. But that's actually good, because it saves us from errors. Explicit parameters passing is a much better thing architecturally and has no problems with minifiers.</p>

<h6 id="chapter-431"></h6>
<h1 class="main__header-title" id="chapter-432">Scheduling: setTimeout and setInterval</h1>
<p>We may decide to execute a function not right now, but at a certain time later. That's called “scheduling a call”.</p>
<p>There are two methods for it:</p>
<ul>
<li><code>setTimeout</code> allows to run a function once after the interval of time.</li>
<li><code>setInterval</code> allows to run a function regularly with the interval between the runs.</li>
</ul>
<p>These methods are not a part of JavaScript specification. But most environments have the internal scheduler and provide these methods. In particular, they are supported in all browsers and Node.JS.</p>


<h2 id="chapter-433">
setTimeout</h2>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let timerId = setTimeout(func|code, delay[, arg1, arg2...])</code></pre>
        </div>
      </div>
      
      </div><p>Parameters:</p>
<dl>
<dt><code>func|code</code></dt>
<dd>Function or a string of code to execute.
Usually, that's a function. For historical reasons, a string of code can be passed, but that's not recommended.</dd>
<dt><code>delay</code></dt>
<dd>The delay before run, in milliseconds (1000 ms = 1 second).</dd>
<dt><code>arg1</code>, <code>arg2</code>…</dt>
<dd>Arguments for the function (not supported in IE9-)</dd>
</dl>
<p>For instance, this code calls <code>sayHi()</code> after one second:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert('Hello');
}

setTimeout(sayHi, 1000);</code></pre>
        </div>
      </div>
      
      </div><p>With arguments:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi(phrase, who) {
  alert( phrase + ', ' + who );
}

setTimeout(sayHi, 1000, "Hello", "John"); // Hello, John</code></pre>
        </div>
      </div>
      
      </div><p>If the first argument is a string, then JavaScript creates a function from it.</p>
<p>So, this will also work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">setTimeout("alert('Hello')", 1000);</code></pre>
        </div>
      </div>
      
      </div><p>But using strings is not recommended, use functions instead of them, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">setTimeout(() =&gt; alert('Hello'), 1000);</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Pass a function, but don't run it</span></div>
            <div class="important__content"><p>Novice developers sometimes make a mistake by adding brackets <code>()</code> after the function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// wrong!
setTimeout(sayHi(), 1000);</code></pre>
        </div>
      </div>
      
      </div><p>That doesn't work, because <code>setTimeout</code> expects a reference to function. And here <code>sayHi()</code> runs the function, and the <em>result of its execution</em> is passed to <code>setTimeout</code>. In our case the result of <code>sayHi()</code> is <code>undefined</code> (the function returns nothing), so nothing is scheduled.</p>
</div></div>
<h3>
Canceling with clearTimeout</a></h3><p>A call to <code>setTimeout</code> returns a “timer identifier” <code>timerId</code> that we can use to cancel the execution.</p>
<p>The syntax to cancel:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let timerId = setTimeout(...);
clearTimeout(timerId);</code></pre>
        </div>
      </div>
      
      </div><p>In the code below we schedule the function and then cancel it (changed our mind). As a result, nothing happens:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let timerId = setTimeout(() =&gt; alert("never happens"), 1000);
alert(timerId); // timer identifier

clearTimeout(timerId);
alert(timerId); // same identifier (doesn't become null after canceling)</code></pre>
        </div>
      </div>
      
      </div><p>As we can see from <code>alert</code> output, in a browser the timer identifier is a number. In other environments, that can be something else. For instance, Node.JS returns a timer object with additional methods.</p>
<p>Again, there is no universal specification for these methods, so that's fine.</p>
<p>For browsers, timers are described in the 
<a href="https://www.w3.org/TR/html5/webappapis.html#timers">timers section</a> of HTML5 standard.</p>
<h2 id="chapter-434">
setInterval</h2>
<p>Method <code>setInterval</code> has the same syntax as <code>setTimeout</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let timerId = setInterval(func|code, delay[, arg1, arg2...])</code></pre>
        </div>
      </div>
      
      </div><p>All arguments have the same meaning. But unlike <code>setTimeout</code> it runs the function not only once, but regularly after the given interval of time.</p>
<p>To stop further calls, we should call <code>clearInterval(timerId)</code>.</p>
<p>The following example will show the message every 2 seconds. After 5 seconds, the output is stopped:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// repeat with the interval of 2 seconds
let timerId = setInterval(() =&gt; alert('tick'), 2000);

// after 5 seconds stop
setTimeout(() =&gt; { clearInterval(timerId); alert('stop'); }, 5000);</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Modal windows freeze time in Chrome/Opera/Safari</span></div>
            <div class="important__content"><p>In browsers IE and Firefox the internal timer continues “ticking” while showing <code>alert/confirm/prompt</code>, but in Chrome, Opera and Safari the internal timer becomes “frozen”.</p>
<p>So if you run the code above and don't dismiss the <code>alert</code> window for some time, then in Firefox/IE next <code>alert</code> will be shown immediately as you do it (2 seconds passed from the previous invocation), and in Chrome/Opera/Safari – after 2 more seconds (timer did not tick during the <code>alert</code>).</p>
</div></div>
<h2 id="chapter-435">
Recursive setTimeout</h2>
<p>There are two ways of running something regularly.</p>
<p>One is <code>setInterval</code>. The other one is a recursive <code>setTimeout</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">/** instead of:
let timerId = setInterval(() =&gt; alert('tick'), 2000);
*/

let timerId = setTimeout(function tick() {
  alert('tick');
  timerId = setTimeout(tick, 2000); // (*)
}, 2000);</code></pre>
        </div>
      </div>
      
      </div><p>The <code>setTimeout</code> above schedules next call right at the end of the current one <code>(*)</code>.</p>
<p>Recursive <code>setTimeout</code> is more flexible method than <code>setInterval</code>. This way the next call may be scheduled differently, depending on the results of the current one.</p>
<p>For instance, we need to write a service that every 5 seconds sends a request to server asking for data, but in case the server is overloaded, it should increase the interval to 10, 20, 40 seconds…</p>
<p>Here's the pseudocode:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let delay = 5000;

let timerId = setTimeout(function request() {
  ...send request...

  if (request failed due to server overload) {
    // increase the interval to the next run
    delay *= 2;
  }

  timerId = setTimeout(request, delay);

}, delay);</code></pre>
        </div>
      </div>
      
      </div><p>And if we regularly have CPU-hungry tasks, then we can measure the time taken by the execution and plan the next call sooner or later.</p>
<p><strong>Recursive <code>setTimeout</code> guarantees a delay between the executions, <code>setInterval</code> – does not.</strong></p>
<p>Let's compare two code fragments. The first one uses <code>setInterval</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 1;
setInterval(function() {
  func(i);
}, 100);</code></pre>
        </div>
      </div>
      
      </div><p>The second one uses recursive <code>setTimeout</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 1;
setTimeout(function run() {
  func(i);
  setTimeout(run, 100);
}, 100);</code></pre>
        </div>
      </div>
      
      </div><p>For <code>setInterval</code> the internal scheduler will run <code>func(i)</code> every 100ms:</p>
      <img src="http://javascript.info/article/settimeout-setinterval/setinterval-interval.png">
<p>Did you notice?…</p>
<p><strong>The real delay between <code>func</code> calls for <code>setInterval</code> is less than in the code!</strong></p>
<p>That's natural, because the time is taken by <code>func</code> execution “consumes” a part of the interval.</p>
<p>It is possible that <code>func</code> execution turns out to be longer than we expected and takes more than 100ms.</p>
<p>In this case the engine waits for <code>func</code> to complete, then checks the scheduler and if the time is up, then runs it again <em>immediately</em>.</p>
<p>In the edge case, if the function always executes longer than <code>delay</code> ms, then the calls will happen without pause at all.</p>
<p>And here is the picture for recursive <code>setTimeout</code>:</p>
      <img src="http://javascript.info/article/settimeout-setinterval/settimeout-interval.png">
<p><strong>Recursive <code>setTimeout</code> guarantees the fixed delay (here 100ms).</strong></p>
<p>That's because a new call is planned at the end of the previous one.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Garbage collection</span></div>
            <div class="important__content"><p>When a function is passed in <code>setInterval/setTimeout</code>, an internal reference is created to it and saved in the scheduler. It prevents the function from being garbage collected, even if there are no other references to it.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// the function stays in memory until the scheduler calls it
setTimeout(function() {...}, 100);</code></pre>
        </div>
      </div>
      
      </div><p>For <code>setInterval</code> the function stays in memory until <code>clearInterval</code> is called.</p>
<p>There's a side-effect. A function references the outer lexical environment, so, while it lives, outer variables live too. They may take much more memory than the function itself. So when we don't need the scheduled function anymore, it's better to cancel it, even if it's very small.</p>
</div></div>
<h2 id="chapter-436">
setTimeout(…,0)</h2>
<p>There's a special use case: <code>setTimeout(func, 0)</code>.</p>
<p>This schedules the execution of <code>func</code> as soon as possible. But scheduler will invoke it only after the current code is complete.</p>
<p>So the function is scheduled to run “right after” the current code. In other words, <em>asynchronously</em>.</p>
<p>For instance, this outputs “Hello”, then immediately “World”:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">setTimeout(() =&gt; alert("World"), 0);

alert("Hello");</code></pre>
        </div>
      </div>
      
      </div><p>The first line “puts the call into calendar after 0ms”. But the scheduler will only “check the calendar” after the current code is complete, so <code>"Hello"</code> is first, and <code>"World"</code> – after it.</p>
<h3>
Splitting CPU-hungry tasks</a></h3><p>There's a trick to split CPU-hungry task using <code>setTimeout</code>.</p>
<p>For instance, syntax highlighting script (used to colorize code examples on this page) is quite CPU-heavy. To highlight the code, it performs the analysis, creates many colored elements, adds them to the document – for a big text that takes a lot. It may even cause the browser to “hang”, that's unacceptable.</p>
<p>So we can split the long text to pieces. First 100 lines, then plan another 100 lines using <code>setTimeout(...,0)</code>, and so on.</p>
<p>For clarity, let's take a simpler example for consideration. We have a function to count from <code>1</code> to <code>1000000000</code>.</p>
<p>If you run it, the CPU will hang. For server-side JS that's clearly noticeable, and if you are running it in-browser, then try to click other buttons on the page – you'll see that whole JavaScript actually is paused, no other actions work until it finishes.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

let start = Date.now();

function count() {

  // do a heavy job
  for (let j = 0; j &lt; 1e9; j++) {
    i++;
  }

  alert("Done in " + (Date.now() - start) + 'ms');
}

count();</code></pre>
        </div>
      </div>
      
      </div><p>The browser may even show “the script takes too long” warning (but hopefully won't, the number is not very big).</p>
<p>Let's split the job using the nested <code>setTimeout</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

let start = Date.now();

function count() {

  // do a piece of the heavy job (*)
  do {
    i++;
  } while (i % 1e6 != 0);

  if (i == 1e9) {
    alert("Done in " + (Date.now() - start) + 'ms');
  } else {
    setTimeout(count, 0); // schedule the new call (**)
  }

}

count();</code></pre>
        </div>
      </div>
      
      </div><p>Now the browser UI is fully functional during the “counting” process.</p>
<p>We do a part of the job <code>(*)</code>:</p>
<ol>
<li>First run: <code>i=1...1000000</code>.</li>
<li>Second run: <code>i=1000001..2000000</code>.</li>
<li>…and so on, the <code>while</code> checks if <code>i</code> is evenly divided by <code>100000</code>.</li>
</ol>
<p>Then the next call is scheduled in <code>(*)</code> if we're not done yet.</p>
<p>Pauses between <code>count</code> executions provide just enough “breath” for the JavaScript engine to do something else, to react on other user actions.</p>
<p>The notable thing is that both variants: with and without splitting the job by <code>setTimeout</code> – are comparable in speed. There's no much difference in the overall counting time.</p>
<p>To make them closer let's make an improvement.</p>
<p>We'll move the scheduling in the beginning of the <code>count()</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

let start = Date.now();

function count() {

  // move the scheduling at the beginning
  if (i &lt; 1e9 - 1e6) {
    setTimeout(count, 0); // schedule the new call
  }

  do {
    i++;
  } while (i % 1e6 != 0);

  if (i == 1e9) {
    alert("Done in " + (Date.now() - start) + 'ms');
  }

}

count();</code></pre>
        </div>
      </div>
      
      </div><p>Now when we start to <code>count()</code> and know that we'll need to <code>count()</code> more – we schedule that immediately, before doing the job.</p>
<p>If you run it, easy to notice that it takes significantly less time.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Minimal delay of nested timers in-browser</span></div>
            <div class="important__content"><p>In the browser, there's a limitation of how often nested timers can run. The 
<a href="https://www.w3.org/TR/html5/webappapis.html#timers">HTML5 standard</a> says: “after five nested timers…, the interval is forced to be at least four milliseconds.”.</p>
<p>Let's demonstrate what it means by the example below. The <code>setTimeout</code> call in it re-schedules itself after <code>0ms</code>. Each call remembers the real time from the previous one in the <code>times</code> array. What the real delays look like? Let's see:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let start = Date.now();
let times = [];

setTimeout(function run() {
  times.push(Date.now() - start); // remember delay from the previous call

  if (start + 100 &lt; Date.now()) alert(times); // show the delays after 100ms
  else setTimeout(run, 0); // else re-schedule
}, 0);

// an example of the output:
// 1,1,1,1,9,15,20,24,30,35,40,45,50,55,59,64,70,75,80,85,90,95,100</code></pre>
        </div>
      </div>
      
      </div><p>First timers run immediately (just as written in the spec), and then the delay comes into play and we see <code>9, 15, 20, 24...</code>.</p>
<p>That limitation comes from ancient times and many scripts rely on it, so it exists for historical reasons.</p>
<p>For server-side JavaScript, that limitation does not exist, and there exist other ways to schedule an immediate asynchronous job, like 
<a href="https://nodejs.org/api/process.html">process.nextTick</a> and 
<a href="https://nodejs.org/api/timers.html">setImmediate</a> for Node.JS. So the notion is browser-specific only.</p>
</div></div>
<h3>
Allowing the browser to render</a></h3><p>Another benefit for in-browser scripts is that they can show a progress bar or something to the user. That's because the browser usually does all “repainting” after the script is complete.</p>
<p>So if we do a single huge function then even if it changes something, the changes are not reflected in the document till it finishes.</p>
<p>Here's the demo:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="progress"&gt;&lt;/div&gt;

&lt;script&gt;
  let i = 0;

  function count() {
    for (let j = 0; j &lt; 1e6; j++) {
      i++;
      // put the current i into the &lt;div&gt;
      // (we'll talk more about innerHTML in the specific chapter, should be obvious here)
      progress.innerHTML = i;
    }
  }

  count();
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>If you run it, the changes to <code>i</code> will show up after the whole count finishes.</p>
<p>And if we use <code>setTimeout</code> to split it into pieces then changes are applied in-between the runs, so this looks better:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="progress"&gt;&lt;/div&gt;

&lt;script&gt;
  let i = 0;

  function count() {

    // do a piece of the heavy job (*)
    do {
      i++;
      progress.innerHTML = i;
    } while (i % 1e3 != 0);

    if (i &lt; 1e9) {
      setTimeout(count, 0);
    }

  }

  count();
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Now the <code>&lt;div&gt;</code> shows increasing values of <code>i</code>.</p>
<h2 id="chapter-437">
Summary</h2>
<ul>
<li>Methods <code>setInterval(func, delay, ...args)</code> and <code>setTimeout(func, delay, ...args)</code> allow to run the <code>func</code> regularly/once after <code>delay</code> milliseconds.</li>
<li>To cancel the execution, we should call <code>clearInterval/clearTimeout</code> with the value returned by <code>setInterval/setTimeout</code>.</li>
<li>Nested <code>setTimeout</code> calls is a more flexible alternative to <code>setInterval</code>. Also they can guarantee the minimal time <em>between</em> the executions.</li>
<li>Zero-timeout scheduling <code>setTimeout(...,0)</code> is used to schedule the call “as soon as possible, but after the current code is complete”.</li>
</ul>
<p>Some use cases of <code>setTimeout(...,0)</code>:</p>
<ul>
<li>To split CPU-hungry tasks into pieces, so that the script doesn't “hang”</li>
<li>To let the browser do something else while the process is going on (paint the progress bar).</li>
</ul>
<p>Please note that all scheduling methods do not <em>guarantee</em> the exact delay. We should not rely on that in the scheduled code.</p>
<p>For example, the in-browser timer may slow down for a lot of reasons:</p>
<ul>
<li>The CPU is overloaded.</li>
<li>The browser tab is in the background mode.</li>
<li>The laptop is on battery.</li>
</ul>
<p>All that may increase the minimal timer resolution (the minimal delay) to 300ms or even 1000ms depending on the browser and settings.</p>
<div class="tasks"><h2 id="chapter-438" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#output-every-second" name="output-every-second" class="main__anchor">Output every second</a></h3>
<a href="http://javascript.info/task/output-numbers-100ms" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>printNumbers(from, to)</code> that outputs a number every second, starting from <code>from</code> and ending with <code>to</code>.</p>
<p>Make two variants of the solution.</p>
<ol>
<li>Using <code>setInterval</code>.</li>
<li>Using recursive <code>setTimeout</code>.</li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Using <code>setInterval</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function printNumbers(from, to) {
  let current = from;

  let timerId = setInterval(function() {
    alert(current);
    if (current == to) {
      clearInterval(timerId);
    }
    current++;
  }, 1000);
}

// usage:
printNumbers(5, 10);</code></pre>
        </div>
      </div>
      
      </div><p>Using recursive <code>setTimeout</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function printNumbers(from, to) {
  let current = from;

  setTimeout(function go() {
    alert(current);
    if (current &lt; to) {
      setTimeout(go, 1000);
    }
    current++;
  }, 1000);
}

// usage:
printNumbers(5, 10);</code></pre>
        </div>
      </div>
      
      </div><p>Note that in both solutions, there is an initial delay before the first output. Sometimes we need to add a line to make the first output immediately, that's easy to do.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-settimeout-with-setinterval" name="rewrite-settimeout-with-setinterval" class="main__anchor">Rewrite setTimeout with setInterval</a></h3>
<a href="http://javascript.info/task/rewrite-settimeout" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Here's the function that uses nested <code>setTimeout</code> to split a job into pieces.</p>
<p>Rewrite it to <code>setInterval</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

let start = Date.now();

function count() {

  if (i == 1000000000) {
    alert("Done in " + (Date.now() - start) + 'ms');
  } else {
    setTimeout(count, 0);
  }

  // a piece of heavy job
  for(let j = 0; j &lt; 1000000; j++) {
    i++;
  }

}

count();</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

let start = Date.now();

let timer = setInterval(count, 0);

function count() {

  for(let j = 0; j &lt; 1000000; j++) {
    i++;
  }

  if (i == 1000000000) {
    alert("Done in " + (Date.now() - start) + 'ms');
    cancelInterval(timer);
  }

}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-will-settimeout-show" name="what-will-settimeout-show" class="main__anchor">What will setTimeout show?</a></h3>
<a href="http://javascript.info/task/settimeout-result" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>In the code below there's a <code>setTimeout</code> call scheduled, then a heavy calculation is run, that takes more than 100ms to finish.</p>
<p>When the scheduled function will run?</p>
<ol>
<li>After the loop.</li>
<li>Before the loop.</li>
<li>In the beginning of the loop.</li>
</ol>
<p>What <code>alert</code> is going to show?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

setTimeout(() =&gt; alert(i), 100); // ?

// assume that the time to execute this function is &gt;100ms
for(let j = 0; j &lt; 100000000; j++) {
  i++;
}</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Any <code>setTimeout</code> will run only after the current code has finished.</p>
<p>The <code>i</code> will be the last one: <code>100000000</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

setTimeout(() =&gt; alert(i), 100); // 100000000

// assume that the time to execute this function is &gt;100ms
for(let j = 0; j &lt; 100000000; j++) {
  i++;
}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-439"></h6>
<h1 class="main__header-title" id="chapter-440">Decorators and forwarding, call/apply</h1>
<p>JavaScript gives exceptional flexibility when dealing with functions. They can be passed around, used as objects, and now we'll see how to <em>forward</em> calls between them and <em>decorate</em> them.</p>


<h2 id="chapter-441">
Transparent caching</h2>
<p>Let's say we have a function <code>slow(x)</code> which is CPU-heavy, but its results are stable. In other words, for the same <code>x</code> it always returns the same result.</p>
<p>If the function is called often, we may want to cache (remember) the results for different <code>x</code> to avoid spending extra-time on recalculations.</p>
<p>But instead of adding that functionality into <code>slow()</code> we'll create a wrapper. As we'll see, there are many benefits of doing so.</p>
<p>Here's the code, and explanations follow:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function slow(x) {
  // there can be a heavy CPU-intensive job here
  alert(`Called with ${x}`);
  return x;
}

function cachingDecorator(func) {
  let cache = new Map();

  return function(x) {
    if (cache.has(x)) { // if the result is in the map
      return cache.get(x); // return it
    }

    let result = func(x); // otherwise call func

    cache.set(x, result); // and cache (remember) the result
    return result;
  };
}

slow = cachingDecorator(slow);

alert( slow(1) ); // slow(1) is cached
alert( "Again: " + slow(1) ); // the same

alert( slow(2) ); // slow(2) is cached
alert( "Again: " + slow(2) ); // the same as the previous line</code></pre>
        </div>
      </div>
      
      </div><p>In the code above <code>cachingDecorator</code> is a <em>decorator</em>: a special function that takes another function and alters its behavior.</p>
<p>The idea is that we can call <code>cachingDecorator</code> for any function, and it will return the caching wrapper. That's great, because we can have many functions that could use such a feature, and all we need to do is to apply <code>cachingDecorator</code> to them.</p>
<p>By separating caching from the main function code we also keep the main code simpler.</p>
<p>Now let's get into details of how it works.</p>
<p>The result of <code>cachingDecorator(func)</code> is a “wrapper”: <code>function(x)</code> that “wraps” the call of <code>func(x)</code> into caching logic:</p>
      <img src="http://javascript.info/article/call-apply-decorators/decorator-makecaching-wrapper.png">
<p>As we can see, the wrapper returns the result of <code>func(x)</code> “as is”. From an outside code, the wrapped <code>slow</code> function still does the same. It just got a caching aspect added to its behavior.</p>
<p>To summarize, there are several benefits of using a separate <code>cachingDecorator</code> instead of altering the code of <code>slow</code> itself:</p>
<ul>
<li>The <code>cachingDecorator</code> is reusable. We can apply it to another function.</li>
<li>The caching logic is separate, it did not increase the complexity of <code>slow</code> itself (if there were any).</li>
<li>We can combine multiple decorators if needed (other decorators will follow).</li>
</ul>
<h2 id="chapter-442">
Using “func.call” for the context</h2>
<p>The caching decorator mentioned above is not suited to work with object methods.</p>
<p>For instance, in the code below <code>user.format()</code> stops working after the decoration:</p>
<div data-trusted="1" class="code-example" data-highlight-block="20-20,30-30">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// we'll make worker.slow caching
let worker = {
  someMethod() {
    return 1;
  },

  slow(x) {
    // actually, there can be a scary CPU-heavy task here
    alert("Called with " + x);
    return x * this.someMethod(); // (*)
  }
};

// same code as before
function cachingDecorator(func) {
  let cache = new Map();
  return function(x) {
    if (cache.has(x)) {
      return cache.get(x);
    }
    let result = func(x); // (**)
    cache.set(x, result);
    return result;
  };
}

alert( worker.slow(1) ); // the original method works

worker.slow = cachingDecorator(worker.slow); // now make it caching

alert( worker.slow(2) ); // Whoops! Error: Cannot read property 'someMethod' of undefined</code></pre>
        </div>
      </div>
      
      </div><p>The error occurs in the line <code>(*)</code> that tries to access <code>this.someMethod</code> and fails. Can you see why?</p>
<p>The reason is that the wrapper calls the original function as <code>func(x)</code> in the line <code>(**)</code>. And, when called like that, the function gets <code>this = undefined</code>.</p>
<p>We would observe a similar symptom if we tried to run:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let func = worker.slow;
func(2);</code></pre>
        </div>
      </div>
      
      </div><p>So, the wrapper passes the call to the original method, but without the context <code>this</code>. Hence the error.</p>
<p>Let's fix it.</p>
<p>There's a special built-in function method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call">func.call(context, …args)</a> that allows to call a function explicitly setting <code>this</code>.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">func.call(context, arg1, arg2, ...)</code></pre>
        </div>
      </div>
      
      </div><p>It runs <code>func</code> providing the first argument as <code>this</code>, and the next as the arguments.</p>
<p>To put it simply, these two calls do almost the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">func(1, 2, 3);
func.call(obj, 1, 2, 3)</code></pre>
        </div>
      </div>
      
      </div><p>They both call <code>func</code> with arguments <code>1</code>, <code>2</code> and <code>3</code>. The only difference is that <code>func.call</code> also sets <code>this</code> to <code>obj</code>.</p>
<p>As an example, in the code below we call <code>sayHi</code> in the context of different objects: <code>sayHi.call(user)</code> runs <code>sayHi</code> providing <code>this=user</code>, and the next line sets <code>this=admin</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert(this.name);
}

let user = { name: "John" };
let admin = { name: "Admin" };

// use call to pass different objects as "this"
sayHi.call( user ); // this = John
sayHi.call( admin ); // this = Admin</code></pre>
        </div>
      </div>
      
      </div><p>And here we use <code>call</code> to call <code>say</code> with the given context and phrase:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function say(phrase) {
  alert(this.name + ': ' + phrase);
}

let user = { name: "John" };

// user becomes this, and "Hello" becomes the first argument
say.call( user, "Hello" ); // John: Hello</code></pre>
        </div>
      </div>
      
      </div><p>In our case, we can use <code>call</code> in the wrapper to pass the context to the original function:</p>
<div data-trusted="1" class="code-example" data-highlight-block="17-17">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let worker = {
  someMethod() {
    return 1;
  },

  slow(x) {
    alert("Called with " + x);
    return x * this.someMethod(); // (*)
  }
};

function cachingDecorator(func) {
  let cache = new Map();
  return function(x) {
    if (cache.has(x)) {
      return cache.get(x);
    }
    let result = func.call(this, x); // "this" is passed correctly now
    cache.set(x, result);
    return result;
  };
}

worker.slow = cachingDecorator(worker.slow); // now make it caching

alert( worker.slow(2) ); // works
alert( worker.slow(2) ); // works, doesn't call the original (cached)</code></pre>
        </div>
      </div>
      
      </div><p>Now everything is fine.</p>
<p>To make it all clear, let's see more deeply how <code>this</code> is passed along:</p>
<ol>
<li>After the decoration <code>worker.slow</code> is now the wrapper <code>function (x) { ... }</code>.</li>
<li>So when <code>worker.slow(2)</code> is executed, the wrapper gets <code>2</code> as an argument and <code>this=worker</code> (it's the object before dot).</li>
<li>Inside the wrapper, assuming the result is not yet cached, <code>func.call(this, x)</code> passes the current <code>this</code> (<code>=worker</code>) and the current argument (<code>=2</code>) to the original method.</li>
</ol>
<h2 id="chapter-443">
Going multi-argument with “func.apply”</h2>
<p>Now let's make <code>cachingDecorator</code> even more universal. Till now it was working only with single-argument functions.</p>
<p>Now how to cache the multi-argument <code>worker.slow</code> method?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let worker = {
  slow(min, max) {
    return min + max; // scary CPU-hogger is assumed
  }
};

// should remember same-argument calls
worker.slow = cachingDecorator(worker.slow);</code></pre>
        </div>
      </div>
      
      </div><p>We have two tasks to solve here.</p>
<p>First is how to use both arguments <code>min</code> and <code>max</code> for the key in <code>cache</code> map. Previously, for a single argument <code>x</code> we could just <code>cache.set(x, result)</code> to save the result and <code>cache.get(x)</code> to retrieve it. But now we need to remember the result for a <em>combination of arguments</em> <code>(min,max)</code>. The native <code>Map</code> takes single value only as the key.</p>
<p>There are many solutions possible:</p>
<ol>
<li>Implement a new (or use a third-party) map-like data structure that is more versatile and allows multi-keys.</li>
<li>Use nested maps: <code>cache.set(min)</code> will be a <code>Map</code> that stores the pair <code>(max, result)</code>. So we can get <code>result</code> as <code>cache.get(min).get(max)</code>.</li>
<li>Join two values into one. In our particular case we can just use a string <code>"min,max"</code> as the <code>Map</code> key. For flexibility, we can allow to provide a <em>hashing function</em> for the decorator, that knows how to make one value from many.</li>
</ol>
<p>For many practical applications, the 3rd variant is good enough, so we'll stick to it.</p>
<p>The second task to solve is how to pass many arguments to <code>func</code>. Currently, the wrapper <code>function(x)</code> assumes a single argument, and <code>func.call(this, x)</code> passes it.</p>
<p>Here we can use another built-in method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply">func.apply</a>.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">func.apply(context, args)</code></pre>
        </div>
      </div>
      
      </div><p>It runs the <code>func</code> setting <code>this=context</code> and using an array-like object <code>args</code> as the list of arguments.</p>
<p>For instance, these two calls are almost the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">func(1, 2, 3);
func.apply(context, [1, 2, 3])</code></pre>
        </div>
      </div>
      
      </div><p>Both run <code>func</code> giving it arguments <code>1,2,3</code>. But <code>apply</code> also sets <code>this=context</code>.</p>
<p>For instance, here <code>say</code> is called with <code>this=user</code> and <code>messageData</code> as a list of arguments:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function say(time, phrase) {
  alert(`[${time}] ${this.name}: ${phrase}`);
}

let user = { name: "John" };

let messageData = ['10:00', 'Hello']; // become time and phrase

// user becomes this, messageData is passed as a list of arguments (time, phrase)
say.apply(user, messageData); // [10:00] John: Hello (this=user)</code></pre>
        </div>
      </div>
      
      </div><p>The only syntax difference between <code>call</code> and <code>apply</code> is that <code>call</code> expects a list of arguments, while <code>apply</code> takes an array-like object with them.</p>
<p>We already know the spread operator <code>...</code> from the chapter 
<a href="http://javascript.info/rest-parameters-spread-operator">Rest parameters and spread operator</a> that can pass an array (or any iterable) as a list of arguments. So if we use it with <code>call</code>, we can achieve almost the same as <code>apply</code>.</p>
<p>These two calls are almost equivalent:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-3">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let args = [1, 2, 3];

func.call(context, ...args); // pass an array as list with spread operator
func.apply(context, args);   // is same as using apply</code></pre>
        </div>
      </div>
      
      </div><p>If we look more closely, there's a minor difference between such uses of <code>call</code> and <code>apply</code>.</p>
<ul>
<li>The spread operator <code>...</code> allows to pass <em>iterable</em> <code>args</code> as the list to <code>call</code>.</li>
<li>The <code>apply</code> accepts only <em>array-like</em> <code>args</code>.</li>
</ul>
<p>So, these calls complement each other. Where we expect an iterable, <code>call</code> works, where we expect an array-like, <code>apply</code> works.</p>
<p>And if <code>args</code> is both iterable and array-like, like a real array, then we technically could use any of them, but <code>apply</code> will probably be faster, because it's a single operation. Most JavaScript engines internally optimize is better than a pair <code>call + spread</code>.</p>
<p>One of the most important uses of <code>apply</code> is passing the call to another function, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let wrapper = function() {
  return anotherFunction.apply(this, arguments);
};</code></pre>
        </div>
      </div>
      
      </div><p>That's called <em>call forwarding</em>. The <code>wrapper</code> passes everything it gets: the context <code>this</code> and arguments to <code>anotherFunction</code> and returns back its result.</p>
<p>When an external code calls such <code>wrapper</code>, it is indistinguishable from the call of the original function.</p>
<p>Now let's bake it all into the more powerful <code>cachingDecorator</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10,15-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let worker = {
  slow(min, max) {
    alert(`Called with ${min},${max}`);
    return min + max;
  }
};

function cachingDecorator(func, hash) {
  let cache = new Map();
  return function() {
    let key = hash(arguments); // (*)
    if (cache.has(key)) {
      return cache.get(key);
    }

    let result = func.apply(this, arguments); // (**)

    cache.set(key, result);
    return result;
  };
}

function hash(args) {
  return args[0] + ',' + args[1];
}

worker.slow = cachingDecorator(worker.slow, hash);

alert( worker.slow(3, 5) ); // works
alert( "Again " + worker.slow(3, 5) ); // same (cached)</code></pre>
        </div>
      </div>
      
      </div><p>Now the wrapper operates with any number of arguments.</p>
<p>There are two changes:</p>
<ul>
<li>In the line <code>(*)</code> it calls <code>hash</code> to create a single key from <code>arguments</code>. Here we use a simple “joining” function that turns arguments <code>(3, 5)</code> into the key <code>"3,5"</code>. More complex cases may require other hashing functions.</li>
<li>Then <code>(**)</code> uses <code>func.apply</code> to pass both the context and all arguments the wrapper got (no matter how many) to the original function.</li>
</ul>
<h2 id="chapter-444">
Borrowing a method</h2>
<p>Now let's make one more minor improvement in the hashing function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hash(args) {
  return args[0] + ',' + args[1];
}</code></pre>
        </div>
      </div>
      
      </div><p>As of now, it works only on two arguments. It would be better if it could glue any number of <code>args</code>.</p>
<p>The natural solution would be to use 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join">arr.join</a> method:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hash(args) {
  return args.join();
}</code></pre>
        </div>
      </div>
      
      </div><p>…Unfortunately, that won't work. Because we are calling <code>hash(arguments)</code> and <code>arguments</code> object is both iterable and array-like, but not a real array.</p>
<p>So calling <code>join</code> on it would fail, as we can see below:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hash() {
  alert( arguments.join() ); // Error: arguments.join is not a function
}

hash(1, 2);</code></pre>
        </div>
      </div>
      
      </div><p>Still, there's an easy way to use array join:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hash() {
  alert( [].join.call(arguments) ); // 1,2
}

hash(1, 2);</code></pre>
        </div>
      </div>
      
      </div><p>The trick is called <em>method borrowing</em>.</p>
<p>We take (borrow) a join method from a regular array <code>[].join</code>. And use <code>[].join.call</code> to run it in the context of <code>arguments</code>.</p>
<p>Why does it work?</p>
<p>That's because the internal algorithm of the native method <code>arr.join(glue)</code> is very simple.</p>
<p>Taken from the specification almost “as-is”:</p>
<ol>
<li>Let <code>glue</code> be the first argument or, if no arguments, then a comma <code>","</code>.</li>
<li>Let <code>result</code> be an empty string.</li>
<li>Append <code>this[0]</code> to <code>result</code>.</li>
<li>Append <code>glue</code> and <code>this[1]</code>.</li>
<li>Append <code>glue</code> and <code>this[2]</code>.</li>
<li>…Do so until <code>this.length</code> items are glued.</li>
<li>Return <code>result</code>.</li>
</ol>
<p>So, technically it takes <code>this</code> and joins <code>this[0]</code>, <code>this[1]</code> …etc together. It's intentionally written in a way that allows any array-like <code>this</code> (not a coincidence, many methods follow this practice). That's why it also works with <code>this=arguments</code>.</p>
<h2 id="chapter-445">
Summary</h2>
<p><em>Decorator</em> is a wrapper around a function that alters its behavior. The main job is still carried out by the function.</p>
<p>It is generally safe to replace a function or a method with a decorated one, except for one little thing. If the original function had properties on it, like <code>func.calledCount</code> or whatever, then the decorated one will not provide them. Because that is a wrapper. So one needs to be careful if one uses them. Some decorators provide their own properties.</p>
<p>Decorators can be seen as “features” or “aspects” that can be added to a function. We can add one or add many. And all this without changing its code!</p>
<p>To implement <code>cachingDecorator</code>, we studied methods:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call">func.call(context, arg1, arg2…)</a> – calls <code>func</code> with given context and arguments.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply">func.apply(context, args)</a> – calls <code>func</code> passing <code>context</code> as <code>this</code> and array-like <code>args</code> into a list of arguments.</li>
</ul>
<p>The generic <em>call forwarding</em> is usually done with <code>apply</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let wrapper = function() {
  return original.apply(this, arguments);
}</code></pre>
        </div>
      </div>
      
      </div><p>We also saw an example of <em>method borrowing</em> when we take a method from an object and <code>call</code> it in the context of another object. It is quite common to take array methods and apply them to arguments. The alternative is to use rest parameters object that is a real array.</p>
<p>There are many decorators there in the wild. Check how well you got them by solving the tasks of this chapter.</p>
<div class="tasks"><h2 id="chapter-446" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#spy-decorator" name="spy-decorator" class="main__anchor">Spy decorator</a></h3>
<a href="http://javascript.info/task/spy-decorator" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a decorator <code>spy(func)</code> that should return a wrapper that saves all calls to function in its <code>calls</code> property.</p>
<p>Every call is saved as an array of arguments.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function work(a, b) {
  alert( a + b ); // work is an arbitrary function or method
}

work = spy(work);

work(1, 2); // 3
work(4, 5); // 9

for (let args of work.calls) {
  alert( 'call:' + args.join() ); // "call:1,2", "call:4,5"
}</code></pre>
        </div>
      </div>
      
      </div><p>P.S. That decorator is sometimes useful for unit-testing, it's advanced form is <code>sinon.spy</code> in 
<a href="http://sinonjs.org/">Sinon.JS</a> library.</p>
<p>
<a href="http://plnkr.co/edit/1CppV1N5lDbHlBDp3hfh?p=preview" target="_blank" data-plunk-id="1CppV1N5lDbHlBDp3hfh">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Here we can use <code>calls.push(args)</code> to store all arguments in the log and <code>f.apply(this, args)</code> to forward the call.</p>
<p>
<a href="http://plnkr.co/edit/5AdFdaIHwN7Y1cNAno8l?p=preview" target="_blank" data-plunk-id="5AdFdaIHwN7Y1cNAno8l">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#delaying-decorator" name="delaying-decorator" class="main__anchor">Delaying decorator</a></h3>
<a href="http://javascript.info/task/delay" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a decorator <code>delay(f, ms)</code> that delays each call of <code>f</code> by <code>ms</code> milliseconds.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(x) {
  alert(x);
}

// create wrappers
let f1000 = delay(f, 1000);
let f1500 = delay(f, 1500);

f1000("test"); // shows "test" after 1000ms
f1500("test"); // shows "test" after 1500ms</code></pre>
        </div>
      </div>
      
      </div><p>In other words, <code>delay(f, ms)</code> returns a "delayed by <code>ms</code>" variant of <code>f</code>.</p>
<p>In the code above, <code>f</code> is a function of a single argument, but your solution should pass all arguments and the context <code>this</code>.</p>
<p>
<a href="http://plnkr.co/edit/VgFmZ8tPKTzZkAtIq8RC?p=preview" target="_blank" data-plunk-id="VgFmZ8tPKTzZkAtIq8RC">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function delay(f, ms) {

  return function() {
    setTimeout(() =&gt; f.apply(this, arguments), ms);
  };

}</code></pre>
        </div>
      </div>
      
      </div><p>Please note how an arrow function is used here. As we know, arrow functions do not have own <code>this</code> and <code>arguments</code>, so <code>f.apply(this, arguments)</code> takes <code>this</code> and <code>arguments</code> from the wrapper.</p>
<p>If we pass a regular function, <code>setTimeout</code> would call it without arguments and <code>this=window</code> (in-browser), so we'd need to write a bit more code to pass them from the wrapper:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function delay(f, ms) {

  // added variables to pass this and arguments from the wrapper inside setTimeout
  return function(...args) {
    let savedThis = this;
    setTimeout(function() {
      f.apply(savedThis, args);
    }, ms);
  };

}</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/Vcto5bmuW2KIaNuCb7az?p=preview" target="_blank" data-plunk-id="Vcto5bmuW2KIaNuCb7az">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#debounce-decorator" name="debounce-decorator" class="main__anchor">Debounce decorator</a></h3>
<a href="http://javascript.info/task/debounce" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The result of <code>debounce(f, ms)</code> decorator should be a wrapper that passes the call to <code>f</code> at maximum once per <code>ms</code> milliseconds.</p>
<p>In other words, when we call a “debounced” function, it guarantees that all other future in the closest <code>ms</code> milliseconds will be ignored.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let f = debounce(alert, 1000);

f(1); // runs immediately
f(2); // ignored

setTimeout( () =&gt; f(3), 100); // ignored ( only 100 ms passed )
setTimeout( () =&gt; f(4), 1100); // runs
setTimeout( () =&gt; f(5), 1500); // ignored (less than 1000 ms from the last run)</code></pre>
        </div>
      </div>
      
      </div><p>In practice <code>debounce</code> is useful for functions that retrieve/update something when we know that nothing new can be done in such a short period of time, so it's better not to waste resources.</p>
<p>
<a href="http://plnkr.co/edit/8VerOrx8r9lb6NCgaCRy?p=preview" target="_blank" data-plunk-id="8VerOrx8r9lb6NCgaCRy">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function debounce(f, ms) {

  let isCooldown = false;

  return function() {
    if (isCooldown) return;

    f.apply(this, arguments);

    isCooldown = true;

    setTimeout(() =&gt; isCooldown = false, ms);
  };

}</code></pre>
        </div>
      </div>
      
      </div><p>The call to <code>debounce</code> returns a wrapper. There may be two states:</p>
<ul>
<li><code>isCooldown = false</code> – ready to run.</li>
<li><code>isCooldown = true</code> – waiting for the timeout.</li>
</ul>
<p>In the first call <code>isCooldown</code> is falsy, so the call proceeds, and the state changes to <code>true</code>.</p>
<p>While <code>isCooldown</code> is true, all other calls are ignored.</p>
<p>Then <code>setTimeout</code> reverts it to <code>false</code> after the given delay.</p>
<p>
<a href="http://plnkr.co/edit/0qqTJwPO4zMsGwwudsKG?p=preview" target="_blank" data-plunk-id="0qqTJwPO4zMsGwwudsKG">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#throttle-decorator" name="throttle-decorator" class="main__anchor">Throttle decorator</a></h3>
<a href="http://javascript.info/task/throttle" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a “throttling” decorator <code>throttle(f, ms)</code> – that returns a wrapper, passing the call to <code>f</code> at maximum once per <code>ms</code> milliseconds. Those calls that fall into the “cooldown” period, are ignored.</p>
<p><strong>The difference with <code>debounce</code> – if an ignored call is the last during the cooldown, then it executes at the end of the delay.</strong></p>
<p>Let's check the real-life application to better understand that requirement and to see where it comes from.</p>
<p><strong>For instance, we want to track mouse movements.</strong></p>
<p>In browser we can setup a function to run at every mouse micro-movement and get the pointer location as it moves. During an active mouse usage, this function usually runs very frequently, can be something like 100 times per second (every 10 ms).</p>
<p><strong>The tracking function should update some information on the web-page.</strong></p>
<p>Updating function <code>update()</code> is too heavy to do it on every micro-movement. There is also no sense in making it more often than once per 100ms.</p>
<p>So we'll assign <code>throttle(update, 100)</code> as the function to run on each mouse move instead of the original <code>update()</code>. The decorator will be called often, but <code>update()</code> will be called at maximum once per 100ms.</p>
<p>Visually, it will look like this:</p>
<ol>
<li>For the first mouse movement the decorated variant passes the call to <code>update</code>. That's important, the user sees our reaction to his move immediately.</li>
<li>Then as the mouse moves on, until <code>100ms</code> nothing happens. The decorated variant ignores calls.</li>
<li>At the end of <code>100ms</code> – one more <code>update</code> happens with the last coordinates.</li>
<li>Then, finally, the mouse stops somewhere. The decorated variant waits until <code>100ms</code> expire and then runs <code>update</code> runs with last coordinates. So, perhaps the most important, the final mouse coordinates are processed.</li>
</ol>
<p>A code example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(a) {
  console.log(a)
};

// f1000 passes calls to f at maximum once per 1000 ms
let f1000 = throttle(f, 1000);

f1000(1); // shows 1
f1000(2); // (throttling, 1000ms not out yet)
f1000(3); // (throttling, 1000ms not out yet)

// when 1000 ms time out...
// ...outputs 3, intermediate value 2 was ignored</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Arguments and the context <code>this</code> passed to <code>f1000</code> should be passed to the original <code>f</code>.</p>
<p>
<a href="http://plnkr.co/edit/py3KSMjPaPXGjfLrio3n?p=preview" target="_blank" data-plunk-id="py3KSMjPaPXGjfLrio3n">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function throttle(func, ms) {

  let isThrottled = false,
    savedArgs,
    savedThis;

  function wrapper() {

    if (isThrottled) { // (2)
      savedArgs = arguments;
      savedThis = this;
      return;
    }

    func.apply(this, arguments); // (1)

    isThrottled = true;

    setTimeout(function() {
      isThrottled = false; // (3)
      if (savedArgs) {
        wrapper.apply(savedThis, savedArgs);
        savedArgs = savedThis = null;
      }
    }, ms);
  }

  return wrapper;
}</code></pre>
        </div>
      </div>
      
      </div><p>A call to <code>throttle(func, ms)</code> returns <code>wrapper</code>.</p>
<ol>
<li>During the first call, the <code>wrapper</code> just runs <code>func</code> and sets the cooldown state (<code>isThrottled = true</code>).</li>
<li>In this state all calls memorized in <code>savedArgs/savedThis</code>. Please note that both the context and the arguments are equally important and should be memorized. We need them simultaneously to reproduce the call.</li>
<li>…Then after <code>ms</code> milliseconds pass, <code>setTimeout</code> triggers. The cooldown state is removed (<code>isThrottled = false</code>). And if we had ignored calls, then <code>wrapper</code> is executed with last memorized arguments and context.</li>
</ol>
<p>The 3rd step runs not <code>func</code>, but <code>wrapper</code>, because we not only need to execute <code>func</code>, but once again enter the cooldown state and setup the timeout to reset it.</p>
<p>
<a href="http://plnkr.co/edit/sTjuJ30s7X0LxdQe54m5?p=preview" target="_blank" data-plunk-id="sTjuJ30s7X0LxdQe54m5">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

  return a * b;
};

function ask(question, answer, ok, fail) {
  let result = prompt(question, '');
  if (result.toLowerCase() == answer.toLowerCase()) ok();
  else fail();
}

function bind(func, context /*, args*/) {
  let bindArgs = [].slice.call(arguments, 2); // (1)
  function wrapper() {                        // (2)
    let args = [].slice.call(arguments);
    let unshiftArgs = bindArgs.concat(args);  // (3)
    return func.apply(context, unshiftArgs);  // (4)
  }
  return wrapper;
}



<h6 id="chapter-447"></h6>
<h1 class="main__header-title" id="chapter-448">Function binding</h1>
<p>When using <code>setTimeout</code> with object methods or passing object methods along, there's a known problem: "losing <code>this</code>".</p>
<p>Suddenly, <code>this</code> just stops working right. The situation is typical for novice developers, but happens with experienced ones as well.</p>


<h2 id="chapter-449">
Losing “this”</h2>
<p>We already know that in JavaScript it's easy to lose <code>this</code>. Once a method is passed somewhere separately from the object – <code>this</code> is lost.</p>
<p>Here's how it may happen with <code>setTimeout</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  firstName: "John",
  sayHi() {
    alert(`Hello, ${this.firstName}!`);
  }
};

setTimeout(user.sayHi, 1000); // Hello, undefined!</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, the output shows not “John” as <code>this.firstName</code>, but <code>undefined</code>!</p>
<p>That's because <code>setTimeout</code> got the function <code>user.sayHi</code>, separately from the object. The last line can be rewritten as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let f = user.sayHi;
setTimeout(f, 1000); // lost user context</code></pre>
        </div>
      </div>
      
      </div><p>The method <code>setTimeout</code> in-browser is a little special: it sets <code>this=window</code> for the function call (for Node.JS, <code>this</code> becomes the timer object, but doesn't really matter here). So for <code>this.firstName</code> it tries to get <code>window.firstName</code>, which does not exist. In other similar cases as we'll see, usually <code>this</code> just becomes <code>undefined</code>.</p>
<p>The task is quite typical – we want to pass an object method somewhere else (here – to the scheduler) where it will be called. How to make sure that it will be called in the right context?</p>
<h2 id="chapter-450">
Solution 1: a wrapper</h2>
<p>The simplest solution is to use an wrapping function:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  firstName: "John",
  sayHi() {
    alert(`Hello, ${this.firstName}!`);
  }
};

setTimeout(function() {
  user.sayHi(); // Hello, John!
}, 1000);</code></pre>
        </div>
      </div>
      
      </div><p>Now it works, because it receives <code>user</code> from the outer lexical environment, and then calls the method normally.</p>
<p>The same, but shorter:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">setTimeout(() =&gt; user.sayHi(), 1000); // Hello, John!</code></pre>
        </div>
      </div>
      
      </div><p>Looks fine, but a slight vulnerability appears in our code structure.</p>
<p>What if before <code>setTimeout</code> triggers (there's one second delay!) <code>user</code> changes value? Then, suddenly, it will call the wrong object!</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  firstName: "John",
  sayHi() {
    alert(`Hello, ${this.firstName}!`);
  }
};

setTimeout(() =&gt; user.sayHi(), 1000);

// ...within 1 second
user = { sayHi() { alert("Another user in setTimeout!"); } };

// Another user in setTimeout?!?</code></pre>
        </div>
      </div>
      
      </div><p>The next solution guarantees that such thing won't happen.</p>
<h2 id="chapter-451">
Solution 2: bind</h2>
<p>Functions provide a built-in method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">bind</a> that allows to fix <code>this</code>.</p>
<p>The basic syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// more complex syntax will be little later
let boundFunc = func.bind(context);</code></pre>
        </div>
      </div>
      
      </div><p>The result of <code>func.bind(context)</code> is a special function-like “exotic object”, that is callable as function and transparently passes the call to <code>func</code> setting <code>this=context</code>.</p>
<p>In other words, calling <code>boundFunc</code> is like <code>func</code> with fixed <code>this</code>.</p>
<p>For instance, here <code>funcUser</code> passes a call to <code>func</code> with <code>this=user</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  firstName: "John"
};

function func() {
  alert(this.firstName);
}

let funcUser = func.bind(user);
funcUser(); // John</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>func.bind(user)</code> as a “bound variant” of <code>func</code>, with fixed <code>this=user</code>.</p>
<p>All arguments are passed to the original <code>func</code> “as is”, for instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="11-11">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  firstName: "John"
};

function func(phrase) {
  alert(phrase + ', ' + this.firstName);
}

// bind this to user
let funcUser = func.bind(user);

funcUser("Hello"); // Hello, John (argument "Hello" is passed, and this=user)</code></pre>
        </div>
      </div>
      
      </div><p>Now let's try with an object method:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  firstName: "John",
  sayHi() {
    alert(`Hello, ${this.firstName}!`);
  }
};

let sayHi = user.sayHi.bind(user); // (*)

sayHi(); // Hello, John!

setTimeout(sayHi, 1000); // Hello, John!</code></pre>
        </div>
      </div>
      
      </div><p>In the line <code>(*)</code> we take the method <code>user.sayHi</code> and bind it to <code>user</code>. The <code>sayHi</code> is a “bound” function, that can be called alone or passed to <code>setTimeout</code> – doesn't matter, the context will be right.</p>
<p>Here we can see that arguments are passed “as is”, only <code>this</code> is fixed by <code>bind</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  firstName: "John",
  say(phrase) {
    alert(`${phrase}, ${this.firstName}!`);
  }
};

let say = user.say.bind(user);

say("Hello"); // Hello, John ("Hello" argument is passed to say)
say("Bye"); // Bye, John ("Bye" is passed to say)</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Convenience method: <code>bindAll</code></span></div>
            <div class="important__content"><p>If an object has many methods and we plan to actively pass it around, then we could bind them all in a loop:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let key in user) {
  if (typeof user[key] == 'function') {
    user[key] = user[key].bind(user);
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>JavaScript libraries also provide functions for convenient mass binding , e.g. 
<a href="http://lodash.com/docs#bindAll">_.bindAll(obj)</a> in lodash.</p>
</div></div>
<h2 id="chapter-452">
Summary</h2>
<p>Method <code>func.bind(context, ...args)</code> returns a “bound variant” of function <code>func</code> that fixes the context <code>this</code> and first arguments if given.</p>
<p>Usually we apply <code>bind</code> to fix <code>this</code> in an object method, so that we can pass it somewhere. For example, to <code>setTimeout</code>. There are more reasons to <code>bind</code> in the modern development, we'll meet them later.</p>
<div class="tasks"><h2 id="chapter-453" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#bound-function-as-a-method" name="bound-function-as-a-method" class="main__anchor">Bound function as a method</a></h3>
<a href="http://javascript.info/task/write-to-object-after-bind" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What will be the output?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  alert( this ); // ?
}

let user = {
  g: f.bind(null)
};

user.g();</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <code>null</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  alert( this ); // null
}

let user = {
  g: f.bind(null)
};

user.g();</code></pre>
        </div>
      </div>
      
      </div><p>The context of a bound function is hard-fixed. There's just no way to further change it.</p>
<p>So even while we run <code>user.g()</code>, the original function is called with <code>this=null</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#second-bind" name="second-bind" class="main__anchor">Second bind</a></h3>
<a href="http://javascript.info/task/second-bind" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Can we change <code>this</code> by additional binding?</p>
<p>What will be the output?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  alert(this.name);
}

f = f.bind( {name: "John"} ).bind( {name: "Ann" } );

f();</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <strong>John</strong>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  alert(this.name);
}

f = f.bind( {name: "John"} ).bind( {name: "Pete"} );

f(); // John</code></pre>
        </div>
      </div>
      
      </div><p>The exotic 
<a href="https://tc39.github.io/ecma262/#sec-bound-function-exotic-objects">bound function</a> object returned by <code>f.bind(...)</code> remembers the context (and arguments if provided) only at creation time.</p>
<p>A function cannot be re-bound.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#function-property-after-bind" name="function-property-after-bind" class="main__anchor">Function property after bind</a></h3>
<a href="http://javascript.info/task/function-property-after-bind" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's a value in the property of a function. Will it change after <code>bind</code>? Why, elaborate?</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert( this.name );
}
sayHi.test = 5;

let bound = sayHi.bind({
  name: "John"
});

alert( bound.test ); // what will be the output? why?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <code>undefined</code>.</p>
<p>The result of <code>bind</code> is another object. It does not have the <code>test</code> property.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#ask-losing-this" name="ask-losing-this" class="main__anchor">Ask losing this</a></h3>
<a href="http://javascript.info/task/question-use-bind" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The call to <code>askPassword()</code> in the code below should check the password and then call <code>user.loginOk/loginFail</code> depending on the answer.</p>
<p>But it leads to an error. Why?</p>
<p>Fix the highlighted line for everything to start working right (other lines are not to be changed).</p>
<div data-trusted="1" class="code-example" data-highlight-block="19-19">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function askPassword(ok, fail) {
  let password = prompt("Password?", '');
  if (password == "rockstar") ok();
  else fail();
}

let user = {
  name: 'John',

  loginOk() {
    alert(`${this.name} logged in`);
  },

  loginFail() {
    alert(`${this.name} failed to log in`);
  },

};

askPassword(user.loginOk, user.loginFail);</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The error occurs because <code>ask</code> gets functions <code>loginOk/loginFail</code> without the object.</p>
<p>When it calls them, they naturally assume <code>this=undefined</code>.</p>
<p>Let's <code>bind</code> the context:</p>
<div data-trusted="1" class="code-example" data-highlight-block="19-19">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function askPassword(ok, fail) {
  let password = prompt("Password?", '');
  if (password == "rockstar") ok();
  else fail();
}

let user = {
  name: 'John',

  loginOk() {
    alert(`${this.name} logged in`);
  },

  loginFail() {
    alert(`${this.name} failed to log in`);
  },

};

askPassword(user.loginOk.bind(user), user.loginFail.bind(user));</code></pre>
        </div>
      </div>
      
      </div><p>Now it works.</p>
<p>An alternative solution could be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">//...
askPassword(() =&gt; user.loginOk(), () =&gt; user.loginFail());</code></pre>
        </div>
      </div>
      
      </div><p>Usually that also works, but may fail in more complex situations where <code>user</code> has a chance of being overwritten between the moments of asking and running <code>() =&gt; user.loginOk()</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-454"></h6>
<h1 class="main__header-title" id="chapter-455">Currying and partials</h1>
<p>Till now we were only talking about binding <code>this</code>. Now let's make a step further.</p>
<p>We can bind not only <code>this</code>, but also arguments. That's rarely done, but sometimes can be handy.</p>


<p>The full syntax of <code>bind</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let bound = func.bind(context, arg1, arg2, ...);</code></pre>
        </div>
      </div>
      
      </div><p>It allows to bind context as <code>this</code> and starting arguments of the function.</p>
<p>For instance, we have a multiplication function <code>mul(a, b)</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function mul(a, b) {
  return a * b;
}</code></pre>
        </div>
      </div>
      
      </div><p>Let's use <code>bind</code> to create a function <code>double</code> on its base:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let double = mul.bind(null, 2);

alert( double(3) ); // = mul(2, 3) = 6
alert( double(4) ); // = mul(2, 4) = 8
alert( double(5) ); // = mul(2, 5) = 10</code></pre>
        </div>
      </div>
      
      </div><p>The call to <code>mul.bind(null, 2)</code> creates a new function <code>double</code> that passes calls to <code>mul</code>, fixing <code>null</code> as the context and <code>2</code> as the first argument. Further arguments are passed “as is”.</p>
<p>That's called 
<a href="https://en.wikipedia.org/wiki/Partial_application">partial function application</a> – we create a new function by fixing some parameters of the existing one.</p>
<p>Please note that here we actually don't use <code>this</code> here. But <code>bind</code> requires it, so we must put in something like <code>null</code>.</p>
<p>The function <code>triple</code> in the code below triples the value:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let triple = mul.bind(null, 3);

alert( triple(3) ); // = mul(3, 3) = 9
alert( triple(4) ); // = mul(3, 4) = 12
alert( triple(5) ); // = mul(3, 5) = 15</code></pre>
        </div>
      </div>
      
      </div><p>Why do we usually make a partial function?</p>
<p>Here our benefit is that we created an independent function with a readable name (<code>double</code>, <code>triple</code>). We can use it and don't write the first argument of every time, cause it's fixed with <code>bind</code>.</p>
<p>In other cases, partial application is useful when we have a very generic function, and want a less universal variant of it for convenience.</p>
<p>For instance, we have a function <code>send(from, to, text)</code>. Then, inside a <code>user</code> object we may want to use a partial variant of it: <code>sendTo(to, text)</code> that sends from the current user.</p>
<h2 id="chapter-456">
Going partial without context</h2>
<p>What if we'd like to fix some arguments, but not bind <code>this</code>?</p>
<p>The native <code>bind</code> does not allow that. We can't just omit the context and jump to arguments.</p>
<p>Fortunately, a <code>partial</code> function for binding only arguments can be easily implemented.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function partial(func, ...argsBound) {
  return function(...args) { // (*)
    return func.call(this, ...argsBound, ...args);
  }
}

// Usage:
let user = {
  firstName: "John",
  say(time, phrase) {
    alert(`[${time}] ${this.firstName}: ${phrase}!`);
  }
};

// add a partial method that says something now by fixing the first argument
user.sayNow = partial(user.say, new Date().getHours() + ':' + new Date().getMinutes());

user.sayNow("Hello");
// Something like:
// [10:00] Hello, John!</code></pre>
        </div>
      </div>
      
      </div><p>The result of <code>partial(func[, arg1, arg2...])</code> call is a wrapper <code>(*)</code> that calls <code>func</code> with:</p>
<ul>
<li>Same <code>this</code> as it gets (for <code>user.sayNow</code> call it's <code>user</code>)</li>
<li>Then gives it <code>...argsBound</code> – arguments from the <code>partial</code> call (<code>"10:00"</code>)</li>
<li>Then gives it <code>...args</code> – arguments given to the wrapper (<code>"Hello"</code>)</li>
</ul>
<p>So easy to do it with the spread operator, right?</p>
<p>Also there's a ready 
<a href="https://lodash.com/docs#partial">_.partial</a> implementation from lodash library.</p>
<h2 id="chapter-457">
Currying</h2>
<p>Sometimes people mix up partial function application mentioned above with another thing named “currying”. That's another interesting technique of working with functions that we just have to mention here.</p>
<p>
<a href="https://en.wikipedia.org/wiki/Currying">Currying</a> is translating a function from callable as <code>f(a, b, c)</code> into callable as <code>f(a)(b)(c)</code>.</p>
<p>Let's make <code>curry</code> function that performs currying for binary functions. In other words, it translates <code>f(a, b)</code> into <code>f(a)(b)</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function curry(func) {
  return function(a) {
    return function(b) {
      return func(a, b);
    };
  };
}

// usage
function sum(a, b) {
  return a + b;
}

let carriedSum = curry(sum);

alert( carriedSum(1)(2) ); // 3</code></pre>
        </div>
      </div>
      
      </div><p>As you can see, the implementation is a series of wrappers.</p>
<ul>
<li>The result of <code>curry(func)</code> is a wrapper <code>function(a)</code>.</li>
<li>When it is called like <code>sum(1)</code>, the argument is saved in the Lexical Environment, and a new wrapper is returned <code>function(b)</code>.</li>
<li>Then <code>sum(1)(2)</code> finally calls <code>function(b)</code> providing <code>2</code>, and it passes the call to the original multi-argument <code>sum</code>.</li>
</ul>
<p>More advanced implementations of currying like 
<a href="https://lodash.com/docs#curry">_.curry</a> from lodash library do something more sophisticated. They return a wrapper that allows a function to be called normally when all arguments are supplied <em>or</em> returns a partial otherwise.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function curry(f) {
  return function(..args) {
    // if args.length == f.length (as many arguments as f has),
    //   then pass the call to f
    // otherwise return a partial function that fixes args as first arguments
  };
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-458">
Currying? What for?</h2>
<p>Advanced currying allows both to keep the function callable normally and to get partials easily. To understand the benefits we definitely need a worthy real-life example.</p>
<p>For instance, we have the logging function <code>log(date, importance, message)</code> that formats and outputs the information. In real projects such functions also have many other useful features like: sending it over the network or filtering:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function log(date, importance, message) {
  alert(`[${date.getHours()}:${date.getMinutes()}] [${importance}] ${message}`);
}</code></pre>
        </div>
      </div>
      
      </div><p>Let's curry it!</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">log = _.curry(log);</code></pre>
        </div>
      </div>
      
      </div><p>After that <code>log</code> still works the normal way:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">log(new Date(), "DEBUG", "some debug");</code></pre>
        </div>
      </div>
      
      </div><p>…But also can be called in the curried form:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">log(new Date())("DEBUG")("some debug"); // log(a)(b)(c)</code></pre>
        </div>
      </div>
      
      </div><p>Let's get a convenience function for today's logs:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// todayLog will be the partial of log with fixed first argument
let todayLog = log(new Date());

// use it
todayLog("INFO", "message"); // [HH:mm] INFO message</code></pre>
        </div>
      </div>
      
      </div><p>And now a convenience function for today's debug messages:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let todayDebug = todayLog("DEBUG");

todayDebug("message"); // [HH:mm] DEBUG message</code></pre>
        </div>
      </div>
      
      </div><p>So:</p>
<ol>
<li>We didn't lose anything after currying: <code>log</code> is still callable normally.</li>
<li>We were able to generate partial functions that are convenient in many cases.</li>
</ol>
<h2 id="chapter-459">
Advanced curry implementation</h2>
<p>In case you're interested, here's the “advanced” curry implementation that we could use above.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function curry(func) {

  return function curried(...args) {
    if (args.length &gt;= func.length) {
      return func.apply(this, args);
    } else {
      return function(...args2) {
        return curried.apply(this, args.concat(args2));
      }
    }
  };

}

function sum(a, b, c) {
  return a + b + c;
}

let curriedSum = curry(sum);

// still callable normally
alert( curriedSum(1, 2, 3) ); // 6

// get the partial with curried(1) and call it with 2 other arguments
alert( curriedSum(1)(2,3) ); // 6

// full curried form
alert( curriedSum(1)(2)(3) ); // 6</code></pre>
        </div>
      </div>
      
      </div><p>The new <code>curry</code> may look complicated, but it's actually pretty easy to understand.</p>
<p>The result of <code>curry(func)</code> is the wrapper <code>curried</code> that looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// func is the function to transform
function curried(...args) {
  if (args.length &gt;= func.length) { // (1)
    return func.apply(this, args);
  } else {
    return function pass(...args2) { // (2)
      return curried.apply(this, args.concat(args2));
    }
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>When we run it, there are two branches:</p>
<ol>
<li>Call now: if passed <code>args</code> count is the same as the original function has in its definition (<code>func.length</code>) or longer, then just pass the call to it.</li>
<li>Get a partial: otherwise, <code>func</code> is not called yet. Instead, another wrapper <code>pass</code> is returned, that will re-apply <code>curried</code> providing previous arguments together with the new ones. Then on a new call, again, we'll get either a new partial (if not enough arguments) or, finally, the result.</li>
</ol>
<p>For instance, let's see what happens in the case of <code>sum(a, b, c)</code>. Three arguments, so <code>sum.length = 3</code>.</p>
<p>For the call <code>curried(1)(2)(3)</code>:</p>
<ol>
<li>
<p>The first call <code>curried(1)</code> remembers <code>1</code> in its Lexical Environment, and returns a wrapper <code>pass</code>.</p>
</li>
<li>
<p>The wrapper <code>pass</code> is called with <code>(2)</code>: it takes previous args (<code>1</code>), concatenates them with what it got <code>(2)</code> and calls <code>curried(1, 2)</code> with them together.</p>
<p>As the argument count is still less than 3, <code>curry</code> returns <code>pass</code>.</p>
</li>
<li>
<p>The wrapper <code>pass</code> is called again with <code>(3)</code>,  for the next call <code>pass(3)</code> takes previous args (<code>1</code>, <code>2</code>) and adds <code>3</code> to them, making the call <code>curried(1, 2, 3)</code> – there are <code>3</code> arguments at last, they are given to the original function.</p>
</li>
</ol>
<p>If that's still not obvious, just trace the calls sequence in your mind or on the paper.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Fixed-length functions only</span></div>
            <div class="important__content"><p>The currying requires the function to have a known fixed number of arguments.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">A little more than currying</span></div>
            <div class="important__content"><p>By definition, currying should convert <code>sum(a, b, c)</code> into <code>sum(a)(b)(c)</code>.</p>
<p>But most implementations of currying in JavaScript are advanced, as described: they also keep the function callable in the multi-argument variant.</p>
</div></div>
<h2 id="chapter-460">
Summary</h2>
<ul>
<li>
<p>When we fix some arguments of an existing function, the resulting (less universal) function is called <em>a partial</em>. We can use <code>bind</code> to get a partial, but there are other ways also.</p>
<p>Partials are convenient when we don't want to repeat the same argument over and over again. Like if we have a <code>send(from, to)</code> function, and <code>from</code> should always be the same for our task, we can get a partial and go on with it.</p>
</li>
<li>
<p><em>Currying</em> is a transform that makes <code>f(a,b,c)</code> callable as <code>f(a)(b)(c)</code>. JavaScript implementations usually both keep the function callable normally and return the partial if arguments count is not enough.</p>
<p>Currying is great when we want easy partials. As we've seen in the logging example: the universal function <code>log(date, importance, message)</code> after currying gives us partials when called with one argument like <code>log(date)</code> or two arguments <code>log(date, importance)</code>.</p>
</li>
</ul>
<div class="tasks"><h2 id="chapter-461" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#partial-application-for-login" name="partial-application-for-login" class="main__anchor">Partial application for login</a></h3>
<a href="http://javascript.info/task/ask-currying" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The task is a little more complex variant of 
<a href="http://javascript.info/task/question-use-bind">Ask losing this</a>.</p>
<p>The <code>user</code> object was modified. Now instead of two functions <code>loginOk/loginFail</code>, it has a single function <code>user.login(true/false)</code>.</p>
<p>What to pass <code>askPassword</code> in the code below, so that it calls <code>user.login(true)</code> as <code>ok</code> and <code>user.login(fail)</code> as <code>fail</code>?</p>
<div data-trusted="1" class="code-example" data-highlight-block="14-14">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function askPassword(ok, fail) {
  let password = prompt("Password?", '');
  if (password == "rockstar") ok();
  else fail();
}

let user = {
  name: 'John',

  login(result) {
    alert( this.name + (result ? ' logged in' : ' failed to log in') );
  }
};

askPassword(?, ?); // ?</code></pre>
        </div>
      </div>
      
      </div><p>Your changes should only modify the highlighted fragment.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><ol>
<li>
<p>Either use a wrapper function, an arrow to be concise:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">askPassword(() =&gt; user.login(true), () =&gt; user.login(false));</code></pre>
        </div>
      </div>
      
      </div><p>Now it gets <code>user</code> from outer variables and runs it the normal way.</p>
</li>
<li>
<p>Or create a partial function from <code>user.login</code> that uses <code>user</code> as the context and has the correct first argument:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">askPassword(user.login.bind(user, true), user.login.bind(user, false));</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-462"></h6>
<h1 class="main__header-title" id="chapter-463">Arrow functions revisited</h1>
<p>Let's revisit arrow functions.</p>


<p>Arrow functions are not just a “shorthand” for writing small stuff.</p>
<p>JavaScript is full of situations where we need to write a small function, that's executed somewhere else.</p>
<p>For instance:</p>
<ul>
<li><code>arr.forEach(func)</code> – <code>func</code> is executed by <code>forEach</code> for every array item.</li>
<li><code>setTimeout(func)</code> – <code>func</code> is executed by the built-in scheduler.</li>
<li>…there are more.</li>
</ul>
<p>It's in the very spirit of JavaScript to create a function and pass it somewhere.</p>
<p>And in such functions we usually don't want to leave the current context.</p>
<h2 id="chapter-464">
Arrow functions have no “this”</h2>
<p>As we remember from the chapter 
<a href="http://javascript.info/object-methods">Object methods, "this"</a>, arrow functions do not have <code>this</code>. If <code>this</code> is accessed, it is taken from the outside.</p>
<p>For instance, we can use it to iterate inside an object method:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let group = {
  title: "Our Group",
  students: ["John", "Pete", "Alice"],

  showList() {
    this.students.forEach(
      student =&gt; alert(this.title + ': ' + student)
    );
  }
};

group.showList();</code></pre>
        </div>
      </div>
      
      </div><p>Here in <code>forEach</code>, the arrow function is used, so <code>this.title</code> in it is exactly the same as in the outer method <code>showList</code>. That is: <code>group.title</code>.</p>
<p>If we used a “regular” function, there would be an error:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let group = {
  title: "Our Group",
  students: ["John", "Pete", "Alice"],

  showList() {
    this.students.forEach(function(student) {
      // Error: Cannot read property 'title' of undefined
      alert(this.title + ': ' + student)
    });
  }
};

group.showList();</code></pre>
        </div>
      </div>
      
      </div><p>The error occurs because <code>forEach</code> runs functions with <code>this=undefined</code> by default, so the attempt to access <code>undefined.title</code> is made.</p>
<p>That doesn't affect arrow functions, because they just don't have <code>this</code>.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Arrow functions can't run with <code>new</code></span></div>
            <div class="important__content"><p>Not having <code>this</code> naturally means another limitation: arrow functions can't be used as constructors. They can't be called with <code>new</code>.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Arrow functions VS bind</span></div>
            <div class="important__content"><p>There's a subtle difference between an arrow function <code>=&gt;</code> and a regular function called with <code>.bind(this)</code>:</p>
<ul>
<li><code>.bind(this)</code> creates a “bound version” of the function.</li>
<li>The arrow <code>=&gt;</code> doesn't create any binding. The function simply doesn't have <code>this</code>. The lookup of <code>this</code> is made exactly the same way as a regular variable search: in the outer lexical environment.</li>
</ul>
</div></div>
<h2 id="chapter-465">
Arrows have no “arguments”</h2>
<p>Arrow functions also have no <code>arguments</code> variable.</p>
<p>That's great for decorators, when we need to forward a call with the current <code>this</code> and <code>arguments</code>.</p>
<p>For instance, <code>defer(f, ms)</code> gets a function and returns a wrapper around it that delays the call by <code>ms</code> milliseconds:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function defer(f, ms) {
  return function() {
    setTimeout(() =&gt; f.apply(this, arguments), ms)
  };
}

function sayHi(who) {
  alert('Hello, ' + who);
}

let sayHiDeferred = defer(sayHi, 2000);
sayHiDeferred("John"); // Hello, John after 2 seconds</code></pre>
        </div>
      </div>
      
      </div><p>The same without an arrow function would look like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function defer(f, ms) {
  return function(...args) {
    let ctx = this;
    setTimeout(function() {
      return f.apply(ctx, args);
    }, ms);
  };
}</code></pre>
        </div>
      </div>
      
      </div><p>Here we had to create additional variables <code>args</code> and <code>ctx</code> so that the function inside <code>setTimeout</code> could take them.</p>
<h2 id="chapter-466">
Summary</h2>
<p>Arrow functions:</p>
<ul>
<li>Do not have <code>this</code>.</li>
<li>Do not have <code>arguments</code>.</li>
<li>Can't be called with <code>new</code>.</li>
<li>(They also don't have <code>super</code>, but we didn't study it. Will be in the chapter 
<a href="http://javascript.info/class-inheritance">Class inheritance, super</a>).</li>
</ul>
<p>That's because they are meant for short pieces of code that do not have their own “context”, but rather works in the current one. And they really shine in that use case.</p>

<h6 id="chapter-467"></h6>
<h1 class="main__header-title" id="chapter-468">Objects, classes, inheritance</h1>
<p>In this section we return to objects and learn them even more in-depth.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/property-descriptors" class="lessons-list__link">Property flags and descriptors</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/property-accessors" class="lessons-list__link">Property getters and setters</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/prototype-inheritance" class="lessons-list__link">Prototypal inheritance</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/function-prototype" class="lessons-list__link">F.prototype</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/native-prototypes" class="lessons-list__link">Native prototypes</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/prototype-methods" class="lessons-list__link">Methods for prototypes</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/class-patterns" class="lessons-list__link">Class patterns</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/class" class="lessons-list__link">Classes</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/class-inheritance" class="lessons-list__link">Class inheritance, super</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/instanceof" class="lessons-list__link">Class checking: "instanceof"</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/mixins" class="lessons-list__link">Mixins</a></li></ol></div>

<h6 id="chapter-469"></h6>
<h1 class="main__header-title" id="chapter-470">Property flags and descriptors</h1>
<p>As we know, objects can store properties.</p>
<p>Till now, a property was a simple “key-value” pair to us. But an object property is actually more complex and tunable thing.</p>


<h2 id="chapter-471">
Property flags</h2>
<p>Object properties, besides a <strong><code>value</code></strong>, have three special attributes (so-called “flags”):</p>
<ul>
<li><strong><code>writable</code></strong> – if <code>true</code>, can be changed, otherwise it's read-only.</li>
<li><strong><code>enumerable</code></strong> – if <code>true</code>, then listed in loops, otherwise not listed.</li>
<li><strong><code>configurable</code></strong> – if <code>true</code>, the property can be deleted and these attributes can be modified, otherwise not.</li>
</ul>
<p>We didn't see them yet, because generally they do not show up. When we create a property “the usual way”, all of them are <code>true</code>. But we also can change them anytime.</p>
<p>First, let's see how to get those flags.</p>
<p>The method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor">Object.getOwnPropertyDescriptor</a> allows to query the <em>full</em> information about a property.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let descriptor = Object.getOwnPropertyDescriptor(obj, propertyName);</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt><code>obj</code></dt>
<dd>The object to get information from.</dd>
<dt><code>propertyName</code></dt>
<dd>The name of the property.</dd>
</dl>
<p>The returned value is a so-called “property descriptor” object: it contains the value and all the flags.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John"
};

let descriptor = Object.getOwnPropertyDescriptor(user, 'name');

alert( JSON.stringify(descriptor, null, 2 ) );
/* property descriptor:
{
  "value": "John",
  "writable": true,
  "enumerable": true,
  "configurable": true
}
*/</code></pre>
        </div>
      </div>
      
      </div><p>To change the flags, we can use 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty</a>.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Object.defineProperty(obj, propertyName, descriptor)</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt><code>obj</code>, <code>propertyName</code></dt>
<dd>The object and property to work on.</dd>
<dt><code>descriptor</code></dt>
<dd>Property descriptor to apply.</dd>
</dl>
<p>If the property exists, <code>defineProperty</code> updates its flags. Otherwise, it creates the property with the given value and flags; in that case, if a flag is not supplied, it is assumed <code>false</code>.</p>
<p>For instance, here a property <code>name</code> is created with all falsy flags:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-4,12-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {};

Object.defineProperty(user, "name", {
  value: "John"
});

let descriptor = Object.getOwnPropertyDescriptor(user, 'name');

alert( JSON.stringify(descriptor, null, 2 ) );
/*
{
  "value": "John",
  "writable": false,
  "enumerable": false,
  "configurable": false
}
 */</code></pre>
        </div>
      </div>
      
      </div><p>Compare it with “normally created” <code>user.name</code> above: now all flags are falsy. If that's not what we want then we'd better set them to <code>true</code> in <code>descriptor</code>.</p>
<p>Now let's see effects of the flags by example.</p>
<h2 id="chapter-472">
Read-only</h2>
<p>Let's make <code>user.name</code> read-only by changing <code>writable</code> flag:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5,8-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John"
};

Object.defineProperty(user, "name", {
  writable: false
});

user.name = "Pete"; // Error: Cannot assign to read only property 'name'...</code></pre>
        </div>
      </div>
      
      </div><p>Now no one can change the name of our user, unless he applies his own <code>defineProperty</code> to override ours.</p>
<p>Here's the same operation, but for the case when a property doesn't exist:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { };

Object.defineProperty(user, "name", {
  value: "Pete",
  // for new properties need to explicitly list what's true
  enumerable: true,
  configurable: true
});

alert(user.name); // Pete
user.name = "Alice"; // Error</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-473">
Non-enumerable</h2>
<p>Now let's add a custom <code>toString</code> to <code>user</code>.</p>
<p>Normally, a built-in <code>toString</code> for objects is non-enumerable, it does not show up in <code>for..in</code>. But if we add <code>toString</code> of our own, then by default it shows up in <code>for..in</code>, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  toString() {
    return this.name;
  }
};

// By default, both our properties are listed:
for (let key in user) alert(key); // name, toString</code></pre>
        </div>
      </div>
      
      </div><p>If we don't like it, then we can set <code>enumerable:false</code>. Then it won't appear in <code>for..in</code> loop, just like the built-in one:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-8,11-11">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  toString() {
    return this.name;
  }
};

Object.defineProperty(user, "toString", {
  enumerable: false
});

// Now our toString disappears:
for (let key in user) alert(key); // name</code></pre>
        </div>
      </div>
      
      </div><p>Non-enumerable properties are also excluded from <code>Object.keys</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(Object.keys(user)); // name</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-474">
Non-configurable</h2>
<p>The non-configurable flag (<code>configurable:false</code>) is sometimes preset for built-in objects and properties.</p>
<p>A non-configurable property can not be deleted or altered with <code>defineProperty</code>.</p>
<p>For instance, <code>Math.PI</code> is both read-only, non-enumerable and non-configurable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let descriptor = Object.getOwnPropertyDescriptor(Math, 'PI');

alert( JSON.stringify(descriptor, null, 2 ) );
/*
{
  "value": 3.141592653589793,
  "writable": false,
  "enumerable": false,
  "configurable": false
}
*/</code></pre>
        </div>
      </div>
      
      </div><p>So, a programmer is unable to change the value of <code>Math.PI</code> or overwrite it.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Math.PI = 3; // Error

// delete Math.PI won't work either</code></pre>
        </div>
      </div>
      
      </div><p>Making a property non-configurable is a one-way road. We cannot change it back, because <code>defineProperty</code> doesn't work on non-configurable properties.</p>
<p>Here we are making <code>user.name</code> a “forever sealed” constant:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = { };

Object.defineProperty(user, "name", {
  value: "John",
  writable: false,
  configurable: false
});

// won't be able to change user.name or its flags
// all this won't work:
//   user.name = "Pete"
//   delete user.name
//   defineProperty(user, "name", ...)
Object.defineProperty(user, "name", {writable: true}); // Error</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Errors appear only in use strict</span></div>
            <div class="important__content"><p>In the non-strict mode, no errors occur when writing to read-only properties and such. But the operation still won't succeed. Flag-violating actions are just silently ignored in non-strict.</p>
</div></div>
<h2 id="chapter-475">
Object.defineProperties</h2>
<p>There's a method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties">Object.defineProperties(obj, descriptors)</a> that allows to define many properties at once.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Object.defineProperties(obj, {
  prop1: descriptor1,
  prop2: descriptor2
  // ...
});</code></pre>
        </div>
      </div>
      
      </div><p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Object.defineProperties(user, {
  name: { value: "John", writable: false },
  surname: { value: "Smith", writable: false },
  // ...
});</code></pre>
        </div>
      </div>
      
      </div><p>So, we can set many properties at once.</p>
<h2 id="chapter-476">
Object.getOwnPropertyDescriptors</h2>
<p>To get all property descriptors at once, we can use the method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptors">Object.getOwnPropertyDescriptors(obj)</a>.</p>
<p>Together with <code>Object.defineProperties</code> it can be used as a “flags-aware” way of cloning an object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let clone = Object.defineProperties({}, Object.getOwnPropertyDescriptors(obj));</code></pre>
        </div>
      </div>
      
      </div><p>Normally when we clone an object, we use an assignment to copy properties, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let key in user) {
  clone[key] = user[key]
}</code></pre>
        </div>
      </div>
      
      </div><p>…But that does not copy flags. So if we want a “better” clone then <code>Object.defineProperties</code> is preferred.</p>
<p>Another difference is that <code>for..in</code> ignores symbolic properties, but <code>Object.getOwnPropertyDescriptors</code> returns <em>all</em> property descriptors including symbolic ones.</p>
<h2 id="chapter-477">
Sealing an object globally</h2>
<p>Property descriptors work at the level of individual properties.</p>
<p>There are also methods that limit access to the <em>whole</em> object:</p>
<dl>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions">Object.preventExtensions(obj)</a></dt>
<dd>Forbids to add properties to the object.</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/seal">Object.seal(obj)</a></dt>
<dd>Forbids to add/remove properties, sets for all existing properties <code>configurable: false</code>.</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze">Object.freeze(obj)</a></dt>
<dd>Forbids to add/remove/change properties, sets for all existing properties <code>configurable: false, writable: false</code>.</dd>
</dl>
<p>And also there are tests for them:</p>
<dl>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isExtensible">Object.isExtensible(obj)</a></dt>
<dd>Returns <code>false</code> if adding properties is forbidden, otherwise <code>true</code>.</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isSealed">Object.isSealed(obj)</a></dt>
<dd>Returns <code>true</code> if adding/removing properties is forbidden, and all existing properties have <code>configurable: false</code>.</dd>
<dt>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isFrozen">Object.isFrozen(obj)</a></dt>
<dd>Returns <code>true</code> if adding/removing/changing properties is forbidden, and all current properties are <code>configurable: false, writable: false</code>.</dd>
</dl>
<p>These methods are rarely used in practice.</p>

<h6 id="chapter-478"></h6>
<h1 class="main__header-title" id="chapter-479">Property getters and setters</h1>
<p>There are two kinds of properties.</p>
<p>The first kind is <em>data properties</em>. We already know how to work with them. Actually, all properties that we've been using till now were data properties.</p>
<p>The second type of properties is something new. It's <em>accessor properties</em>. They are essentially functions that work on getting and setting a value, but look like regular properties to an external code.</p>


<h2 id="chapter-480">
Getters and setters</h2>
<p>Accessor properties are represented by “getter” and “setter” methods. In an object literal they are denoted by <code>get</code> and <code>set</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:2-16,5:2-21">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {
  get propName() {
    // getter, the code executed on getting obj.propName
  },

  set propName(value) {
    // setter, the code executed on setting obj.propName = value
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>The getter works when <code>obj.propName</code> is read, the setter – when it is assigned.</p>
<p>For instance, we have a <code>user</code> object with <code>name</code> and <code>surname</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  surname: "Smith"
};</code></pre>
        </div>
      </div>
      
      </div><p>Now we want to add a “fullName” property, that should be “John Smith”. Of course, we don't want to copy-paste existing information, so we can implement it as an accessor:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-6,9-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  surname: "Smith",

  get fullName() {
    return `${this.name} ${this.surname}`;
  }
};

alert(user.fullName); // John Smith</code></pre>
        </div>
      </div>
      
      </div><p>From outside, an accessor property looks like a regular one. That's the idea of accessor properties. We don't <em>call</em> <code>user.fullName</code> as a function, we <em>read</em> it normally: the getter runs behind the scenes.</p>
<p>As of now, <code>fullName</code> has only a getter. If we attempt to assign <code>user.fullName=</code>, there will be an error.</p>
<p>Let's fix it by adding a setter for <code>user.fullName</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  surname: "Smith",

  get fullName() {
    return `${this.name} ${this.surname}`;
  },

  set fullName(value) {
    [this.name, this.surname] = value.split(" ");
  }
};

// set fullName is executed with the given value.
user.fullName = "Alice Cooper";

alert(user.name); // Alice
alert(user.surname); // Cooper</code></pre>
        </div>
      </div>
      
      </div><p>Now we have a “virtual” property. It is readable and writable, but in fact does not exist.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Accessor properties are only accessible with get/set</span></div>
            <div class="important__content"><p>A property can either be a “data property” or an “accessor property”, but not both.</p>
<p>Once a property is defined with <code>get prop()</code> or <code>set prop()</code>, it's an accessor property. So there must be a getter to read it, and must be a setter if we want to assign it.</p>
<p>Sometimes it's normal that there's only a setter or only a getter. But the property won't be readable or writable in that case.</p>
</div></div>
<h2 id="chapter-481">
Accessor descriptors</h2>
<p>Descriptors for accessor properties are different – as compared with data properties.</p>
<p>For accessor properties, there is no <code>value</code> and <code>writable</code>, but instead there are <code>get</code> and <code>set</code> functions.</p>
<p>So an accessor descriptor may have:</p>
<ul>
<li><strong><code>get</code></strong> – a function without arguments, that works when a property is read,</li>
<li><strong><code>set</code></strong> – a function with one argument, that is called when the property is set,</li>
<li><strong><code>enumerable</code></strong> – same as for data properties,</li>
<li><strong><code>configurable</code></strong> – same as for data properties.</li>
</ul>
<p>For instance, to create an accessor <code>fullName</code> with <code>defineProperty</code>, we can pass a descriptor with <code>get</code> and <code>set</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  surname: "Smith"
};

Object.defineProperty(user, 'fullName', {
  get() {
    return `${this.name} ${this.surname}`;
  },

  set(value) {
    [this.name, this.surname] = value.split(" ");
  }
});

alert(user.fullName); // John Smith

for(let key in user) alert(key);</code></pre>
        </div>
      </div>
      
      </div><p>Please note once again that a property can be either an accessor or a data property, not both.</p>
<p>If we try to supply both <code>get</code> and <code>value</code> in the same descriptor, there will be an error:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Error: Invalid property descriptor.
Object.defineProperty({}, 'prop', {
  get() {
    return 1
  },

  value: 2
});</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-482">
Smarter getters/setters</h2>
<p>Getters/setters can be used as wrappers over “real” property values to gain more control over them.</p>
<p>For instance, if we want to forbid too short names for <code>user</code>, we can store <code>name</code> in a special property <code>_name</code>. And filter assignments in the setter:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  get name() {
    return this._name;
  },

  set name(value) {
    if (value.length &lt; 4) {
      alert("Name is too short, need at least 4 characters");
      return;
    }
    this._name = value;
  }
};

user.name = "Pete";
alert(user.name); // Pete

user.name = ""; // Name is too short...</code></pre>
        </div>
      </div>
      
      </div><p>Technically, the external code may still access the name directly by using <code>user._name</code>. But there is a widely known agreement that properties starting with an underscore <code>"_"</code> are internal and should not be touched from outside the object.</p>
<h2 id="chapter-483">
Using for compatibility</h2>
<p>One of the great ideas behind getters and setters – they allow to take control over a “normal” data property and tweak it at any moment.</p>
<p>For instance, we started implementing user objects using data properties <code>name</code> and <code>age</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name, age) {
  this.name = name;
  this.age = age;
}

let john = new User("John", 25);

alert( john.age ); // 25</code></pre>
        </div>
      </div>
      
      </div><p>…But sooner or later, things may change. Instead of <code>age</code> we may decide to store <code>birthday</code>, because it's more precise and convenient:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name, birthday) {
  this.name = name;
  this.birthday = birthday;
}

let john = new User("John", new Date(1992, 6, 1));</code></pre>
        </div>
      </div>
      
      </div><p>Now what to do with the old code that still uses <code>age</code> property?</p>
<p>We can try to find all such places and fix them, but that takes time and can be hard to do if that code is written by other people. And besides, <code>age</code> is a nice thing to have in <code>user</code>, right? In some places it's just what we want.</p>
<p>Adding a getter for <code>age</code> mitigates the problem:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name, birthday) {
  this.name = name;
  this.birthday = birthday;

  // age is calculated from the current date and birthday
  Object.defineProperty(this, "age", {
    get() {
      let todayYear = new Date().getFullYear();
      return todayYear - this.birthday.getFullYear();
    }
  });
}

let john = new User("John", new Date(1992, 6, 1));

alert( john.birthday ); // birthday is available
alert( john.age );      // ...as well as the age</code></pre>
        </div>
      </div>
      
      </div><p>Now the old code works too and we've got a nice additional property.</p>

<h6 id="chapter-484"></h6>
<h1 class="main__header-title" id="chapter-485">Prototypal inheritance</h1>
<p>In programming, we often want to take something and extend it.</p>
<p>For instance, we have a <code>user</code> object with its properties and methods, and want to make <code>admin</code> and <code>guest</code> as slightly modified variants of it. We'd like to reuse what we have in <code>user</code>, not copy/reimplement its methods, just build a new object on top of it.</p>
<p><em>Prototypal inheritance</em> is a language feature that helps in that.</p>


<h2 id="chapter-486">
[[Prototype]]</h2>
<p>In JavaScript, objects have a special hidden property <code>[[Prototype]]</code> (as named in the specification), that is either <code>null</code> or references another object. That object is called “a prototype”:</p>
      <img src="http://javascript.info/article/prototype-inheritance/object-prototype-empty.png">
<p>That <code>[[Prototype]]</code> has a “magical” meaning. When we want to read a property from <code>object</code>, and it's missing, JavaScript automatically takes it from the prototype. In programming, such thing is called “prototypal inheritance”. Many cool language features and programming techniques are based on it.</p>
<p>The property <code>[[Prototype]]</code> is internal and hidden, but there are many ways to set it.</p>
<p>One of them is to use <code>__proto__</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true
};
let rabbit = {
  jumps: true
};

rabbit.__proto__ = animal;</code></pre>
        </div>
      </div>
      
      </div><p>Please note that <code>__proto__</code> is <em>not the same</em> as <code>[[Prototype]]</code>. That's a getter/setter for it. We'll talk about other ways of setting it later, but for now <code>__proto__</code> will do just fine.</p>
<p>If we look for a property in <code>rabbit</code>, and it's missing, JavaScript automatically takes it from <code>animal</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7,10-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true
};
let rabbit = {
  jumps: true
};

rabbit.__proto__ = animal; // (*)

// we can find both properties in rabbit now:
alert( rabbit.eats ); // true (**)
alert( rabbit.jumps ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Here the line <code>(*)</code> sets <code>animal</code> to be a prototype of <code>rabbit</code>.</p>
<p>Then, when <code>alert</code> tries to read property <code>rabbit.eats</code> <code>(**)</code>, it's not in <code>rabbit</code>, so JavaScript follows the <code>[[Prototype]]</code> reference and finds it in <code>animal</code> (look from the bottom up):</p>
      <img src="http://javascript.info/article/prototype-inheritance/proto-animal-rabbit.png">
<p>Here we can say that "<code>animal</code> is the prototype of <code>rabbit</code>" or "<code>rabbit</code> prototypally inherits from <code>animal</code>".</p>
<p>So if <code>animal</code> has a lot of useful properties and methods, then they become automatically available in <code>rabbit</code>. Such properties are called “inherited”.</p>
<p>If we have a method in <code>animal</code>, it can be called on <code>rabbit</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-4,13-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true,
  walk() {
    alert("Animal walk");
  }
};

let rabbit = {
  jumps: true,
  __proto__: animal
};

// walk is taken from the prototype
rabbit.walk(); // Animal walk</code></pre>
        </div>
      </div>
      
      </div><p>The method is automatically taken from the prototype, like this:</p>
      <img src="http://javascript.info/article/prototype-inheritance/proto-animal-rabbit-walk.png">
<p>The prototype chain can be longer:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true,
  walk() {
    alert("Animal walk");
  }
};

let rabbit = {
  jumps: true,
  __proto__: animal
};

let longEar = {
  earLength: 10,
  __proto__: rabbit
}

// walk is taken from the prototype chain
longEar.walk(); // Animal walk
alert(longEar.jumps); // true (from rabbit)</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/prototype-inheritance/proto-animal-rabbit-chain.png"&gt;
<p>There are actually only two limitations:</p>
<ol>
<li>The references can't go in circles. JavaScript will throw an error if we try to assign <code>__proto__</code> in a circle.</li>
<li>The value of <code>__proto__</code> can be either an object or <code>null</code>. All other values (like primitives) are ignored.</li>
</ol>
<p>Also it may be obvious, but still: there can be only one <code>[[Prototype]]</code>. An object may not inherit from two others.</p>
<h2 id="chapter-487">
Read/write rules</h2>
<p>The prototype is only used for reading properties.</p>
<p>For data properties (not getters/setters) write/delete operations work directly with the object.</p>
<p>In the example below, we assign its own <code>walk</code> method to <code>rabbit</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="11-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true,
  walk() {
    /* this method won't be used by rabbit */
  }
};

let rabbit = {
  __proto__: animal
}

rabbit.walk = function() {
  alert("Rabbit! Bounce-bounce!");
};

rabbit.walk(); // Rabbit! Bounce-bounce!</code></pre>
        </div>
      </div>
      
      </div><p>From now on, <code>rabbit.walk()</code> call finds the method immediately in the object and executes it, without using the prototype:</p>
      <img src="http://javascript.info/article/prototype-inheritance/proto-animal-rabbit-walk-2.png">
<p>For getters/setters – if we read/write a property, they are looked up in the prototype and invoked.</p>
<p>For instance, check out <code>admin.fullName</code> property in the code below:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  surname: "Smith",

  set fullName(value) {
    [this.name, this.surname] = value.split(" ");
  },

  get fullName() {
    return `${this.name} ${this.surname}`;
  }
};

let admin = {
  __proto__: user,
  isAdmin: true
};

alert(admin.fullName); // John Smith (*)

// setter triggers!
admin.fullName = "Alice Cooper"; // (**)</code></pre>
        </div>
      </div>
      
      </div><p>Here in the line <code>(*)</code> the property <code>admin.fullName</code> has a getter in the prototype <code>user</code>, so it is called. And in the line <code>(**)</code> the property has a setter in the prototype, so it is called.</p>
<h2 id="chapter-488">
The value of “this”</h2>
<p>An interesting question may arise in the example above: what's the value of <code>this</code> inside <code>set fullName(value)</code>? Where the properties <code>this.name</code> and <code>this.surname</code> are written: <code>user</code> or <code>admin</code>?</p>
<p>The answer is simple: <code>this</code> is not affected by prototypes at all.</p>
<p><strong>No matter where the method is found: in an object or its prototype. In a method call, <code>this</code> is always the object before the dot.</strong></p>
<p>So, the setter actually uses <code>admin</code> as <code>this</code>, not <code>user</code>.</p>
<p>That is actually a super-important thing, because we may have a big object with many methods and inherit from it. Then we can run its methods on inherited objects and they will modify the state of these objects, not the big one.</p>
<p>For instance, here <code>animal</code> represents a “method storage”, and <code>rabbit</code> makes use of it.</p>
<p>The call <code>rabbit.sleep()</code> sets <code>this.isSleeping</code> on the <code>rabbit</code> object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// animal has methods
let animal = {
  walk() {
    if (!this.isSleeping) {
      alert(`I walk`);
    }
  },
  sleep() {
    this.isSleeping = true;
  }
};

let rabbit = {
  name: "White Rabbit",
  __proto__: animal
};

// modifies rabbit.isSleeping
rabbit.sleep();

alert(rabbit.isSleeping); // true
alert(animal.isSleeping); // undefined (no such property in the prototype)</code></pre>
        </div>
      </div>
      
      </div><p>The resulting picture:</p>
      <img src="http://javascript.info/article/prototype-inheritance/proto-animal-rabbit-walk-3.png">
<p>If we had other objects like <code>bird</code>, <code>snake</code> etc inheriting from <code>animal</code>, they would also gain access to methods of <code>animal</code>. But <code>this</code> in each method would be the corresponding object, evaluated at the call-time (before dot), not <code>animal</code>. So when we write data into <code>this</code>, it is stored into these objects.</p>
<p>As a result, methods are shared, but the object state is not.</p>
<h2 id="chapter-489">
Summary</h2>
<ul>
<li>In JavaScript, all objects have a hidden <code>[[Prototype]]</code> property that's either another object or <code>null</code>.</li>
<li>We can use <code>obj.__proto__</code> to access it (there are other ways too, to be covered soon).</li>
<li>The object referenced by <code>[[Prototype]]</code> is called a “prototype”.</li>
<li>If we want to read a property of <code>obj</code> or call a method, and it doesn't exist, then JavaScript tries to find it in the prototype. Write/delete operations work directly on the object, they don't use the prototype (unless the property is actually a setter).</li>
<li>If we call <code>obj.method()</code>, and the <code>method</code> is taken from the prototype, <code>this</code> still references <code>obj</code>. So methods always work with the current object even if they are inherited.</li>
</ul>
<div class="tasks"><h2 id="chapter-490" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#working-with-prototype" name="working-with-prototype" class="main__anchor">Working with prototype</a></h3>
<a href="http://javascript.info/task/property-after-delete" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Here's the code that creates a pair of objects, then modifies them.</p>
<p>Which values are shown in the process?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  jumps: null
};
let rabbit = {
  __proto__: animal,
  jumps: true
};

alert( rabbit.jumps ); // ? (1)

delete rabbit.jumps;

alert( rabbit.jumps ); // ? (2)

delete animal.jumps;

alert( rabbit.jumps ); // ? (3)</code></pre>
        </div>
      </div>
      
      </div><p>There should be 3 answers.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><ol>
<li><code>true</code>, taken from <code>rabbit</code>.</li>
<li><code>null</code>, taken from <code>animal</code>.</li>
<li><code>undefined</code>, there's no such property any more.</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#searching-algorithm" name="searching-algorithm" class="main__anchor">Searching algorithm</a></h3>
<a href="http://javascript.info/task/search-algorithm" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The task has two parts.</p>
<p>We have an object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let head = {
  glasses: 1
};

let table = {
  pen: 3
};

let bed = {
  sheet: 1,
  pillow: 2
};

let pockets = {
  money: 2000
};</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>Use <code>__proto__</code> to assign prototypes in a way that any property lookup will follow the path: <code>pockets</code> → <code>bed</code> → <code>table</code> → <code>head</code>. For instance, <code>pockets.pen</code> should be <code>3</code> (found in <code>table</code>), and <code>bed.glasses</code> should be <code>1</code> (found in <code>head</code>).</li>
<li>Answer the question: is it faster to get <code>glasses</code> as <code>pocket.glasses</code> or <code>head.glasses</code>? Benchmark if needed.</li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><ol>
<li>
<p>Let's add <code>__proto__</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let head = {
  glasses: 1
};

let table = {
  pen: 3,
  __proto__: head
};

let bed = {
  sheet: 1,
  pillow: 2,
  __proto__: table
};

let pockets = {
  money: 2000,
  __proto__: bed
};

alert( pockets.pen ); // 3
alert( bed.glasses ); // 1
alert( table.money ); // undefined</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>In modern engines, performance-wise, there's no difference whether we take a property from an object or its prototype. They remember where the property was found and reuse it in the next request.</p>
<p>For instance, for <code>pockets.glasses</code> they remember where they found <code>glasses</code> (in <code>head</code>), and next time will search right there. They are also smart enough to update internal caches if something changes, so that optimization is safe.</p>
</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#where-it-writes" name="where-it-writes" class="main__anchor">Where it writes?</a></h3>
<a href="http://javascript.info/task/proto-and-this" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We have <code>rabbit</code> inheriting from <code>animal</code>.</p>
<p>If we call <code>rabbit.eat()</code>, which object receives the <code>full</code> property: <code>animal</code> or <code>rabbit</code>?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eat() {
    this.full = true;
  }
};

let rabbit = {
  __proto__: animal
};

rabbit.eat();</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p><strong>The answer: <code>rabbit</code>.</strong></p>
<p>That's because <code>this</code> is an object before the dot, so <code>rabbit.eat()</code> modifies <code>rabbit</code>.</p>
<p>Property lookup and execution are two different things.
The method <code>rabbit.eat</code> is first found in the prototype, then executed with <code>this=rabbit</code></p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#why-two-hamsters-are-full" name="why-two-hamsters-are-full" class="main__anchor">Why two hamsters are full?</a></h3>
<a href="http://javascript.info/task/hamster-proto" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We have two hamsters: <code>speedy</code> and <code>lazy</code> inheriting from the general <code>hamster</code> object.</p>
<p>When we feed one of them, the other one is also full. Why? How to fix it?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let hamster = {
  stomach: [],

  eat(food) {
    this.stomach.push(food);
  }
};

let speedy = {
  __proto__: hamster
};

let lazy = {
  __proto__: hamster
};

// This one found the food
speedy.eat("apple");
alert( speedy.stomach ); // apple

// This one also has it, why? fix please.
alert( lazy.stomach ); // apple</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Let's look carefully at what's going on in the call <code>speedy.eat("apple")</code>.</p>
<ol>
<li>
<p>The method <code>speedy.eat</code> is found in the prototype (<code>=hamster</code>), then executed with <code>this=speedy</code> (the object before the dot).</p>
</li>
<li>
<p>Then <code>this.stomach.push()</code> needs to find <code>stomach</code> property and call <code>push</code> on it. It looks for <code>stomach</code> in <code>this</code> (<code>=speedy</code>), but nothing found.</p>
</li>
<li>
<p>Then it follows the prototype chain and finds <code>stomach</code> in <code>hamster</code>.</p>
</li>
<li>
<p>Then it calls <code>push</code> on it, adding the food into <em>the stomach of the prototype</em>.</p>
</li>
</ol>
<p>So all hamsters share a single stomach!</p>
<p>Every time the <code>stomach</code> is taken from the prototype, then <code>stomach.push</code> modifies it “at place”.</p>
<p>Please note that such thing doesn't happen in case of a simple assignment <code>this.stomach=</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let hamster = {
  stomach: [],

  eat(food) {
    // assign to this.stomach instead of this.stomach.push
    this.stomach = [food];
  }
};

let speedy = {
   __proto__: hamster
};

let lazy = {
  __proto__: hamster
};

// Speedy one found the food
speedy.eat("apple");
alert( speedy.stomach ); // apple

// Lazy one's stomach is empty
alert( lazy.stomach ); // &lt;nothing&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Now all works fine, because <code>this.stomach=</code> does not perform a lookup of <code>stomach</code>. The value is written directly into <code>this</code> object.</p>
<p>Also we can totally evade the problem by making sure that each hamster has his own stomach:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10,15-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let hamster = {
  stomach: [],

  eat(food) {
    this.stomach.push(food);
  }
};

let speedy = {
  __proto__: hamster,
  stomach: []
};

let lazy = {
  __proto__: hamster,
  stomach: []
};

// Speedy one found the food
speedy.eat("apple");
alert( speedy.stomach ); // apple

// Lazy one's stomach is empty
alert( lazy.stomach ); // &lt;nothing&gt;</code></pre>
        </div>
      </div>
      
      </div><p>As a common solution, all properties that describe the state of a particular object, like <code>stomach</code> above, are usually written into that object. That prevents such problems.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-491"></h6>
<h1 class="main__header-title" id="chapter-492">F.prototype</h1>
<p>In modern JavaScript we can set a prototype using <code>__proto__</code>, as described in the previous article. But it wasn't like that all the time.</p>


<p>JavaScript has had prototypal inheritance from the beginning. It was one of the core features of the language.</p>
<p>But in the old times, there was another (and the only) way to set it: to use a <code>"prototype"</code> property of the constructor function. And there are still many scripts that use it.</p>
<h2 id="chapter-493">
The “prototype” property</h2>
<p>As we know already, <code>new F()</code> creates a new object.</p>
<p>When a new object is created with <code>new F()</code>, the object's <code>[[Prototype]]</code> is set to <code>F.prototype</code>.</p>
<p>In other words, if <code>F</code> has a <code>prototype</code> property with a value of the object type, then <code>new</code> operator uses it to set <code>[[Prototype]]</code> for the new object.</p>
<p>Please note that <code>F.prototype</code> here means a regular property named <code>"prototype"</code> on <code>F</code>. It sounds something similar to the term “prototype”, but here we really mean a regular property with this name.</p>
<p>Here's the example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true
};

function Rabbit(name) {
  this.name = name;
}

Rabbit.prototype = animal;

let rabbit = new Rabbit("White Rabbit"); //  rabbit.__proto__ == animal

alert( rabbit.eats ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Setting <code>Rabbit.prototype = animal</code> literally states the following: "When a <code>new Rabbit</code> is created, assign its <code>[[Prototype]]</code> to <code>animal</code>".</p>
<p>That's the resulting picture:</p>
      <img src="http://javascript.info/article/function-prototype/proto-constructor-animal-rabbit.png">
<p>On the picture, <code>"prototype"</code> is a horizontal arrow, it's a regular property, and <code>[[Prototype]]</code> is vertical, meaning the inheritance of <code>rabbit</code> from <code>animal</code>.</p>
<h2 id="chapter-494">
Default F.prototype, constructor property</h2>
<p>Every function has the <code>"prototype"</code> property even if we don't supply it.</p>
<p>The default <code>"prototype"</code> is an object with the only property <code>constructor</code> that points back to the function itself.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}

/* default prototype
Rabbit.prototype = { constructor: Rabbit };
*/</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/function-prototype/function-prototype-constructor.png"&gt;
<p>We can check it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
// by default:
// Rabbit.prototype = { constructor: Rabbit }

alert( Rabbit.prototype.constructor == Rabbit ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Naturally, if we do nothing, the <code>constructor</code> property is available to all rabbits through  <code>[[Prototype]]</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
// by default:
// Rabbit.prototype = { constructor: Rabbit }

let rabbit = new Rabbit(); // inherits from {constructor: Rabbit}

alert(rabbit.constructor == Rabbit); // true (from prototype)</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/function-prototype/rabbit-prototype-constructor.png"&gt;
<p>We can use <code>constructor</code> property to create a new object using the same constructor as the existing one.</p>
<p>Like here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit(name) {
  this.name = name;
  alert(name);
}

let rabbit = new Rabbit("White Rabbit");

let rabbit2 = new rabbit.constructor("Black Rabbit");</code></pre>
        </div>
      </div>
      
      </div><p>That's handy when we have an object, don't know which constructor was used for it (e.g. it comes from a 3rd party library), and we need to create another one of the same kind.</p>
<p>But probably the most important thing about <code>"constructor"</code> is that…</p>
<p><strong>…JavaScript itself does not ensure the right <code>"constructor"</code> value.</strong></p>
<p>Yes, it exists in the default <code>"prototype"</code> for functions, but that's all. What happens with it later – is totally on us.</p>
<p>In particular, if we replace the default prototype as a whole, then there will be no <code>"constructor"</code> in it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
Rabbit.prototype = {
  jumps: true
};

let rabbit = new Rabbit();
alert(rabbit.constructor === Rabbit); // false</code></pre>
        </div>
      </div>
      
      </div><p>So, to keep the right <code>"constructor"</code> we can choose to add/remove properties to the default <code>"prototype"</code> instead of overwriting it as a whole:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}

// Not overwrite Rabbit.prototype totally
// just add to it
Rabbit.prototype.jumps = true
// the default Rabbit.prototype.constructor is preserved</code></pre>
        </div>
      </div>
      
      </div><p>Or, alternatively, recreate the <code>constructor</code> property it manually:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Rabbit.prototype = {
  jumps: true,
  constructor: Rabbit
};

// now constructor is also correct, because we added it</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-495">
Summary</h2>
<p>In this chapter we briefly described the way of setting a <code>[[Prototype]]</code> for objects created via a constructor function. Later we'll see more advanced programming patterns that rely on it.</p>
<p>Everything is quite simple, just few notes to make things clear:</p>
<ul>
<li>The <code>F.prototype</code> property is not the same as <code>[[Prototype]]</code>. The only thing <code>F.prototype</code> does: it sets <code>[[Prototype]]</code> of new objects when <code>new F()</code> is called.</li>
<li>The value of <code>F.prototype</code> should be either an object or null: other values won't work.</li>
<li>The <code>"prototype"</code> property only has such a special effect when is set to a constructor function, and invoked with <code>new</code>.</li>
</ul>
<p>On regular objects the <code>prototype</code> is nothing special:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  name: "John",
  prototype: "Bla-bla" // no magic at all
};</code></pre>
        </div>
      </div>
      
      </div><p>By default all functions have <code>F.prototype = { constructor: F }</code>, so we can get the constructor of an object by accessing its <code>"constructor"</code> property.</p>
<div class="tasks"><h2 id="chapter-496" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title">
<a href="#changing-prototype" name="changing-prototype" class="main__anchor">Changing "prototype"</a></h3>
<a href="http://javascript.info/task/changing-prototype" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>In the code below we create <code>new Rabbit</code>, and then try to modify its prototype.</p>
<p>In the start, we have this code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
Rabbit.prototype = {
  eats: true
};

let rabbit = new Rabbit();

alert( rabbit.eats ); // true</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>
<p>We added one more string (emphasized), what <code>alert</code> shows now?</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
Rabbit.prototype = {
  eats: true
};

let rabbit = new Rabbit();

Rabbit.prototype = {};

alert( rabbit.eats ); // ?</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>…And if the code is like this (replaced one line)?</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
Rabbit.prototype = {
  eats: true
};

let rabbit = new Rabbit();

Rabbit.prototype.eats = false;

alert( rabbit.eats ); // ?</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Like this (replaced one line)?</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
Rabbit.prototype = {
  eats: true
};

let rabbit = new Rabbit();

delete rabbit.eats;

alert( rabbit.eats ); // ?</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>The last variant:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
Rabbit.prototype = {
  eats: true
};

let rabbit = new Rabbit();

delete Rabbit.prototype.eats;

alert( rabbit.eats ); // ?</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Answers:</p>
<ol>
<li>
<p><code>true</code>.</p>
<p>The assignment to <code>Rabbit.prototype</code> sets up <code>[[Prototype]]</code> for new objects, but it does not affect the existing ones.</p>
</li>
<li>
<p><code>false</code>.</p>
<p>Objects are assigned by reference. The object from <code>Rabbit.prototype</code> is not duplicated, it's still a single object is referenced both by <code>Rabbit.prototype</code> and by the <code>[[Prototype]]</code> of <code>rabbit</code>.</p>
<p>So when we change its content through one reference, it is visible through the other one.</p>
</li>
<li>
<p><code>true</code>.</p>
<p>All <code>delete</code> operations are applied directly to the object. Here <code>delete rabbit.eats</code> tries to remove <code>eats</code> property from <code>rabbit</code>, but it doesn't have it. So the operation won't have any effect.</p>
</li>
<li>
<p><code>undefined</code>.</p>
<p>The property <code>eats</code> is deleted from the prototype, it doesn't exist any more.</p>
</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-an-object-with-the-same-constructor" name="create-an-object-with-the-same-constructor" class="main__anchor">Create an object with the same constructor</a></h3>
<a href="http://javascript.info/task/new-object-same-constructor" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Imagine, we have an arbitrary object <code>obj</code>, created by a constructor function – we don't know which one, but we'd like to create a new object using it.</p>
<p>Can we do it like that?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj2 = new obj.constructor();</code></pre>
        </div>
      </div>
      
      </div><p>Give an example of a constructor function for <code>obj</code> which lets such code work right. And an example that makes it work wrong.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We can use such approach if we are sure that <code>"constructor"</code> property has the correct value.</p>
<p>For instance, if we don't touch the default <code>"prototype"</code>, then this code works for sure:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name) {
  this.name = name;
}

let user = new User('John');
let user2 = new user.constructor('Pete');

alert( user2.name ); // Pete (worked!)</code></pre>
        </div>
      </div>
      
      </div><p>It worked, because <code>User.prototype.constructor == User</code>.</p>
<p>…But if someone, so to say, overwrites <code>User.prototype</code> and forgets to recreate <code>"constructor"</code>, then it would fail.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name) {
  this.name = name;
}
User.prototype = {}; // (*)

let user = new User('John');
let user2 = new user.constructor('Pete');

alert( user2.name ); // undefined</code></pre>
        </div>
      </div>
      
      </div><p>Why <code>user2.name</code> is <code>undefined</code>?</p>
<p>Here's how <code>new user.constructor('Pete')</code> works:</p>
<ol>
<li>First, it looks for <code>constructor</code> in <code>user</code>. Nothing.</li>
<li>Then it follows the prototype chain. The prototype of <code>user</code> is <code>User.prototype</code>, and it also has nothing.</li>
<li>The value of <code>User.prototype</code> is a plain object <code>{}</code>, its prototype is <code>Object.prototype</code>. And there is <code>Object.prototype.constructor == Object</code>. So it is used.</li>
</ol>
<p>At the end, we have <code>let user2 = new Object('Pete')</code>. The built-in <code>Object</code> constructor ignores arguments, it always creates an empty object – that's what we have in <code>user2</code> after all.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-497"></h6>
<h1 class="main__header-title" id="chapter-498">Native prototypes</h1>
<p>The <code>"prototype"</code> property is widely used by the core of JavaScript itself. All built-in constructor functions use it.</p>
<p>We'll see how it is for plain objects first, and then for more complex ones.</p>
<h2 id="chapter-499">
Object.prototype</h2>
<p>Let's say we output an empty object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {};
alert( obj ); // "[object Object]" ?</code></pre>
        </div>
      </div>
      
      </div><p>Where's the code that generates the string <code>"[object Object]"</code>? That's a built-in <code>toString</code> method, but where is it? The <code>obj</code> is empty!</p>
<p>…But the short notation <code>obj = {}</code> is the same as <code>obj = new Object()</code>, where <code>Object</code> – is a built-in object constructor function. And that function has <code>Object.prototype</code> that references a huge object with <code>toString</code> and other functions.</p>
<p>Like this (all that is built-in):</p>
      <img src="http://javascript.info/article/native-prototypes/object-prototype.png">
<p>When <code>new Object()</code> is called (or a literal object <code>{...}</code> is created), the <code>[[Prototype]]</code> of it is set to <code>Object.prototype</code> by the rule that we've discussed in the previous chapter:</p>
      <img src="http://javascript.info/article/native-prototypes/object-prototype-1.png">
<p>Afterwards when <code>obj.toString()</code> is called – the method is taken from <code>Object.prototype</code>.</p>
<p>We can check it like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {};

alert(obj.__proto__ === Object.prototype); // true
// obj.toString === obj.__proto__.toString == Object.prototype.toString</code></pre>
        </div>
      </div>
      
      </div><p>Please note that there is no additional <code>[[Prototype]]</code> in the chain above <code>Object.prototype</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(Object.prototype.__proto__); // null</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-500">
Other built-in prototypes</h2>
<p>Other built-in objects such as <code>Array</code>, <code>Date</code>, <code>Function</code> and others also keep methods in prototypes.</p>
<p>For instance, when we create an array <code>[1, 2, 3]</code>, the default <code>new Array()</code> constructor is  used internally. So the array data is written into the new object, and <code>Array.prototype</code> becomes its prototype and provides methods. That's very memory-efficient.</p>
<p>By specification, all built-in prototypes have <code>Object.prototype</code> on the top. Sometimes people say that “everything inherits from objects”.</p>
<p>Here's the overall picture (for 3 built-ins to fit):</p>
      <img src="http://javascript.info/article/native-prototypes/native-prototypes-classes.png">
<p>Let's check the prototypes manually:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3];

// it inherits from Array.prototype?
alert( arr.__proto__ === Array.prototype ); // true

// then from Object.prototype?
alert( arr.__proto__.__proto__ === Object.prototype ); // true

// and null on the top.
alert( arr.__proto__.__proto__.__proto__ ); // null</code></pre>
        </div>
      </div>
      
      </div><p>Some methods in prototypes may overlap, for instance, <code>Array.prototype</code> has its own <code>toString</code> that lists comma-delimited elements:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3]
alert(arr); // 1,2,3 &lt;-- the result of Array.prototype.toString</code></pre>
        </div>
      </div>
      
      </div><p>As we've seen before, <code>Object.prototype</code> has <code>toString</code> as well, but <code>Array.prototype</code> is closer in the chain, so the array variant is used.</p>
      <img src="http://javascript.info/article/native-prototypes/native-prototypes-array-tostring.png">
<p>In-browser tools like Chrome developer console also show inheritance (may need to use <code>console.dir</code> for built-in objects):</p>
      <img src="http://javascript.info/article/native-prototypes/console_dir_array.png">
<p>Other built-in objects also work the same way. Even functions. They are objects of a built-in <code>Function</code> constructor, and their methods: <code>call/apply</code> and others are taken from <code>Function.prototype</code>. Functions have their own <code>toString</code> too.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {}

alert(f.__proto__ == Function.prototype); // true
alert(f.__proto__.__proto__ == Object.prototype); // true, inherit from objects</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-501">
Primitives</h2>
<p>The most intricate thing happens with strings, numbers and booleans.</p>
<p>As we remember, they are not objects. But if we try to access their properties, then temporary wrapper objects are created using built-in constructors <code>String</code>, <code>Number</code>, <code>Boolean</code>, they provide the methods and disappear.</p>
<p>These objects are created invisibly to us and most engines optimize them out, but the specification describes it exactly this way. Methods of these objects also reside in prototypes, available as <code>String.prototype</code>, <code>Number.prototype</code> and <code>Boolean.prototype</code>.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Values <code>null</code> and <code>undefined</code> have no object wrappers</span></div>
            <div class="important__content"><p>Special values <code>null</code> and <code>undefined</code> stand apart. They have no object wrappers, so methods and properties are not available for them. And there are no corresponding prototypes too.</p>
</div></div>
<h2 id="chapter-502">
Changing native prototypes</h2>
<p>Native prototypes can be modified. For instance, if we add a method to <code>String.prototype</code>,  it becomes available to all strings:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">String.prototype.show = function() {
  alert(this);
};

"BOOM!".show(); // BOOM!</code></pre>
        </div>
      </div>
      
      </div><p>During the process of development we may have ideas which new built-in methods we'd like to have. And there may be a slight temptation to add them to native prototypes. But that is generally a bad idea.</p>
<p>Prototypes are global, so it's easy to get a conflict. If two libraries add a method <code>String.prototype.show</code>, then one of them overwrites the other one.</p>
<p>In modern programming, there is only one case when modifying native prototypes is approved. That's polyfills. In other words, if there's a method in JavaScript specification that is not yet supported by our JavaScript engine (or any of those that we want to support), then may implement it manually and populate the built-in prototype with it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (!String.prototype.repeat) { // if there's no such method
  // add it to the prototype

  String.prototype.repeat = function(n) {
    // repeat the string n times

    // actually, the code should be more complex than that,
    // throw errors for negative values of "n"
    // the full algorithm is in the specification
    return new Array(n + 1).join(this);
  };
}

alert( "La".repeat(3) ); // LaLaLa</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-503">
Borrowing from prototypes</h2>
<p>In the chapter 
<a href="http://javascript.info/call-apply-decorators#method-borrowing">Decorators and forwarding, call/apply</a> we talked about method borrowing:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showArgs() {
  // borrow join from array and call in the context of arguments
  alert( [].join.call(arguments, " - ") );
}

showArgs("John", "Pete", "Alice"); // John - Pete - Alice</code></pre>
        </div>
      </div>
      
      </div><p>Because <code>join</code> resides in <code>Array.prototype</code>, we can call it from there directly and rewrite it as:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function showArgs() {
  alert( Array.prototype.join.call(arguments, " - ") );
}</code></pre>
        </div>
      </div>
      
      </div><p>That's more efficient, because it avoids the creation of an extra array object <code>[]</code>. On the other hand, it is longer to write.</p>
<h2 id="chapter-504">
Summary</h2>
<ul>
<li>All built-in objects follow the same pattern:
<ul>
<li>The methods are stored in the prototype (<code>Array.prototype</code>, <code>Object.prototype</code>, <code>Date.prototype</code> etc).</li>
<li>The object itself stores only the data (array items, object properties, the date).</li>
</ul>
</li>
<li>Primitives also store methods in prototypes of wrapper objects: <code>Number.prototype</code>, <code>String.prototype</code>, <code>Boolean.prototype</code>. There are no wrapper objects only for <code>undefined</code> and <code>null</code>.</li>
<li>Built-in prototypes can be modified or populated with new methods. But it's not recommended to change them. Probably the only allowable cause is when we add-in a new standard, but not yet supported by the engine JavaScript method.</li>
</ul>
<div class="tasks"><h2 id="chapter-505" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#add-method-f-defer-ms-to-functions" name="add-method-f-defer-ms-to-functions" class="main__anchor">Add method "f.defer(ms)" to functions</a></h3>
<a href="http://javascript.info/task/defer-to-prototype" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Add to the prototype of all functions the method <code>defer(ms)</code>, that runs the function after <code>ms</code> milliseconds.</p>
<p>After you do it, such code should work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  alert("Hello!");
}

f.defer(1000); // shows "Hello!" after 1 second</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Function.prototype.defer = function(ms) {
  setTimeout(this, ms);
};

function f() {
  alert("Hello!");
}

f.defer(1000); // shows "Hello!" after 1 sec</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#add-the-decorating-defer-to-functions" name="add-the-decorating-defer-to-functions" class="main__anchor">Add the decorating "defer()" to functions</a></h3>
<a href="http://javascript.info/task/defer-to-prototype-extended" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Add to the prototype of all functions the method <code>defer(ms)</code>, that returns a wrapper, delaying the call by <code>ms</code> milliseconds.</p>
<p>Here's an example of how it should work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(a, b) {
  alert( a + b );
}

f.defer(1000)(1, 2); // shows 3 after 1 second</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the arguments should be passed to the original function.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Function.prototype.defer = function(ms) {
  let f = this;
  return function(...args) {
    setTimeout(() =&gt; f.apply(this, args), ms);
  }
};

// check it
function f(a, b) {
  alert( a + b );
}

f.defer(1000)(1, 2); // shows 3 after 1 sec</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-506"></h6>
<h1 class="main__header-title" id="chapter-507">Methods for prototypes</h1>
<p>In this chapter we cover additional methods to work with a prototype.</p>
<p>There are also other ways to get/set a prototype, besides those that we already know:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create">Object.create(proto[, descriptors])</a> – creates an empty object with given <code>proto</code> as <code>[[Prototype]]</code> and optional property descriptors.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object.getPrototypeOf">Object.getPrototypeOf(obj)</a> – returns the <code>[[Prototype]]</code> of <code>obj</code>.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object.setPrototypeOf">Object.setPrototypeOf(obj, proto)</a> – sets the <code>[[Prototype]]</code> of <code>obj</code> to <code>proto</code>.</li>
</ul>


<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5,8-8,10-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true
};

// create a new object with animal as a prototype
let rabbit = Object.create(animal);

alert(rabbit.eats); // true
alert(Object.getPrototypeOf(rabbit) === animal); // get the prototype of rabbit

Object.setPrototypeOf(rabbit, {}); // change the prototype of rabbit to {}</code></pre>
        </div>
      </div>
      
      </div><p><code>Object.create</code> has an optional second argument: property descriptors. We can provide additional properties to the new object there, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true
};

let rabbit = Object.create(animal, {
  jumps: {
    value: true
  }
});

alert(rabbit.jumps); // true</code></pre>
        </div>
      </div>
      
      </div><p>The descriptors are in the same format as described in the chapter 
<a href="http://javascript.info/property-descriptors">Property flags and descriptors</a>.</p>
<p>We can use <code>Object.create</code> to perform an object cloning more powerful than copying properties in <code>for..in</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// fully identical shallow clone of obj
let clone = Object.create(Object.getPrototypeOf(obj), Object.getOwnPropertyDescriptors(obj));</code></pre>
        </div>
      </div>
      
      </div><p>This call makes a truly exact copy of <code>obj</code>, including all properties: enumerable and non-enumerable, data properties and setters/getters – everything, and with the right <code>[[Prototype]]</code>.</p>
<h2 id="chapter-508">
Brief history</h2>
<p>If we count all the ways to manage <code>[[Prototype]]</code>, there's a lot! Many ways to do the same!</p>
<p>Why so?</p>
<p>That's for historical reasons.</p>
<ul>
<li>The <code>"prototype"</code> property of a constructor function works since very ancient times.</li>
<li>Later in the year 2012: <code>Object.create</code> appeared in the standard. It allowed to create objects with the given prototype, but did not allow to get/set it. So browsers implemented non-standard <code>__proto__</code> accessor that allowed to get/set a prototype at any time.</li>
<li>Later in the year 2015: <code>Object.setPrototypeOf</code> and <code>Object.getPrototypeOf</code> were added to the standard. The <code>__proto__</code> was de-facto implemented everywhere, so it made its way to the Annex B of the standard, that is optional for non-browser environments.</li>
</ul>
<p>As of now we have all these ways at our disposal.</p>
<p>Technically, we can get/set <code>[[Prototype]]</code> at any time. But usually we only set it once at the object creation time, and then do not modify: <code>rabbit</code> inherits from <code>animal</code>, and that is not going to change. And JavaScript engines are highly optimized to that. Changing a prototype “on-the-fly” with <code>Object.setPrototypeOf</code> or <code>obj.__proto__=</code> is a very slow operation. But it is possible.</p>
<h2 id="chapter-509">
“Very plain” objects</h2>
<p>As we know, objects can be used as associative arrays to store key/value pairs.</p>
<p>…But if we try to store <em>user-provided</em> keys in it (for instance, a user-entered dictionary), we can see an interesting glitch: all keys work fine except <code>"__proto__"</code>.</p>
<p>Check out the example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {};

let key = prompt("What's the key?", "__proto__");
obj[key] = "some value";

alert(obj[key]); // [object Object], not "some value"!</code></pre>
        </div>
      </div>
      
      </div><p>Here if the user types in <code>__proto__</code>, the assignment is ignored!</p>
<p>That shouldn't surprise us. The <code>__proto__</code> property is special: it must be either an object or <code>null</code>, a string can not become a prototype.</p>
<p>But we did not intend to implement such behavior, right? We want to store key/value pairs, and the key named <code>"__proto__"</code> was not properly saved. So that's a bug. Here the consequences are not terrible. But in other cases the prototype may indeed be changed, so the execution may go wrong in totally unexpected ways.</p>
<p>What's worst – usually developers do not think about such possibility at all. That makes such bugs hard to notice and even turn them into vulnerabilities, especially when JavaScript is used on server-side.</p>
<p>Such thing happens only with <code>__proto__</code>. All other properties are “assignable” normally.</p>
<p>How to evade the problem?</p>
<p>First, we can just switch to using <code>Map</code>, then everything's fine.</p>
<p>But <code>Object</code> also can serve us well here, because language creators gave a thought to that problem long ago.</p>
<p>The <code>__proto__</code> is not a property of an object, but an accessor property of <code>Object.prototype</code>:</p>
      <img src="http://javascript.info/article/prototype-methods/object-prototype-2.png">
<p>So, if <code>obj.__proto__</code> is read or assigned, the corresponding getter/setter is called from its prototype, and it gets/sets <code>[[Prototype]]</code>.</p>
<p>As it was said in the beginning: <code>__proto__</code> is a way to access <code>[[Prototype]]</code>, it is not <code>[[Prototype]]</code> itself.</p>
<p>Now, if we want to use an object as an associative array, we can do it with a little trick:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = Object.create(null);

let key = prompt("What's the key?", "__proto__");
obj[key] = "some value";

alert(obj[key]); // "some value"</code></pre>
        </div>
      </div>
      
      </div><p><code>Object.create(null)</code> creates an empty object without a prototype (<code>[[Prototype]]</code> is <code>null</code>):</p>
      <img src="http://javascript.info/article/prototype-methods/object-prototype-null.png">
<p>So, there is no inherited getter/setter for <code>__proto__</code>. Now it is processed as a regular data property, so the example above works right.</p>
<p>We can call such object “very plain” or “pure dictionary objects”, because they are even simpler than regular plain object <code>{...}</code>.</p>
<p>A downside is that such objects lack any built-in object methods, e.g. <code>toString</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = Object.create(null);

alert(obj); // Error (no toString)</code></pre>
        </div>
      </div>
      
      </div><p>…But that's usually fine for associative arrays.</p>
<p>Please note that most object-related methods are <code>Object.something(...)</code>, like <code>Object.keys(obj)</code> – they are not in the prototype, so they will keep working on such objects:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let chineseDictionary = Object.create(null);
chineseDictionary.hello = "ni hao";
chineseDictionary.bye = "zai jian";

alert(Object.keys(chineseDictionary)); // hello,bye</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-510">
Getting all properties</h2>
<p>There are many ways to get keys/values from an object.</p>
<p>We already know these ones:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys">Object.keys(obj)</a> / 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/values">Object.values(obj)</a> / 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">Object.entries(obj)</a> – returns an array of enumerable own string property names/values/key-value pairs. These methods only list <em>enumerable</em> properties, and those that have <em>strings as keys</em>.</li>
</ul>
<p>If we want symbolic properties:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols(obj)</a> – returns an array of all own symbolic property names.</li>
</ul>
<p>If we want non-enumerable properties:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">Object.getOwnPropertyNames(obj)</a> – returns an array of all own string property names.</li>
</ul>
<p>If we want <em>all</em> properties:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys">Reflect.ownKeys(obj)</a> – returns an array of all own property names.</li>
</ul>
<p>These methods are a bit different about which properties they return, but all of them operate on the object itself. Properties from the prototype are not listed.</p>
<p>The <code>for..in</code> loop is different: it loops over inherited properties too.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="9-10,12-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true
};

let rabbit = {
  jumps: true,
  __proto__: animal
};

// only own keys
alert(Object.keys(rabbit)); // jumps

// inherited keys too
for(let prop in rabbit) alert(prop); // jumps, then eats</code></pre>
        </div>
      </div>
      
      </div><p>If we want to distinguish inherited properties, there's a built-in method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty">obj.hasOwnProperty(key)</a>: it returns <code>true</code> if <code>obj</code> has its own (not inherited) property named <code>key</code>.</p>
<p>So we can filter out inherited properties (or do something else with them):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eats: true
};

let rabbit = {
  jumps: true,
  __proto__: animal
};

for(let prop in rabbit) {
  let isOwn = rabbit.hasOwnProperty(prop);
  alert(`${prop}: ${isOwn}`); // jumps:true, then eats:false
}</code></pre>
        </div>
      </div>
      
      </div><p>Here we have the following inheritance chain: <code>rabbit</code>, then <code>animal</code>, then <code>Object.prototype</code> (because <code>animal</code> is a literal object <code>{...}</code>, so it's by default), and then <code>null</code> above it:</p>
      <img src="http://javascript.info/article/prototype-methods/rabbit-animal-object.png">
<p>Note, there's one funny thing. Where is the method <code>rabbit.hasOwnProperty</code> coming from? Looking at the chain we can see that the method is provided by <code>Object.prototype.hasOwnProperty</code>. In other words, it's inherited.</p>
<p>…But why <code>hasOwnProperty</code> does not appear in <code>for..in</code> loop, if it lists all inherited properties?  The answer is simple: it's not enumerable. Just like all other properties of <code>Object.prototype</code>. That's why they are not listed.</p>
<h2 id="chapter-511">
Summary</h2>
<p>Here's a brief list of methods we discussed in this chapter – as a recap:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create">Object.create(proto[, descriptors])</a> – creates an empty object with given <code>proto</code> as <code>[[Prototype]]</code> (can be <code>null</code>) and optional property descriptors.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object.getPrototypeOf">Object.getPrototypeOf(obj)</a> – returns the <code>[[Prototype]]</code> of <code>obj</code> (same as <code>__proto__</code> getter).</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object.setPrototypeOf">Object.setPrototypeOf(obj, proto)</a> – sets the <code>[[Prototype]]</code> of <code>obj</code> to <code>proto</code> (same as <code>__proto__</code> setter).</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys">Object.keys(obj)</a> / 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/values">Object.values(obj)</a> / 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">Object.entries(obj)</a> – returns an array of enumerable own string property names/values/key-value pairs.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols(obj)</a> – returns an array of all own symbolic property names.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">Object.getOwnPropertyNames(obj)</a> – returns an array of all own string property names.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys">Reflect.ownKeys(obj)</a> – returns an array of all own property names.</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty">obj.hasOwnProperty(key)</a>: it returns <code>true</code> if <code>obj</code> has its own (not inherited) property named <code>key</code>.</li>
</ul>
<p>We also made it clear that <code>__proto__</code> is a getter/setter for <code>[[Prototype]]</code> and resides in <code>Object.prototype</code>, just as other methods.</p>
<p>We can create an object without a prototype by <code>Object.create(null)</code>. Such objects are used as “pure dictionaries”, they have no issues with <code>"__proto__"</code> as the key.</p>
<p>All methods that return object properties (like <code>Object.keys</code> and others) – return “own” properties. If we want inherited ones, then we can use <code>for..in</code>.</p>
<div class="tasks"><h2 id="chapter-512" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#add-tostring-to-the-dictionary" name="add-tostring-to-the-dictionary" class="main__anchor">Add toString to the dictionary</a></h3>
<a href="http://javascript.info/task/dictionary-tostring" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's an object <code>dictionary</code>, created as <code>Object.create(null)</code>, to store any <code>key/value</code> pairs.</p>
<p>Add method <code>dictionary.toString()</code> into it, that should return a comma-delimited list of keys. Your <code>toString</code> should not show up in <code>for..in</code> over the object.</p>
<p>Here's how it should work:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let dictionary = Object.create(null);

// your code to add dictionary.toString method

// add some data
dictionary.apple = "Apple";
dictionary.__proto__ = "test"; // __proto__ is a regular property key here

// only apple and __proto__ are in the loop
for(let key in dictionary) {
  alert(key); // "apple", then "__proto__"
}

// your toString in action
alert(dictionary); // "apple,__proto__"</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The method can take all enumerable keys using <code>Object.keys</code> and output their list.</p>
<p>To make <code>toString</code> non-enumerable, let's define it using a property descriptor. The syntax of <code>Object.create</code> allows to provide an object with property descriptors as the second argument.</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let dictionary = Object.create(null, {
  toString: { // define toString property
    value() { // the value is a function
      return Object.keys(this).join();
    }
  }
});

dictionary.apple = "Apple";
dictionary.__proto__ = "test";

// apple and __proto__ is in the loop
for(let key in dictionary) {
  alert(key); // "apple", then "__proto__"
}

// comma-separated list of properties by toString
alert(dictionary); // "apple,__proto__"</code></pre>
        </div>
      </div>
      
      </div><p>When we create a property using a descriptor, its flags are <code>false</code> by default. So in the code above, <code>dictionary.toString</code> is non-enumerable.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#the-difference-beteeen-calls" name="the-difference-beteeen-calls" class="main__anchor">The difference beteeen calls</a></h3>
<a href="http://javascript.info/task/compare-calls" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Let's create a new <code>rabbit</code> object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit(name) {
  this.name = name;
}
Rabbit.prototype.sayHi = function() {
  alert(this.name);
};

let rabbit = new Rabbit("Rabbit");</code></pre>
        </div>
      </div>
      
      </div><p>These calls do the same thing or not?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">rabbit.sayHi();
Rabbit.prototype.sayHi();
Object.getPrototypeOf(rabbit).sayHi();
rabbit.__proto__.sayHi();</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The first call has <code>this == rabbit</code>, the other ones have <code>this</code> equal to <code>Rabbit.prototype</code>, because it's actually the object before the dot.</p>
<p>So only the first call shows <code>Rabbit</code>, other ones show <code>undefined</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit(name) {
  this.name = name;
}
Rabbit.prototype.sayHi = function() {
  alert( this.name );
}

let rabbit = new Rabbit("Rabbit");

rabbit.sayHi();                        // Rabbit
Rabbit.prototype.sayHi();              // undefined
Object.getPrototypeOf(rabbit).sayHi(); // undefined
rabbit.__proto__.sayHi();              // undefined</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-513"></h6>
<h1 class="main__header-title" id="chapter-514">Class patterns</h1>
<blockquote class="quote"><div class="quote__i"><div class="quote__text"><p>In object-oriented programming, a <em>class</em> is an extensible program-code-template for creating objects, providing initial values for state (member variables) and implementations of behavior (member functions or methods).</p>
</div></div><footer class="quote__footer">
        <cite class="quote__author">Wikipedia</cite>
       </footer></blockquote><p>There's a special syntax construct and a keyword <code>class</code> in JavaScript. But before studying it, we should consider that the term “class” comes from the theory of object-oriented programming. The definition is cited above, and it's language-independent.</p>
<p>In JavaScript there are several well-known programming patterns to make classes even without using the <code>class</code> keyword. And here we'll talk about them first.</p>
<p>The <code>class</code> construct will be described in the next chapter, but in JavaScript it's a “syntax sugar” and an extension of one of the patterns that we'll study here.</p>


<h2 id="chapter-515">
Functional class pattern</h2>
<p>The constructor function below can be considered a “class” according to the definition:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name) {
  this.sayHi = function() {
    alert(name);
  };
}

let user = new User("John");
user.sayHi(); // John</code></pre>
        </div>
      </div>
      
      </div><p>It follows all parts of the definition:</p>
<ol>
<li>It is a “program-code-template” for creating objects (callable with <code>new</code>).</li>
<li>It provides initial values for the state (<code>name</code> from parameters).</li>
<li>It provides methods (<code>sayHi</code>).</li>
</ol>
<p>This is called <em>functional class pattern</em>.</p>
<p>In the functional class pattern, local variables and nested functions inside <code>User</code>, that are not assigned to <code>this</code>, are visible from inside, but not accessible by the outer code.</p>
<p>So we can easily add internal functions and variables, like <code>calcAge()</code> here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name, birthday) {
  // only visible from other methods inside User
  function calcAge() {
    return new Date().getFullYear() - birthday.getFullYear();
  }

  this.sayHi = function() {
    alert(`${name}, age:${calcAge()}`);
  };
}

let user = new User("John", new Date(2000, 0, 1));
user.sayHi(); // John, age:17</code></pre>
        </div>
      </div>
      
      </div><p>In this code variables <code>name</code>, <code>birthday</code> and the function <code>calcAge()</code> are internal, <em>private</em> to the object. They are only visible from inside of it.</p>
<p>On the other hand, <code>sayHi</code> is the external, <em>public</em> method. The external code that creates <code>user</code> can access it.</p>
<p>This way we can hide internal implementation details and helper methods from the outer code. Only what's assigned to <code>this</code> becomes visible outside.</p>
<h2 id="chapter-516">
Factory class pattern</h2>
<p>We can create a class without using <code>new</code> at all.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="13-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name, birthday) {
  // only visible from other methods inside User
  function calcAge() {
    return new Date().getFullYear() - birthday.getFullYear();
  }

  return {
    sayHi() {
      alert(`${name}, age:${calcAge()}`);
    }
  };
}

let user = User("John", new Date(2000, 0, 1));
user.sayHi(); // John, age:17</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, the function <code>User</code> returns an object with public properties and methods. The only benefit of this method is that we can omit <code>new</code>: write <code>let user = User(...)</code> instead of <code>let user = new User(...)</code>. In other aspects it's almost the same as the functional pattern.</p>
<h2 id="chapter-517">
Prototype-based classes</h2>
<p>Prototype-based classes are the most important and generally the best. Functional and factory class patterns are rarely used in practice.</p>
<p>Soon you'll see why.</p>
<p>Here's the same class rewritten using prototypes:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-2,5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name, birthday) {
  this._name = name;
  this._birthday = birthday;
}

User.prototype._calcAge = function() {
  return new Date().getFullYear() - this._birthday.getFullYear();
};

User.prototype.sayHi = function() {
  alert(`${this._name}, age:${this._calcAge()}`);
};

let user = new User("John", new Date(2000, 0, 1));
user.sayHi(); // John, age:17</code></pre>
        </div>
      </div>
      
      </div><p>The code structure:</p>
<ul>
<li>The constructor <code>User</code> only initializes the current object state.</li>
<li>Methods are added to <code>User.prototype</code>.</li>
</ul>
<p>As we can see, methods are lexically not inside <code>function User</code>, they do not share a common lexical environment. If we declare variables inside <code>function User</code>, then they won't be visible to methods.</p>
<p>So, there is a widely known agreement that internal properties and methods are prepended with an underscore <code>"_"</code>. Like <code>_name</code> or <code>_calcAge()</code>. Technically, that's just an agreement, the outer code still can access them. But most developers recognize the meaning of <code>"_"</code> and try not to touch prefixed properties and methods in the external code.</p>
<p>Here are the advantages over the functional pattern:</p>
<ul>
<li>In the functional pattern, each object has its own copy of every method. We assign a separate copy of <code>this.sayHi = function() {...}</code> and other methods in the constructor.</li>
<li>In the prototypal pattern, all methods are in <code>User.prototype</code> that is shared between all user objects. An object itself only stores the data.</li>
</ul>
<p>So the prototypal pattern is more memory-efficient.</p>
<p>…But not only that. Prototypes allow us to setup the inheritance in a really efficient way. Built-in JavaScript objects all use prototypes. Also there's a special syntax construct: “class” that provides nice-looking syntax for them. And there's more, so let's go on with them.</p>
<h2 id="chapter-518">
Prototype-based inheritance for classes</h2>
<p>Let's say we have two prototype-based classes.</p>
<p><code>Rabbit</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit(name) {
  this.name = name;
}

Rabbit.prototype.jump = function() {
  alert(`${this.name} jumps!`);
};

let rabbit = new Rabbit("My rabbit");</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/class-patterns/rabbit-animal-independent-1.png"&gt;
<p>…And <code>Animal</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Animal(name) {
  this.name = name;
}

Animal.prototype.eat = function() {
  alert(`${this.name} eats.`);
};

let animal = new Animal("My animal");</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/class-patterns/rabbit-animal-independent-2.png"&gt;
<p>Right now they are fully independent.</p>
<p>But we'd want <code>Rabbit</code> to extend <code>Animal</code>. In other words, rabbits should be based on animals, have access to methods of <code>Animal</code> and extend them with its own methods.</p>
<p>What does it mean in the language of prototypes?</p>
<p>Right now methods for <code>rabbit</code> objects are in <code>Rabbit.prototype</code>. We'd like <code>rabbit</code> to use <code>Animal.prototype</code> as a “fallback”, if the method is not found in <code>Rabbit.prototype</code>.</p>
<p>So the prototype chain should be <code>rabbit</code> → <code>Rabbit.prototype</code> → <code>Animal.prototype</code>.</p>
<p>Like this:</p>
      <img src="http://javascript.info/article/class-patterns/class-inheritance-rabbit-animal.png">
<p>The code to implement that:</p>
<div data-trusted="1" class="code-example" data-highlight-block="19-20,23-23">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Same Animal as before
function Animal(name) {
  this.name = name;
}

// All animals can eat, right?
Animal.prototype.eat = function() {
  alert(`${this.name} eats.`);
};

// Same Rabbit as before
function Rabbit(name) {
  this.name = name;
}

Rabbit.prototype.jump = function() {
  alert(`${this.name} jumps!`);
};

// setup the inheritance chain
Rabbit.prototype.__proto__ = Animal.prototype; // (*)

let rabbit = new Rabbit("White Rabbit");
rabbit.eat(); // rabbits can eat too
rabbit.jump();</code></pre>
        </div>
      </div>
      
      </div><p>The line <code>(*)</code> sets up the prototype chain. So that <code>rabbit</code> first searches methods in <code>Rabbit.prototype</code>, then <code>Animal.prototype</code>. And then, just for completeness, let's mention that if the method is not found in <code>Animal.prototype</code>, then the search continues in <code>Object.prototype</code>, because <code>Animal.prototype</code> is a regular plain object, so it inherits from it.</p>
<p>So here's the full picture:</p>
      <img src="http://javascript.info/article/class-patterns/class-inheritance-rabbit-animal-2.png">
<h2 id="chapter-519">
Summary</h2>
<p>The term “class” comes from the object-oriented programming. In JavaScript it usually means the functional class pattern or the prototypal pattern. The prototypal pattern is more powerful and memory-efficient, so it's recommended to stick to it.</p>
<p>According to the prototypal pattern:</p>
<ol>
<li>Methods are stored in <code>Class.prototype</code>.</li>
<li>Prototypes inherit from each other.</li>
</ol>
<p>In the next chapter we'll study <code>class</code> keyword and construct. It allows to write prototypal classes shorter and provides some additional benefits.</p>
<div class="tasks"><h2 id="chapter-520" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#an-error-in-the-inheritance" name="an-error-in-the-inheritance" class="main__anchor">An error in the inheritance</a></h3>
<a href="http://javascript.info/task/inheritance-error-assign" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Find an error in the prototypal inheritance below.</p>
<p>What's wrong? What are consequences going to be?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Animal(name) {
  this.name = name;
}

Animal.prototype.walk = function() {
  alert(this.name + ' walks');
};

function Rabbit(name) {
  this.name = name;
}

Rabbit.prototype = Animal.prototype;

Rabbit.prototype.walk = function() {
  alert(this.name + " bounces!");
};</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Here's the line with the error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Rabbit.prototype = Animal.prototype;</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>Rabbit.prototype</code> and <code>Animal.prototype</code> become the same object. So methods of both classes become mixed in that object.</p>
<p>As a result, <code>Rabbit.prototype.walk</code> overwrites <code>Animal.prototype.walk</code>, so all animals start to bounce:</p>
<div data-trusted="1" class="code-example" data-highlight-block="12-12,18-19">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Animal(name) {
  this.name = name;
}

Animal.prototype.walk = function() {
  alert(this.name + ' walks');
};

function Rabbit(name) {
  this.name = name;
}

Rabbit.prototype = Animal.prototype;

Rabbit.prototype.walk = function() {
  alert(this.name + " bounces!");
};

let animal = new Animal("pig");
animal.walk(); // pig bounces!</code></pre>
        </div>
      </div>
      
      </div><p>The correct variant would be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Rabbit.prototype.__proto__ = Animal.prototype;
// or like this:
Rabbit.prototype = Object.create(Animal.prototype);</code></pre>
        </div>
      </div>
      
      </div><p>That makes prototypes separate, each of them stores methods of the corresponding class, but <code>Rabbit.prototype</code> inherits from <code>Animal.prototype</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-to-prototypes" name="rewrite-to-prototypes" class="main__anchor">Rewrite to prototypes</a></h3>
<a href="http://javascript.info/task/rewrite-to-prototypes" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The <code>Clock</code> class is written in functional style. Rewrite it using prototypes.</p>
<p>P.S. The clock ticks in the console, open it to see.</p>
<p>
<a href="http://plnkr.co/edit/KLE8bfUHtRmuGHdZiqC1?p=preview" target="_blank" data-plunk-id="KLE8bfUHtRmuGHdZiqC1">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Please note that properties that were internal in functional style (<code>template</code>, <code>timer</code>) and the internal method <code>render</code> are marked private with the underscore <code>_</code>.</p>
<p>
<a href="http://plnkr.co/edit/Fq5uDZuNFFJGIpkcA41A?p=preview" target="_blank" data-plunk-id="Fq5uDZuNFFJGIpkcA41A">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-521"></h6>
<h1 class="main__header-title" id="chapter-522">Classes</h1>
<p>The “class” construct allows to define prototype-based classes with a clean, nice-looking syntax.</p>


<h2 id="chapter-523">
The “class” syntax</h2>
<p>The <code>class</code> syntax is versatile, we'll start with a simple example first.</p>
<p>Here's a prototype-based class <code>User</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User(name) {
  this.name = name;
}

User.prototype.sayHi = function() {
  alert(this.name);
}

let user = new User("John");
user.sayHi();</code></pre>
        </div>
      </div>
      
      </div><p>…And that's the same using <code>class</code> syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class User {

  constructor(name) {
    this.name = name;
  }

  sayHi() {
    alert(this.name);
  }

}

let user = new User("John");
user.sayHi();</code></pre>
        </div>
      </div>
      
      </div><p>It's easy to see that the two examples are alike. Just please note that methods in a class do not have a comma between them. Novice developers sometimes forget it and put a comma between class methods, and things don't work. That's not a literal object, but a class syntax.</p>
<p>So, what exactly does <code>class</code> do? We may think that it defines a new language-level entity, but that would be wrong.</p>
<p>The <code>class User {...}</code> here actually does two things:</p>
<ol>
<li>Declares a variable <code>User</code> that references the function named <code>"constructor"</code>.</li>
<li>Puts into <code>User.prototype</code> methods listed in the definition. Here it includes <code>sayHi</code> and the <code>constructor</code>.</li>
</ol>
<p>Here's the code to dig into the class and see that:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5,8-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class User {
  constructor(name) { this.name = name; }
  sayHi() { alert(this.name); }
}

// proof: User is the "constructor" function
alert(User === User.prototype.constructor); // true

// proof: there are two methods in its "prototype"
alert(Object.getOwnPropertyNames(User.prototype)); // constructor, sayHi</code></pre>
        </div>
      </div>
      
      </div><p>Here's the illustration of what <code>class User</code> creates:</p>
      <img src="http://javascript.info/article/class/class-user.png">
<p>So <code>class</code> is a special syntax to define a constructor together with its prototype methods.</p>
<p>…But not only that. There are minor tweaks here and there:</p>
<dl>
<dt>Constructors require <code>new</code></dt>
<dd>Unlike a regular function, a class <code>constructor</code> can't be called without <code>new</code>:</dd>
</dl>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class User {
  constructor() {}
}

alert(typeof User); // function
User(); // Error: Class constructor User cannot be invoked without 'new'</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt>Different string output</dt>
<dd>If we output it like <code>alert(User)</code>, some engines show <code>"class User..."</code>, while others show <code>"function User..."</code>.</dd>
</dl>
<p>Please don't be confused: the string representation may vary, but that's still a function, there is no separate “class” entity in JavaScript language.</p>
<dl>
<dt>Class methods are non-enumerable</dt>
<dd>A class definition sets <code>enumerable</code> flag to <code>false</code> for all methods in the <code>"prototype"</code>. That's good, because if we <code>for..in</code> over an object, we usually don't want its class methods.</dd>
<dt>Classes have a default <code>constructor() {}</code></dt>
<dd>If there's no <code>constructor</code> in the <code>class</code> construct, then an empty function is generated, same as if we had written <code>constructor() {}</code>.</dd>
<dt>Classes always <code>use strict</code></dt>
<dd>All code inside the class construct is automatically in strict mode.</dd>
</dl>
<h3>
Getters/setters</a></h3><p>Classes may also include getters/setters. Here's an example with <code>user.name</code> implemented using them:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7,11-11">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class User {

  constructor(name) {
    // invokes the setter
    this.name = name;
  }

  get name() {
    return this._name;
  }

  set name(value) {
    if (value.length &lt; 4) {
      alert("Name is too short.");
      return;
    }
    this._name = value;
  }

}

let user = new User("John");
alert(user.name); // John

user = new User(""); // Name too short.</code></pre>
        </div>
      </div>
      
      </div><p>Internally, getters and setters are also created on the <code>User</code> prototype, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Object.defineProperties(User.prototype, {
  name: {
    get() {
      return this._name
    },
    set(name) {
      // ...
    }
  }
});</code></pre>
        </div>
      </div>
      
      </div><h3>
Only methods</a></h3><p>Unlike object literals, no <code>property:value</code> assignments are allowed inside <code>class</code>. There may be only methods and getters/setters. There is some work going on in the specification to lift that limitation, but it's not yet there.</p>
<p>If we really need to put a non-function value into the prototype, then we can alter <code>prototype</code> manually, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class User { }

User.prototype.test = 5;

alert( new User().test ); // 5</code></pre>
        </div>
      </div>
      
      </div><p>So, technically that's possible, but we should know why we're doing it. Such properties will be shared among all objects of the class.</p>
<p>An “in-class” alternative is to use a getter:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class User {
  get test() {
    return 5;
  }
}

alert( new User().test ); // 5</code></pre>
        </div>
      </div>
      
      </div><p>From the external code, the usage is the same. But the getter variant is a bit slower.</p>
<h2 id="chapter-524">
Class Expression</h2>
<p>Just like functions, classes can be defined inside another expression, passed around, returned etc.</p>
<p>Here's a class-returning function (“class factory”):</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeClass(phrase) {
  // declare a class and return it
  return class {
    sayHi() {
      alert(phrase);
    };
  };
}

let User = makeClass("Hello");

new User().sayHi(); // Hello</code></pre>
        </div>
      </div>
      
      </div><p>That's quite normal if we recall that <code>class</code> is just a special form of a function-with-prototype definition.</p>
<p>And, like Named Function Expressions, such classes also may have a name, that is visible inside that class only:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:17-24">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// "Named Class Expression" (alas, no such term, but that's what's going on)
let User = class MyClass {
  sayHi() {
    alert(MyClass); // MyClass is visible only inside the class
  }
};

new User().sayHi(); // works, shows MyClass definition

alert(MyClass); // error, MyClass not visible outside of the class</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-525">
Static methods</h2>
<p>We can also assign methods to the class function, not to its <code>"prototype"</code>. Such methods are called <em>static</em>.</p>
<p>An example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class User {
  static staticMethod() {
    alert(this === User);
  }
}

User.staticMethod(); // true</code></pre>
        </div>
      </div>
      
      </div><p>That actually does the same as assigning it as a function property:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function User() { }

User.staticMethod = function() {
  alert(this === User);
};</code></pre>
        </div>
      </div>
      
      </div><p>The value of <code>this</code> inside <code>User.staticMethod()</code> is the class constructor <code>User</code> itself (the “object before dot” rule).</p>
<p>Usually, static methods are used to implement functions that belong to the class, but not to any particular object of it.</p>
<p>For instance, we have <code>Article</code> objects and need a function to compare them. The natural choice would be <code>Article.compare</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-8,18-18">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Article {
  constructor(title, date) {
    this.title = title;
    this.date = date;
  }

  static compare(articleA, articleB) {
    return articleA.date - articleB.date;
  }
}

// usage
let articles = [
  new Article("Mind", new Date(2016, 1, 1)),
  new Article("Body", new Date(2016, 0, 1)),
  new Article("JavaScript", new Date(2016, 11, 1))
];

articles.sort(Article.compare);

alert( articles[0].title ); // Body</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>Article.compare</code> stands “over” the articles, as a means to compare them. It's not a method of an article, but rather of the whole class.</p>
<p>Another example would be a so-called “factory” method. Imagine, we need few ways to create an article:</p>
<ol>
<li>Create by given parameters (<code>title</code>, <code>date</code> etc).</li>
<li>Create an empty article with today's date.</li>
<li>…</li>
</ol>
<p>The first way can be implemented by the constructor. And for the second one we can make a static method of the class.</p>
<p>Like <code>Article.createTodays()</code> here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Article {
  constructor(title, date) {
    this.title = title;
    this.date = date;
  }

  static createTodays() {
    // remember, this = Article
    return new this("Today's digest", new Date());
  }
}

let article = Article.createTodays();

alert( article.title ); // Todays digest</code></pre>
        </div>
      </div>
      
      </div><p>Now every time we need to create a today's digest, we can call <code>Article.createTodays()</code>. Once again, that's not a method of an article, but a method of the whole class.</p>
<p>Static methods are also used in database-related classes to search/save/remove entries from the database, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// assuming Article is a special class for managing articles
// static method to remove the article:
Article.remove({id: 12345});</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-526">
Summary</h2>
<p>The basic class syntax looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class MyClass {
  constructor(...) {
    // ...
  }
  method1(...) {}
  method2(...) {}
  get something(...) {}
  set something(...) {}
  static staticMethod(..) {}
  // ...
}</code></pre>
        </div>
      </div>
      
      </div><p>The value of <code>MyClass</code> is a function provided as <code>constructor</code>. If there's no <code>constructor</code>, then an empty function.</p>
<p>In any case, methods listed in the class declaration become members of its <code>prototype</code>, with the exception of static methods that are written into the function itself and callable as <code>MyClass.staticMethod()</code>. Static methods are used when we need a function bound to a class, but not to any object of that class.</p>
<p>In the next chapter we'll learn more about classes, including inheritance.</p>
<div class="tasks"><h2 id="chapter-527" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-to-class" name="rewrite-to-class" class="main__anchor">Rewrite to class</a></h3>
<a href="http://javascript.info/task/rewrite-to-class" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Rewrite the <code>Clock</code> class from prototypes to the modern “class” syntax.</p>
<p>P.S. The clock ticks in the console, open it to see.</p>
<p>
<a href="http://plnkr.co/edit/DbapfmzhczwDfu27e1Wb?p=preview" target="_blank" data-plunk-id="DbapfmzhczwDfu27e1Wb">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/1alwgdIhuYgwVhGek6yT?p=preview" target="_blank" data-plunk-id="1alwgdIhuYgwVhGek6yT">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-528"></h6>
<h1 class="main__header-title" id="chapter-529">Class inheritance, super</h1>
<p>Classes can extend one another. There's a nice syntax, technically based on the prototypal inheritance.</p>
<p>To inherit from another class, we should specify <code>"extends"</code> and the parent class before the brackets <code>{..}</code>.</p>


<p>Here <code>Rabbit</code> inherits from <code>Animal</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="19-24">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {

  constructor(name) {
    this.speed = 0;
    this.name = name;
  }

  run(speed) {
    this.speed += speed;
    alert(`${this.name} runs with speed ${this.speed}.`);
  }

  stop() {
    this.speed = 0;
    alert(`${this.name} stopped.`);
  }

}

// Inherit from Animal
class Rabbit extends Animal {
  hide() {
    alert(`${this.name} hides!`);
  }
}

let rabbit = new Rabbit("White Rabbit");

rabbit.run(5); // White Rabbit runs with speed 5.
rabbit.hide(); // White Rabbit hides!</code></pre>
        </div>
      </div>
      
      </div><p>The <code>extends</code> keyword actually adds a <code>[[Prototype]]</code> reference from <code>Rabbit.prototype</code> to <code>Animal.prototype</code>, just as you expect it to be, and as we've seen before.</p>
      <img src="http://javascript.info/article/class-inheritance/animal-rabbit-extends.png">
<p>So now <code>rabbit</code> has access both to its own methods and to methods of <code>Animal</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Any expression is allowed after <code>extends</code></span></div>
            <div class="important__content"><p>Class syntax allows to specify not just a class, but any expression after <code>extends</code>.</p>
<p>For instance, a function call that generates the parent class:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(phrase) {
  return class {
    sayHi() { alert(phrase) }
  }
}

class User extends f("Hello") {}

new User().sayHi(); // Hello</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>class User</code> inherits from the result of <code>f("Hello")</code>.</p>
<p>That may be useful for advanced programming patterns when we use functions to generate classes depending on many conditions and can inherit from them.</p>
</div></div>
<h2 id="chapter-530">
Overriding a method</h2>
<p>Now let's move forward and override a method. As of now, <code>Rabbit</code> inherits the <code>stop</code> method that sets <code>this.speed = 0</code> from <code>Animal</code>.</p>
<p>If we specify our own <code>stop</code> in <code>Rabbit</code>, then it will be used instead:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit extends Animal {
  stop() {
    // ...this will be used for rabbit.stop()
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>…But usually we don't want to totally replace a parent method, but rather to build on top of it, tweak or extend its functionality. We do something in our method, but call the parent method before/after it or in the process.</p>
<p>Classes provide <code>"super"</code> keyword for that.</p>
<ul>
<li><code>super.method(...)</code> to call a parent method.</li>
<li><code>super(...)</code> to call a parent constructor (inside our constructor only).</li>
</ul>
<p>For instance, let our rabbit autohide when stopped:</p>
<div data-trusted="1" class="code-example" data-highlight-block="24-27">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {

  constructor(name) {
    this.speed = 0;
    this.name = name;
  }

  run(speed) {
    this.speed += speed;
    alert(`${this.name} runs with speed ${this.speed}.`);
  }

  stop() {
    this.speed = 0;
    alert(`${this.name} stopped.`);
  }

}

class Rabbit extends Animal {
  hide() {
    alert(`${this.name} hides!`);
  }

  stop() {
    super.stop(); // call parent stop
    this.hide(); // and then hide
  }
}

let rabbit = new Rabbit("White Rabbit");

rabbit.run(5); // White Rabbit runs with speed 5.
rabbit.stop(); // White Rabbit stopped. White rabbit hides!</code></pre>
        </div>
      </div>
      
      </div><p>Now <code>Rabbit</code> has the <code>stop</code> method that calls the parent <code>super.stop()</code> in the process.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Arrow functions have no <code>super</code></span></div>
            <div class="important__content"><p>As was mentioned in the chapter 
<a href="http://javascript.info/arrow-functions">Arrow functions revisited</a>, arrow functions do not have <code>super</code>.</p>
<p>If accessed, it's taken from the outer function. For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit extends Animal {
  stop() {
    setTimeout(() =&gt; super.stop(), 1000); // call parent stop after 1sec
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>The <code>super</code> in the arrow function is the same as in <code>stop()</code>, so it works as intended. If we specified a “regular” function here, there would be an error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Unexpected super
setTimeout(function() { super.stop() }, 1000);</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-531">
Overriding constructor</h2>
<p>With constructors it gets a little bit tricky.</p>
<p>Till now, <code>Rabbit</code> did not have its own <code>constructor</code>.</p>
<p>According to the 
<a href="https://tc39.github.io/ecma262/#sec-runtime-semantics-classdefinitionevaluation">specification</a>, if a class extends another class and has no <code>constructor</code>, then the following <code>constructor</code> is generated:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit extends Animal {
  // generated for extending classes without own constructors
  constructor(...args) {
    super(...args);
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, it basically calls the parent <code>constructor</code> passing it all the arguments. That happens if we don't write a constructor of our own.</p>
<p>Now let's add a custom constructor to <code>Rabbit</code>. It will specify the <code>earLength</code> in addition to <code>name</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-14,19-20">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {
  constructor(name) {
    this.speed = 0;
    this.name = name;
  }
  // ...
}

class Rabbit extends Animal {

  constructor(name, earLength) {
    this.speed = 0;
    this.name = name;
    this.earLength = earLength;
  }

  // ...
}

// Doesn't work!
let rabbit = new Rabbit("White Rabbit", 10); // Error: this is not defined.</code></pre>
        </div>
      </div>
      
      </div><p>Whoops! We've got an error. Now we can't create rabbits. What went wrong?</p>
<p>The short answer is: constructors in inheriting classes must call <code>super(...)</code>, and (!) do it before using <code>this</code>.</p>
<p>…But why? What's going on here? Indeed, the requirement seems strange.</p>
<p>Of course, there's an explanation. Let's get into details, so you'd really understand what's going on.</p>
<p>In JavaScript, there's a distinction between a “constructor function of an inheriting class” and all others. In an inheriting class, the corresponding constructor function is labelled with a special internal property <code>[[ConstructorKind]]:"derived"</code>.</p>
<p>The difference is:</p>
<ul>
<li>When a normal constructor runs, it creates an empty object as <code>this</code> and continues with it.</li>
<li>But when a derived constructor runs, it doesn't do it. It expects the parent constructor to do this job.</li>
</ul>
<p>So if we're making a constructor of our own, then we must call <code>super</code>, because otherwise the object with <code>this</code> reference to it won't be created. And we'll get an error.</p>
<p>For <code>Rabbit</code> to work, we need to call <code>super()</code> before using <code>this</code>, like here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="13-13,20-23">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {

  constructor(name) {
    this.speed = 0;
    this.name = name;
  }

  // ...
}

class Rabbit extends Animal {

  constructor(name, earLength) {
    super(name);
    this.earLength = earLength;
  }

  // ...
}

// now fine
let rabbit = new Rabbit("White Rabbit", 10);
alert(rabbit.name); // White Rabbit
alert(rabbit.earLength); // 10</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-532">
Super: internals, [[HomeObject]]</h2>
<p>Let's get a little deeper under the hood of <code>super</code>. We'll see some interesting things by the way.</p>
<p>First to say, from all that we've learned till now, it's impossible for <code>super</code> to work.</p>
<p>Yeah, indeed, let's ask ourselves, how it could technically work? When an object method runs, it gets the current object as <code>this</code>. If we call <code>super.method()</code> then, how to retrieve the <code>method</code>? Naturally, we need to take the <code>method</code> from the prototype of the current object. How, technically, we (or a JavaScript engine) can do it?</p>
<p>Maybe we can get the method from <code>[[Prototype]]</code> of <code>this</code>, as <code>this.__proto__.method</code>? Unfortunately, that doesn't work.</p>
<p>Let's try to do it. Without classes, using plain objects for the sake of simplicity.</p>
<p>Here, <code>rabbit.eat()</code> should call <code>animal.eat()</code> method of the parent object:</p>
<div data-trusted="1" class="code-example" data-highlight-block="11-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  name: "Animal",
  eat() {
    alert(`${this.name} eats.`);
  }
};

let rabbit = {
  __proto__: animal,
  name: "Rabbit",
  eat() {
    // that's how super.eat() could presumably work
    this.__proto__.eat.call(this); // (*)
  }
};

rabbit.eat(); // Rabbit eats.</code></pre>
        </div>
      </div>
      
      </div><p>At the line <code>(*)</code> we take <code>eat</code> from the prototype (<code>animal</code>) and call it in the context of the current object. Please note that <code>.call(this)</code> is important here, because a simple <code>this.__proto__.eat()</code> would execute parent <code>eat</code> in the context of the prototype, not the current object.</p>
<p>And in the code above it actually works as intended: we have the correct <code>alert</code>.</p>
<p>Now let's add one more object to the chain. We'll see how things break:</p>
<div data-trusted="1" class="code-example" data-highlight-block="23-23">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  name: "Animal",
  eat() {
    alert(`${this.name} eats.`);
  }
};

let rabbit = {
  __proto__: animal,
  eat() {
    // ...bounce around rabbit-style and call parent (animal) method
    this.__proto__.eat.call(this); // (*)
  }
};

let longEar = {
  __proto__: rabbit,
  eat() {
    // ...do something with long ears and call parent (rabbit) method
    this.__proto__.eat.call(this); // (**)
  }
};

longEar.eat(); // Error: Maximum call stack size exceeded</code></pre>
        </div>
      </div>
      
      </div><p>The code doesn't work anymore! We can see the error trying to call <code>longEar.eat()</code>.</p>
<p>It may be not that obvious, but if we trace <code>longEar.eat()</code> call, then we can see why. In both lines <code>(*)</code> and <code>(**)</code> the value of <code>this</code> is the current object (<code>longEar</code>). That's essential: all object methods get the current object as <code>this</code>, not a prototype or something.</p>
<p>So, in both lines <code>(*)</code> and <code>(**)</code> the value of <code>this.__proto__</code> is exactly the same: <code>rabbit</code>. They both call <code>rabbit.eat</code> without going up the chain in the endless loop.</p>
<p>Here's the picture of what happens:</p>
      <img src="http://javascript.info/article/class-inheritance/this-super-loop.png">
<ol>
<li>
<p>Inside <code>longEar.eat()</code>, the line <code>(**)</code> calls <code>rabbit.eat</code> providing it with <code>this=longEar</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// inside longEar.eat() we have this = longEar
this.__proto__.eat.call(this) // (**)
// becomes
longEar.__proto__.eat.call(this)
// that is
rabbit.eat.call(this);</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Then in the line <code>(*)</code> of <code>rabbit.eat</code>, we'd like to pass the call even higher in the chain, but <code>this=longEar</code>, so <code>this.__proto__.eat</code> is again <code>rabbit.eat</code>!</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// inside rabbit.eat() we also have this = longEar
this.__proto__.eat.call(this) // (*)
// becomes
longEar.__proto__.eat.call(this)
// or (again)
rabbit.eat.call(this);</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>…So <code>rabbit.eat</code> calls itself in the endless loop, because it can't ascend any further.</p>
</li>
</ol>
<p>The problem can't be solved by using <code>this</code> alone.</p>
<h3>
<code>[[HomeObject]]</code></a></h3><p>To provide the solution, JavaScript adds one more special internal property for functions: <code>[[HomeObject]]</code>.</p>
<p><strong>When a function is specified as a class or object method, its <code>[[HomeObject]]</code> property becomes that object.</strong></p>
<p>This actually violates the idea of “unbound” functions, because methods remember their objects. And <code>[[HomeObject]]</code> can't be changed, so this bound is forever. So that's a very important change in the language.</p>
<p>But this change is safe. <code>[[HomeObject]]</code> is used only for calling parent methods in <code>super</code>, to resolve the prototype. So it doesn't break compatibility.</p>
<p>Let's see how it works for <code>super</code> – again, using plain objects:</p>
<div data-trusted="1" class="code-example" data-highlight-block="23-23">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  name: "Animal",
  eat() {         // [[HomeObject]] == animal
    alert(`${this.name} eats.`);
  }
};

let rabbit = {
  __proto__: animal,
  name: "Rabbit",
  eat() {         // [[HomeObject]] == rabbit
    super.eat();
  }
};

let longEar = {
  __proto__: rabbit,
  name: "Long Ear",
  eat() {         // [[HomeObject]] == longEar
    super.eat();
  }
};

longEar.eat();  // Long Ear eats.</code></pre>
        </div>
      </div>
      
      </div><p>Every method remembers its object in the internal <code>[[HomeObject]]</code> property. Then <code>super</code> uses it to resolve the parent prototype.</p>
<p><code>[[HomeObject]]</code> is defined for methods defined both in classes and in plain objects. But for objects, methods must be specified exactly the given way: as <code>method()</code>, not as <code>"method: function()"</code>.</p>
<p>In the example below a non-method syntax is used for comparison. <code>[[HomeObject]]</code> property is not set and the inheritance doesn't work:</p>
<div data-trusted="1" class="code-example" data-highlight-block="13-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let animal = {
  eat: function() { // should be the short syntax: eat() {...}
    // ...
  }
};

let rabbit = {
  __proto__: animal,
  eat: function() {
    super.eat();
  }
};

rabbit.eat();  // Error calling super (because there's no [[HomeObject]])</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-533">
Static methods and inheritance</h2>
<p>The <code>class</code> syntax supports inheritance for static properties too.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {

  constructor(name, speed) {
    this.speed = speed;
    this.name = name;
  }

  run(speed = 0) {
    this.speed += speed;
    alert(`${this.name} runs with speed ${this.speed}.`);
  }

  static compare(animalA, animalB) {
    return animalA.speed - animalB.speed;
  }

}

// Inherit from Animal
class Rabbit extends Animal {
  hide() {
    alert(`${this.name} hides!`);
  }
}

let rabbits = [
  new Rabbit("White Rabbit", 10),
  new Rabbit("Black Rabbit", 5)
];

rabbits.sort(Rabbit.compare);

rabbits[0].run(); // Black Rabbit runs with speed 5.</code></pre>
        </div>
      </div>
      
      </div><p>Now we can call <code>Rabbit.compare</code> assuming that the inherited <code>Animal.compare</code> will be called.</p>
<p>How does it work? Again, using prototypes. As you might have already guessed, extends also gives <code>Rabbit</code> the <code>[[Prototype]]</code> reference to <code>Animal</code>.</p>
      <img src="http://javascript.info/article/class-inheritance/animal-rabbit-static.png">
<p>So, <code>Rabbit</code> function now inherits from <code>Animal</code> function. And <code>Animal</code> function normally has <code>[[Prototype]]</code> referencing <code>Function.prototype</code>, because it doesn't <code>extend</code> anything.</p>
<p>Here, let's check that:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {}
class Rabbit extends Animal {}

// for static propertites and methods
alert(Rabbit.__proto__ === Animal); // true

// and the next step is Function.prototype
alert(Animal.__proto__ === Function.prototype); // true

// that's in addition to the "normal" prototype chain for object methods
alert(Rabbit.prototype.__proto__ === Animal.prototype);</code></pre>
        </div>
      </div>
      
      </div><p>This way <code>Rabbit</code> has access to all static methods of <code>Animal</code>.</p>
<h3>
No static inheritance in built-ins</a></h3><p>Please note that built-in classes don't have such static <code>[[Prototype]]</code> reference. For instance, <code>Object</code> has <code>Object.defineProperty</code>, <code>Object.keys</code> and so on, but <code>Array</code>, <code>Date</code> etc do not inherit them.</p>
<p>Here's the picture structure for <code>Date</code> and <code>Object</code>:</p>
      <img src="http://javascript.info/article/class-inheritance/object-date-inheritance.png">
<p>Note, there's no link between <code>Date</code> and <code>Object</code>. Both <code>Object</code> and <code>Date</code> exist independently. <code>Date.prototype</code> inherits from <code>Object.prototype</code>, but that's all.</p>
<p>Such difference exists for historical reasons: there was no thought about class syntax and inheriting static methods at the dawn of JavaScript language.</p>
<h2 id="chapter-534">
Natives are extendable</h2>
<p>Built-in classes like Array, Map and others are extendable also.</p>
<p>For instance, here <code>PowerArray</code> inherits from the native <code>Array</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// add one more method to it (can do more)
class PowerArray extends Array {
  isEmpty() {
    return this.length === 0;
  }
}

let arr = new PowerArray(1, 2, 5, 10, 50);
alert(arr.isEmpty()); // false

let filteredArr = arr.filter(item =&gt; item &gt;= 10);
alert(filteredArr); // 10, 50
alert(filteredArr.isEmpty()); // false</code></pre>
        </div>
      </div>
      
      </div><p>Please note one very interesting thing. Built-in methods like <code>filter</code>, <code>map</code> and others – return new objects of exactly the inherited type. They rely on the <code>constructor</code> property to do so.</p>
<p>In the example above,</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">arr.constructor === PowerArray</code></pre>
        </div>
      </div>
      
      </div><p>So when <code>arr.filter()</code> is called, it internally creates the new array of results exactly as <code>new PowerArray</code>. And we can keep using its methods further down the chain.</p>
<p>Even more, we can customize that behavior. The static getter <code>Symbol.species</code>, if exists, returns the constructor to use in such cases.</p>
<p>For example, here due to <code>Symbol.species</code> built-in methods like <code>map</code>, <code>filter</code> will return “normal” arrays:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-8,17-17">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class PowerArray extends Array {
  isEmpty() {
    return this.length === 0;
  }

  // built-in methods will use this as the constructor
  static get [Symbol.species]() {
    return Array;
  }
}

let arr = new PowerArray(1, 2, 5, 10, 50);
alert(arr.isEmpty()); // false

// filter creates new array using arr.constructor[Symbol.species] as constructor
let filteredArr = arr.filter(item =&gt; item &gt;= 10);

// filteredArr is not PowerArray, but Array
alert(filteredArr.isEmpty()); // Error: filteredArr.isEmpty is not a function</code></pre>
        </div>
      </div>
      
      </div><p>We can use it in more advanced keys to strip extended functionality from resulting values if not needed. Or, maybe, to extend it even further.</p>
<div class="tasks"><h2 id="chapter-535" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#error-creating-an-instance" name="error-creating-an-instance" class="main__anchor">Error creating an instance</a></h3>
<a href="http://javascript.info/task/class-constructor-error" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Here's the code with <code>Rabbit</code> extending <code>Animal</code>.</p>
<p>Unfortunately, <code>Rabbit</code> objects can't be created. What's wrong? Fix it.</p>
<div data-trusted="1" class="code-example" data-highlight-block="15-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {

  constructor(name) {
    this.name = name;
  }

}

class Rabbit extends Animal {
  constructor(name) {
    this.name = name;
    this.created = Date.now();
  }
}

let rabbit = new Rabbit("White Rabbit"); // Error: this is not defined
alert(rabbit.name);</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>That's because the child constructor must call <code>super()</code>.</p>
<p>Here's the corrected code:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10,15-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {

  constructor(name) {
    this.name = name;
  }

}

class Rabbit extends Animal {
  constructor(name) {
    super(name);
    this.created = Date.now();
  }
}

let rabbit = new Rabbit("White Rabbit"); // ok now
alert(rabbit.name); // White Rabbit</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#extended-clock" name="extended-clock" class="main__anchor">Extended clock</a></h3>
<a href="http://javascript.info/task/clock-class-extended" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We've got a <code>Clock</code> class. As of now, it prints the time every second.</p>
<p>Create a new class <code>ExtendedClock</code> that inherits from <code>Clock</code> and adds the parameter <code>precision</code> – the number of <code>ms</code> between “ticks”. Should be <code>1000</code> (1 second) by default.</p>
<ul>
<li>Your code should be in the file <code>extended-clock.js</code></li>
<li>Don't modify the original <code>clock.js</code>. Extend it.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/XZ1YztfCGf5lLKQ56tAO?p=preview" target="_blank" data-plunk-id="XZ1YztfCGf5lLKQ56tAO">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/LSBcWONytYD9aqo7tjO1?p=preview" target="_blank" data-plunk-id="LSBcWONytYD9aqo7tjO1">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#class-extends-object" name="class-extends-object" class="main__anchor">Class extends Object?</a></h3>
<a href="http://javascript.info/task/class-extend-object" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>As we know, all objects normally inherit from <code>Object.prototype</code> and get access to “generic” object methods.</p>
<p>Like demonstrated here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit {
  constructor(name) {
    this.name = name;
  }
}

let rabbit = new Rabbit("Rab");

// hasOwnProperty method is from Object.prototype
// rabbit.__proto__ === Object.prototype
alert( rabbit.hasOwnProperty('name') ); // true</code></pre>
        </div>
      </div>
      
      </div><p>So, is it correct to say that <code>"class Rabbit extends Object"</code> does exactly the same as <code>"class Rabbit"</code>, or not?</p>
<p>Will it work?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit extends Object {
  constructor(name) {
    this.name = name;
  }
}

let rabbit = new Rabbit("Rab");

alert( rabbit.hasOwnProperty('name') ); // true</code></pre>
        </div>
      </div>
      
      </div><p>If it won't please fix the code.</p>
<p>
<a href="http://plnkr.co/edit/sGSP3Khqpitwdd2oKs6y?p=preview" target="_blank" data-plunk-id="sGSP3Khqpitwdd2oKs6y">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer has two parts.</p>
<p>The first, an easy one is that the inheriting class needs to call <code>super()</code> in the constructor. Otherwise <code>"this"</code> won't be “defined”.</p>
<p>So here's the fix:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit extends Object {
  constructor(name) {
    super(); // need to call the parent constructor when inheriting
    this.name = name;
  }
}

let rabbit = new Rabbit("Rab");

alert( rabbit.hasOwnProperty('name') ); // true</code></pre>
        </div>
      </div>
      
      </div><p>But that's not all yet.</p>
<p>Even after the fix, there's still important difference in <code>"class Rabbit extends Object"</code> versus <code>class Rabbit</code>.</p>
<p>As we know, the “extends” syntax sets up two prototypes:</p>
<ol>
<li>Between <code>"prototype"</code> of the constructor functions (for methods).</li>
<li>Between the constructor functions itself (for static methods).</li>
</ol>
<p>In our case, for <code>class Rabbit extends Object</code> it means:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit extends Object {}

alert( Rabbit.prototype.__proto__ === Object.prototype ); // (1) true
alert( Rabbit.__proto__ === Object ); // (2) true</code></pre>
        </div>
      </div>
      
      </div><p>So we can access static methods of <code>Object</code> via <code>Rabbit</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit extends Object {}

// normally we call Object.getOwnPropertyNames
alert ( Rabbit.getOwnPropertyNames({a: 1, b: 2})); // a,b</code></pre>
        </div>
      </div>
      
      </div><p>And if we don't use <code>extends</code>, then <code>class Rabbit</code> does not get the second reference.</p>
<p>Please compare with it:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit {}

alert( Rabbit.prototype.__proto__ === Object.prototype ); // (1) true
alert( Rabbit.__proto__ === Object ); // (2) false (!)

// error, no such function in Rabbit
alert ( Rabbit.getOwnPropertyNames({a: 1, b: 2})); // Error</code></pre>
        </div>
      </div>
      
      </div><p>For the simple <code>class Rabbit</code>, the <code>Rabbit</code> function has the same prototype</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit {}

// instead of (2) that's correct for Rabbit (just like any function):
alert( Rabbit.__proto__ === Function.prototype );</code></pre>
        </div>
      </div>
      
      </div><p>By the way, <code>Function.prototype</code> has “generic” function methods, like <code>call</code>, <code>bind</code> etc. They are ultimately available in both cases, because for the built-in <code>Object</code> constructor, <code>Object.__proto__ === Function.prototype</code>.</p>
<p>Here's the picture:</p>
      <img src="http://javascript.info/task/class-extend-object/rabbit-extends-object.png">
<p>So, to put it short, there are two differences:</p>
<table>
<thead>
<tr>
<th>class Rabbit</th>
<th>class Rabbit extends Object</th>
</tr>
</thead>
<tbody>
<tr>
<td>–</td>
<td>needs to call <code>super()</code> in constructor</td>
</tr>
<tr>
<td><code>Rabbit.__proto__ === Function.prototype</code></td>
<td><code>Rabbit.__proto__ === Object</code></td>
</tr>
</tbody>
</table>
<p>
<a href="http://plnkr.co/edit/75i69n20lBkgNiZmqbqV?p=preview" target="_blank" data-plunk-id="75i69n20lBkgNiZmqbqV">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-536"></h6>
<h1 class="main__header-title" id="chapter-537">Class checking: "instanceof"</h1>
<p>The <code>instanceof</code> operator allows to check whether an object belongs to a certain class. It also takes inheritance into account.</p>
<p>Such a check may be necessary in many cases, here we'll use it for building a <em>polymorphic</em> function, the one that treats arguments differently depending on their type.</p>


<h2 id="chapter-538">
The instanceof operator</h2>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">obj instanceof Class</code></pre>
        </div>
      </div>
      
      </div><p>It returns <code>true</code> if <code>obj</code> belongs to the <code>Class</code> (or a class inheriting from it).</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Rabbit {}
let rabbit = new Rabbit();

// is it an object of Rabbit class?
alert( rabbit instanceof Rabbit ); // true</code></pre>
        </div>
      </div>
      
      </div><p>It also works with constructor functions:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// instead of class
function Rabbit() {}

alert( new Rabbit() instanceof Rabbit ); // true</code></pre>
        </div>
      </div>
      
      </div><p>…And with built-in classes like <code>Array</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let arr = [1, 2, 3];
alert( arr instanceof Array ); // true
alert( arr instanceof Object ); // true</code></pre>
        </div>
      </div>
      
      </div><p>Please note that <code>arr</code> also belongs to the <code>Object</code> class. That's because <code>Array</code> prototypally inherits from <code>Object</code>.</p>
<p>The <code>instanceof</code> operator examines the prototype chain for the check, and is also fine-tunable using the static method <code>Symbol.hasInstance</code>.</p>
<p>The algorithm of <code>obj instanceof Class</code> works roughly as follows:</p>
<ol>
<li>
<p>If there's a static method <code>Symbol.hasInstance</code>, then use it. Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// assume anything that canEat is an animal
class Animal {
  static [Symbol.hasInstance](obj) {
    if (obj.canEat) return true;
  }
}

let obj = { canEat: true };
alert(obj instanceof Animal); // true: Animal[Symbol.hasInstance](obj) is called</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Most classes do not have <code>Symbol.hasInstance</code>. In that case, check if <code>Class.prototype</code> equals to one of prototypes in the <code>obj</code> prototype chain.</p>
<p>In other words, compare:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">obj.__proto__ === Class.prototype
obj.__proto__.__proto__ === Class.prototype
obj.__proto__.__proto__.__proto__ === Class.prototype
...</code></pre>
        </div>
      </div>
      
      </div><p>In the example above <code>Rabbit.prototype === rabbit.__proto__</code>, so that gives the answer immediately.</p>
<p>In the case of an inheritance, <code>rabbit</code> is an instance of the parent class as well:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Animal {}
class Rabbit extends Animal {}

let rabbit = new Rabbit();
alert(rabbit instanceof Animal); // true
// rabbit.__proto__ === Rabbit.prototype
// rabbit.__proto__.__proto__ === Animal.prototype (match!)</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>Here's the illustration of what <code>rabbit instanceof Animal</code> compares with <code>Animal.prototype</code>:</p>
      <img src="http://javascript.info/article/instanceof/instanceof.png">
<p>By the way, there's also a method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/object/isPrototypeOf">objA.isPrototypeOf(objB)</a>, that returns <code>true</code> if <code>objA</code> is somewhere in the chain of prototypes for <code>objB</code>. So the test of <code>obj instanceof Class</code> can be rephrased as <code>Class.prototype.isPrototypeOf(obj)</code>.</p>
<p>That's funny, but the <code>Class</code> constructor itself does not participate in the check! Only the chain of prototypes and <code>Class.prototype</code> matters.</p>
<p>That can lead to interesting consequences when <code>prototype</code> is changed.</p>
<p>Like here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function Rabbit() {}
let rabbit = new Rabbit();

// changed the prototype
Rabbit.prototype = {};

// ...not a rabbit any more!
alert( rabbit instanceof Rabbit ); // false</code></pre>
        </div>
      </div>
      
      </div><p>That's one of the reasons to avoid changing <code>prototype</code>. Just to keep safe.</p>
<h2 id="chapter-539">
Bonus: Object toString for the type</h2>
<p>We already know that plain objects are converted to string as <code>[object Object]</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let obj = {};

alert(obj); // [object Object]
alert(obj.toString()); // the same</code></pre>
        </div>
      </div>
      
      </div><p>That's their implementation of <code>toString</code>. But there's a hidden feature that makes <code>toString</code> actually much more powerful than that. We can use it as an extended <code>typeof</code> and an alternative for <code>instanceof</code>.</p>
<p>Sounds strange? Indeed. Let's demystify.</p>
<p>By 
<a href="https://tc39.github.io/ecma262/#sec-object.prototype.tostring">specification</a>, the built-in <code>toString</code> can be extracted from the object and executed in the context of any other value. And its result depends on that value.</p>
<ul>
<li>For a number, it will be <code>[object Number]</code></li>
<li>For a boolean, it will be <code>[object Boolean]</code></li>
<li>For <code>null</code>: <code>[object Null]</code></li>
<li>For <code>undefined</code>: <code>[object Undefined]</code></li>
<li>For arrays: <code>[object Array]</code></li>
<li>…etc (customizable).</li>
</ul>
<p>Let's demonstrate:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// copy toString method into a variable for convenience
let objectToString = Object.prototype.toString;

// what type is this?
let arr = [];

alert( objectToString.call(arr) ); // [object Array]</code></pre>
        </div>
      </div>
      
      </div><p>Here we used 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function/call">call</a> as described in the chapter 
<a href="http://javascript.info/call-apply-decorators">Decorators and forwarding, call/apply</a> to execute the function <code>objectToString</code> in the context <code>this=arr</code>.</p>
<p>Internally, the <code>toString</code> algorithm examines <code>this</code> and returns the corresponding result. More examples:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let s = Object.prototype.toString;

alert( s.call(123) ); // [object Number]
alert( s.call(null) ); // [object Null]
alert( s.call(alert) ); // [object Function]</code></pre>
        </div>
      </div>
      
      </div><h3>
Symbol.toStringTag</a></h3><p>The behavior of Object <code>toString</code> can be customized using a special object property <code>Symbol.toStringTag</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let user = {
  [Symbol.toStringTag]: "User"
};

alert( {}.toString.call(user) ); // [object User]</code></pre>
        </div>
      </div>
      
      </div><p>For most environment-specific objects, there is such a property. Here are few browser specific examples:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// toStringTag for the envinronment-specific object and class:
alert( window[Symbol.toStringTag]); // window
alert( XMLHttpRequest.prototype[Symbol.toStringTag] ); // XMLHttpRequest

alert( {}.toString.call(window) ); // [object Window]
alert( {}.toString.call(new XMLHttpRequest()) ); // [object XMLHttpRequest]</code></pre>
        </div>
      </div>
      
      </div><p>As you can see, the result is exactly <code>Symbol.toStringTag</code> (if exists), wrapped into <code>[object ...]</code>.</p>
<p>At the end we have “typeof on steroids” that not only works for primitive data types, but also for built-in objects and even can be customized.</p>
<p>It can be used instead of <code>instanceof</code> for built-in objects when we want to get the type as a string rather than just to check.</p>
<h2 id="chapter-540">
Summary</h2>
<p>Let's recap the type-checking methods that we know:</p>
<table>
<thead>
<tr>
<th></th>
<th>works for</th>
<th>returns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>typeof</code></td>
<td>primitives</td>
<td>string</td>
</tr>
<tr>
<td><code>{}.toString</code></td>
<td>primitives, built-in objects, objects with <code>Symbol.toStringTag</code></td>
<td>string</td>
</tr>
<tr>
<td><code>instanceof</code></td>
<td>objects</td>
<td>true/false</td>
</tr>
</tbody>
</table>
<p>As we can see, <code>{}.toString</code> is technically a “more advanced” <code>typeof</code>.</p>
<p>And <code>instanceof</code> operator really shines when we are working with a class hierarchy and want to check for the class taking into account inheritance.</p>
<div class="tasks"><h2 id="chapter-541" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#strange-instanceof" name="strange-instanceof" class="main__anchor">Strange instanceof</a></h3>
<a href="http://javascript.info/task/strange-instanceof" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Why <code>instanceof</code> below returns <code>true</code>? We can easily see that <code>a</code> is not created by <code>B()</code>.</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function A() {}
function B() {}

A.prototype = B.prototype = {};

let a = new A();

alert( a instanceof B ); // true</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Yeah, looks strange indeed.</p>
<p>But <code>instanceof</code> does not care about the function, but rather about its <code>prototype</code>, that it matches against the prototype chain.</p>
<p>And here <code>a.__proto__ == B.prototype</code>, so <code>instanceof</code> returns <code>true</code>.</p>
<p>So, by the logic of <code>instanceof</code>, the <code>prototype</code> actually defines the type, not the constructor function.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

  /**
   * Subscribe to event, usage:
   *  menu.on('select', function(item) { ... }
  */
  on(eventName, handler) {
    if (!this._eventHandlers) this._eventHandlers = {};
    if (!this._eventHandlers[eventName]) {
      this._eventHandlers[eventName] = [];
    }
    this._eventHandlers[eventName].push(handler);
  },

  /**
   * Cancel the subscription, usage:
   *  menu.off('select', handler)
   */
  off(eventName, handler) {
    let handlers = this._eventHandlers &amp;&amp; this._eventHandlers[eventName];
    if (!handlers) return;
    for(let i = 0; i &lt; handlers.length; i++) {
      if (handlers[i] == handler) {
        handlers.splice(i--, 1);
      }
    }
  },

  /**
   * Generate the event and attach the data to it
   *  this.trigger('select', data1, data2);
   */
  trigger(eventName, ...args) {
    if (!this._eventHandlers || !this._eventHandlers[eventName]) {
      return; // no handlers for that event name
    }

    // call the handlers
    this._eventHandlers[eventName].forEach(handler =&gt; handler.apply(this, args));
  }
};




<h6 id="chapter-542"></h6>
<h1 class="main__header-title" id="chapter-543">Mixins</h1>
<p>In JavaScript we can only inherit from a single object. There can be only one <code>[[Prototype]]</code> for an object. And a class may extend only one other class.</p>
<p>But sometimes that feels limiting. For instance, I have a class <code>StreetSweeper</code> and a class <code>Bicycle</code>, and want to make a <code>StreetSweepingBicycle</code>.</p>
<p>Or, talking about programming, we have a class <code>Renderer</code> that implements templating and a class <code>EventEmitter</code> that implements event handling, and want to merge these functionalities together with a class <code>Page</code>, to make a page that can use templates and emit events.</p>
<p>There's a concept that can help here, called “mixins”.</p>
<p>As defined in Wikipedia, a 
<a href="https://en.wikipedia.org/wiki/Mixin">mixin</a> is a class that contains methods for use by other classes without having to be the parent class of those other classes.</p>
<p>In other words, a <em>mixin</em> provides methods that implement a certain behavior, but we do not use it alone, we use it to add the behavior to other classes.</p>
<h2 id="chapter-544">
A mixin example</h2>
<p>The simplest way to make a mixin in JavaScript is to make an object with useful methods, so that we can easily merge them into a prototype of any class.</p>
<p>For instance here the mixin <code>sayHiMixin</code> is used to add some “speech” for <code>User</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0,10-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// mixin
let sayHiMixin = {
  sayHi() {
    alert(`Hello ${this.name}`);
  },
  sayBye() {
    alert(`Bye ${this.name}`);
  }
};

// usage:
class User {
  constructor(name) {
    this.name = name;
  }
}

// copy the methods
Object.assign(User.prototype, sayHiMixin);

// now User can say hi
new User("Dude").sayHi(); // Hello Dude!</code></pre>
        </div>
      </div>
      
      </div><p>There's no inheritance, but a simple method copying. So <code>User</code> may extend some other class and also include the mixin to “mix-in” the additional methods, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class User extends Person {
  // ...
}

Object.assign(User.prototype, sayHiMixin);</code></pre>
        </div>
      </div>
      
      </div><p>Mixins can make use of inheritance inside themselves.</p>
<p>For instance, here <code>sayHiMixin</code> inherits from <code>sayMixin</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sayMixin = {
  say(phrase) {
    alert(phrase);
  }
};

let sayHiMixin = {
  __proto__: sayMixin, // (or we could use Object.create to set the prototype here)

  sayHi() {
    // call parent method
    super.say(`Hello ${this.name}`);
  },
  sayBye() {
    super.say(`Bye ${this.name}`);
  }
};

class User {
  constructor(name) {
    this.name = name;
  }
}

// copy the methods
Object.assign(User.prototype, sayHiMixin);

// now User can say hi
new User("Dude").sayHi(); // Hello Dude!</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the call to the parent method <code>super.say()</code> from <code>sayHiMixin</code> looks for the method in the prototype of that mixin, not the class.</p>
      <img src="http://javascript.info/article/mixins/mixin-inheritance.png">
<p>That's because methods from <code>sayHiMixin</code> have <code>[[HomeObject]]</code> set to it. So <code>super</code> actually means <code>sayHiMixin.__proto__</code>, not <code>User.__proto__</code>.</p>
<h2 id="chapter-545">
EventMixin</h2>
<p>Now let's make a mixin for real life.</p>
<p>The important feature of many objects is working with events.</p>
<p>That is: an object should have a method to “generate an event” when something important happens to it, and other objects should be able to “listen” to such events.</p>
<p>An event must have a name and, optionally, bundle some additional data.</p>
<p>For instance, an object <code>user</code> can generate an event <code>"login"</code> when the visitor logs in. And another object <code>calendar</code> may want to receive such events to load the calendar for the logged-in person.</p>
<p>Or, a <code>menu</code> can generate the event <code>"select"</code> when a menu item is selected, and other objects may want to get that information and react on that event.</p>
<p>Events is a way to “share information” with anyone who wants it. They can be useful in any class, so let's make a mixin for them:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let eventMixin = {
  /**
   * Subscribe to event, usage:
   *  menu.on('select', function(item) { ... }
  */
  on(eventName, handler) {
    if (!this._eventHandlers) this._eventHandlers = {};
    if (!this._eventHandlers[eventName]) {
      this._eventHandlers[eventName] = [];
    }
    this._eventHandlers[eventName].push(handler);
  },

  /**
   * Cancel the subscription, usage:
   *  menu.off('select', handler)
   */
  off(eventName, handler) {
    let handlers = this._eventHandlers &amp;&amp; this._eventHandlers[eventName];
    if (!handlers) return;
    for (let i = 0; i &lt; handlers.length; i++) {
      if (handlers[i] === handler) {
        handlers.splice(i--, 1);
      }
    }
  },

  /**
   * Generate the event and attach the data to it
   *  this.trigger('select', data1, data2);
   */
  trigger(eventName, ...args) {
    if (!this._eventHandlers || !this._eventHandlers[eventName]) {
      return; // no handlers for that event name
    }

    // call the handlers
    this._eventHandlers[eventName].forEach(handler =&gt; handler.apply(this, args));
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>There are 3 methods here:</p>
<ol>
<li><code>.on(eventName, handler)</code> – assigns function <code>handler</code> to run when the event with that name happens. The handlers are stored in the <code>_eventHandlers</code> property.</li>
<li><code>.off(eventName, handler)</code> – removes the function from the handlers list.</li>
<li><code>.trigger(eventName, ...args)</code> – generates the event: all assigned handlers are called and <code>args</code> are passed as arguments to them.</li>
</ol>
<p>Usage:</p>
<div data-trusted="1" class="code-example" data-highlight-block="12-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Make a class
class Menu {
  choose(value) {
    this.trigger("select", value);
  }
}
// Add the mixin
Object.assign(Menu.prototype, eventMixin);

let menu = new Menu();

// call the handler on selection:
menu.on("select", value =&gt; alert(`Value selected: ${value}`));

// triggers the event =&gt; shows Value selected: 123
menu.choose("123"); // value selected</code></pre>
        </div>
      </div>
      
      </div><p>Now if we have the code interested to react on user selection, we can bind it with <code>menu.on(...)</code>.</p>
<p>And the <code>eventMixin</code> can add such behavior to as many classes as we'd like, without interfering with the inheritance chain.</p>
<h2 id="chapter-546">
Summary</h2>
<p><em>Mixin</em> – is a generic object-oriented programming term: a class that contains methods for other classes.</p>
<p>Some other languages like e.g. python allow to create mixins using multiple inheritance. JavaScript does not support multiple inheritance, but mixins can be implemented by copying them into the prototype.</p>
<p>We can use mixins as a way to augment a class by multiple behaviors, like event-handling as we have seen above.</p>
<p>Mixins may become a point of conflict if they occasionally overwrite native class methods. So generally one should think well about the naming for a mixin, to minimize such possibility.</p>
<h6 id="chapter-547"></h6>
<h1 class="main__header-title" id="chapter-548">Error handling</h1>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/try-catch" class="lessons-list__link">Error handling, "try..catch"</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/custom-errors" class="lessons-list__link">Custom errors, extending Error</a></li></ol></div>


<h6 id="chapter-549"></h6>
<h1 class="main__header-title" id="chapter-550">Error handling, "try..catch"</h1>
<p>No matter how great we are at programming, sometimes our scripts have errors. They may occur because of our mistakes, an unexpected user input, an erroneous server response and for a thousand of other reasons.</p>
<p>Usually, a script “dies” (immediately stops) in case of an error, printing it to console.</p>
<p>But there's a syntax construct <code>try..catch</code> that allows to “catch” errors and, instead of dying, do something more reasonable.</p>


<h2 id="chapter-551">
The “try…catch” syntax</h2>
<p>The <code>try..catch</code> construct has two main blocks: <code>try</code>, and then <code>catch</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {

  // code...

} catch (err) {

  // error handling

}</code></pre>
        </div>
      </div>
      
      </div><p>It works like this:</p>
<ol>
<li>First, the code in <code>try {...}</code> is executed.</li>
<li>If there were no errors, then <code>catch(err)</code> is ignored: the execution reaches the end of <code>try</code> and then jumps over <code>catch</code>.</li>
<li>If an error occurs, then <code>try</code> execution is stopped, and the control flows to the beginning of <code>catch(err)</code>. The <code>err</code> variable (can use any name for it) contains an error object with details about what's happened.</li>
</ol>
      <img src="http://javascript.info/article/try-catch/try-catch-flow.png">
<p>So, an error inside the <code>try {…}</code> block does not kill the script: we have a chance to handle it in <code>catch</code>.</p>
<p>Let's see more examples.</p>
<ul>
<li>
<p>An errorless example: shows <code>alert</code> <code>(1)</code> and <code>(2)</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:34-41,6:33-40">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {

  alert('Start of try runs');  // (1) &lt;--

  // ...no errors here

  alert('End of try runs');   // (2) &lt;--

} catch(err) {

  alert('Catch is ignored, because there are no errors'); // (3)

}

alert("...Then the execution continues");</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>An example with an error: shows <code>(1)</code> and <code>(3)</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4" data-highlight-inline="2:34-41,10:34-41">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {

  alert('Start of try runs');  // (1) &lt;--

  lalala; // error, variable is not defined!

  alert('End of try (never reached)');  // (2)

} catch(err) {

  alert(`Error has occured!`); // (3) &lt;--

}

alert("...Then the execution continues");</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><code>try..catch</code> only works for runtime errors</span></div>
            <div class="important__content"><p>For <code>try..catch</code> to work, the code must be runnable. In other words, it should be valid JavaScript.</p>
<p>It won't work if the code is syntactically wrong, for instance it has unmatched figure brackets:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  {{{{{{{{{{{{
} catch(e) {
  alert("The engine can't understand this code, it's invalid");
}</code></pre>
        </div>
      </div>
      
      </div><p>The JavaScript engine first reads the code, and then runs it. The errors that occur on the reading phrase are called “parse-time” errors and are unrecoverable (from inside that code). That's because the engine can't understand the code.</p>
<p>So, <code>try..catch</code> can only handle errors that occur in the valid code. Such errors are called “runtime errors” or, sometimes, “exceptions”.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><code>try..catch</code> works synchronously</span></div>
            <div class="important__content"><p>If an exception happens in a “scheduled” code, like in <code>setTimeout</code>, then <code>try..catch</code> won't catch it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  setTimeout(function() {
    noSuchVariable; // script will die here
  }, 1000);
} catch (e) {
  alert( "won't work" );
}</code></pre>
        </div>
      </div>
      
      </div><p>That's because <code>try..catch</code> actually wraps the <code>setTimeout</code> call that schedules the function. But the function itself is executed later, when the engine has already have left the <code>try..catch</code> construct.</p>
<p>To catch an exception inside a scheduled function, <code>try..catch</code> must be inside that function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">setTimeout(function() {
  try {
    noSuchVariable; // try..catch handles the error!
  } catch (e) {
    alert( "error is caught here!" );
  }
}, 1000);</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-552">
Error object</h2>
<p>When an error occurs, JavaScript generates an object containing the details about it. The object is then passed as an argument to <code>catch</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  // ...
} catch(err) { // &lt;-- the "error object", could use another word instead of err
  // ...
}</code></pre>
        </div>
      </div>
      
      </div><p>For all built-in errors, the error object inside <code>catch</code> block has two main properties:</p>
<dl>
<dt><code>name</code></dt>
<dd>Error name. For an undefined variable that's <code>"ReferenceError"</code>.</dd>
<dt><code>message</code></dt>
<dd>Textual message about error details.</dd>
</dl>
<p>There are other non-standard properties available in most environments. One of most widely used and supported is:</p>
<dl>
<dt><code>stack</code></dt>
<dd>Current call stack: a string with information about the sequence of nested calls that led to the error. Used for debugging purposes.</dd>
</dl>
<p>For instance:</p>
<div data-trusted="0" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  lalala; // error, variable is not defined!
} catch(err) {
  alert(err.name); // ReferenceError
  alert(err.message); // lalala is not defined
  alert(err.stack); // ReferenceError: lalala is not defined at ...

  // Can also show an error as a whole
  // The error is converted to string as "name: message"
  alert(err); // ReferenceError: lalala is not defined
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-553">
Using “try…catch”</h2>
<p>Let's explore a real-life use case of <code>try..catch</code>.</p>
<p>As we already know, JavaScript supports method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse(str)</a> to read JSON-encoded values.</p>
<p>Usually it's used to decode the data received over the network, from the server or another source.</p>
<p>We receive it and call <code>JSON.parse</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{"name":"John", "age": 30}'; // data from the server

let user = JSON.parse(json); // convert the text representation to JS object

// now user is an object with properties from the string
alert( user.name ); // John
alert( user.age );  // 30</code></pre>
        </div>
      </div>
      
      </div><p>More detailed information about JSON you can find in the chapter 
<a href="http://javascript.info/json">JSON methods, toJSON</a>.</p>
<p><strong>If <code>json</code> is malformed, <code>JSON.parse</code> generates an error, so the script “dies”.</strong></p>
<p>Should we be satisfied with that? Of course, not!</p>
<p>This way if something's wrong with the data, the visitor will never know that (unless he opens developer console). And people really really don't like when something “just dies” without any error message.</p>
<p>Let's use <code>try..catch</code> to handle the error:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4,8-11">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = "{ bad json }";

try {

  let user = JSON.parse(json); // &lt;-- when an error occurs...
  alert( user.name ); // doesn't work

} catch (e) {
  // ...the execution jumps here
  alert( "Our apologies, the data has errors, we'll try to request it one more time." );
  alert( e.name );
  alert( e.message );
}</code></pre>
        </div>
      </div>
      
      </div><p>Here we use <code>catch</code> block only to show the message, but we can do much more: a new network request, suggest an alternative to the visitor, send the information about the error to a logging facility… All much better than just dying.</p>
<h2 id="chapter-554">
Throwing our own errors</h2>
<p>What if <code>json</code> is syntactically correct… But doesn't have a required <code>"name"</code> property?</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{ "age": 30 }'; // incomplete data

try {

  let user = JSON.parse(json); // &lt;-- no errors
  alert( user.name ); // no name!

} catch (e) {
  alert( "doesn't execute" );
}</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>JSON.parse</code> runs normally, but the absence of <code>"name"</code> is actually an error for us.</p>
<p>To unify error handling, we'll use the <code>throw</code> operator.</p>
<h3>
“Throw” operator</a></h3><p>The <code>throw</code> operator generates an error.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">throw &lt;error object&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Technically, we can use anything as an error object. That may be even a primitive, like a number or a string, but it's better to use objects, preferrably with <code>name</code> and <code>message</code> properties (to stay somewhat compatible with built-in errors).</p>
<p>JavaScript has many built-in constructors for standard errors: <code>Error</code>, <code>SyntaxError</code>, <code>ReferenceError</code>, <code>TypeError</code> and others. We can use them to create error objects as well.</p>
<p>Their syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let error = new Error(message);
// or
let error = new SyntaxError(message);
let error = new ReferenceError(message);
// ...</code></pre>
        </div>
      </div>
      
      </div><p>For built-in errors (not for any objects, just for errors), the <code>name</code> property is exactly the name of the constructor. And <code>message</code> is taken from the argument.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let error = new Error("Things happen o_O");

alert(error.name); // Error
alert(error.message); // Things happen o_O</code></pre>
        </div>
      </div>
      
      </div><p>Let's see what kind of error <code>JSON.parse</code> generates:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  JSON.parse("{ bad json o_O }");
} catch(e) {
  alert(e.name); // SyntaxError
  alert(e.message); // Unexpected token o in JSON at position 0
}</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, that's a <code>SyntaxError</code>.</p>
<p>…And in our case, the absense of <code>name</code> could be treated as a syntax error also, assuming that users must have a <code>"name"</code>.</p>
<p>So let's throw it:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{ "age": 30 }'; // incomplete data

try {

  let user = JSON.parse(json); // &lt;-- no errors

  if (!user.name) {
    throw new SyntaxError("Incomplete data: no name"); // (*)
  }

  alert( user.name );

} catch(e) {
  alert( "JSON Error: " + e.message ); // JSON Error: Incomplete data: no name
}</code></pre>
        </div>
      </div>
      
      </div><p>In the line <code>(*)</code> the <code>throw</code> operator generates <code>SyntaxError</code> with the given <code>message</code>, the same way as JavaScript would generate itself. The execution of <code>try</code> immediately stops and the control flow jumps into <code>catch</code>.</p>
<p>Now <code>catch</code> became a single place for all error handling: both for <code>JSON.parse</code> and other cases.</p>
<h2 id="chapter-555">
Rethrowing</h2>
<p>In the example above we use <code>try..catch</code> to handle incorrect data. But is it possible that <em>another unexpected error</em> occurs within the <code>try {...}</code> block? Like a variable is undefined or something else, not just that “incorrect data” thing.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{ "age": 30 }'; // incomplete data

try {
  user = JSON.parse(json); // &lt;-- forgot to put "let" before user

  // ...
} catch(err) {
  alert("JSON Error: " + err); // JSON Error: ReferenceError: user is not defined
  // (not JSON Error actually)
}</code></pre>
        </div>
      </div>
      
      </div><p>Of course, everything's possible! Programmers do make mistakes. Even in open-source utilities used by millions for decades – suddenly a crazy bug may be discovered that leads to terrible hacks (like it happened with the <code>ssh</code> tool).</p>
<p>In our case, <code>try..catch</code> is meant to catch “incorrect data” errors. But by its nature, <code>catch</code> gets <em>all</em> errors from <code>try</code>. Here it gets an unexpected error, but still shows the same <code>"JSON Error"</code> message. That's wrong and also makes the code more difficult to debug.</p>
<p>Fortunately, we can find out which error we get, for instance from its <code>name</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  user = { /*...*/ };
} catch(e) {
  alert(e.name); // "ReferenceError" for accessing an undefined variable
}</code></pre>
        </div>
      </div>
      
      </div><p>The rule is simple:</p>
<p><strong>Catch should only process errors that it knows and “rethrow” all others.</strong></p>
<p>The “rethrowing” technique can be explained in more detail as:</p>
<ol>
<li>Catch gets all errors.</li>
<li>In <code>catch(err) {...}</code> block we analyze the error object <code>err</code>.</li>
<li>If we don't know how to handle it, then we do <code>throw err</code>.</li>
</ol>
<p>In the code below, we use rethrowing so that <code>catch</code> only handles <code>SyntaxError</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="9-9,15-19">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{ "age": 30 }'; // incomplete data
try {

  let user = JSON.parse(json);

  if (!user.name) {
    throw new SyntaxError("Incomplete data: no name");
  }

  blabla(); // unexpected error

  alert( user.name );

} catch(e) {

  if (e.name == "SyntaxError") {
    alert( "JSON Error: " + e.message );
  } else {
    throw e; // rethrow (*)
  }

}</code></pre>
        </div>
      </div>
      
      </div><p>The error throwing on line <code>(*)</code> from inside <code>catch</code> block “falls out” of <code>try..catch</code> and can be either caught by an outer <code>try..catch</code> construct (if it exists), or it kills the script.</p>
<p>So the <code>catch</code> block actually handles only errors that it knows how to deal with and “skips” all others.</p>
<p>The example below demonstrates how such errors can be caught by one more level of <code>try..catch</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5,9-9,17-17">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function readData() {
  let json = '{ "age": 30 }';

  try {
    // ...
    blabla(); // error!
  } catch (e) {
    // ...
    if (e.name != 'SyntaxError') {
      throw e; // rethrow (don't know how to deal with it)
    }
  }
}

try {
  readData();
} catch (e) {
  alert( "External catch got: " + e ); // caught it!
}</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>readData</code> only knows how to handle <code>SyntaxError</code>, while the outer <code>try..catch</code> knows how to handle everything.</p>
<h2 id="chapter-556">
try…catch…finally</h2>
<p>Wait, that's not all.</p>
<p>The <code>try..catch</code> construct may have one more code clause: <code>finally</code>.</p>
<p>If it exists, it runs in all cases:</p>
<ul>
<li>after <code>try</code>, if there were no errors,</li>
<li>after <code>catch</code>, if there were errors.</li>
</ul>
<p>The extended syntax looks like this:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:0-3,2:2-7,4:2-9">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
   ... try to execute the code ...
} catch(e) {
   ... handle errors ...
} finally {
   ... execute always ...
}</code></pre>
        </div>
      </div>
      
      </div><p>Try running this code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  alert( 'try' );
  if (confirm('Make an error?')) BAD_CODE();
} catch (e) {
  alert( 'catch' );
} finally {
  alert( 'finally' );
}</code></pre>
        </div>
      </div>
      
      </div><p>The code has two ways of execution:</p>
<ol>
<li>If you answer “Yes” to “Make an error?”, then <code>try -&gt; catch -&gt; finally</code>.</li>
<li>If you say “No”, then <code>try -&gt; finally</code>.</li>
</ol>
<p>The <code>finally</code> clause is often used when we start doing something before <code>try..catch</code> and want to finalize it in any case of outcome.</p>
<p>For instance, we want to measure time that a Fibonacci numbers function <code>fib(n)</code> takes. Naturally, we can start measuring before it runs and finish afterwards. But what if there's an error during the function call? In particular, the implementation of <code>fib(n)</code> in the code below returns an error for negative or non-integer numbers.</p>
<p>The <code>finally</code> clause is a great place to finish the measurements no matter what.</p>
<p>Here <code>finally</code> guarantees that the time will be measured correctly in both situations – in case of a successful execution of <code>fib</code> and in case of an error in it:</p>
<div data-trusted="1" class="code-example" data-highlight-block="17-19">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = +prompt("Enter a positive integer number?", 35)

let diff, result;

function fib(n) {
  if (n &lt; 0 || Math.trunc(n) != n) {
    throw new Error("Must not be negative, and also an integer.");
  }
  return n &lt;= 1 ? n : fib(n - 1) + fib(n - 2);
}

let start = Date.now();

try {
  result = fib(num);
} catch (e) {
  result = 0;
} finally {
  diff = Date.now() - start;
}

alert(result || "error occured");

alert( `execution took ${diff}ms` );</code></pre>
        </div>
      </div>
      
      </div><p>You can check by running the code with entering <code>35</code> into <code>prompt</code> – it executes normally, <code>finally</code> after <code>try</code>. And then enter <code>-1</code> – there will be an immediate error, an the execution will take <code>0ms</code>. Both measurements are done correctly.</p>
<p>In other words, there may be two ways to exit a function: either a <code>return</code> or <code>throw</code>. The <code>finally</code> clause handles them both.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Variables are local inside <code>try..catch..finally</code></span></div>
            <div class="important__content"><p>Please note that <code>result</code> and <code>diff</code> variables in the code above are declared <em>before</em> <code>try..catch</code>.</p>
<p>Otherwise, if <code>let</code> were made inside the <code>{...}</code> block, it would only be visible inside of it.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>finally</code> and <code>return</code></span></div>
            <div class="important__content"><p>Finally clause works for <em>any</em> exit from <code>try..catch</code>. That includes an explicit <code>return</code>.</p>
<p>In the example below, there's a <code>return</code> in <code>try</code>. In this case, <code>finally</code> is executed just before the control returns to the outer code.</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3,8-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function func() {

  try {
    return 1;

  } catch (e) {
    /* ... */
  } finally {
    alert( 'finally' );
  }
}

alert( func() ); // first works alert from finally, and then this one</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>try..finally</code></span></div>
            <div class="important__content"><p>The <code>try..finally</code> construct, without <code>catch</code> clause, is also useful. We apply it when we don't want to handle errors right here, but want to be sure that processes that we started are finalized.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function func() {
  // start doing something that needs completion (like measurements)
  try {
    // ...
  } finally {
    // complete that thing even if all dies
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>In the code above, an error inside <code>try</code> always falls out, because there's no <code>catch</code>. But <code>finally</code> works before the execution flow jumps outside.</p>
</div></div>
<h2 id="chapter-557">
Global catch</h2>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Environment-specific</span></div>
            <div class="important__content"><p>The information from this section is not a part of the core JavaScript.</p>
</div></div>
<p>Let's imagine we've got a fatal error outside of <code>try..catch</code>, and the script died. Like a programming error or something else terrible.</p>
<p>Is there a way to react on such occurrences? We may want to log the error, show something to the user (normally he doesn't see error messages) etc.</p>
<p>There is none in the specification, but environments usually provide it, because it's really useful. For instance, Node.JS has 
<a href="https://nodejs.org/api/process.html#process_event_uncaughtexception">process.on(‘uncaughtException')</a> for that. And in the browser we can assign a function to special 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onerror">window.onerror</a> property. It will run in case of an uncaught error.</p>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.onerror = function(message, url, line, col, error) {
  // ...
};</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt><code>message</code></dt>
<dd>Error message.</dd>
<dt><code>url</code></dt>
<dd>URL of the script where error happened.</dd>
<dt><code>line</code>, <code>col</code></dt>
<dd>Line and column numbers where error happened.</dd>
<dt><code>error</code></dt>
<dd>Error object.</dd>
</dl>
<p>For instance:</p>
<div data-trusted="0" class="code-example" data-demo-height="1" data-refresh="1" data-highlight-block="1-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  window.onerror = function(message, url, line, col, error) {
    alert(`${message}\n At ${line}:${col} of ${url}`);
  };

  function readData() {
    badFunc(); // Whoops, something went wrong!
  }

  readData();
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The role of the global handler <code>window.onerror</code> is usually not to recover the script execution – that's probably impossible in case of programming errors, but to send the error message to developers.</p>
<p>There are also web-services that provide error-logging for such cases, like 
<a href="https://errorception.com">https://errorception.com</a> or 
<a href="http://www.muscula.com">http://www.muscula.com</a>.</p>
<p>They work like this:</p>
<ol>
<li>We register at the service and get a piece of JS (or a script URL) from them to insert on pages.</li>
<li>That JS script has a custom <code>window.onerror</code> function.</li>
<li>When an error occurs, it sends a network request about it to the service.</li>
<li>We can log in to the service web interface and see errors.</li>
</ol>
<h2 id="chapter-558">
Summary</h2>
<p>The <code>try..catch</code> construct allows to handle runtime errors. It literally allows to try running the code and catch errors that may occur in it.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  // run this code
} catch(err) {
  // if an error happened, then jump here
  // err is the error object
} finally {
  // do in any case after try/catch
}</code></pre>
        </div>
      </div>
      
      </div><p>There may be no <code>catch</code> section or no <code>finally</code>, so <code>try..catch</code> and <code>try..finally</code> are also valid.</p>
<p>Error objects have following properties:</p>
<ul>
<li><code>message</code> – the human-readable error message.</li>
<li><code>name</code> – the string with error name (error constructor name).</li>
<li><code>stack</code> (non-standard) – the stack at the moment of error creation.</li>
</ul>
<p>We can also generate our own errors using the <code>throw</code> operator. Technically, the argument of <code>throw</code> can be anything, but usually it's an error object inheriting from the built-in <code>Error</code> class. More on extending errors in the next chapter.</p>
<p>Rethrowing is a basic pattern of error handling: a <code>catch</code> block usually expects and knows how to handle the particular error type, so it should rethrow errors it doesn't know.</p>
<p>Even if we don't have <code>try..catch</code>, most environments allow to setup a “global” error handler to catch errors that “fall out”. In-browser that's <code>window.onerror</code>.</p>
<div class="tasks"><h2 id="chapter-559" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#finally-or-just-the-code" name="finally-or-just-the-code" class="main__anchor">Finally or just the code?</a></h3>
<a href="http://javascript.info/task/finally-or-code-after" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Compare the two code fragments.</p>
<ol>
<li>
<p>The first one uses <code>finally</code> to execute the code after <code>try..catch</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  work work
} catch (e) {
  handle errors
} finally {
  cleanup the working space
}</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>The second fragment puts the cleaning right after <code>try..catch</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  work work
} catch (e) {
  handle errors
}

cleanup the working space</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>We definitely need the cleanup after the work has started, doesn't matter if there was an error or not.</p>
<p>Is there an advantage here in using <code>finally</code> or both code fragments are equal? If there is such an advantage, then give an example when it matters.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The difference becomes obvious when we look at the code inside a function.</p>
<p>The behavior is different if there's a “jump out” of <code>try..catch</code>.</p>
<p>For instance, when there's a <code>return</code> inside <code>try..catch</code>. The <code>finally</code> clause works in case of <em>any</em> exit from <code>try..catch</code>, even via the <code>return</code> statement: right after <code>try..catch</code> is done, but before the calling code gets the control.</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  try {
    alert('start');
    return "result";
  } catch (e) {
    /// ...
  } finally {
    alert('cleanup!');
  }
}

f(); // cleanup!</code></pre>
        </div>
      </div>
      
      </div><p>…Or when there's a <code>throw</code>, like here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  try {
    alert('start');
    throw new Error("an error");
  } catch (e) {
    // ...
    if("can't handle the error") {
      throw e;
    }

  } finally {
    alert('cleanup!')
  }
}

f(); // cleanup!</code></pre>
        </div>
      </div>
      
      </div><p>It's <code>finally</code> that guarantees the cleanup here. If we just put the code at the end of <code>f</code>, it wouldn't run.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-560"></h6>
<h1 class="main__header-title" id="chapter-561">Custom errors, extending Error</h1>
<p>When we develop something, we often need our own error classes to reflect specific things that may go wrong in our tasks. For errors in network operations we may need <code>HttpError</code>, for database operations <code>DbError</code>, for searching operations <code>NotFoundError</code> and so on.</p>
<p>Our errors should support basic error properties like <code>message</code>, <code>name</code> and, preferably, <code>stack</code>. But they also may have other properties of their own, e.g. <code>HttpError</code> objects may have <code>statusCode</code> property with a value like <code>404</code> or <code>403</code> or <code>500</code>.</p>
<p>JavaScript allows to use <code>throw</code> with any argument, so technically our custom error classes don't need to inherit from <code>Error</code>. But if we inherit, then it becomes possible to use <code>obj instanceof Error</code> to identify error objects. So it's better to inherit from it.</p>
<p>As we build our application, our own errors naturally form a hierarchy, for instance <code>HttpTimeoutError</code> may inherit from <code>HttpError</code>, and so on.</p>
<h2 id="chapter-562">
Extending Error</h2>
<p>As an example, let's consider a function <code>readUser(json)</code> that should read JSON with user data.</p>
<p>Here's an example of how a valid <code>json</code> may look:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = `{ "name": "John", "age": 30 }`;</code></pre>
        </div>
      </div>
      
      </div><p>Internally, we'll use <code>JSON.parse</code>. If it receives malformed <code>json</code>, then it throws <code>SyntaxError</code>.</p>
<p>But even if <code>json</code> is syntactically correct, that doesn't mean that it's a valid user, right? It may miss the necessary data. For instance, if may not have <code>name</code> and <code>age</code> properties that are essential for our users.</p>
<p>Our function <code>readUser(json)</code> will not only read JSON, but check (“validate”) the data. If there are no required fields, or the format is wrong, then that's an error. And that's not a <code>SyntaxError</code>, because the data is syntactically correct, but another kind of error. We'll call it <code>ValidationError</code> and create a class for it. An error of that kind should also carry the information about the offending field.</p>
<p>Our <code>ValidationError</code> class should inherit from the built-in <code>Error</code> class.</p>
<p>That class is built-in, but we should have its approximate code before our eyes, to understand what we're extending.</p>
<p>So here you are:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// The "pseudocode" for the built-in Error class defined by JavaScript itself
class Error {
  constructor(message) {
    this.message = message;
    this.name = "Error"; // (different names for different built-in error classes)
    this.stack = &lt;nested calls&gt;; // non-standard, but most environments support it
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>Now let's go on and inherit <code>ValidationError</code> from it:</p>
<div data-trusted="0" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class ValidationError extends Error {
  constructor(message) {
    super(message); // (1)
    this.name = "ValidationError"; // (2)
  }
}

function test() {
  throw new ValidationError("Whoops!");
}

try {
  test();
} catch(err) {
  alert(err.message); // Whoops!
  alert(err.name); // ValidationError
  alert(err.stack); // a list of nested calls with line numbers for each
}</code></pre>
        </div>
      </div>
      
      </div><p>Please take a look at the constructor:</p>
<ol>
<li>In the line <code>(1)</code> we call the parent constructor. JavaScript requires us to call <code>super</code> in the child constructor, so that's obligatory. The parent constructor sets the <code>message</code> property.</li>
<li>The parent constructor also sets the <code>name</code> property to <code>"Error"</code>, so in the line <code>(2)</code> we reset it to the right value.</li>
</ol>
<p>Let's try to use it in <code>readUser(json)</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="27-27">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class ValidationError extends Error {
  constructor(message) {
    super(message);
    this.name = "ValidationError";
  }
}

// Usage
function readUser(json) {
  let user = JSON.parse(json);

  if (!user.age) {
    throw new ValidationError("No field: age");
  }
  if (!user.name) {
    throw new ValidationError("No field: name");
  }

  return user;
}

// Working example with try..catch

try {
  let user = readUser('{ "age": 25 }');
} catch (err) {
  if (err instanceof ValidationError) {
    alert("Invalid data: " + err.message); // Invalid data: No field: name
  } else if (err instanceof SyntaxError) { // (*)
    alert("JSON Syntax Error: " + err.message);
  } else {
    throw err; // unknown error, rethrow it (**)
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>The <code>try..catch</code> block in the code above handles both our <code>ValidationError</code> and the built-in <code>SyntaxError</code> from <code>JSON.parse</code>.</p>
<p>Please take a look at how we use <code>instanceof</code> to check for the specific error type in the line <code>(*)</code>.</p>
<p>We could also look at <code>err.name</code>, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// ...
// instead of (err instanceof SyntaxError)
} else if (err.name == "SyntaxError") { // (*)
// ...</code></pre>
        </div>
      </div>
      
      </div><p>The <code>instanceof</code> version is much better, because in the future we are going to extend <code>ValidationError</code>, make subtypes of it, like <code>PropertyRequiredError</code>. And <code>instanceof</code> check will continue to work for new inheriting classes. So that's future-proof.</p>
<p>Also it's important that if <code>catch</code> meets an unknown error, then it rethrows it in the line <code>(**)</code>. The <code>catch</code>  only knows how to handle validation and syntax errors, other kinds (due to a typo in the code or such) should fall through.</p>
<h2 id="chapter-563">
Further inheritance</h2>
<p>The <code>ValidationError</code> class is very generic. Many things may go wrong. The property may be absent or it may be in a wrong format (like a string value for <code>age</code>). Let's make a more concrete class <code>PropertyRequiredError</code>, exactly for absent properties. It will carry additional information about the property that's missing.</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-13,35-37">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class ValidationError extends Error {
  constructor(message) {
    super(message);
    this.name = "ValidationError";
  }
}

class PropertyRequiredError extends ValidationError {
  constructor(property) {
    super("No property: " + property);
    this.name = "PropertyRequiredError";
    this.property = property;
  }
}

// Usage
function readUser(json) {
  let user = JSON.parse(json);

  if (!user.age) {
    throw new PropertyRequiredError("age");
  }
  if (!user.name) {
    throw new PropertyRequiredError("name");
  }

  return user;
}

// Working example with try..catch

try {
  let user = readUser('{ "age": 25 }');
} catch (err) {
  if (err instanceof ValidationError) {
    alert("Invalid data: " + err.message); // Invalid data: No property: name
    alert(err.name); // PropertyRequiredError
    alert(err.property); // name
  } else if (err instanceof SyntaxError) {
    alert("JSON Syntax Error: " + err.message);
  } else {
    throw err; // unknown error, rethrow it
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>The new class <code>PropertyRequiredError</code> is easy to use: we only need to pass the property name: <code>new PropertyRequiredError(property)</code>. The human-readable <code>message</code> is generated by the constructor.</p>
<p>Please note that <code>this.name</code> in <code>PropertyRequiredError</code> constructor is again assigned manually. That may become a bit tedius – to assign <code>this.name = &lt;class name&gt;</code> when creating each custom error. But there's a way out. We can make our own “basic error” class that removes this burden from our shoulders by using <code>this.constructor.name</code> for <code>this.name</code> in the constructor. And then inherit from it.</p>
<p>Let's call it <code>MyError</code>.</p>
<p>Here's the code with <code>MyError</code> and other custom error classes, simplified:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class MyError extends Error {
  constructor(message) {
    super(message);
    this.name = this.constructor.name;
  }
}

class ValidationError extends MyError { }

class PropertyRequiredError extends ValidationError {
  constructor(property) {
    super("No property: " + property);
    this.property = property;
  }
}

// name is correct
alert( new PropertyRequiredError("field").name ); // PropertyRequiredError</code></pre>
        </div>
      </div>
      
      </div><p>Now custom errors are much shorter, especially <code>ValidationError</code>, as we got rid of the <code>"this.name = ..."</code> line in the constructor.</p>
<h2 id="chapter-564">
Wrapping exceptions</h2>
<p>The purpose of the function <code>readUser</code> in the code above is “to read the user data”, right? There may occur different kinds of errors in the process. Right now we have <code>SyntaxError</code> and <code>ValidationError</code>, but in the future <code>readUser</code> function may grow: the new code will probably generate other kinds of errors.</p>
<p>The code which calls <code>readUser</code> should handle these errors. Right now it uses multiple <code>if</code> in the <code>catch</code> block to check for different error types and rethrow the unknown ones. But if <code>readUser</code> function generates several kinds of errors – then we should ask ourselves: do we really want to check for all error types one-by-one in every code that calls <code>readUser</code>?</p>
<p>Often the answer is “No”: the outer code wants to be “one level above all that”. It wants to have some kind of “data reading error”. Why exactly it happened – is often irrelevant (the error message describes it). Or, even better if there is a way to get error details, but only if we need to.</p>
<p>So let's make a new class <code>ReadError</code> to represent such errors. If an error occurs inside <code>readUser</code>, we'll catch it there and generate <code>ReadError</code>. We'll also keep the reference to the original error in its <code>cause</code> property. Then the outer code will only have to check for <code>ReadError</code>.</p>
<p>Here's the code that defines <code>ReadError</code> and demonstrates its use in <code>readUser</code> and <code>try..catch</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="27-31,37-41,50-52">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class ReadError extends Error {
  constructor(message, cause) {
    super(message);
    this.cause = cause;
    this.name = 'ReadError';
  }
}

class ValidationError extends Error { /*...*/ }
class PropertyRequiredError extends ValidationError { /* ... */ }

function validateUser(user) {
  if (!user.age) {
    throw new PropertyRequiredError("age");
  }

  if (!user.name) {
    throw new PropertyRequiredError("name");
  }
}

function readUser(json) {
  let user;

  try {
    user = JSON.parse(json);
  } catch (err) {
    if (err instanceof SyntaxError) {
      throw new ReadError("Syntax Error", err);
    } else {
      throw err;
    }
  }

  try {
    validateUser(user);
  } catch (err) {
    if (err instanceof ValidationError) {
      throw new ReadError("Validation Error", err);
    } else {
      throw err;
    }
  }

}

try {
  readUser('{bad json}');
} catch (e) {
  if (e instanceof ReadError) {
    alert(e);
    // Original error: SyntaxError: Unexpected token b in JSON at position 1
    alert("Original error: " + e.cause);
  } else {
    throw e;
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>In the code above, <code>readUser</code> works exactly as described – catches syntax and validation errors and throws <code>ReadError</code> errors instead (unknown errors are rethrown as usual).</p>
<p>So the outer code checks <code>instanceof ReadError</code> and that's it. No need to list possible all error types.</p>
<p>The approach is called “wrapping exceptions”, because we take “low level exceptions” and “wrap” them into <code>ReadError</code> that is more abstract and more convenient to use for the calling code. It is widely used in object-oriented programming.</p>
<h2 id="chapter-565">
Summary</h2>
<ul>
<li>We can inherit from <code>Error</code> and other built-in error classes normally, just need to take care of <code>name</code> property and don't forget to call <code>super</code>.</li>
<li>Most of the time, we should use <code>instanceof</code> to check for particular errors. It also works with inheritance. But sometimes we have an error object coming from the 3rd-party library and there's no easy way to get the class. Then <code>name</code> property can be used for such checks.</li>
<li>Wrapping exceptions is a widespread technique when a function handles low-level exceptions and makes a higher-level object to report about the errors. Low-level exceptions sometimes become properties of that object like <code>err.cause</code> in the examples above, but that's not strictly required.</li>
</ul>
<div class="tasks"><h2 id="chapter-566" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#inherit-from-syntaxerror" name="inherit-from-syntaxerror" class="main__anchor">Inherit from SyntaxError</a></h3>
<a href="http://javascript.info/task/format-error" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a class <code>FormatError</code> that inherits from the built-in <code>SyntaxError</code> class.</p>
<p>It should support <code>message</code>, <code>name</code> and <code>stack</code> properties.</p>
<p>Usage example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let err = new FormatError("formatting error");

alert( err.message ); // formatting error
alert( err.name ); // FormatError
alert( err.stack ); // stack

alert( err instanceof FormatError ); // true
alert( err instanceof SyntaxError ); // true (because inherits from SyntaxError)</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="0" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class FormatError extends SyntaxError {
  constructor(message) {
    super(message);
    this.name = "FormatError";
  }
}

let err = new FormatError("formatting error");

alert( err.message ); // formatting error
alert( err.name ); // FormatError
alert( err.stack ); // stack

alert( err instanceof SyntaxError ); // true</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-567"></h6>
<h1 class="main__header-title" id="chapter-568">Document</h1>
<p>Here we'll learn to manipulate a web-page using JavaScript.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/browser-environment" class="lessons-list__link">Browser environment, specs</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/dom-nodes" class="lessons-list__link">DOM tree</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/dom-navigation" class="lessons-list__link">Walking the DOM</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/searching-elements-dom" class="lessons-list__link">Searching: getElement* and querySelector*</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/basic-dom-node-properties" class="lessons-list__link">Node properties: type, tag and contents</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/dom-attributes-and-properties" class="lessons-list__link">Attributes and properties</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/modifying-document" class="lessons-list__link">Modifying the document</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/styles-and-classes" class="lessons-list__link">Styles and classes</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/size-and-scroll" class="lessons-list__link">Element size and scrolling</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/size-and-scroll-window" class="lessons-list__link">Window sizes and scrolling</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/coordinates" class="lessons-list__link">Coordinates</a></li></ol></div>


<h6 id="chapter-569"></h6>
<h1 class="main__header-title" id="chapter-570">Browser environment, specs</h1>
<p>The JavaScript language was initially created for web browsers. Since then, it evolved and became a language with many uses and platforms.</p>
<p>A platform may be either a browser or a web-server or a washing machine or another <em>host</em>. Each of them provides platform-specific functionality. The JavaScript specification calls that a <em>host environment</em>.</p>
<p>A host environment provides platform-specific objects and functions additionally to the language core. Web browsers give means to control web pages. Node.JS provides server-side features, and so on.</p>


<p>Here's a bird's-eye view of what we have when JavaScript runs in a web-browser:</p>
      <img src="http://javascript.info/article/browser-environment/windowObjects.png">
<p>There's a “root” object called <code>window</code>. It has two roles:</p>
<ol>
<li>First, it is a global object for JavaScript code, as described in the chapter 
<a href="http://javascript.info/global-object">Global object</a>.</li>
<li>Second, it represents the “browser window” and provides methods to control it.</li>
</ol>
<p>For instance, here we use it as a global object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert("Hello");
}

// global functions are accessible as properties of window
window.sayHi();</code></pre>
        </div>
      </div>
      
      </div><p>And here we use it as a browser window, to see the window height:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(window.innerHeight); // inner window height</code></pre>
        </div>
      </div>
      
      </div><p>There are more window-specific methods and properties, we'll cover them later.</p>
<h2 id="chapter-571">
Document Object Model (DOM)</h2>
<p>The <code>document</code> object gives access to the page content. We can change or create anything on the page using it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// change the background color to red
document.body.style.background = "red";

// change it back after 1 second
setTimeout(() =&gt; document.body.style.background = "", 1000);</code></pre>
        </div>
      </div>
      
      </div><p>Here we used <code>document.body.style</code>, but there's much, much more. Properties and methods are described in the specification. By chance, there are two working groups who develop it:</p>
<ol>
<li>
<a href="https://en.wikipedia.org/wiki/World_Wide_Web_Consortium">W3C</a> – the documentation is at 
<a href="https://www.w3.org/TR/dom">https://www.w3.org/TR/dom</a>.</li>
<li>
<a href="https://en.wikipedia.org/wiki/WHATWG">WhatWG</a>, publishing at 
<a href="https://dom.spec.whatwg.org">https://dom.spec.whatwg.org</a>.</li>
</ol>
<p>As it happens, the two groups don't always agree, so we have like 2 sets of standards. But they are in the tight contact and eventually things merge. So the documentation that you can find on the given resources is very similar, there's about 99% match. There are very minor differences, you probably won't notice them.</p>
<p>Personally, I find 
<a href="https://dom.spec.whatwg.org">https://dom.spec.whatwg.org</a> more pleasant to use.</p>
<p>In the ancient past, there was no standard at all – each browser implemented whatever it wanted. So different browsers had different sets methods and properties for the same thing, and developers had to write different code for each of them. Dark, messy times.</p>
<p>Even now we can sometimes meet old code that uses browser-specific properties and works around incompatibilities. But in this tutorial we'll use modern stuff: there's no need to learn old things until you really need those (chances are high you won't).</p>
<p>Then the DOM standard appeared, in an attempt to bring everyone to an agreement. The first version was “DOM Level 1”, then it was extended by DOM Level 2, then DOM Level 3, and now it's DOM Level 4. People from WhatWG group got tired of version and are calling that just “DOM”, without a number. So will do we.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">DOM is not only for browsers</span></div>
            <div class="important__content"><p>The DOM specification explains the structure of a document and provides objects to manipulate it. There are non-browser instruments that use it too.</p>
<p>For instance, server-side tools that download HTML pages and process them. They may support only a part of the DOM specification though.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">CSSOM for styling</span></div>
            <div class="important__content"><p>CSS rules and stylesheets are structured not like HTML. So there's a separate specification 
<a href="https://www.w3.org/TR/cssom-1/">CSSOM</a> that explains how they are represented as objects, how to read and write them.</p>
<p>CSSOM is used together with DOM when we modify style rules for the document. In practice though, CSSOM is rarely required, because usually CSS rules are static. We rarely need to add/remove CSS rules from JavaScript, so we won't cover it right now.</p>
</div></div>
<h2 id="chapter-572">
BOM (part of HTML spec)</h2>
<p>Browser Object Model (BOM) are additional objects provided by the browser (host environment) to work with everything except the document.</p>
<p>For instance:</p>
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/navigator">navigator</a> object provides background information about the browser and the operating system. There are many properties, but two most widely known are: <code>navigator.userAgent</code> – about the current browser, and <code>navigator.platform</code> – about the platform (can help to differ between Windows/Linux/Mac etc).</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/location">location</a> object allows to read the current URL and redirects the browser to a new one.</li>
</ul>
<p>Here's how we can use the <code>location</code> object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(location.href); // shows current URL
if (confirm("Go to wikipedia?")) {
  location.href = "https://wikipedia.org"; // redirect the browser to another URL
}</code></pre>
        </div>
      </div>
      
      </div><p>Functions <code>alert/confirm/prompt</code> are also a part of BOM: they are directly not related to the document, but represent pure browser methods of communicating with the user.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">HTML specification</span></div>
            <div class="important__content"><p>BOM is the part of the general 
<a href="https://html.spec.whatwg.org">HTML specification</a>.</p>
<p>Yes, you heard that right. The HTML spec at 
<a href="https://html.spec.whatwg.org">https://html.spec.whatwg.org</a> is not only about the “HTML language” (tags, attributes), but also covers a bunch of objects, methods and browser-specific DOM extensions. That's “HTML in broad terms”.</p>
</div></div>
<h2 id="chapter-573">
Summary</h2>
<p>Talking about standards, we have:</p>
<dl>
<dt>DOM specification</dt>
<dd>Describes the document structure, manipulations and events, see 
<a href="https://dom.spec.whatwg.org">https://dom.spec.whatwg.org</a>.</dd>
<dt>CSSOM specification</dt>
<dd>Describes stylesheets and style rules, manipulations with them and their binding to documents, see 
<a href="https://www.w3.org/TR/cssom-1/">https://www.w3.org/TR/cssom-1/</a>.</dd>
<dt>HTML specification</dt>
<dd>Describes HTML language (tags etc) and also BOM (browser object model) – various browser functions: <code>setTimeout</code>, <code>alert</code>, <code>location</code> and so on, see 
<a href="https://html.spec.whatwg.org">https://html.spec.whatwg.org</a>. It takes DOM specification and extends it with many additional properties and methods.</dd>
</dl>
<p>Now we'll get down to learning DOM, because the document plays the central role in the UI, and working with it is the most complex part.</p>
<p>Please note the links above, because there's so much stuff to learn, it's impossible to cover and remember everything.</p>
<p>When you'd like to read about a property or a method – the Mozilla manual at 
<a href="https://developer.mozilla.org/en-US/search">https://developer.mozilla.org/en-US/search</a> is a nice one, but reading the corresponding spec may be better: more complex and longer to read, but will make your fundamental knowledge sound and complete.</p>
span.devtools {
  display: inline-block;
  background-image: url(/article/dom-nodes/toolbarButtonGlyphs.svg);
  height:16px;
  width:16px;
}




<h6 id="chapter-574"></h6>
<h1 class="main__header-title" id="chapter-575">DOM tree</h1>
<p>The backbone of an HTML document is tags.</p>
<p>According to Document Object Model (DOM), every HTML-tag is an object. Nested tags are called “children” of the enclosing one.</p>
<p>The text inside a tag it is an object as well.</p>
<p>All these objects are accessible using JavaScript.</p>
<h2 id="chapter-576">
An example of DOM</h2>
<p>For instance, let's explore the DOM for this document:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;About elks&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  The truth about elks.
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The DOM represents HTML as a tree structure of tags. Here's how it looks:</p>
<div class="domtree"></div>
<script>
let node1 = {"name":"HTML","nodeType":1,"children":[{"name":"HEAD","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"\n    "},{"name":"TITLE","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"About elks"}]},{"name":"#text","nodeType":3,"content":"\n  "}]},{"name":"#text","nodeType":3,"content":"\n  "},{"name":"BODY","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"\n  The truth about elks."}]}]}

drawHtmlTree(node1, 'div.domtree', 690, 320);
</script>
<p>On the picture above, you can click on element nodes and their children will open/collapse.</p>
<p>Tags are called <em>element nodes</em> (or just elements). Nested tags become children of the enclosing ones. As a result we have a tree of elements: <code>&lt;html&gt;</code> is at the root, then <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code> are its children etc.</p>
<p>The text inside elements forms <em>text nodes</em>, labelled as <code>#text</code>. A text node contains only a string. It may not have children and is always a leaf of the tree.</p>
<p>For instance, the <code>&lt;title&gt;</code> tag has the text <code>"About elks"</code>.</p>
<p>Please note the special characters in text nodes:</p>
<ul>
<li>a newline: <code>↵</code> (in JavaScript known as <code>\n</code>)</li>
<li>a space: <code>␣</code></li>
</ul>
<p>Spaces and newlines – are totally valid characters, they form text nodes and become a part of the DOM. So, for instance, in the example above the <code>&lt;head&gt;</code> tag contains come spaces before <code>&lt;title&gt;</code>, and that text becomes a <code>#text</code> node (it contains a newline and some spaces only).</p>
<p>There are only two top-level exclusions:</p>
<ol>
<li>Spaces and newlines before <code>&lt;head&gt;</code> are ignored for historical reasons,</li>
<li>If we put something after <code>&lt;/body&gt;</code>, then that is automatically moved inside the <code>body</code>, at the end, as HTML spec requires that all content must be inside <code>&lt;body&gt;</code>. So there may be no spaces after <code>&lt;/body&gt;</code>.</li>
</ol>
<p>In other cases everything's honest – if there are spaces (just like any character) in the document, then they become text nodes in DOM, and if we remove them, then there won't be any.</p>
<p>Here are no space-only text nodes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;&lt;head&gt;&lt;title&gt;About elks&lt;/title&gt;&lt;/head&gt;&lt;body&gt;The truth about elks.&lt;/body&gt;&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><div class="domtree"></div>
<script>
let node2 = {"name":"HTML","nodeType":1,"children":[{"name":"HEAD","nodeType":1,"children":[{"name":"TITLE","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"About elks"}]}]},{"name":"BODY","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"The truth about elks."}]}]}

drawHtmlTree(node2, 'div.domtree', 690, 210);
</script>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Edge spaces and in-between empty text are usually hidden in tools</span></div>
            <div class="important__content"><p>Browser tools (to be covered soon) that work with DOM usually do not show spaces at the start/end of the text and empty text nodes (line-breaks) between tags.</p>
<p>That's because they are mainly used to decorate HTML, and do not affect (in most cases) how it is shown.</p>
<p>On further DOM pictures we'll sometimes omit them where they are irrelevant, to keep things short.</p>
</div></div>
<h2 id="chapter-577">
Autocorrection</h2>
<p>If the browser encounters malformed HTML, it automatically corrects it when making DOM.</p>
<p>For instance, the top tag is always <code>&lt;html&gt;</code>. Even if it doesn't exist in the document – it will be in DOM, the browser will create it. The same about <code>&lt;body&gt;</code>.</p>
<p>As an example, if the HTML file is a single word <code>"Hello"</code>, the browser will wrap it into <code>&lt;html&gt;</code> and <code>&lt;body&gt;</code>, add the required <code>&lt;head&gt;</code>, and the DOM will be:</p>
<div class="domtree"></div>
<script>
let node3 = {"name":"HTML","nodeType":1,"children":[{"name":"HEAD","nodeType":1,"children":[]},{"name":"BODY","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"Hello"}]}]}

drawHtmlTree(node3, 'div.domtree', 690, 150);
</script>
<p>While generating DOM, browser automatically processes errors in the document, closes tags and so on.</p>
<p>Such an “invalid” document:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;p&gt;Hello
&lt;li&gt;Mom
&lt;li&gt;and
&lt;li&gt;Dad</code></pre>
        </div>
      </div>
      
      </div><p>…Will become a normal DOM, as the browser read tags and restores the missing parts:</p>
<div class="domtree"></div>
<script>
let node4 = {"name":"HTML","nodeType":1,"children":[{"name":"HEAD","nodeType":1,"children":[]},{"name":"BODY","nodeType":1,"children":[{"name":"P","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"Hello"}]},{"name":"LI","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"Mom"}]},{"name":"LI","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"and"}]},{"name":"LI","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"Dad"}]}]}]}

drawHtmlTree(node4, 'div.domtree', 690, 360);
</script>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Tables always have <code>&lt;tbody&gt;</code></span></div>
            <div class="important__content"><p>An interesting “special case” is tables. By the DOM specification they must have <code>&lt;tbody&gt;</code>, but HTML text may (officially) omit it. Then the browser creates <code>&lt;tbody&gt;</code> in DOM automatically.</p>
<p>For the HTML:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;table id="table"&gt;&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</code></pre>
        </div>
      </div>
      
      </div><p>DOM-structure will be:</p>
<div class="domtree"></div>
<script>
let node5 = {"name":"TABLE","nodeType":1,"children":[{"name":"TBODY","nodeType":1,"children":[{"name":"TR","nodeType":1,"children":[{"name":"TD","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"1"}]}]}]}]};

drawHtmlTree(node5,  'div.domtree', 600, 200);
</script>
<p>You see? The <code>&lt;tbody&gt;</code> has appeared out of nowhere. Should keep in mind while working with tables to avoid surprises.</p>
</div></div>
<h2 id="chapter-578">
Other node types</h2>
<p>Let's add more tags and a comment to the page:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;body&gt;
  The truth about elks.
  &lt;ol&gt;
    &lt;li&gt;An elk is a smart&lt;/li&gt;
    &lt;!-- comment --&gt;
    &lt;li&gt;...and cunning animal!&lt;/li&gt;
  &lt;/ol&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><div class="domtree"></div>
<script>
let node6 = {"name":"HTML","nodeType":1,"children":[{"name":"HEAD","nodeType":1,"children":[]},{"name":"BODY","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"\n  The truth about elks.\n    "},{"name":"OL","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"\n      "},{"name":"LI","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"An elk is a smart"}]},{"name":"#text","nodeType":3,"content":"\n      "},{"name":"#comment","nodeType":8,"content":"comment"},{"name":"#text","nodeType":3,"content":"\n      "},{"name":"LI","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"...and cunning animal!"}]},{"name":"#text","nodeType":3,"content":"\n    "}]},{"name":"#text","nodeType":3,"content":"\n  \n"}]}]};

drawHtmlTree(node6, 'div.domtree', 690, 500);
</script>
<p>Here we see a new tree node type – <em>comment node</em>, labeled as <code>#comment</code>.</p>
<p>We may think – why a comment is added to the DOM? It doesn't affect the visual representation in any way. But there's a rule – if something's in HTML, then it also must be in the DOM tree.</p>
<p><strong>Everything in HTML, even comments, becomes a part of DOM.</strong></p>
<p>Even the <code>&lt;!DOCTYPE...&gt;</code> directive at the very beginning of HTML is also a DOM node. It's in the DOM tree right before <code>&lt;html&gt;</code>. We are not going to touch that node, we even don't draw it on diagrams for that reason, but it's there.</p>
<p>The <code>document</code> object that represents the whole document is, formally, a DOM node as well.</p>
<p>There are 
<a href="https://dom.spec.whatwg.org/#node">12 node types</a>. In practice we usually work with 4 of them:</p>
<ol>
<li><code>document</code> – the “entry point” into DOM.</li>
<li>element nodes – HTML-tags, the tree building blocks.</li>
<li>text nodes – contain text.</li>
<li>comments – sometimes we can put the information there, it won't be shown, but JS can read it from DOM.</li>
</ol>
<h2 id="chapter-579">
See it yourself</h2>
<p>To see the DOM structure in real-time, try 
<a href="http://software.hixie.ch/utilities/js/live-dom-viewer/">Live DOM Viewer</a>. Just type in the document, and it will show up DOM at an instant.</p>
<h2 id="chapter-580">
In the browser inspector</h2>
<p>Another way to explore DOM is to use browser developer tools. Actually, that's what we use when developing.</p>
<p>To do so, open the web-page 
<a href="http://javascript.info/article/dom-nodes/elks.html">elks.html</a>, turn on browser developer tools and switch to Elements tab.</p>
<p>Should look like this:</p>
      <img src="http://javascript.info/article/dom-nodes/elks.png">
<p>You can see the DOM, click on elements, see their details and so on.</p>
<p>Please note that the DOM structure in developer tools is simplified. Text nodes are shown just as text. And there are no “blank” (space only) text nodes at all. That's fine, because most of the time we are interested in element nodes.</p>
<p>Clicking the <span class="devtools" style="background-position:-328px -124px"></span> button in the left-upper corner allows to choose a node from the webpage using a mouse (or other pointer devices) and “inspect” it (scroll to it in the elements tab). Works great when we have a huge HTML page and would like to see the DOM of a particular place in it.</p>
<p>Another way to do it would be just right-clicking on a webpage and selecting “Inspect” in the context menu.</p>
      <img src="http://javascript.info/article/dom-nodes/inspect.png">
<p>At the right part of the tools there are following subtabs:</p>
<ul>
<li>Styles – we can see CSS applied to the current element rule by rule, including built-in rules (gray). Almost everything can be edited at-place including the dimensions/margins/paddings of the box below.</li>
<li>Computed – to see CSS applied to the element by property: for each property we can see a rule that gives it (including CSS inheritance and such).</li>
<li>Event Listeners – to see event listeners attached to DOM elements (we'll cover them in the next part of the tutorial).</li>
<li>…and so on.</li>
</ul>
<p>The best way to study them is to click around. Most values are in-place editable.</p>
<h2 id="chapter-581">
Interaction with console</h2>
<p>As we explore the DOM, we also may want to apply JavaScript to it. Like: get a node and run some code to modify it, to see how it looks. Here are few tips to travel between the Elements tab and the console.</p>
<ul>
<li>Select the first <code>&lt;li&gt;</code> in the Elements tab.</li>
<li>Press <kbd class="shortcut">Esc</kbd> – it will open console right below the Elements tab.</li>
</ul>
<p>Now the last selected element is available as <code>$0</code>, the previously selected is <code>$1</code> etc.</p>
<p>We can run commands on them. For instance, <code>$0.style.background = 'red'</code> makes the selected list item red, like this:</p>
      <img src="http://javascript.info/article/dom-nodes/domconsole0.png">
<p>From the other side, if we're in console and have a variable referencing a DOM node, then we can use the command <code>inspect(node)</code> to see it in the Elements pane.</p>
<p>Or we can just output it in the console and explore “at-place”, like <code>document.body</code> below:</p>
      <img src="http://javascript.info/article/dom-nodes/domconsole1.png">
<p>That's for debugging purposes of course. From the next chapter on we'll access and modify DOM using JavaScript.</p>
<p>The browser developer tools are a great help in development: we can explore DOM, try things and see what goes wrong.</p>
<h2 id="chapter-582">
Summary</h2>
<p>An HTML/XML document is represented inside the browser as the DOM tree.</p>
<ul>
<li>Tags become element nodes and form the structure.</li>
<li>Text becomes text nodes.</li>
<li>…etc, everything in HTML has its place in DOM, even comments.</li>
</ul>
<p>We can use developer tools to inspect DOM and modify it manually.</p>
<p>Here we covered the basics, most used and important actions to start with. There's an extensive documentation about Chrome developer tools at 
<a href="https://developers.google.com/web/tools/chrome-devtools">https://developers.google.com/web/tools/chrome-devtools</a>. The best way to learn the tools is to click here and there, read menus: most options are obvious. Later, when you know them in general, read the docs and pick up the rest.</p>
<p>DOM nodes have properties and methods that allow to travel between them, modify, move around the page and more. We'll get down to them in the next chapters.</p>
#travel-dom-comment {
  font-style: italic;
}
#travel-dom-control ul {
  margin: 6px 0;
}



<h6 id="chapter-583"></h6>
<h1 class="main__header-title" id="chapter-584">Walking the DOM</h1>
<p>DOM allows to do anything with elements and their contents, but first we need to reach the corresponding DOM object, get it into a variable, and then we are able to modify it.</p>
<p>All operations on DOM start with the <code>document</code> object. From it we can access any node.</p>


<p>Here's a picture of links that allow to travel between DOM nodes:</p>
      <img src="http://javascript.info/article/dom-navigation/dom-links.png">
<p>Let's discuss them in more detail.</p>
<h2 id="chapter-585">
On top: documentElement and body</h2>
<p>The topmost tree nodes are available directly as <code>document</code> properties:</p>
<dl>
<dt><code>&lt;html&gt;</code> = <code>document.documentElement</code></dt>
<dd>The topmost document node is <code>document.documentElement</code>. That's DOM node of <code>&lt;html&gt;</code> tag.</dd>
<dt><code>&lt;body&gt;</code> = <code>document.body</code></dt>
<dd>Another widely used DOM node is the <code>&lt;body&gt;</code> element – <code>document.body</code>.</dd>
<dt><code>&lt;head&gt;</code> = <code>document.head</code></dt>
<dd>The <code>&lt;head&gt;</code> tag is available as <code>document.head</code>.</dd>
</dl>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">There's a catch: <code>document.body</code> can be <code>null</code></span></div>
            <div class="important__content"><p>A script cannot access an element that doesn't exist at the moment of running.</p>
<p>In particular, if a script is inside <code>&lt;head&gt;</code>, then <code>document.body</code> is unavailable, because the browser did not read it yet.</p>
<p>So, in the example below the first <code>alert</code> shows <code>null</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;html&gt;

&lt;head&gt;
  &lt;script&gt;
    alert( "From HEAD: " + document.body ); // null, there's no &lt;body&gt; yet
  &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;script&gt;
    alert( "From BODY: " + document.body ); // HTMLBodyElement, now it exists
  &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">In the DOM world <code>null</code> means “doesn't exist”</span></div>
            <div class="important__content"><p>In the DOM, the <code>null</code> value means “doesn't exist” or “no such node”.</p>
</div></div>
<h2 id="chapter-586">
Children: childNodes, firstChild, lastChild</h2>
<p>There are two terms that we'll use from now on:</p>
<ul>
<li><strong>Child nodes (or children)</strong> – elements that are direct children. In other words, they are nested exactly in the given one. For instance, <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code> are children of <code>&lt;html&gt;</code> element.</li>
<li><strong>Descendants</strong> – all elements that are nested in the given one, including children, their children and so on.</li>
</ul>
<p>For instance, here <code>&lt;body&gt;</code> has children <code>&lt;div&gt;</code> and <code>&lt;ul&gt;</code> (and few blank text nodes):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;html&gt;
&lt;body&gt;
  &lt;div&gt;Begin&lt;/div&gt;

  &lt;ul&gt;
    &lt;li&gt;
      &lt;b&gt;Information&lt;/b&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>…And if we ask for all descendants of <code>&lt;body&gt;</code>, then we get direct children <code>&lt;div&gt;</code>, <code>&lt;ul&gt;</code> and also more nested elements like <code>&lt;li&gt;</code> (being a child of <code>&lt;ul&gt;</code>) and <code>&lt;b&gt;</code> (being a child of <code>&lt;li&gt;</code>) – the whole subtree.</p>
<p><strong>The <code>childNodes</code> collection provides access to all child nodes, including text nodes.</strong></p>
<p>The example below shows children of <code>document.body</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="11-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;html&gt;
&lt;body&gt;
  &lt;div&gt;Begin&lt;/div&gt;

  &lt;ul&gt;
    &lt;li&gt;Information&lt;/li&gt;
  &lt;/ul&gt;

  &lt;div&gt;End&lt;/div&gt;

  &lt;script&gt;
    for (let i = 0; i &lt; document.body.childNodes.length; i++) {
      alert( document.body.childNodes[i] ); // Text, DIV, Text, UL, ..., SCRIPT
    }
  &lt;/script&gt;
  ...more stuff...
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Please note an interesting detail here. If we run the example above, the last element shown is <code>&lt;script&gt;</code>. In fact, the document has more stuff below, but at the moment of the script execution the browser did not read it yet, so the script doesn't see it.</p>
<p><strong>Properties <code>firstChild</code> and <code>lastChild</code> give fast access to the first and last children.</strong></p>
<p>They are just shorthands. If there exist child nodes, then the following is always true:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">elem.childNodes[0] === elem.firstChild
elem.childNodes[elem.childNodes.length - 1] === elem.lastChild</code></pre>
        </div>
      </div>
      
      </div><p>There's also a special function <code>elem.hasChildNodes()</code> to check whether there are any child nodes.</p>
<h3>
DOM collections</a></h3><p>As we can see, <code>childNodes</code> looks like an array. But actually it's not an array, but rather a <em>collection</em> – a special array-like iterable object.</p>
<p>There are two important consequences:</p>
<ol>
<li>We can use <code>for..of</code> to iterate over it:</li>
</ol>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let node of document.body.childNodes) {
  alert(node); // shows all nodes from the collection
}</code></pre>
        </div>
      </div>
      
      </div><p>That's because it's iterable (provides the <code>Symbol.iterator</code> property, as required).</p>
<ol start="2">
<li>Array methods won't work, because it's not an array:</li>
</ol>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(document.body.childNodes.filter); // undefined (there's no filter method!)</code></pre>
        </div>
      </div>
      
      </div><p>The first thing is nice. The second is tolerable, because we can use <code>Array.from</code> to create a “real” array from the collection, if we want array methods:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( Array.from(document.body.childNodes).filter ); // now it's there</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">DOM collections are read-only</span></div>
            <div class="important__content"><p>DOM collections, and even more – <em>all</em> navigation properties listed in this chapter are read-only.</p>
<p>We can't replace a child by something else assigning <code>childNodes[i] = ...</code>.</p>
<p>Changing DOM needs other methods, we'll see them in the next chapter.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">DOM collections are live</span></div>
            <div class="important__content"><p>Almost all DOM collections with minor exceptions are <em>live</em>. In other words, they reflect the current state of DOM.</p>
<p>If we keep a reference to <code>elem.childNodes</code>, and add/remove nodes into DOM, then they appear in the collection automatically.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Don't use <code>for..in</code> to loop over collections</span></div>
            <div class="important__content"><p>Collections are iterable using <code>for..of</code>. Sometimes people try to use <code>for..in</code> for that.</p>
<p>Please, don't. The <code>for..in</code> loop iterates over all enumerable properties. And collections have some “extra” rarely used properties that we usually do not want to get:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;
&lt;script&gt;
  // shows 0, 1, length, item, values and more.
  for(let prop in document.body.childNodes) alert(prop);
&lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-587">
Siblings and the parent</h2>
<p><em>Siblings</em> are nodes that are children of the same parent. For instance, <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code> are siblings:</p>
<ul>
<li><code>&lt;body&gt;</code> is said to be the “next” or “right” sibling of <code>&lt;head&gt;</code>,</li>
<li><code>&lt;head&gt;</code> is said to be the “previous” or “left” sibling of <code>&lt;body&gt;</code>.</li>
</ul>
<p>The parent is available as <code>parentNode</code>.</p>
<p>The next node in the same parent (next sibling) is <code>nextSibling</code>, and the previous one is <code>previousSibling</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;script&gt;
  // HTML is "dense" to evade extra "blank" text nodes.

  // parent of &lt;body&gt; is &lt;html&gt;
  alert( document.body.parentNode === document.documentElement ); // true

  // after &lt;head&gt; goes &lt;body&gt;
  alert( document.head.nextSibling ); // HTMLBodyElement

  // before &lt;body&gt; goes &lt;head&gt;
  alert( document.body.previousSibling ); // HTMLHeadElement
&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-588">
Element-only navigation</h2>
<p>Navigation properties listed above refer to <em>all</em> nodes. For instance, in <code>childNodes</code> we can see both text nodes, element nodes, and even comment nodes if there exist.</p>
<p>But for many tasks we don't want text or comment nodes. We want to manipulate element nodes that represent tags and form the structure of the page.</p>
<p>So let's see more navigation links that only take <em>element nodes</em> into account:</p>
      <img src="http://javascript.info/article/dom-navigation/dom-links-elements.png">
<p>The links are similar to those given above, just with <code>Element</code> word inside:</p>
<ul>
<li><code>children</code> – only those children that are element nodes.</li>
<li><code>firstElementChild</code>, <code>lastElementChild</code> – first and last element children.</li>
<li><code>previousElementSibling</code>, <code>nextElementSibling</code> – neighbour elements.</li>
<li><code>parentElement</code> – parent element.</li>
</ul>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Why <code>parentElement</code>? Can the parent be <em>not</em> an element?</span></div>
            <div class="important__content"><p>The <code>parentElement</code> property returns the “element” parent, while <code>parentNode</code> returns “any node” parent. These properties are usually the same: they both get the parent.</p>
<p>With the one exception of <code>document.documentElement</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( document.documentElement.parentNode ); // document
alert( document.documentElement.parentElement ); // null</code></pre>
        </div>
      </div>
      
      </div><p>In other words, the <code>documentElement</code> (<code>&lt;html&gt;</code>) is the root node. Formally, it has <code>document</code> as its parent. But <code>document</code> is not an element node, so <code>parentNode</code> returns it and <code>parentElement</code> does not.</p>
<p>Sometimes that matters when we're walking over the chain of parents and call a method on each of them, but <code>document</code> doesn't have it, so we exclude it.</p>
</div></div>
<p>Let's modify one of examples above: replace <code>childNodes</code> with <code>children</code>. Now it shows only elements:</p>
<div data-trusted="1" class="code-example" data-highlight-block="11-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;html&gt;
&lt;body&gt;
  &lt;div&gt;Begin&lt;/div&gt;

  &lt;ul&gt;
    &lt;li&gt;Information&lt;/li&gt;
  &lt;/ul&gt;

  &lt;div&gt;End&lt;/div&gt;

  &lt;script&gt;
    for (let elem of document.body.children) {
      alert(elem); // DIV, UL, DIV, SCRIPT
    }
  &lt;/script&gt;
  ...
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-589">
More links: tables</h2>
<p>Till now we described the basic navigation properties.</p>
<p>Certain types of DOM elements may provide additional properties, specific to their type, for convenience.</p>
<p>Tables are a great example and important particular case of that.</p>
<p><strong><code>&lt;table&gt;</code></strong> element supports (in addition to the given above) these properties:</p>
<ul>
<li><code>table.rows</code> – the collection of <code>&lt;tr&gt;</code> elements of the table.</li>
<li><code>table.caption/tHead/tFoot</code> – references to elements <code>&lt;caption&gt;</code>, <code>&lt;thead&gt;</code>, <code>&lt;tfoot&gt;</code>.</li>
<li><code>table.tBodies</code> – the collection of <code>&lt;tbody&gt;</code> elements (can be many according to the standard).</li>
</ul>
<p><strong><code>&lt;thead&gt;</code>, <code>&lt;tfoot&gt;</code>, <code>&lt;tbody&gt;</code></strong> elements provide the <code>rows</code> property:</p>
<ul>
<li><code>tbody.rows</code> – the collection of <code>&lt;tr&gt;</code> inside.</li>
</ul>
<p><strong><code>&lt;tr&gt;</code>:</strong></p>
<ul>
<li><code>tr.cells</code> – the collection of <code>&lt;td&gt;</code> and <code>&lt;th&gt;</code> cells inside the given <code>&lt;tr&gt;</code>.</li>
<li><code>tr.sectionRowIndex</code> – the number of the given <code>&lt;tr&gt;</code> inside the enclosing <code>&lt;thead&gt;/&lt;tbody&gt;</code>.</li>
<li><code>tr.rowIndex</code> – the number of the <code>&lt;tr&gt;</code> in the table.</li>
</ul>
<p><strong><code>&lt;td&gt;</code> and <code>&lt;th&gt;</code>:</strong></p>
<ul>
<li><code>td.cellIndex</code> – the number of the cell inside the enclosing <code>&lt;tr&gt;</code>.</li>
</ul>
<p>An example of usage:</p>
<div data-trusted="1" class="code-example" data-demo-height="100" data-highlight-inline="11:15-31">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;table id="table"&gt;
  &lt;tr&gt;
    &lt;td&gt;one&lt;/td&gt;&lt;td&gt;two&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;three&lt;/td&gt;&lt;td&gt;four&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

&lt;script&gt;
  // get the content of the first row, second cell
  alert( table.rows[0].cells[1].innerHTML ) // "two"
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The specification: 
<a href="https://html.spec.whatwg.org/multipage/tables.html">tabular data</a>.</p>
<p>There are also additional navigation properties for HTML forms. We'll look at them later when start working with forms.</p>
<h1 id="chapter-590">
Summary</a></h1><p>Given a DOM node, we can go to its immediate neighbours using navigation properties.</p>
<p>There are two main sets of them:</p>
<ul>
<li>For all nodes: <code>parentNode</code>, <code>childNodes</code>, <code>firstChild</code>, <code>lastChild</code>, <code>previousSibling</code>, <code>nextSibling</code>.</li>
<li>For element nodes only: <code>parentElement</code>, <code>children</code>, <code>firstElementChild</code>, <code>lastElementChild</code>, <code>previousElementSibling</code>, <code>nextElementSibling</code>.</li>
</ul>
<p>Some types of DOM elements, e.g. tables, provide additional properties and collections to access their content.</p>
<div class="tasks"><h2 id="chapter-591" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#dom-children" name="dom-children" class="main__anchor">DOM children</a></h3>
<a href="http://javascript.info/task/dom-children" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>For the page:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;html&gt;
&lt;body&gt;
  &lt;div&gt;Users:&lt;/div&gt;
  &lt;ul&gt;
    &lt;li&gt;John&lt;/li&gt;
    &lt;li&gt;Pete&lt;/li&gt;
  &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>How to access:</p>
<ul>
<li>The <code>&lt;div&gt;</code> DOM node?</li>
<li>The <code>&lt;ul&gt;</code> DOM node?</li>
<li>The second <code>&lt;li&gt;</code> (with Pete)?</li>
</ul>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>There are many ways, for instance:</p>
<p>The <code>&lt;div&gt;</code> DOM node:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.body.firstElementChild
// or
document.body.children[0]
// or (the first node is space, so we take 2nd)
document.body.childNodes[1]</code></pre>
        </div>
      </div>
      
      </div><p>The <code>&lt;ul&gt;</code> DOM node:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.body.lastElementChild
// or
document.body.children[1]</code></pre>
        </div>
      </div>
      
      </div><p>The second <code>&lt;li&gt;</code> (with Pete):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// get &lt;ul&gt;, and then get its last element child
document.body.lastElementChild.lastElementChild</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#the-sibling-question" name="the-sibling-question" class="main__anchor">The sibling question</a></h3>
<a href="http://javascript.info/task/navigation-links-which-null" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>If <code>elem</code> – is an arbitrary DOM element node…</p>
<ul>
<li>Is it true that <code>elem.lastChild.nextSibling</code> is always <code>null</code>?</li>
<li>Is it true that <code>elem.children[0].previousSibling</code> is always <code>null</code> ?</li>
</ul>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><ol>
<li>Yes, true. The element <code>elem.lastChild</code> is always the last one, it has no <code>nextSibling</code>, so if there are children, then yes.</li>
<li>No, wrong, because <code>elem.children[0]</code> is the first child among elements. But there may be non-element nodes before it. So <code>previousSibling</code> may be a text node.</li>
</ol>
<p>Please note that for both cases if there are no children, then there will be an error. For instance, if <code>elem.lastChild</code> is <code>null</code>, we can't access <code>elem.lastChild.nextSibling</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#select-all-diagonal-cells" name="select-all-diagonal-cells" class="main__anchor">Select all diagonal cells</a></h3>
<a href="http://javascript.info/task/select-diagonal-cells" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write the code to paint all diagonal table cells in red.</p>
<p>You'll need to get all diagonal <code>&lt;td&gt;</code> from the <code>&lt;table&gt;</code> and paint them using the code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// td should be the reference to the table cell
td.style.backgroundColor = 'red';</code></pre>
        </div>
      </div>
      
      </div><p>The result should be:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:180px" src="https://en.js.cx/task/select-diagonal-cells/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/KqjpnZ6j8DIuwW1fJX7s?p=preview" target="_blank" data-plunk-id="KqjpnZ6j8DIuwW1fJX7s">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We'll be using <code>rows</code> and <code>cells</code> properties to access diagonal table cells.</p>
<p>
<a href="http://plnkr.co/edit/S4OxRAj424CVYRnAUgTv?p=preview" target="_blank" data-plunk-id="S4OxRAj424CVYRnAUgTv">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-592"></h6>
<h1 class="main__header-title" id="chapter-593">Searching: getElement* and querySelector*</h1>
<p>DOM navigation properties are great when elements are close to each other. What if they are not? How to get an arbitrary element of the page?</p>
<p>There are additional searching methods for that.
</p>
<h2 id="chapter-594">
document.getElementById or just id</h2>
<p>If an element has the <code>id</code> attribute, then there's a global variable by the name from that <code>id</code>.</p>
<p>We can use it to access the element, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:9-13,1:11-23">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="elem"&gt;
  &lt;div id="elem-content"&gt;Element&lt;/div&gt;
&lt;/div&gt;

&lt;script&gt;
  alert(elem); // DOM-element with id="elem"
  alert(window.elem); // accessing global variable like this also works

  // for elem-content things are a bit more complex
  // that has a dash inside, so it can't be a variable name
  alert(window['elem-content']); // ...but accessible using square brackets [...]
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>That's unless we declare the same-named variable by our own:</p>
<div data-trusted="0" class="code-example" data-demo-height="0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="elem"&gt;&lt;/div&gt;

&lt;script&gt;
  let elem = 5;

  alert(elem); // the variable overrides the element
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The behavior is described 
<a href="http://www.whatwg.org/specs/web-apps/current-work/#dom-window-nameditem">in the specification</a>, but it is supported mainly for compatibility. The browser tries to help us by mixing namespaces of JS and DOM. Good for very simple scripts, but there may be name conflicts. Also, when we look in JS and don't have HTML in view, it's not obvious where the variable comes from.</p>
<p>The better alternative is to use a special method <code>document.getElementById(id)</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="elem"&gt;
  &lt;div id="elem-content"&gt;Element&lt;/div&gt;
&lt;/div&gt;

&lt;script&gt;
  let elem = document.getElementById('elem');

  elem.style.background = 'red';
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Here in the tutorial we'll often use <code>id</code> to directly reference an element, but that's only to keep things short. In real life <code>document.getElementById</code> is the preferred method.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">There can be only one</span></div>
            <div class="important__content"><p>The <code>id</code> must be unique. There can be only one element in the document with the given <code>id</code>.</p>
<p>If there are multiple elements with the same <code>id</code>, then the behavior of corresponding methods is unpredictable. The browser may return any of them at random. So please stick to the rule and keep <code>id</code> unique.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Only <code>document.getElementById</code>, not <code>anyNode.getElementById</code></span></div>
            <div class="important__content"><p>The method <code>getElementById</code> that can be called only on <code>document</code> object. It looks for the given <code>id</code> in the whole document.</p>
</div></div>
<h2 id="chapter-595">
getElementsBy*</h2>
<p>There are also other methods to look for nodes:</p>
<ul>
<li><code>elem.getElementsByTagName(tag)</code> looks for elements with the given tag and returns the collection of them. The <code>tag</code> parameter can also be a star <code>"*"</code> for “any tags”.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// get all divs in the document
let divs = document.getElementsByTagName('div');</code></pre>
        </div>
      </div>
      
      </div><p>This method is callable in the context of any DOM element.</p>
<p>Let's find all <code>input</code> inside the table:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-highlight-block="19-19">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;table id="table"&gt;
  &lt;tr&gt;
    &lt;td&gt;Your age:&lt;/td&gt;

    &lt;td&gt;
      &lt;label&gt;
        &lt;input type="radio" name="age" value="young" checked&gt; less than 18
      &lt;/label&gt;
      &lt;label&gt;
        &lt;input type="radio" name="age" value="mature"&gt; from 18 to 50
      &lt;/label&gt;
      &lt;label&gt;
        &lt;input type="radio" name="age" value="senior"&gt; more than 60
      &lt;/label&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

&lt;script&gt;
  let inputs = table.getElementsByTagName('input');

  for (let input of inputs) {
    alert( input.value + ': ' + input.checked );
  }
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Don't forget the <code>"s"</code> letter!</span></div>
            <div class="important__content"><p>Novice developers sometimes forget the letter <code>"s"</code>. That is, they try to call <code>getElementByTagName</code> instead of <code>getElement<b>s</b>ByTagName</code>.</p>
<p>The <code>"s"</code> letter is absent in <code>getElementById</code>, because it returns a single element. But <code>getElementsByTagName</code> returns a collection of elements, so there's <code>"s"</code> inside.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">It returns a collection, not an element!</span></div>
            <div class="important__content"><p>Another widespread novice mistake is to write like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// doesn't work
document.getElementsByTagName('input').value = 5;</code></pre>
        </div>
      </div>
      
      </div><p>That won't work, because it takes a <em>collection</em> of inputs and assigns the value to it, rather to elements inside it.</p>
<p>We should either iterate over the collection or get an element by the number, and then assign, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// should work (if there's an input)
document.getElementsByTagName('input')[0].value = 5;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<p>There are also other rarely used methods of this kind:</p>
<ul>
<li><code>elem.getElementsByClassName(className)</code> returns elements that have the given CSS class. Elements may have other classes too.</li>
<li><code>document.getElementsByName(name)</code> returns elements with the given <code>name</code> attribute, document-wide. Exists for historical reasons, very rarely used, we mention it here only for completeness.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="50">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form name="my-form"&gt;
  &lt;div class="article"&gt;Article&lt;/div&gt;
  &lt;div class="long article"&gt;Long article&lt;/div&gt;
&lt;/form&gt;

&lt;script&gt;
  // find by name attribute
  let form = document.getElementsByName('my-form')[0];

  // find by class inside the form
  let articles = form.getElementsByClassName('article');
  alert(articles.length); // 2, found two elements with class "article"
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-596">
querySelectorAll</h2>
<p>Now goes the heavy artillery.</p>
<p>The call to <code>elem.querySelectorAll(css)</code> returns all elements inside <code>elem</code> matching the given CSS selector. That's the most often used and powerful method.</p>
<p>Here we look for all <code>&lt;li&gt;</code> elements that are last children:</p>
<div data-trusted="1" class="code-example" data-highlight-block="9-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;ul&gt;
  &lt;li&gt;The&lt;/li&gt;
  &lt;li&gt;test&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
  &lt;li&gt;has&lt;/li&gt;
  &lt;li&gt;passed&lt;/li&gt;
&lt;/ul&gt;
&lt;script&gt;
  let elements = document.querySelectorAll('ul &gt; li:last-child');

  for (let elem of elements) {
    alert(elem.innerHTML); // "test", "passed"
  }
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>This method is indeed powerful, because any CSS selector can be used.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Can use pseudo-classes as well</span></div>
            <div class="important__content"><p>Pseudo-classes in the CSS selector like <code>:hover</code> and <code>:active</code> are also supported. For instance, <code>document.querySelectorAll(':hover')</code> will return the collection with elements that the pointer is  over now (in nesting order: from the outermost <code>&lt;html&gt;</code> to the most nested one).</p>
</div></div>
<h2 id="chapter-597">
querySelector</h2>
<p>The call to <code>elem.querySelector(css)</code> returns the first element for the given CSS selector.</p>
<p>In other words, the result is the same as <code>elem.querySelectorAll(css)[0]</code>, but the latter is looking for <em>all</em> elements and picking one, while <code>elem.querySelector</code> just looks for one. So it's faster and shorter to write.</p>
<h2 id="chapter-598">
matches</h2>
<p>Previous methods were searching the DOM.</p>
<p>The 
<a href="http://dom.spec.whatwg.org/#dom-element-matches">elem.matches(css)</a> does not look for anything, it merely checks if <code>elem</code> matches the given CSS-selector. It returns <code>true</code> or <code>false</code>.</p>
<p>The method comes handy when we are iterating over elements (like in array or something) and trying to filter those that interest us.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;a href="http://example.com/file.zip"&gt;...&lt;/a&gt;
&lt;a href="http://ya.ru"&gt;...&lt;/a&gt;

&lt;script&gt;
  // can be any collection instead of document.body.children
  for (let elem of document.body.children) {
    if (elem.matches('a[href$="zip"]')) {
      alert("The archive reference: " + elem.href );
    }
  }
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-599">
closest</h2>
<p>All elements that are directly above the given one are called its <em>ancestors</em>.</p>
<p>In other words, ancestors are: parent, the parent of parent, its parent and so on. The ancestors together form the chain of parents from the element to the top.</p>
<p>The method <code>elem.closest(css)</code> looks the nearest ancestor that matches the CSS-selector. The <code>elem</code> itself is also included in the search.</p>
<p>In other words, the method <code>closest</code> goes up from the element and checks each of parents. If it matches the selector, then the search stops, and the ancestor is returned.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;h1&gt;Contents&lt;/h1&gt;

&lt;div class="contents"&gt;
  &lt;ul class="book"&gt;
    &lt;li class="chapter"&gt;Chapter 1&lt;/li&gt;
    &lt;li class="chapter"&gt;Chapter 1&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;

&lt;script&gt;
  let chapter = document.querySelector('.chapter'); // LI

  alert(chapter.closest('.book')); // UL
  alert(chapter.closest('.contents')); // DIV

  alert(chapter.closest('h1')); // null (because h1 is not an ancestor)
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-600">
Live collections</h2>
<p>All methods <code>"getElementsBy*"</code> return a <em>live</em> collection. Such collections always reflect the current state of the document and “auto-update” when it changes.</p>
<p>In the example below, there are two scripts.</p>
<ol>
<li>The first one creates a reference to the collection of <code>&lt;div&gt;</code>. As of now, it's length is <code>1</code>.</li>
<li>The second scripts runs after the browser meets one more <code>&lt;div&gt;</code>, so it's length is <code>2</code>.</li>
</ol>
<div data-trusted="1" class="code-example" data-highlight-block="10-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div&gt;First div&lt;/div&gt;

&lt;script&gt;
  let divs = document.getElementsByTagName('div');
  alert(divs.length); // 1
&lt;/script&gt;

&lt;div&gt;Second div&lt;/div&gt;

&lt;script&gt;
  alert(divs.length); // 2
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>In contrast, <code>querySelectorAll</code> returns a <em>static</em> collection. It's like a fixed array of elements.</p>
<p>If we use it instead, then both scripts output <code>1</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div&gt;First div&lt;/div&gt;

&lt;script&gt;
  let divs = document.querySelectorAll('div');
  alert(divs.length); // 1
&lt;/script&gt;

&lt;div&gt;Second div&lt;/div&gt;

&lt;script&gt;
  alert(divs.length); // 1
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Now we can easily see the difference. The static collection did not increase after the appearance of a new <code>div</code> in the document.</p>
<p>Here we used separate scripts to illustrate how the element addition affects the collection, but any DOM manipulations affect them. Soon we'll see more of them.</p>
<h2 id="chapter-601">
Summary</h2>
<p>There are 6 main methods to search for nodes in DOM:</p>
<table>
<thead>
<tr>
<td>Method</td>
<td>Searches by...</td>
<td>Can call on an element?</td>
<td>Live?</td>
</tr>
</thead>
<tbody>
<tr>
<td><code>getElementById</code></td>
<td><code>id</code></td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><code>getElementsByName</code></td>
<td><code>name</code></td>
<td>-</td>
<td>✔</td>
</tr>
<tr>
<td><code>getElementsByTagName</code></td>
<td>tag or <code>'*'</code></td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><code>getElementsByClassName</code></td>
<td>class</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><code>querySelector</code></td>
<td>CSS-selector</td>
<td>✔</td>
<td>-</td>
</tr>
<tr>
<td><code>querySelectorAll</code></td>
<td>CSS-selector</td>
<td>✔</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>Please note that methods <code>getElementById</code> and <code>getElementsByName</code> can only be called in the context of the document: <code>document.getElementById(...)</code>. But not on an element: <code>elem.getElementById(...)</code> would cause an error.</p>
<p>Other methods can be called on elements too. For instance <code>elem.querySelectorAll(...)</code> will search inside <code>elem</code> (in the DOM subtree).</p>
<p>Besides that:</p>
<ul>
<li>There is <code>elem.matches(css)</code> to check if <code>elem</code> matches the given CSS selector.</li>
<li>There is <code>elem.closest(css)</code> to look for a nearest ancestor that matches the given CSS-selector. The <code>elem</code> itself is also checked.</li>
</ul>
<p>And let's mention one more method here to check for the child-parent relationship:</p>
<ul>
<li><code>elemA.contains(elemB)</code> returns true if <code>elemB</code> is inside <code>elemA</code> (a descendant of <code>elemA</code>) or when <code>elemA==elemB</code>.</li>
</ul>
<div class="tasks"><h2 id="chapter-602" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#search-for-elements" name="search-for-elements" class="main__anchor">Search for elements</a></h3>
<a href="http://javascript.info/task/find-elements" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Here's the document with the table and form.</p>
<p>How to find?</p>
<ol>
<li>The table with <code>id="age-table"</code>.</li>
<li>All <code>label</code> elements inside that table (there should be 3 of them).</li>
<li>The first <code>td</code> in that table (with the word “Age”).</li>
<li>The <code>form</code> with the name <code>search</code>.</li>
<li>The first <code>input</code> in that form.</li>
<li>The last <code>input</code> in that form.</li>
</ol>
<p>Open the page 
<a href="http://javascript.info/task/find-elements/table.html">table.html</a> in a separate window and make use of browser tools for that.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>There are many ways to do it.</p>
<p>Here are some of them:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// 1. The table with `id="age-table"`.
let table = document.getElementById('age-table')

// 2. All label elements inside that table
table.getElementsByTagName('label')
// or
document.querySelectorAll('#age-table label')

// 3. The first td in that table (with the word "Age").
table.rows[0].cells[0]
// or
table.getElementsByTagName('td')[0]
// or
table.querySelector('td')

// 4. The form with the name "search".
// assuming there's only one element with name="search"
let form = document.getElementsByName('search')[0]
// or, form specifically
document.querySelector('form[name="search"]')

// 5. The first input in that form.
form.getElementsByTagName('input')
// or
form.querySelector('input')

// 6. The last input in that form.
// there's no direct query for that
let inputs = form.querySelectorAll('input') // search all
inputs[inputs.length-1] // take last</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#count-descendants" name="count-descendants" class="main__anchor">Count descendants</a></h3>
<a href="http://javascript.info/task/tree-info" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's a tree structured as nested <code>ul/li</code>.</p>
<p>Write the code that for each <code>&lt;li&gt;</code> shows:</p>
<ol>
<li>What's the text inside it (without the subtree)</li>
<li>The number of nested <code>&lt;li&gt;</code> – all descendants, including the deeply nested ones.</li>
</ol>
<p>
<a href="https://en.js.cx/task/tree-info/solution/" target="blank">Demo in new window</a></p><p>
<a href="http://plnkr.co/edit/e102zJMEEkV4e6LnCy2D?p=preview" target="_blank" data-plunk-id="e102zJMEEkV4e6LnCy2D">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Let's make a loop over <code>&lt;li&gt;</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let li of document.querySelector('li')) {
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>In the loop we need to get the text inside every <code>li</code>. We can read it directly from the first child node, that is the text node:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">for (let li of document.querySelector('li')) {
  let title = li.firstChild.data;

  // title is the text in &lt;li&gt; before any other nodes
}</code></pre>
        </div>
      </div>
      
      </div><p>Then we can get the number of descendants <code>li.getElementsByTagName('li')</code>.</p>
<p>
<a href="http://plnkr.co/edit/qtLIEjp259SCjpMqS5ZU?p=preview" target="_blank" data-plunk-id="qtLIEjp259SCjpMqS5ZU">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-603"></h6>
<h1 class="main__header-title" id="chapter-604">Node properties: type, tag and contents</h1>
<p>Let's get a more in-depth look at DOM nodes.</p>
<p>In this chapter we'll see more into what they are and their most used properties.</p>


<h2 id="chapter-605">
DOM node classes</h2>
<p>DOM nodes have different properties depending on their class. For instance, an element node corresponding to tag <code>&lt;a&gt;</code> has link-related properties, and the one corresponding to <code>&lt;input&gt;</code> has input-related properties and so on. Text nodes are not the same as element nodes. But there are also common properties and methods between all of them, because all classes of DOM nodes form a single hierarchy.</p>
<p>Each DOM node belongs to the corresponding built-in class.</p>
<p>The root of the hierarchy is 
<a href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a>, that is inherited by  
<a href="http://dom.spec.whatwg.org/#interface-node">Node</a>, and other DOM nodes inherit from it.</p>
<p>Here's the picture, explanations to follow:</p>
      <img src="http://javascript.info/article/basic-dom-node-properties/dom-class-hierarchy.png">
<p>The classes are:</p>
<ul>
<li>
<a href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a> – is the root “abstract” class. Objects of that class are never created. It serves as a base, so that all DOM nodes support so-called “events”, we'll study them later.</li>
<li>
<a href="http://dom.spec.whatwg.org/#interface-node">Node</a> – is also an “abstract” class, serving as a base  for DOM nodes. It provides the core tree functionality: <code>parentNode</code>, <code>nextSibling</code>, <code>childNodes</code> and so on (they are getters). Objects of <code>Node</code> class are never created. But there are concrete node classes that inherit from it, namely: <code>Text</code> for text nodes, <code>Element</code> for element nodes and more exotic ones like <code>Comment</code> for comment nodes.</li>
<li>
<a href="http://dom.spec.whatwg.org/#interface-element">Element</a> – is a base class for DOM elements. It provides element-level navigation like <code>nextElementSibling</code>, <code>children</code> and searching methods like <code>getElementsByTagName</code>, <code>querySelector</code>. In the browser there may be not only HTML, but also XML and SVG documents. The <code>Element</code> class serves as a base for more specific classes: <code>SVGElement</code>, <code>XMLElement</code> and <code>HTMLElement</code>.</li>
<li>
<a href="https://html.spec.whatwg.org/multipage/dom.html#htmlelement">HTMLElement</a> – is finally the basic class for all HTML elements. It is inherited by various HTML elements:
<ul>
<li>
<a href="https://html.spec.whatwg.org/multipage/forms.html#htmlinputelement">HTMLInputElement</a> – the class for <code>&lt;input&gt;</code> elements,</li>
<li>
<a href="https://html.spec.whatwg.org/multipage/semantics.html#htmlbodyelement">HTMLBodyElement</a> – the class for <code>&lt;body&gt;</code> elements,</li>
<li>
<a href="https://html.spec.whatwg.org/multipage/semantics.html#htmlanchorelement">HTMLAnchorElement</a> – the class for <code>&lt;a&gt;</code> elements</li>
<li>…and so on, each tag has its own class that may provide specific properties and methods.</li>
</ul>
</li>
</ul>
<p>So, the full set of properties and methods of a given node comes as the result of the inheritance.</p>
<p>For example, let's consider the DOM object for an <code>&lt;input&gt;</code> element. It belongs to 
<a href="https://html.spec.whatwg.org/multipage/forms.html#htmlinputelement">HTMLInputElement</a> class. It gets properties and methods as a superposition of:</p>
<ul>
<li><code>HTMLInputElement</code> – this class provides input-specific properties, and inherits from…</li>
<li><code>HTMLElement</code> – it provides common HTML element methods (and getters/setters) and inherits from…</li>
<li><code>Element</code> – provides generic element methods and inherits from…</li>
<li><code>Node</code> – provides common DOM node properties and inherits from…</li>
<li><code>EventTarget</code> – gives the support for events (to be covered),</li>
<li>…and finally it inherits from <code>Object</code>, so “pure object” methods like <code>hasOwnProperty</code> are also available.</li>
</ul>
<p>To see the DOM node class name, we can recall that an object usually has the <code>constructor</code> property. It references to the class constructor, and <code>constructor.name</code> is its name:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( document.body.constructor.name ); // HTMLBodyElement</code></pre>
        </div>
      </div>
      
      </div><p>…Or we can just <code>toString</code> it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( document.body ); // [object HTMLBodyElement]</code></pre>
        </div>
      </div>
      
      </div><p>We also can use <code>instanceof</code> to check the inheritance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( document.body instanceof HTMLBodyElement ); // true
alert( document.body instanceof HTMLElement ); // true
alert( document.body instanceof Element ); // true
alert( document.body instanceof Node ); // true
alert( document.body instanceof EventTarget ); // true</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, DOM nodes are regular JavaScript objects. They use prototype-based classes for inheritance.</p>
<p>That's also easy to see by outputting an element with <code>console.dir(elem)</code> in a browser. There in the console you can see <code>HTMLElement.prototype</code>, <code>Element.prototype</code> and so on.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>console.dir(elem)</code> versus <code>console.log(elem)</code></span></div>
            <div class="important__content"><p>Most browsers support two commands in their developer tools: <code>console.log</code> and <code>console.dir</code>. They output their arguments to the console. For JavaScript objects these commands usually do the same.</p>
<p>But for DOM elements they are different:</p>
<ul>
<li><code>console.log(elem)</code> shows the element DOM tree.</li>
<li><code>console.dir(elem)</code> shows the element as a DOM object, good to explore its properties.</li>
</ul>
<p>Try it on <code>document.body</code>.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">IDL in the spec</span></div>
            <div class="important__content"><p>In the specification classes are described using not JavaScript, but a special 
<a href="https://en.wikipedia.org/wiki/Interface_description_language">Interface description language</a> (IDL), that is usually easy to understand.</p>
<p>In IDL all properties are prepended with their types. For instance, <code>DOMString</code>, <code>boolean</code> and so on.</p>
<p>Here's an excerpt from it, with comments:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1,5-5,11-12,14-14">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Define HTMLInputElement
// The colon ":" means that HTMLInputElement inherits from HTMLElement
interface HTMLInputElement: HTMLElement {
  // here go properties and methods of &lt;input&gt; elements

  // "DOMString" means that these properties are strings
  attribute DOMString accept;
  attribute DOMString alt;
  attribute DOMString autocomplete;
  attribute DOMString value;

  // boolean property (true/false)
  attribute boolean autofocus;
  ...
  // now the method: "void" means that that returns no value
  void select();
  ...
}</code></pre>
        </div>
      </div>
      
      </div><p>Other classes are somewhat similar.</p>
</div></div>
<h2 id="chapter-606">
The “nodeType” property</h2>
<p>The <code>nodeType</code> property provides an old-fashioned way to get the “type” of a DOM node.</p>
<p>It has a numeric value:</p>
<ul>
<li><code>elem.nodeType == 1</code> for element nodes,</li>
<li><code>elem.nodeType == 3</code> for text nodes,</li>
<li><code>elem.nodeType == 9</code> for the document object,</li>
<li>there are few other values in 
<a href="https://dom.spec.whatwg.org/#node">the specification</a>.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;
  &lt;script&gt;
  let elem = document.body;

  // let's examine what it is?
  alert(elem.nodeType); // 1 =&gt; element

  // and the first child is...
  alert(elem.firstChild.nodeType); // 3 =&gt; text

  // for the document object, the type is 9
  alert( document.nodeType ); // 9
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>In modern scripts, we can use <code>instanceof</code> and other class-based tests to see the node type, but sometimes <code>nodeType</code> may be simpler. We can only read <code>nodeType</code>, not change it.</p>
<h2 id="chapter-607">
Tag: nodeName and tagName</h2>
<p>Given a DOM node, we can read its tag name from <code>nodeName</code> or <code>tagName</code> properties:</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( document.body.nodeName ); // BODY
alert( document.body.tagName ); // BODY</code></pre>
        </div>
      </div>
      
      </div><p>Is there any difference between tagName and nodeName?</p>
<p>Sure, the difference is reflected in their names, but is indeed a bit subtle.</p>
<ul>
<li>The <code>tagName</code> property exists only for <code>Element</code> nodes.</li>
<li>The <code>nodeName</code> is defined for any <code>Node</code>:
<ul>
<li>for elements it means the same as <code>tagName</code>.</li>
<li>for other node types (text, comment etc) it has a string with the node type.</li>
</ul>
</li>
</ul>
<p>In other words, <code>tagName</code> is only supported by element nodes (as it originates from <code>Element</code> class), while <code>nodeName</code> can say something about other node types.</p>
<p>For instance let's compare <code>tagName</code> and <code>nodeName</code> for the <code>document</code> and a comment node:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;&lt;!-- comment --&gt;

  &lt;script&gt;
    // for comment
    alert( document.body.firstChild.tagName ); // undefined (not element)
    alert( document.body.firstChild.nodeName ); // #comment

    // for document
    alert( document.tagName ); // undefined (not element)
    alert( document.nodeName ); // #document
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>If we only deal with elements, then <code>tagName</code> is the only thing we should use.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The tag name is always uppercase except XHTML</span></div>
            <div class="important__content"><p>The browser has two modes of processing documents: HTML and XML. Usually the HTML-mode is used for webpages. XML-mode is enabled when the browser receives an XML-document with the header: <code>Content-Type: application/xml+xhtml</code>.</p>
<p>In HTML mode <code>tagName/nodeName</code> is always uppercased: it's <code>BODY</code> either for <code>&lt;body&gt;</code> or <code>&lt;BoDy&gt;</code>.</p>
<p>In XML mode the case is kept “as is”. Nowadays XML mode is rarely used.</p>
</div></div>
<h2 id="chapter-608">
innerHTML: the contents</h2>
<p>The 
<a href="https://w3c.github.io/DOM-Parsing/#widl-Element-innerHTML">innerHTML</a> property allows to get the HTML inside the element as a string.</p>
<p>We can also modify it. So it's one of most powerful ways to change the page.</p>
<p>The example shows the contents of <code>document.body</code> and then replaces it completely:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;
  &lt;p&gt;A paragraph&lt;/p&gt;
  &lt;div&gt;A div&lt;/div&gt;

  &lt;script&gt;
    alert( document.body.innerHTML ); // read the current contents
    document.body.innerHTML = 'The new BODY!'; // replace it
  &lt;/script&gt;

&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>We can try to insert an invalid HTML, the browser will fix our errors:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;

  &lt;script&gt;
    document.body.innerHTML = '&lt;b&gt;test'; // forgot to close the tag
    alert( document.body.innerHTML ); // &lt;b&gt;test&lt;/b&gt; (fixed)
  &lt;/script&gt;

&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Scripts don't execute</span></div>
            <div class="important__content"><p>If <code>innerHTML</code> inserts a <code>&lt;script&gt;</code> tag into the document – it doesn't execute.</p>
<p>It becomes a part of HTML, just as a script that has already run.</p>
</div></div>
<h3>
Beware: “innerHTML+=” does a full overwrite</a></h3><p>We can append “more HTML” by using <code>elem.innerHTML+="something"</code>.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">chatDiv.innerHTML += "&lt;div&gt;Hello&lt;img src='smile.gif'/&gt; !&lt;/div&gt;";
chatDiv.innerHTML += "How goes?";</code></pre>
        </div>
      </div>
      
      </div><p>But we should be very careful about doing it, because what's going on is <em>not</em> an addition, but a full overwrite.</p>
<p>Technically, these two lines do the same:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">elem.innerHTML += "...";
// is a shorter way to write:
elem.innerHTML = elem.innerHTML + "..."</code></pre>
        </div>
      </div>
      
      </div><p>In other words, <code>innerHTML+=</code> does this:</p>
<ol>
<li>The old contents is removed.</li>
<li>The new <code>innerHTML</code> is written instead (a concatenation of the old and the new one).</li>
</ol>
<p><strong>As the content is “zeroed-out” and rewritten from the scratch, all images and other resources will be reloaded</strong>.</p>
<p>In the <code>chatDiv</code> example above the line <code>chatDiv.innerHTML+="How goes?"</code> re-creates the HTML content and reloads <code>smile.gif</code> (hope it's cached). If <code>chatDiv</code> has a lot of other text and images, then the reload becomes clearly visible.</p>
<p>There are other side-effects as well. For instance, if the existing text was selected with the mouse, then most browsers will remove the selection upon rewriting <code>innerHTML</code>. And if there was an <code>&lt;input&gt;</code> with a text entered by the visitor, then the text will be removed. And so on.</p>
<p>Luckily, there are other ways to add HTML besides <code>innerHTML</code>, and we'll study them soon.</p>
<h2 id="chapter-609">
outerHTML: full HTML of the element</h2>
<p>The <code>outerHTML</code> property contains the full HTML of the element. That's like <code>innerHTML</code> plus the element itself.</p>
<p>Here's an example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="elem"&gt;Hello &lt;b&gt;World&lt;/b&gt;&lt;/div&gt;

&lt;script&gt;
  alert(elem.outerHTML); // &lt;div id="elem"&gt;Hello &lt;b&gt;World&lt;/b&gt;&lt;/div&gt;
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p><strong>Beware: unlike <code>innerHTML</code>, writing to <code>outerHTML</code> does not change the element. Instead, it replaces it as a whole in the outer context.</strong></p>
<p>Yeah, sounds strange, and strange it is, that's why we make a separate note about it here. Take a look.</p>
<p>Consider the example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5,8-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div&gt;Hello, world!&lt;/div&gt;

&lt;script&gt;
  let div = document.querySelector('div');

  // replace div.outerHTML with &lt;p&gt;...&lt;/p&gt;
  div.outerHTML = '&lt;p&gt;A new element!&lt;/p&gt;'; // (*)

  // Wow! The div is still the same!
  alert(div.outerHTML); // &lt;div&gt;Hello, world!&lt;/div&gt;
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>In the line <code>(*)</code> we take the full HTML of <code>&lt;div&gt;...&lt;/div&gt;</code> and replace it by <code>&lt;p&gt;...&lt;/p&gt;</code>. In the outer document we can see the new content instead of the <code>&lt;div&gt;</code>. But the old <code>div</code> variable is still the same.</p>
<p>The <code>outerHTML</code> assignment does not modify the DOM element, but extracts it from the outer context and inserts a new piece of HTML instead of it.</p>
<p>Novice developers sometimes make an error here: they modify <code>div.outerHTML</code> and then continue to work with <code>div</code> as if it had the new content in it.</p>
<p>That's possible with <code>innerHTML</code>, but not with <code>outerHTML</code>.</p>
<p>We can write to <code>outerHTML</code>, but should keep in mind that it doesn't change the element we're writing to. It creates the new content on its place instead. We can get a reference to new elements by querying DOM.</p>
<h2 id="chapter-610">
nodeValue/data: text node content</h2>
<p>The <code>innerHTML</code> property is only valid for element nodes.</p>
<p>Other node types have their counterpart: <code>nodeValue</code> and <code>data</code> properties. These two are almost the same for practical use, there are only minor specification differences. So we'll use <code>data</code>, because it's shorter.</p>
<p>We can read it, like this:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-highlight-block="5-5,8-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;
  Hello
  &lt;!-- Comment --&gt;
  &lt;script&gt;
    let text = document.body.firstChild;
    alert(text.data); // Hello

    let comment = text.nextSibling;
    alert(comment.data); // Comment
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>For text nodes we can imagine a reason to read or modify them, but why comments? Usually, they are not interesting at all, but sometimes developers embed information into HTML in them, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!-- if isAdmin --&gt;
  &lt;div&gt;Welcome, Admin!&lt;/div&gt;
&lt;!-- /if --&gt;</code></pre>
        </div>
      </div>
      
      </div><p>…Then JavaScript can read it and process embedded instructions.</p>
<h2 id="chapter-611">
textContent: pure text</h2>
<p>The <code>textContent</code> provides access to the <em>text</em> inside the element: only text, minus all <code>&lt;tags&gt;</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="news"&gt;
  &lt;h1&gt;Headline!&lt;/h1&gt;
  &lt;p&gt;Martians attack people!&lt;/p&gt;
&lt;/div&gt;

&lt;script&gt;
  // Headline! Martians attack people!
  alert(news.textContent);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, only text is returned, as if all <code>&lt;tags&gt;</code> were cut out, but the text in them remained.</p>
<p>In practice, reading such text is rarely needed.</p>
<p><strong>Writing to <code>textContent</code> is much more useful, because it allows to write text the “safe way”.</strong></p>
<p>Let's say we have an arbitrary string, for instance entered by a user, and want to show it.</p>
<ul>
<li>With <code>innerHTML</code> we'll have it inserted “as HTML”, with all HTML tags.</li>
<li>With <code>textContent</code> we'll have it inserted “as text”, all symbols are treated literally.</li>
</ul>
<p>Compare the two:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="elem1"&gt;&lt;/div&gt;
&lt;div id="elem2"&gt;&lt;/div&gt;

&lt;script&gt;
  let name = prompt("What's your name?", "&lt;b&gt;Winnie-the-pooh!&lt;/b&gt;");

  elem1.innerHTML = name;
  elem2.textContent = name;
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>The first <code>&lt;div&gt;</code> gets the name “as HTML”: all tags become tags, so we see the bold name.</li>
<li>The second <code>&lt;div&gt;</code> gets the name “as text”, so we literally see <code>&lt;b&gt;Winnie-the-pooh!&lt;/b&gt;</code>.</li>
</ol>
<p>In most cases, we expect the text from a user, and want to treat it as text. We don't want unexpected HTML in our site. An assignment to <code>textContent</code> does exactly that.</p>
<h2 id="chapter-612">
The “hidden” property</h2>
<p>The “hidden” attribute and the DOM property specifies whether the element is visible or not.</p>
<p>We can use it in HTML or assign using JavaScript, like this:</p>
<div data-trusted="1" class="code-example" data-demo-height="80">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div&gt;Both divs below are hidden&lt;/div&gt;

&lt;div hidden&gt;With the attribute "hidden"&lt;/div&gt;

&lt;div id="elem"&gt;JavaScript assigned the property "hidden"&lt;/div&gt;

&lt;script&gt;
  elem.hidden = true;
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Technically, <code>hidden</code> works the same as <code>style="display:none"</code>. But it's shorter to write.</p>
<p>Here's a blinking element:</p>
<div data-trusted="1" class="code-example" data-demo-height="50">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="elem"&gt;A blinking element&lt;/div&gt;

&lt;script&gt;
  setInterval(() =&gt; elem.hidden = !elem.hidden, 1000);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-613">
More properties</h2>
<p>DOM elements also have additional properties, many of them provided by the class:</p>
<ul>
<li><code>value</code> – the value for <code>&lt;input&gt;</code>, <code>&lt;select&gt;</code> and <code>&lt;textarea&gt;</code> (<code>HTMLInputElement</code>, <code>HTMLSelectElement</code>…).</li>
<li><code>href</code> – the “href” for <code>&lt;a href="..."&gt;</code> (<code>HTMLAnchorElement</code>).</li>
<li><code>id</code> – the value of “id” attribute, for all elements (<code>HTMLElement</code>).</li>
<li>…and much more…</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="80">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="text" id="elem" value="value"&gt;

&lt;script&gt;
  alert(elem.type); // "text"
  alert(elem.id); // "elem"
  alert(elem.value); // value
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Most standard HTML attributes have the corresponding DOM property, and we can access it like that.</p>
<p>If we want to know the full list of supported properties for a given class, we can find them in the specification. For instance, HTMLInputElement is documented at 
<a href="https://html.spec.whatwg.org/#htmlinputelement">https://html.spec.whatwg.org/#htmlinputelement</a>.</p>
<p>Or if we'd like to get them fast or interested in the concrete browser – we can always output the element using <code>console.dir(elem)</code> and read the properties. Or explore “DOM properties” in Elements tab of the browser developer tools.</p>
<h2 id="chapter-614">
Summary</h2>
<p>Each DOM node belongs to a certain class. The classes form a hierarchy. The full set of properties and methods comes as the result of inheritance.</p>
<p>Main DOM node properties are:</p>
<dl>
<dt><code>nodeType</code></dt>
<dd>Node type. We can get it from the DOM object class, but often we need just to see if it is a text or element node. The <code>nodeType</code> property is good for that. It has numeric values, most important are: <code>1</code> – for elements,<code>3</code> – for text nodes. Read-only.</dd>
<dt><code>nodeName/tagName</code></dt>
<dd>For elements, tag name (uppercased unless XML-mode). For non-element nodes <code>nodeName</code> describes what is it. Read-only.</dd>
<dt><code>innerHTML</code></dt>
<dd>The HTML content of the element. Can modify.</dd>
<dt><code>outerHTML</code></dt>
<dd>The full HTML of the element. A write operation into <code>elem.outerHTML</code> does not touch <code>elem</code> itself. Instead it gets replaced with the new HTML in the outer context.</dd>
<dt><code>nodeValue/data</code></dt>
<dd>The content of a non-element node (text, comment). These two are almost the same, usually we use <code>data</code>. Can modify.</dd>
<dt><code>textContent</code></dt>
<dd>The text inside the element, basically HTML minus all <code>&lt;tags&gt;</code>. Writing into it puts the text inside the element, with all special characters and tags treated exactly as text. Can safely insert user-generated text and protect from unwanted HTML insertions.</dd>
<dt><code>hidden</code></dt>
<dd>When set to <code>true</code>, does the same as CSS <code>display:none</code>.</dd>
</dl>
<p>DOM nodes also have other properties depending on their class. For instance, <code>&lt;input&gt;</code> elements (<code>HTMLInputElement</code>) support <code>value</code>, <code>type</code>, while <code>&lt;a&gt;</code> elements (<code>HTMLAnchorElement</code>) support <code>href</code> etc. Most standard HTML attributes have the corresponding DOM property.</p>
<p>But HTML attributes and DOM properties are not always the same, as we'll see in the next chapter.</p>
<div class="tasks"><h2 id="chapter-615" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-s-in-the-nodetype" name="what-s-in-the-nodetype" class="main__anchor">What's in the nodeType?</a></h3>
<a href="http://javascript.info/task/lastchild-nodetype-inline" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What the script shows?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;html&gt;

&lt;body&gt;
  &lt;script&gt;
    alert(document.body.lastChild.nodeType);
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>There's a catch here.</p>
<p>At the time of <code>&lt;script&gt;</code> execution the last DOM node is exactly <code>&lt;script&gt;</code>, because the browser did not process the rest of the page yet.</p>
<p>So the result is <code>1</code> (element node).</p>
<div data-trusted="1" class="code-example" data-demo-height="60">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;html&gt;

&lt;body&gt;
  &lt;script&gt;
    alert(document.body.lastChild.nodeType);
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#tag-in-comment" name="tag-in-comment" class="main__anchor">Tag in comment</a></h3>
<a href="http://javascript.info/task/tag-in-comment" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>What this code shows?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  let body = document.body;

  body.innerHTML = "&lt;!--" + body.tagName + "--&gt;";

  alert( body.firstChild.data ); // what's here?
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <strong><code>BODY</code></strong>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  let body = document.body;

  body.innerHTML = "&lt;!--" + body.tagName + "--&gt;";

  alert( body.firstChild.data ); // BODY
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>What's going on step by step:</p>
<ol>
<li>The content of <code>&lt;body&gt;</code> is replaced with the comment. The comment is <code>&lt;!–BODY–&gt;</code>, because <code>body.tagName == "BODY"</code>. As we remember, <code>tagName</code> is always uppercase in HTML.</li>
<li>The comment is now the only child node, so we get it in <code>body.firstChild</code>.</li>
<li>The <code>data</code> property of the comment is its contents (inside <code>&lt;!--...--&gt;</code>): <code>"BODY"</code>.</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#where-s-the-document-in-the-hierarchy" name="where-s-the-document-in-the-hierarchy" class="main__anchor">Where's the "document" in the hierarchy?</a></h3>
<a href="http://javascript.info/task/where-document-in-hierarchy" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Which class the <code>document</code> belongs to?</p>
<p>What's its place in the DOM hierarchy?</p>
<p>Does it inherit from <code>Node</code> or <code>Element</code>, or maybe <code>HTMLElement</code>?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We can see which class it belongs by outputting it, like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(document); // [object HTMLDocument]</code></pre>
        </div>
      </div>
      
      </div><p>Or:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(document.constructor.name); // HTMLDocument</code></pre>
        </div>
      </div>
      
      </div><p>So, <code>document</code> is an instance of <code>HTMLDocument</code> class.</p>
<p>What's its place in the hierarchy?</p>
<p>Yeah, we could browse the specification, but it would be faster to figure out manually.</p>
<p>Let's traverse the prototype chain via <code>__proto__</code>.</p>
<p>As we know, methods of a class are in the <code>prototype</code> of the constructor. For instance, <code>HTMLDocument.prototype</code> has methods for documents.</p>
<p>Also, there's a reference to the constructor function inside the <code>prototype</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(HTMLDocument.prototype.constructor === HTMLDocument); // true</code></pre>
        </div>
      </div>
      
      </div><p>For built-in classes in all prototypes there's a <code>constructor</code> reference, and we can get <code>constructor.name</code> to see the name of the class. Let's do it for all objects in the <code>document</code> prototype chain:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert(HTMLDocument.prototype.constructor.name); // HTMLDocument
alert(HTMLDocument.prototype.__proto__.constructor.name); // Document
alert(HTMLDocument.prototype.__proto__.__proto__.constructor.name); // Node</code></pre>
        </div>
      </div>
      
      </div><p>We also could examine the object using <code>console.dir(document)</code> and see these names by opening <code>__proto__</code>. The console takes them from <code>constructor</code> internally.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-616"></h6>
<h1 class="main__header-title" id="chapter-617">Attributes and properties</h1>
<p>When the browser loads the page, it “reads” (another word: “parses”) HTML text and generates DOM objects from it. For element nodes most standard HTML attributes automatically become properties of DOM objects.</p>
<p>For instance, if the tag is <code>&lt;body id="page"&gt;</code>, then the DOM object has <code>body.id="page"</code>.</p>
<p>But the attribute-property mapping is not one-to-one! In this chapter we'll pay attention to separate these two notions, to see how to work with them, when they are same, and when they are different.</p>


<h2 id="chapter-618">
DOM properties</h2>
<p>We've already seen built-in DOM properties. There's a lot. But technically no one limits us, and if it's not enough – we can add our own.</p>
<p>DOM nodes are regular JavaScript objects. We can alter them.</p>
<p>For instance, let's create a new property in <code>document.body</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.body.myData = {
  name: 'Caesar',
  title: 'Imperator'
};

alert(document.body.myData.title); // Imperator</code></pre>
        </div>
      </div>
      
      </div><p>We can add a method as well:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.body.sayHi = function() {
  alert(this.tagName);
};

document.body.sayHi(); // BODY (the value of "this" in the method is document.body)</code></pre>
        </div>
      </div>
      
      </div><p>We can also modify built-in prototypes like <code>Element.prototype</code> and add new methods to all elements:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Element.prototype.sayHi = function() {
  alert(`Hello, I'm ${this.tagName}`);
};

document.documentElement.sayHi(); // Hello, I'm HTML
document.body.sayHi(); // Hello, I'm BODY</code></pre>
        </div>
      </div>
      
      </div><p>So, DOM properties and methods behave just like those of regular JavaScript objects:</p>
<ul>
<li>They can have any value.</li>
<li>They are case-sensitive (write <code>elem.nodeType</code>, not <code>elem.NoDeTyPe</code>).</li>
</ul>
<h2 id="chapter-619">
HTML attributes</h2>
<p>In HTML language, tags may have attributes. When the browser reads HTML text and creates DOM objects for tags, it recognizes <em>standard</em> attributes and creates DOM properties from them.</p>
<p>So when an element has <code>id</code> or another <em>standard</em> attribute, the corresponding property gets created. But that doesn't happen if the attribute is non-standard.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body id="test" something="non-standard"&gt;
  &lt;script&gt;
    alert(document.body.id); // test
    // non-standard attribute does not yield a property
    alert(document.body.something); // undefined
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Please note that a standard attribute for one element can be unknown for another one. For instance, <code>"type"</code> is standard for <code>&lt;input&gt;</code> (
<a href="https://html.spec.whatwg.org/#htmlinputelement">HTMLInputElement</a>), but not for <code>&lt;body&gt;</code> (
<a href="https://html.spec.whatwg.org/#htmlbodyelement">HTMLBodyElement</a>). Standard attributes are described in the specification for the corresponding element class.</p>
<p>Here we can see it:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body id="body" type="..."&gt;
  &lt;input id="input" type="text"&gt;
  &lt;script&gt;
    alert(input.type); // text
    alert(body.type); // undefined: DOM property not created, because it's non-standard
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>So, if an attribute is non-standard, there won't be DOM-property for it. Is there a way to access such attributes?</p>
<p>Sure. All attributes are accessible using following methods:</p>
<ul>
<li><code>elem.hasAttribute(name)</code> – checks for existence.</li>
<li><code>elem.getAttribute(name)</code> – gets the value.</li>
<li><code>elem.setAttribute(name, value)</code> – sets the value.</li>
<li><code>elem.removeAttribute(name)</code> – removes the attribute.</li>
</ul>
<p>These methods operate exactly with what's written in HTML.</p>
<p>Also one can read all attributes using <code>elem.attributes</code>: a collection of objects that belong to a built-in 
<a href="https://dom.spec.whatwg.org/#attr">Attr</a> class, with <code>name</code> and <code>value</code> properties.</p>
<p>Here's a demo of reading a non-standard property:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body something="non-standard"&gt;
  &lt;script&gt;
    alert(document.body.getAttribute('something')); // non-standard
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>HTML attributes have following features:</p>
<ul>
<li>Their name is case-insensitive (that's HTML: <code>id</code> is same as <code>ID</code>).</li>
<li>They are always strings.</li>
</ul>
<p>Here's an extended demo of working with attributes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;
  &lt;div id="elem" about="Elephant"&gt;&lt;/div&gt;

  &lt;script&gt;
    alert( elem.getAttribute('About') ); // (1) 'Elephant', reading

    elem.setAttribute('Test', 123); // (2), writing

    alert( elem.outerHTML ); // (3), see it's there

    for (let attr of elem.attributes) { // (4) list all
      alert( attr.name + " = " + attr.value );
    }
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Please note:</p>
<ol>
<li><code>getAttribute('About')</code> – the first letter is uppercase here, and in HTML it's all lowercase. But that doesn't matter: attribute names are case-insensitive.</li>
<li>We can assign anything to an attribute, but that becomes a string. So here we have <code>"123"</code> as the value.</li>
<li>All attributes including ones that we set are visible in <code>outerHTML</code>.</li>
<li>The <code>attributes</code> collection is iterable and has all attributes with <code>name</code> and <code>value</code>.</li>
</ol>
<h2 id="chapter-620">
Property-attribute synchronization</h2>
<p>When a standard attribute changes, the corresponding property is auto-updated, and (with some exceptions) vise-versa.</p>
<p>In the example below <code>id</code> is modified as an attribute, and we can see the property change too. And then the same backwards:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input&gt;

&lt;script&gt;
  let input = document.querySelector('input');

  // attribute =&gt; property
  input.setAttribute('id', 'id');
  alert(input.id); // id (updated)

  // property =&gt; attribute
  input.id = 'newId';
  alert(input.getAttribute('id')); // newId (updated)
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>But there are exclusions, for instance <code>input.value</code> synchronizes only from attribute → to property, but not back:</p>
<div data-trusted="1" class="code-example" data-highlight-block="9-11">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input&gt;

&lt;script&gt;
  let input = document.querySelector('input');

  // attribute =&gt; property
  input.setAttribute('value', 'text');
  alert(input.value); // text

  // NOT property =&gt; attribute
  input.value = 'newValue';
  alert(input.getAttribute('value')); // text (not updated!)
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>In the example above:</p>
<ul>
<li>Changing the attribute <code>value</code> updates the property.</li>
<li>But the property change does not affect the attribute.</li>
</ul>
<p>That “feature” may actually can come in handy, because the user may modify <code>value</code>, and then after it, if we want to recover the “original” value from HTML, it's in the attribute.</p>
<h2 id="chapter-621">
DOM properties are typed</h2>
<p>DOM properties are not always strings. For instance, <code>input.checked</code> property (for checkboxes) is boolean:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input id="input" type="checkbox" checked&gt; checkbox

&lt;script&gt;
  alert(input.getAttribute('checked')); // the attribute value is: empty string
  alert(input.checked); // the property value is: true
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>There are other examples. The <code>style</code> attribute is a string, but <code>style</code> property is an object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="div" style="color:red;font-size:120%"&gt;Hello&lt;/div&gt;

&lt;script&gt;
  // string
  alert(div.getAttribute('style')); // color:red;font-size:120%

  // object
  alert(div.style); // [object CSSStyleDeclaration]
  alert(div.style.color); // red
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>That's an important difference. But even if a DOM property type is a string, it may differ from the attribute!</p>
<p>For instance, the <code>href</code> DOM property is always a <em>full</em> URL, even if the attribute contains a relative URL or just a <code>#hash</code>.</p>
<p>Here's an example:</p>
<div data-trusted="1" class="code-example" data-demo-height="30">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;a id="a" href="#hello"&gt;link&lt;/a&gt;
&lt;script&gt;
  // attribute
  alert(a.getAttribute('href')); // #hello

  // property
  alert(a.href ); // full URL in the form http://site.com/page#hello
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>If we need the value of <code>href</code> or any other attribute exactly as written in the HTML, we can use <code>getAttribute</code>.</p>
<h2 id="chapter-622">
Non-standard attributes, dataset</h2>
<p>When writing HTML, we use a lot of standard attributes. But what about non-standard, custom ones? First, let's see whether they are useful or not? What for?</p>
<p>Sometimes non-standard attributes are used to pass custom data from HTML to JavaScript, or to “mark” HTML-elements for JavaScript.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:5-21,3:5-20">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!-- mark the div to show "name" here --&gt;
&lt;div show-info="name"&gt;&lt;/div&gt;
&lt;!-- and age here --&gt;
&lt;div show-info="age"&gt;&lt;/div&gt;

&lt;script&gt;
  // the code finds an element with the mark and shows what's requested
  let user = {
    name: "Pete",
    age: 25
  };

  for(let div of document.querySelectorAll('[show-info]')) {
    // insert the corresponding info into the field
    let field = div.getAttribute('show-info');
    div.innerHTML = user[field]; // Pete, then age
  }
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Also they can be used to style an element.</p>
<p>For instance, here for the order state the attribute <code>order-state</code> is used:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  /* styles rely on the custom attribute "order-state" */
  .order[order-state="new"] {
    color: green;
  }

  .order[order-state="pending"] {
    color: blue;
  }

  .order[order-state="canceled"] {
    color: red;
  }
&lt;/style&gt;

&lt;div class="order" order-state="new"&gt;
  A new order.
&lt;/div&gt;

&lt;div class="order" order-state="pending"&gt;
  A pending order.
&lt;/div&gt;

&lt;div class="order" order-state="canceled"&gt;
  A canceled order.
&lt;/div&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Why the attribute may be preferable to classes like <code>.order-state-new</code>, <code>.order-state-pending</code>, <code>order-state-canceled</code>?</p>
<p>That's because an attribute is more convenient to manage. The state can be changed as easy as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// a bit simpler than removing old/adding a new class
div.setAttribute('order-state', 'canceled');</code></pre>
        </div>
      </div>
      
      </div><p>But there may be a possible problem with custom attributes. What if we use a non-standard attribute for our purposes and later the standard introduces it and makes it do something? The HTML language is alive, it grows, more attributes appear to suit the needs of developers. There may be unexpected effects in such case.</p>
<p>To evade conflicts, there exist 
<a href="https://html.spec.whatwg.org/#embedding-custom-non-visible-data-with-the-data-*-attributes">data-*</a> attributes.</p>
<p><strong>All attributes starting with “data-” are reserved for programmers' use. They are available in <code>dataset</code> property.</strong></p>
<p>For instance, if an <code>elem</code> has an attribute named <code>"data-about"</code>, it's available as <code>elem.dataset.about</code>.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body data-about="Elephants"&gt;
&lt;script&gt;
  alert(document.body.dataset.about); // Elephants
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Multiword attributes like <code>data-order-state</code> become camel-cased: <code>dataset.orderState</code>.</p>
<p>Here's a rewritten “order state” example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  .order[data-order-state="new"] {
    color: green;
  }

  .order[data-order-state="pending"] {
    color: blue;
  }

  .order[data-order-state="canceled"] {
    color: red;
  }
&lt;/style&gt;

&lt;div id="order" class="order" data-order-state="new"&gt;
  A new order.
&lt;/div&gt;

&lt;script&gt;
  // read
  alert(order.dataset.orderState); // new

  // modify
  order.dataset.orderState = "pending"; // (*)
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Using <code>data-*</code> attributes is a valid, safe way to pass custom data.</p>
<p>Please note that we can not only read, but also modify data-attributes. Then CSS updates the view accordingly: in the example above the last line <code>(*)</code> changes the color to blue.</p>
<h2 id="chapter-623">
Summary</h2>
<ul>
<li>Attributes – is what's written in HTML.</li>
<li>Properties – is what's in DOM objects.</li>
</ul>
<p>A small comparison:</p>
<table>
<thead>
<tr>
<th></th>
<th>Properties</th>
<th>Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td>Any value, standard properties have types described in the spec</td>
<td>A string</td>
</tr>
<tr>
<td>Name</td>
<td>Name is case-sensitive</td>
<td>Name is not case-sensitive</td>
</tr>
</tbody>
</table>
<p>Methods to work with attributes are:</p>
<ul>
<li><code>elem.hasAttribute(name)</code> – to check for existence.</li>
<li><code>elem.getAttribute(name)</code> – to get the value.</li>
<li><code>elem.setAttribute(name, value)</code> – to set the value.</li>
<li><code>elem.removeAttribute(name)</code> – to remove the attribute.</li>
<li><code>elem.attributes</code> is a collection of all attributes.</li>
</ul>
<p>For most needs DOM properties can serve us well. We should refer to attributes only when DOM properties do not suit us, when we need exactly attributes, for instance:</p>
<ul>
<li>We need a non-standard attribute. But if it starts with <code>data-</code>, then we should use <code>dataset</code>.</li>
<li>We want to read the value “as written” in HTML. The value of the DOM property may be different, for instance <code>href</code> property is always a full URL, and we may want to get the “original” value.</li>
</ul>
<div class="tasks"><h2 id="chapter-624" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#get-the-attribute" name="get-the-attribute" class="main__anchor">Get the attribute</a></h3>
<a href="http://javascript.info/task/get-user-attribute" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write the code to select the element with <code>data-widget-name</code> attribute from the document and to read its value.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYLE HTML&gt;
&lt;html&gt;
&lt;body&gt;

  &lt;div data-widget-name="menu"&gt;Choose the genre&lt;/div&gt;

  &lt;script&gt;
    /* your code */
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example" data-demo-height="100">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYLE HTML&gt;
&lt;html&gt;
&lt;body&gt;

  &lt;div data-widget-name="menu"&gt;Choose the genre&lt;/div&gt;

  &lt;script&gt;
    // getting it
    let elem = document.querySelector('[data-widget-name]');

    // reading the value
    alert(elem.dataset.widgetName);
    // or
    alert(elem.getAttribute('data-widget-name'));
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/oYYilotCCGALUBAzOopU?p=preview" target="_blank" data-plunk-id="oYYilotCCGALUBAzOopU">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#make-external-links-orange" name="make-external-links-orange" class="main__anchor">Make external links orange</a></h3>
<a href="http://javascript.info/task/yellow-links" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>Make all external links orange by altering their <code>style</code> property.</p>
<p>A link is external if:</p>
<ul>
<li>It's <code>href</code> has <code>://</code> in it</li>
<li>But doesn't start with <code>http://internal.com</code>.</li>
</ul>
<p>Example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;a name="list"&gt;the list&lt;/a&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="http://google.com"&gt;http://google.com&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/tutorial"&gt;/tutorial.html&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="local/path"&gt;local/path&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="ftp://ftp.com/my.zip"&gt;ftp://ftp.com/my.zip&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="http://nodejs.org"&gt;http://nodejs.org&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="http://internal.com/test"&gt;http://internal.com/test&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;script&gt;
  // setting style for a single link
  let link = document.querySelector('a');
  link.style.color = 'orange';
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The result should be:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:180px" src="https://en.js.cx/task/yellow-links/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/ftPfZPJBKBIyjvaK1CMN?p=preview" target="_blank" data-plunk-id="ftPfZPJBKBIyjvaK1CMN">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>First, we need to find all external references.</p>
<p>There are two ways.</p>
<p>The first is to find all links using <code>document.querySelectorAll('a')</code> and then filter out what we need:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let links = document.querySelectorAll('a');

for (let link of links) {
  let href = link.getAttribute('href');
  if (!href) continue; // no attribute

  if (!href.includes('://')) continue; // no protocol

  if (href.startsWith('http://internal.com')) continue; // internal

  link.style.color = 'orange';
}</code></pre>
        </div>
      </div>
      
      </div><p>Please note: we use <code>link.getAttribute('href')</code>. Not <code>link.href</code>, because we need the value from HTML.</p>
<p>…Another, simpler way would be to add the checks to CSS selector:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// look for all links that have :// in href
// but href doesn't start with http://internal.com
let selector = 'a[href*="://"]:not([href^="http://internal.com"])';
let links = document.querySelectorAll(selector);

links.forEach(link =&gt; link.style.color = 'orange');</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/pg6lsJnJEQ4TKbpg4gx8?p=preview" target="_blank" data-plunk-id="pg6lsJnJEQ4TKbpg4gx8">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-625"></h6>
<h1 class="main__header-title" id="chapter-626">Modifying the document</h1>
<p>DOM modifications is the key to create “live” pages.</p>
<p>Here we'll see how to create new elements “on the fly” and modify the existing page content.</p>
<p>First we'll see a simple example and then explain the methods.</p>


<h2 id="chapter-627">
Example: show a message</h2>
<p>For the start, let's see how to add a message on the page that looks nicer than <code>alert</code>.</p>
<p>Here's how it will look:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-block="10-12">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
.alert {
  padding: 15px;
  border: 1px solid #d6e9c6;
  border-radius: 4px;
  color: #3c763d;
  background-color: #dff0d8;
}
&lt;/style&gt;

&lt;div class="alert"&gt;
  &lt;strong&gt;Hi there!&lt;/strong&gt; You've read an important message.
&lt;/div&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-5uk9yl" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>That was an HTML example. Now let's create the same <code>div</code> with JavaScript (assuming that the styles are still in the HTML or an external CSS).</p>
<h2 id="chapter-628">
Creating an element</h2>
<p>To create DOM nodes, there are two methods:</p>
<dl>
<dt><code>document.createElement(tag)</code></dt>
<dd>
<p>Creates a new element with the given tag:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let div = document.createElement('div');</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>document.createTextNode(text)</code></dt>
<dd>
<p>Creates a new <em>text node</em> with the given text:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let textNode = document.createTextNode('Here I am');</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<h3>
Creating the message</a></h3><p>In our case we want to make a <code>div</code> with given classes and the message in it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let div = document.createElement('div');
div.className = "alert alert-success";
div.innerHTML = "&lt;strong&gt;Hi there!&lt;/strong&gt; You've read an important message.";</code></pre>
        </div>
      </div>
      
      </div><p>After that, we have a ready DOM element. Right now it's in the variable, but can not be seen, because not inserted into the page yet.</p>
<h2 id="chapter-629">
Insertion methods</h2>
<p>To make the <code>div</code> show up, we need to insert it somewhere into <code>document</code>. For instance, in <code>document.body</code>.</p>
<p>There's a special method for that: <code>document.body.appendChild(div)</code>.</p>
<p>Here's the full code:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-highlight-block="15-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
.alert {
  padding: 15px;
  border: 1px solid #d6e9c6;
  border-radius: 4px;
  color: #3c763d;
  background-color: #dff0d8;
}
&lt;/style&gt;

&lt;script&gt;
  let div = document.createElement('div');
  div.className = "alert alert-success";
  div.innerHTML = "&lt;strong&gt;Hi there!&lt;/strong&gt; You've read an important message.";

  document.body.appendChild(div);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Here's a brief list of methods to insert a node into a parent element (<code>parentElem</code> for short):</p>
<dl>
<dt><code>parentElem.appendChild(node)</code></dt>
<dd>
<p>Appends <code>node</code> as the last child of <code>parentElem</code>.</p>
<p>The following example adds a new <code>&lt;li&gt;</code> to the end of <code>&lt;ol&gt;</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="100">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;ol id="list"&gt;
  &lt;li&gt;0&lt;/li&gt;
  &lt;li&gt;1&lt;/li&gt;
  &lt;li&gt;2&lt;/li&gt;
&lt;/ol&gt;

&lt;script&gt;
  let newLi = document.createElement('li');
  newLi.innerHTML = 'Hello, world!';

  list.appendChild(newLi);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>parentElem.insertBefore(node, nextSibling)</code></dt>
<dd>
<p>Inserts <code>node</code> before <code>nextSibling</code> into <code>parentElem</code>.</p>
<p>The following code inserts a new list item before the second <code>&lt;li&gt;</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="100" data-highlight-block="9-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;ol id="list"&gt;
  &lt;li&gt;0&lt;/li&gt;
  &lt;li&gt;1&lt;/li&gt;
  &lt;li&gt;2&lt;/li&gt;
&lt;/ol&gt;
&lt;script&gt;
  let newLi = document.createElement('li');
  newLi.innerHTML = 'Hello, world!';

  list.insertBefore(newLi, list.children[1]);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>To insert as the first element, we can do like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">list.insertBefore(newLi, list.firstChild);</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>parentElem.replaceChild(node, oldChild)</code></dt>
<dd>
<p>Replaces <code>oldChild</code> with <code>node</code> among children of <code>parentElem</code>.</p>
</dd>
</dl>
<p>All these methods return the inserted node. In other words, <code>parentElem.appendChild(node)</code> returns <code>node</code>. But usually the returned value is not used, we just run the method.</p>
<p>These methods are “old school”: they exist from the ancient times and we can meet them in many old scripts. Unfortunately, there are some tasks that are hard to solve with them.</p>
<p>For instance, how to insert <em>html</em> if we have it as a string? Or, given a node, how to insert another node <em>before</em> it? Of course, all that is doable, but not in an elegant way.</p>
<p>So there exists two other sets of insertion methods to handle all cases easily.</p>
<h3>
prepend/append/before/after</a></h3><p>This set of methods provides more flexible insertions:</p>
<ul>
<li><code>node.append(...nodes or strings)</code> – append nodes or strings at the end of <code>node</code>,</li>
<li><code>node.prepend(...nodes or strings)</code> – insert nodes or strings into the beginning of <code>node</code>,</li>
<li><code>node.before(...nodes or strings)</code> –- insert nodes or strings before the <code>node</code>,</li>
<li><code>node.after(...nodes or strings)</code> –- insert nodes or strings after the <code>node</code>,</li>
<li><code>node.replaceWith(...nodes or strings)</code> –- replaces <code>node</code> with the given nodes or strings.</li>
</ul>
<p>Here's an example of using these methods to add more items to a list and the text before/after it:</p>
<div data-trusted="1" class="code-example" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;ol id="ol"&gt;
  &lt;li&gt;0&lt;/li&gt;
  &lt;li&gt;1&lt;/li&gt;
  &lt;li&gt;2&lt;/li&gt;
&lt;/ol&gt;

&lt;script&gt;
  ol.before('before');
  ol.after('after');

  let prepend = document.createElement('li');
  prepend.innerHTML = 'prepend';
  ol.prepend(prepend);

  let append = document.createElement('li');
  append.innerHTML = 'append';
  ol.append(append);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-bj93c5" style="height:200px" src="about:blank"></iframe>
      </div>
      </div><p>Here's a small picture what methods do:</p>
      <img src="http://javascript.info/article/modifying-document/before-prepend-append-after.png">
<p>So the final list will be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">before
&lt;ol id="ol"&gt;
  &lt;li&gt;prepend&lt;/li&gt;
  &lt;li&gt;0&lt;/li&gt;
  &lt;li&gt;1&lt;/li&gt;
  &lt;li&gt;2&lt;/li&gt;
  &lt;li&gt;append&lt;/li&gt;
&lt;/ol&gt;
after</code></pre>
        </div>
      </div>
      
      </div><p>These methods can insert multiple list of nodes and text pieces in a single call.</p>
<p>For instance, here a string and an element are inserted:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="div"&gt;&lt;/div&gt;
&lt;script&gt;
  div.before('&lt;p&gt;Hello&lt;/p&gt;', document.createElement('hr'));
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>All text is inserted <em>as text</em>.</p>
<p>So the final HTML is:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&amp;lt;p&amp;gt;Hello&amp;lt;/p&amp;gt;
&lt;hr&gt;
&lt;div id="div"&gt;&lt;/div&gt;</code></pre>
        </div>
      </div>
      
      </div><p>In other words, strings are inserted in a safe way, like <code>elem.textContent</code> does it.</p>
<p>So, these methods can only be used to insert DOM nodes or text pieces.</p>
<p>But what if we want to insert HTML “as html”, with all tags and stuff working, like <code>elem.innerHTML</code>?</p>
<h3>
insertAdjacentHTML/Text/Element</a></h3><p>There's another, pretty versatile method: <code>elem.insertAdjacentHTML(where, html)</code>.</p>
<p>The first parameter is a string, specifying where to insert, must be one of the following:</p>
<ul>
<li><code>"beforebegin"</code> – insert <code>html</code> before <code>elem</code>,</li>
<li><code>"afterbegin"</code> – insert <code>html</code> into <code>elem</code>, at the beginning,</li>
<li><code>"beforeend"</code> – insert <code>html</code> into <code>elem</code>, at the end,</li>
<li><code>"afterend"</code> – insert <code>html</code> after <code>elem</code>.</li>
</ul>
<p>The second parameter is an HTML string, inserted “as is”.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="div"&gt;&lt;/div&gt;
&lt;script&gt;
  div.insertAdjacentHTML('beforebegin', '&lt;p&gt;Hello&lt;/p&gt;');
  div.insertAdjacentHTML('afterend', '&lt;p&gt;Bye&lt;/p&gt;');
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>…Would lead to:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;p&gt;Hello&lt;/p&gt;
&lt;div id="div"&gt;&lt;/div&gt;
&lt;p&gt;Bye&lt;/p&gt;</code></pre>
        </div>
      </div>
      
      </div><p>That's how we can append an arbitrary HTML to our page.</p>
<p>Here's the picture of insertion variants:</p>
      <img src="http://javascript.info/article/modifying-document/insert-adjacent.png">
<p>We can easily notice similarities between this and the previous picture. The insertion points are actually the same, but this method inserts HTML.</p>
<p>The method has two brothers:</p>
<ul>
<li><code>elem.insertAdjacentText(where, text)</code> – the same syntax, but a string of <code>text</code> in inserted “as text” instead of HTML,</li>
<li><code>elem.insertAdjacentElement(where, elem)</code> – the same syntax, but inserts an element.</li>
</ul>
<p>They exist mainly to make the syntax “uniform”. In practice, most of time only <code>insertAdjacentHTML</code> is used, because for elements and text we have methods <code>append/prepend/before/after</code> – they are shorter to write and can insert nodes/text pieces.</p>
<p>So here's an alternative variant of showing a message:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
.alert {
  padding: 15px;
  border: 1px solid #d6e9c6;
  border-radius: 4px;
  color: #3c763d;
  background-color: #dff0d8;
}
&lt;/style&gt;

&lt;script&gt;
  document.body.insertAdjacentHTML("afterbegin", `&lt;div class="alert alert-success"&gt;
    &lt;strong&gt;Hi there!&lt;/strong&gt; You've read an important message.
  &lt;/div&gt;`);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-630">
Cloning nodes: cloneNode</h2>
<p>How to insert one more similar message?</p>
<p>We could do a function and put the code there. But the alternative way would be to <em>clone</em> the existing <code>div</code> and modify the text inside it (if needed).</p>
<p>Sometimes when we have a big element, that may be faster and simpler.</p>
<ul>
<li>The call <code>elem.cloneNode(true)</code> creates a “deep” clone of the element – with all attributes and subelements. If we call <code>elem.cloneNode(false)</code>, then the clone is made without child elements.</li>
</ul>
<p>An example of copying the message:</p>
<div data-trusted="1" class="code-example" data-demo-height="120" data-highlight-block="15-18">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
.alert {
  padding: 15px;
  border: 1px solid #d6e9c6;
  border-radius: 4px;
  color: #3c763d;
  background-color: #dff0d8;
}
&lt;/style&gt;

&lt;div class="alert" id="div"&gt;
  &lt;strong&gt;Hi there!&lt;/strong&gt; You've read an important message.
&lt;/div&gt;

&lt;script&gt;
  let div2 = div.cloneNode(true); // clone the message
  div2.querySelector('strong').innerHTML = 'Bye there!'; // change the clone

  div.after(div2); // show the clone after the existing div
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-631">
Removal methods</h2>
<p>To remove nodes, there are following methods:</p>
<dl>
<dt><code>parentElem.removeChild(node)</code></dt>
<dd>Removes <code>elem</code> from  <code>parentElem</code> (assuming it's a child).</dd>
<dt><code>node.remove()</code></dt>
<dd>Removes the <code>node</code> from its place.</dd>
</dl>
<p>We can easily see that the second method is much shorter. The first one exists for historical reasons.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Please note:</span></div>
            <div class="important__content"><p>If we want to <em>move</em> an element to another place – there's no need to remove it from the old one.</p>
<p><strong>All insertion methods automatically remove the node from the old place.</strong></p>
<p>For instance, let's swap elements:</p>
<div data-trusted="1" class="code-example" data-demo-height="50">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="first"&gt;First&lt;/div&gt;
&lt;div id="second"&gt;Second&lt;/div&gt;
&lt;script&gt;
  // no need to call remove
  second.after(first); // take #second and after it - insert #first
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<p>Let's make our message disappear after a second:</p>
<div data-trusted="0" class="code-example" data-highlight-block="16-17">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
.alert {
  padding: 15px;
  border: 1px solid #d6e9c6;
  border-radius: 4px;
  color: #3c763d;
  background-color: #dff0d8;
}
&lt;/style&gt;

&lt;script&gt;
  let div = document.createElement('div');
  div.className = "alert alert-success";
  div.innerHTML = "&lt;strong&gt;Hi there!&lt;/strong&gt; You've read an important message.";

  document.body.append(div);
  setTimeout(() =&gt; div.remove(), 1000);
  // or setTimeout(() =&gt; document.body.removeChild(div), 1000);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-632">
A word about “document.write”</h2>
<p>There's one more, very ancient method of adding something to a web-page: <code>document.write</code>.</p>
<p>The syntax:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;p&gt;Somewhere in the page...&lt;/p&gt;
&lt;script&gt;
  document.write('&lt;b&gt;Hello from JS&lt;/b&gt;');
&lt;/script&gt;
&lt;p&gt;The end&lt;/p&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The call to <code>document.write(html)</code> writes the <code>html</code> into page “right here and now”. The <code>html</code> string can be dynamically generated, so it's kind of flexible. We can use JavaScript to create a full-fledged webpage and write it.</p>
<p>The method comes from times when there were no DOM, no standards… Really old times. It still lives, because there are scripts using it.</p>
<p>In modern scripts we can rarely see it, because of the important limitation.</p>
<p><strong>The call to <code>document.write</code> only works while the page is loading.</strong></p>
<p>If we call it afterwards, the existing document content is erased.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;p&gt;After one second the contents of this page will be replaced...&lt;/p&gt;
&lt;script&gt;
  // document.write after 1 second
  // that's after the page loaded, so it erases the existing content
  setTimeout(() =&gt; document.write('&lt;b&gt;...By this.&lt;/b&gt;'), 1000);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>So it's kind of unusable at “after loaded” stage, unlike other DOM methods we covered above.</p>
<p>That was the downside.</p>
<p>Technically, when <code>document.write</code> is called while the browser is still reading HTML, it appends something to it, and the browser consumes it just as it were initially there.</p>
<p>That gives us the upside – it works blazingly fast, because there's <em>no DOM modification</em>. It writes directly into the page text, while the DOM is not yet built, and the browser puts it into DOM at generation-time.</p>
<p>So if we need to add a lot of text into HTML dynamically, and we're at page loading phase, and the speed matters, it may help. But in practice these requirements rarely come together. And usually we can see this method in scripts just because they are old.</p>
<h2 id="chapter-633">
Summary</h2>
<p>Methods to create new nodes:</p>
<ul>
<li><code>document.createElement(tag)</code> – creates an element with the given tag,</li>
<li><code>document.createTextNode(value)</code> – creates a text node (rarely used),</li>
<li><code>elem.cloneNode(deep)</code> – clones the element, if <code>deep==true</code> then with all descendants.</li>
</ul>
<p>Insertion and removal of nodes:</p>
<ul>
<li>
<p>From the parent:</p>
<ul>
<li><code>parent.appendChild(node)</code></li>
<li><code>parent.insertBefore(node, nextSibling)</code></li>
<li><code>parent.removeChild(node)</code></li>
<li><code>parent.replaceChild(newElem, node)</code></li>
</ul>
<p>All these methods return <code>node</code>.</p>
</li>
<li>
<p>Given a list of nodes and strings:</p>
<ul>
<li><code>node.append(...nodes or strings)</code> – insert into <code>node</code>, at the end,</li>
<li><code>node.prepend(...nodes or strings)</code> – insert into <code>node</code>, at the beginning,</li>
<li><code>node.before(...nodes or strings)</code> –- insert right before <code>node</code>,</li>
<li><code>node.after(...nodes or strings)</code> –- insert right after <code>node</code>,</li>
<li><code>node.replaceWith(...nodes or strings)</code> –- replace <code>node</code>.</li>
<li><code>node.remove()</code> –- remove the <code>node</code>.</li>
</ul>
<p>Text strings are inserted “as text”.</p>
</li>
<li>
<p>Given a piece of HTML: <code>elem.insertAdjacentHTML(where, html)</code>, inserts depending on where:</p>
<ul>
<li><code>"beforebegin"</code> – insert <code>html</code> right before <code>elem</code>,</li>
<li><code>"afterbegin"</code> – insert <code>html</code> into <code>elem</code>, at the beginning,</li>
<li><code>"beforeend"</code> – insert <code>html</code> into <code>elem</code>, at the end,</li>
<li><code>"afterend"</code> – insert <code>html</code> right after <code>elem</code>.</li>
</ul>
<p>Also there are similar methods <code>elem.insertAdjacentText</code> and <code>elem.insertAdjacentElement</code>, they  insert text strings and elements, but they are rarely used.</p>
</li>
<li>
<p>To append HTML to the page before it has finished loading:</p>
<ul>
<li><code>document.write(html)</code></li>
</ul>
<p>After the page is loaded such call erases the document. Mostly seen in old scripts.</p>
</li>
</ul>
<div class="tasks"><h2 id="chapter-634" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#createtextnode-vs-innerhtml-vs-textcontent" name="createtextnode-vs-innerhtml-vs-textcontent" class="main__anchor">createTextNode vs innerHTML vs textContent</a></h3>
<a href="http://javascript.info/task/createtextnode-vs-innerhtml" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>We have an empty DOM element <code>elem</code> and a string <code>text</code>.</p>
<p>Which of these 3 commands do exactly the same?</p>
<ol>
<li><code>elem.append(document.createTextNode(text))</code></li>
<li><code>elem.innerHTML = text</code></li>
<li><code>elem.textContent = text</code></li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Answer: <strong>1 and 3</strong>.</p>
<p>Both commands result in adding the <code>text</code> “as text” into the <code>elem</code>.</p>
<p>Here's an example:</p>
<div data-trusted="1" class="code-example" data-demo-height="80">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="elem1"&gt;&lt;/div&gt;
&lt;div id="elem2"&gt;&lt;/div&gt;
&lt;div id="elem3"&gt;&lt;/div&gt;
&lt;script&gt;
  let text = '&lt;b&gt;text&lt;/b&gt;';

  elem1.append(document.createTextNode(text));
  elem2.textContent = text;
  elem3.innerHTML = text;
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#clear-the-element" name="clear-the-element" class="main__anchor">Clear the element</a></h3>
<a href="http://javascript.info/task/clear-elem" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a function <code>clear(elem)</code> that removes everything from the element.</p>
<div data-trusted="1" class="code-example" data-demo-height="60">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;ol id="elem"&gt;
  &lt;li&gt;Hello&lt;/li&gt;
  &lt;li&gt;World&lt;/li&gt;
&lt;/ol&gt;

&lt;script&gt;
  function clear(elem) { /* your code */ }

  clear(elem); // clears the list
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>First, let's see how <em>not</em> to do it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function clear(elem) {
  for (let i=0; i &lt; elem.childNodes.length; i++) {
      elem.childNodes[i].remove();
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>That won't work, because the call to <code>remove()</code> shifts the collection <code>elem.childNodes</code>, so elements start from the index <code>0</code> every time. But <code>i</code> increases, and some elements will be skipped.</p>
<p>The <code>for..of</code> loop also does the same.</p>
<p>The right variant could be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function clear(elem) {
  while (elem.firstChild) {
    elem.firstChild.remove();
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>And also there's a simpler way to do the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function clear(elem) {
  elem.innerHTML = '';
}</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#why-aaa-remains" name="why-aaa-remains" class="main__anchor">Why "aaa" remains?</a></h3>
<a href="http://javascript.info/task/why-aaa" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 1</span></div><div class="task__content"><p>Run the example. Why <code>table.remove()</code> does not delete the text <code>"aaa"</code>?</p>
<div data-trusted="1" class="code-example" data-demo-height="100">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;table id="table"&gt;
  aaa
  &lt;tr&gt;
    &lt;td&gt;Test&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

&lt;script&gt;
  alert(table); // the table, as it should be

  table.remove();
  // why there's still aaa in the document?
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The HTML in the task is incorrect. That's the reason of the odd thing.</p>
<p>The browser has to fix it automatically. But there may be no text inside the <code>&lt;table&gt;</code>: according to the spec only table-specific tags are allowed. So the browser adds <code>"aaa"</code> <em>before</em> the <code>&lt;table&gt;</code>.</p>
<p>Now it's obvious that when we remove the table, it remains.</p>
<p>The question can be easily answered by exploring DOM using the browser tools. They show <code>"aaa"</code> before the <code>&lt;table&gt;</code>.</p>
<p>The HTML standard specifies in detail how to process bad HTML, and such behavior of the browser is correct.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-a-list" name="create-a-list" class="main__anchor">Create a list</a></h3>
<a href="http://javascript.info/task/create-list" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write an interface to create a list from user input.</p>
<p>For every list item:</p>
<ol>
<li>Ask a user about its content using <code>prompt</code>.</li>
<li>Create the <code>&lt;li&gt;</code> with it and add it to <code>&lt;ul&gt;</code>.</li>
<li>Continue until the user cancels the input (by pressing <kbd class="shortcut">Esc</kbd> or CANCEL in prompt).</li>
</ol>
<p>All elements should be created dynamically.</p>
<p>If a user types HTML-tags, they should be treated like a text.</p>
<p>
<a href="https://en.js.cx/task/create-list/solution/" target="blank">Demo in new window</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Please note the usage of <code>textContent</code> to assign the <code>&lt;li&gt;</code> content.</p>
<p>
<a href="http://plnkr.co/edit/ejmFwM8XdHSDPvSOct6R?p=preview" target="_blank" data-plunk-id="ejmFwM8XdHSDPvSOct6R">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-a-tree-from-the-object" name="create-a-tree-from-the-object" class="main__anchor">Create a tree from the object</a></h3>
<a href="http://javascript.info/task/create-object-tree" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>createTree</code> that creates a nested <code>ul/li</code> list from the nested object.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let data = {
  "Fish": {
    "trout": {},
    "salmon": {}
  },

  "Tree": {
    "Huge": {
      "sequoia": {},
      "oak": {}
    },
    "Flowering": {
      "redbud": {},
      "magnolia": {}
    }
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>The syntax:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let container = document.getElementById('container');
createTree(container, data); // creates the tree in the container</code></pre>
        </div>
      </div>
      
      </div><p>The result (tree) should look like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/task/create-object-tree/build-tree-dom/"></iframe>
  </div><p>Choose one of two ways of solving this task:</p>
<ol>
<li>Create the HTML for the tree and then assign to <code>container.innerHTML</code>.</li>
<li>Create tree nodes and append with DOM methods.</li>
</ol>
<p>Would be great if you could do both.</p>
<p>P.S. The tree should not have “extra” elements like empty <code>&lt;ul&gt;&lt;/ul&gt;</code> for the leaves.</p>
<p>
<a href="http://plnkr.co/edit/DIKZVzwLSbtmENu5JiHc?p=preview" target="_blank" data-plunk-id="DIKZVzwLSbtmENu5JiHc">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The easiest way to walk the object is to use recursion.</p>
<ol>
<li>
<a href="http://plnkr.co/edit/2E3O6iJWuzAbbRToupqX?p=preview">The solution with innerHTML</a>.</li>
<li>
<a href="http://plnkr.co/edit/shmIaeeSV8iVklrowp0o?p=preview">The solution with DOM</a>.</li>
</ol>
<p>
<a href="http://plnkr.co/edit/63GEDxN2vFsZzCO74Zxc?p=preview" target="_blank" data-plunk-id="63GEDxN2vFsZzCO74Zxc">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#show-descendants-in-a-tree" name="show-descendants-in-a-tree" class="main__anchor">Show descendants in a tree</a></h3>
<a href="http://javascript.info/task/tree-count" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's a tree organized as nested <code>ul/li</code>.</p>
<p>Write the code that adds to each <code>&lt;li&gt;</code> the number of its descendants. Skip leaves (nodes without children).</p>
<p>The result:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/task/tree-count/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/nMK5ZEc027FcFYm0nUY2?p=preview" target="_blank" data-plunk-id="nMK5ZEc027FcFYm0nUY2">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To append text to each <code>&lt;li&gt;</code> we can alter the text node <code>data</code>.</p>
<p>
<a href="http://plnkr.co/edit/iIxsZDmWTf8WLvCNwRSe?p=preview" target="_blank" data-plunk-id="iIxsZDmWTf8WLvCNwRSe">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-a-calendar" name="create-a-calendar" class="main__anchor">Create a calendar</a></h3>
<a href="http://javascript.info/task/calendar-table" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Write a function <code>createCalendar(elem, year, month)</code>.</p>
<p>The call should create a calendar for the given year/month and put it inside <code>elem</code>.</p>
<p>The calendar should be a table, where a week is <code>&lt;tr&gt;</code>, and a day is <code>&lt;td&gt;</code>. The table top should be <code>&lt;th&gt;</code> with weekday names: the first day should be Monday, and so on till Sunday.</p>
<p>For instance, <code>createCalendar(cal, 2012, 9)</code> should generate in element <code>cal</code> the following calendar:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:210px" src="https://en.js.cx/task/calendar-table/solution/"></iframe>
  </div><p>P.S. For this task it's enough to generate the calendar, should not yet be clickable.</p>
<p>
<a href="http://plnkr.co/edit/52Ew9BJFQuSwO5T1T7yf?p=preview" target="_blank" data-plunk-id="52Ew9BJFQuSwO5T1T7yf">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We'll create the table as a string: <code>"&lt;table&gt;...&lt;/table&gt;"</code>, and then assign it to  <code>innerHTML</code>.</p>
<p>The algorithm:</p>
<ol>
<li>Create the table header with <code>&lt;th&gt;</code> and weekday names.</li>
<li>Create the date object <code>d = new Date(year, month-1)</code>. That's the first day of <code>month</code> (taking into account that months in JavaScript start from <code>0</code>, not <code>1</code>).</li>
<li>First few cells till the first day of the month <code>d.getDay()</code> may be empty. Let's fill them in with <code>&lt;td&gt;&lt;/td&gt;</code>.</li>
<li>Increase the day in <code>d</code>: <code>d.setDate(d.getDate()+1)</code>. If <code>d.getMonth()</code> is not yet the next month, then add the new cell <code>&lt;td&gt;</code> to the calendar. If that's a Sunday, then add a newline <code>“&lt;/tr&gt;&lt;tr&gt;”</code>.</li>
<li>If the month has finished, but the table row is not yet full, add empty <code>&lt;td&gt;</code> into it, to make it square.</li>
</ol>
<p>
<a href="http://plnkr.co/edit/MtVbnh2kq6fJkrMI51DV?p=preview" target="_blank" data-plunk-id="MtVbnh2kq6fJkrMI51DV">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#colored-clock-with-setinterval" name="colored-clock-with-setinterval" class="main__anchor">Colored clock with setInterval</a></h3>
<a href="http://javascript.info/task/clock-setinterval" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Create a colored clock like here:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:60px" src="https://en.js.cx/task/clock-setinterval/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/UBxtMxkGAu7mE99GmSJE?p=preview" target="_blank" data-plunk-id="UBxtMxkGAu7mE99GmSJE">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>First, let's make HTML/CSS.</p>
<p>Each component of the time would look great in its own <code>&lt;span&gt;</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="clock"&gt;
  &lt;span class="hour"&gt;hh&lt;/span&gt;:&lt;span class="min"&gt;mm&lt;/span&gt;:&lt;span class="sec"&gt;ss&lt;/span&gt;
&lt;/div&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Also we'll need CSS to color them.</p>
<p>The <code>update</code> function will refresh the clock, to be called by <code>setInterval</code> every second:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function update() {
  let clock = document.getElementById('clock');
  let date = new Date(); // (*)
  let hours = date.getHours();
  if (hours &lt; 10) hours = '0' + hours;
  clock.children[0].innerHTML = hours;

  let minutes = date.getMinutes();
  if (minutes &lt; 10) minutes = '0' + minutes;
  clock.children[1].innerHTML = minutes;

  let seconds = date.getSeconds();
  if (seconds &lt; 10) seconds = '0' + seconds;
  clock.children[2].innerHTML = seconds;
}</code></pre>
        </div>
      </div>
      
      </div><p>In the line <code>(*)</code> we every time check the current date. The calls to <code>setInterval</code> are not reliable: they may happen with delays.</p>
<p>The clock-managing functions:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let timerId;

function clockStart() { // run the clock
  timerId = setInterval(update, 1000);
  update(); // (*)
}

function clockStop() {
  clearInterval(timerId);
  timerId = null;
}</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the call to <code>update()</code> is not only scheduled in <code>clockStart()</code>, but immediately run in the line <code>(*)</code>. Otherwise the visitor would have to wait till the first execution of <code>setInterval</code>. And the clock would be empty till then.</p>
<p>
<a href="http://plnkr.co/edit/A4wpyRThfyXaqWx9NxsT?p=preview" target="_blank" data-plunk-id="A4wpyRThfyXaqWx9NxsT">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#insert-the-html-in-the-list" name="insert-the-html-in-the-list" class="main__anchor">Insert the HTML in the list</a></h3>
<a href="http://javascript.info/task/append-to-list" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write the code to insert <code>&lt;li&gt;2&lt;/li&gt;&lt;li&gt;3&lt;/li&gt;</code> between two <code>&lt;li&gt;</code> here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;ul id="ul"&gt;
  &lt;li id="one"&gt;1&lt;/li&gt;
  &lt;li id="two"&gt;4&lt;/li&gt;
&lt;/ul&gt;</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>When we need to insert a piece of HTML somewhere, <code>insertAdjacentHTML</code> is the best fit.</p>
<p>The solution:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">one.insertAdjacentHTML('afterend', '&lt;li&gt;2&lt;/li&gt;&lt;li&gt;3&lt;/li&gt;');</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sort-the-table" name="sort-the-table" class="main__anchor">Sort the table</a></h3>
<a href="http://javascript.info/task/sort-table" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's a table:</p>
<table>
<tbody><tr>
  <th>Name</th>
  <th>Surname</th>
  <th>Age</th>
</tr>
<tr>
  <td>John</td>
  <td>Smith</td>
  <td>10</td>
</tr>
<tr>
  <td>Pete</td>
  <td>Brown</td>
  <td>15</td>
</tr>
<tr>
  <td>Ann</td>
  <td>Lee</td>
  <td>5</td>
</tr>
<tr>
  <td>...</td>
  <td>...</td>
  <td>...</td>
</tr>
</tbody></table>
<p>There may be more rows in it.</p>
<p>Write the code to sort it by the <code>"name"</code> column.</p>
<p>
<a href="http://plnkr.co/edit/xz1VjwMq57ugptrf5UTd?p=preview" target="_blank" data-plunk-id="xz1VjwMq57ugptrf5UTd">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution is short, yet may look a bit tricky, so here I provide it with extensive comments:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let sortedRows = Array.from(table.rows)
  .slice(1)
  .sort((rowA, rowB) =&gt; rowA.cells[0].innerHTML &gt; rowB.cells[0].innerHTML ? 1 : -1);

table.tBodies[0].append(...sortedRows);</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>
<p>Get all <code>&lt;tr&gt;</code>, like <code>table.querySelectorAll('tr')</code>, then make an array from them, cause we need array methods.</p>
</li>
<li>
<p>The first TR (<code>table.rows[0]</code>) is actually a table header, so we take the rest by <code>.slice(1)</code>.</p>
</li>
<li>
<p>Then sort them comparing by the content of the first <code>&lt;td&gt;</code> (the name field).</p>
</li>
<li>
<p>Now insert nodes in the right order by <code>.append(...sortedRows)</code>.</p>
<p>Tables always have an implicit  element, so we need to take it and insert into it: a simple <code>table.append(...)</code> would fail.</p>
<p>Please note: we don't have to remove them, just “re-insert”, they leave the old place automatically.</p>
</li>
</ol>
<p>
<a href="http://plnkr.co/edit/IzHvsic6JD4aJam7OndG?p=preview" target="_blank" data-plunk-id="IzHvsic6JD4aJam7OndG">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-635"></h6>
<h1 class="main__header-title" id="chapter-636">Styles and classes</h1>
<p>Before we get to JavaScript ways of dealing with styles and classes – here's an important rule. Hopefully it's obvious enough, but we still have to mention it.</p>
<p>There are generally two ways to style an element:</p>
<ol>
<li>Create a class in CSS and add it: <code>&lt;div class="..."&gt;</code></li>
<li>Write properties directly into <code>style</code>: <code>&lt;div style="..."&gt;</code>.</li>
</ol>


<p>CSS is always the preferred way – not only for HTML, but in JavaScript as well.</p>
<p>We should only manipulate the <code>style</code> property if classes “can't handle it”.</p>
<p>For instance, <code>style</code> is acceptable if we calculate coordinates of an element dynamically and want to set them from JavaScript, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let top = /* complex calculations */;
let left = /* complex calculations */;
elem.style.left = left; // e.g '123px'
elem.style.top = top; // e.g '456px'</code></pre>
        </div>
      </div>
      
      </div><p>For other cases, like making the text red, adding a background icon – describe that in CSS and then apply the class. That's more flexible and easier to support.</p>
<h2 id="chapter-637">
className and classList</h2>
<p>Changing a class is one of the most often actions in scripts.</p>
<p>In the ancient time, there was a limitation in JavaScript: a reserved word like <code>"class"</code> could not be an object property. That limitation does not exist now, but at that time it was impossible to have a <code>"class"</code> property, like <code>elem.class</code>.</p>
<p>So for classes the similar-looking property <code>"className"</code> was introduced: the <code>elem.className</code> corresponds to the <code>"class"</code> attribute.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body class="main page"&gt;
  &lt;script&gt;
    alert(document.body.className); // main page
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>If we assign something to <code>elem.className</code>, it replaces the whole strings of classes. Sometimes that's what we need, but often we want to add/remove a single class.</p>
<p>There's another property for that: <code>elem.classList</code>.</p>
<p>The <code>elem.classList</code> is a special object with methods to <code>add/remove/toggle</code> classes.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body class="main page"&gt;
  &lt;script&gt;
    // add a class
    document.body.classList.add('article');

    alert(document.body.className); // main page article
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>So we can operate both on the full class string using <code>className</code> or on individual classes using <code>classList</code>. What we choose depends on our needs.</p>
<p>Methods of <code>classList</code>:</p>
<ul>
<li><code>elem.classList.add/remove("class")</code> – adds/removes the class.</li>
<li><code>elem.classList.toggle("class")</code> – if the class exists, then removes it, otherwise adds it.</li>
<li><code>elem.classList.contains("class")</code> – returns <code>true/false</code>, checks for the given class.</li>
</ul>
<p>Besides that, <code>classList</code> is iterable, so we can list all classes like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body class="main page"&gt;
  &lt;script&gt;
    for(let name of document.body.classList) {
      alert(name); // main, and then page
    }
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-638">
Element style</h2>
<p>The property <code>elem.style</code> is an object that corresponds to what's written in the <code>"style"</code> attribute. Setting <code>elem.style.width="100px"</code> works as if we had in the attribute <code>style="width:100px"</code>.</p>
<p>For multi-word property the camelCase is used:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">background-color  =&gt; elem.style.backgroundColor
z-index           =&gt; elem.style.zIndex
border-left-width =&gt; elem.style.borderLeftWidth</code></pre>
        </div>
      </div>
      
      </div><p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.body.style.backgroundColor = prompt('background color?', 'green');</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Prefixed properties</span></div>
            <div class="important__content"><p>Browser-prefixed properties like <code>-moz-border-radius</code>, <code>-webkit-border-radius</code> also follow the same rule, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">button.style.MozBorderRadius = '5px';
button.style.WebkitBorderRadius = '5px';</code></pre>
        </div>
      </div>
      
      </div><p>That is: a dash <code>"-"</code> becomes an uppercase.</p>
</div></div>
<h2 id="chapter-639">
Resetting the style property</h2>
<p>Sometimes we want to assign a style property, and later remove it.</p>
<p>For instance, to hide an element, we can set <code>elem.style.display = "none"</code>.</p>
<p>Then later we may want to remove the <code>style.display</code> as if it were not set. Instead of <code>delete elem.style.display</code> we should assign an empty line to it: <code>elem.style.display = ""</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// if we run this code, the &lt;body&gt; "blinks"
document.body.style.display = "none"; // hide

setTimeout(() =&gt; document.body.style.display = "", 1000); // back to normal</code></pre>
        </div>
      </div>
      
      </div><p>If we set <code>display</code> to an empty string, then the browser applies CSS classes and its built-in styles normally, as if there were no such <code>style</code> property at all.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Full rewrite with <code>style.cssText</code></span></div>
            <div class="important__content"><p>Normally, we use <code>style.*</code> to assign individual style properties. We can't set the full style like <code>div.style="color: red; width: 100px"</code>, because <code>div.style</code> is an object, and it's read-only.</p>
<p>To set the full style as a string, there's a special property <code>style.cssText</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="div"&gt;Button&lt;/div&gt;

&lt;script&gt;
  // we can set special style flags like "important" here
  div.style.cssText=`color: red !important;
    background-color: yellow;
    width: 100px;
    text-align: center;
  `;

  alert(div.style.cssText);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>We rarely use it, because such assignment removes all existing styles: it does not add, but replaces them. May occasionally delete something needed. But still can be done for new elements when we know we don't delete something important.</p>
<p>The same can be accomplished by setting an attribute: <code>div.setAttribute('style', 'color: red...')</code>.</p>
</div></div>
<h2 id="chapter-640">
Mind the units</h2>
<p>CSS units must be provided in style values.</p>
<p>For instance, we should not set <code>elem.style.top</code> to <code>10</code>, but rather to <code>10px</code>. Otherwise it wouldn't work:</p>
<div data-trusted="1" class="code-example" data-demo-height="100" data-highlight-block="2-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;
  &lt;script&gt;
    // doesn't work!
    document.body.style.margin = 20;
    alert(document.body.style.margin); // '' (empty string, the assignment is ignored)

    // now add the CSS unit (px) - and it works
    document.body.style.margin = '20px';
    alert(document.body.style.margin); // 20px

    alert(document.body.style.marginTop); // 20px
    alert(document.body.style.marginLeft); // 20px
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Please note how the browser “unpacks” the property <code>style.margin</code> in the last lines and infers <code>style.marginLeft</code> and <code>style.marginTop</code> (and other partial margins) from it.</p>
<h2 id="chapter-641">
Computed styles: getComputedStyle</h2>
<p>Modifying a style is easy. But how to <em>read</em> it?</p>
<p>For instance, we want to know the size, margins, the color of an element. How to do it?</p>
<p><strong>The <code>style</code> property operates only on the value of the <code>"style"</code> attribute, without any CSS cascade.</strong></p>
<p>So we can't read anything that comes from CSS classes using <code>elem.style</code>.</p>
<p>For instance, here <code>style</code> doesn't see the margin:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-highlight-block="7-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;head&gt;
  &lt;style&gt; body { color: red; margin: 5px } &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

  The red text
  &lt;script&gt;
    alert(document.body.style.color); // empty
    alert(document.body.style.marginTop); // empty
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>…But what if we need, say, increase the margin by 20px? We want the current value for the start.</p>
<p>There's another method for that: <code>getComputedStyle</code>.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">getComputedStyle(element[, pseudo])</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt>element</dt>
<dd>Element to read the value for.</dd>
<dt>pseudo</dt>
<dd>A pseudo-element if required, for instance <code>::before</code>. An empty string or no argument mean the element itself.</dd>
</dl>
<p>The result is an object with style properties, like <code>elem.style</code>, but now with respect to all CSS classes.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="100">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;head&gt;
  &lt;style&gt; body { color: red; margin: 5px } &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;script&gt;
    let computedStyle = getComputedStyle(document.body);

    // now we can read the margin and the color from it

    alert( computedStyle.marginTop ); // 5px
    alert( computedStyle.color ); // rgb(255, 0, 0)
  &lt;/script&gt;

&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Computed and resolved values</span></div>
            <div class="important__content"><p>There are two concepts in 
<a href="https://drafts.csswg.org/cssom/#resolved-values">CSS</a>:</p>
<ol>
<li>A <em>computed</em> style value is the value after all CSS rules and CSS inheritance is applied, as the  result of the CSS cascade. If can look like <code>height:1em</code> or <code>font-size:125%</code>.</li>
<li>A <em>resolved</em> style value is the one finally applied to the element. Values like <code>1em</code> or <code>125%</code> are relative. The browser takes the computed value and makes all units fixed and absolute, for instance: <code>height:20px</code> or <code>font-size:16px</code>. For geometry properties resolved values may have a floating point, like <code>width:50.5px</code>.</li>
</ol>
<p>Long time ago <code>getComputedStyle</code> was created to get computed values, but it turned out that resolved values are much more convenient, and the standard changed.</p>
<p>So nowadays <code>getComputedStyle</code> actually returns the resolved value of the property.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><code>getComputedStyle</code> requires the full property name</span></div>
            <div class="important__content"><p>We should always ask for the exact property that we want, like <code>paddingLeft</code> or <code>marginTop</code> or <code>borderTopWidth</code>. Otherwise the correct result is not guaranteed.</p>
<p>For instance, if there are properties <code>paddingLeft/paddingTop</code>, then what should we get for <code>getComputedStyle(elem).padding</code>? Nothing, or maybe a “generated” value from known paddings? There's no standard rule here.</p>
<p>There are other inconsistencies. As an example, some browsers (Chrome) show <code>10px</code> in the document below, and some of them (Firefox) –  do not:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  body {
    margin: 10px;
  }
&lt;/style&gt;
&lt;script&gt;
  let style = getComputedStyle(document.body);
  alert(style.margin); // empty string in Firefox
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">“Visited” links styles are hidden!</span></div>
            <div class="important__content"><p>Visited links may be colored using <code>:visited</code> CSS pseudoclass.</p>
<p>But <code>getComputedStyle</code> does not give access to that color, because otherwise an arbitrary page could find out whether the user visited a link by creating it on the page and checking the styles.</p>
<p>JavaScript we may not see the styles applied by <code>:visited</code>. And also, there's a limitation in CSS that forbids to apply geometry-changing styles in <code>:visited</code>. That's to guarantee that there's no side way for an evil page to test if a link was visited and hence to break the privacy.</p>
</div></div>
<h2 id="chapter-642">
Summary</h2>
<p>To manage classes, there are two DOM properties:</p>
<ul>
<li><code>className</code> – the string value, good to manage the whole set of classes.</li>
<li><code>classList</code> – the object with methods <code>add/remove/toggle/contains</code>, good for individual classes.</li>
</ul>
<p>To change the styles:</p>
<ul>
<li>
<p>The <code>style</code> property is an object with camelCased styles. Reading and writing to it has the same meaning as modifying individual properties in the <code>"style"</code> attribute. To see how to apply <code>important</code> and other rare stuff – there's a list of methods at 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleDeclaration">MDN</a>.</p>
</li>
<li>
<p>The <code>style.cssText</code> property corresponds to the whole <code>"style"</code> attribute, the full string of styles.</p>
</li>
</ul>
<p>To read the resolved styles (with respect to all classes, after all CSS is applied and final values are calculated):</p>
<ul>
<li>The <code>getComputedStyle(elem[, pseudo])</code> returns the style-like object with them. Read-only.</li>
</ul>
<div class="tasks"><h2 id="chapter-643" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-a-notification" name="create-a-notification" class="main__anchor">Create a notification</a></h3>
<a href="http://javascript.info/task/create-notification" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function <code>showNotification(options)</code> that a notification: <code>&lt;div class="notification"&gt;</code> with the given content. The notification should automatically disappear after 1.5 seconds.</p>
<p>The options are:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// shows an element with the text "Hello" near the right-top of the window
showNotification({
  top: 10, // 10px from the top of the window (by default 0px)
  right: 10, // 10px from the right edge of the window (by default 0px)
  html: "Hello!", // the HTML of notification
  className: "welcome" // an additional class for the div (optional)
});</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="https://en.js.cx/task/create-notification/solution/" target="blank">Demo in new window</a></p><p>Use CSS positioning to show the element at given top/right coordinates. The source document has the necessary styles.</p>
<p>
<a href="http://plnkr.co/edit/u3sgE9SfrqbYm8PavLSL?p=preview" target="_blank" data-plunk-id="u3sgE9SfrqbYm8PavLSL">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/coNBwfDM9k228IZxqS0B?p=preview" target="_blank" data-plunk-id="coNBwfDM9k228IZxqS0B">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-644"></h6>
<h1 class="main__header-title" id="chapter-645">Element size and scrolling</h1>
<p>There are many JavaScript properties that allow to read information about element width, height and other geometry features.</p>
<p>We often need them when moving or positioning elements in JavaScript, to correctly calculate coordinates.</p>


<h2 id="chapter-646">
Sample element</h2>
<p>As a sample element to demonstrate properties we'll use the one given below:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="example"&gt;
  ...Text...
&lt;/div&gt;
&lt;style&gt;
  #example {
    width: 300px;
    height: 200px;
    border: 25px solid #E8C48F;
    padding: 20px;
    overflow: auto;
  }
&lt;/style&gt;</code></pre>
        </div>
      </div>
      
      </div><p>It has the border, padding and scrolling. The full set of features. There are no margins, as they are not the part of the element itself, and there are no special properties for them.</p>
<p>The element looks like this:</p>
      <img src="http://javascript.info/article/size-and-scroll/metric-css.png">
<p>You can 
<a href="http://plnkr.co/edit/ASzuaHeEgqoTMF1XlXLo?p=preview">open the document in the sandbox</a>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Mind the scrollbar</span></div>
            <div class="important__content"><p>The picture above demonstrates the most complex case when the element has a scrollbar. Some browsers (not all) reserve the space for it by taking it from the content.</p>
<p>So, without scrollbar the content width would be <code>300px</code>, but if the scrollbar is <code>16px</code> wide (the width may vary between devices and browsers) then only <code>300-16 = 284px</code> remains, and we should take it into account. That's why examples from this chapter assume that there's a scrollbar. If there's no scrollbar, then things are just a bit simpler.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The <code>padding-bottom</code> may be filled with text</span></div>
            <div class="important__content"><p>Usually paddings are shown empty on illustrations, but if there's a lot of text in the element and it overflows, then browsers show the “overflowing” text at <code>padding-bottom</code>, so you can see that in examples. But the padding is still there, unless specified otherwise.</p>
</div></div>
<h2 id="chapter-647">
Geometry</h2>
<p>Element properties that provide width, height and other geometry are always numbers. They are assumed to be in pixels.</p>
<p>Here's the overall picture:</p>
      <img src="http://javascript.info/article/size-and-scroll/metric-all.png">
<p>They are many properties, it's difficult to fit them all in the single picture, but their values are simple and easy to understand.</p>
<p>Let's start exploring them from the outside of the element.</p>
<h2 id="chapter-648">
offsetParent, offsetLeft/Top</h2>
<p>These properties are rarely needed, but still they are the “most outer” geometry properties, so we'll start with them.</p>
<p>The <code>offsetParent</code> is the nearest ancestor that is:</p>
<ol>
<li>CSS-positioned (<code>position</code> is <code>absolute</code>, <code>relative</code> or <code>fixed</code>),</li>
<li>or <code>&lt;td&gt;</code>, <code>&lt;th&gt;</code>, <code>&lt;table&gt;</code>,</li>
<li>or <code>&lt;body&gt;</code>.</li>
</ol>
<p>In most practical cases we can use <code>offsetParent</code> to get the nearest CSS-positioned ancestor. And <code>offsetLeft/offsetTop</code> provide x/y coordinates relative to it's left-upper corner.</p>
<p>In the example below the inner <code>&lt;div&gt;</code> has <code>&lt;main&gt;</code> as <code>offsetParent</code> and <code>offsetLeft/offsetTop</code> are shifts from its left-upper corner (<code>180</code>):</p>
<div data-trusted="1" class="code-example" data-demo-height="10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;main style="position: relative" id="main"&gt;
  &lt;article&gt;
    &lt;div id="example" style="position: absolute; left: 180px; top: 180px"&gt;...&lt;/div&gt;
  &lt;/article&gt;
&lt;/main&gt;
&lt;script&gt;
  alert(example.offsetParent.id); // main
  alert(example.offsetLeft); // 180 (note: a number, not a string "180px")
  alert(example.offsetTop); // 180
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/size-and-scroll/metric-offset-parent.png"&gt;
<p>There are several occasions when <code>offsetParent</code> is <code>null</code>:</p>
<ol>
<li>For not shown elements (<code>display:none</code> or not in the document).</li>
<li>For <code>&lt;body&gt;</code> and <code>&lt;html&gt;</code>.</li>
<li>For elements with <code>position:fixed</code> on them.</li>
</ol>
<h2 id="chapter-649">
offsetWidth/Height</h2>
<p>Now let's move to the element itself.</p>
<p>These two properties are the simplest ones. They provide the “outer” width/height of the element. Or, in other words, its full size including borders.</p>
      <img src="http://javascript.info/article/size-and-scroll/metric-offset-width-height.png">
<p>For our sample element:</p>
<ul>
<li><code>offsetWidth = 390</code> – the outer width, can be calculated as inner CSS-width (<code>300px</code>) plus paddings (<code>2*20px</code>) and borders (<code>2*25px</code>).</li>
<li><code>offsetHeight = 290</code> – the outer height.</li>
</ul>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Geometry properties for not shown elements are zero/null</span></div>
            <div class="important__content"><p>Geometry properties are calculated only for shown elements.</p>
<p>If an element (or any of its ancestors) has <code>display:none</code> or is not in the document, then all geometry properties are zero or <code>null</code> depending on what it is.</p>
<p>For example, <code>offsetParent</code> is <code>null</code>, and <code>offsetWidth</code>, <code>offsetHeight</code> are <code>0</code>.</p>
<p>We can use this to check if an element is hidden, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function isHidden(elem) {
  return !elem.offsetWidth &amp;&amp; !elem.offsetHeight;
}</code></pre>
        </div>
      </div>
      
      </div><p>Please note that such <code>isHidden</code> returns <code>true</code> for elements that are on-screen, but have zero sizes (like an empty <code>&lt;div&gt;</code>).</p>
</div></div>
<h2 id="chapter-650">
clientTop/Left</h2>
<p>Inside the element we have the borders.</p>
<p>To measure them, there are properties <code>clientTop</code> and <code>clientLeft</code>.</p>
<p>In our example:</p>
<ul>
<li><code>clientLeft = 25</code> – left border width</li>
<li><code>clientTop = 25</code> – top border width</li>
</ul>
      <img src="http://javascript.info/article/size-and-scroll/metric-client-left-top.png">
<p>…But to be precise – they are not borders, but relative coordinates of the inner side from the outer side.</p>
<p>What's the difference?</p>
<p>It becomes visible when the document is right-to-left (the operation system is in arabic or hebrew languages). The scrollbar is then not on the right, but on the left, and then <code>clientLeft</code> also includes the scrollbar width.</p>
<p>In that case <code>clientLeft</code> in our example would be not <code>25</code>, but with the scrollbar width <code>25+16=41</code>:</p>
      <img src="http://javascript.info/article/size-and-scroll/metric-client-left-top-rtl.png">
<h2 id="chapter-651">
clientWidth/Height</h2>
<p>These properties provide the size of the area inside the element borders.</p>
<p>They include the content width together with paddings, but without the scrollbar:</p>
      <img src="http://javascript.info/article/size-and-scroll/metric-client-width-height.png">
<p>On the picture above let's first consider <code>clientHeight</code>: it's easier to evaluate. There's no horizontal scrollbar, so it's exactly the sum of what's inside the borders: CSS-height <code>200px</code> plus top and bottom paddings (<code>2*20px</code>) total <code>240px</code>.</p>
<p>Now <code>clientWidth</code> – here the content width is not <code>300px</code>, but <code>284px</code>, because <code>16px</code> are occupied by the scrollbar. So the sum is <code>284px</code> plus left and right paddings, total <code>324px</code>.</p>
<p><strong>If there are no paddings, then <code>clientWidth/Height</code> is exactly the content area, inside the borders and the scrollbar (if any).</strong></p>
      <img src="http://javascript.info/article/size-and-scroll/metric-client-width-nopadding.png">
<p>So when there's no padding we can use <code>clientWidth/clientHeight</code> to get the content area size.</p>
<h2 id="chapter-652">
scrollWidth/Height</h2>
<ul>
<li>Properties <code>clientWidth/clientHeight</code> only account for the visible part of the element.</li>
<li>Properties <code>scrollWidth/scrollHeight</code> also include the scrolled out (hidden) part:</li>
</ul>
      <img src="http://javascript.info/article/size-and-scroll/metric-scroll-width-height.png">
<p>On the picture above:</p>
<ul>
<li><code>scrollHeight = 723</code> – is the full inner height of the content area including the scrolled out part.</li>
<li><code>scrollWidth = 324</code> – is the full inner width, here we have no horizontal scroll, so it equals <code>clientWidth</code>.</li>
</ul>
<p>We can use these properties to expand the element wide to its full width/height.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// expand the element to the full content height
element.style.height = element.scrollHeight + 'px';</code></pre>
        </div>
      </div>
      
      </div><p>Click the button to expand the element:</p>
<div id="element" style="width:300px;height:200px; padding: 0;overflow: auto; border:1px solid black;">text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text</div>
<p><button style="padding:0" onclick="element.style.height = element.scrollHeight + 'px'">element.style.height = element.scrollHeight + ‘px'</button>
</p>
<h2 id="chapter-653">
scrollLeft/scrollTop</h2>
<p>Properties <code>scrollLeft/scrollTop</code> are the width/height of the hidden, scrolled out part of the element.</p>
<p>On the picture below we can see <code>scrollHeight</code> and <code>scrollTop</code> for a block with a vertical scroll.</p>
      <img src="http://javascript.info/article/size-and-scroll/metric-scroll-top.png">
<p>In other words, <code>scrollTop</code> is “how much is scrolled up”.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>scrollLeft/scrollTop</code> can be modified</span></div>
            <div class="important__content"><p>Most geometry properties that are read-only, but <code>scrollLeft/scrollTop</code> can be changed, and the browser will scroll the element.</p>
<p>If you click the element below, the code <code>elem.scrollTop+=10</code> executes. That makes the element content scroll <code>10px</code> below.</p>
<div onclick="this.scrollTop+=10" style="cursor:pointer;border:1px solid black;width:100px;height:80px;overflow:auto">Click<br>Me<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</div>
<p>Setting <code>scrollTop</code> to <code>0</code> or <code>Infinity</code> will make the element scroll to the very top/bottom respectively.</p>
</div></div>
<h2 id="chapter-654">
Don't take width/height from CSS</h2>
<p>We've just covered geometry properties of DOM elements. They are normally used to get widths, heights and calculate distances.</p>
<p>But as we know from the chapter 
<a href="http://javascript.info/styles-and-classes">Styles and classes</a>, we can read CSS-height and width using <code>getComputedStyle</code>.</p>
<p>So why not to read the width of an element like this?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let elem = document.body;

alert( getComputedStyle(elem).width ); // show CSS width for elem</code></pre>
        </div>
      </div>
      
      </div><p>Why we should use geometry properties instead? There are two reasons:</p>
<ol>
<li>
<p>First, CSS width/height depend on another property: <code>box-sizing</code> that defines “what is” CSS width and height. A change in <code>box-sizing</code> for CSS purposes may break such JavaScript.</p>
</li>
<li>
<p>Second, CSS <code>width/height</code> may be <code>auto</code>, for instance for an inline element:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;span id="elem"&gt;Hello!&lt;/span&gt;

&lt;script&gt;
  alert( getComputedStyle(elem).width ); // auto
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>From the CSS standpoint, <code>width:auto</code> is perfectly normal, but in JavaScript we need an exact size in <code>px</code> that we can use in calculations. So here CSS width is useless at all.</p>
</li>
</ol>
<p>And there's one more reason: a scrollbar. Sometimes the code that works fine without a scrollbar starts to bug with it, because a scrollbar takes the space from the content in some browsers. So the real width available for the content is <em>less</em> than CSS width. And <code>clientWidth/clientHeight</code> take that into account.</p>
<p>…But with <code>getComputedStyle(elem).width</code> the situation is different. Some browsers (e.g. Chrome) return the real inner width, minus the scrollbar, and some of them (e.g. Firefox) – CSS width (ignore the scrollbar). Such cross-browser differences is the reason not to use <code>getComputedStyle</code>, but rather rely on geometry properties.</p>
<p>If your browser reserves the space for a scrollbar (most browsers for Windows do), then you can test it below.</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/size-and-scroll/cssWidthScroll/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/article/size-and-scroll/cssWidthScroll/"></iframe>
  </div><p>The element with text has CSS <code>width:300px</code>.</p>
<p>On a Desktop Windows OS, Firefox, Chrome, Edge all reserve the space for the scrollbar. But  Firefox shows <code>300px</code>, while Chrome and Edge show less. That's because Firefox returns the CSS width and other browsers return the “real” width.</p>
<p>Please note that the described difference are only about reading <code>getComputedStyle(...).width</code> from JavaScript, visually everything is correct.</p>
<h2 id="chapter-655">
Summary</h2>
<p>Elements have the following geometry properties:</p>
<ul>
<li><code>offsetParent</code> – is the nearest positioned ancestor or <code>td</code>, <code>th</code>, <code>table</code>, <code>body</code>.</li>
<li><code>offsetLeft/offsetTop</code> – coordinates relative to the left-upper edge of <code>offsetParent</code>.</li>
<li><code>offsetWidth/offsetHeight</code> – “outer” width/height of an element including borders.</li>
<li><code>clientLeft/clientTop</code> – the distance from the left-upper outer corner to its left-upper inner corner. For left-to-right OS they are always the widths of left/top borders. For right-to-left OS the vertical scrollbar is on the left so <code>clientLeft</code> includes its width too.</li>
<li><code>clientWidth/clientHeight</code> – the width/height of the content including paddings, but without the scrollbar.</li>
<li><code>scrollWidth/scrollHeight</code> – the width/height of the content including the scrolled out part. Also includes paddings, but not the scrollbar.</li>
<li><code>scrollLeft/scrollTop</code> – width/height of the scrolled out part of the element, starting from its left-upper corner.</li>
</ul>
<p>All properties are read-only except <code>scrollLeft/scrollTop</code>. They make the browser scroll the element if changed.</p>
<div class="tasks"><h2 id="chapter-656" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-s-the-scroll-from-the-bottom" name="what-s-the-scroll-from-the-bottom" class="main__anchor">What's the scroll from the bottom?</a></h3>
<a href="http://javascript.info/task/get-scroll-height-bottom" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The <code>elem.scrollTop</code> property is the size of the scrolled out part from the top. How to get “<code>scrollBottom</code>” – the size from the bottom?</p>
<p>Write the code that works for an arbitrary <code>elem</code>.</p>
<p>P.S. Please check your code: if there's no scroll or the element is fully scrolled down, then it should return <code>0</code>.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let scrollBottom = elem.scrollHeight - elem.scrollTop - elem.clientHeight;</code></pre>
        </div>
      </div>
      
      </div><p>In other words: (full height) minus (scrolled out top part) minus (visible part) – that's exactly the scrolled out bottom part.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#what-is-the-scrollbar-width" name="what-is-the-scrollbar-width" class="main__anchor">What is the scrollbar width?</a></h3>
<a href="http://javascript.info/task/scrollbar-width" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>Write the code that returns the width of a standard scrollbar.</p>
<p>For Windows it usually varies between <code>12px</code> and <code>20px</code>. If the browser doesn't reserves any space for it, then it may be <code>0px</code>.</p>
<p>P.S. The code should work for any HTML document, do not depend on its content.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To get the scrollbar width, we can create an element with the scroll, but without borders and paddings.</p>
<p>Then the difference between its full width <code>offsetWidth</code> and the inner content area width <code>clientWidth</code> will be exactly the scrollbar:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// create a div with the scroll
let div = document.createElement('div');

div.style.overflowY = 'scroll';
div.style.width = '50px';
div.style.height = '50px';

// must put it in the document, otherwise sizes will be 0
document.body.append(div);
let scrollWidth = div.offsetWidth - div.clientWidth;

div.remove();

alert(scrollWidth);</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#place-the-ball-in-the-field-center" name="place-the-ball-in-the-field-center" class="main__anchor">Place the ball in the field center</a></h3>
<a href="http://javascript.info/task/put-ball-in-center" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Here's how the source document looks:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/task/put-ball-in-center/source/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      <div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/QQV17fHpY5pnojDdgfyz?p=preview" target="_blank" title="open in sandbox" data-plunk-id="QQV17fHpY5pnojDdgfyz" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:180px" src="https://en.js.cx/task/put-ball-in-center/source/"></iframe>
  </div><p>What are coordinates of the field center?</p>
<p>Calculate them and use to place the ball into the center of the field:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:180px" src="https://en.js.cx/task/put-ball-in-center/solution/"></iframe>
  </div><ul>
<li>The element should be moved by JavaScript, not CSS.</li>
<li>The code should work with any ball size (<code>10</code>, <code>20</code>, <code>30</code> pixels) and any field size, not be bound to the given values.</li>
</ul>
<p>P.S. Sure, centering could be done with CSS, but here we want exactly JavaScript. Further we'll meet other topics and more complex situations when JavaScript must be used. Here we do a “warm-up”.</p>
<p>
<a href="http://plnkr.co/edit/QQV17fHpY5pnojDdgfyz?p=preview" target="_blank" data-plunk-id="QQV17fHpY5pnojDdgfyz">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The ball has <code>position:absolute</code>. It means that its <code>left/top</code> coordinates are measured from the nearest positioned element, that is <code>#field</code> (because it has <code>position:relative</code>).</p>
<p>The coordinates start from the inner left-upper corner of the field:</p>
      <img src="http://javascript.info/task/put-ball-in-center/field.png">
<p>The inner field width/height is <code>clientWidth/clientHeight</code>. So the field center has coordinates <code>(clientWidth/2, clientHeight/2)</code>.</p>
<p>…But if we set <code>ball.style.left/top</code> to such values, then not the ball as a whole, but the left-upper edge of the ball would be in the center:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.style.left = Math.round(field.clientWidth / 2) + 'px';
ball.style.top = Math.round(field.clientHeight / 2) + 'px';</code></pre>
        </div>
      </div>
      
      </div><p>Here's how it looks:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:180px" src="https://en.js.cx/task/put-ball-in-center/ball-half/"></iframe>
  </div><p>To align the ball center with the center of the field, we should move the ball to the half of its width to the left and to the half of its height to the top:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.style.left = Math.round(field.clientWidth / 2 - ball.offsetWidth / 2) + 'px';
ball.style.top = Math.round(field.clientHeight / 2 - ball.offsetHeight / 2) + 'px';</code></pre>
        </div>
      </div>
      
      </div><p><strong>Attention: the pitfall!</strong></p>
<p>The code won't work reliably while <code>&lt;img&gt;</code> has no width/height:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;img src="ball.png" id="ball"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>When the browser does not know the width/height of an image (from tag attributes or CSS), then it assumes them to equal <code>0</code> until the image finishes loading.</p>
<p>In real life after the first load browser usually caches the image, and on next loads it will have the size immediately.</p>
<p>But on the first load the value of <code>ball.offsetWidth</code> is <code>0</code>. That leads to wrong coordinates.</p>
<p>We should fix that by adding <code>width/height</code> to <code>&lt;img&gt;</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:20-42">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;img src="ball.png" width="40" height="40" id="ball"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>…Or provide the size in CSS:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">#ball {
  width: 40px;
  height: 40px;
}</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/XWkCmtl6ZBj657LOFg33?p=preview" target="_blank" data-plunk-id="XWkCmtl6ZBj657LOFg33">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#the-difference-css-width-versus-clientwidth" name="the-difference-css-width-versus-clientwidth" class="main__anchor">The difference: CSS width versus clientWidth</a></h3>
<a href="http://javascript.info/task/width-vs-clientwidth" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>What's the difference between <code>getComputedStyle(elem).width</code> and <code>elem.clientWidth</code>?</p>
<p>Give at least 3 differences. The more the better.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Differences:</p>
<ol>
<li><code>clientWidth</code> is numeric, while <code>getComputedStyle(elem).width</code> returns a string with <code>px</code> at the end.</li>
<li><code>getComputedStyle</code> may return non-numeric width like <code>"auto"</code> for an inline element.</li>
<li><code>clientWidth</code> is the inner content area of the element plus paddings, while CSS width (with standard <code>box-sizing</code>) is the inner conand sometent area <em>without paddings</em>.</li>
<li>If there's a scrollbar and the browser reserves the space for it, some browser substract that space from CSS width (cause it's not available for content any more), and some do not. The <code>clientWidth</code> property is always the same: scrollbar size is substracted if reserved.</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-657"></h6>
<h1 class="main__header-title" id="chapter-658">Window sizes and scrolling</h1>
<p>How to find out the width of the browser window? How to get the full height of the document, including the scrolled out part? How to scroll the page using JavaScript?</p>
<p>From the DOM point of view, the root document element is <code>document.documentElement</code>. That element corresponds to <code>&lt;html&gt;</code> and has geometry properties described in the 
<a href="http://javascript.info/size-and-scroll">previous chapter</a>. For some cases we can use it, but there are additional methods and peculiarities important enough to consider.</p>


<h2 id="chapter-659">
Width/height of the window</h2>
<p>Properties <code>clientWidth/clientHeight</code> of <code>document.documentElement</code> is exactly what we want here:</p>
      <img src="http://javascript.info/article/size-and-scroll-window/document-client-width-height.png">
<p>For instance, this button shows the height of your window:</p>
<p><button onclick="alert(document.documentElement.clientHeight)">alert(document.documentElement.clientHeight)</button>
</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Not <code>window.innerWidth/Height</code></span></div>
            <div class="important__content"><p>Browsers also support properties <code>window.innerWidth/innerHeight</code>. They look like what we want. So what's the difference?</p>
<p>If there's a scrollbar occupying some space, <code>clientWidth/clientHeight</code> provide the width/height inside it. In other words, they return width/height of the visible part of the document, available for the content.</p>
<p>And <code>window.innerWidth/innerHeight</code> ignore the scrollbar.</p>
<p>If there's a scrollbar, and it occupies some space, then these two lines show different values:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( window.innerWidth ); // full window width
alert( document.documentElement.clientWidth ); // window width minus the scrollbar</code></pre>
        </div>
      </div>
      
      </div><p>In most cases we need the <em>available</em> window width: to draw or position something. That is: inside scrollbars if there are any. So we should use <code>documentElement.clientHeight/Width</code>.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><code>DOCTYPE</code> is important</span></div>
            <div class="important__content"><p>Please note: top-level geometry properties may work a little bit differently when there's no <code>&lt;!DOCTYPE HTML&gt;</code> in HTML. Odd things are possible.</p>
<p>In modern HTML we should always write <code>DOCTYPE</code>. Generally that's not a JavaScript question, but here it affects JavaScript as well.</p>
</div></div>
<h2 id="chapter-660">
Width/height of the document</h2>
<p>Theoretically, as the root document element is <code>documentElement.clientWidth/Height</code>, and it encloses all the content, we could measure its full size as <code>documentElement.scrollWidth/scrollHeight</code>.</p>
<p>These properties work well for regular elements. But for the whole page these properties do not work as intended. In Chrome/Safari/Opera if there's no scroll, then <code>documentElement.scrollHeight</code> may be even less than  <code>documentElement.clientHeight</code>! For regular elements that's a nonsense.</p>
<p>To have a reliable full window size, we should take the maximum of these properties:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let scrollHeight = Math.max(
  document.body.scrollHeight, document.documentElement.scrollHeight,
  document.body.offsetHeight, document.documentElement.offsetHeight,
  document.body.clientHeight, document.documentElement.clientHeight
);

alert('Full document height, with scrolled out part: ' + scrollHeight);</code></pre>
        </div>
      </div>
      
      </div><p>Why so? Better don't ask. These inconsistencies come from ancient times, not a “smart” logic.</p>
<h2 id="chapter-661">
Get the current scroll</h2>
<p>Regular elements have their current scroll state in <code>elem.scrollLeft/scrollTop</code>.</p>
<p>What's with the page? Most browsers provide <code>documentElement.scrollLeft/Top</code> for the document scroll, but Chrome/Safari/Opera have bugs (like 
<a href="https://code.google.com/p/chromium/issues/detail?id=157855">157855</a>, 
<a href="https://bugs.webkit.org/show_bug.cgi?id=106133">106133</a>) and we should use  <code>document.body</code> instead of <code>document.documentElement</code> there.</p>
<p>Luckily, we don't have to remember these peculiarities at all, because of the special properties <code>window.pageXOffset/pageYOffset</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('Current scroll from the top: ' + window.pageYOffset);
alert('Current scroll from the left: ' + window.pageXOffset);</code></pre>
        </div>
      </div>
      
      </div><p>These properties are read-only.</p>
<h2 id="chapter-662">
Scrolling: scrollTo, scrollBy, scrollIntoView</h2>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Important:</span></div>
            <div class="important__content"><p>To scroll the page from JavaScript, its DOM must be fully built.</p>
<p>For instance, if we try to scroll the page from the script in <code>&lt;head&gt;</code>, it won't work.</p>
</div></div>
<p>Regular elements can be scrolled by changing <code>scrollTop/scrollLeft</code>.</p>
<p>We can do the same for the page:</p>
<ul>
<li>For all browsers except Chrome/Safari/Opera: modify  <code>document.documentElement.scrollTop/Left</code>.</li>
<li>In Chrome/Safari/Opera: use <code>document.body.scrollTop/Left</code> instead.</li>
</ul>
<p>It should work, but smells like cross-browser incompatibilities. Not good. Fortunately, there's a simpler, more universal solution: special methods  
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollBy">window.scrollBy(x,y)</a> and 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollTo">window.scrollTo(pageX,pageY)</a>.</p>
<ul>
<li>
<p>The method <code>scrollBy(x,y)</code> scrolls the page relative to its current position. For instance, <code>scrollBy(0,10)</code> scrolls the page <code>10px</code> down.</p>
<p>The button below demonstrates this:</p>
<p><button onclick="window.scrollBy(0,10)">window.scrollBy(0,10)</button>
</p>
</li>
<li>
<p>The method <code>scrollTo(pageX,pageY)</code> scrolls the page relative to the document top-left corner. It's like setting <code>scrollLeft/scrollTop</code>.</p>
<p>To scroll to the very beginning, we can use <code>scrollTo(0,0)</code>.</p>
<p><button onclick="window.scrollTo(0,0)">window.scrollTo(0,0)</button>
</p>
</li>
</ul>
<p>These methods work for all browsers the same way.</p>
<h2 id="chapter-663">
scrollIntoView</h2>
<p>For completeness, let's cover one more method:  
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView">elem.scrollIntoView(top)</a>.</p>
<p>The call to <code>elem.scrollIntoView(top)</code> scrolls the page to make <code>elem</code> visible. It has one argument:</p>
<ul>
<li>if <code>top=true</code> (that's the default), then the page will be scrolled to make <code>elem</code> appear on the top of the window. The upper edge of the element is aligned with the window top.</li>
<li>if <code>top=false</code>, then the page scrolls to make <code>elem</code> appear at the bottom. The bottom edge of the element is aligned with the window bottom.</li>
</ul>
<p>The button below scrolls the page to make itself show at the window top:</p>
<p><button onclick="this.scrollIntoView()">this.scrollIntoView()</button>
</p>
<p>And this button scrolls the page to show it at the bottom:</p>
<p><button onclick="this.scrollIntoView(false)">this.scrollIntoView(false)</button>
</p>
<h2 id="chapter-664">
Forbid the scrolling</h2>
<p>Sometimes we need to make the document “unscrollable”. For instance, when we need to cover it with a large message requiring immediate attention, and we want the visitor to interact with that message, not with the document.</p>
<p>To make the document unscrollable, its enough to set <code>document.body.style.overflow = "hidden"</code>. The page will freeze on its current scroll.</p>
<p>Try it:</p>
<p><button onclick="document.body.style.overflow = 'hidden'"><code>document.body.style.overflow = 'hidden'</code></button>
</p>
<p><button onclick="document.body.style.overflow = ''"><code>document.body.style.overflow = ''</code></button>
</p>
<p>The first button freezes the scroll, the second one resumes it.</p>
<p>We can use the same technique to “freeze” the scroll for other elements, not just for <code>document.body</code>.</p>
<p>The drawback of the method is that the scrollbar disappears. If it occupied some space, then that space is now free, and the content “jumps” to fill it.</p>
<p>That looks a bit odd, but can be worked around if we compare <code>clientWidth</code> before and after the freeze, and if it increased (the scrollbar disappeared) then add <code>padding</code> to <code>document.body</code> in place of the scrollbar, to keep the content width same.</p>
<h2 id="chapter-665">
Summary</h2>
<p>Geometry:</p>
<ul>
<li>
<p>Width/height of the visible part of the document (content area width/height): <code>document.documentElement.clientWidth/Height</code></p>
</li>
<li>
<p>Width/height of the whole document, with the scrolled out part:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let scrollHeight = Math.max(
  document.body.scrollHeight, document.documentElement.scrollHeight,
  document.body.offsetHeight, document.documentElement.offsetHeight,
  document.body.clientHeight, document.documentElement.clientHeight
);</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<p>Scrolling:</p>
<ul>
<li>
<p>Read the current scroll: <code>window.pageYOffset/pageXOffset</code>.</p>
</li>
<li>
<p>Change the current scroll:</p>
<ul>
<li><code>window.scrollTo(pageX,pageY)</code> – absolute coordinates,</li>
<li><code>window.scrollBy(x,y)</code> – scroll relative the current place,</li>
<li><code>elem.scrollIntoView(top)</code> – scroll to make <code>elem</code> visible (align with the top/bottom of the window).</li>
</ul>
</li>
</ul>
  document.getElementById('coords-show-mark').onclick = function() {
    let elem = document.getElementById("coords-show-mark");

    function createMessageUnder(elem, text) {
      let coords = elem.getBoundingClientRect();
      let message = document.createElement('div');
      message.style.cssText = "position:fixed; color: red";

      message.style.left = coords.left + "px";
      message.style.top = coords.bottom + "px";

      message.innerHTML = text;

      return message;
    }

    let message = createMessageUnder(elem, 'Hello, world!');
    document.body.append(message);
    setTimeout(() =&gt; message.remove(), 5000);
  }

});





<h6 id="chapter-666"></h6>
<h1 class="main__header-title" id="chapter-667">Coordinates</h1>
<p>To move elements around we should be familiar with coordinates.</p>
<p>Most JavaScript methods deal with one of two coordinate systems:</p>
<ol>
<li>Relative to the window(or another viewport) top/left.</li>
<li>Relative to the document top/left.</li>
</ol>
<p>It's important to understand the difference and which type is where.</p>


<h2 id="chapter-668">
Window coordinates: getBoundingClientRect</h2>
<p>Window coordinates start at the left-upper corner of the window.</p>
<p>The method <code>elem.getBoundingClientRect()</code> returns window coordinates for <code>elem</code> as an object with properties:</p>
<ul>
<li><code>top</code> – Y-coordinate for the top element edge,</li>
<li><code>left</code> – X-coordinate for the left element edge,</li>
<li><code>right</code> – X-coordinate for the right element edge,</li>
<li><code>bottom</code> – Y-coordinate for the bottom element edge.</li>
</ul>
<p>Like this:</p>
      <img src="http://javascript.info/article/coordinates/coords.png">
<p>Window coordinates do not take the scrolled out part of the document into account, they are calculated from the window left-upper corner.</p>
<p>In other words, when we scroll the page, the element goes up or down, <em>its window coordinates change</em>. That's very important.</p>
<p>Click the button to see its window coordinates:</p>
<input id="brTest" type="button" value="Show button.getBoundingClientRect() for this button" onclick="showRect(this)">
<script>
function showRect(elem) {
  let r = elem.getBoundingClientRect();
  alert("{top:"+r.top+", left:"+r.left+", right:"+r.right+", bottom:"+ r.bottom + "}");
}
</script>
<p>If you scroll the page, the button position changes, and window coordinates as well.</p>
<p>Also:</p>
<ul>
<li>Coordinates may be decimal fractions. That's normal, internally browser uses them for calculations. We don't have to round them when setting to <code>style.position.left/top</code>, the browser is fine with fractions.</li>
<li>Coordinates may be negative. For instance, if the page is scrolled down and the <code>elem</code> top is now above the window then <code>elem.getBoundingClientRect().top</code> is negative.</li>
<li>Some browsers (like Chrome) also add to the result <code>getBoundingClientRect</code> properties <code>width</code> and <code>height</code>. We can get them also by subtraction: <code>height=bottom-top</code>, <code>width=right-left</code>.</li>
</ul>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Coordinates right/bottom are different from CSS properties</span></div>
            <div class="important__content"><p>If we compare window coordinates versus CSS positioning, then there are obvious similarities to <code>position:fixed</code> – also the position relative to the viewport.</p>
<p>But in CSS the <code>right</code> property means the distance from the right edge, and the <code>bottom</code> – from the bottom edge.</p>
<p>If we just look at the picture below, we can see that in JavaScript it is not so. All window coordinates are counted from the upper-left corner, including these ones.</p>
</div></div>
<h2 id="chapter-669">
elementFromPoint(x, y)</h2>
<p>The call to <code>document.elementFromPoint(x, y)</code> returns the most nested element at window coordinates <code>(x, y)</code>.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let elem = document.elementFromPoint(x, y);</code></pre>
        </div>
      </div>
      
      </div><p>For instance, the code below highlights and outputs the tag of the element that is now in the middle of the window:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let centerX = document.documentElement.clientWidth / 2;
let centerY = document.documentElement.clientHeight / 2;

let elem = document.elementFromPoint(centerX, centerY);

elem.style.background = "red";
alert(elem.tagName);</code></pre>
        </div>
      </div>
      
      </div><p>As it uses window coordinates, the element may be different depending on the current scroll position.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">For out-of-window coordinates the <code>elementFromPoint</code> returns <code>null</code></span></div>
            <div class="important__content"><p>The method <code>document.elementFromPoint(x,y)</code> only works if <code>(x,y)</code> are inside the visible area.</p>
<p>If any of the coordinates is negative or exceeds the window width/height, then it returns <code>null</code>.</p>
<p>In most cases such behavior is not a problem, but we should keep that in mind.</p>
<p>Here's a typical error that may occur if we don't check for it:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let elem = document.elementFromPoint(x, y);
// if the coordinates happen to be out of the window, then elem = null
elem.style.background = ''; // Error!</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-670">
Using for position:fixed</h2>
<p>Most of time we need coordinates to position something. In CSS, to position an element relative to the viewport we use <code>position:fixed</code> together with <code>left/top</code> (or <code>right/bottom</code>).</p>
<p>We can use <code>getBoundingClientRect</code> to get coordinates of an element, and then to show something near it.</p>
<p>For instance, the function <code>createMessageUnder(elem, html)</code> below shows the message under <code>elem</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-12">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let elem = document.getElementById("coords-show-mark");

function createMessageUnder(elem, html) {
  // create message element
  let message = document.createElement('div');
  // better to use a css class for the style here
  message.style.cssText = "position:fixed; color: red";

  // assign coordinates, don't forget "px"!
  let coords = elem.getBoundingClientRect();

  message.style.left = coords.left + "px";
  message.style.top = coords.bottom + "px";

  message.innerHTML = html;

  return message;
}

// Usage:
// add it for 5 seconds in the document
let message = createMessageUnder(elem, 'Hello, world!');
document.body.append(message);
setTimeout(() =&gt; message.remove(), 5000);</code></pre>
        </div>
      </div>
      
      </div><p>Click the button to run it:</p>
<p><button id="coords-show-mark">Button with id=“coords-show-mark”, the message will appear under it</button>
</p>
<p>The code can be modified to show the message at the left, right, below, apply CSS animations to “fade it in” and so on. That's easy, as we have all the coordinates and sizes of the element.</p>
<p>But note the important detail: when the page is scrolled, the message flows away from the button.</p>
<p>The reason is obvious: the message element relies on <code>position:fixed</code>, so it remains at the same place of the window while the page scrolls away.</p>
<p>To change that, we need to use document-based coordinates and <code>position:absolute</code>.</p>
<h2 id="chapter-671">
Document coordinates</h2>
<p>Document-relative coordinates start from the left-upper corner of the document, not the window.</p>
<p>In CSS, window coordinates correspond to <code>position:fixed</code>, while document coordinates are similar to <code>position:absolute</code> on top.</p>
<p>We can use <code>position:absolute</code> and <code>top/left</code> to put something at a certain place of the document, so that it remains there during a page scroll. But we need the right coordinates first.</p>
<p>For clarity we'll call window coordinates <code>(clientX,clientY)</code> and document coordinates <code>(pageX,pageY)</code>.</p>
<p>When the page is not scrolled, then window coordinate and document coordinates are actually the same. Their zero points match too:</p>
      <img src="http://javascript.info/article/coordinates/document-window-coordinates-zero.png">
<p>And if we scroll it, then <code>(clientX,clientY)</code> change, because they are relative to the window, but <code>(pageX,pageY)</code> remain the same.</p>
<p>Here's the same page after the vertical scroll:</p>
      <img src="http://javascript.info/article/coordinates/document-window-coordinates-scroll.png">
<ul>
<li><code>clientY</code> of the header <code>"From today's featured article"</code> became <code>0</code>, because the element is now on window top.</li>
<li><code>clientX</code> didn't change, as we didn't scroll horizontally.</li>
<li><code>pageX</code> and <code>pageY</code> coordinates of the element are still the same, because they are relative to the document.</li>
</ul>
<h2 id="chapter-672">
Getting document coordinates</h2>
<p>There's no standard method to get document coordinates of an element. But it's easy to write it.</p>
<p>The two coordinate systems are connected by the formula:</p>
<ul>
<li><code>pageY</code> = <code>clientY</code> + height of the scrolled-out vertical part of the document.</li>
<li><code>pageX</code> = <code>clientX</code> + width of the scrolled-out horizontal part of the document.</li>
</ul>
<p>The function <code>getCoords(elem)</code> will take window coordinates from <code>elem.getBoundingClientRect()</code> and add the current scroll to them:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// get document coordinates of the element
function getCoords(elem) {
  let box = elem.getBoundingClientRect();

  return {
    top: box.top + pageYOffset,
    left: box.left + pageXOffset
  };
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-673">
Summary</h2>
<p>Any point on the page has coordinates:</p>
<ol>
<li>Relative to the window – <code>elem.getBoundingClientRect()</code>.</li>
<li>Relative to the document – <code>elem.getBoundingClientRect()</code> plus the current page scroll.</li>
</ol>
<p>Window coordinates are great to use with <code>position:fixed</code>, and document coordinates do well with <code>position:absolute</code>.</p>
<p>Both coordinate systems have their “pro” and “contra”, there are times we need one or the other one, just like CSS <code>position</code> <code>absolute</code> and <code>fixed</code>.</p>
<div class="tasks"><h2 id="chapter-674" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-window-coordinates-of-the-field" name="find-window-coordinates-of-the-field" class="main__anchor">Find window coordinates of the field</a></h3>
<a href="http://javascript.info/task/find-point-coordinates" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>In the iframe below you can see a document with the green “field”.</p>
<p>Use JavaScript to find window coordinates of corners pointed by with arrows.</p>
<p>There's a small feature implemented in the document for convenience. A click at any place shows coordinates there.</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/task/find-point-coordinates/source/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      <div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/Z4AOmZkrTrtxj2vU1UCc?p=preview" target="_blank" title="open in sandbox" data-plunk-id="Z4AOmZkrTrtxj2vU1UCc" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:360px" src="https://en.js.cx/task/find-point-coordinates/source/"></iframe>
  </div><p>Your code should use DOM to get window coordinates of:</p>
<ol>
<li>Left-upper outer corner (that's simple).</li>
<li>Right-bottom outer corner (simple too).</li>
<li>Left-upper inner corner (a bit harder).</li>
<li>Right-bottom inner corner (there are several ways, choose one).</li>
</ol>
<p>The coordinates that you calculate should be the same as those returned by the mouse click.</p>
<p>P.S. The code should also work if the element has another size or border, not bound to any fixed values.</p>
<p>
<a href="http://plnkr.co/edit/Z4AOmZkrTrtxj2vU1UCc?p=preview" target="_blank" data-plunk-id="Z4AOmZkrTrtxj2vU1UCc">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Outer corners</button>
<div class="task__answer-content"><h4 class="task__step-title">Outer corners</h4><p>Outer corners are basically what we get from  
<a href="https://developer.mozilla.org/en-US/docs/DOM/element.getBoundingClientRect">elem.getBoundingClientRect()</a>.</p>
<p>Coordinates of the upper-left corner <code>answer1</code> and the bottom-right corner <code>answer2</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let coords = elem.getBoundingClientRect();

let answer1 = [coords.left, coords.top];
let answer2 = [coords.right, coords.bottom];</code></pre>
        </div>
      </div>
      
      </div></div></div><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Left-upper inner corner</button>
<div class="task__answer-content"><h4 class="task__step-title">Left-upper inner corner</h4><p>That differs from the outer corner by the border width. A reliable way to get the distance is <code>clientLeft/clientTop</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let answer3 = [coords.left + field.clientLeft, coords.top + field.clientTop];</code></pre>
        </div>
      </div>
      
      </div></div></div><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Right-bottom inner corner</button>
<div class="task__answer-content"><h4 class="task__step-title">Right-bottom inner corner</h4><p>In our case we need to substract the border size from the outer coordinates.</p>
<p>We could use CSS way:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let answer4 = [
  coords.right - parseInt(getComputedStyle(field).borderRightWidth),
  coords.bottom - parseInt(getComputedStyle(field).borderBottomWidth)
];</code></pre>
        </div>
      </div>
      
      </div><p>An alternative way would be to add <code>clientWidth/clientHeight</code> to coordinates of the left-upper corner. That's probably even better:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let answer4 = [
  coords.left + elem.clientLeft + elem.clientWidth,
  coords.top + elem.clientTop + elem.clientHeight
];</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/rBWwVfrtgA6KVXl39rCa?p=preview" target="_blank" data-plunk-id="rBWwVfrtgA6KVXl39rCa">Open the solution in the sandbox.</a></p></div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#show-a-note-near-the-element" name="show-a-note-near-the-element" class="main__anchor">Show a note near the element</a></h3>
<a href="http://javascript.info/task/position-at" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a function <code>positionAt(anchor, position, elem)</code> that positions <code>elem</code>, depending on  <code>position</code> either at the top (<code>"top"</code>), right (<code>"right"</code>) or bottom (<code>"bottom"</code>) of the element <code>anchor</code>.</p>
<p>Use it to make a function <code>showNote(anchor, position, html)</code> that shows an element with the class <code>"note"</code> and the text <code>html</code> at the given position near the anchor.</p>
<p>Show the notes like here:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/task/position-at/solution/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:350px" src="https://en.js.cx/task/position-at/solution/"></iframe>
  </div><p>P.S. The note should have <code>position:fixed</code> for this task.</p>
<p>
<a href="http://plnkr.co/edit/VUhlzjCvXKIcpO0pLqTt?p=preview" target="_blank" data-plunk-id="VUhlzjCvXKIcpO0pLqTt">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>In this task we only need to accuracely calculate the coorindates. See the code for details.</p>
<p>Please note: the elements must be in the document to read <code>offsetHeight</code> and other properties.
A hidden (<code>display:none</code>) or out of the document element has no size.</p>
<p>
<a href="http://plnkr.co/edit/AMifUda4L7YbBjnkIIFp?p=preview" target="_blank" data-plunk-id="AMifUda4L7YbBjnkIIFp">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#show-a-note-near-the-element-absolute" name="show-a-note-near-the-element-absolute" class="main__anchor">Show a note near the element (absolute)</a></h3>
<a href="http://javascript.info/task/position-at-absolute" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Modify the solution of the 
<a href="http://javascript.info/task/position-at">previous task</a> so that the note uses <code>position:absolute</code> instead of <code>position:fixed</code>.</p>
<p>That will prevent its “runaway” from the element when the page scrolls.</p>
<p>Take the solution of that task as a starting point. To test the scroll, add the style <code>&lt;body style="height: 2000px"&gt;</code>.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution is actually pretty simple:</p>
<ul>
<li>Use <code>position:absolute</code> in CSS instead of <code>position:fixed</code> for <code>.note</code>.</li>
<li>Use the function 
<a href="http://javascript.info/coordinates#getCoords">getCoords()</a> from the chapter 
<a href="http://javascript.info/coordinates">Coordinates</a> to get document-relative coordinates.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/Ef7IUJWaM6jFLb8z8hXX?p=preview" target="_blank" data-plunk-id="Ef7IUJWaM6jFLb8z8hXX">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#position-the-note-inside-absolute" name="position-the-note-inside-absolute" class="main__anchor">Position the note inside (absolute)</a></h3>
<a href="http://javascript.info/task/position-inside-absolute" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Extend the previous task 
<a href="http://javascript.info/task/position-at-absolute">Show a note near the element (absolute)</a>: teach the function  <code>positionAt(anchor, position, elem)</code> to insert <code>elem</code> inside the <code>anchor</code>.</p>
<p>New values for <code>position</code>:</p>
<ul>
<li><code>top-out</code>, <code>right-out</code>, <code>bottom-out</code> – work the same as before, they insert the <code>elem</code> over/right/under <code>anchor</code>.</li>
<li><code>top-in</code>, <code>right-in</code>, <code>bottom-in</code> – insert <code>elem</code> inside the <code>anchor</code>: stick it to the upper/right/bottom edge.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// shows the note above blockquote
positionAt(blockquote, "top-out", note);

// shows the note inside blockquote, at the top
positionAt(blockquote, "top-in", note);</code></pre>
        </div>
      </div>
      
      </div><p>The result:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/task/position-inside-absolute/solution/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:310px" src="https://en.js.cx/task/position-inside-absolute/solution/"></iframe>
  </div><p>As the source code, take the solution of the task 
<a href="http://javascript.info/task/position-at-absolute">Show a note near the element (absolute)</a>.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/SUoT1fKe1gKnOTAmo5uo?p=preview" target="_blank" data-plunk-id="SUoT1fKe1gKnOTAmo5uo">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-675"></h6>
<h1 class="main__header-title" id="chapter-676">Introduction into Events</h1>
<p>An introduction to browser events, event properties and handling patterns.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/introduction-browser-events" class="lessons-list__link">Introduction to browser events</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/bubbling-and-capturing" class="lessons-list__link">Bubbling and capturing</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/event-delegation" class="lessons-list__link">Event delegation</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/default-browser-action" class="lessons-list__link">Browser default actions</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/dispatch-events" class="lessons-list__link">Dispatching custom events</a></li></ol></div>


<h6 id="chapter-677"></h6>
<h1 class="main__header-title" id="chapter-678">Introduction to browser events</h1>
<p><em>An event</em> is a signal that something has happened. All DOM nodes generate such signals (but events are not limited to DOM).</p>


<p>Here's a list of the most useful DOM events, just to take a look at:</p>
<p><strong>Mouse events:</strong></p>
<ul>
<li><code>click</code> – when the mouse clicks on an element (touchscreen devices generate it on a tap).</li>
<li><code>contextmenu</code> – when the mouse right-clicks on an element.</li>
<li><code>mouseover</code> / <code>mouseout</code> – when the mouse cursor comes over / leaves an element.</li>
<li><code>mousedown</code> / <code>mouseup</code> – when the mouse button is pressed / released over an element.</li>
<li><code>mousemove</code> – when the mouse is moved.</li>
</ul>
<p><strong>Form element events:</strong></p>
<ul>
<li><code>submit</code> – when the visitor submits a <code>&lt;form&gt;</code>.</li>
<li><code>focus</code> –  when the visitor focuses on an element, e.g. on an <code>&lt;input&gt;</code>.</li>
</ul>
<p><strong>Keyboard events:</strong></p>
<ul>
<li><code>keydown</code> and <code>keyup</code> – when the visitor presses and then releases the button.</li>
</ul>
<p><strong>Document events</strong></p>
<ul>
<li><code>DOMContentLoaded</code> – when the HTML is loaded and processed, DOM is fully built.</li>
</ul>
<p><strong>CSS events:</strong></p>
<ul>
<li><code>transitionend</code> – when a CSS-animation finishes.</li>
</ul>
<p>There are many other events. We'll get into more details of particular events in next chapters.</p>
<h2 id="chapter-679">
Event handlers</h2>
<p>To react on events we can assign a <em>handler</em> – a function that runs in case of an event.</p>
<p>Handlers is a way to run JavaScript code in case of user actions.</p>
<p>There are several ways to assign a handler. Let's see them, starting from the simplest one.</p>
<h3>
HTML-attribute</a></h3><p>A handler can be set in HTML with an attribute named <code>on&lt;event&gt;</code>.</p>
<p>For instance, to assign a <code>click</code> handler for an <code>input</code>, we can use <code>onclick</code>, like here:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:24-49">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input value="Click me" onclick="alert('Click!')" type="button"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>On mouse click, the code inside <code>onclick</code> runs.</p>
<p>Please note that inside <code>onclick</code> we use single quotes, because the attribute itself is in double quotes. If we forget that the code is inside the attribute and use double quotes inside, like this:  <code>onclick="alert("Click!")"</code>, then it won't work right.</p>
<p>An HTML-attribute is not a convenient place to write a lot of code, so we'd better create a JavaScript function and call it there.</p>
<p>Here a click runs the function <code>countRabbits()</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true" data-highlight-inline="8:21-45">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  function countRabbits() {
    for(let i=1; i&lt;=3; i++) {
      alert("Rabbit number " + i);
    }
  }
&lt;/script&gt;

&lt;input type="button" onclick="countRabbits()" value="Count rabbits!"&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-321rx2" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>As we know, HTML attribute names are not case-sensitive, so <code>ONCLICK</code> works as well as <code>onClick</code> and <code>onCLICK</code>… But usually attributes are lowercased: <code>onclick</code>.</p>
<h3>
DOM property</a></h3><p>We can assign a handler using a DOM property <code>on&lt;event&gt;</code>.</p>
<p>For instance, <code>elem.onclick</code>:</p>
<div data-trusted="1" class="code-example" data-autorun="true" data-highlight-block="2-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input id="elem" type="button" value="Click me"&gt;
&lt;script&gt;
  elem.onclick = function() {
    alert('Thank you');
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-8wa3c4" style="height:200px" src="about:blank"></iframe>
      </div>
      </div><p>If the handler is assigned using an HTML-attribute then the browser reads it, creates a new function from the attribute content and writes it to the DOM property.</p>
<p>So this way is actually the same as the previous one.</p>
<p><strong>The handler is always in the DOM property: the HTML-attribute is just one of the ways to initialize it.</strong></p>
<p>These two code pieces work the same:</p>
<ol>
<li>
<p>Only HTML:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true" data-highlight-inline="0:21-46">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="button" onclick="alert('Click!')" value="Button"&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-dbicp8" style="height:50px" src="about:blank"></iframe>
      </div>
      </div></li>
<li>
<p>HTML + JS:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true" data-highlight-block="2-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="button" id="button" value="Button"&gt;
&lt;script&gt;
  button.onclick = function() {
    alert('Click!');
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-6hq6lx" style="height:50px" src="about:blank"></iframe>
      </div>
      </div></li>
</ol>
<p><strong>As there's only one <code>onclick</code> property, we can't assign more than one event handler.</strong></p>
<p>In the example below adding a handler with JavaScript overwrites the existing handler:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true" data-highlight-block="2-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="button" id="elem" onclick="alert('Before')" value="Click me"&gt;
&lt;script&gt;
  elem.onclick = function() { // overwrites the existing handler
    alert('After'); // only this will be shown
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-hopir" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>By the way, we can assign an existing function as a handler directly:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayThanks() {
  alert('Thanks!');
}

elem.onclick = sayThanks;</code></pre>
        </div>
      </div>
      
      </div><p>To remove a handler – assign <code>elem.onclick = null</code>.</p>
<h2 id="chapter-680">
Accessing the element: this</h2>
<p>The value of <code>this</code> inside a handler is the element. The one which has the handler on it.</p>
<p>In the code below <code>button</code> shows its contents using <code>this.innerHTML</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button onclick="alert(this.innerHTML)"&gt;Click me&lt;/button&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-3ayc5j" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><h2 id="chapter-681">
Possible mistakes</h2>
<p>If you're starting to work with event – please note some subtleties.</p>
<p><strong>The function should be assigned as <code>sayThanks</code>, not <code>sayThanks()</code>.</strong></p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// right
button.onclick = sayThanks;

// wrong
button.onclick = sayThanks();</code></pre>
        </div>
      </div>
      
      </div><p>If we add brackets, then <code>sayThanks()</code> –  will be the <em>result</em> of the function execution, so <code>onclick</code> in the last code becomes <code>undefined</code> (the function returns nothing). That won't work.</p>
<p>…But in the markup we do need the brackets:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="button" id="button" onclick="sayThanks()"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The difference is easy to explain. When the browser reads the attribute, it creates a handler function with the body from its content.</p>
<p>So the last example is the same as:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">button.onclick = function() {
  sayThanks(); // the attribute content
};</code></pre>
        </div>
      </div>
      
      </div><p><strong>Use functions, not strings.</strong></p>
<p>The assignment <code>elem.onclick = "alert(1)"</code> would work too. It works for compatibility reasons, but strongly not recommended.</p>
<p><strong>Don't use <code>setAttribute</code> for handlers.</strong></p>
<p>Such a call won't work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// a click on &lt;body&gt; will generate errors,
// because attributes are always strings, function becomes a string
document.body.setAttribute('onclick', function() { alert(1) });</code></pre>
        </div>
      </div>
      
      </div><p><strong>DOM-property case matters.</strong></p>
<p>Assign a handler to <code>elem.onclick</code>, not <code>elem.ONCLICK</code>, because DOM properties are case-sensitive.</p>
<h2 id="chapter-682">
addEventListener</h2>
<p>The fundamental problem of the aforementioned ways to assign handlers – we can't assign multiple handlers to one event.</p>
<p>For instance, one part of our code wants to highlight a button on click, and another one wants to show a message.</p>
<p>We'd like to assign two event handlers for that. But a new DOM property will overwrite the existing one:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">input.onclick = function() { alert(1); }
// ...
input.onclick = function() { alert(2); } // replaces the previous handler</code></pre>
        </div>
      </div>
      
      </div><p>Web-standard developers understood that long ago and suggested an alternative way of managing handlers using special methods <code>addEventListener</code> and <code>removeEventListener</code>. They are free of such a problem.</p>
<p>The syntax to add a handler:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">element.addEventListener(event, handler[, phase]);</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt><code>event</code></dt>
<dd>Event name, e.g. <code>"click"</code>.</dd>
<dt><code>handler</code></dt>
<dd>The handler function.</dd>
<dt><code>phase</code></dt>
<dd>An optional argument, the “phase” for the handler to work. To be covered later. Usually we don't use it.</dd>
</dl>
<p>To remove the handler, use <code>removeEventListener</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// exactly the same arguments as addEventListener
element.removeEventListener(event, handler[, phase]);</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Removal requires the same function</span></div>
            <div class="important__content"><p>To remove a handler we should pass exactly the same function as was assigned.</p>
<p>That doesn't work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">elem.addEventListener( "click" , () =&gt; alert('Thanks!'));
// ....
elem.removeEventListener( "click", () =&gt; alert('Thanks!'));</code></pre>
        </div>
      </div>
      
      </div><p>The handler won't be removed, because <code>removeEventListener</code> gets another function – with the same code, but that doesn't matter.</p>
<p>Here's the right way:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function handler() {
  alert( 'Thanks!' );
}

input.addEventListener("click", handler);
// ....
input.removeEventListener("click", handler);</code></pre>
        </div>
      </div>
      
      </div><p>Please note – if we don't store the function in a variable, then we can't remove it. There's no way to “read back” handlers assigned by <code>addEventListener</code>.</p>
</div></div>
<p>Multiple calls to <code>addEventListener</code> allow to add multiple handlers, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="11-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input id="elem" type="button" value="Click me"/&gt;

&lt;script&gt;
  function handler1() {
    alert('Thanks!');
  };

  function handler2() {
    alert('Thanks again!');
  }

  elem.onclick = () =&gt; alert("Hello");
  elem.addEventListener("click", handler1); // Thanks!
  elem.addEventListener("click", handler2); // Thanks again!
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>As we can see in the example above, we can set handlers <em>both</em> using a DOM-property and <code>addEventListener</code>. But generally we use only one of these ways.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">For some events handlers only work with <code>addEventListener</code></span></div>
            <div class="important__content"><p>There exist events that can't be assigned via a DOM-property. Must use <code>addEventListener</code>.</p>
<p>For instance, the event <code>transitionend</code> (CSS animation finished) is like that.</p>
<p>Try the code below. In most browsers only the second handler works, not the first one.</p>
<div data-trusted="1" class="code-example" data-highlight-block="18-20">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  input {
    transition: width 1s;
    width: 100px;
  }

  .wide {
    width: 300px;
  }
&lt;/style&gt;

&lt;input type="button" id="elem" onclick="this.classList.toggle('wide')" value="Click me"&gt;

&lt;script&gt;
  elem.ontransitionend = function() {
    alert("DOM property"); // doesn't work
  };

  elem.addEventListener("transitionend", function() {
    alert("addEventListener"); // shows up when the animation finishes
  });
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-683">
Event object</h2>
<p>To properly handle an event we'd want to know more about what's happened. Not just a “click” or a “keypress”, but what were the pointer coordinates? Which key was pressed? And so on.</p>
<p>When an event happens, the browser creates an <em>event object</em>, puts details into it and passes it as an argument to the handler.</p>
<p>Here's an example of getting mouse coordinates from the event object:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:26-31">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="button" value="Click me" id="elem"&gt;

&lt;script&gt;
  elem.onclick = function(event) {
    // show event type, element and coordinates of the click
    alert(event.type + " at " + event.currentTarget);
    alert("Coordinates: " + event.clientX + ":" + event.clientY);
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Some properties of <code>event</code> object:</p>
<dl>
<dt><code>event.type</code></dt>
<dd>Event type, here it's <code>"click"</code>.</dd>
<dt><code>event.currentTarget</code></dt>
<dd>Element that handled the event. That's exactly the same as <code>this</code>, unless you bind <code>this</code> to something else, and then <code>event.currentTarget</code> becomes useful.</dd>
<dt><code>event.clientX / event.clientY</code></dt>
<dd>Window-relative coordinates of the cursor, for mouse events.</dd>
</dl>
<p>There are more properties. They depend on the event type, so we'll study them later when come to different events in details.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The event object is also accessible from HTML</span></div>
            <div class="important__content"><p>If we assign a handler in HTML, we can also use the <code>event</code> object, like this:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true" data-highlight-inline="0:30-47">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="button" onclick="alert(event.type)" value="Event type"&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-en4hgo" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>That's possible because when the browser reads the attribute, it creates a handler like this:  <code>function(event) { alert(event.type) }</code>. That is: its first argument is called <code>"event"</code>, and the body is taken from the attribute.</p>
</div></div>
<h2 id="chapter-684">
Object handlers: handleEvent</h2>
<p>We can assign an object as an event handler using <code>addEventListener</code>. When an event occurs, its <code>handleEvent</code> method is called with it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="elem"&gt;Click me&lt;/button&gt;

&lt;script&gt;
  elem.addEventListener('click', {
    handleEvent(event) {
      alert(event.type + " at " + event.currentTarget);
    }
  });
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>In other words, when <code>addEventListener</code> receives an object as the handler, it calls <code>object.handleEvent(event)</code> in case of an event.</p>
<p>We could also use a class for that:</p>
<div data-trusted="1" class="code-example" data-highlight-block="16-18">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="elem"&gt;Click me&lt;/button&gt;

&lt;script&gt;
  class Menu {
    handleEvent(event) {
      switch(event.type) {
        case 'mousedown':
          elem.innerHTML = "Mouse button pressed";
          break;
        case 'mouseup':
          elem.innerHTML += "...and released.";
          break;
      }
    }
  }

  let menu = new Menu();
  elem.addEventListener('mousedown', menu);
  elem.addEventListener('mouseup', menu);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Here the same object handles both events. Please note that we need to explicitly setup the events to listen using <code>addEventListener</code>. The <code>menu</code> object only gets <code>mousedown</code> and <code>mouseup</code> here, not any other types of events.</p>
<p>The method <code>handleEvent</code> does not have to do all the job by itself. It can call other event-specific methods instead, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="elem"&gt;Click me&lt;/button&gt;

&lt;script&gt;
  class Menu {
    handleEvent(event) {
      // mousedown -&gt; onMousedown
      let method = 'on' + event.type[0].toUpperCase() + event.type.slice(1);
      this[method](event);
    }

    onMousedown() {
      elem.innerHTML = "Mouse button pressed";
    }

    onMouseup() {
      elem.innerHTML += "...and released.";
    }
  }

  let menu = new Menu();
  elem.addEventListener('mousedown', menu);
  elem.addEventListener('mouseup', menu);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Now event handlers are clearly separated, that may be easier to support.</p>
<h2 id="chapter-685">
Summary</h2>
<p>There are 3 ways to assign event handlers:</p>
<ol>
<li>HTML attribute: <code>onclick="..."</code>.</li>
<li>DOM property: <code>elem.onclick = function</code>.</li>
<li>Methods: <code>elem.addEventListener(event, handler[, phase])</code> to add, <code>removeEventListener</code> to remove.</li>
</ol>
<p>HTML attributes are used sparingly, because JavaScript in the middle of an HTML tag looks a little bit odd and alien. Also can't write lots of code in there.</p>
<p>DOM properties are ok to use, but we can't assign more than one handler of the particular event. In many cases that limitation is not pressing.</p>
<p>The last way is the most flexible, but it is also the longest to write. There are few events that only work with it, for instance <code>transtionend</code> and <code>DOMContentLoaded</code> (to be covered). Also <code>addEventListener</code> supports objects as event handlers. In that case the method <code>handleEvent</code> is called in case of the event.</p>
<p>No matter how you assign the handler – it gets an event object as the first argument. That object contains the details about what's happened.</p>
<p>We'll learn more about events in general and about different types of events in the next chapters.</p>
<div class="tasks"><h2 id="chapter-686" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#hide-on-click" name="hide-on-click" class="main__anchor">Hide on click</a></h3>
<a href="http://javascript.info/task/hide-other" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Add JavaScript to the <code>button</code> to make <code>&lt;div id="text"&gt;</code> disappear when we click it.</p>
<p>The demo:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:80px" src="https://en.js.cx/task/hide-other/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/tknv77Kwr6qfdnuwWY02?p=preview" target="_blank" data-plunk-id="tknv77Kwr6qfdnuwWY02">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/4LUWOEJ98Dsgpjzo8SLg?p=preview" target="_blank" data-plunk-id="4LUWOEJ98Dsgpjzo8SLg">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#hide-self" name="hide-self" class="main__anchor">Hide self</a></h3>
<a href="http://javascript.info/task/hide-self-onclick" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a button that hides itself on click.</p>
<p>Like this:
<input type="button" onclick="this.hidden=true" value="Click to hide"></p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Can use <code>this</code> in the handler to reference “itself” here:</p>
<div data-trusted="1" class="code-example" data-demo-height="50">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="button" onclick="this.hidden=true" value="Click to hide"&gt;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#which-handlers-run" name="which-handlers-run" class="main__anchor">Which handlers run?</a></h3>
<a href="http://javascript.info/task/which-handlers-run" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's a button in the variable. There are no handlers on it.</p>
<p>Which handlers run on click after the following code? Which alerts show up?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">button.addEventListener("click", () =&gt; alert("1"));

button.removeEventListener("click", () =&gt; alert("1"));

button.onclick = () =&gt; alert(2);</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <code>1</code> and <code>2</code>.</p>
<p>The first handler triggers, because it's not removed by <code>removeEventListener</code>. To remove the handler we need to pass exactly the function that was assigned. And in the code a new function is passed, that looks the same, but is still another function.</p>
<p>To remove a function object, we need to store a reference to it, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function handler() {
  alert(1);
}

button.addEventListener("click", handler);
button.removeEventListener("click", handler);</code></pre>
        </div>
      </div>
      
      </div><p>The handler <code>button.onclick</code> works independantly and in addition to <code>addEventListener</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#move-the-ball-across-the-field" name="move-the-ball-across-the-field" class="main__anchor">Move the ball across the field</a></h3>
<a href="http://javascript.info/task/move-ball-field" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Move the ball across the field to a click. Like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/task/move-ball-field/solution/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:260px" src="https://en.js.cx/task/move-ball-field/solution/"></iframe>
  </div><p>Requirements:</p>
<ul>
<li>The ball center should come exactly under the pointer on click (if possible without crossing the field edge).</li>
<li>CSS-animation is welcome.</li>
<li>The ball must not cross field boundaries.</li>
<li>When the page is scrolled, nothing should break.</li>
</ul>
<p>Notes:</p>
<ul>
<li>The code should also work with different ball and field sizes, not be bound to any fixed values.</li>
<li>Use properties <code>event.clientX/event.clientY</code> for click coordinates.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/021wJG1HpUqplMqVAFog?p=preview" target="_blank" data-plunk-id="021wJG1HpUqplMqVAFog">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>First we need to choose a method of positioning the ball.</p>
<p>We can't use <code>position:fixed</code> for it, because scrolling the page would move the ball from the field.</p>
<p>So we should use <code>position:absolute</code> and, to make the positioning really solid, make <code>field</code> itself positioned.</p>
<p>Then the ball will be positioned relatively to the field:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">#field {
  width: 200px;
  height: 150px;
  position: relative;
}

#ball {
  position: absolute;
  left: 0; /* relative to the closest positioned ancestor (field) */
  top: 0;
  transition: 1s all; /* CSS animation for left/top makes the ball fly */
}</code></pre>
        </div>
      </div>
      
      </div><p>Next we need to assign the correct <code>ball.style.position.left/top</code>. They contain field-relative coordinates now.</p>
<p>Here's the picture:</p>
      <img src="http://javascript.info/task/move-ball-field/move-ball-coords.png">
<p>We have <code>event.clientX/clientY</code> – window-relative coordinates of the click.</p>
<p>To get field-relative <code>left</code> coordinate of the click, we can substract the field left edge and the border width:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let left = event.clientX - fieldInnerCoords.left - field.clientLeft;</code></pre>
        </div>
      </div>
      
      </div><p>Normally, <code>ball.style.position.left</code> means the “left edge of the element” (the ball). So if we assign that <code>left</code>, then the ball edge would be under the mouse cursor.</p>
<p>We need to move the ball half-width left and half-height up to make it center.</p>
<p>So the final <code>left</code> would be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let left = event.clientX - fieldInnerCoords.left - field.clientLeft - ball.offsetWidth/2;</code></pre>
        </div>
      </div>
      
      </div><p>The vertical coordinate is calculated using the same logic.</p>
<p>Please note that the ball width/height must be known at the time we access <code>ball.offsetWidth</code>. Should be specified in HTML or CSS.</p>
<p>
<a href="http://plnkr.co/edit/uicFeQ8SWHYctHdiows7?p=preview" target="_blank" data-plunk-id="uicFeQ8SWHYctHdiows7">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#create-a-menu-sliding-menu" name="create-a-menu-sliding-menu" class="main__anchor">Create a menu sliding menu</a></h3>
<a href="http://javascript.info/task/sliding-menu" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a menu that opens/collapses on click:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:100px" src="https://en.js.cx/task/sliding-menu/solution/"></iframe>
  </div><p>P.S. HTML/CSS of the source document is to be modified.</p>
<p>
<a href="http://plnkr.co/edit/2mjXFQwj8xONP6bPhVT4?p=preview" target="_blank" data-plunk-id="2mjXFQwj8xONP6bPhVT4">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">HTML/CSS</button>
<div class="task__answer-content"><h4 class="task__step-title">HTML/CSS</h4><p>First let's create HTML/CSS.</p>
<p>A menu is a standalone graphical component on the page, so its better to put it into a single DOM element.</p>
<p>A list of menu items can be layed out as a list <code>ul/li</code>.</p>
<p>Here's the example structure:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div class="menu"&gt;
  &lt;span class="title"&gt;Sweeties (click me)!&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt;Cake&lt;/li&gt;
    &lt;li&gt;Donut&lt;/li&gt;
    &lt;li&gt;Honey&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;</code></pre>
        </div>
      </div>
      
      </div><p>We use <code>&lt;span&gt;</code> for the title, because <code>&lt;div&gt;</code> has an implicit <code>display:block</code> on it, and it will occupy 100% of the horizontal width.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div style="border: solid red 1px" onclick="alert(1)"&gt;Sweeties (click me)!&lt;/div&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-e38hdj" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>So if we set <code>onclick</code> on it, then it will catch clicks to the right of the text.</p>
<p>…but <code>&lt;span&gt;</code> has an implicit <code>display: inline</code>, so it occupies exactly enough place to fit all the text:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;span style="border: solid red 1px" onclick="alert(1)"&gt;Sweeties (click me)!&lt;/span&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-3ygbfr" style="height:50px" src="about:blank"></iframe>
      </div>
      </div></div></div><div class="task__step task__step_open">
<button type="button" onclick="showStep(this)" class="task__step-show">Toggling the menu</button>
<div class="task__answer-content"><h4 class="task__step-title">Toggling the menu</h4><p>Toggling the menu should change the arrow and show/hide the menu list.</p>
<p>All these changes are perfectly handled by CSS. In JavaScript we should label the current state of the menu by adding/removing the class <code>.open</code>.</p>
<p>Without it, the menu will be closed:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">.menu ul {
  margin: 0;
  list-style: none;
  padding-left: 20px;
  display: none;
}

.menu .title::before {
  content: '▶ ';
  font-size: 80%;
  color: green;
}</code></pre>
        </div>
      </div>
      
      </div><p>…And with <code>.open</code> the arrow changes and the list shows up:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">.menu.open .title::before {
  content: '▼ ';
}

.menu.open ul {
  display: block;
}</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/azLUvqjKgoPmfbjThdaz?p=preview" target="_blank" data-plunk-id="azLUvqjKgoPmfbjThdaz">Open the solution in the sandbox.</a></p></div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#add-a-closing-button" name="add-a-closing-button" class="main__anchor">Add a closing button</a></h3>
<a href="http://javascript.info/task/hide-message" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's a list of messages.</p>
<p>Use JavaScript to add a closing button to the right-upper corner of each message.</p>
<p>The result should look like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:450px" src="https://en.js.cx/task/hide-message/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/kGSW4ZrKom08M8zhPImd?p=preview" target="_blank" data-plunk-id="kGSW4ZrKom08M8zhPImd">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To add the button we can use either <code>position:absolute</code> (and make the pane <code>position:relative</code>) or <code>float:right</code>. The <code>float:right</code> has the benefit that the button never overlaps the text, but <code>position:absolute</code> gives more freedom. So the choice is yours.</p>
<p>Then for each pane the code can be like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">pane.insertAdjacentHTML("afterbegin", '&lt;button class="remove-button"&gt;[x]&lt;/button&gt;');</code></pre>
        </div>
      </div>
      
      </div><p>Then the <code>&lt;button&gt;</code> becomes <code>pane.firstChild</code>, so we can add a handler to it like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">pane.firstChild.onclick = () =&gt; pane.remove();</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/9j74pthW3hCMcrkdgQBs?p=preview" target="_blank" data-plunk-id="9j74pthW3hCMcrkdgQBs">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#carousel" name="carousel" class="main__anchor">Carousel</a></h3>
<a href="http://javascript.info/task/carousel" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Create a “carousel” – a ribbon of images that can be scrolled by clicking on arrows.</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:200px" src="https://en.js.cx/task/carousel/solution/"></iframe>
  </div><p>Later we can add more features to it: infinite scrolling, dynamic loading etc.</p>
<p>P.S. For this task HTML/CSS structure is actually 90% of the solution.</p>
<p>
<a href="http://plnkr.co/edit/A3uHdDcPRwpzDaj4sSVY?p=preview" target="_blank" data-plunk-id="A3uHdDcPRwpzDaj4sSVY">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The images ribbon can be represented as <code>ul/li</code> list of images <code>&lt;img&gt;</code>.</p>
<p>Normally, such a ribbon is wide, but we put a fixed-size <code>&lt;div&gt;</code> around to “cut” it, so that only a part of the ribbon is visibble:</p>
      <img src="http://javascript.info/task/carousel/carousel1.png">
<p>To make the list show horizontally we need to apply correct CSS properties for <code>&lt;li&gt;</code>, like <code>display: inline-block</code>.</p>
<p>For <code>&lt;img&gt;</code> we should also adjust <code>display</code>, because by default it's <code>inline</code>. There's extra space reserved under <code>inline</code> elements for “letter tails”, so we can use <code>display:block</code> to remove it.</p>
<p>To do the scrolling, we can shift <code>&lt;ul&gt;</code>. There are many ways to do it, for instance by changing <code>margin-left</code> or (better performance) use <code>transform: translateX()</code>:</p>
      <img src="http://javascript.info/task/carousel/carousel2.png">
<p>The outer <code>&lt;div&gt;</code> has a fixed width, so “extra” images are cut.</p>
<p>The whole carousel is a self-contained “graphical component” on the page, so we'd better wrap it into a single <code>&lt;div class="carousel"&gt;</code> and style things inside it.</p>
<p>
<a href="http://plnkr.co/edit/VdxdE2JWQbdS7AycM520?p=preview" target="_blank" data-plunk-id="VdxdE2JWQbdS7AycM520">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-687"></h6>
<h1 class="main__header-title" id="chapter-688">Bubbling and capturing</h1>
<p>Let's start with an example.</p>
<p>This handler is assigned to <code>&lt;div&gt;</code>, but also runs if you click any nested tag like <code>&lt;em&gt;</code> or <code>&lt;code&gt;</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div onclick="alert('The handler!')"&gt;
  &lt;em&gt;If you click on &lt;code&gt;EM&lt;/code&gt;, the handler on &lt;code&gt;DIV&lt;/code&gt; runs.&lt;/em&gt;
&lt;/div&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-c9kxo4" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>Isn't it a bit strange? Why the handler on <code>&lt;div&gt;</code> runs if the actual click was on <code>&lt;em&gt;</code>?</p>
<h2 id="chapter-689">
Bubbling</h2>
<p>The bubbling principle is simple.</p>
<p><strong>When an event happens on an element, it first runs the handlers on it, then on its parent, then all the way up on other ancestors.</strong></p>
<p>Let's say, we have 3 nested elements <code>FORM &gt; DIV &gt; P</code> with a handler on each of them:</p>
<div data-trusted="1" class="code-example" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  body * {
    margin: 10px;
    border: 1px solid blue;
  }
&lt;/style&gt;

&lt;form onclick="alert('form')"&gt;FORM
  &lt;div onclick="alert('div')"&gt;DIV
    &lt;p onclick="alert('p')"&gt;P&lt;/p&gt;
  &lt;/div&gt;
&lt;/form&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-evrct9" style="height:200px" src="about:blank"></iframe>
      </div>
      </div><p>A click on the inner <code>&lt;p&gt;</code> first runs <code>onclick</code>:</p>
<ol>
<li>On that <code>&lt;p&gt;</code>.</li>
<li>Then on the outer <code>&lt;div&gt;</code>.</li>
<li>Then on the outer <code>&lt;form&gt;</code>.</li>
<li>And so on upwards till the <code>document</code> object.</li>
</ol>
      <img src="http://javascript.info/article/bubbling-and-capturing/event-order-bubbling.png">
<p>So if we click on <code>&lt;p&gt;</code>, then we'll see 3 alerts: <code>p</code> → <code>div</code> → <code>form</code>.</p>
<p>The process is called “bubbling”, because events “bubble” from the inner element up through parents like a bubble in the water.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><em>Almost</em> all events bubble.</span></div>
            <div class="important__content"><p>The key word in this phrase is “almost”.</p>
<p>For instance, a <code>focus</code> event does not bubble. There are other examples too, we'll meet them. But still it's an exception, rather than a rule, most events do bubble.</p>
</div></div>
<h2 id="chapter-690">
event.target</h2>
<p>A handler on a parent element can always get the details about where it actually happened.</p>
<p><strong>The most deeply nested element that caused the event is called a <em>target</em> element, accessible as <code>event.target</code>.</strong></p>
<p>Note the differences from <code>this</code> (=<code>event.currentTarget</code>):</p>
<ul>
<li><code>event.target</code> – is the “target” element that initiated the event, it doesn't change through the bubbling process.</li>
<li><code>this</code> – is the “current” element, the one that has a currently running handler on it.</li>
</ul>
<p>For instance, if we have a single handler <code>form.onclick</code>, then it can “catch” all clicks inside the form. No matter where the click happened, it bubbles up to <code>&lt;form&gt;</code> and runs the handler.</p>
<p>In <code>form.onclick</code> handler:</p>
<ul>
<li><code>this</code> (<code>=event.currentTarget</code>) is the <code>&lt;form&gt;</code> element, because the handler runs on it.</li>
<li><code>event.target</code> is the concrete element inside the form that actually was clicked.</li>
</ul>
<p>Check it out:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">example.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/bubbling-and-capturing/bubble-target/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/DNkYM3ttFqwZoDs9fQA9?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:220px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/bubbling-and-capturing/bubble-target/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>form.onclick = function(event) {
  event.target.style.backgroundColor = 'yellow';

  // chrome needs some time to paint yellow
  setTimeout(() =&gt; {
    alert("target = " + event.target.tagName + ", this=" + this.tagName);
    event.target.style.backgroundColor = ''
  }, 0);
};</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>form {
  background-color: green;
  position: relative;
  width: 150px;
  height: 150px;
  text-align: center;
  cursor: pointer;
}

div {
  background-color: blue;
  position: absolute;
  top: 25px;
  left: 25px;
  width: 100px;
  height: 100px;
}

p {
  background-color: red;
  position: absolute;
  top: 25px;
  left: 25px;
  width: 50px;
  height: 50px;
  line-height: 50px;
  margin: 0;
}

body {
  line-height: 25px;
  font-size: 16px;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="example.css"&gt;
&lt;/head&gt;

&lt;body&gt;
  A click shows both &lt;code&gt;event.target&lt;/code&gt; and &lt;code&gt;this&lt;/code&gt; to compare:

  &lt;form id="form"&gt;FORM
    &lt;div&gt;DIV
      &lt;p&gt;P&lt;/p&gt;
    &lt;/div&gt;
  &lt;/form&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p>It's possible that <code>event.target</code> equals <code>this</code> – when the click is made directly on the <code>&lt;form&gt;</code> element.</p>
<h2 id="chapter-691">
Stopping bubbling</h2>
<p>A bubbling event goes from the target element straight up. Normally it goes upwards till <code>&lt;html&gt;</code>, and then to <code>document</code> object, and some events even reach <code>window</code>, calling all handlers on the path.</p>
<p>But any handler may decide that the event has been fully processed and stop the bubbling.</p>
<p>The method for it is <code>event.stopPropagation()</code>.</p>
<p>For instance, here <code>body.onclick</code> doesn't work if you click on <code>&lt;button&gt;</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body onclick="alert(`the bubbling doesn't reach here`)"&gt;
  &lt;button onclick="event.stopPropagation()"&gt;Click me&lt;/button&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-56ioez" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">event.stopImmediatePropagation()</span></div>
            <div class="important__content"><p>If an element has multiple event handlers on a single event, then even if one of them stops the bubbling, the other ones still execute.</p>
<p>In other words, <code>event.stopPropagation()</code> stops the move upwards, but on the current element all other handlers will run.</p>
<p>To stop the bubbling and prevent handlers on the current element from running, there's a method <code>event.stopImmediatePropagation()</code>. After it no other handlers execute.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Don't stop bubbling without a need!</span></div>
            <div class="important__content"><p>Bubbling is convenient. Don't stop it without a real need: obvious and architecturally well-thought.</p>
<p>Sometimes <code>event.stopPropagation()</code> creates hidden pitfalls that later may become problems.</p>
<p>For instance:</p>
<ol>
<li>We create a nested menu. Each submenu handles clicks on its elements and calls <code>stopPropagation</code> so that outer menu don't trigger.</li>
<li>Later we decide to catch clicks on the whole window, to track users' behavior (where people click). Some analytic systems do that. Usually the code uses <code>document.addEventListener('click'…)</code> to catch all clicks.</li>
<li>Our analytic won't work over the area where clicks are stopped by <code>stopPropagation</code>. We've got a “dead zone”.</li>
</ol>
<p>There's usually no real need to prevent the bubbling. A task that seemingly requires that may be solved by other means. One of them is to use custom events, we'll cover them later. Also we can write our data into the <code>event</code> object in one handler and read it in another one, so we can pass to handlers on parents information about the processing below.</p>
</div></div>
<h2 id="chapter-692">
Capturing</h2>
<p>There's another phase of event processing called “capturing”. It is rarely used in real code, but sometimes can be useful.</p>
<p>The standard 
<a href="http://www.w3.org/TR/DOM-Level-3-Events/">DOM Events</a> describes 3 phases of event propagation:</p>
<ol>
<li>Capturing phase – the event goes down to the element.</li>
<li>Target phase – the event reached the target element.</li>
<li>Bubbling phase – the event bubbles up from the element.</li>
</ol>
<p>Here's the picture of a click on <code>&lt;td&gt;</code> inside a table, taken from the specification:</p>
      <img src="http://javascript.info/article/bubbling-and-capturing/eventflow.png">
<p>That is: for a click on <code>&lt;td&gt;</code> the event first goes through the ancestors chain down to the element (capturing), then it reaches the target, and then it goes up (bubbles), calling handlers on its way.</p>
<p><strong>Before we only talked about bubbling, because the capturing phase is rarely used. Normally it is invisible to us.</strong></p>
<p>Handlers added using <code>on&lt;event&gt;</code>-property or using HTML attributes or using <code>addEventListener(event, handler)</code> don't know anything about capturing, they only run on the 2nd and 3rd phases.</p>
<p>To catch an event on the capturing phase, we need to set the 3rd argument of <code>addEventListener</code> to <code>true</code>.</p>
<p>There are two possible values for that optional last argument:</p>
<ul>
<li>If it's <code>false</code> (default), then the handler is set on the bubbling phase.</li>
<li>If it's <code>true</code>, then the handler is set on the capturing phase.</li>
</ul>
<p>Note that while formally there are 3 phases, the 2nd phase (“target phase”: the event reached the element) is not handled separately: handlers on both capturing and bubbling phases trigger at that phase.</p>
<p>If one puts capturing and bubbling handlers on the target element, the capture handler triggers last in the capturing phase and the bubble handler triggers first in the bubbling phase.</p>
<p>Let's see it in action:</p>
<div data-trusted="1" class="code-example" data-demo-height="140" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  body * {
    margin: 10px;
    border: 1px solid blue;
  }
&lt;/style&gt;

&lt;form&gt;FORM
  &lt;div&gt;DIV
    &lt;p&gt;P&lt;/p&gt;
  &lt;/div&gt;
&lt;/form&gt;

&lt;script&gt;
  for(let elem of document.querySelectorAll('*')) {
    elem.addEventListener("click", e =&gt; alert(`Capturing: ${elem.tagName}`), true);
    elem.addEventListener("click", e =&gt; alert(`Bubbling: ${elem.tagName}`));
  }
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-dix2xc" style="height:140px" src="about:blank"></iframe>
      </div>
      </div><p>The code sets click handlers on <em>every</em> element in the document to see which ones are working.</p>
<p>If you click on <code>&lt;p&gt;</code>, then the sequence is:</p>
<ol>
<li><code>HTML</code> → <code>BODY</code> → <code>FORM</code> → <code>DIV</code> → <code>P</code> (capturing phase, the first listener), and then:</li>
<li><code>P</code> → <code>DIV</code> → <code>FORM</code> → <code>BODY</code> → <code>HTML</code> (bubbling phase, the second listener).</li>
</ol>
<p>Please note that <code>P</code> shows up two times: at the end of capturing and at the start of bubbling.</p>
<p>There's a property <code>event.eventPhase</code> that tells us the number of the phase on which the event was caught. But it's rarely used, because we usually know it in the handler.</p>
<h2 id="chapter-693">
Summary</h2>
<p>The event handling process:</p>
<ul>
<li>When an event happens – the most nested element where it happens gets labeled as the “target element” (<code>event.target</code>).</li>
<li>Then the event first moves from the document root down the <code>event.target</code>, calling handlers assigned with <code>addEventListener(...., true)</code> on the way.</li>
<li>Then the event moves from <code>event.target</code> up to the root, calling handlers assigned using  <code>on&lt;event&gt;</code> and <code>addEventListener</code> without the 3rd argument or with the 3rd argument <code>false</code>.</li>
</ul>
<p>Each handler can access <code>event</code> object properties:</p>
<ul>
<li><code>event.target</code> – the deepest element that originated the event.</li>
<li><code>event.currentTarget</code> (=<code>this</code>) – the current element that handles the event (the one that has the handler on it)</li>
<li><code>event.eventPhase</code> – the current phase (capturing=1, bubbling=3).</li>
</ul>
<p>Any event handler can stop the event by calling <code>event.stopPropagation()</code>, but that's not recommended, because we can't really be sure we won't need it above, maybe for completely different things.</p>
<p>The capturing phase is used very rarely, usually we handle events on bubbling. And there's a logic behind that.</p>
<p>In real world, when an accident happens, local authorities react first. They know best the area where it happened. Then higher-level authorities if needed.</p>
<p>The same for event handlers. The code that set the handler on a particular element knows maximum  details about the element and what it does. A handler on a particular <code>&lt;td&gt;</code> may be suited for that exactly <code>&lt;td&gt;</code>, it knows everything about it, so it should get the chance first. Then its immediate parent also knows about the context, but a little bit less, and so on till the very top element that handles general concepts and runs the last.</p>
<p>Bubbling and capturing lay the foundation for “event delegation” – an extremely powerful event handling pattern that we study in the next chapter.</p>

<h6 id="chapter-694"></h6>
<h1 class="main__header-title" id="chapter-695">Event delegation</h1>
<p>Capturing and bubbling allow to implement one of most powerful event handling patterns called <em>event delegation</em>.</p>
<p>The idea is that if we have a lot of elements handled in a similar way, then instead of assigning a handler to each of them – we put a single handler on their common ancestor.</p>
<p>In the handler we get <code>event.target</code>, see where the event actually happened and handle it.</p>
<p>Let's see an example – the 
<a href="http://en.wikipedia.org/wiki/Ba_gua">Ba-Gua diagram</a> reflecting the ancient Chinese philosophy.</p>
<p>Here it is:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/event-delegation/bagua/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      <div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/WgbzHnttnqu4KVuIJLLk?p=preview" target="_blank" title="open in sandbox" data-plunk-id="WgbzHnttnqu4KVuIJLLk" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:350px" src="https://en.js.cx/article/event-delegation/bagua/"></iframe>
  </div><p>The HTML is like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;table&gt;
  &lt;tr&gt;
    &lt;th colspan="3"&gt;&lt;em&gt;Bagua&lt;/em&gt; Chart: Direction, Element, Color, Meaning&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;...&lt;strong&gt;Northwest&lt;/strong&gt;...&lt;/td&gt;
    &lt;td&gt;...&lt;/td&gt;
    &lt;td&gt;...&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;...2 more lines of this kind...&lt;/tr&gt;
  &lt;tr&gt;...2 more lines of this kind...&lt;/tr&gt;
&lt;/table&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The table has 9 cells, but there could be 99 or 9999, doesn't matter.</p>
<p><strong>Our task is to highlight a cell <code>&lt;td&gt;</code> on click.</strong></p>
<p>Instead of assign an <code>onclick</code> handler to each <code>&lt;td&gt;</code> (can be many) – we'll setup the “catch-all” handler on <code>&lt;table&gt;</code> element.</p>
<p>It will use <code>event.target</code> to get the clicked element and highlight it.</p>
<p>The code:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-8">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let selectedTd;

table.onclick = function(event) {
  let target = event.target; // where was the click?

  if (target.tagName != 'TD') return; // not on TD? Then we're not interested

  highlight(target); // highlight it
};

function highlight(td) {
  if (selectedTd) { // remove the existing highlight if any
    selectedTd.classList.remove('highlight');
  }
  selectedTd = td;
  selectedTd.classList.add('highlight'); // highlight the new td
}</code></pre>
        </div>
      </div>
      
      </div><p>Such a code doesn't care how many cells there are in the table. We can add/remove <code>&lt;td&gt;</code> dynamically at any time and the highlighting will still work.</p>
<p>Still, there's a drawback.</p>
<p>The click may occur not on the <code>&lt;td&gt;</code>, but inside it.</p>
<p>In our case if we take a look inside the HTML, we can see nested tags inside <code>&lt;td&gt;</code>, like <code>&lt;strong&gt;</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;td&gt;
  &lt;strong&gt;Northwest&lt;/strong&gt;
  ...
&lt;/td&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Naturally, if a click happens on that <code>&lt;strong&gt;</code> then it becomes the value of <code>event.target</code>.</p>
      <img src="http://javascript.info/article/event-delegation/bagua-bubble.png">
<p>In the handler <code>table.onclick</code> we should take such <code>event.target</code> and find out whether the click was inside <code>&lt;td&gt;</code> or not.</p>
<p>Here's the improved code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">table.onclick = function(event) {
  let td = event.target.closest('td'); // (1)

  if (!td) return; // (2)

  if (!table.contains(td)) return; // (3)

  highlight(td); // (4)
};</code></pre>
        </div>
      </div>
      
      </div><p>Explanations:</p>
<ol>
<li>The method <code>elem.closest(selector)</code> returns the nearest ancestor that matches the selector. In our case we look for <code>&lt;td&gt;</code> on the way up from the source element.</li>
<li>If <code>event.target</code> is not inside any <code>&lt;td&gt;</code>, then the call returns <code>null</code>, and we don't have to do anything.</li>
<li>In case of nested tables, <code>event.target</code> may be a <code>&lt;td&gt;</code> lying outside of the current table. So we check if that's actually <em>our table's</em> <code>&lt;td&gt;</code>.</li>
<li>And, if it's so, then highlight it.</li>
</ol>
<h2 id="chapter-696">
Delegation example: actions in markup</h2>
<p>The event delegation may be used to optimize event handling. We use a single handler for similar actions on many elements. Like we did it for highlighting <code>&lt;td&gt;</code>.</p>
<p>But we can also use a single handler as an entry point for many different things.</p>
<p>For instance, we want to make a menu with buttons “Save”, “Load”, “Search” and so on. And there's an object with methods <code>save</code>, <code>load</code>, <code>search</code>….</p>
<p>The first idea may be to assign a separate handler to each button. But there's a more elegant solution. We can add a handler for the whole menu and <code>data-action</code> attributes for buttons that has the method to call:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:8-26">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button data-action="save"&gt;Click to Save&lt;/button&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The handler reads the attribute and executes the method. Take a look at the working example:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true" data-highlight-block="26-29">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div id="menu"&gt;
  &lt;button data-action="save"&gt;Save&lt;/button&gt;
  &lt;button data-action="load"&gt;Load&lt;/button&gt;
  &lt;button data-action="search"&gt;Search&lt;/button&gt;
&lt;/div&gt;

&lt;script&gt;
  class Menu {
    constructor(elem) {
      this._elem = elem;
      elem.onclick = this.onClick.bind(this); // (*)
    }

    save() {
      alert('saving');
    }

    load() {
      alert('loading');
    }

    search() {
      alert('searching');
    }

    onClick(event) {
      let action = event.target.dataset.action;
      if (action) {
        this[action]();
      }
    };
  }

  new Menu(menu);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-12ab62" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>Please note that <code>this.onClick</code> is bound to <code>this</code> in <code>(*)</code>. That's important, because otherwise <code>this</code> inside it would reference the DOM element (<code>elem</code>), not the menu object, and <code>this[action]</code> would not be what we need.</p>
<p>So, what the delegation gives us here?</p>
<div class="balance balance_single"><div class="balance__pluses"><div class="balance__content"><ul class="balance__list"><li>We don't need to write the code to assign a handler to each button. Just make a method and put it in the markup.</li>
<li>The HTML structure is flexible, we can add/remove buttons at any time.</li>
</ul></div></div></div><p>We could also use classes <code>.action-save</code>, <code>.action-load</code>, but an attribute <code>data-action</code> is better semantically. And we can use it in CSS rules too.</p>
<h2 id="chapter-697">
The “behavior” pattern</h2>
<p>We can also use event delegation to add “behaviors” to elements <em>declaratively</em>, with special attributes and classes.</p>
<p>The pattern has two parts:</p>
<ol>
<li>We add a special attribute to an element.</li>
<li>A document-wide handler tracks events, and if an event happens on an attributed element – performs the action.</li>
</ol>
<h3>
Counter</a></h3><p>For instance, here the attribute <code>data-counter</code> adds a behavior: “increase on click” to buttons:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">Counter: &lt;input type="button" value="1" data-counter&gt;
One more counter: &lt;input type="button" value="2" data-counter&gt;

&lt;script&gt;
  document.addEventListener('click', function(event) {

    if (event.target.dataset.counter != undefined) { // if the attribute exists...
      event.target.value++;
    }

  });
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-8fkvgl" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>If we click a button – its value is increased. Not buttons, but the general approach is important here.</p>
<p>There can be as many attributes with <code>data-counter</code> as we want. We can add new ones to HTML at any moment. Using the event delegation we “extended” HTML, added an attribute that describes a new behavior.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">For document-level handlers – always <code>addEventListener</code></span></div>
            <div class="important__content"><p>When we assign an event handler to the <code>document</code> object, we should always use <code>addEventListener</code>, not <code>document.onclick</code>, because the latter will cause conflicts: new handlers overwrite old ones.</p>
<p>For real projects it's normal that there are many handlers on <code>document</code> set by different parts of the code.</p>
</div></div>
<h3>
Toggler</a></h3><p>One more example. A click on an element with the attribute <code>data-toggle-id</code> will show/hide the element with the given <code>id</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true" data-highlight-block="9-16" data-highlight-inline="0:8-39">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button data-toggle-id="subscribe-mail"&gt;
  Show the subscription form
&lt;/button&gt;

&lt;form id="subscribe-mail" hidden&gt;
  Your mail: &lt;input type="email"&gt;
&lt;/form&gt;

&lt;script&gt;
  document.addEventListener('click', function(event) {
    let id = event.target.dataset.toggleId;
    if (!id) return;

    let elem = document.getElementById(id);

    elem.hidden = !elem.hidden;
  });
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-1q3frv" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>Let's note once again what we did. Now, to add toggling functionality to an element – there's no need to know JavaScript, just use the attribute <code>data-toggle-id</code>.</p>
<p>That may become really convenient – no need to write JavaScript for every such element. Just use the behavior. The document-level handler makes it work for any element of the page.</p>
<p>We can combine multiple behaviors on a single element as well.</p>
<p>The “behavior” pattern can be an alternative of mini-fragments of JavaScript.</p>
<h2 id="chapter-698">
Summary</h2>
<p>Event delegation is really cool! It's one of the most helpful patterns for DOM events.</p>
<p>It's often used to add same handling for many similar elements, but not only for that.</p>
<p>The algorithm:</p>
<ol>
<li>Put a single handler on the container.</li>
<li>In the handler – check the source element <code>event.target</code>.</li>
<li>If the event happened inside an element that interests us, then handle the event.</li>
</ol>
<p>Benefits:</p>
<div class="balance balance_single"><div class="balance__pluses"><div class="balance__content"><ul class="balance__list"><li>Simplifies initialization and saves memory: no need to add many handlers.</li>
<li>Less code: when adding or removing elements, no need to add/remove handlers.</li>
<li>DOM modifications: we can mass add/remove elements with <code>innerHTML</code> and alike.</li>
</ul></div></div></div><p>The delegation has its limitations of course:</p>
<div class="balance balance_single"><div class="balance__minuses"><div class="balance__content"><ul class="balance__list"><li>First, the event must be bubbling. Some events do not bubble. Also, low-level handlers should not use <code>event.stopPropagation()</code>.</li>
<li>Second, the delegation may add CPU load, because the container-level handler reacts on events in any place of the container, no matter if they interest us or not. But usually the load is negligible, so we don't take it into account.</li>
</ul></div></div></div><div class="tasks"><h2 id="chapter-699" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#hide-messages-with-delegation" name="hide-messages-with-delegation" class="main__anchor">Hide messages with delegation</a></h3>
<a href="http://javascript.info/task/hide-message-delegate" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's a list of messages with removal buttons <code>[x]</code>. Make the buttons work.</p>
<p>Like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:420px" src="https://en.js.cx/task/hide-message-delegate/solution/"></iframe>
  </div><p>P.S. Should be only one event listener on the container, use event delegation.</p>
<p>
<a href="http://plnkr.co/edit/J03qPzPIecpfwDHrSq7v?p=preview" target="_blank" data-plunk-id="J03qPzPIecpfwDHrSq7v">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/3QG7EWO4r0WJ9n4Z3rHv?p=preview" target="_blank" data-plunk-id="3QG7EWO4r0WJ9n4Z3rHv">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#tree-menu" name="tree-menu" class="main__anchor">Tree menu</a></h3>
<a href="http://javascript.info/task/sliding-tree" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a tree that shows/hides node children on click:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/task/sliding-tree/solution/"></iframe>
  </div><p>Requirements:</p>
<ul>
<li>Only one event handler (use delegation)</li>
<li>A click outside the node title (on an empty space) should not do anything.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/LCvIxPLhW1wFvHteCUtU?p=preview" target="_blank" data-plunk-id="LCvIxPLhW1wFvHteCUtU">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution has two parts.</p>
<ol>
<li>Wrap every tree node title into <code>&lt;span&gt;</code>. Then we can CSS-style them on <code>:hover</code> and handle clicks exactly on text, because <code>&lt;span&gt;</code> width is exactly the text width (unlike without it).</li>
<li>Set a handler to the <code>tree</code> root node and handle clicks on that <code>&lt;span&gt;</code> titles.</li>
</ol>
<p>
<a href="http://plnkr.co/edit/xSgZWnTx7ygqxmZLjL6L?p=preview" target="_blank" data-plunk-id="xSgZWnTx7ygqxmZLjL6L">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#sortable-table" name="sortable-table" class="main__anchor">Sortable table</a></h3>
<a href="http://javascript.info/task/sortable-table" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Make the table sortable: clicks on <code>&lt;th&gt;</code> elements should sort it by corresponding column.</p>
<p>Each <code>&lt;th&gt;</code> has the type in the attribute, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;table id="grid"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th data-type="number"&gt;Age&lt;/th&gt;
      &lt;th data-type="string"&gt;Name&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;John&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;10&lt;/td&gt;
      &lt;td&gt;Ann&lt;/td&gt;
    &lt;/tr&gt;
    ...
  &lt;/tbody&gt;
&lt;/table&gt;</code></pre>
        </div>
      </div>
      
      </div><p>In the example above the first column has numbers, and the second one – strings. The sorting function should handle sort according to the type.</p>
<p>Only <code>"string"</code> and <code>"number"</code> types should be supported.</p>
<p>The working example:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:190px" src="https://en.js.cx/task/sortable-table/solution/"></iframe>
  </div><p>P.S. The table can be big, with any number of rows and columns.</p>
<p>
<a href="http://plnkr.co/edit/fiAbFZTxrYKpiBJT6kLW?p=preview" target="_blank" data-plunk-id="fiAbFZTxrYKpiBJT6kLW">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/BFQnkjDs0UTAIxg9WSEn?p=preview" target="_blank" data-plunk-id="BFQnkjDs0UTAIxg9WSEn">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#tooltip-behavior" name="tooltip-behavior" class="main__anchor">Tooltip behavior</a></h3>
<a href="http://javascript.info/task/behavior-tooltip" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create JS-code for the tooltip behavior.</p>
<p>When a mouse comes over an element with <code>data-tooltip</code>, the tooltip should appear over it, and when it's gone then hide.</p>
<p>An example of annotated HTML:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button data-tooltip="the tooltip is longer than the element"&gt;Short button&lt;/button&gt;
&lt;button data-tooltip="HTML&lt;br&gt;tooltip"&gt;One more button&lt;/button&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Should work like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:200px" src="https://en.js.cx/task/behavior-tooltip/solution/"></iframe>
  </div><p>In this task we assume that all elements with <code>data-tooltip</code> have only text inside. No nested tags.</p>
<p>Details:</p>
<ul>
<li>The tooltip should not cross window edges. Normally it should be above the element, but if the element is at the page top and there's no space for the tooltip, then below it.</li>
<li>The tooltip is given in the <code>data-tooltip</code> attribute. It can be arbitrary HTML.</li>
</ul>
<p>You'll need two events here:</p>
<ul>
<li><code>mouseover</code> triggers when a pointer comes over an element.</li>
<li><code>mouseout</code> triggers when a pointer leaves an element.</li>
</ul>
<p>Please use event delegation: set up two handlers on <code>document</code> to track all “overs” and “outs” from elements with <code>data-tooltip</code> and manage tooltips from there.</p>
<p>After the behavior is implemented, even people unfamiliar with JavaScript can add annotated elements.</p>
<p>P.S. To keep things natural and simple: only one tooltip may show up at a time.</p>
<p>
<a href="http://plnkr.co/edit/IOTO28pSfsE37n8NaSfo?p=preview" target="_blank" data-plunk-id="IOTO28pSfsE37n8NaSfo">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/NAP9E1IGnW3BM3pTRHwv?p=preview" target="_blank" data-plunk-id="NAP9E1IGnW3BM3pTRHwv">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-700"></h6>
<h1 class="main__header-title" id="chapter-701">Browser default actions</h1>
<p>Many events automatically lead to browser actions.</p>
<p>For instance:</p>
<ul>
<li>A click on a link – initiates going to its URL.</li>
<li>A click on submit button inside a form – initiates its submission to the server.</li>
<li>Pressing a mouse button over a text and moving it – selects the text.</li>
</ul>
<p>If we handle an event in JavaScript, often we don't want browser actions. Fortunately, it can be prevented.</p>


<h2 id="chapter-702">
Preventing browser actions</h2>
<p>There are two ways to tell the browser we don't want it to act:</p>
<ul>
<li>The main way is to use the <code>event</code> object. There's a method <code>event.preventDefault()</code>.</li>
<li>If the handler is assigned using <code>on&lt;event&gt;</code> (not by <code>addEventListener</code>), then we can just return <code>false</code> from it.</li>
</ul>
<p>In the example below there a click to links don't lead to URL change:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;a href="/" onclick="return false"&gt;Click here&lt;/a&gt;
or
&lt;a href="/" onclick="event.preventDefault()"&gt;here&lt;/a&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-6whjhu" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Not necessary to return <code>true</code></span></div>
            <div class="important__content"><p>The value returned by an event handler is usually ignored.</p>
<p>The only exception – is <code>return false</code> from a handler assigned using <code>on&lt;event&gt;</code>.</p>
<p>In all other cases, the return is not needed and it's not processed anyhow.</p>
</div></div>
<h3>
Example: the menu</a></h3><p>Consider a site menu, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;ul id="menu" class="menu"&gt;
  &lt;li&gt;&lt;a href="/html"&gt;HTML&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/javascript"&gt;JavaScript&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/css"&gt;CSS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Here's how it looks with some CSS:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/default-browser-action/menu/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      <div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/ALfNYdd2kSMWAc2w7uqh?p=preview" target="_blank" title="open in sandbox" data-plunk-id="ALfNYdd2kSMWAc2w7uqh" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:70px" src="https://en.js.cx/article/default-browser-action/menu/"></iframe>
  </div><p>Menu items are links <code>&lt;a&gt;</code>, not buttons. There are several benefits, for instance:</p>
<ul>
<li>Many people like to use “right click” – “open in a new window”. If we use <code>&lt;button&gt;</code> or <code>&lt;span&gt;</code>, that doesn't work.</li>
<li>Search engines follow <code>&lt;a href="..."&gt;</code> links while indexing.</li>
</ul>
<p>So we use <code>&lt;a&gt;</code> in the markup. But normally we intend to handle clicks in JavaScript. So we should prevent the default browser action.</p>
<p>Like here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">menu.onclick = function(event) {
  if (event.target.nodeName != 'A') return;

  let href = event.target.getAttribute('href');
  alert( href ); // ...can be loading from the server, UI generation etc

  return false; // prevent browser action (don't go to the URL)
};</code></pre>
        </div>
      </div>
      
      </div><p>If we omit <code>return false</code>, then after our code executes the browser will do its “default action” – following to the URL in <code>href</code>.</p>
<p>By the way, using event delegation here makes our menu flexible. We can add nested lists and style them using CSS to “slide down”.</p>
<h2 id="chapter-703">
Prevent further events</h2>
<p>Certain events flow one into another. If we prevent the first event, there will be no second.</p>
<p>For instance, <code>mousedown</code> on an <code>&lt;input&gt;</code> field leads to focusing in it, and the <code>focus</code> event. If we prevent the <code>mousedown</code> event, there's no focus.</p>
<p>Try to click on the first <code>&lt;input&gt;</code> below – the <code>focus</code> event happens. That's normal.</p>
<p>But if you click the second one, there's no focus.</p>
<div data-trusted="1" class="code-example" data-autorun="true" data-highlight-inline="1:7-33">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input value="Focus works" onfocus="this.value=''"&gt;
&lt;input onmousedown="return false" onfocus="this.value=''" value="Click me"&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-bhaile" style="height:200px" src="about:blank"></iframe>
      </div>
      </div><p>That's because the browser action is canceled on <code>mousedown</code>. The focusing is still possible if we use another way to enter the input. For instance, the <kbd class="shortcut">Tab</kbd> key to switch from the 1st input into the 2nd. But not with the mouse click any more.</p>
<h2 id="chapter-704">
event.defaultPrevented</h2>
<p>The property <code>event.defaultPrevented</code> is <code>true</code> if the default action was prevented, and <code>false</code> otherwise.</p>
<p>There's an interesting use case for it.</p>
<p>You remember in the chapter 
<a href="http://javascript.info/bubbling-and-capturing">Bubbling and capturing</a> we talked about <code>event.stopPropagation()</code>  and why stopping bubbling is bad?</p>
<p>Sometimes we can use <code>event.defaultPrevented</code> instead.</p>
<p>Let's see a practical example where stopping the bubbling looks necessary, but actually we can do well without it.</p>
<p>By default the browser on <code>contextmenu</code> event (right mouse click) shows a context menu with standard options. We can prevent it and show our own, like this:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true" data-highlight-inline="2:8-60">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button&gt;Right-click for browser context menu&lt;/button&gt;

&lt;button oncontextmenu="alert('Draw our menu'); return false"&gt;
  Right-click for our context menu
&lt;/button&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-ak0s8m" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>Now let's say we want to implement our own document-wide context menu, with our options. And inside the document we may have other elements with their own context menus:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;p&gt;Right-click here for the document context menu&lt;/p&gt;
&lt;button id="elem"&gt;Right-click here for the button context menu&lt;/button&gt;

&lt;script&gt;
  elem.oncontextmenu = function(event) {
    event.preventDefault();
    alert("Button context menu");
  };

  document.oncontextmenu = function(event) {
    event.preventDefault();
    alert("Document context menu");
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-2egs13" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>The problem is that when we click on <code>elem</code>, we get two menus: the button-level and (the event bubbles up) the document-level menu.</p>
<p>How to fix it? One of solutions is to think like: “We fully handle the event in the button handler, let's stop it” and use <code>event.stopPropagation()</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;p&gt;Right-click for the document menu&lt;/p&gt;
&lt;button id="elem"&gt;Right-click for the button menu (fixed with event.stopPropagation)&lt;/button&gt;

&lt;script&gt;
  elem.oncontextmenu = function(event) {
    event.preventDefault();
    event.stopPropagation();
    alert("Button context menu");
  };

  document.oncontextmenu = function(event) {
    event.preventDefault();
    alert("Document context menu");
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-eq5tsi" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>Now the button-level menu works as intended. But the price is high. We forever deny access to information about right-clicks for any outer code, including counters that gather statistics and so on. That's quite unwise.</p>
<p>An alternative solution would be to check in the <code>document</code> handler if the default action was prevented? If it is so, then the event was handled, and we don't need to react on it.</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-block="10-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;p&gt;Right-click for the document menu (fixed with event.defaultPrevented)&lt;/p&gt;
&lt;button id="elem"&gt;Right-click for the button menu&lt;/button&gt;

&lt;script&gt;
  elem.oncontextmenu = function(event) {
    event.preventDefault();
    alert("Button context menu");
  };

  document.oncontextmenu = function(event) {
    if (event.defaultPrevented) return;

    event.preventDefault();
    alert("Document context menu");
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-q2aay" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>Now everything also works correctly. If we have nested elements, and each of them has a context menu of its own, that would also work. Just make sure to check for <code>event.defaultPrevented</code> in each <code>contextmenu</code> handler.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">event.stopPropagation() and event.preventDefault()</span></div>
            <div class="important__content"><p>As we can clearly see, <code>event.stopPropagation()</code> and <code>event.preventDefault()</code> (also known as <code>return false</code>) are two different things. They are not related to each other.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Nested context menus architecture</span></div>
            <div class="important__content"><p>There are also alternative ways to implement nested context menus. One of them is to have a special global object with a method that handles <code>document.oncontextmenu</code>, and also methods that allow to store various “lower-level” handlers in it.</p>
<p>The object will catch any right-click, look through stored handlers and run the appropriate one.</p>
<p>But then each piece of code that wants a context menu should know about that object and use its help instead of the own <code>contextmenu</code> handler.</p>
</div></div>
<h2 id="chapter-705">
Summary</h2>
<p>There are many default browser actions:</p>
<ul>
<li><code>mousedown</code> – starts the selection (move the mouse to select).</li>
<li><code>click</code> on <code>&lt;input type="checkbox"&gt;</code> – checks/unchecks the <code>input</code>.</li>
<li><code>submit</code> – clicking an <code>&lt;input type="submit"&gt;</code> or hitting <kbd class="shortcut">Enter</kbd> inside a form field causes this event to happen, and the browser submits the form after it.</li>
<li><code>wheel</code> – rolling a mouse wheel event has scrolling as the default action.</li>
<li><code>keydown</code> – pressing a key may lead to adding a character into a field, or other actions.</li>
<li><code>contextmenu</code> – the event happens on a right-click, the action is to show the browser context menu.</li>
<li>…there are more…</li>
</ul>
<p>All the default actions can be prevented if we want to handle the event exclusively by JavaScript.</p>
<p>To prevent a default action – use either <code>event.preventDefault()</code> or  <code>return false</code>. The second method works only for handlers assigned with <code>on&lt;event&gt;</code>.</p>
<p>If the default action was prevented, the value of <code>event.defaultPrevented</code> becomes <code>true</code>, otherwise it's <code>false</code>.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Stay semantic, don't abuse</span></div>
            <div class="important__content"><p>Technically, by preventing default actions and adding JavaScript we can customize the behavior of any elements. For instance, we can make a link <code>&lt;a&gt;</code> work like a button, and a button <code>&lt;button&gt;</code> behave as a link (redirect to another URL or so).</p>
<p>But we should generally keep the semantic meaning of HTML elements. For instance, <code>&lt;a&gt;</code> should preform navigation, not a button.</p>
<p>Besides being “just a good thing”, that makes your HTML better in terms of accessibility.</p>
<p>Also if we consider the example with <code>&lt;a&gt;</code>, then please note: a browser allows to open such links in a new window (by right-clicking them and other means). And people like that. But if we make a button behave as a link using JavaScript and even look like a link using CSS, then <code>&lt;a&gt;</code>-specific browser features still won't work for it.</p>
</div></div>
<div class="tasks"><h2 id="chapter-706" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#why-return-false-doesn-t-work" name="why-return-false-doesn-t-work" class="main__anchor">Why "return false" doesn't work?</a></h3>
<a href="http://javascript.info/task/why-return-false-fails" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 3</span></div><div class="task__content"><p>Why in the code below <code>return false</code> doesn't work at all?</p>
<div data-trusted="1" class="code-example" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  function handler() {
    alert( "..." );
    return false;
  }
&lt;/script&gt;

&lt;a href="http://w3.org" onclick="handler()"&gt;the browser will go to w3.org&lt;/a&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-daff5b" style="height:200px" src="about:blank"></iframe>
      </div>
      </div><p>The browser follows the URL on click, but we don't want it.</p>
<p>How to fix?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>When the browser reads the <code>on*</code> attribute like <code>onclick</code>, it creates the handler from its content.</p>
<p>For <code>onclick="handler()"</code> the function will be:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function(event) {
  handler() // the content of onclick
}</code></pre>
        </div>
      </div>
      
      </div><p>Now we can see that the value returned by <code>handler()</code> is not used and does not affect the result.</p>
<p>The fix is simple:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="7:33-49">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  function handler() {
    alert("...");
    return false;
  }
&lt;/script&gt;

&lt;a href="http://w3.org" onclick="return handler()"&gt;w3.org&lt;/a&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Also we can use <code>event.preventDefault()</code>, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-4" data-highlight-inline="7:33-47">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  function handler(event) {
    alert("...");
    event.preventDefault();
  }
&lt;/script&gt;

&lt;a href="http://w3.org" onclick="handler(event)"&gt;w3.org&lt;/a&gt;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#catch-links-in-the-element" name="catch-links-in-the-element" class="main__anchor">Catch links in the element</a></h3>
<a href="http://javascript.info/task/catch-link-navigation" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Make all links inside the element with <code>id="contents"</code> ask the user if he really wants to leave. And if he doesn't then don't follow.</p>
<p>Like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:100px" src="https://en.js.cx/task/catch-link-navigation/solution/"></iframe>
  </div><p>Details:</p>
<ul>
<li>HTML inside the element may be loaded or regenerated dynamically at any time, so we can't find all links and put handlers on them. Use the event delegation.</li>
<li>The content may have nested tags. Inside links too, like <code>&lt;a href=".."&gt;&lt;i&gt;...&lt;/i&gt;&lt;/a&gt;</code>.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/mU1xku1h5FpyAzLKyvo3?p=preview" target="_blank" data-plunk-id="mU1xku1h5FpyAzLKyvo3">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>That's a great use of the event delegation pattern.</p>
<p>In real life instead of asking we can send a “logging” request to the server that saves the information about where the visitor left. Or we can load the content and show it right in the page (if allowable).</p>
<p>All we need is to catch the <code>contents.onclick</code> and use <code>confirm</code> to ask the user. A good idea would be to use <code>link.getAttribute('href')</code> instead of <code>link.href</code> for the URL. See the solution for details.</p>
<p>
<a href="http://plnkr.co/edit/cuf92sF1PkQbXBqjo6n6?p=preview" target="_blank" data-plunk-id="cuf92sF1PkQbXBqjo6n6">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#image-gallery" name="image-gallery" class="main__anchor">Image gallery</a></h3>
<a href="http://javascript.info/task/image-gallery" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create an image gallery where the main image changes by the click on a thumbnail.</p>
<p>Like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:600px" src="https://en.js.cx/task/image-gallery/solution/"></iframe>
  </div><p>P.S. Use event delegation.</p>
<p>
<a href="http://plnkr.co/edit/4jSc7iinVwDY9NjycMIt?p=preview" target="_blank" data-plunk-id="4jSc7iinVwDY9NjycMIt">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution is to assign the handler to the container and track clicks. If a click is on the <code>&lt;a&gt;</code> link, then change <code>src</code> of <code>#largeImg</code> to the <code>href</code> of the thumbnail.</p>
<p>
<a href="http://plnkr.co/edit/CxrJrw4JQ5oF9VlYw4Ka?p=preview" target="_blank" data-plunk-id="CxrJrw4JQ5oF9VlYw4Ka">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-707"></h6>
<h1 class="main__header-title" id="chapter-708">Dispatching custom events</h1>
<p>We can not only assign handlers, but also generate events from JavaScript.</p>
<p>Custom events can be used to create “graphical components”. For instance, a root element of the menu may trigger events telling what happens with the menu: <code>open</code> (menu open),  <code>select</code> (an item is selected) and so on.</p>
<p>Also we can generate built-in events like <code>click</code>, <code>mousedown</code> etc, that may be good for testing.</p>


<h2 id="chapter-709">
Event constructor</h2>
<p>Events form a hierarchy, just like DOM element classes. The root is the built-in 
<a href="http://www.w3.org/TR/dom/#event">Event</a> class.</p>
<p>We can create <code>Event</code> objects like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let event = new Event(event type[, options]);</code></pre>
        </div>
      </div>
      
      </div><p>Arguments:</p>
<ul>
<li>
<p><em>event type</em> – may be any string, like <code>"click"</code> or our own like <code>"hey-ho!"</code>.</p>
</li>
<li>
<p><em>options</em> – the object with two optional properties:</p>
<ul>
<li><code>bubbles: true/false</code> – if <code>true</code>, then the event bubbles.</li>
<li><code>cancelable: true/false</code> – if <code>true</code>, then the “default action”  may be prevented. Later we'll see what it means for custom events.</li>
</ul>
<p>By default both are false: <code>{bubbles: false, cancelable: false}</code>.</p>
</li>
</ul>
<h2 id="chapter-710">
dispatchEvent</h2>
<p>After an event object is created, we should “run” it on an element using the call  <code>elem.dispatchEvent(event)</code>.</p>
<p>Then handlers react on it as if it were a regular built-in event. If the event was created with the <code>bubbles</code> flag, then it bubbles.</p>
<p>In the example below the <code>click</code> event is initiated in JavaScript. The handler works same way as if the button was clicked:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="elem" onclick="alert('Click!');"&gt;Autoclick&lt;/button&gt;

&lt;script&gt;
  let event = new Event("click");
  elem.dispatchEvent(event);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">event.isTrusted</span></div>
            <div class="important__content"><p>There is a way to tell a “real” user event from a script-generated one.</p>
<p>The property <code>event.isTrusted</code> is <code>true</code> for events that come from real user actions and <code>false</code> for script-generated events.</p>
</div></div>
<h2 id="chapter-711">
Bubbling example</h2>
<p>We can create a bubbling event with the name <code>"hello"</code> and catch it on <code>document</code>.</p>
<p>All we need is to set <code>bubbles</code> to <code>true</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;h1 id="elem"&gt;Hello from the script!&lt;/h1&gt;

&lt;script&gt;
  // catch on document...
  document.addEventListener("hello", function(event) { // (1)
    alert("Hello from " + event.target.tagName); // Hello from H1
  });

  // ...dispatch on elem!
  let event = new Event("hello", {bubbles: true}); // (2)
  elem.dispatchEvent(event);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Notes:</p>
<ol>
<li>We should use <code>addEventListener</code> for our custom events, because <code>on&lt;event&gt;</code> only exists for built-in events, <code>document.onhello</code> doesn't work.</li>
<li>Must set <code>bubbles:true</code>, otherwise the event won't bubble up.</li>
</ol>
<p>The bubbling mechanics is the same for built-in (<code>click</code>) and custom (<code>hello</code>) events. There are also capturing and bubbling stages.</p>
<h2 id="chapter-712">
MouseEvent, KeyboardEvent and others</h2>
<p>Here's a short list of classes for UI Events from the 
<a href="https://www.w3.org/TR/uievents">UI Event specification</a>:</p>
<ul>
<li><code>UIEvent</code></li>
<li><code>FocusEvent</code></li>
<li><code>MouseEvent</code></li>
<li><code>WheelEvent</code></li>
<li><code>KeyboardEvent</code></li>
<li>…</li>
</ul>
<p>We should use them instead of <code>new Event</code> if we want to create such events. For instance, <code>new MouseEvent("click")</code>.</p>
<p>The right constructor allows to specify standard properties for that type of event.</p>
<p>Like <code>clientX/clientY</code> for a mouse event:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let event = new MouseEvent("click", {
  bubbles: true,
  cancelable: true,
  clientX: 100,
  clientY: 100
});

alert(event.clientX); // 100</code></pre>
        </div>
      </div>
      
      </div><p>Please note: the generic <code>Event</code> constructor does not allow that.</p>
<p>Let's try:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let event = new Event("click", {
  bubbles: true, // only bubbles and cancelable
  cancelable: true, // work in the Event constructor
  clientX: 100,
  clientY: 100
});

alert(event.clientX); // undefined, the unknown property is ignored!</code></pre>
        </div>
      </div>
      
      </div><p>Technically, we can work around that by assigning directly <code>event.clientX=100</code> after creation. So that's a matter of convenience and following the rules. Browser-generated events always have the right type.</p>
<p>The full list of properties for different UI events is in the specification, for instance  
<a href="https://www.w3.org/TR/uievents/#mouseevent">MouseEvent</a>.</p>
<h2 id="chapter-713">
Custom events</h2>
<p>For our own, custom events like <code>"hello"</code> we should use <code>new CustomEvent</code>. Technically 
<a href="https://dom.spec.whatwg.org/#customevent">CustomEvent</a> is the same as <code>Event</code>, with one exception.</p>
<p>In the second argument (object) we can add an additional property <code>detail</code> for any custom information that we want to pass with the event.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-refresh="1" data-highlight-block="9-9" data-highlight-inline="5:10-27">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;h1 id="elem"&gt;Hello for John!&lt;/h1&gt;

&lt;script&gt;
  // additional details come with the event to the handler
  elem.addEventListener("hello", function(event) {
    alert(event.detail.name);
  });

  elem.dispatchEvent(new CustomEvent("hello", {
    detail: { name: "John" }
  });
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The <code>detail</code> property can have any data. Technically we could live without, because we can assign any properties into a regular <code>new Event</code> object after its creation. But <code>CustomEvent</code> provides the special <code>detail</code> field for it to evade conflicts with other event properties.</p>
<p>The event class tells something about “what kind of event” it is, and if the event is custom, then we should use <code>CustomEvent</code> just to be clear about what it is.</p>
<h2 id="chapter-714">
event.preventDefault()</h2>
<p>We can call <code>event.preventDefault()</code> on a script-generated event if <code>cancelable:true</code> flag is specified.</p>
<p>Of course, if the event has a non-standard name, then it's not known to the browser, and there's no “default browser action” for it.</p>
<p>But the event-generating code may plan some actions after <code>dispatchEvent</code>.</p>
<p>The call of <code>event.preventDefault()</code> is a way for the handler to send a signal that those actions shouldn't be performed.</p>
<p>In that case the call to <code>elem.dispatchEvent(event)</code> returns <code>false</code>. And the event-generating code knows that the processing shouldn't continue.</p>
<p>For instance, in the example below there's a <code>hide()</code> function. It generates the <code>"hide"</code> event on the element <code>#rabbit</code>, notifying all interested parties that the rabbit is going to hide.</p>
<p>A handler set by <code>rabbit.addEventListener('hide',...)</code> will learn about that and, if it wants, can prevent that action by calling <code>event.preventDefault()</code>. Then the rabbit won't hide:</p>
<div data-trusted="1" class="code-example" data-refresh="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;pre id="rabbit"&gt;
  |\   /|
   \|_|/
   /. .\
  =\_Y_/=
   {&gt;o&lt;}
&lt;/pre&gt;

&lt;script&gt;
  // hide() will be called automatically in 2 seconds
  function hide() {
    let event = new CustomEvent("hide", {
      cancelable: true // without that flag preventDefault doesn't work
    });
    if (!rabbit.dispatchEvent(event)) {
      alert('the action was prevented by a handler');
    } else {
      rabbit.hidden = true;
    }
  }

  rabbit.addEventListener('hide', function(event) {
    if (confirm("Call preventDefault?")) {
      event.preventDefault();
    }
  });

  // hide in 2 seconds
  setTimeout(hide, 2000);

&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-715">
Events-in-events are synchronous</h2>
<p>Usually events are processed asynchronously. That is: if the browser is processing <code>onclick</code> and in the process a new event occurs, then it awaits till <code>onclick</code> processing is finished.</p>
<p>The exception is when one event is initiated from within another one.</p>
<p>Then the control jumps to the nested event handler, and after it goes back.</p>
<p>For instance, here the nested <code>menu-open</code> event is processed synchronously, during the <code>onclick</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="menu"&gt;Menu (click me)&lt;/button&gt;

&lt;script&gt;
  // 1 -&gt; nested -&gt; 2
  menu.onclick = function() {
    alert(1);

    // alert("nested")
    menu.dispatchEvent(new CustomEvent("menu-open", {
      bubbles: true
    }));

    alert(2);
  };

  document.addEventListener('menu-open', () =&gt; alert('nested'))
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the nested event <code>menu-open</code> bubbles up and is handled on the <code>document</code>. The propagation of the nested event is fully finished before the processing gets back to the outer code (<code>onclick</code>).</p>
<p>That's not only about <code>dispatchEvent</code>, there are other cases. JavaScript in an event handler can call methods that lead to other events – they are too processed synchronously.</p>
<p>If we don't like it, we can either put the <code>dispatchEvent</code> (or other event-triggering call) at the end of <code>onclick</code> or, if inconvenient, wrap it in <code>setTimeout(...,0)</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="menu"&gt;Menu (click me)&lt;/button&gt;

&lt;script&gt;
  // 1 -&gt; 2 -&gt; nested
  menu.onclick = function() {
    alert(1);

    // alert(2)
    setTimeout(() =&gt; menu.dispatchEvent(new CustomEvent("menu-open", {
      bubbles: true
    })), 0);

    alert(2);
  };

  document.addEventListener('menu-open', () =&gt; alert('nested'))
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-716">
Summary</h2>
<p>To generate an event, we first need to create an event object.</p>
<p>The generic <code>Event(name, options)</code> constructor accepts an arbitrary event name and the <code>options</code> object with two properties:</p>
<ul>
<li><code>bubbles: true</code> if the event should bubble.</li>
<li><code>cancelable: true</code> is the <code>event.preventDefault()</code> should work.</li>
</ul>
<p>Other constructors of native events like <code>MouseEvent</code>, <code>KeyboardEvent</code> and so on accept properties specific to that event type. For instance, <code>clientX</code> for mouse events.</p>
<p>For custom events we should use <code>CustomEvent</code> constructor. It has an additional option named <code>detail</code>, we should assign the event-specific data to it. Then all handlers can access it as <code>event.detail</code>.</p>
<p>Despite the technical possibility to generate browser events like <code>click</code> or <code>keydown</code>, we should use with the great care.</p>
<p>We shouldn't generate browser events as it's a hacky way to run handlers. That's a bad architecture most of the time.</p>
<p>Native events might be generated:</p>
<ul>
<li>As a dirty hack to make 3rd-party libraries work the needed way, if they don't provide other means of interaction.</li>
<li>For automated testing, to “click the button” in the script and see if the interface reacts correctly.</li>
</ul>
<p>Custom events with our own names are often generated for architectural purposes, to signal what happens inside our menus, sliders, carousels etc.</p>
<h6 id="chapter-717"></h6>
<h1 class="main__header-title" id="chapter-718">Events in details</h1>
<p>Here we cover most important events and details of working with them.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/mouse-events-basics" class="lessons-list__link">Mouse events basics</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/mousemove-mouseover-mouseout-mouseenter-mouseleave" class="lessons-list__link">Moving: mouseover/out, mouseenter/leave</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/mouse-drag-and-drop" class="lessons-list__link">Drag'n'Drop with mouse events</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/keyboard-events" class="lessons-list__link">Keyboard: keydown and keyup</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/onscroll" class="lessons-list__link">Scrolling</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/onload-ondomcontentloaded" class="lessons-list__link">Page lifecycle: DOMContentLoaded, load, beforeunload, unload</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/onload-onerror" class="lessons-list__link">Resource loading: onload and onerror</a></li></ol></div>


<h6 id="chapter-719"></h6>
<h1 class="main__header-title" id="chapter-720">Mouse events basics</h1>
<p>Mouse events come not only from “mouse manipulators”, but are also emulated on touch devices, to make them compatible.</p>
<p>In this chapter we'll get into more details about mouse events and their properties.</p>


<h2 id="chapter-721">
Mouse event types</h2>
<p>We can split mouse events into two categories: “simple” and “complex”</p>
<h3>
Simple events</a></h3><p>The most used simple events are:</p>
<dl>
<dt><code>mousedown/mouseup</code></dt>
<dd>Mouse button is clicked/released over an element.</dd>
<dt><code>mouseover/mouseout</code></dt>
<dd>Mouse pointer comes over/out from an element.</dd>
<dt><code>mousemove</code></dt>
<dd>Every mouse move over an element triggers that event.</dd>
</dl>
<p>…There are several other event types too, we'll cover them later.</p>
<h3>
Complex events</a></h3><dl>
<dt><code>click</code></dt>
<dd>Triggers after <code>mousedown</code> and then <code>mouseup</code> over the same element if the left mouse button was used.</dd>
<dt><code>contextmenu</code></dt>
<dd>Triggers after <code>mousedown</code> if the right mouse button was used.</dd>
<dt><code>dblclick</code></dt>
<dd>Triggers after a double click over an element.</dd>
</dl>
<p>Complex events are made of simple ones, so in theory we could live without them. But they exist, and that's good, because they are convenient.</p>
<h3>
Events order</a></h3><p>An action may trigger multiple events.</p>
<p>For instance, a click first triggers <code>mousedown</code>, when the button is pressed, then <code>mouseup</code> and <code>click</code> when it's released.</p>
<p>In cases when a single action initiates multiple events, their order is fixed. That is, the handlers are called in the order <code>mousedown</code> → <code>mouseup</code> → <code>click</code>. Events are handled in the same sequence:  <code>onmouseup</code> finishes before <code>onclick</code> runs.</p>
<p>Click the button below and you'll see the events. Try double-click too.</p>
<p>On the teststand below all mouse events are logged, and if there are more than 1 second delay between them, then they are separated by a horizontal ruler.</p>
<p>Also we can see the <code>which</code> property that allows to detect the mouse button.</p>
<p><input onmousedown="return logMouse(event)" onmouseup="return logMouse(event)" onclick="return logMouse(event)" oncontextmenu="return logMouse(event)" ondblclick="return logMouse(event)" value="Click me with the right or the left mouse button" type="button"> <input onclick="logClear('test')" value="Clear" type="button"> </p><form id="testform" name="testform"> <textarea style="font-size:12px;height:150px;width:360px;"></textarea></form><p></p>
<h2 id="chapter-722">
Getting the button: which</h2>
<p>Click-related events always have the <code>which</code> property that allows to get the button.</p>
<p>It is not used for <code>click</code> and <code>contextmenu</code> events, because the former happens only on left-click, and the latter – only on right-click.</p>
<p>But if we track <code>mousedown</code> and <code>mouseup</code>, then we need it, because these events trigger on any button, so <code>which</code> allows to distinguish between “right-mousedown” and “left-mousedown”.</p>
<p>There are the three possible values:</p>
<ul>
<li><code>event.which == 1</code> – the left button</li>
<li><code>event.which == 2</code> – the middle button</li>
<li><code>event.which == 3</code> – the right button</li>
</ul>
<p>The middle button is somewhat exotic right now and is very rarely used.</p>
<h2 id="chapter-723">
Modifiers: shift, alt, ctrl and meta</h2>
<p>All mouse events include the information about pressed modifier keys.</p>
<p>The properties are:</p>
<ul>
<li><code>shiftKey</code></li>
<li><code>altKey</code></li>
<li><code>ctrlKey</code></li>
<li><code>metaKey</code> (<kbd class="shortcut">Cmd</kbd> for Mac)</li>
</ul>
<p>For instance, the button below only works on <kbd class="shortcut">Alt<span class="shortcut__plus">+</span>Shift</kbd>+click:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="button"&gt;Alt+Shift+Click on me!&lt;/button&gt;

&lt;script&gt;
  button.onclick = function(event) {
    if (event.altKey &amp;&amp; event.shiftKey) {
      alert('Hooray!');
    }
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-c2cpq9" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Attention: on Mac it's usually <code>Cmd</code> instead of <code>Ctrl</code></span></div>
            <div class="important__content"><p>On Windows and Linux there are modifier keys <kbd class="shortcut">Alt</kbd>, <kbd class="shortcut">Shift</kbd> and <kbd class="shortcut">Ctrl</kbd>. On Mac there's one more: <kbd class="shortcut">Cmd</kbd>, it corresponds to the property <code>metaKey</code>.</p>
<p>In most cases when Windows/Linux uses <kbd class="shortcut">Ctrl</kbd>, on Mac people use <kbd class="shortcut">Cmd</kbd>. So where a Windows user presses <kbd class="shortcut">Ctrl<span class="shortcut__plus">+</span>Enter</kbd> or <kbd class="shortcut">Ctrl<span class="shortcut__plus">+</span>A</kbd>, a Mac user would press <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>Enter</kbd> or <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>A</kbd>, and so on, most apps use <kbd class="shortcut">Cmd</kbd> instead of <kbd class="shortcut">Ctrl</kbd>.</p>
<p>So if we want to support combinations like <kbd class="shortcut">Ctrl</kbd>+click, then for Mac it makes sense to use  <kbd class="shortcut">Cmd</kbd>+click. That's more comfortable for Mac users.</p>
<p>Even if we'd like to force Mac users to <kbd class="shortcut">Ctrl</kbd>+click – that's kind of difficult. The problem is: a left-click with <kbd class="shortcut">Ctrl</kbd> is interpreted as a <em>right-click</em> on Mac, and it generates the <code>contextmenu</code> event, not <code>click</code> like Windows/Linux.</p>
<p>So if we want users of all operational systems to feel comfortable, then together with <code>ctrlKey</code> we should use <code>metaKey</code>.</p>
<p>For JS-code it means that we should check <code>if (event.ctrlKey || event.metaKey)</code>.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">There are also mobile devices</span></div>
            <div class="important__content"><p>Keyboard combinations are good as an addition to the workflow. So that if the visitor has a
keyboard – it works. And if your device doesn't have it – then there's another way to do the same.</p>
</div></div>
<h2 id="chapter-724">
Coordinates: clientX/Y, pageX/Y</h2>
<p>All mouse events have coordinates in two flavours:</p>
<ol>
<li>Window-relative: <code>clientX</code> and <code>clientY</code>.</li>
<li>Document-relative: <code>pageX</code> and <code>pageY</code>.</li>
</ol>
<p>For instance, if we have a window of the size 500x500, and the mouse is in the left-upper corner, then <code>clientX</code> and <code>clientY</code> are <code>0</code>. And if the mouse is in the center, then <code>clientX</code> and <code>clientY</code> are <code>250</code>, no matter what place in the document it is. They are similar to <code>position:fixed</code>.</p>
<p>Move the mouse over the input field to see <code>clientX/clientY</code> (it's in the <code>iframe</code>, so coordinates are relative to that <code>iframe</code>):</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input onmousemove="this.value=event.clientX+':'+event.clientY" value="Mouse over me"&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-9vqlvc" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>Document-relative coordinates are counted from the left-upper corner of the document, not the window.
Coordinates <code>pageX</code>, <code>pageY</code> are similar to <code>position:absolute</code> on the document level.</p>
<p>You can read more about coordinates in the chapter 
<a href="http://javascript.info/coordinates">Coordinates</a>.</p>
<h2 id="chapter-725">
No selection on mousedown</h2>
<p>Mouse clicks have a side-effect that may be disturbing. A double click selects the text.</p>
<p>If we want to handle click events ourselves, then the “extra” selection doesn't look good.</p>
<p>For instance, a double-click on the text below selects it in addition to our handler:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;b ondblclick="alert('dblclick')"&gt;Double-click me&lt;/b&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-cqrn02" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>There's a CSS way to stop the selection: the <code>user-select</code> property from 
<a href="https://www.w3.org/TR/css-ui-4/">CSS UI Draft</a>.</p>
<p>Most browsers support it with prefixes:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  b {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
&lt;/style&gt;

Before...
&lt;b ondblclick="alert('Test')"&gt;
  Unselectable
&lt;/b&gt;
...After</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-2yclks" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>Now if you double-click on “Unselectable”, it doesn't get selected. Seems to work.</p>
<p>…But there is a potential problem! The text became truly unselectable. Even if a user starts the selection from “Before” and ends with “After”, the selection skips “Unselectable” part. Do we really want to make our text unselectable?</p>
<p>Most of time, we don't. A user may have valid reasons to select the text, for copying or other needs. That may be disturbing if we don't allow him to do it. So the solution is not that good.</p>
<p>What we want is to prevent the selection on double-click, that's it.</p>
<p>A text selection is the default browser action on <code>mousedown</code> event. So the alternative solution would be to handle <code>mousedown</code> and prevent it, like this:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true" data-highlight-inline="1:32-58">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">Before...
&lt;b ondblclick="alert('Click!')" onmousedown="return false"&gt;
  Double-click me
&lt;/b&gt;
...After</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-5zhm1e" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>Now the bold element is not selected on double clicks.</p>
<p>From the other hand, the text inside it is still selectable. The selection should start not on the text itself, but before or after it. Usually that's fine.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Canceling the selection</span></div>
            <div class="important__content"><p>Instead of <em>preventing</em> the selection, we can cancel it “post-factum” in the event handler.</p>
<p>Here's how:</p>
<div data-trusted="1" class="code-example" data-demo-height="50" data-autorun="true" data-highlight-inline="1:15-47">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">Before...
&lt;b ondblclick="getSelection().removeAllRanges()"&gt;
  Double-click me
&lt;/b&gt;
...After</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-2168qs" style="height:50px" src="about:blank"></iframe>
      </div>
      </div><p>If you double-click on the bold element, then the selection appears and then is immediately removed. That doesn't look nice though.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Preventing copying</span></div>
            <div class="important__content"><p>If we want to disable selection to protect our content from copy-pasting, then we can use another event: <code>oncopy</code>.</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-inline="0:5-54">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div oncopy="alert('Copying forbidden!');return false"&gt;
  Dear user,
  The copying is forbidden for you.
  If you know JS or HTML, then you can get everything from the page source though.
&lt;/div&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-7ga6m8" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>If you try to copy a piece of text in the <code>&lt;div&gt;</code>, that won't work, because the default action <code>oncopy</code> is prevented.</p>
<p>Surely that can't stop the user from opening HTML-source, but not everyone knows how to do it.</p>
</div></div>
<h2 id="chapter-726">
Summary</h2>
<p>Mouse events have following properties:</p>
<ul>
<li>
<p>Button: <code>which</code>.</p>
</li>
<li>
<p>Modifier keys (<code>true</code> if pressed): <code>altKey</code>, <code>ctrlKey</code>, <code>shiftKey</code> and <code>metaKey</code> (Mac).</p>
<ul>
<li>If you want to handle <kbd class="shortcut">Ctrl</kbd>, then don't forget Mac users, they use <kbd class="shortcut">Cmd</kbd>, so it's better to check <code>if (e.metaKey || e.ctrlKey)</code>.</li>
</ul>
</li>
<li>
<p>Window-relative coordinates: <code>clientX/clientY</code>.</p>
</li>
<li>
<p>Document-relative coordinates: <code>pageX/clientX</code>.</p>
</li>
</ul>
<p>In the tasks below it's also important to deal with the selection as an unwanted side-effect of clicks.</p>
<p>There are several ways, for instance:</p>
<ol>
<li>CSS-property <code>user-select:none</code> (with browser prefixes) completely disables it.</li>
<li>Cancel the selection post-factum using <code>getSelection().removeAllRanges()</code>.</li>
<li>Handle <code>mousedown</code> and prevent the default action (usually the best).</li>
</ol>
<div class="tasks"><h2 id="chapter-727" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#selectable-list" name="selectable-list" class="main__anchor">Selectable list</a></h3>
<a href="http://javascript.info/task/selectable-list" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a list where elements are selectable, like in file-managers.</p>
<ul>
<li>A click on a list element selects only that element (adds the class <code>.selected</code>), deselects all others.</li>
<li>If a click is made with <kbd class="shortcut">Ctrl</kbd> (<kbd class="shortcut">Cmd</kbd> for Mac), then the selection is toggled on the element, but other elements are not modified.</li>
</ul>
<p>The demo:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:180px" src="https://en.js.cx/task/selectable-list/solution/"></iframe>
  </div><p>P.S. For this task we can assume that list items are text-only. No nested tags.
P.P.S. Prevent the native browser selection of the text on clicks.</p>
<p>
<a href="http://plnkr.co/edit/aonzTKO5ZDRrQPzrZTRN?p=preview" target="_blank" data-plunk-id="aonzTKO5ZDRrQPzrZTRN">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/4jACx1WFD45bYfgIbYVh?p=preview" target="_blank" data-plunk-id="4jACx1WFD45bYfgIbYVh">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-728"></h6>
<h1 class="main__header-title" id="chapter-729">Moving: mouseover/out, mouseenter/leave</h1>
<p>Let's dive into more details about events that happen when mouse moves between elements.</p>


<h2 id="chapter-730">
Mouseover/mouseout, relatedTarget</h2>
<p>The <code>mouseover</code> event occurs when a mouse pointer comes over an element, and <code>mouseout</code> – when it leaves.</p>
      <img src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseover-mouseout.png">
<p>These events are special, because they have a <code>relatedTarget</code>.</p>
<p>For <code>mouseover</code>:</p>
<ul>
<li><code>event.target</code> – is the element where the mouse came over.</li>
<li><code>event.relatedTarget</code> – is the element from which the mouse came.</li>
</ul>
<p>For <code>mouseout</code> the reverse:</p>
<ul>
<li><code>event.target</code> – is the element that mouse left.</li>
<li><code>event.relatedTarget</code> – is the new under-the-pointer element (that mouse left for).</li>
</ul>
<p>In the example below each face feature is an element. When you move the mouse, you can see mouse events in the text area.</p>
<p>Each event has the information about where the element came and where it came from.</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseoverout/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/J1qEA0z2HK6NCUyZOsLv?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:280px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseoverout/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>container.onmouseover = container.onmouseout = handler;

function handler(event) {

  function str(el) {
    if (!el) return "null"
    return el.className || el.tagName;
  }

  log.value += event.type + ': ' +
    'target=' + str(event.target) +
    ', relatedTarget=' + str(event.relatedTarget) + "\n";
  log.scrollTop = log.scrollHeight;

  if (event.type == 'mouseover') {
    event.target.style.background = 'pink'
  }
  if (event.type == 'mouseout') {
    event.target.style.background = ''
  }
}</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>body,
html {
  margin: 0;
  padding: 0;
}

#container {
  border: 1px solid brown;
  padding: 10px;
  width: 330px;
  margin-bottom: 5px;
  box-sizing: border-box;
}

#log {
  height: 120px;
  width: 350px;
  display: block;
  box-sizing: border-box;
}

[class^="smiley-"] {
  display: inline-block;
  width: 70px;
  height: 70px;
  border-radius: 50%;
  margin-right: 20px;
}

.smiley-green {
  background: #a9db7a;
  border: 5px solid #92c563;
  position: relative;
}

.smiley-green .left-eye {
  width: 18%;
  height: 18%;
  background: #84b458;
  position: relative;
  top: 29%;
  left: 22%;
  border-radius: 50%;
  float: left;
}

.smiley-green .right-eye {
  width: 18%;
  height: 18%;
  border-radius: 50%;
  position: relative;
  background: #84b458;
  top: 29%;
  right: 22%;
  float: right;
}

.smiley-green .smile {
  position: absolute;
  top: 67%;
  left: 16.5%;
  width: 70%;
  height: 20%;
  overflow: hidden;
}

.smiley-green .smile:after,
.smiley-green .smile:before {
  content: "";
  position: absolute;
  top: -50%;
  left: 0%;
  border-radius: 50%;
  background: #84b458;
  height: 100%;
  width: 97%;
}

.smiley-green .smile:after {
  background: #84b458;
  height: 80%;
  top: -40%;
  left: 0%;
}

.smiley-yellow {
  background: #eed16a;
  border: 5px solid #dbae51;
  position: relative;
}

.smiley-yellow .left-eye {
  width: 18%;
  height: 18%;
  background: #dba652;
  position: relative;
  top: 29%;
  left: 22%;
  border-radius: 50%;
  float: left;
}

.smiley-yellow .right-eye {
  width: 18%;
  height: 18%;
  border-radius: 50%;
  position: relative;
  background: #dba652;
  top: 29%;
  right: 22%;
  float: right;
}

.smiley-yellow .smile {
  position: absolute;
  top: 67%;
  left: 19%;
  width: 65%;
  height: 14%;
  background: #dba652;
  overflow: hidden;
  border-radius: 8px;
}

.smiley-red {
  background: #ee9295;
  border: 5px solid #e27378;
  position: relative;
}

.smiley-red .left-eye {
  width: 18%;
  height: 18%;
  background: #d96065;
  position: relative;
  top: 29%;
  left: 22%;
  border-radius: 50%;
  float: left;
}

.smiley-red .right-eye {
  width: 18%;
  height: 18%;
  border-radius: 50%;
  position: relative;
  background: #d96065;
  top: 29%;
  right: 22%;
  float: right;
}

.smiley-red .smile {
  position: absolute;
  top: 57%;
  left: 16.5%;
  width: 70%;
  height: 20%;
  overflow: hidden;
}

.smiley-red .smile:after,
.smiley-red .smile:before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0%;
  border-radius: 50%;
  background: #d96065;
  height: 100%;
  width: 97%;
}

.smiley-red .smile:after {
  background: #d96065;
  height: 80%;
  top: 60%;
  left: 0%;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;div id="container"&gt;
    &lt;div class="smiley-green"&gt;
      &lt;div class="left-eye"&gt;&lt;/div&gt;
      &lt;div class="right-eye"&gt;&lt;/div&gt;
      &lt;div class="smile"&gt;&lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="smiley-yellow"&gt;
      &lt;div class="left-eye"&gt;&lt;/div&gt;
      &lt;div class="right-eye"&gt;&lt;/div&gt;
      &lt;div class="smile"&gt;&lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="smiley-red"&gt;
      &lt;div class="left-eye"&gt;&lt;/div&gt;
      &lt;div class="right-eye"&gt;&lt;/div&gt;
      &lt;div class="smile"&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;textarea id="log"&gt;Events will show up here!
&lt;/textarea&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><div class="important important_warn">
            <div class="important__header"><span class="important__type"><code>relatedTarget</code> can be <code>null</code></span></div>
            <div class="important__content"><p>The <code>relatedTarget</code> property can be <code>null</code>.</p>
<p>That's normal and just means that the mouse came not from another element, but from out of the window. Or that it left the window.</p>
<p>We should keep that possibility in mind when using <code>event.relatedTarget</code> in our code. If we access <code>event.relatedTarget.tagName</code>, then there will be an error.</p>
</div></div>
<h2 id="chapter-731">
Events frequency</h2>
<p>The <code>mousemove</code> event triggers when the mouse moves. But that doesn't mean that every pixel leads to an event.</p>
<p>The browser checks the mouse position from time to time. And if it notices changes then triggers the events.</p>
<p>That means that if the visitor is moving the mouse very fast then DOM-elements may be skipped:</p>
      <img src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseover-mouseout-over-elems.png">
<p>If the mouse moves very fast from <code>#FROM</code> to <code>#TO</code> elements as painted above, then intermediate <code>&lt;div&gt;</code> (or some of them) may be skipped. The <code>mouseout</code> event may trigger on <code>#FROM</code> and then immediately <code>mouseover</code> on <code>#TO</code>.</p>
<p>In practice that's helpful, because if there may be many intermediate elements. We don't really want to process in and out of each one.</p>
<p>From the other side, we should keep in mind that we can't assume that the mouse slowly moves from one event to another. No, it can “jump”.</p>
<p>In particular it's possible that the cursor jumps right inside the middle of the page from out of the window. And <code>relatedTarget=null</code>, because it came from “nowhere”:</p>
      <img src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseover-mouseout-from-outside.png">
<div style="display:none">
In case of a fast move, intermediate elements may trigger no events. But if the mouse enters the element (`mouseover`), when we're guaranteed to have `mouseout` when it leaves it.
</div>
<p>Check it out “live” on a teststand below.</p>
<p>The HTML is two nested <code>&lt;div&gt;</code> elements. If you move the mouse fast over them, then there may be no events at all, or maybe only the red div triggers events, or maybe the green one.</p>
<p>Also try to move the pointer over the red <code>div</code>, and then move it out quickly down through the green one. If the movement is fast enough then the parent element is ignored.</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseoverout-fast/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/z96tXeolZqGRCCWN80jy?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:360px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseoverout-fast/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>green.onmouseover = green.onmouseout = green.onmousemove = handler;

function handler(event) {
  let type = event.type;
  while (type &lt; 11) type += ' ';

  log(type + " target=" + event.target.id)
  return false;
}


function clearText() {
  text.value = "";
  lastMessage = "";
}

let lastMessageTime = 0;
let lastMessage = "";
let repeatCounter = 1;

function log(message) {
  if (lastMessageTime == 0) lastMessageTime = new Date();

  let time = new Date();

  if (time - lastMessageTime &gt; 500) {
    message = '------------------------------\n' + message;
  }

  if (message === lastMessage) {
    repeatCounter++;
    if (repeatCounter == 2) {
      text.value = text.value.trim() + ' x 2\n';
    } else {
      text.value = text.value.slice(0, text.value.lastIndexOf('x') + 1) + repeatCounter + "\n";
    }

  } else {
    repeatCounter = 1;
    text.value += message + "\n";
  }

  text.scrollTop = text.scrollHeight;

  lastMessageTime = time;
  lastMessage = message;
}</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#green {
  height: 50px;
  width: 160px;
  background: green;
}

#red {
  height: 20px;
  width: 110px;
  background: red;
  color: white;
  font-weight: bold;
  padding: 5px;
  text-align: center;
  margin: 20px;
}

#text {
  font-size: 12px;
  height: 200px;
  width: 360px;
  display: block;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;div id="green"&gt;
    &lt;div id="red"&gt;Test&lt;/div&gt;
  &lt;/div&gt;

  &lt;input onclick="clearText()" value="Clear" type="button"&gt;

  &lt;textarea id="text"&gt;&lt;/textarea&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><h2 id="chapter-732">
“Extra” mouseout when leaving for a child</h2>
<p>Imagine – a mouse pointer entered an element. The <code>mouseover</code> triggered. Then the cursor goes into a child element. The interesting fact is that <code>mouseout</code> triggers in that case. The cursor is still in the element, but we have a <code>mouseout</code> from it!</p>
      <img src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseover-to-child.png">
<p>That seems strange, but can be easily explained.</p>
<p><strong>According to the browser logic, the mouse cursor may be only over a <em>single</em> element at any time – the most nested one (and top by z-index).</strong></p>
<p>So if it goes to another element (even a descendant), then it leaves the previous one. That simple.</p>
<p>There's a funny consequence that we can see on the example below.</p>
<p>The red <code>&lt;div&gt;</code> is nested inside the blue one. The blue <code>&lt;div&gt;</code> has <code>mouseover/out</code> handlers that log all events in the textarea below.</p>
<p>Try entering the blue element and then moving the mouse on the red one – and watch the events:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseoverout-child/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/3N4s2P1duO6SRGmDk9AH?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:360px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseoverout-child/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>function mouselog(event) {
  text.value += event.type + ' [target: ' + event.target.className + ']\n'
  text.scrollTop = text.scrollHeight
}</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>.blue {
  background: blue;
  width: 160px;
  height: 160px;
  position: relative;
}

.red {
  background: red;
  width: 100px;
  height: 100px;
  position: absolute;
  left: 30px;
  top: 30px;
}

textarea {
  height: 100px;
  width: 400px;
  display: block;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;div class="blue" onmouseover="mouselog(event)" onmouseout="mouselog(event)"&gt;
    &lt;div class="red"&gt;&lt;/div&gt;
  &lt;/div&gt;

  &lt;textarea id="text"&gt;&lt;/textarea&gt;
  &lt;input type="button" onclick="text.value=''" value="Clear"&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><ol>
<li>On entering the blue one – we get <code>mouseover [target: blue]</code>.</li>
<li>Then after moving from the blue to the red one – we get <code>mouseout [target: blue]</code> (left the parent).</li>
<li>…And immediately <code>mouseover [target: red]</code>.</li>
</ol>
<p>So, for a handler that does not take <code>target</code> into account, it looks like we left the parent in <code>mouseout</code> in <code>(2)</code> and returned back to it by <code>mouseover</code> in <code>(3)</code>.</p>
<p>If we perform some actions on entering/leaving the element, then we'll get a lot of extra “false” runs. For simple stuff may be unnoticeable. For complex things that may bring unwanted side-effects.</p>
<p>We can fix it by using <code>mouseenter/mouseleave</code> events instead.</p>
<h2 id="chapter-733">
Events mouseenter and mouseleave</h2>
<p>Events <code>mouseenter/mouseleave</code> are like <code>mouseover/mouseout</code>. They also trigger when the mouse pointer enters/leaves the element.</p>
<p>But there are two differences:</p>
<ol>
<li>Transitions inside the element are not counted.</li>
<li>Events <code>mouseenter/mouseleave</code> do not bubble.</li>
</ol>
<p>These events are intuitively very clear.</p>
<p>When the pointer enters an element – the <code>mouseenter</code> triggers, and then doesn't matter where it goes while inside the element. The <code>mouseleave</code> event only triggers when the cursor leaves it.</p>
<p>If we make the same example, but put <code>mouseenter/mouseleave</code> on the blue <code>&lt;div&gt;</code>, and do the same – we can see that events trigger only on entering and leaving the blue <code>&lt;div&gt;</code>. No extra events when going to the red one and back. Children are ignored.</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseleave/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/HfqW9GvOiWuJ9Sbl866n?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:340px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseleave/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>function log(event) {
  text.value += event.type + ' [target: ' + event.target.id + ']\n';
  text.scrollTop = text.scrollHeight;
}</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#blue {
  background: blue;
  width: 160px;
  height: 160px;
  position: relative;
}

#red {
  background: red;
  width: 70px;
  height: 70px;
  position: absolute;
  left: 45px;
  top: 45px;
}

#text {
  display: block;
  height: 100px;
  width: 400px;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;div id="blue" onmouseenter="log(event)" onmouseleave="log(event)"&gt;
    &lt;div id="red"&gt;&lt;/div&gt;
  &lt;/div&gt;

  &lt;textarea id="text"&gt;&lt;/textarea&gt;
  &lt;input type="button" onclick="text.value=''" value="Clear"&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><h2 id="chapter-734">
Event delegation</h2>
<p>Events <code>mouseenter/leave</code> are very simple and easy to use. But they do not bubble. So we can't use event delegation with them.</p>
<p>Imagine we want to handle mouse enter/leave for table cells. And there are hundreds of cells.</p>
<p>The natural solution would be – to set the handler on <code>&lt;table&gt;</code> and process events there. But <code>mouseenter/leave</code> don't bubble. So if such event happens on <code>&lt;td&gt;</code>, then only a handler on that <code>&lt;td&gt;</code> can catch it.</p>
<p>Handlers for <code>mouseenter/leave</code> on <code>&lt;table&gt;</code> only trigger on entering/leaving the whole table. It's impossible to get any information about transitions inside it.</p>
<p>Not a problem – let's use <code>mouseover/mouseout</code>.</p>
<p>A simple handler may look like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// let's highlight cells under mouse
table.onmouseover = function(event) {
  let target = event.target;
  target.style.background = 'pink';
};

table.onmouseout = function(event) {
  let target = event.target;
  target.style.background = '';
};</code></pre>
        </div>
      </div>
      
      </div><div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseenter-mouseleave-delegation/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/ndPjggDJcPkyQfqCrit0?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:480px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseenter-mouseleave-delegation/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>table.onmouseover = function(event) {
  let target = event.target;
  target.style.background = 'pink';
  text.value += "mouseover " + target.tagName + "\n";
  text.scrollTop = text.scrollHeight;
};

table.onmouseout = function(event) {
  let target = event.target;
  target.style.background = '';
  text.value += "mouseout " + target.tagName + "\n";
  text.scrollTop = text.scrollHeight;
};</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#text {
  display: block;
  height: 100px;
  width: 456px;
}

#table th {
  text-align: center;
  font-weight: bold;
}

#table td {
  width: 150px;
  white-space: nowrap;
  text-align: center;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 12px;
}

#table .nw {
  background: #999;
}

#table .n {
  background: #03f;
  color: #fff;
}

#table .ne {
  background: #ff6;
}

#table .w {
  background: #ff0;
}

#table .c {
  background: #60c;
  color: #fff;
}

#table .e {
  background: #09f;
  color: #fff;
}

#table .sw {
  background: #963;
  color: #fff;
}

#table .s {
  background: #f60;
  color: #fff;
}

#table .se {
  background: #0c3;
  color: #fff;
}

#table .highlight {
  background: red;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;


  &lt;table id="table"&gt;
    &lt;tr&gt;
      &lt;th colspan="3"&gt;&lt;em&gt;Bagua&lt;/em&gt; Chart: Direction, Element, Color, Meaning&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class="nw"&gt;&lt;strong&gt;Northwest&lt;/strong&gt;
        &lt;br&gt;Metal
        &lt;br&gt;Silver
        &lt;br&gt;Elders
      &lt;/td&gt;
      &lt;td class="n"&gt;&lt;strong&gt;North&lt;/strong&gt;
        &lt;br&gt;Water
        &lt;br&gt;Blue
        &lt;br&gt;Change
      &lt;/td&gt;
      &lt;td class="ne"&gt;&lt;strong&gt;Northeast&lt;/strong&gt;
        &lt;br&gt;Earth
        &lt;br&gt;Yellow
        &lt;br&gt;Direction
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class="w"&gt;&lt;strong&gt;West&lt;/strong&gt;
        &lt;br&gt;Metal
        &lt;br&gt;Gold
        &lt;br&gt;Youth
      &lt;/td&gt;
      &lt;td class="c"&gt;&lt;strong&gt;Center&lt;/strong&gt;
        &lt;br&gt;All
        &lt;br&gt;Purple
        &lt;br&gt;Harmony
      &lt;/td&gt;
      &lt;td class="e"&gt;&lt;strong&gt;East&lt;/strong&gt;
        &lt;br&gt;Wood
        &lt;br&gt;Blue
        &lt;br&gt;Future
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class="sw"&gt;&lt;strong&gt;Southwest&lt;/strong&gt;
        &lt;br&gt;Earth
        &lt;br&gt;Brown
        &lt;br&gt;Tranquility
      &lt;/td&gt;
      &lt;td class="s"&gt;&lt;strong&gt;South&lt;/strong&gt;
        &lt;br&gt;Fire
        &lt;br&gt;Orange
        &lt;br&gt;Fame
      &lt;/td&gt;
      &lt;td class="se"&gt;&lt;strong&gt;Southeast&lt;/strong&gt;
        &lt;br&gt;Wood
        &lt;br&gt;Green
        &lt;br&gt;Romance
      &lt;/td&gt;
    &lt;/tr&gt;

  &lt;/table&gt;

  &lt;textarea id="text"&gt;&lt;/textarea&gt;

  &lt;input type="button" onclick="text.value=''" value="Clear"&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p>These handlers work when going from any element to any inside the table.</p>
<p>But we'd like to handle only transitions in and out of <code>&lt;td&gt;</code> as a whole. And highlight the cells as a whole. We don't want to handle transitions that happen between the children of <code>&lt;td&gt;</code>.</p>
<p>One of solutions:</p>
<ul>
<li>Remember the currently highlighted <code>&lt;td&gt;</code> in a variable.</li>
<li>On <code>mouseover</code> – ignore the event if we're still inside the current <code>&lt;td&gt;</code>.</li>
<li>On <code>mouseout</code> – ignore if we didn't leave the current <code>&lt;td&gt;</code>.</li>
</ul>
<p>That filters out “extra” events when we are moving between the children of <code>&lt;td&gt;</code>.</p>
<p>Here's the full example with all details:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseenter-mouseleave-delegation-2/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/1SYZQP7ZNoXqoXJPRgIk?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:380px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/mousemove-mouseover-mouseout-mouseenter-mouseleave/mouseenter-mouseleave-delegation-2/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>// &lt;td&gt; under the mouse right now (if any)
let currentElem = null;

table.onmouseover = function(event) {
  if (currentElem) {
    // before entering a new element, the mouse always leaves the previous one
    // if we didn't leave &lt;td&gt; yet, then we're still inside it, so can ignore the event
    return;
  }

  let target = event.target.closest('td');
  if (!target || !table.contains(target)) return;

  // yeah we're inside &lt;td&gt; now
  currentElem = target;
  target.style.background = 'pink';
};


table.onmouseout = function(event) {
  // if we're outside of any &lt;td&gt; now, then ignore the event
  if (!currentElem) return;

  // we're leaving the element -- where to? Maybe to a child element?
  let relatedTarget = event.relatedTarget;
  if (relatedTarget) { // possible: relatedTarget = null
    while (relatedTarget) {
      // go up the parent chain and check -- if we're still inside currentElem
      // then that's an internal transition -- ignore it
      if (relatedTarget == currentElem) return;
      relatedTarget = relatedTarget.parentNode;
    }
  }

  // we left the element. really.
  currentElem.style.background = '';
  currentElem = null;
};</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#text {
  display: block;
  height: 100px;
  width: 456px;
}

#table th {
  text-align: center;
  font-weight: bold;
}

#table td {
  width: 150px;
  white-space: nowrap;
  text-align: center;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 12px;
}

#table .nw {
  background: #999;
}

#table .n {
  background: #03f;
  color: #fff;
}

#table .ne {
  background: #ff6;
}

#table .w {
  background: #ff0;
}

#table .c {
  background: #60c;
  color: #fff;
}

#table .e {
  background: #09f;
  color: #fff;
}

#table .sw {
  background: #963;
  color: #fff;
}

#table .s {
  background: #f60;
  color: #fff;
}

#table .se {
  background: #0c3;
  color: #fff;
}

#table .highlight {
  background: red;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;


  &lt;table id="table"&gt;
    &lt;tr&gt;
      &lt;th colspan="3"&gt;&lt;em&gt;Bagua&lt;/em&gt; Chart: Direction, Element, Color, Meaning&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class="nw"&gt;&lt;strong&gt;Northwest&lt;/strong&gt;
        &lt;br&gt;Metal
        &lt;br&gt;Silver
        &lt;br&gt;Elders
      &lt;/td&gt;
      &lt;td class="n"&gt;&lt;strong&gt;North&lt;/strong&gt;
        &lt;br&gt;Water
        &lt;br&gt;Blue
        &lt;br&gt;Change
      &lt;/td&gt;
      &lt;td class="ne"&gt;&lt;strong&gt;Northeast&lt;/strong&gt;
        &lt;br&gt;Earth
        &lt;br&gt;Yellow
        &lt;br&gt;Direction
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class="w"&gt;&lt;strong&gt;West&lt;/strong&gt;
        &lt;br&gt;Metal
        &lt;br&gt;Gold
        &lt;br&gt;Youth
      &lt;/td&gt;
      &lt;td class="c"&gt;&lt;strong&gt;Center&lt;/strong&gt;
        &lt;br&gt;All
        &lt;br&gt;Purple
        &lt;br&gt;Harmony
      &lt;/td&gt;
      &lt;td class="e"&gt;&lt;strong&gt;East&lt;/strong&gt;
        &lt;br&gt;Wood
        &lt;br&gt;Blue
        &lt;br&gt;Future
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td class="sw"&gt;&lt;strong&gt;Southwest&lt;/strong&gt;
        &lt;br&gt;Earth
        &lt;br&gt;Brown
        &lt;br&gt;Tranquility
      &lt;/td&gt;
      &lt;td class="s"&gt;&lt;strong&gt;South&lt;/strong&gt;
        &lt;br&gt;Fire
        &lt;br&gt;Orange
        &lt;br&gt;Fame
      &lt;/td&gt;
      &lt;td class="se"&gt;&lt;strong&gt;Southeast&lt;/strong&gt;
        &lt;br&gt;Wood
        &lt;br&gt;Green
        &lt;br&gt;Romance
      &lt;/td&gt;
    &lt;/tr&gt;

  &lt;/table&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p>Try to move the cursor in and out of table cells and inside them. Fast or slow – doesn't better. Only <code>&lt;td&gt;</code> as a whole is highlighted unlike the example before.</p>
<h2 id="chapter-735">
Summary</h2>
<p>We covered events <code>mouseover</code>, <code>mouseout</code>, <code>mousemove</code>, <code>mouseenter</code> and <code>mouseleave</code>.</p>
<p>Things that are good to note:</p>
<ul>
<li>A fast mouse move can make <code>mouseover, mousemove, mouseout</code> to skip intermediate elements.</li>
<li>Events <code>mouseover/out</code> and <code>mouseenter/leave</code> have an additional target: <code>relatedTarget</code>. That's the element that we are coming from/to, complementary to <code>target</code>.</li>
<li>Events <code>mouseover/out</code> trigger even when we go from the parent element to a child element. They assume that the mouse can be only over one element at one time – the deepest one.</li>
<li>Events <code>mouseenter/leave</code> do not bubble and do not trigger when the mouse goes to a child element. They only track whether the mouse comes inside and outside the element as a whole.</li>
</ul>
<div class="tasks"><h2 id="chapter-736" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#improved-tooltip-behavior" name="improved-tooltip-behavior" class="main__anchor">Improved tooltip behavior</a></h3>
<a href="http://javascript.info/task/behavior-nested-tooltip" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write JavaScript that shows a tooltip over an element with the attribute <code>data-tooltip</code>.</p>
<p>That's like the task 
<a href="http://javascript.info/task/behavior-tooltip">Tooltip behavior</a>, but here the annotated elements can be nested. The most deeply nested tooltip is shown.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div data-tooltip="Here – is the house interior" id="house"&gt;
  &lt;div data-tooltip="Here – is the roof" id="roof"&gt;&lt;/div&gt;
  ...
  &lt;a href="https://en.wikipedia.org/wiki/The_Three_Little_Pigs" data-tooltip="Read on…"&gt;Hover over me&lt;/a&gt;
&lt;/div&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The result in iframe:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/task/behavior-nested-tooltip/solution/"></iframe>
  </div><p>P.S. Hint: only one tooltip may show up at the same time.</p>
<p>
<a href="http://plnkr.co/edit/IwYiyZj32XtPAaZdtQEM?p=preview" target="_blank" data-plunk-id="IwYiyZj32XtPAaZdtQEM">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/UVlkGnsz79ArDV5lKFWO?p=preview" target="_blank" data-plunk-id="UVlkGnsz79ArDV5lKFWO">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#smart-tooltip" name="smart-tooltip" class="main__anchor">"Smart" tooltip</a></h3>
<a href="http://javascript.info/task/hoverintent" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Write a function that shows a tooltip over an element only if the visitor moves the mouse <em>over it</em>, but not <em>through it</em>.</p>
<p>In other words, if the visitor moves the mouse on the element and stopped – show the tooltip. And if he just moved the mouse through fast, then no need, who wants extra blinking?</p>
<p>Technically, we can measure the mouse speed over the element, and if it's slow then we assume that it comes “over the element” and show the tooltip, if it's fast – then we ignore it.</p>
<p>Make a universal object <code>new HoverIntent(options)</code> for it. With <code>options</code>:</p>
<ul>
<li><code>elem</code> – element to track.</li>
<li><code>over</code> – a function to call if the mouse is slowly moving the element.</li>
<li><code>out</code> – a function to call when the mouse leaves the element (if <code>over</code> was called).</li>
</ul>
<p>An example of using such object for the tooltip:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// a sample tooltip
let tooltip = document.createElement('div');
tooltip.className = "tooltip";
tooltip.innerHTML = "Tooltip";

// the object will track mouse and call over/out
new HoverIntent({
  elem,
  over() {
    tooltip.style.left = elem.getBoundingClientRect().left + 'px';
    tooltip.style.top = elem.getBoundingClientRect().bottom + 5 + 'px';
    document.body.append(tooltip);
  },
  out() {
    tooltip.remove();
  }
});</code></pre>
        </div>
      </div>
      
      </div><p>The demo:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:140px" src="https://en.js.cx/task/hoverintent/solution/"></iframe>
  </div><p>If you move the mouse over the “clock” fast then nothing happens, and if you do it slow or stop on them, then there will be a tooltip.</p>
<p>Please note: the tooltip doesn't “blink” when the cursor moves between the clock subelements.</p>
<p>
<a href="http://plnkr.co/edit/lWcug9G2AXQT4WI6H2Nt?p=preview" target="_blank" data-plunk-id="lWcug9G2AXQT4WI6H2Nt">Open the sandbox with tests.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The algorithm looks simple:</p>
<ol>
<li>Put <code>onmouseover/out</code> handlers on the element. Also can use <code>onmouseenter/leave</code> here, but they are less universal, won't work if we introduce delegation.</li>
<li>When a mouse cursor entered the element, start measuring the speed on <code>mousemove</code>.</li>
<li>If the speed is slow, then run <code>over</code>.</li>
<li>Later if we're out of the element, and <code>over</code> was executed, run <code>out</code>.</li>
</ol>
<p>The question is: “How to measure the speed?”</p>
<p>The first idea would be: to run our function every <code>100ms</code> and measure the distance between previous and new coordinates. If it's small, then the speed is small.</p>
<p>Unfortunately, there's no way to get “current mouse coordinates” in JavaScript. There's no function like <code>getCurrentMouseCoordinates()</code>.</p>
<p>The only way to get coordinates is to listen to mouse events, like <code>mousemove</code>.</p>
<p>So we can set a handler on <code>mousemove</code> to track coordinates and remember them. Then we can compare them, once per <code>100ms</code>.</p>
<p>P.S. Please note: the solution tests use <code>dispatchEvent</code> to see if the tooltip works right.</p>
<p>
<a href="http://plnkr.co/edit/cwuCzuPyDTK0TiJ01JBW?p=preview" target="_blank" data-plunk-id="cwuCzuPyDTK0TiJ01JBW">Open the solution with tests in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-737"></h6>
<h1 class="main__header-title" id="chapter-738">Drag'n'Drop with mouse events</h1>
<p>Drag'n'Drop is a great interface solution. Taking something, dragging and dropping is a clear and simple way to do many things, from copying and moving (see file managers) to ordering (drop into cart).</p>
<p>In the modern HTML standard there's a 
<a href="https://html.spec.whatwg.org/multipage/interaction.html#dnd">section about Drag Events</a>.</p>
<p>They are interesting, because they allow to solve simple tasks easily, and also allow to handle drag'n'drop of “external” files into the browser. So we can take a file in the OS file-manager and drop it into the browser window. Then JavaScript gains access to its contents.</p>
<p>But native Drag Events also have limitations. For instance, we can limit dragging by a certain area. Also we can't make it “horizontal” or “vertical” only. There are other drag'n'drop tasks that can't be implemented using that API.</p>
<p>So here we'll see how to implement Drag'n'Drop using mouse events. Not that hard either.</p>
<h2 id="chapter-739">
Drag'n'Drop algorithm</h2>
<p>The basic Drag'n'Drop algorithm looks like this:</p>
<ol>
<li>Catch <code>mousedown</code> on a draggable element.</li>
<li>Prepare the element to moving (maybe create a copy of it or whatever).</li>
<li>Then on <code>mousemove</code> move it by changing <code>left/top</code> and <code>position:absolute</code>.</li>
<li>On <code>mouseup</code> (button release) – perform all actions related to a finished Drag'n'Drop.</li>
</ol>
<p>These are the basics. We can extend it, for instance, by highlighting droppable (available for the drop) elements when hovering over them.</p>
<p>Here's the algorithm for drag'n'drop of a ball:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.onmousedown = function(event) { // (1) start the process

  // (2) prepare to moving: make absolute and on top by z-index
  ball.style.position = 'absolute';
  ball.style.zIndex = 1000;
  // move it out of any current parents directly into body
  // to make it positioned relative to the body
  document.body.append(ball);
  // ...and put that absolutely positioned ball under the cursor

  moveAt(event.pageX, event.pageY);

  // centers the ball at (pageX, pageY) coordinates
  function moveAt(pageX, pageY) {
    ball.style.left = pageX - ball.offsetWidth / 2 + 'px';
    ball.style.top = pageY - ball.offsetHeight / 2 + 'px';
  }

  function onMouseMove(event) {
    moveAt(event.pageX, event.pageY);
  }

  // (3) move the ball on mousemove
  document.addEventListener('mousemove', onMouseMove);

  // (4) drop the ball, remove unneeded handlers
  ball.onmouseup = function() {
    document.removeEventListener('mousemove', onMouseMove);
    ball.onmouseup = null;
  };

};</code></pre>
        </div>
      </div>
      
      </div><p>If we run the code, we can notice something strange. On the beginning of the drag'n'drop, the ball “forks”: we start to dragging it's “clone”.</p>
<p>Here's an example in action:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:230px" src="https://en.js.cx/article/mouse-drag-and-drop/ball/"></iframe>
  </div><p>Try to drag'n'drop the mouse and you'll see the strange behavior.</p>
<p>That's because the browser has its own Drag'n'Drop for images and some other elements that runs automatically and conflicts with ours.</p>
<p>To disable it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.ondragstart = function() {
  return false;
};</code></pre>
        </div>
      </div>
      
      </div><p>Now everything will be all right.</p>
<p>In action:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:230px" src="https://en.js.cx/article/mouse-drag-and-drop/ball2/"></iframe>
  </div><p>Another important aspect – we track <code>mousemove</code> on <code>document</code>, not on <code>ball</code>. From the first sight it may seem that the mouse is always over the ball, and we can put <code>mousemove</code> on it.</p>
<p>But as we remember, <code>mousemove</code> triggers often, but not for every pixel. So after swift move the cursor can jump from the ball somewhere in the middle of document (or even outside of the window).</p>
<p>So we should listen on <code>document</code> to catch it.</p>
<h2 id="chapter-740">
Correct positioning</h2>
<p>In the examples above the ball is always centered under the pointer:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.style.left = pageX - ball.offsetWidth / 2 + 'px';
ball.style.top = pageY - ball.offsetHeight / 2 + 'px';</code></pre>
        </div>
      </div>
      
      </div><p>Not bad, but there's a side-effect. To initiate the drag'n'drop can we <code>mousedown</code> anywhere on the ball. If do it at the edge, then the ball suddenly “jumps” to become centered.</p>
<p>It would be better if we keep the initial shift of the element relative to the pointer.</p>
<p>For instance, if we start dragging by the edge of the ball, then the cursor should remain over the edge while dragging.</p>
      <img src="http://javascript.info/article/mouse-drag-and-drop/ball_shift.png">
<ol>
<li>
<p>When a visitor presses the button (<code>mousedown</code>) – we can remember the distance from the cursor to the left-upper corner of the ball in variables <code>shiftX/shiftY</code>. We should keep that distance while dragging.</p>
<p>To get these shifts we can substract the coordinates:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// onmousedown
let shiftX = event.clientX - ball.getBoundingClientRect().left;
let shiftY = event.clientY - ball.getBoundingClientRect().top;</code></pre>
        </div>
      </div>
      
      </div><p>Please note that there's no method to get document-relative coordinates in JavaScript, so we use window-relative coordinates here.</p>
</li>
<li>
<p>Then while dragging we position the ball on the same shift relative to the pointer, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:32-38,3:31-37">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// onmousemove
// ball has position:absoute
ball.style.left = event.pageX - shiftX + 'px';
ball.style.top = event.pageY - shiftY + 'px';</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>The final code with better positioning:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-3" data-highlight-inline="13:30-36,14:29-35">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.onmousedown = function(event) {

  let shiftX = event.clientX - ball.getBoundingClientRect().left;
  let shiftY = event.clientY - ball.getBoundingClientRect().top;

  ball.style.position = 'absolute';
  ball.style.zIndex = 1000;
  document.body.append(ball);

  moveAt(event.pageX, event.pageY);

  // centers the ball at (pageX, pageY) coordinates
  function moveAt(pageX, pageY) {
    ball.style.left = pageX - shiftX + 'px';
    ball.style.top = pageY - shiftY + 'px';
  }

  function onMouseMove(event) {
    moveAt(event.pageX, event.pageY);
  }

  // (3) move the ball on mousemove
  document.addEventListener('mousemove', onMouseMove);

  // (4) drop the ball, remove unneeded handlers
  ball.onmouseup = function() {
    document.removeEventListener('mousemove', onMouseMove);
    ball.onmouseup = null;
  };

};

ball.ondragstart = function() {
  return false;
};</code></pre>
        </div>
      </div>
      
      </div><p>In action (inside <code>&lt;iframe&gt;</code>):</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:230px" src="https://en.js.cx/article/mouse-drag-and-drop/ball3/"></iframe>
  </div><p>The difference is especially noticeable if we drag the ball by it's right-bottom corner. In the previous example the ball “jumps” under the pointer. Now it fluently follows the cursor from the current position.</p>
<h2 id="chapter-741">
Detecting droppables</h2>
<p>In previous examples the ball could be dropped just “anywhere” to stay. In real-life we usually take one element and drop it onto another. For instance, a file into a folder, or a user into a trash can or whatever.</p>
<p>Abstractly, we take a “draggable” element and drop it onto “droppable” element.</p>
<p>We need to know the target droppable at the end of Drag'n'Drop – to do the corresponding action, and, preferably, during the dragging process, to highlight it.</p>
<p>The solution is kind-of interesting and just a little bit tricky, so let's cover it here.</p>
<p>What's the first idea? Probably to put <code>onmouseover/mouseup</code> handlers on potential droppables and detect when the mouse pointer appears over them. And then we know that we are dragging/dropping on that element.</p>
<p>But that doesn't work.</p>
<p>The problem is that, while we're dragging, the draggable element is always above other elements. And mouse events only happen on the top element, not on those below it.</p>
<p>For instance, below are two <code>&lt;div&gt;</code> elements, red on top of blue. There's no way to catch an event on the blue one, because the red is on top:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  div {
    width: 50px;
    height: 50px;
    position: absolute;
    top: 0;
  }
&lt;/style&gt;
&lt;div style="background:blue" onmouseover="alert('never works')"&gt;&lt;/div&gt;
&lt;div style="background:red" onmouseover="alert('over red!')"&gt;&lt;/div&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-22j6a6" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>The same with a draggable element. The ball in always on top over other elements, so events happen on it. Whatever handlers we set on lower elements, they won't work.</p>
<p>That's why the initial idea to put handlers on potential droppables doesn't work in practice. They won't run.</p>
<p>So, what to do?</p>
<p>There's a method called <code>document.elementFromPoint(clientX, clientY)</code>. It returns the most nested element on given window-relative coordinates (or <code>null</code> if coordinates are out of the window).</p>
<p>So in any of our mouse event handlers we can detect the potential droppable under the pointer like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// in a mouse event handler
ball.hidden = true; // (*)
let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
ball.hidden = false;
// elemBelow is the element below the ball. If it's droppable, we can handle it.</code></pre>
        </div>
      </div>
      
      </div><p>Please note: we need to hide the ball before the call <code>(*)</code>. Otherwise we'll usually have a ball on these coordinates, as it's the top element under the pointer: <code>elemBelow=ball</code>.</p>
<p>We can use that code to check what we're “flying over” at any time. And handle the drop when it happens.</p>
<p>An extended code of <code>onMouseMove</code> to find “droppable” elements:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let currentDroppable = null; // potential droppable that we're flying over right now

function onMouseMove(event) {
  moveAt(event.pageX, event.pageY);

  ball.hidden = true;
  let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
  ball.hidden = false;

  // mousemove events may trigger out of the window (when the ball is dragged off-screen)
  // if clientX/clientY are out of the window, then elementfromPoint returns null
  if (!elemBelow) return;

  // potential droppables are labeled with the class "droppable" (can be other logic)
  let droppableBelow = elemBelow.closest('.droppable');

  if (currentDroppable != droppableBelow) { // if there are any changes
    // we're flying in or out...
    // note: both values can be null
    //   currentDroppable=null if we were not over a droppable (e.g over an empty space)
    //   droppableBelow=null if we're not over a droppable now, during this event

    if (currentDroppable) {
      // the logic to process "flying out" of the droppable (remove highlight)
      leaveDroppable(currentDroppable);
    }
    currentDroppable = droppableBelow;
    if (currentDroppable) {
      // the logic to process "flying in" of the droppable
      enterDroppable(currentDroppable);
    }
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>In the example below when the ball is dragged over the soccer gate, the gate is highlighted.</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/mouse-drag-and-drop/ball4/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/7tHfutBIdz1lq1zxiC0A?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:250px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/mouse-drag-and-drop/ball4/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#gate {
  cursor: pointer;
  margin-bottom: 100px;
  width: 83px;
  height: 46px;
}

#ball {
  cursor: pointer;
  width: 40px;
  height: 40px;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;p&gt;Drag the ball.&lt;/p&gt;

  &lt;img src="https://en.js.cx/clipart/soccer-gate.svg" id="gate" class="droppable"&gt;

  &lt;img src="https://en.js.cx/clipart/ball.svg" id="ball"&gt;

  &lt;script&gt;
    let currentDroppable = null;

    ball.onmousedown = function(event) {

      let shiftX = event.clientX - ball.getBoundingClientRect().left;
      let shiftY = event.clientY - ball.getBoundingClientRect().top;

      ball.style.position = 'absolute';
      ball.style.zIndex = 1000;
      document.body.append(ball);

      moveAt(event.pageX, event.pageY);

      function moveAt(pageX, pageY) {
        ball.style.left = pageX - shiftX + 'px';
        ball.style.top = pageY - shiftY + 'px';
      }

      function onMouseMove(event) {
        moveAt(event.pageX, event.pageY);

        ball.hidden = true;
        let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
        ball.hidden = false;

        if (!elemBelow) return;

        let droppableBelow = elemBelow.closest('.droppable');
        if (currentDroppable != droppableBelow) {
          if (currentDroppable) { // null when we were not over a droppable before this event
            leaveDroppable(currentDroppable);
          }
          currentDroppable = droppableBelow;
          if (currentDroppable) { // null if we're not coming over a droppable now
            // (maybe just left the droppable)
            enterDroppable(currentDroppable);
          }
        }
      }

      document.addEventListener('mousemove', onMouseMove);

      ball.onmouseup = function() {
        document.removeEventListener('mousemove', onMouseMove);
        ball.onmouseup = null;
      };

    };

    function enterDroppable(elem) {
      elem.style.background = 'pink';
    }

    function leaveDroppable(elem) {
      elem.style.background = '';
    }

    ball.ondragstart = function() {
      return false;
    };
  &lt;/script&gt;


&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p>Now we have the current “drop target” in the variable <code>currentDroppable</code> during the whole process and can use it to highlight or any other stuff.</p>
<h2 id="chapter-742">
Summary</h2>
<p>We considered a basic <code>Drag'n'Drop</code> algorithm.</p>
<p>The key components:</p>
<ol>
<li>Events flow: <code>ball.mousedown</code> → <code>document.mousemove</code> → <code>ball.mouseup</code> (cancel native <code>ondragstart</code>).</li>
<li>At the drag start – remember the initial shift of the pointer relative to the element: <code>shiftX/shiftY</code> and keep it during the dragging.</li>
<li>Detect droppable elements under the pointer using <code>document.elementFromPoint</code>.</li>
</ol>
<p>We can lay a lot on this foundation.</p>
<ul>
<li>On <code>mouseup</code> we can finalize the drop: change data, move elements around.</li>
<li>We can highlight the elements we're flying over.</li>
<li>We can limit dragging by a certain area or direction.</li>
<li>We can use event delegation for <code>mousedown/up</code>. A large-area event handler that checks  <code>event.target</code> can manage Drag'n'Drop for hundreds of elements.</li>
<li>And so on.</li>
</ul>
<p>There are frameworks that build architecture over it: <code>DragZone</code>, <code>Droppable</code>, <code>Draggable</code> and other classes. Most of them do the similar stuff to described above, so it should be easy to understand them now. Or roll our own, because you already know how to handle the process, and it may be more flexible than to adapt something else.</p>
<div class="tasks"><h2 id="chapter-743" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#slider" name="slider" class="main__anchor">Slider</a></h3>
<a href="http://javascript.info/task/slider" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a slider:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:60px" src="https://en.js.cx/task/slider/solution/"></iframe>
  </div><p>Drag the blue thumb with the mouse and move it.</p>
<p>Important details:</p>
<ul>
<li>When the mouse button is pressed, during the dragging the mouse may go over or below the slider. The slider will still work (convenient for the user).</li>
<li>If the mouse moves very fast to the left or to the right, the thumb should stop exactly at the edge.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/N9MlLvUTE4kzd0tyLFos?p=preview" target="_blank" data-plunk-id="N9MlLvUTE4kzd0tyLFos">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We have a horizontal Drag'n'Drop here.</p>
<p>To position the element we use <code>position:relative</code> and slider-relative coordinates for the thumb. Here it's more convenient here than <code>position:absolute</code>.</p>
<p>
<a href="http://plnkr.co/edit/Ym7jys3xbukh8Reufjkm?p=preview" target="_blank" data-plunk-id="Ym7jys3xbukh8Reufjkm">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#drag-superheroes-around-the-field" name="drag-superheroes-around-the-field" class="main__anchor">Drag superheroes around the field</a></h3>
<a href="http://javascript.info/task/drag-heroes" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>This task can help you to check understanding of several aspects of Drag'n'Drop and DOM.</p>
<p>Make all elements with class <code>draggable</code> – draggable. Like a ball in the chapter.</p>
<p>Requirements:</p>
<ul>
<li>Use event delegation to track drag start: a single event handler on <code>document</code> for <code>mousedown</code>.</li>
<li>If elements are dragged to top/bottom window edges – the page scrolls up/down to allow further dragging.</li>
<li>There is no horizontal scroll.</li>
<li>Draggable elements should never leave the window, even after swift mouse moves.</li>
</ul>
<p>The demo is too big to fit it here, so here's the link.</p>
<p>
<a href="https://en.js.cx/task/drag-heroes/solution/" target="blank">Demo in new window</a></p><p>
<a href="http://plnkr.co/edit/P5CEGVPzDdlCocaeY9YX?p=preview" target="_blank" data-plunk-id="P5CEGVPzDdlCocaeY9YX">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To drag the element we can use <code>position:fixed</code>, it makes coordinates easier to manage. At the end we should switch it back to <code>position:absolute</code>.</p>
<p>Then, when coordinates are at window top/bottom, we use <code>window.scrollTo</code> to scroll it.</p>
<p>More details in the code, in comments.</p>
<p>
<a href="http://plnkr.co/edit/IyDqOdMEs5ASRJ3yidJH?p=preview" target="_blank" data-plunk-id="IyDqOdMEs5ASRJ3yidJH">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-744"></h6>
<h1 class="main__header-title" id="chapter-745">Keyboard: keydown and keyup</h1>
<p>Before we get to keyboard, please note that on modern devices there are other ways to “input something”. For instance, people use speech recognition (especially on mobile devices) or copy/paste with the mouse.</p>
<p>So if we want to track any input into an <code>&lt;input&gt;</code> field, then keyboard events are not enough. There's another event named <code>input</code> to handle changes of an <code>&lt;input&gt;</code> field, by any means. And it may be a better choice for such task. We'll cover it later in the chapter 
<a href="http://javascript.info/events-change-input">Events: change, input, cut, copy, paste</a>.</p>
<p>Keyboard events should be used when we want to handle keyboard actions (virtual keyboard also counts). For instance, to react on arrow keys <kbd class="shortcut">⇧</kbd> and <kbd class="shortcut">⇩</kbd> or hotkeys (including combinations of keys).</p>


<h2 id="chapter-746">
Teststand</h2>
<p>To better understand keyboard events, you can use the teststand below.</p>
<p>Try different key combinations in the text field.</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/keyboard-events/keyboard-dump/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/lqwW9MbfyqRHe7FamoNE?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:480px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/keyboard-events/keyboard-dump/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>kinput.onkeydown = kinput.onkeyup = kinput.onkeypress = handle;

let lastTime = Date.now();

function handle(e) {
  if (form.elements[e.type + 'Ignore'].checked) return;

  let text = e.type +
    ' key=' + e.key +
    ' code=' + e.code +
    (e.shiftKey ? ' shiftKey' : '') +
    (e.ctrlKey ? ' ctrlKey' : '') +
    (e.altKey ? ' altKey' : '') +
    (e.metaKey ? ' metaKey' : '') +
    (e.repeat ? ' (repeat)' : '') +
    "\n";

  if (area.value &amp;&amp; Date.now() - lastTime &gt; 250) {
    area.value += new Array(81).join('-') + '\n';
  }
  lastTime = Date.now();

  area.value += text;

  if (form.elements[e.type + 'Stop'].checked) {
    e.preventDefault();
  }
}</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#kinput {
  font-size: 150%;
  box-sizing: border-box;
  width: 95%;
}

#area {
  width: 95%;
  box-sizing: border-box;
  height: 250px;
  border: 1px solid black;
  display: block;
}

form label {
  display: inline;
  white-space: nowrap;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;form id="form" onsubmit="return false"&gt;

    Prevent default for:
    &lt;label&gt;
      &lt;input type="checkbox" name="keydownStop" value="1"&gt; keydown&lt;/label&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;
    &lt;label&gt;
      &lt;input type="checkbox" name="keyupStop" value="1"&gt; keyup&lt;/label&gt;

    &lt;p&gt;
      Ignore:
      &lt;label&gt;
        &lt;input type="checkbox" name="keydownIgnore" value="1"&gt; keydown&lt;/label&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;
      &lt;label&gt;
        &lt;input type="checkbox" name="keyupIgnore" value="1"&gt; keyup&lt;/label&gt;
    &lt;/p&gt;

    &lt;p&gt;Focus on the input field and press a key.&lt;/p&gt;

    &lt;input type="text" placeholder="Press keys here" id="kinput"&gt;

    &lt;textarea id="area"&gt;&lt;/textarea&gt;
    &lt;input type="button" value="Clear" onclick="area.value = ''" /&gt;
  &lt;/form&gt;
  &lt;script src="script.js"&gt;&lt;/script&gt;


&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><h2 id="chapter-747">
Keydown and keyup</h2>
<p>The <code>keydown</code> events happens when a key is pressed down, and then <code>keyup</code> – when it's released.</p>
<h3>
event.code and event.key</a></h3><p>The <code>key</code> property of the event object allows to get the character, while the <code>code</code> property of the event object allows to get the “physical key code”.</p>
<p>For instance, the same key <kbd class="shortcut">Z</kbd> can be pressed with or without <code>Shift</code>. That gives us two different characters: lowercase <code>z</code> and uppercase <code>Z</code>.</p>
<p>The <code>event.key</code> is exactly the character, and it will be different. But <code>event.code</code> is the same:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th><code>event.key</code></th>
<th><code>event.code</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><kbd class="shortcut">Z</kbd></td>
<td><code>z</code> (lowercase)</td>
<td><code>KeyZ</code></td>
</tr>
<tr>
<td><kbd class="shortcut">Shift<span class="shortcut__plus">+</span>Z</kbd></td>
<td><code>Z</code> (uppercase)</td>
<td><code>KeyZ</code></td>
</tr>
</tbody>
</table>
<p>If a user works with different languages, then switching to another language would make a totally different character instead of <code>"Z"</code>. That will become the value of <code>event.key</code>, while <code>event.code</code> is always the same: <code>"KeyZ"</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">“KeyZ” and other key codes</span></div>
            <div class="important__content"><p>Every key has the code that depends on its location on the keyboard. Key codes described in the 
<a href="https://www.w3.org/TR/uievents-code/">UI Events code specification</a>.</p>
<p>For instance:</p>
<ul>
<li>Letter keys have codes <code>"Key&lt;letter&gt;"</code>: <code>"KeyA"</code>, <code>"KeyB"</code> etc.</li>
<li>Digit keys have codes: <code>"Digit&lt;number&gt;"</code>: <code>"Digit0"</code>, <code>"Digit1"</code> etc.</li>
<li>Special keys are coded by their names: <code>"Enter"</code>, <code>"Backspace"</code>, <code>"Tab"</code> etc.</li>
</ul>
<p>There are several widespread keyboard layouts, and the specification gives key codes for each of them.</p>
<p>See 
<a href="https://www.w3.org/TR/uievents-code/#key-alphanumeric-section">alphanumeric section of the spec</a> for more codes, or just try the <a href="#keyboard-test-stand">teststand</a> above.</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Case matters: <code>"KeyZ"</code>, not <code>"keyZ"</code></span></div>
            <div class="important__content"><p>Seems obvious, but people still make mistakes.</p>
<p>Please evade mistypes: it's <code>KeyZ</code>, not <code>keyZ</code>. The check like <code>event.code=="keyZ"</code> won't work: the first letter of <code>"Key"</code> must be uppercase.</p>
</div></div>
<p>What if a key does not give any character? For instance, <kbd class="shortcut">Shift</kbd> or <kbd class="shortcut">F1</kbd> or others. For those keys <code>event.key</code> is approximately the same as <code>event.code</code>:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th><code>event.key</code></th>
<th><code>event.code</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><kbd class="shortcut">F1</kbd></td>
<td><code>F1</code></td>
<td><code>F1</code></td>
</tr>
<tr>
<td><kbd class="shortcut">Backspace</kbd></td>
<td><code>Backspace</code></td>
<td><code>Backspace</code></td>
</tr>
<tr>
<td><kbd class="shortcut">Shift</kbd></td>
<td><code>Shift</code></td>
<td><code>ShiftRight</code> or <code>ShiftLeft</code></td>
</tr>
</tbody>
</table>
<p>Please note that <code>event.code</code> specifies exactly which key is pressed. For instance, most keyboards have two <kbd class="shortcut">Shift</kbd> keys: on the left and on the right side. The <code>event.code</code> tells us exactly which one was pressed, and <code>event.key</code> is responsible for the “meaning” of the key: what it is (a “Shift”).</p>
<p>Let's say, we want to handle a hotkey: <kbd class="shortcut">Ctrl<span class="shortcut__plus">+</span>Z</kbd> (or <kbd class="shortcut">Cmd<span class="shortcut__plus">+</span>Z</kbd> for Mac). Most text editors hook the “Undo” action on it. We can set a listener on <code>keydown</code> and check which key is pressed – to detect when we have the hotkey.</p>
<p>Please answer the question – in such a listener, should we check the value of <code>event.key</code> or <code>event.code</code>?</p>
<p>Please, pause and answer.</p>
<p>Made up your mind?</p>
<p>If you've got an understanding, then the answer is, of course, <code>event.code</code>, as we don't want <code>event.key</code> there. The value of <code>event.key</code> can change depending on the language or <code>CapsLock</code> enabled. The value of <code>event.code</code> is strictly bound to the key, so here we go:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.addEventListener('keydown', function(event) {
  if (event.code == 'KeyZ' &amp;&amp; (event.ctrlKey || event.metaKey)) {
    alert('Undo!')
  }
});</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-748">
Auto-repeat</h2>
<p>If a key is being pressed for a long enough time, it starts to repeat: the <code>keydown</code> triggers again and again, and then when it's released we finally get <code>keyup</code>. So it's kind of normal to have many <code>keydown</code> and a single <code>keyup</code>.</p>
<p>For all repeating keys the event object has <code>event.repeat</code> property set to <code>true</code>.</p>
<h2 id="chapter-749">
Default actions</h2>
<p>Default actions vary, as there are many possible things that may be initiated by the keyboard.</p>
<p>For instance:</p>
<ul>
<li>A character appears on the screen (the most obvious outcome).</li>
<li>A character is deleted (<kbd class="shortcut">Delete</kbd> key).</li>
<li>The page is scrolled (<kbd class="shortcut">PageDown</kbd> key).</li>
<li>The browser opens the “Save Page” dialog (<kbd class="shortcut">Ctrl<span class="shortcut__plus">+</span>S</kbd>)</li>
<li>…and so on.</li>
</ul>
<p>Preventing the default action on <code>keydown</code> can cancel most of them, with the exception of OS-based special keys. For instance, on Windows <kbd class="shortcut">Alt<span class="shortcut__plus">+</span>F4</kbd> closes the current browser window. And there's no way to stop it by preventing the default action in JavaScript.</p>
<p>For instance, the <code>&lt;input&gt;</code> below expects a phone number, so it does not accept keys except digits, <code>+</code>, <code>()</code> or <code>-</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true" data-highlight-inline="5:7-50">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
function checkPhoneKey(key) {
  return (key &gt;= '0' &amp;&amp; key &lt;= '9') || key == '+' || key == '(' || key == ')' || key == '-';
}
&lt;/script&gt;
&lt;input onkeydown="return checkPhoneKey(event.key)" placeholder="Phone, please" type="tel"&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-co73w0" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>Please note that special keys like <kbd class="shortcut">Backspace</kbd>, <kbd class="shortcut">⇦</kbd>, <kbd class="shortcut">⇨</kbd>, <kbd class="shortcut">Ctrl<span class="shortcut__plus">+</span>V</kbd> do not work in the input. That's a side-effect effect of the strict filter <code>checkPhoneKey</code>.</p>
<p>Let's relax it a little bit:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
function checkPhoneKey(key) {
  return (key &gt;= '0' &amp;&amp; key &lt;= '9') || key == '+' || key == '(' || key == ')' || key == '-' ||
    key == 'ArrowLeft' || key == 'ArrowRight' || key == 'Delete' || key == 'Backspace';
}
&lt;/script&gt;
&lt;input onkeydown="return checkPhoneKey(event.key)" placeholder="Phone, please" type="tel"&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-c03hra" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>Now arrows and deletion works well.</p>
<p>…But we still can enter anything by using a mouse and right-click + Paste. So the filter is not 100% reliable. We can just let it be like that, because most of time it works. Or an alternative approach would be to track the <code>input</code> event – it triggers after any modification. There we can check the new value and highlight/modify it when it's invalid.</p>
<h2 id="chapter-750">
Legacy</h2>
<p>In the past, there was a <code>keypress</code> event, and also <code>keyCode</code>, <code>charCode</code>, <code>which</code> properties of the event object.</p>
<p>There were so many browser incompatibilities that developers of the specification decided to deprecate all of them. The old code still works, as the browser keep supporting them, but there's totally no need to use those any more.</p>
<p>There was time when this chapter included their detailed description. But as of now we can forget about those.</p>
<h2 id="chapter-751">
Summary</h2>
<p>Pressing a key always generates a keyboard event, be it symbol keys or special keys like <kbd class="shortcut">Shift</kbd> or <kbd class="shortcut">Ctrl</kbd> and so on. The only exception is <kbd class="shortcut">Fn</kbd> key that sometimes presents on a laptop keyboard. There's no keyboard event for it, because it's often implemented on lower level than OS.</p>
<p>Keyboard events:</p>
<ul>
<li><code>keydown</code> – on pressing the key (auto-repeats if the key is pressed for long),</li>
<li><code>keyup</code> – on releasing the key.</li>
</ul>
<p>Main keyboard event properties:</p>
<ul>
<li><code>code</code> – the “key code” (<code>"KeyA"</code>, <code>"ArrowLeft"</code> and so on), specific to the physical location of the key on keyboard.</li>
<li><code>key</code> – the character (<code>"A"</code>, <code>"a"</code> and so on), for non-character keys usually has the same value  as <code>code</code>.</li>
</ul>
<p>In the past, keyboard events were sometimes used to track user input in form fields. That's not reliable, because the input can come from various sources. We have <code>input</code> and <code>change</code> events to handle any input (covered later in the chapter 
<a href="http://javascript.info/events-change-input">Events: change, input, cut, copy, paste</a>). They trigger after any input, including mouse or speech recognition.</p>
<p>We should use keyboard events when we really want keyboard. For example, to react on hotkeys or special keys.</p>
<div class="tasks"><h2 id="chapter-752" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#extended-hotkeys" name="extended-hotkeys" class="main__anchor">Extended hotkeys</a></h3>
<a href="http://javascript.info/task/check-sync-keydown" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a function <code>runOnKeys(func, code1, code2, ... code_n)</code> that runs <code>func</code> on simultaneous pressing of keys with codes <code>code1</code>, <code>code2</code>, …, <code>code_n</code>.</p>
<p>For instance, the code below shows <code>alert</code> when <code>"Q"</code> and <code>"W"</code> are pressed together (in any language, with or without CapsLock)</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">runOnKeys(
  () =&gt; alert("Hello!"),
  "KeyQ",
  "KeyW"
);</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="https://en.js.cx/task/check-sync-keydown/solution/" target="blank">Demo in new window</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We should use two handlers: <code>document.onkeydown</code> and <code>document.onkeyup</code>.</p>
<p>The set <code>pressed</code> should keep currently pressed keys.</p>
<p>The first handler adds to it, while the second one removes from it. Every time on <code>keydown</code> we check if we have enough keys pressed, and run the function if it is so.</p>
<p>
<a href="http://plnkr.co/edit/8kOoeIFlJyDJlNqeMG1N?p=preview" target="_blank" data-plunk-id="8kOoeIFlJyDJlNqeMG1N">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-753"></h6>
<h1 class="main__header-title" id="chapter-754">Scrolling</h1>
<p>Scroll events allow to react on a page or element scrolling. There are quite a few good things we can do here.</p>
<p>For instance:</p>
<ul>
<li>Show/hide additional controls or information depending on where in the document the user is.</li>
<li>Load more data when the user scrolls down till the end of the page.</li>
</ul>


<p>Here's a small function to show the current scroll:</p>
<div data-trusted="1" class="code-example" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.addEventListener('scroll', function() {
  document.getElementById('showScroll').innerHTML = pageYOffset + 'px';
});</code></pre>
        </div>
      </div>
      
      </div><p>In action:</p>
<p>Current scroll = <b id="showScroll">scroll the window</b></p>
<p>The <code>scroll</code> event works both on the <code>window</code> and on scrollable elements.</p>
<h2 id="chapter-755">
Prevent scrolling</h2>
<p>How do we make something unscrollable? We can't prevent scrolling by using <code>event.preventDefault()</code> in <code>onscroll</code> listener, because it triggers <em>after</em> the scroll has already happened.</p>
<p>But we can prevent scrolling by <code>event.preventDefault()</code> on an event that causes the scroll.</p>
<p>For instance:</p>
<ul>
<li><code>wheel</code> event – a mouse wheel roll (a “scrolling” touchpad action generates it too).</li>
<li><code>keydown</code> event for <kbd class="shortcut">pageUp</kbd> and <kbd class="shortcut">pageDown</kbd>.</li>
</ul>
<p>Sometimes that may help. But there are more ways to scroll, so it's quite hard to handle all of them. So it's more reliable to use CSS to make something unscrollable, like <code>overflow</code> property.</p>
<p>Here are few tasks that you can solve or look through to see the applications on <code>onscroll</code>.</p>
<div class="tasks"><h2 id="chapter-756" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#endless-page" name="endless-page" class="main__anchor">Endless page</a></h3>
<a href="http://javascript.info/task/endless-page" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create an endless page. When a visitor scrolls it to the end, it auto-appends current date-time to the text (so that a visitor can scroll more).</p>
<p>Like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:200px" src="https://en.js.cx/task/endless-page/solution/"></iframe>
  </div><p>Please note two important features of the scroll:</p>
<ol>
<li><strong>The scroll is “elastic”.</strong> We can scroll a little beyond the document start or end in some browsers/devices (empty space below is shown, and then the document will automatically “bounces back” to normal).</li>
<li><strong>The scroll is imprecise.</strong> When we scroll to page end, then we may be in fact like 0-50px away from the real document bottom.</li>
</ol>
<p>So, “scrolling to the end” should mean that the visitor is no more than 100px away from the document end.</p>
<p>P.S. In real life we may want to show “more messages” or “more goods”.</p>
<p>
<a href="http://plnkr.co/edit/uvsU3Co1RjkI0nfvOVkC?p=preview" target="_blank" data-plunk-id="uvsU3Co1RjkI0nfvOVkC">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The core of the solution is a function that adds more dates to the page (or loads more stuff in real-life) while we're at the page end.</p>
<p>We can call it immediately and add as a <code>window.onscroll</code> handler.</p>
<p>The most important question is: “How do we detect that the page is scrolled to bottom?”</p>
<p>Let's use window-relative coordinates.</p>
<p>The document is represented (and contained) within <code>&lt;html&gt;</code> tag, that is <code>document.documentElement</code>.</p>
<p>We can get window-relative coordinates of the whole document as <code>document.documentElement.getBoundingClientRect()</code>. And the <code>bottom</code> property will be window-relative coordinate of the document end.</p>
<p>For instance, if the height of the whole HTML document is 2000px, then:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// When we're on the top of the page
// window-relative top = 0
document.documentElement.getBoundingClientRect().top = 0

// window-relative bottom = 2000
// the document is long, so that is probably far beyond the window bottom
document.documentElement.getBoundingClientRect().bottom = 2000</code></pre>
        </div>
      </div>
      
      </div><p>If we scroll <code>500px</code> below, then:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// document top is above the window 500px
document.documentElement.getBoundingClientRect().top = -500
// document bottom is 500px closer
document.documentElement.getBoundingClientRect().bottom = 1500</code></pre>
        </div>
      </div>
      
      </div><p>When we scroll till the end, assuming that the window height is <code>600px</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// document top is above the window 500px
document.documentElement.getBoundingClientRect().top = -1400
// document bottom is 500px closer
document.documentElement.getBoundingClientRect().bottom = 600</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the bottom can't be 0, because it never reaches the window top. The lowest limit of the bottom coordinate is the window height, we can't scroll it any more up.</p>
<p>And the window height is <code>document.documentElement.clientHeight</code>.</p>
<p>We want the document bottom be no more than <code>100px</code> away from it.</p>
<p>So here's the function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function populate() {
  while(true) {
    // document bottom
    let windowRelativeBottom = document.documentElement.getBoundingClientRect().bottom;

    // if it's greater than window height + 100px, then we're not at the page back
    // (see examples above, big bottom means we need to scroll more)
    if (windowRelativeBottom &gt; document.documentElement.clientHeight + 100) break;

    // otherwise let's add more data
    document.body.insertAdjacentHTML("beforeend", `&lt;p&gt;Date: ${new Date()}&lt;/p&gt;`);
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/sbd68bpu2IWribAAgmW6?p=preview" target="_blank" data-plunk-id="sbd68bpu2IWribAAgmW6">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#up-down-button" name="up-down-button" class="main__anchor">Up/down button</a></h3>
<a href="http://javascript.info/task/updown-button" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a “to the top” button to help with page scrolling.</p>
<p>It should work like this:</p>
<ul>
<li>While the page is not scrolled down at least for the window height – it's invisible.</li>
<li>When the page is scrolled down more than the window height – there appears an “upwards” arrow in the left-top corner. If the page is scrolled back, it disappears.</li>
<li>When the arrow is clicked, the page scrolls to the top.</li>
</ul>
<p>Like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/task/updown-button/solution/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:200px" src="https://en.js.cx/task/updown-button/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/0SSTNf9alwIVRJUKfWZs?p=preview" target="_blank" data-plunk-id="0SSTNf9alwIVRJUKfWZs">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/11iOhm3b5bgMr90apvY1?p=preview" target="_blank" data-plunk-id="11iOhm3b5bgMr90apvY1">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#load-visible-images" name="load-visible-images" class="main__anchor">Load visible images</a></h3>
<a href="http://javascript.info/task/load-visible-img" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Let's say we have a slow-speed client and want to save his mobile traffic.</p>
<p>For that purpose we decide not to show images immediately, but rather replace them with placeholders, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:5-26,0:52-71">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;img src="placeholder.svg" width="128" height="128" data-src="real.jpg"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>So, initially all images are <code>placeholder.svg</code>. When the page scrolls to the position where the user can see the image – we change <code>src</code> to the one in <code>data-src</code>, and so the image loads.</p>
<p>Here's an example in <code>iframe</code>:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/task/load-visible-img/solution/"></iframe>
  </div><p>Scroll it to see images load “on-demand”.</p>
<p>Requirements:</p>
<ul>
<li>When the page loads, those images that are on-screen should load immediately, prior to any scrolling.</li>
<li>Some images may be regular, without <code>data-src</code>. The code should not touch them.</li>
<li>Once an image is loaded, it should not reload any more when scrolled in/out.</li>
</ul>
<p>P.S. If you can, make a more advanced solution that would “preload” images that are one page below/after the current position.</p>
<p>P.P.S. Only vertical scroll is to be handled, no horizontal scrolling.</p>
<p>
<a href="http://plnkr.co/edit/vlRKHQ9JfqcGeGDCaQGB?p=preview" target="_blank" data-plunk-id="vlRKHQ9JfqcGeGDCaQGB">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The <code>onscroll</code> handler should check which images are visible and show them.</p>
<p>We also may want to run it when the page loads, to detect immediately visible images prior to any scrolling and load them.</p>
<p>If we put it at the <code>&lt;body&gt;</code> bottom, then it runs when the page content is loaded.</p>
<div data-trusted="1" class="code-example" data-highlight-block="15-16">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// ...the page content is above...

function isVisible(elem) {

  let coords = elem.getBoundingClientRect();

  let windowHeight = document.documentElement.clientHeight;

  // top elem edge is visible OR bottom elem edge is visible
  let topVisible = coords.top &gt; 0 &amp;&amp; coords.top &lt; windowHeight;
  let bottomVisible = coords.bottom &lt; windowHeight &amp;&amp; coords.bottom &gt; 0;

  return topVisible || bottomVisible;
}

showVisible();
window.onscroll = showVisible;</code></pre>
        </div>
      </div>
      
      </div><p>For visible images we can take <code>img.dataset.src</code> and assign it to <code>img.src</code> (if not did it yet).</p>
<p>P.S. The solution also has a variant of <code>isVisible</code> that “pre-loads” images that are within 1 page  above/below (the page height is <code>document.documentElement.clientHeight</code>).</p>
<p>
<a href="http://plnkr.co/edit/riI9laOCooLSRQAlarEq?p=preview" target="_blank" data-plunk-id="riI9laOCooLSRQAlarEq">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-757"></h6>
<h1 class="main__header-title" id="chapter-758">Page lifecycle: DOMContentLoaded, load, beforeunload, unload</h1>
<p>The lifecycle of an HTML page has three important events:</p>
<ul>
<li><code>DOMContentLoaded</code> – the browser fully loaded HTML, and the DOM tree is built, but external resources like pictures <code>&lt;img&gt;</code> and stylesheets may be not yet loaded.</li>
<li><code>load</code> – the browser loaded all resources (images, styles etc).</li>
<li><code>beforeunload/unload</code> – when the user is leaving the page.</li>
</ul>
<p>Each event may be useful:</p>
<ul>
<li><code>DOMContentLoaded</code> event – DOM is ready, so the handler can lookup DOM nodes, initialize the interface.</li>
<li><code>load</code> event – additional resources are loaded, we can get image sizes (if not specified in HTML/CSS) etc.</li>
<li><code>beforeunload/unload</code> event – the user is leaving: we can check if the user saved the changes and  ask him whether he really wants to leave.</li>
</ul>
<p>Let's explore the details of these events.</p>


<h2 id="chapter-759">
DOMContentLoaded</h2>
<p>The <code>DOMContentLoaded</code> event happens on the <code>document</code> object.</p>
<p>We must use <code>addEventListener</code> to catch it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.addEventListener("DOMContentLoaded", ready);</code></pre>
        </div>
      </div>
      
      </div><p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="200" data-refresh="1" data-highlight-block="8-8">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  function ready() {
    alert('DOM is ready');

    // image is not yet loaded (unless was cached), so the size is 0x0
    alert(`Image size: ${img.offsetWidth}x${img.offsetHeight}`);
  }

  document.addEventListener("DOMContentLoaded", ready);
&lt;/script&gt;

&lt;img id="img" src="https://en.js.cx/clipart/train.gif?speed=1&amp;cache=0"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>In the example the <code>DOMContentLoaded</code> handler runs when the document is loaded, not waits for the page load. So <code>alert</code> shows zero sizes.</p>
<p>At the first sight <code>DOMContentLoaded</code> event is very simple. The DOM tree is ready – here's the event. But there are few peculiarities.</p>
<h3>
DOMContentLoaded and scripts</a></h3><p>When the browser initially loads HTML and comes across a <code>&lt;script&gt;...&lt;/script&gt;</code> in the text, it can't continue building DOM. It must execute the script right now. So <code>DOMContentLoaded</code> may only happen after all such scripts are executed.</p>
<p>External scripts (with <code>src</code>) also put DOM building to pause while the script is loading and executing. So <code>DOMContentLoaded</code> waits for external scripts as well.</p>
<p>The only exception are external scripts with <code>async</code> and <code>defer</code> attributes. They tell the browser to continue processing without waiting for the scripts. So the user can see the page before scripts finish loading, good for performance.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">A word about <code>async</code> and <code>defer</code></span></div>
            <div class="important__content"><p>Attributes <code>async</code> and <code>defer</code> work only for external scripts. They are ignored if there's no <code>src</code>.</p>
<p>Both of them tell the browser that it may go on working with the page, and load the script “in background”, then run the script when it loads. So the script doesn't block DOM building and page rendering.</p>
<p>There are two differences between them.</p>
<table>
<thead>
<tr>
<th></th>
<th><code>async</code></th>
<th><code>defer</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Order</td>
<td>Scripts with <code>async</code> execute <em>in the load-first order</em>. Their document order doesn't matter – which loads first runs first.</td>
<td>Scripts with <code>defer</code> always execute <em>in the document order</em> (as they go in the document).</td>
</tr>
<tr>
<td><code>DOMContentLoaded</code></td>
<td>Scripts with <code>async</code> may load and execute while the document has not yet been fully downloaded. That happens if scripts are small or cached, and the document is long enough.</td>
<td>Scripts with <code>defer</code> execute after the document is loaded and parsed (they wait if needed), right before <code>DOMContentLoaded</code>.</td>
</tr>
</tbody>
</table>
<p>So <code>async</code> is used for totally independent scripts.</p>
</div></div>
<h3>
DOMContentLoaded and styles</a></h3><p>External style sheets don't affect DOM, and so <code>DOMContentLoaded</code> does not wait for them.</p>
<p>But there's a pitfall: if we have a script after the style, then that script must wait for the stylesheet to execute:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;link type="text/css" rel="stylesheet" href="style.css"&gt;
&lt;script&gt;
  // the script doesn't not execute until the stylesheet is loaded
  alert(getComputedStyle(document.body).marginTop);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The reason is that the script may want to get coordinates and other style-dependent properties of elements, like in the example above. Naturally, it has to wait for styles to load.</p>
<p>As <code>DOMContentLoaded</code> waits for scripts, it now waits for styles before them as well.</p>
<h3>
Built-in browser autofill</a></h3><p>Firefox, Chrome and Opera autofill forms on <code>DOMContentLoaded</code>.</p>
<p>For instance, if the page has a form with login and password, and the browser remembered the values, then on <code>DOMContentLoaded</code> it may try to autofill them (if approved by the user).</p>
<p>So if <code>DOMContentLoaded</code> is postponed by long-loading scripts, then autofill also awaits. You probably saw that on some sites (if you use browser autofill) – the login/password fields don't get autofilled immediately, but there's a delay till the page fully loads. That's actually the delay until the <code>DOMContentLoaded</code> event.</p>
<p>One of minor benefits in using <code>async</code> and <code>defer</code> for external scripts – they don't block <code>DOMContentLoaded</code> and don't delay browser autofill.</p>
<h2 id="chapter-760">
window.onload</h2>
<p>The <code>load</code> event on the <code>window</code> object triggers when the whole page is loaded including styles, images and other resources.</p>
<p>The example below correctly shows image sizes, because <code>window.onload</code> waits for all images:</p>
<div data-trusted="1" class="code-example" data-demo-height="200" data-refresh="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  window.onload = function() {
    alert('Page loaded');

    // image is loaded at this time
    alert(`Image size: ${img.offsetWidth}x${img.offsetHeight}`);
  };
&lt;/script&gt;

&lt;img id="img" src="https://en.js.cx/clipart/train.gif?speed=1&amp;cache=0"&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-761">
window.onunload</h2>
<p>When a visitor leaves the page, the <code>unload</code> event triggers on <code>window</code>. We can do something there that doesn't involve a delay, like closing related popup windows. But we can't cancel the transition to another page.</p>
<p>For that we should use another event – <code>onbeforeunload</code>.</p>
<h2 id="chapter-762">
window.onbeforeunload</h2>
<p>If a visitor initiated leaving the page or tries to close the window, the <code>beforeunload</code> handler can ask for additional confirmation.</p>
<p>It needs to return the string with the question. The browser will show it.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.onbeforeunload = function() {
  return "There are unsaved changes. Leave now?";
};</code></pre>
        </div>
      </div>
      
      </div><p>Click on the button in <code>&lt;iframe&gt;</code> below to set the handler, and then click the link to see it in action:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/onload-ondomcontentloaded/window-onbeforeunload/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      <div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/oWi3ErnGIBkVXAhSUrli?p=preview" target="_blank" title="open in sandbox" data-plunk-id="oWi3ErnGIBkVXAhSUrli" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:80px" src="https://en.js.cx/article/onload-ondomcontentloaded/window-onbeforeunload/"></iframe>
  </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Some browsers ignore the text and show their own message instead</span></div>
            <div class="important__content"><p>Some browsers like Chrome and Firefox ignore the string and shows its own message instead. That's for sheer safety, to protect the user from potentially misleading and hackish messages.</p>
</div></div>
<h2 id="chapter-763">
readyState</h2>
<p>What happens if we set the <code>DOMContentLoaded</code> handler after the document is loaded?</p>
<p>Naturally, it never runs.</p>
<p>There are cases when we are not sure whether the document is ready or not, for instance an external script with <code>async</code> attribute loads and runs asynchronously. Depending on the network, it may load and execute before the document is complete or after that, we can't be sure. So we should be able to know the current state of the document.</p>
<p>The <code>document.readyState</code> property gives us information about it. There are 3 possible values:</p>
<ul>
<li><code>"loading"</code> – the document is loading.</li>
<li><code>"interactive"</code> – the document was fully read.</li>
<li><code>"complete"</code> – the document was fully read and all resources (like images) are loaded too.</li>
</ul>
<p>So we can check <code>document.readyState</code> and setup a handler or execute the code immediately if it's ready.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function work() { /*...*/ }

if (document.readyState == 'loading') {
  document.addEventListener('DOMContentLoaded', work);
} else {
  work();
}</code></pre>
        </div>
      </div>
      
      </div><p>There's a <code>readystatechange</code> event that triggers when the state changes, so we can print all these states like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// current state
console.log(document.readyState);

// print state changes
document.addEventListener('readystatechange', () =&gt; console.log(document.readyState));</code></pre>
        </div>
      </div>
      
      </div><p>The <code>readystatechange</code> event is an alternative mechanics of tracking the document loading state, it appeared long ago. Nowadays, it is rarely used, but let's cover it for completeness.</p>
<p>What is the place of <code>readystatechange</code> among other events?</p>
<p>To see the timing, here's a document with <code>&lt;iframe&gt;</code>, <code>&lt;img&gt;</code> and handlers that log events:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  function log(text) { /* output the time and message */ }
  log('initial readyState:' + document.readyState);

  document.addEventListener('readystatechange', () =&gt; log('readyState:' + document.readyState));
  document.addEventListener('DOMContentLoaded', () =&gt; log('DOMContentLoaded'));

  window.onload = () =&gt; log('window onload');
&lt;/script&gt;

&lt;iframe src="iframe.html" onload="log('iframe onload')"&gt;&lt;/iframe&gt;

&lt;img src="http://en.js.cx/clipart/train.gif" id="img"&gt;
&lt;script&gt;
  img.onload = () =&gt; log('img onload');
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The working example is 
<a href="http://plnkr.co/edit/H5WkxeiYeDRB0iR05k7a?p=preview">in the sandbox</a>.</p>
<p>The typical output:</p>
<ol>
<li>[1] initial readyState:loading</li>
<li>[2] readyState:interactive</li>
<li>[2] DOMContentLoaded</li>
<li>[3] iframe onload</li>
<li>[4] readyState:complete</li>
<li>[4] img onload</li>
<li>[4] window onload</li>
</ol>
<p>The numbers in square brackets denote the approximate time of when it happens. The real time is a bit greater, but events labeled with the same digit happen approximately at the same time (± a few ms).</p>
<ul>
<li><code>document.readyState</code> becomes <code>interactive</code> right before <code>DOMContentLoaded</code>. These two events actually mean the same.</li>
<li><code>document.readyState</code> becomes <code>complete</code> when all resources (<code>iframe</code> and <code>img</code>) are loaded. Here we can see that it happens in about the same time as <code>img.onload</code> (<code>img</code> is the last resource) and <code>window.onload</code>. Switching to <code>complete</code> state means the same as <code>window.onload</code>. The difference is that <code>window.onload</code> always works after all other <code>load</code> handlers.</li>
</ul>
<h2 id="chapter-764">
Summary</h2>
<p>Page lifecycle events:</p>
<ul>
<li><code>DOMContentLoaded</code> event triggers on <code>document</code> when DOM is ready. We can apply JavaScript to elements at this stage.
<ul>
<li>All scripts are executed except those that are external with <code>async</code> or <code>defer</code></li>
<li>Images and other resources may still continue loading.</li>
</ul>
</li>
<li><code>load</code> event on <code>window</code> triggers when the page and all resources are loaded. We rarely use it, because there's usually no need to wait for so long.</li>
<li><code>beforeunload</code> event on <code>window</code> triggers when the user wants to leave the page. If it returns a string, the browser shows a question whether the user really wants to leave or not.</li>
<li><code>unload</code> event on <code>window</code> triggers when the user is finally leaving, in the handler we can only do simple things that do not involve delays or asking a user. Because of that limitation, it's rarely used.</li>
<li><code>document.readyState</code> is the current state of the document, changes can be tracked in the <code>readystatechange</code> event:
<ul>
<li><code>loading</code> – the document is loading.</li>
<li><code>interactive</code> – the document is parsed, happens at about the same time as <code>DOMContentLoaded</code>, but before it.</li>
<li><code>complete</code> – the document and resources are loaded, happens at about the same time as <code>window.onload</code>, but before it.</li>
</ul>
</li>
</ul>

<h6 id="chapter-765"></h6>
<h1 class="main__header-title" id="chapter-766">Resource loading: onload and onerror</h1>
<p>The browser allows to track the loading of external resources – scripts, iframes, pictures and so on.</p>
<p>There are two events for it:</p>
<ul>
<li><code>onload</code> – successful load,</li>
<li><code>onerror</code> – an error occurred.</li>
</ul>
<h2 id="chapter-767">
Loading a script</h2>
<p>Let's say we need to call a function that resides in an external script.</p>
<p>We can load it dynamically, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let script = document.createElement('script');
script.src = "my.js";

document.head.append(script);</code></pre>
        </div>
      </div>
      
      </div><p>…But how to run the function that is declared inside that script? We need to wait until the script loads, and only then we can call it.</p>
<h3>
script.onload</a></h3><p>The main helper is the <code>load</code> event. It triggers after the script was loaded and executed.</p>
<p>For instance:</p>
<div data-trusted="0" class="code-example" data-highlight-block="6-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let script = document.createElement('script');

// can load any script, from any domain
script.src = "https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.3.0/lodash.js"
document.head.append(script);

script.onload = function() {
  // the script creates a helper function "_"
  alert(_); // the function is available
};</code></pre>
        </div>
      </div>
      
      </div><p>So in <code>onload</code> we can use script variables, run functions etc.</p>
<p>…And what if the loading failed? For instance, there's no such script (error 404) or the server or the server is down (unavailable).</p>
<h3>
script.onerror</a></h3><p>Errors that occur during the loading (but not execution) of the script can be tracked on <code>error</code> event.</p>
<p>For instance, let's request a script that doesn't exist:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let script = document.createElement('script');
script.src = "https://example.com/404.js"; // no such script
document.head.append(script);

script.onerror = function() {
  alert("Error loading " + this.src); // Error loading https://example.com/404.js
};</code></pre>
        </div>
      </div>
      
      </div><p>Please note that we can't get error details here. We don't know was it error 404 or 500 or something else. Just that the loading failed.</p>
<h2 id="chapter-768">
Other resources</h2>
<p>The <code>load</code> and <code>error</code> events also work for other resources. There may be minor differences though.</p>
<p>For instance:</p>
<dl>
<dt><code>&lt;img&gt;</code>, <code>&lt;link&gt;</code> (external stylesheets)</dt>
<dd>Both <code>load</code> and <code>error</code> events work as expected.</dd>
<dt><code>&lt;iframe&gt;</code></dt>
<dd>Only <code>load</code> event when the iframe loading finished. It triggers both for successful load and in case of an error. That's for historical reasons.</dd>
</dl>
<h2 id="chapter-769">
Summary</h2>
<p>Pictures <code>&lt;img&gt;</code>, external styles, scripts and other resources provide <code>load</code> and <code>error</code> events to track their loading:</p>
<ul>
<li><code>load</code> triggers on a successful load,</li>
<li><code>error</code> triggers on a failed load.</li>
</ul>
<p>The only exception is <code>&lt;iframe&gt;</code>: for historical reasons it always triggers <code>load</code>, for any load completion, even if the page is not found.</p>
<p>The <code>readystatechange</code> event also works for resources, but is rarely used, because <code>load/error</code> events are simpler.</p>
<div class="tasks"><h2 id="chapter-770" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#load-images-with-a-callback" name="load-images-with-a-callback" class="main__anchor">Load images with a callback</a></h3>
<a href="http://javascript.info/task/load-img-callback" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Normally, images are loaded when they are created. So i when we add <code>&lt;img&gt;</code> to the page, the user does not see the picture immediately. The browser needs to load it first.</p>
<p>To show an image immediately, we can create it “in advance”, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let img = document.createElement('img');
img.src = 'my.jpg';</code></pre>
        </div>
      </div>
      
      </div><p>The browser starts loading the image and remembers it in the cache. Later, when the same image appears in the document (no matter how), it shows up immediately.</p>
<p><strong>Create a function <code>preloadImages(sources, callback)</code> that loads all images from the array <code>sources</code> and, when ready, runs <code>callback</code>.</strong></p>
<p>For instance, this will show an <code>alert</code> after the images are loaded:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loaded() {
  alert("Images loaded")
}

preloadImages(["1.jpg", "2.jpg", "3.jpg"], loaded);</code></pre>
        </div>
      </div>
      
      </div><p>In case of an error, the function should still assume the picture “loaded”.</p>
<p>In other words, the <code>callback</code> is executed when all images are either loaded or errored out.</p>
<p>The function is useful, for instance, when we plan to show a gallery with many scrollable images, and want to be sure that all images are loaded.</p>
<p>In the source document you can find links to test images, and also the code to check whether they are loaded or not. It should output <code>300</code>.</p>
<p>
<a href="http://plnkr.co/edit/Cfae3ZoQlYxiRhio8T1i?p=preview" target="_blank" data-plunk-id="Cfae3ZoQlYxiRhio8T1i">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The algorithm:</p>
<ol>
<li>Make <code>img</code> for every source.</li>
<li>Add <code>onload/onerror</code> for every image.</li>
<li>Increase the counter when either <code>onload</code> or <code>onerror</code> triggers.</li>
<li>When the counter value equals to the sources count – we're done: <code>callback()</code>.</li>
</ol>
<p>
<a href="http://plnkr.co/edit/7IltmVELi84SfgFdbZOl?p=preview" target="_blank" data-plunk-id="7IltmVELi84SfgFdbZOl">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-771"></h6>
<h1 class="main__header-title" id="chapter-772">Forms, controls</h1>
<p>Special properties and events for forms <code>&lt;form&gt;</code> and controls: <code>&lt;input&gt;</code>, <code>&lt;select&gt;</code> and other.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/form-elements" class="lessons-list__link">Form properties and methods</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/focus-blur" class="lessons-list__link">Focusing: focus/blur</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/events-change-input" class="lessons-list__link">Events: change, input, cut, copy, paste</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/forms-submit" class="lessons-list__link">Form submission: event and method submit</a></li></ol></div>


<h6 id="chapter-773"></h6>
<h1 class="main__header-title" id="chapter-774">Form properties and methods</h1>
<p>Forms and control elements, such as <code>&lt;input&gt;</code> have a lot of special properties and events.</p>
<p>Working with forms can be much more convenient if we know them.</p>


<h2 id="chapter-775">
Navigation: form and elements</h2>
<p>Document forms are members of the special collection <code>document.forms</code>.</p>
<p>That's a <em>named</em> collection: we can use both the name and the number to get the form.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.forms.my - the form with name="my"
document.forms[0] - the first form in the document</code></pre>
        </div>
      </div>
      
      </div><p>When we have a form, then any element is available in the named collection <code>form.elements</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="40">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form name="my"&gt;
  &lt;input name="one" value="1"&gt;
  &lt;input name="two" value="2"&gt;
&lt;/form&gt;

&lt;script&gt;
  // get the form
  let form = document.forms.my; // &lt;form name="my"&gt; element

  // get the element
  let elem = form.elements.one; // &lt;input name="one"&gt; element

  alert(elem.value); // 1
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>There may be multiple elements with the same name, that's often the case with radio buttons.</p>
<p>In that case <code>form.elements[name]</code> is a collection, for instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="40" data-highlight-inline="1:22-32,2:22-32">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form&gt;
  &lt;input type="radio" name="age" value="10"&gt;
  &lt;input type="radio" name="age" value="20"&gt;
&lt;/form&gt;

&lt;script&gt;
let form = document.forms[0];

let ageElems = form.elements.age;

alert(ageElems[0].value); // 10, the first input value
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>These navigation properties do not depend on the tag structure. All elements, no matter how deep they are in the form, are available in <code>form.elements</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Fieldsets as “subforms”</span></div>
            <div class="important__content"><p>A form may have one or many <code>&lt;fieldset&gt;</code> elements inside it. They also support the <code>elements</code> property.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-highlight-block="11-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;body&gt;
  &lt;form id="form"&gt;
    &lt;fieldset name="userFields"&gt;
      &lt;legend&gt;info&lt;/legend&gt;
      &lt;input name="login" type="text"&gt;
    &lt;/fieldset&gt;
  &lt;/form&gt;

  &lt;script&gt;
    alert(form.elements.login); // &lt;input name="login"&gt;

    let fieldset = form.elements.userFields;
    alert(fieldset); // HTMLFieldSetElement

    // we can get the input both from the form and from the fieldset
    alert(fieldset.elements.login == form.elements.login); // true
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Shorter notation: <code>form.name</code></span></div>
            <div class="important__content"><p>There's a shorter notation: we can access the element as <code>form[index/name]</code>.</p>
<p>Instead of <code>form.elements.login</code> we can write <code>form.login</code>.</p>
<p>That also works, but there's a minor issue: if we access an element, and then change its <code>name</code>, then it is still available under the old name (as well as under the new one).</p>
<p>That's easy to see in an example:</p>
<div data-trusted="1" class="code-example" data-demo-height="40" data-highlight-block="13-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form id="form"&gt;
  &lt;input name="login"&gt;
&lt;/form&gt;

&lt;script&gt;
  alert(form.elements.login == form.login); // true, the same &lt;input&gt;

  form.login.name = "username"; // change the name of the input

  // form.elements updated the name:
  alert(form.elements.login); // undefined
  alert(form.elements.username); // input

  // the direct access now can use both names: the new one and the old one
  alert(form.username == form.login); // true
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>That's usually not a problem, because we rarely change names of form elements.</p>
</div></div>
<h2 id="chapter-776">
Backreference: element.form</h2>
<p>For any element, the form is available as <code>element.form</code>. So a form references all elements, and elements
reference the form.</p>
<p>Here's the picture:</p>
      <img src="http://javascript.info/article/form-elements/form-navigation.png">
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="40" data-highlight-block="5-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form id="form"&gt;
  &lt;input type="text" name="login"&gt;
&lt;/form&gt;

&lt;script&gt;
  // form -&gt; element
  let login = form.login;

  // element -&gt; form
  alert(login.form); // HTMLFormElement
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-777">
Form elements</h2>
<p>Let's talk about form controls, pay attention to their specific features.</p>
<h3>
input and textarea</a></h3><p>Normally, we can access the value as <code>input.value</code> or <code>input.checked</code> for checkboxes.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">input.value = "New value";
textarea.value = "New text";

input.checked = true; // for a checkbox or radio button</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Use <code>textarea.value</code>, not <code>textarea.innerHTML</code></span></div>
            <div class="important__content"><p>Please note that we should never use <code>textarea.innerHTML</code>: it stores only the HTML that was initially on the page, not the current value.</p>
</div></div>
<h3>
select and option</a></h3><p>A <code>&lt;select&gt;</code> element has 3 important properties:</p>
<ol>
<li><code>select.options</code> – the collection of <code>&lt;option&gt;</code> elements,</li>
<li><code>select.value</code> – the value of the chosen option,</li>
<li><code>select.selectedIndex</code> – the number of the selected option.</li>
</ol>
<p>So we have three ways to set the value of a <code>&lt;select&gt;</code>:</p>
<ol>
<li>Find the needed <code>&lt;option&gt;</code> and set <code>option.selected</code> to <code>true</code>.</li>
<li>Set <code>select.value</code> to the value.</li>
<li>Set <code>select.selectedIndex</code> to the number of the option.</li>
</ol>
<p>The first way is the most obvious, but <code>(2)</code> and <code>(3)</code> are usually more convenient.</p>
<p>Here is an example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;select id="select"&gt;
  &lt;option value="apple"&gt;Apple&lt;/option&gt;
  &lt;option value="pear"&gt;Pear&lt;/option&gt;
  &lt;option value="banana"&gt;Banana&lt;/option&gt;
&lt;/select&gt;

&lt;script&gt;
  // all three lines do the same thing
  select.options[2].selected = true;
  select.selectedIndex = 2;
  select.value = 'banana';
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Unlike most other controls, <code>&lt;select multiple&gt;</code> allows multiple choice. In that case we need to walk over <code>select.options</code> to get all selected values.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:20-28">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;select id="select" multiple&gt;
  &lt;option value="blues" selected&gt;Blues&lt;/option&gt;
  &lt;option value="rock" selected&gt;Rock&lt;/option&gt;
  &lt;option value="classic"&gt;Classic&lt;/option&gt;
&lt;/select&gt;

&lt;script&gt;
  // get all selected values from multi-select
  let selected = Array.from(select.options)
    .filter(option =&gt; option.selected)
    .map(option =&gt; option.value);

  alert(selected); // blues,rock
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The full specification of the <code>&lt;select&gt;</code> element is available at 
<a href="https://html.spec.whatwg.org/multipage/forms.html#the-select-element">https://html.spec.whatwg.org/multipage/forms.html#the-select-element</a>.</p>
<h3>
new Option</a></h3><p>In the specification of 
<a href="https://html.spec.whatwg.org/multipage/forms.html#the-option-element">the option element</a> there's a nice short syntax to create <code>&lt;option&gt;</code> elements:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">option = new Option(text, value, defaultSelected, selected);</code></pre>
        </div>
      </div>
      
      </div><p>Parameters:</p>
<ul>
<li><code>text</code> – the text inside the option,</li>
<li><code>value</code> – the option value,</li>
<li><code>defaultSelected</code> – if <code>true</code>, then <code>selected</code> attribute is created,</li>
<li><code>selected</code> – if <code>true</code>, then the option is selected.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let option = new Option("Text", "value");
// creates &lt;option value="value"&gt;Text&lt;/option&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The same element selected:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let option = new Option("Text", "value", true, true);</code></pre>
        </div>
      </div>
      
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Additional properties of <code>&lt;option&gt;</code></span></div>
            <div class="important__content"><p>Option elements have additional properties:</p>
<dl>
<dt><code>selected</code></dt>
<dd>Is the option selected.</dd>
<dt><code>index</code></dt>
<dd>The number of the option among the others in its <code>&lt;select&gt;</code>.</dd>
<dt><code>text</code></dt>
<dd>Text content of the option (seen by what the visitor).</dd>
</dl>
</div></div>
<h2 id="chapter-778">
Summary</h2>
<p>Form navigation:</p>
<dl>
<dt><code>document.forms</code></dt>
<dd>A form is available as <code>document.forms[name/index]</code>.</dd>
<dt><code>form.elements</code></dt>
<dd>Form elements are available as <code>form.elements[name/index]</code>, or can use just <code>form[name/index]</code>. The <code>elements</code> property also works for <code>&lt;fieldset&gt;</code>.</dd>
<dt><code>element.form</code></dt>
<dd>Elements reference their form in the <code>form</code> property.</dd>
</dl>
<p>Value is available as <code>input.value</code>, <code>textarea.value</code>, <code>select.value</code> etc, or <code>input.checked</code> for checkboxes and radio buttons.</p>
<p>For <code>&lt;select&gt;</code> we can also get the value by the index <code>select.selectedIndex</code> or through the options collection <code>select.options</code>. The full specification of this and other elements is at 
<a href="https://html.spec.whatwg.org/multipage/forms.html">https://html.spec.whatwg.org/multipage/forms.html</a>.</p>
<p>These are the basics to start working with forms. In the next chapter we'll cover <code>focus</code> and <code>blur</code> events that may occur on any element, but are mostly handled on forms.</p>
<div class="tasks"><h2 id="chapter-779" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#add-an-option-to-select" name="add-an-option-to-select" class="main__anchor">Add an option to select</a></h3>
<a href="http://javascript.info/task/add-select-option" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>There's a <code>&lt;select&gt;</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;select id="genres"&gt;
  &lt;option value="rock"&gt;Rock&lt;/option&gt;
  &lt;option value="blues" selected&gt;Blues&lt;/option&gt;
&lt;/select&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Use JavaScript to:</p>
<ol>
<li>Show the value and the text of the selected option.</li>
<li>Add an option: <code>&lt;option value="classic"&gt;Classic&lt;/option&gt;</code>.</li>
<li>Make it selected.</li>
</ol>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution, step by step:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;select id="genres"&gt;
  &lt;option value="rock"&gt;Rock&lt;/option&gt;
  &lt;option value="blues" selected&gt;Blues&lt;/option&gt;
&lt;/select&gt;

&lt;script&gt;
  // 1)
  let selectedOption = genres.options[select.selectedIndex];
  alert( selectedOption.value );

  // 2)
  let newOption = new Option("classic", "Classic");
  select.append(newOption);

  // 3)
  newOption.selected = true;
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-780"></h6>
<h1 class="main__header-title" id="chapter-781">Focusing: focus/blur</h1>
<p>An element receives a focus when the user either clicks on it or uses the <kbd class="shortcut">Tab</kbd> key on the keyboard. There's also an <code>autofocus</code> HTML attribute that puts the focus into an element by default when a page loads and other means of getting a focus.</p>
<p>Focusing generally means: “prepare to accept the data here”, so that's the moment when we can run the code to initialize or load something.</p>
<p>The moment of losing the focus (“blur”) can be even more important. That's when a user clicks somewhere else or presses <kbd class="shortcut">Tab</kbd> to go to the next form field, or there are other means as well.</p>
<p>Losing the focus generally means: “the data has been entered”, so we can run the code to check it or even to save it to the server and so on.</p>
<p>There are important peculiarities when working with focus events. We'll do the best to cover them here.</p>


<h2 id="chapter-782">
Events focus/blur</h2>
<p>The <code>focus</code> event is called on focusing, and <code>blur</code> – when the element loses the focus.</p>
<p>Let's use them for validation of an input field.</p>
<p>In the example below:</p>
<ul>
<li>The <code>blur</code> handler checks if the field the email is entered, and if not – shows an error.</li>
<li>The <code>focus</code> handler hides the error message (on <code>blur</code> it will be checked again):</li>
</ul>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true" data-highlight-inline="10:0-12,17:0-13">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  .invalid { border-color: red; }
  #error { color: red }
&lt;/style&gt;

Your email please: &lt;input type="email" id="input"&gt;

&lt;div id="error"&gt;&lt;/div&gt;

&lt;script&gt;
input.onblur = function() {
  if (!input.value.includes('@')) { // not email
    input.classList.add('invalid');
    error.innerHTML = 'Please enter a correct email.'
  }
};

input.onfocus = function() {
  if (this.classList.contains('invalid')) {
    // remove the "error" indication, because the user wants to re-enter something
    this.classList.remove('invalid');
    error.innerHTML = "";
  }
};
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-5i72io" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>Modern HTML allows to do many validations using input attributes: <code>required</code>, <code>pattern</code> and so on. And sometimes they are just what we need. JavaScript can be used when we want more flexibility. Also we could automatically send the changed value on the server if it's correct.</p>
<h2 id="chapter-783">
Methods focus/blur</h2>
<p>Methods <code>elem.focus()</code> and <code>elem.blur()</code> set/unset the focus on the element.</p>
<p>For instance, let's make the visitor unable to leave the input if the value is invalid:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-block="14-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  .error {
    background: red;
  }
&lt;/style&gt;

Your email please: &lt;input type="email" id="input"&gt;
&lt;input type="text" style="width:220px" placeholder="make email invalid and try to focus here"&gt;

&lt;script&gt;
  input.onblur = function() {
    if (!this.value.includes('@')) { // not email
      // show the error
      this.classList.add("error");
      // ...and put the focus back
      input.focus();
    } else {
      this.classList.remove("error");
    }
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-9q1z24" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>It works in all browsers except Firefox (
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=53579">bug</a>).</p>
<p>If we enter something into the input and then try to use <kbd class="shortcut">Tab</kbd> or click away from the <code>&lt;input&gt;</code>, then <code>onblur</code> returns the focus back.</p>
<p>Please note that we can't “prevent losing focus” by calling <code>event.preventDefault()</code> in <code>onblur</code>, because <code>onblur</code> works <em>after</em> the element lost the focus.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">JavaScript-initiated focus loss</span></div>
            <div class="important__content"><p>A focus loss can occur for many reasons.</p>
<p>One of them is when the visitor clicks somewhere else. But also JavaScript itself may cause it, for instance:</p>
<ul>
<li>An <code>alert</code> moves focus to itself, so it causes the focus loss at the element (<code>blur</code> event), and when the <code>alert</code> is dismissed, the focus comes back (<code>focus</code> event).</li>
<li>If an element is removed from DOM, then it also causes the focus loss. If it is reinserted later, then the focus doesn't return.</li>
</ul>
<p>These features sometimes cause <code>focus/blur</code> handlers to misbehave – to trigger when they are not needed.</p>
<p>The best recipe is to be careful when using these events. If we want to track user-initiated focus-loss, then we should evade causing it by ourselves.</p>
</div></div>
<h2 id="chapter-784">
Allow focusing on any element: tabindex</h2>
<p>By default many elements do not support focusing.</p>
<p>The list varies between browsers, but one thing is always correct: <code>focus/blur</code> support is guaranteed for elements that a visitor can interact with: <code>&lt;button&gt;</code>, <code>&lt;input&gt;</code>, <code>&lt;select&gt;</code>, <code>&lt;a&gt;</code> and so on.</p>
<p>From the other hand, elements that exist to format something like <code>&lt;div&gt;</code>, <code>&lt;span&gt;</code>, <code>&lt;table&gt;</code> – are unfocusable by default. The method <code>elem.focus()</code> doesn't work on them, and <code>focus/blur</code> events are never triggered.</p>
<p>This can be changed using HTML-attribute <code>tabindex</code>.</p>
<p>The purpose of this attribute is to specify the order number of the element when <kbd class="shortcut">Tab</kbd> is used to switch between them.</p>
<p>That is: if we have two elements, the first has <code>tabindex="1"</code>, and the second has <code>tabindex="2"</code>, then pressing <kbd class="shortcut">Tab</kbd> while in the first element – moves us to the second one.</p>
<p>There are two special values:</p>
<ul>
<li><code>tabindex="0"</code> makes the element the last one.</li>
<li><code>tabindex="-1"</code> means that <kbd class="shortcut">Tab</kbd> should ignore that element.</li>
</ul>
<p><strong>Any element supports focusing if it has <code>tabindex</code>.</strong></p>
<p>For instance, here's a list. Click the first item and press <kbd class="shortcut">Tab</kbd>:</p>
<div data-trusted="1" class="code-example" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">Click the first item and press Tab. Keep track of the order. Please note that many subsequent Tabs can move the focus out of the iframe with the example.
&lt;ul&gt;
  &lt;li tabindex="1"&gt;One&lt;/li&gt;
  &lt;li tabindex="0"&gt;Zero&lt;/li&gt;
  &lt;li tabindex="2"&gt;Two&lt;/li&gt;
  &lt;li tabindex="-1"&gt;Minus one&lt;/li&gt;
&lt;/ul&gt;

&lt;style&gt;
  li { cursor: pointer; }
  :focus { outline: 1px dashed green; }
&lt;/style&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-cie1o3" style="height:200px" src="about:blank"></iframe>
      </div>
      </div><p>The order is like this: <code>1 - 2 - 0</code> (zero is always the last). Normally, <code>&lt;li&gt;</code> does not support focusing, but <code>tabindex</code> full enables it, along with events and styling with <code>:focus</code>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>elem.tabIndex</code> works too</span></div>
            <div class="important__content"><p>We can add <code>tabindex</code> from JavaScript by using the <code>elem.tabIndex</code> property. That has the same effect.</p>
</div></div>
<h2 id="chapter-785">
Delegation: focusin/focusout</h2>
<p>Events <code>focus</code> and <code>blur</code> do not bubble.</p>
<p>For instance, we can't put <code>onfocus</code> on the <code>&lt;form&gt;</code> to highlight it, like this:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-inline="1:6-40">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;!-- on focusing in the form -- add the class --&gt;
&lt;form onfocus="this.className='focused'"&gt;
  &lt;input type="text" name="name" value="Name"&gt;
  &lt;input type="text" name="surname" value="Surname"&gt;
&lt;/form&gt;

&lt;style&gt; .focused { outline: 1px solid red; } &lt;/style&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-4ng8qv" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>The example above doesn't work, because when user focuses on an <code>&lt;input&gt;</code>, the <code>focus</code> event triggers on that input only. It doesn't bubble up. So <code>form.onfocus</code> never triggers.</p>
<p>There are two solutions.</p>
<p>First, there's a funny historical feature: <code>focus/blur</code> do not bubble up, but propagate down on the capturing phase.</p>
<p>This will work:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-block="8-10">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form id="form"&gt;
  &lt;input type="text" name="name" value="Name"&gt;
  &lt;input type="text" name="surname" value="Surname"&gt;
&lt;/form&gt;

&lt;style&gt; .focused { outline: 1px solid red; } &lt;/style&gt;

&lt;script&gt;
  // put the handler on capturing phase (last argument true)
  form.addEventListener("focus", () =&gt; form.classList.add('focused'), true);
  form.addEventListener("blur", () =&gt; form.classList.remove('focused'), true);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-w18g5" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>Second, there are <code>focusin</code> and <code>focusout</code> events – exactly the same as <code>focus/blur</code>, but they bubble.</p>
<p>Note that they must be assigned using <code>elem.addEventListener</code>, not <code>on&lt;event&gt;</code>.</p>
<p>So here's another working variant:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-block="8-10">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form id="form"&gt;
  &lt;input type="text" name="name" value="Name"&gt;
  &lt;input type="text" name="surname" value="Surname"&gt;
&lt;/form&gt;

&lt;style&gt; .focused { outline: 1px solid red; } &lt;/style&gt;

&lt;script&gt;
  // put the handler on capturing phase (last argument true)
  form.addEventListener("focusin", () =&gt; form.classList.add('focused'));
  form.addEventListener("focusout", () =&gt; form.classList.remove('focused'));
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-1bv366" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><h2 id="chapter-786">
Summary</h2>
<p>Events <code>focus</code> and <code>blur</code> trigger on focusing/losing focus on the element.</p>
<p>Their specials are:</p>
<ul>
<li>They do not bubble. Can use capturing state instead or <code>focusin/focusout</code>.</li>
<li>Most elements do not support focus by default. Use <code>tabindex</code> to make anything focusable.</li>
</ul>
<p>The current focused element is available as <code>document.activeElement</code>.</p>
<div class="tasks"><h2 id="chapter-787" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#editable-div" name="editable-div" class="main__anchor">Editable div</a></h3>
<a href="http://javascript.info/task/editable-div" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a <code>&lt;div&gt;</code> that turns into <code>&lt;textarea&gt;</code> when clicked.</p>
<p>The textarea allows to edit the HTML in the <code>&lt;div&gt;</code>.</p>
<p>When the user presses <kbd class="shortcut">Enter</kbd> or it looses focus, the <code>&lt;textarea&gt;</code> turns back into <code>&lt;div&gt;</code>, and its content becomes HTML in <code>&lt;div&gt;</code>.</p>
<p>
<a href="https://en.js.cx/task/editable-div/solution/" target="blank">Demo in new window</a></p><p>
<a href="http://plnkr.co/edit/wwQw0pM1ApidAm6NWHWQ?p=preview" target="_blank" data-plunk-id="wwQw0pM1ApidAm6NWHWQ">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/OVnraEnofozTuBGWgysP?p=preview" target="_blank" data-plunk-id="OVnraEnofozTuBGWgysP">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#edit-td-on-click" name="edit-td-on-click" class="main__anchor">Edit TD on click</a></h3>
<a href="http://javascript.info/task/edit-td-click" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Make table cells editable on click.</p>
<ul>
<li>On click – the cell should became “editable” (textarea appears inside), we can change HTML. There should be no resize, all geometry should remain the same.</li>
<li>Buttons OK and CANCEL appear below the cell to finish/cancel the editing.</li>
<li>Only one cell may be editable at a moment. While a <code>&lt;td&gt;</code> is in “edit mode”, clicks on other cells are ignored.</li>
<li>The table may have many cells. Use event delegation.</li>
</ul>
<p>The demo:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:400px" src="https://en.js.cx/task/edit-td-click/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/OJ6xFJOY0HzrsJMVRUna?p=preview" target="_blank" data-plunk-id="OJ6xFJOY0HzrsJMVRUna">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><ol>
<li>On click – replace <code>innerHTML</code> of the cell by <code>&lt;textarea&gt;</code> with same sizes and no border. Can use JavaScript or CSS to set the right size.</li>
<li>Set <code>textarea.value</code> to <code>td.innerHTML</code>.</li>
<li>Focus on the textarea.</li>
<li>Show buttons OK/CANCEL under the cell, handle clicks on them.</li>
</ol>
<p>
<a href="http://plnkr.co/edit/EX2G2qMVFPWyI2Xchutm?p=preview" target="_blank" data-plunk-id="EX2G2qMVFPWyI2Xchutm">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#keyboard-driven-mouse" name="keyboard-driven-mouse" class="main__anchor">Keyboard-driven mouse</a></h3>
<a href="http://javascript.info/task/keyboard-mouse" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 4</span></div><div class="task__content"><p>Focus on the mouse. Then use arrow keys to move it:</p>
<p>
<a href="https://en.js.cx/task/keyboard-mouse/solution/" target="blank">Demo in new window</a></p><p>P.S. Don't put event handlers anywhere except the <code>#mouse</code> element.
P.P.S. Don't modify HTML/CSS, the approach should be generic and work with any element.</p>
<p>
<a href="http://plnkr.co/edit/vBbAOCseNGfEcX4mdDBr?p=preview" target="_blank" data-plunk-id="vBbAOCseNGfEcX4mdDBr">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We can use <code>mouse.onclick</code> to handle the click and make the mouse “moveable” with <code>position:fixed</code>, then then <code>mouse.onkeydown</code> to handle arrow keys.</p>
<p>The only pitfall is that <code>keydown</code> only triggers on elements with focus. So we need to add <code>tabindex</code> to the element.  As we're forbidden to change HTML, we can use <code>mouse.tabIndex</code> property for that.</p>
<p>P.S. We also can replace <code>mouse.onclick</code> with <code>mouse.onfocus</code>.</p>
<p>
<a href="http://plnkr.co/edit/H3LCTS0TVc2qwE5WRZm7?p=preview" target="_blank" data-plunk-id="H3LCTS0TVc2qwE5WRZm7">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-788"></h6>
<h1 class="main__header-title" id="chapter-789">Events: change, input, cut, copy, paste</h1>
<p>Let's discuss various events that accompany data updates.</p>
<h2 id="chapter-790">
Event: change</h2>
<p>The 
<a href="http://www.w3.org/TR/html5/forms.html#event-input-change">change</a> event triggers when the element has finished changing.</p>
<p>For text inputs that means that the event occurs when it looses focus.</p>
<p>For instance, while we are typing in the text field below – there's no event. But when we move the focus somewhere else, for instance, click on a button – there will be a <code>change</code> event:</p>
<div data-trusted="1" class="code-example" data-demo-height="40" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="text" onchange="alert(this.value)"&gt;
&lt;input type="button" value="Button"&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-1qvufb" style="height:40px" src="about:blank"></iframe>
      </div>
      </div><p>For other elements: <code>select</code>, <code>input type=checkbox/radio</code> it triggers right after the selection changes.</p>
<h2 id="chapter-791">
Event: input</h2>
<p>The <code>input</code> event triggers every time a value is modified.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-demo-height="40" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="text" id="input"&gt; oninput: &lt;span id="result"&gt;&lt;/span&gt;
&lt;script&gt;
  input.oninput = function() {
    result.innerHTML = input.value;
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-cxf28o" style="height:40px" src="about:blank"></iframe>
      </div>
      </div><p>If we want to handle every modification of an <code>&lt;input&gt;</code> then this event is the best choice.</p>
<p>Unlike keyboard events it works on any value change, even those that does not involve keyboard actions: pasting with a mouse or using speech recognition to dictate the text.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Can't prevent anything in <code>oninput</code></span></div>
            <div class="important__content"><p>The <code>input</code> event occurs after the value is modified.</p>
<p>So we can't use <code>event.preventDefault()</code> there – it's just too late, there would be no effect.</p>
</div></div>
<h2 id="chapter-792">
Events: cut, copy, paste</h2>
<p>These events occur on cutting/copying/pasting a value.</p>
<p>They belong to 
<a href="https://www.w3.org/TR/clipboard-apis/#clipboard-event-interfaces">ClipboardEvent</a> class and provide access to the data that is copied/pasted.</p>
<p>We also can use <code>event.preventDefault()</code> to abort the action.</p>
<p>For instance, the code below prevents all such events and shows what we are trying to cut/copy/paste:</p>
<div data-trusted="1" class="code-example" data-demo-height="40" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;input type="text" id="input"&gt;
&lt;script&gt;
  input.oncut = input.oncopy = input.onpaste = function(event) {
    alert(event.type + ' - ' + event.clipboardData.getData('text/plain'));
    return false;
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-9jg8yj" style="height:40px" src="about:blank"></iframe>
      </div>
      </div><p>Technically, we can copy/paste everything. For instance, we can copy and file in the OS file manager, and paste it.</p>
<p>There's a list of methods 
<a href="https://www.w3.org/TR/clipboard-apis/#dfn-datatransfer">in the specification</a> to work with different data types, read/write to the clipboard.</p>
<p>But please note that clipboard is a “global” OS-level thing. Most browsers allow read/write access to the clipboard only in the scope of certain user actions for the safety. Also it is forbidden to create “custom” clipboard events in all browsers except Firefox.</p>
<h2 id="chapter-793">
Summary</h2>
<p>Data change events:</p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Description</th>
<th>Specials</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>change</code></td>
<td>A value was changed.</td>
<td>For text inputs triggers on focus loss.</td>
</tr>
<tr>
<td><code>input</code></td>
<td>For text inputs on every change.</td>
<td>Triggers immediately unlike <code>change</code>.</td>
</tr>
<tr>
<td><code>cut/copy/paste</code></td>
<td>Cut/copy/paste actions.</td>
<td>The action can be prevented. The <code>event.clipbordData</code> property gives read/write access to the clipboard.</td>
</tr>
</tbody>
</table>
<div class="tasks"><h2 id="chapter-794" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#deposit-calculator" name="deposit-calculator" class="main__anchor">Deposit calculator</a></h3>
<a href="http://javascript.info/task/deposit-calculator" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create an interface that allows to enter a sum of bank deposit and percentage, then calculates how much it will be after given periods of time.</p>
<p>Here's the demo:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:350px" src="https://en.js.cx/task/deposit-calculator/solution/"></iframe>
  </div><p>Any input change should be processed immediately.</p>
<p>The formula is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// initial: the initial money sum
// interest: e.g. 0.05 means 5% per year
// years: how many years to wait
let result = Math.round(initial * (1 + interest * years));</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/0s2PUFvB7xNiuf675QDj?p=preview" target="_blank" data-plunk-id="0s2PUFvB7xNiuf675QDj">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/OE8bAmgB75LVeGTA6R0H?p=preview" target="_blank" data-plunk-id="OE8bAmgB75LVeGTA6R0H">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>


<h6 id="chapter-795"></h6>
<h1 class="main__header-title" id="chapter-796">Form submission: event and method submit</h1>
<p>The <code>submit</code> event triggers when the form is submitted, it is usually used to validate the form before sending it to the server or to abort the submission and process it in JavaScript.</p>
<p>The method <code>form.submit()</code> allows to initiate form sending from JavaScript. We can use it to dynamically create and send our own forms to server.</p>
<p>Let's see more details of them.</p>


<h2 id="chapter-797">
Event: submit</h2>
<p>There are two main ways to submit a form:</p>
<ol>
<li>The first – to click <code>&lt;input type="submit"&gt;</code> or <code>&lt;input type="image"&gt;</code>.</li>
<li>The second – press <kbd class="shortcut">Enter</kbd> on an input field.</li>
</ol>
<p>Both actions lead to <code>submit</code> event on the form. The handler can check the data, and if there are errors, show them and call <code>event.preventDefault()</code>, then the form won't be sent to the server.</p>
<p>In the form below:</p>
<ol>
<li>Go into the text field and press <kbd class="shortcut">Enter</kbd>.</li>
<li>Click <code>&lt;input type="submit"&gt;</code>.</li>
</ol>
<p>Both actions show <code>alert</code> and the form is not sent anywhere due to <code>return false</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form onsubmit="alert('submit!');return false"&gt;
  First: Enter in the input field &lt;input type="text" value="text"&gt;&lt;br&gt;
  Second: Click "submit": &lt;input type="submit" value="Submit"&gt;
&lt;/form&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-d1fdtn" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Relation between <code>submit</code> and <code>click</code></span></div>
            <div class="important__content"><p>When a form is sent using <kbd class="shortcut">Enter</kbd> on an input field, a <code>click</code> event triggers on the <code>&lt;input type="submit"&gt;</code>.</p>
<p>That's rather funny, because there was no click at all.</p>
<p>Here's the demo:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true" data-highlight-inline="2:37-61">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;form onsubmit="return false"&gt;
 &lt;input type="text" size="30" value="Focus here and press enter"&gt;
 &lt;input type="submit" value="Submit" onclick="alert('click')"&gt;
&lt;/form&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-8h10to" style="height:60px" src="about:blank"></iframe>
      </div>
      </div></div></div>
<h2 id="chapter-798">
Method: submit</h2>
<p>To submit a form to the server manually, we can call <code>form.submit()</code>.</p>
<p>Then the <code>submit</code> event is not generated. It is assumed that if the programmer calls <code>form.submit()</code>, then the script already did all related processing.</p>
<p>Sometimes that's used to manually create and send a form, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let form = document.createElement('form');
form.action = 'https://google.com/search';
form.method = 'GET';

form.innerHTML = '&lt;input name="q" value="test"&gt;';

// the form must be in the document to submit it
document.body.append(form);

form.submit();</code></pre>
        </div>
      </div>
      
      </div><div class="tasks"><h2 id="chapter-799" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#modal-form" name="modal-form" class="main__anchor">Modal form</a></h3>
<a href="http://javascript.info/task/modal-dialog" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a function <code>showPrompt(html, callback)</code> that shows a form with the message <code>html</code>, an input field and buttons <code>OK/CANCEL</code>.</p>
<ul>
<li>A user should type something into a text field and press <kbd class="shortcut">Enter</kbd> or the OK button, then <code>callback(value)</code> is called with the value he entered.</li>
<li>Otherwise if the user presses <kbd class="shortcut">Esc</kbd> or CANCEL, then <code>callback(null)</code> is called.</li>
</ul>
<p>In both cases that ends the input process and removes the form.</p>
<p>Requirements:</p>
<ul>
<li>The form should be in the center of the window.</li>
<li>The form is <em>modal</em>. In other words, no interaction with the rest of the page is possible until the user closes it.</li>
<li>When the form is shown, the focus should be inside the <code>&lt;input&gt;</code> for the user.</li>
<li>Keys <kbd class="shortcut">Tab</kbd>/<kbd class="shortcut">Shift<span class="shortcut__plus">+</span>Tab</kbd> should shift the focus between form fields, don't allow it to leave for other page elements.</li>
</ul>
<p>Usage example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">showPrompt("Enter something&lt;br&gt;...smart :)", function(value) {
  alert(value);
});</code></pre>
        </div>
      </div>
      
      </div><p>A demo in the iframe:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:160px" src="https://en.js.cx/task/modal-dialog/solution/"></iframe>
  </div><p>P.S. The source document has HTML/CSS for the form with fixed positioning, but it's up to you to make it modal.</p>
<p>
<a href="http://plnkr.co/edit/M2P7SapvG9mZ9GyOOmDl?p=preview" target="_blank" data-plunk-id="M2P7SapvG9mZ9GyOOmDl">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>A modal window can be implemented using a half-transparent <code>&lt;div id="cover-div"&gt;</code> that covers the whole window, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">#cover-div {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 9000;
  width: 100%;
  height: 100%;
  background-color: gray;
  opacity: 0.3;
}</code></pre>
        </div>
      </div>
      
      </div><p>Because the <code>&lt;div&gt;</code> covers everything, it gets all clicks, not the page below it.</p>
<p>Also we can prevent page scroll by setting <code>body.style.overflowY='hidden'</code>.</p>
<p>The form should be not in the <code>&lt;div&gt;</code>, but next to it, because we don't want it to have <code>opacity</code>.</p>
<p>
<a href="http://plnkr.co/edit/oFrML9h5VekyphYxJghH?p=preview" target="_blank" data-plunk-id="oFrML9h5VekyphYxJghH">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<p>CSS and JavaScript animations.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/bezier-curve" class="lessons-list__link">Bezier curve</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/css-animations" class="lessons-list__link">CSS-animations</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/js-animation" class="lessons-list__link">JavaScript animations</a></li></ol></div>

<h6 id="chapter-800"></h6>
<h1 class="main__header-title" id="chapter-801">Bezier curve</h1>
<p>Bezier curves are used in computer graphics to draw shapes, for CSS animation and in many other places.</p>
<p>They are actually a very simple thing, worth to study once and then feel comfortable in the world of vector graphics and advanced animations.</p>


<h2 id="chapter-802">
Control points</h2>
<p>A 
<a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve">bezier curve</a> is defined by control points.</p>
<p>There may be 2, 3, 4 or more.</p>
<p>For instance, two points curve:</p>
      <img src="http://javascript.info/article/bezier-curve/bezier2.png">
<p>Three points curve:</p>
      <img src="http://javascript.info/article/bezier-curve/bezier3.png">
<p>Four points curve:</p>
      <img src="http://javascript.info/article/bezier-curve/bezier4.png">
<p>If you look closely at these curves, you can immediately notice:</p>
<ol>
<li>
<p><strong>Points are not always on curve.</strong> That's perfectly normal, later we'll see how the curve is built.</p>
</li>
<li>
<p><strong>The curve order equals the number of points minus one</strong>.
For two points we have a linear curve (that's a straight line), for three points – quadratic curve (parabolic), for three points – cubic curve.</p>
</li>
<li>
<p><strong>A curve is always inside the 
<a href="https://en.wikipedia.org/wiki/Convex_hull">convex hull</a> of control points:</strong></p>
<p><img src="http://javascript.info/article/bezier-curve/bezier4-e.png">
</p></li>
</ol>
<p>Because of that last property, in computer graphics it's possible to optimize intersection tests. If convex hulls do not intersect, then curves do not either. So checking for the convex hulls intersection first can give a very fast “no intersection” result. Checking the intersection or convex hulls is much easier, because they are rectangles, triangles and so on (see the picture above), much simpler figures than the curve.</p>
<p>The main value of Bezier curves for drawing – by moving the points the curve is changing <em>in intuitively obvious way</em>.</p>
<p>Try to move control points using a mouse in the example below:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:370px" src="https://en.js.cx/article/bezier-curve/demo.svg?nocpath=1&amp;p=0,0,0.5,0,0.5,1,1,1"></iframe>
  </div><p><strong>As you can notice, the curve stretches along the tangential lines 1 → 2 and 3 → 4.</strong></p>
<p>After some practice it becomes obvious how to place points to get the needed curve. And by connecting several curves we can get practically anything.</p>
<p>Here are some examples:</p>
<p><img src="http://javascript.info/article/bezier-curve/bezier-car.png">
</p><h2 id="chapter-803">
Maths</h2>
<p>A Bezier curve can be described using a mathematical formula.</p>
<p>As we'll see soon – there's no need to know it. But for completeness – here it is.</p>
<p>Given the coordinates of control points <code>P<sub>i</sub></code>: the first control point has coordinates <code>P<sub>1</sub> = (x<sub>1</sub>, y<sub>1</sub>)</code>, the second: <code>P<sub>2</sub> = (x<sub>2</sub>, y<sub>2</sub>)</code>, and so on, the curve coordinates are described by the equation that depends on the parameter <code>t</code> from the segment <code>[0,1]</code>.</p>
<ul>
<li>
<p>The formula for a 2-points curve:</p>
<p><code>P = (1-t)P<sub>1</sub> + tP<sub>2</sub></code></p>
</li>
<li>
<p>For three points:</p>
<p><code>P = (1−t)<sup>2</sup>P<sub>1</sub> + 2(1−t)tP<sub>2</sub> + t<sup>2</sup>P<sub>3</sub></code></p>
</li>
<li>
<p>For four points:</p>
<p><code>P = (1−t)<sup>3</sup>P<sub>1</sub> + 3(1−t)<sup>2</sup>tP<sub>2</sub>  +3(1−t)t<sup>2</sup>P<sub>3</sub> + t<sup>3</sup>P<sub>4</sub></code></p>
</li>
</ul>
<p>These are vector equations.</p>
<p>We can rewrite them coordinate-by-coordinate, for instance the 3-point curve:</p>
<ul>
<li><code>x = (1−t)<sup>2</sup>x<sub>1</sub> + 2(1−t)tx<sub>2</sub> + t<sup>2</sup>x<sub>3</sub></code></li>
<li><code>y = (1−t)<sup>2</sup>y<sub>1</sub> + 2(1−t)ty<sub>2</sub> + t<sup>2</sup>y<sub>3</sub></code></li>
</ul>
<p>Instead of <code>x<sub>1</sub>, y<sub>1</sub>, x<sub>2</sub>, y<sub>2</sub>, x<sub>3</sub>, y<sub>3</sub></code> we should put coordinates of 3 control points.</p>
<p>For instance, if control points are  <code>(0,0)</code>, <code>(0.5, 1)</code> and <code>(1, 0)</code>, the equations are:</p>
<ul>
<li><code>x = (1−t)<sup>2</sup> * 0 + 2(1−t)t * 0.5 + t<sup>2</sup> * 1 = (1-t)t + t<sup>2</sup> = t</code></li>
<li><code>y = (1−t)<sup>2</sup> * 0 + 2(1−t)t * 1 + t<sup>2</sup> * 0 = 2(1-t)t = –t<sup>2</sup> + 2t</code></li>
</ul>
<p>Now as <code>t</code> runs from <code>0</code> to <code>1</code>, the set of values <code>(x,y)</code> for each <code>t</code> forms the curve.</p>
<p>That's probably too scientific, not very obvious why curves look like that, and how they depend on control points.</p>
<p>So here's the drawing algorithm that may be easier to understand.</p>
<h2 id="chapter-804">
De Casteljau's algorithm</h2>
<p>
<a href="https://en.wikipedia.org/wiki/De_Casteljau%27s_algorithm">De Casteljau's algorithm</a> is identical to the mathematical definition of the curve, but visually shows how it is built.</p>
<p>Let's see it on the 3-points example.</p>
<p>Here's the demo, and the explanation follow.</p>
<p>Points can be moved by the mouse. Press the “play” button to run it.</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:370px" src="https://en.js.cx/article/bezier-curve/demo.svg?p=0,0,0.5,1,1,0&amp;animate=1"></iframe>
  </div><p><strong>De Casteljau's algorithm of building the 3-point bezier curve:</strong></p>
<ol>
<li>
<p>Draw control points. In the demo above they are labeled: <code>1</code>, <code>2</code>, <code>3</code>.</p>
</li>
<li>
<p>Build segments between control points 1 → 2 → 3. In the demo above they are <span style="color:#825E28">brown</span>.</p>
</li>
<li>
<p>The parameter <code>t</code> moves from <code>0</code> to <code>1</code>. In the example above the step <code>0.05</code> is used: the loop goes over <code>0, 0.05, 0.1, 0.15, ... 0.95, 1</code>.</p>
<p>For each of these values of <code>t</code>:</p>
<ul>
<li>
<p>On each <span style="color:#825E28">brown</span> segment we take a point located on the distance proportional to <code>t</code> from its beginning. As there are two segments, we have two points.</p>
<p>For instance, for <code>t=0</code> – both points will be at the beginning of segments, and for <code>t=0.25</code> – on the 25% of segment length from the beginning, for <code>t=0.5</code> – 50%(the middle), for <code>t=1</code> – in the end of segments.</p>
</li>
<li>
<p>Connect the points. On the picture below the connecting segment is painted <span style="color:#167490">blue</span>.</p>
</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>For <code>t=0.25</code></th>
<th>For <code>t=0.5</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="http://javascript.info/article/bezier-curve/bezier3-draw1.png">
</td><td><img src="http://javascript.info/article/bezier-curve/bezier3-draw2.png">
</td></tr>
</tbody>
</table>
<ol start="4">
<li>
<p>Now the <span style="color:#167490">blue</span> segment take a point on the distance proportional to the same value of <code>t</code>. That is, for <code>t=0.25</code> (the left picture) we have a point at the end of the left quarter of the segment, and for <code>t=0.5</code> (the right picture) – in the middle of the segment. On pictures above that point is <span style="color:red">red</span>.</p>
</li>
<li>
<p>As <code>t</code> runs from <code>0</code> to <code>1</code>, every value of <code>t</code> adds a point to the curve. The set of such points forms the Bezier curve. It's red and parabolic on the pictures above.</p>
</li>
</ol>
<p>That was a process for 3 points. But the same is for 4 points.</p>
<p>The demo for 4 points (points can be moved by mouse):</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:370px" src="https://en.js.cx/article/bezier-curve/demo.svg?p=0,0,0.5,0,0.5,1,1,1&amp;animate=1"></iframe>
  </div><p>The algorithm:</p>
<ul>
<li>Control points are connected by segments: 1 → 2, 2 → 3, 3 → 4. We have 3 <span style="color:#825E28">brown</span> segments.</li>
<li>For each <code>t</code> in the interval from <code>0</code> to <code>1</code>:
<ul>
<li>We take points on these segments on the distance proportional to <code>t</code> from the beginning. These points are connected, so that we have two <span style="color:#0A0">green segments</span>.</li>
<li>On these segments we take points proportional to <code>t</code>. We get one <span style="color:#167490">blue segment</span>.</li>
<li>On the blue segment we take a point proportional to <code>t</code>. On the example above it's <span style="color:red">red</span>.</li>
</ul>
</li>
<li>These points together form the curve.</li>
</ul>
<p>The algorithm is recursive and can be generalized for any number of control points.</p>
<p>Given N of control points, we connect them to get initially N-1 segments.</p>
<p>Then for each <code>t</code> from <code>0</code> to <code>1</code>:</p>
<ul>
<li>Take a point on each of segment on the distance proportional to <code>t</code> and connect them – there will be N-2 segments.</li>
<li>Take a point on each of these segments on the distance proportional to <code>t</code> and connect – there will be N-3 segments, and so on…</li>
<li>Till we have one point. These points make the curve.</li>
</ul>
<p>Move examples of curves:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:370px" src="https://en.js.cx/article/bezier-curve/demo.svg?p=0,0,0,0.75,0.25,1,1,1&amp;animate=1"></iframe>
  </div><p>With other points:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:370px" src="https://en.js.cx/article/bezier-curve/demo.svg?p=0,0,1,0.5,0,0.5,1,1&amp;animate=1"></iframe>
  </div><p>Loop form:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:370px" src="https://en.js.cx/article/bezier-curve/demo.svg?p=0,0,1,0.5,0,1,0.5,0&amp;animate=1"></iframe>
  </div><p>Not smooth Bezier curve:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:370px" src="https://en.js.cx/article/bezier-curve/demo.svg?p=0,0,1,1,0,1,1,0&amp;animate=1"></iframe>
  </div><p>As the algorithm is recursive, we can build Bezier curves of any order: using 5, 6 or more control points. But in practice they are less useful. Usually we take 2-3 points, and for complex lines glue several curves together. That's simpler to develop and calculate.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">How to draw a curve <em>through</em> given points?</span></div>
            <div class="important__content"><p>We use control points for a Bezier curve. As we can see, they are not on the curve. Or, to be precise, the first and the last ones do belong to curve, but others don't.</p>
<p>Sometimes we have another task: to draw a curve <em>through several points</em>, so that all of them are on a single smooth curve. That task is called  
<a href="https://en.wikipedia.org/wiki/Interpolation">interpolation</a>, and here we don't cover it.</p>
<p>There are mathematical formulas for such curves, for instance 
<a href="https://en.wikipedia.org/wiki/Lagrange_polynomial">Lagrange polynomial</a>.</p>
<p>In computer graphics 
<a href="https://en.wikipedia.org/wiki/Spline_interpolation">spline interpolation</a> is often used to build smooth curves that connect many points.</p>
</div></div>
<h2 id="chapter-805">
Summary</h2>
<p>Bezier curves are defined by their control points.</p>
<p>We saw two definitions of Bezier curves:</p>
<ol>
<li>Using a mathematical formulas.</li>
<li>Using a drawing process: De Casteljau's algorithm</li>
</ol>
<p>Good properties of Bezier curves:</p>
<ul>
<li>We can draw smooth lines with a mouse by moving around control points.</li>
<li>Complex shapes can be made of several Bezier curves.</li>
</ul>
<p>Usage:</p>
<ul>
<li>In computer graphics, modeling, vector graphic editors. Fonts are described by Bezier curves.</li>
<li>In web development – for graphics on Canvas and in the SVG format. By the way, “live” examples above are written in SVG. They are actually a single SVG document that is given different points as parameters. You can open it in a separate window and see the source: 
<a href="http://javascript.info/article/bezier-curve/demo.svg?p=0,0,1,0.5,0,0.5,1,1&amp;animate=1">demo.svg</a>.</li>
<li>In CSS animation to describe the path and speed of animation.</li>
</ul>
<h6 id="chapter-806"></h6>
<h1 class="main__header-title" id="chapter-807">CSS-animations</h1>
<p>CSS animations allow to do simple animations without JavaScript at all.</p>
<p>JavaScript can be used to control CSS animation and make them even better with a little of code.</p>


<h2 id="chapter-808">
CSS transitions</h2>
<p>The idea of CSS transitions is simple. We describe a property and how its changes should be animated. When the property changes, the browser paints the animation.</p>
<p>That is: all we need is to change the property. And the fluent transition is made by the browser.</p>
<p>For instance, the CSS below animates changes of <code>background-color</code> for 3 seconds:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">.animated {
  transition-property: background-color;
  transition-duration: 3s;
}</code></pre>
        </div>
      </div>
      
      </div><p>Now if an element has <code>.animated</code> class, any change of <code>background-color</code> is animated during 3 seconds.</p>
<p>Click the button below to animate the background:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="color"&gt;Click me&lt;/button&gt;

&lt;style&gt;
  #color {
    transition-property: background-color;
    transition-duration: 3s;
  }
&lt;/style&gt;

&lt;script&gt;
  color.onclick = function() {
    this.style.backgroundColor = 'red';
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-5to25e" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>There are 5 properties to describe CSS transitions:</p>
<ul>
<li><code>transition-property</code></li>
<li><code>transition-duration</code></li>
<li><code>transition-timing-function</code></li>
<li><code>transition-delay</code></li>
</ul>
<p>We'll cover them in a moment, for now let's note that the common <code>transition</code> property allows to declare them together in the order: <code>property duration timing-function delay</code>, and also animate multiple properties at once.</p>
<p>For instance, this button animates both <code>color</code> and <code>font-size</code>:</p>
<div data-trusted="1" class="code-example" data-demo-height="80" data-autorun="true" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;button id="growing"&gt;Click me&lt;/button&gt;

&lt;style&gt;
#growing {
  transition: font-size 3s, color 2s;
}
&lt;/style&gt;

&lt;script&gt;
growing.onclick = function() {
  this.style.fontSize = '36px';
  this.style.color = 'red';
};
&lt;/script&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-b5yx2n" style="height:80px" src="about:blank"></iframe>
      </div>
      </div><p>Now let's cover animation properties one by one.</p>
<h2 id="chapter-809">
transition-property</h2>
<p>In <code>transition-property</code> we write a list of property to animate, for instance: <code>left</code>, <code>margin-left</code>, <code>height</code>, <code>color</code>.</p>
<p>Not all properties can be animated, but 
<a href="http://www.w3.org/TR/css3-transitions/#animatable-properties-">many of them</a>. The value <code>all</code> means “animate all properties”.</p>
<h2 id="chapter-810">
transition-duration</h2>
<p>In <code>transition-duration</code> we can specify how long the animation should take. The time should be in 
<a href="http://www.w3.org/TR/css3-values/#time">CSS time format</a>: in seconds <code>s</code> or milliseconds <code>ms</code>.</p>
<h2 id="chapter-811">
transition-delay</h2>
<p>In <code>transition-delay</code> we can specify the delay <em>before</em> the animation. For instance, if  <code>transition-delay: 1s</code>, then animation starts after 1 second after the change.</p>
<p>Negative values are also possible. Then the animation starts from the middle. For instance, if <code>transition-duration</code> is <code>2s</code>, and the delay is <code>-1s</code>, then the animation takes 1 second and starts from the half.</p>
<p>Here's the animation shifts numbers from <code>0</code> to <code>9</code> using CSS <code>translate</code> property:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/css-animations/digits/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/QK9KqQ9ePVtj7oSONSLr?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/css-animations/digits/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>stripe.onclick = function() {
  stripe.classList.add('animate');
};</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#digit {
  width: .5em;
  overflow: hidden;
  font: 32px monospace;
  cursor: pointer;
}

#stripe {
  display: inline-block
}

#stripe.animate {
  transform: translate(-90%);
  transition-property: transform;
  transition-duration: 9s;
  transition-timing-function: linear;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  Click below to animate:

  &lt;div id="digit"&gt;&lt;div id="stripe"&gt;0123456789&lt;/div&gt;&lt;/div&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>The <code>transform</code> property is animated like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">#stripe.animate {
  transform: translate(-90%);
  transition-property: transform;
  transition-duration: 9s;
}</code></pre>
        </div>
      </div>
      
      </div><p>In the example above JavaScript adds the class <code>.animate</code> to the element – and the animation starts:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">stripe.classList.add('animate');</code></pre>
        </div>
      </div>
      
      </div><p>We can also start it “from the middle”, from the exact number, e.g. corresponding to the current second, using the negative <code>transition-delay</code>.</p>
<p>Here if you click the digit – it starts the animation from the current second:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">script.js</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/css-animations/digits-negative-delay/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/QcoMJLhVBYIu3H96iTe5?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/css-animations/digits-negative-delay/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>stripe.onclick = function() {
  let sec = new Date().getSeconds() % 10;
  stripe.style.transitionDelay = '-' + sec + 's';
  stripe.classList.add('animate');
};</code></pre></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#digit {
  width: .5em;
  overflow: hidden;
  font: 32px monospace;
  cursor: pointer;
}

#stripe {
  display: inline-block
}

#stripe.animate {
  transform: translate(-90%);
  transition-property: transform;
  transition-duration: 9s;
  transition-timing-function: linear;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  Click below to animate:
  &lt;div id="digit"&gt;&lt;div id="stripe"&gt;0123456789&lt;/div&gt;&lt;/div&gt;

  &lt;script src="script.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p>JavaScript does it by an extra line:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-3">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">stripe.onclick = function() {
  let sec = new Date().getSeconds() % 10;
  // for instance, -3s here starts the animation from the 3rd second
  stripe.style.transitionDelay = '-' + sec + 's';
  stripe.classList.add('animate');
};</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-812">
transition-timing-function</h2>
<p>Timing function describes how the animation process is distributed along the time. Will it start slowly and then go fast or vise versa.</p>
<p>That's the most complicated property from the first sight. But it becomes very simple if we devote a bit time to it.</p>
<p>That property accepts two kinds of values: a Bezier curve or steps. Let's start from the curve, as it's used more often.</p>
<h3>
Bezier curve</a></h3><p>The timing function can be set as a 
<a href="http://javascript.info/bezier-curve">Bezier curve</a> with 4 control points that satisfies the conditions:</p>
<ol>
<li>First control point: <code>(0,0)</code>.</li>
<li>Last control point: <code>(1,1)</code>.</li>
<li>For intermediate points values of <code>x</code> must be in the interval <code>0..1</code>, <code>y</code> can be anything.</li>
</ol>
<p>The syntax for a Bezier curve in CSS: <code>cubic-bezier(x2, y2, x3, y3)</code>. Here we need to specify only 2nd and 3rd control points, because the 1st one is fixed to <code>(0,0)</code> and the 4th one is <code>(1,1)</code>.</p>
<p>The timing function describes how fast the animation process goes in time.</p>
<ul>
<li>The <code>x</code> axis is the time: <code>0</code> – the starting moment, <code>1</code> – the last moment of <code>transition-duration</code>.</li>
<li>The <code>y</code> axis specifies the completion of the process: <code>0</code> – the starting value of the property, <code>1</code> – the final value.</li>
</ul>
<p>The simplest variant is when the animation goes uniformly, with the same linear speed. That can be specified by the curve <code>cubic-bezier(0, 0, 1, 1)</code>.</p>
<p>Here's how that curve looks:</p>
      <img src="http://javascript.info/article/css-animations/bezier-linear.png">
<p>…As we can see, it's just a straight line. As the time (<code>x</code>) passes, the completion (<code>y</code>) of the animation steadily goes from <code>0</code> to <code>1</code>.</p>
<p>The train in the example below goes from left to right with the permanent speed (click it):</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/css-animations/train-linear/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/JW9bUVwRs2ejeqoGdmhQ?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/css-animations/train-linear/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>.train {
  position: relative;
  cursor: pointer;
  width: 177px;
  height: 160px;
  left: 0;
  transition: left 5s cubic-bezier(0, 0, 1, 1);
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;img class="train" src="https://js.cx/clipart/train.gif" onclick="this.style.left='450px'"&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>The CSS <code>transition</code> is based on that curve:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">.train {
  left: 0;
  transition: left 5s cubic-bezier(0, 0, 1, 1);
  /* JavaScript sets left to 450px */
}</code></pre>
        </div>
      </div>
      
      </div><p>…And how can we show a train slowing down?</p>
<p>We can use another Bezier curve: <code>cubic-bezier(0.0, 0.5, 0.5 ,1.0)</code>.</p>
<p>The graph:</p>
      <img src="http://javascript.info/article/css-animations/train-curve.png">
<p>As we can see, the process starts fast: the curve soars up high, and then slower and slower.</p>
<p>Here's the timing function in action (click the train):</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/css-animations/train/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/wobsm9I6pLHx6USU6MCF?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/css-animations/train/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>.train {
  position: relative;
  cursor: pointer;
  width: 177px;
  height: 160px;
  left: 0px;
  transition: left 5s cubic-bezier(0.0, 0.5, 0.5, 1.0);
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;img class="train" src="https://js.cx/clipart/train.gif" onclick="this.style.left='450px'"&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>CSS:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">.train {
  left: 0;
  transition: left 5s cubic-bezier(0, .5, .5, 1);
  /* JavaScript sets left to 450px */
}</code></pre>
        </div>
      </div>
      
      </div><p>There are several built-in curves: <code>linear</code>, <code>ease</code>, <code>ease-in</code>, <code>ease-out</code> and <code>ease-in-out</code>.</p>
<p>The <code>linear</code> is a shorthand for <code>cubic-bezier(0, 0, 1, 1)</code> – a straight line, we saw it already.</p>
<p>Other names are shorthands for the following <code>cubic-bezier</code>:</p>
<table>
<thead>
<tr>
<th><code>ease</code><sup>*</sup></th>
<th><code>ease-in</code></th>
<th><code>ease-out</code></th>
<th><code>ease-in-out</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(0.25, 0.1, 0.25, 1.0)</code></td>
<td><code>(0.42, 0, 1.0, 1.0)</code></td>
<td><code>(0, 0, 0.58, 1.0)</code></td>
<td><code>(0.42, 0, 0.58, 1.0)</code></td>
</tr>
<tr>
<td>mg src="http://javascript.info/article/css-animations/ease.png"&gt;
</td>
<td>mg src="http://javascript.info/article/css-animations/ease-in.png"&gt;
</td>
<td>mg src="http://javascript.info/article/css-animations/ease-out.png"&gt;
</td>
<td>mg src="http://javascript.info/article/css-animations/ease-in-out.png"&gt;
</td>
</tr>
</tbody>
</table>
<p><code>*</code> – by default, if there's no timing function, <code>ease</code> is used.</p>
<p>So we could use <code>ease-out</code> for our slowing down train:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">.train {
  left: 0;
  transition: left 5s ease-out;
  /* transition: left 5s cubic-bezier(0, .5, .5, 1); */
}</code></pre>
        </div>
      </div>
      
      </div><p>But it looks a bit differently.</p>
<p><strong>A Bezier curve can make the animation “jump out” of its range.</strong></p>
<p>The control points on the curve can have any <code>y</code> coordinates: even negative or huge. Then the Bezier curve would also jump very low or high, making the animation go beyond its normal range.</p>
<p>In the example below the animation code is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">.train {
  left: 100px;
  transition: left 5s cubic-bezier(.5, -1, .5, 2);
  /* JavaScript sets left to 400px */
}</code></pre>
        </div>
      </div>
      
      </div><p>The property <code>left</code> should animate from <code>100px</code> to <code>400px</code>.</p>
<p>But if you click the train, you'll see that:</p>
<ul>
<li>First, the train goes <em>back</em>: <code>left</code> becomes less than <code>100px</code>.</li>
<li>Then it goes forward, a little bit farther than <code>400px</code>.</li>
<li>And then back again – to <code>400px</code>.</li>
</ul>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/css-animations/train-over/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/w2w6tKCDkoDYPs1Uow5T?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/css-animations/train-over/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>.train {
  position: relative;
  cursor: pointer;
  width: 177px;
  height: 160px;
  left: 100px;
  transition: left 5s cubic-bezier(.5, -1, .5, 2);
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;img class="train" src="https://js.cx/clipart/train.gif" onclick="this.style.left='400px'"&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>Why it happens – pretty obvious if we look at the graph of the given Bezier curve:</p>
      <img src="http://javascript.info/article/css-animations/bezier-train-over.png">
<p>We moved the <code>y</code> coordinate of the 2nd point below zero, and for the 3rd point we made put it over <code>1</code>, so the curve goes out of the “regular” quadrant. The <code>y</code> is out of the “standard” range <code>0..1</code>.</p>
<p>As we know, <code>y</code> measures “the completion of the animation process”. The value <code>y = 0</code> corresponds to the starting property value and <code>y = 1</code> – the ending value. So values <code>y&lt;0</code> move the property lower than the starting <code>left</code> and <code>y&gt;1</code> – over the final <code>left</code>.</p>
<p>That's a “soft” variant for sure. If we put <code>y</code> values like <code>-99</code> and <code>99</code> then the train would jump out of the range much more.</p>
<p>But how to make the Bezier curve for a specific task? There are many tools. For instance, we can do it on the site 
<a href="http://cubic-bezier.com/">http://cubic-bezier.com/</a>.</p>
<h3>
Steps</a></h3><p>Timing function <code>steps(number of steps[, start/end])</code> allows to split animation into steps.</p>
<p>Let's see that in an example with digits. We'll make the digits change not in a smooth, but in a discrete way.</p>
<p>For that we split the animation into 9 steps:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:27-42">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">#stripe.animate  {
  transform: translate(-90%);
  transition: transform 9s steps(9, start);
}</code></pre>
        </div>
      </div>
      
      </div><p>In action <code>step(9, start)</code>:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/css-animations/step/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/AWw9LU2hZUb0asBHJ3E5?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/css-animations/step/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#digit {
  width: .5em;
  overflow: hidden;
  font: 32px monospace;
  cursor: pointer;
}

#stripe {
  display: inline-block
}

#stripe.animate {
  transform: translate(-90%);
  transition-property: transform;
  transition-duration: 9s;
  transition-timing-function: steps(9, start);
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  Click below to animate:

  &lt;div id="digit"&gt;&lt;div id="stripe"&gt;0123456789&lt;/div&gt;&lt;/div&gt;

  &lt;script&gt;
    digit.onclick = function() {
      stripe.classList.add('animate');
    }
  &lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>The first argument of <code>steps</code> is the number of steps. The transform will be split into 9 parts (10% each). The time interval is divided as well: 9 seconds split into 1 second intervals.</p>
<p>The second argument is one of two words: <code>start</code> or <code>end</code>.</p>
<p>The <code>start</code> means that in the beginning of animation we need to do make the first step immediately.</p>
<p>We can observe that during the animation: when we click on the digit it changes to <code>1</code> (the first step) immediately, and then changes in the beginning of the next second.</p>
<p>The process is progressing like this:</p>
<ul>
<li><code>0s</code> – <code>-10%</code> (first change in the beginning of the 1st second, immediately)</li>
<li><code>1s</code> – <code>-20%</code></li>
<li>…</li>
<li><code>8s</code> – <code>-80%</code></li>
<li>(the last second shows the final value).</li>
</ul>
<p>The alternative value <code>end</code> would mean that the change should be applied not in the beginning, but at the end of each second.</p>
<p>So the process would go like this:</p>
<ul>
<li><code>0s</code> – <code>0</code></li>
<li><code>1s</code> – <code>-10%</code> (first change at the end of the 1st second)</li>
<li><code>2s</code> – <code>-20%</code></li>
<li>…</li>
<li><code>9s</code> – <code>-90%</code></li>
</ul>
<p>In action <code>step(9, end)</code>:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/css-animations/step-end/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/7l33Mzm0BdWPwP78Lr9a?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/css-animations/step-end/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#digit {
  width: .5em;
  overflow: hidden;
  font: 32px monospace;
  cursor: pointer;
}

#stripe {
  display: inline-block
}

#stripe.animate {
  transform: translate(-90%);
  transition-property: transform;
  transition-duration: 9s;
  transition-timing-function: steps(9, end);
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;

&lt;body&gt;

  Click below to animate:

  &lt;div id="digit"&gt;&lt;div id="stripe"&gt;0123456789&lt;/div&gt;&lt;/div&gt;

  &lt;script&gt;
    digit.onclick = function() {
      stripe.classList.add('animate');
    }
  &lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>There are also shorthand values:</p>
<ul>
<li><code>step-start</code> – is the same as <code>steps(1, start)</code>. That is, the animation starts immediately and takes 1 step. So it starts and finishes immediately, as if there were no animation.</li>
<li><code>step-end</code> – the same as <code>steps(1, end)</code>: make the animation in a single step at the end of <code>transition-duration</code>.</li>
</ul>
<p>These values are rarely used, because that's not really animation, but rather a single-step change.</p>
<h2 id="chapter-813">
Event transitionend</h2>
<p>When the CSS animation finishes the <code>transitionend</code> event triggers.</p>
<p>It is widely used to do an action after the animation is done. Also we can join animations.</p>
<p>For instance, the ship in the example below starts to swim there and back on click, each time farther and farther to the right:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/css-animations/boat/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      <div class="toolbar__tool">
        
<a href="http://plnkr.co/edit/Im5DiuYH4s80iVvYTSgF?p=preview" target="_blank" title="open in sandbox" data-plunk-id="Im5DiuYH4s80iVvYTSgF" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/article/css-animations/boat/"></iframe>
  </div><p>The animation is initiated by the function <code>go</code> that re-runs each time when the transition finishes and flips the direction:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">boat.onclick = function() {
  //...
  let times = 1;

  function go() {
    if (times % 2) {
      // swim to the right
      boat.classList.remove('back');
      boat.style.marginLeft = 100 * times + 200 + 'px';
    } else {
      // swim to the left
      boat.classList.add('back');
      boat.style.marginLeft = 100 * times - 200 + 'px';
    }

  }

  go();

  boat.addEventListener('transitionend', function() {
    times++;
    go();
  });
};</code></pre>
        </div>
      </div>
      
      </div><p>The event object for <code>transitionend</code> has few specific properties:</p>
<dl>
<dt><code>event.propertyName</code></dt>
<dd>The property that has finished animating. Can be good if we animate multiple properties simultaneously.</dd>
<dt><code>event.elapsedTime</code></dt>
<dd>The time (in seconds) that the animation took, without <code>transition-delay</code>.</dd>
</dl>
<h2 id="chapter-814">
Keyframes</h2>
<p>We can join multiple simple animations together using the <code>@keyframes</code> CSS rule.</p>
<p>It specifies the “name” of the animation and rules: what, when and where to animate. Then using the <code>animation</code> property we attach the animation to the element and specify additional parameters for it.</p>
<p>Here's an example with explanations:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="no-epub" data-highlight-block="3-6,9-14">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;div class="progress"&gt;&lt;/div&gt;

&lt;style&gt;
  @keyframes go-left-right {        /* give it a name: "go-left-right" */
    from { left: 0px; }             /* animate from left: 0px */
    to { left: calc(100% - 50px); } /* animate to left: 100%-50px */
  }

  .progress {
    animation: go-left-right 3s infinite alternate;
    /* apply the animation "go-left-right" to the element
       duration 3 seconds
       number of times: infinite
       alternate direction every time
    */

    position: relative;
    border: 2px solid green;
    width: 50px;
    height: 20px;
    background: lime;
  }
&lt;/style&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe class="code-result__iframe" name="code-result-apfqes" style="height:60px" src="about:blank"></iframe>
      </div>
      </div><p>There are many articles about <code>@keyframes</code> and a 
<a href="https://drafts.csswg.org/css-animations/">detailed specification</a>.</p>
<p>Probably you won't need <code>@keyframes</code> often, unless everything is in the constant move on your sites.</p>
<h2 id="chapter-815">
Summary</h2>
<p>CSS animations allow to smoothly (or not) animate changes of one or multiple CSS properties.</p>
<p>They are good for most animation tasks. We're also able to use JavaScript for animations, the next chapter is devoted to that.</p>
<p>Limitations of CSS animations compared to JavaScript animations:</p>
<div class="balance"><div class="balance__pluses">
      <div class="balance__content">
      <div class="balance__title">CSS animations</div><ul class="balance__list"><li>Simple things done simply.</li>
<li>Fast and lightweight for CPU.</li>
</ul></div></div><div class="balance__minuses">
      <div class="balance__content">
      <div class="balance__title">JavaScript animations</div><ul class="balance__list"><li>JavaScript animations are flexible. They can implement any animation logic, like an “explosion” of an element.</li>
<li>Not just property changes. We can create new elements in JavaScript for purposes of animation.</li>
</ul></div></div></div><p>The majority of animations can be implemented using CSS as described in this chapter. And  <code>transitionend</code> event allows to run JavaScript after the animation, so it integrates fine with the code.</p>
<p>But in the next chapter we'll do some JavaScript animations to cover more complex cases.</p>
<div class="tasks"><h2 id="chapter-816" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#animate-a-plane-css" name="animate-a-plane-css" class="main__anchor">Animate a plane (CSS)</a></h3>
<a href="http://javascript.info/task/animate-logo-css" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Show the animation like on the picture below (click the plane):</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://en.js.cx/task/animate-logo-css/solution/"></iframe>
  </div><ul>
<li>The picture grows on click from <code>40x24px</code> to <code>400x240px</code> (10 times larger).</li>
<li>The animation takes 3 seconds.</li>
<li>At the end output: “Done!”.</li>
<li>During the animation process, there may be more clicks on the plane. They shouldn't “break” anything.</li>
</ul>
<p>
<a href="http://plnkr.co/edit/5kZqr8SujmL0JZbaRM7o?p=preview" target="_blank" data-plunk-id="5kZqr8SujmL0JZbaRM7o">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>CSS to animate both <code>width</code> and <code>height</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-css"><code class="language-css">/* original class */

#flyjet {
  transition: all 3s;
}

/* JS adds .growing */
#flyjet.growing {
  width: 400px;
  height: 240px;
}</code></pre>
        </div>
      </div>
      
      </div><p>Please note that <code>transitionend</code> triggers two times – once for every property. So if we don't perform an additional check then the message would show up 2 times.</p>
<p>
<a href="http://plnkr.co/edit/fS3JoMHCoTRQrmBCztEd?p=preview" target="_blank" data-plunk-id="fS3JoMHCoTRQrmBCztEd">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#animate-the-flying-plane-css" name="animate-the-flying-plane-css" class="main__anchor">Animate the flying plane (CSS)</a></h3>
<a href="http://javascript.info/task/animate-logo-bezier-css" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Modify the solution of the previous task 
<a href="http://javascript.info/task/animate-logo-css">Animate a plane (CSS)</a> to make the plane grow more than it's original size 400x240px (jump out), and then return to that size.</p>
<p>Here's how it should look (click on the plane):</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:350px" src="https://en.js.cx/task/animate-logo-bezier-css/solution/"></iframe>
  </div><p>Take the solution of the previous task as the source.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We need to choose the right Bezier curve for that animation. It should have <code>y&gt;1</code> somewhere for the plane to “jump out”.</p>
<p>For instance, we can take both control points with <code>y&gt;1</code>, like: <code>cubic-bezier(0.25, 1.5, 0.75, 1.5)</code>.</p>
<p>The graph:</p>
      <img src="http://javascript.info/task/animate-logo-bezier-css/bezier-up.png">
<p>
<a href="http://plnkr.co/edit/xwBfElpWPWQS3RdqzFWg?p=preview" target="_blank" data-plunk-id="xwBfElpWPWQS3RdqzFWg">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#animated-circle" name="animated-circle" class="main__anchor">Animated circle</a></h3>
<a href="http://javascript.info/task/animate-circle" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a function <code>showCircle(cx, cy, radius)</code> that shows an animated growing circle.</p>
<ul>
<li><code>cx,cy</code> are window-relative coordinates of the center of the circle,</li>
<li><code>radius</code> is the radius of the circle.</li>
</ul>
<p>Click the button below to see how it should look like:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:260px" src="https://en.js.cx/task/animate-circle/solution/"></iframe>
  </div><p>The source document has an example of a circle with right styles, so the task is precisely to do the animation right.</p>
<p>
<a href="http://plnkr.co/edit/iTfhSPqN98SDaCOzzJp3?p=preview" target="_blank" data-plunk-id="iTfhSPqN98SDaCOzzJp3">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/XWpfeLw3u2sHWznifeGm?p=preview" target="_blank" data-plunk-id="XWpfeLw3u2sHWznifeGm">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-817"></h6>
<h1 class="main__header-title" id="chapter-818">JavaScript animations</h1>
<p>JavaScript animations can handle things that CSS can't.</p>
<p>For instance, moving along a complex path, with a timing function different from Bezier curves, or an animation on a canvas.</p>


<h2 id="chapter-819">
setInterval</h2>
<p>From the HTML/CSS point of view, an animation is a gradual change of the style property. For instance, changing <code>style.left</code> from <code>0px</code> to <code>100px</code> moves the element.</p>
<p>And if we increase it in <code>setInterval</code>, by making 50 small changes per second, then it looks smooth. That's the same principle as in the cinema: 24 or more frames per second is enough to make it look smooth.</p>
<p>The pseudo-code can look like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let delay = 1000 / 50; // in 1 second 50 frames
let timer = setInterval(function() {
  if (animation complete) clearInterval(timer);
  else increase style.left
}, delay)</code></pre>
        </div>
      </div>
      
      </div><p>More complete example of the animation:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let start = Date.now(); // remember start time

let timer = setInterval(function() {
  // how much time passed from the start?
  let timePassed = Date.now() - start;

  if (timePassed &gt;= 2000) {
    clearInterval(timer); // finish the animation after 2 seconds
    return;
  }

  // draw the animation at the moment timePassed
  draw(timePassed);

}, 20);

// as timePassed goes from 0 to 2000
// left gets values from 0px to 400px
function draw(timePassed) {
  train.style.left = timePassed / 5 + 'px';
}</code></pre>
        </div>
      </div>
      
      </div><p>Click for the demo:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/js-animation/move/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/LabvtJ7jitdbsN6BXuQ1?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/js-animation/move/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;style&gt;
    #train {
      position: relative;
      cursor: pointer;
    }
  &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;img id="train" src="https://js.cx/clipart/train.gif"&gt;


  &lt;script&gt;
    train.onclick = function() {
      let start = Date.now();

      let timer = setInterval(function() {
        let timePassed = Date.now() - start;

        train.style.left = timePassed / 5 + 'px';

        if (timePassed &gt; 2000) clearInterval(timer);

      }, 20);
    }
  &lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><h2 id="chapter-820">
requestAnimationFrame</h2>
<p>Let's imagine we have several animations running simultaneously.</p>
<p>If we run them separately, each one with its own <code>setInterval(..., 20)</code>, then the browser would have to repaint much more often than every <code>20ms</code>.</p>
<p>Each <code>setInterval</code> triggers once per <code>20ms</code>, but they are independent, so we have several independent runs within <code>20ms</code>.</p>
<p>These several independent redraws should be grouped together, to make it easier for the browser.</p>
<p>In other words, this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">setInterval(function() {
  animate1();
  animate2();
  animate3();
}, 20)</code></pre>
        </div>
      </div>
      
      </div><p>…Is lighter than this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">setInterval(animate1, 20);
setInterval(animate2, 20);
setInterval(animate3, 20);</code></pre>
        </div>
      </div>
      
      </div><p>There's one more thing to keep in mind. Sometimes when CPU is overloaded, or there are other reasons to  redraw less often. For instance, if the browser tab is hidden, then there's totally no point in drawing.</p>
<p>There's a standard 
<a href="http://www.w3.org/TR/animation-timing/">Animation timing</a> that provides the function <code>requestAnimationFrame</code>.</p>
<p>It addresses all these issues and even more.</p>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let requestId = requestAnimationFrame(callback)</code></pre>
        </div>
      </div>
      
      </div><p>That schedules the <code>callback</code> function to run in the closest time when the browser wants to do animation.</p>
<p>If we do changes in elements in <code>callback</code> then they will be grouped together with other <code>requestAnimationFrame</code> callbacks and with CSS animations. So there will be one geometry recalculation and repaint instead of many.</p>
<p>The returned value <code>requestId</code> can be used to cancel the call:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// cancel the scheduled execution of callback
cancelAnimationFrame(requestId);</code></pre>
        </div>
      </div>
      
      </div><p>The <code>callback</code> gets one argument – the time passed from the beginning of the page load in microseconds. This time can also be obtained by calling 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now">performance.now()</a>.</p>
<p>Usually <code>callback</code> runs very soon, unless the CPU is overloaded or the laptop battery is almost discharged, or there's another reason.</p>
<p>The code below shows the time between first 20 runs for <code>requestAnimationFrame</code>. Usually it's 10-20ms:</p>
<div data-trusted="1" class="code-example" data-demo-height="40" data-refresh="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  let prev = performance.now();
  let times = 0;

  requestAnimationFrame(function measure(time) {
    document.body.insertAdjacentHTML("beforeEnd", Math.floor(time - prev) + " ");
    prev = time;

    if (times++ &lt; 10) requestAnimationFrame(measure);
  })
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-821">
Structured animation</h2>
<p>Now we can make a more universal animation function based on <code>requestAnimationFrame</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function animate({timing, draw, duration}) {

  let start = performance.now();

  requestAnimationFrame(function animate(time) {
    // timeFraction goes from 0 to 1
    let timeFraction = (time - start) / duration;
    if (timeFraction &gt; 1) timeFraction = 1;

    // calculate the current animation state
    let progress = timing(timeFraction)

    draw(progress); // draw it

    if (timeFraction &lt; 1) {
      requestAnimationFrame(animate);
    }

  });
}</code></pre>
        </div>
      </div>
      
      </div><p>Function <code>animate</code> accepts 3 parameters that essentially describes the animation:</p>
<dl>
<dt><code>duration</code></dt>
<dd>
<p>Total time of animation. Like, <code>1000</code>.</p>
</dd>
<dt><code>timing(timeFraction)</code></dt>
<dd>
<p>Timing function, like CSS-property <code>transition-timing-function</code> that gets the fraction of time that passed (<code>0</code> at start, <code>1</code> at the end) and returns the animation completion (like <code>y</code> on the Bezier curve).</p>
<p>For instance, a linear function means that the animation goes on uniformly with the same speed:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function linear(timeFraction) {
  return timeFraction;
}</code></pre>
        </div>
      </div>
      
      </div><p>It's graph:
<img src="http://javascript.info/article/js-animation/linear.png">
</p><p>That's just like <code>transition-timing-function: linear</code>. There are more interesting variants shown below.</p>
</dd>
<dt><code>draw(progress)</code></dt>
<dd>
<p>The function that takes the animation completion state and draws it. The value <code>progress=0</code> denotes the beginning animation state, and <code>progress=1</code> – the end state.</p>
<p>This is that function that actually draws out the animation.</p>
<p>It can move the element:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function draw(progress) {
  train.style.left = progress + 'px';
}</code></pre>
        </div>
      </div>
      
      </div><p>…Or do anything else, we can animate anything, in any way.</p>
</dd>
</dl>
<p>Let's animate the element <code>width</code> from <code>0</code> to <code>100%</code> using our function.</p>
<p>Click on the element for the demo:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">animate.js</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/js-animation/width/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/nkb9ktPTwqIHfQtwJ6Oo?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:60px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/js-animation/width/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-javascript line-numbers"><code>function animate({duration, draw, timing}) {

  let start = performance.now();

  requestAnimationFrame(function animate(time) {
    let timeFraction = (time - start) / duration;
    if (timeFraction &gt; 1) timeFraction = 1;

    let progress = timing(timeFraction)

    draw(progress);

    if (timeFraction &lt; 1) {
      requestAnimationFrame(animate);
    }

  });
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;style&gt;
    progress {
      width: 5%;
    }
  &lt;/style&gt;
  &lt;script src="animate.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;


  &lt;progress id="elem"&gt;&lt;/progress&gt;

  &lt;script&gt;
    elem.onclick = function() {
      animate({
        duration: 1000,
        timing: function(timeFraction) {
          return timeFraction;
        },
        draw: function(progress) {
          elem.style.width = progress * 100 + '%';
        }
      });
    };
  &lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>The code for it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">animate({
  duration: 1000,
  timing(timeFraction) {
    return timeFraction;
  },
  draw(progress) {
    elem.style.width = progress * 100 + '%';
  }
});</code></pre>
        </div>
      </div>
      
      </div><p>Unlike CSS animation, we can make any timing function and any drawing function here. The timing function is not limited by Bezier curves. And <code>draw</code> can go beyond properties, create new elements for like fireworks animation or something.</p>
<h2 id="chapter-822">
Timing functions</h2>
<p>We saw the simplest, linear timing function above.</p>
<p>Let's see more of them. We'll try movement animations with different timing functions to see how they work.</p>
<h3>
Power of n</a></h3><p>If we want to speed up the animation, we can use <code>progress</code> in the power <code>n</code>.</p>
<p>For instance, a parabolic curve:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function quad(timeFraction) {
  return Math.pow(timeFraction, 2)
}</code></pre>
        </div>
      </div>
      
      </div><p>The graph:</p>
      <img src="http://javascript.info/article/js-animation/quad.png">
<p>See in action (click to activate):</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/js-animation/quad/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:40px" src="https://en.js.cx/article/js-animation/quad/"></iframe>
  </div><p>…Or the cubic curve or event greater <code>n</code>. Increasing the power makes it speed up faster.</p>
<p>Here's the graph for <code>progress</code> in the power <code>5</code>:</p>
      <img src="http://javascript.info/article/js-animation/quint.png">
<p>In action:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/js-animation/quint/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:40px" src="https://en.js.cx/article/js-animation/quint/"></iframe>
  </div><h3>
The arc</a></h3><p>Function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function circ(timeFraction) {
  return 1 - Math.sin(Math.acos(timeFraction));
}</code></pre>
        </div>
      </div>
      
      </div><p>The graph:</p>
      <img src="http://javascript.info/article/js-animation/circ.png">
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/js-animation/circ/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:40px" src="https://en.js.cx/article/js-animation/circ/"></iframe>
  </div><h3>
Back: bow shooting</a></h3><p>This function does the “bow shooting”. First we “pull the bowstring”, and then “shoot”.</p>
<p>Unlike previous functions, it depends on an additional parameter <code>x</code>, the “elasticity coefficient”. The distance of “bowstring pulling” is defined by it.</p>
<p>The code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function back(x, timeFraction) {
  return Math.pow(timeFraction, 2) * ((x + 1) * timeFraction - x)
}</code></pre>
        </div>
      </div>
      
      </div><p><strong>The graph for <code>x = 1.5</code>:</strong></p>
      <img src="http://javascript.info/article/js-animation/back.png">
<p>For animation we use it with a specific value of <code>x</code>. Example for <code>x = 1.5</code>:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/js-animation/back/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:40px" src="https://en.js.cx/article/js-animation/back/"></iframe>
  </div><h3>
Bounce</a></h3><p>Imagine we are dropping a ball. It falls down, then bounces back a few times and stops.</p>
<p>The <code>bounce</code> function does the same, but in the reverse order: “bouncing” starts immediately. It uses few special coefficients for that:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function bounce(timeFraction) {
  for (let a = 0, b = 1, result; 1; a += b, b /= 2) {
    if (timeFraction &gt;= (7 - 4 * a) / 11) {
      return -Math.pow((11 - 6 * a - 11 * timeFraction) / 4, 2) + Math.pow(b, 2)
    }
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>In action:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/js-animation/bounce/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:40px" src="https://en.js.cx/article/js-animation/bounce/"></iframe>
  </div><h3>
Elastic animation</a></h3><p>One more “elastic” function that accepts an additional parameter <code>x</code> for the “initial range”.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function elastic(x, timeFraction) {
  return Math.pow(2, 10 * (timeFraction - 1)) * Math.cos(20 * Math.PI * x / 3 * timeFraction)
}</code></pre>
        </div>
      </div>
      
      </div><p><strong>The graph for <code>x=1.5</code>:</strong>
<img src="http://javascript.info/article/js-animation/elastic.png">
</p><p>In action for <code>x=1.5</code>:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        
<a href="https://en.js.cx/article/js-animation/elastic/" target="_blank" title="open in new window" class="toolbar__button toolbar__button_external"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:40px" src="https://en.js.cx/article/js-animation/elastic/"></iframe>
  </div><h2 id="chapter-823">
Reversal: ease*</h2>
<p>So we have a collection of timing functions. Their direct application is called “easeIn”.</p>
<p>Sometimes we need to show the animation in the reverse order. That's done with the “easeOut” transform.</p>
<h3>
easeOut</a></h3><p>In the “easeOut” mode the <code>timing</code> function is put into a wrapper <code>timingEaseOut</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">timingEaseOut(timeFraction) = 1 - timing(1 - timeFraction)</code></pre>
        </div>
      </div>
      
      </div><p>In other words, we have a “transform” function <code>makeEaseOut</code> that takes a “regular” timing function and returns the wrapper around it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// accepts a timing function, returns the transformed variant
function makeEaseOut(timing) {
  return function(timeFraction) {
    return 1 - timing(1 - timeFraction);
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>For instance, we can take the <code>bounce</code> function described above and apply it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let bounceEaseOut = makeEaseOut(bounce);</code></pre>
        </div>
      </div>
      
      </div><p>Then the bounce will be not in the beginning, but at the end of the animation. Looks even better:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/js-animation/bounce-easeout/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/devX4AzD5xMb0axuyQ7G?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/js-animation/bounce-easeout/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#brick {
  width: 40px;
  height: 20px;
  background: #EE6B47;
  position: relative;
  cursor: pointer;
}

#path {
  outline: 1px solid #E8C48E;
  width: 540px;
  height: 20px;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
  &lt;script src="https://js.cx/libs/animate.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;


  &lt;div id="path"&gt;
    &lt;div id="brick"&gt;&lt;/div&gt;
  &lt;/div&gt;

  &lt;script&gt;
    function makeEaseOut(timing) {
      return function(timeFraction) {
        return 1 - timing(1 - timeFraction);
      }
    }

    function bounce(timeFraction) {
      for (let a = 0, b = 1, result; 1; a += b, b /= 2) {
        if (timeFraction &gt;= (7 - 4 * a) / 11) {
          return -Math.pow((11 - 6 * a - 11 * timeFraction) / 4, 2) + Math.pow(b, 2)
        }
      }
    }

    let bounceEaseOut = makeEaseOut(bounce);

    brick.onclick = function() {
      animate({
        duration: 3000,
        timing: bounceEaseOut,
        draw: function(progress) {
          brick.style.left = progress * 500 + 'px';
        }
      });
    };
  &lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>Here we can see how the transform changes the behavior of the function:</p>
      <img src="http://javascript.info/article/js-animation/bounce-inout.png">
<p>If there's an animation effect in the beginning, like bouncing – it will be shown at the end.</p>
<p>In the graph above the <span style="color:#EE6B47">regular bounce</span> has the red color, and the <span style="color:#62C0DC">easeOut bounce</span> is blue.</p>
<ul>
<li>Regular bounce – the object bounces at the bottom, then at the end sharply jumps to the top.</li>
<li>After <code>easeOut</code> – it first jumps to the top, then bounces there.</li>
</ul>
<h3>
easeInOut</a></h3><p>We also can show the effect both in the beginning and the end of the animation. The transform is called “easeInOut”.</p>
<p>Given the timing function, we calculate the animation state like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (timeFraction &lt;= 0.5) { // first half of the animation
  return timing(2 * timeFraction) / 2;
} else { // second half of the animation
  return (2 - timing(2 * (1 - timeFraction))) / 2;
}</code></pre>
        </div>
      </div>
      
      </div><p>The wrapper code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function makeEaseInOut(timing) {
  return function(timeFraction) {
    if (timeFraction &lt; .5)
      return timing(2 * timeFraction) / 2;
    else
      return (2 - timing(2 * (1 - timeFraction))) / 2;
  }
}

bounceEaseInOut = makeEaseInOut(bounce);</code></pre>
        </div>
      </div>
      
      </div><p>In action, <code>bounceEaseInOut</code>:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/js-animation/bounce-easeinout/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/nw8e2xuzCeau9GM8gmQ0?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/js-animation/bounce-easeinout/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#brick {
  width: 40px;
  height: 20px;
  background: #EE6B47;
  position: relative;
  cursor: pointer;
}

#path {
  outline: 1px solid #E8C48E;
  width: 540px;
  height: 20px;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
  &lt;script src="https://js.cx/libs/animate.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;


  &lt;div id="path"&gt;
    &lt;div id="brick"&gt;&lt;/div&gt;
  &lt;/div&gt;

  &lt;script&gt;
    function makeEaseInOut(timing) {
      return function(timeFraction) {
        if (timeFraction &lt; .5)
          return timing(2 * timeFraction) / 2;
        else
          return (2 - timing(2 * (1 - timeFraction))) / 2;
      }
    }


    function bounce(timeFraction) {
      for (let a = 0, b = 1, result; 1; a += b, b /= 2) {
        if (timeFraction &gt;= (7 - 4 * a) / 11) {
          return -Math.pow((11 - 6 * a - 11 * timeFraction) / 4, 2) + Math.pow(b, 2)
        }
      }
    }

    let bounceEaseInOut = makeEaseInOut(bounce);

    brick.onclick = function() {
      animate({
        duration: 3000,
        timing: bounceEaseInOut,
        draw: function(progress) {
          brick.style.left = progress * 500 + 'px';
        }
      });
    };
  &lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><p>The “easeInOut” transform joins two graphs into one: <code>easeIn</code> (regular) for the first half of the animation and <code>easeOut</code> (reversed) – for the second part.</p>
<p>The effect is clearly seen if we compare the graphs of <code>easeIn</code>, <code>easeOut</code> and <code>easeInOut</code> of the <code>circ</code> timing function:</p>
      <img src="http://javascript.info/article/js-animation/circ-ease.png">
<ul>
<li><span style="color:#EE6B47">Red</span> is the regular variantof <code>circ</code> (<code>easeIn</code>).</li>
<li><span style="color:#8DB173">Green</span> – <code>easeOut</code>.</li>
<li><span style="color:#62C0DC">Blue</span> – <code>easeInOut</code>.</li>
</ul>
<p>As we can see, the graph of the first half of the animation is the scaled down <code>easeIn</code>, and the second half is the scaled down <code>easeOut</code>. As a result, the animation starts and finishes with the same effect.</p>
<h2 id="chapter-824">
More interesting “draw”</h2>
<p>Instead of moving the element we can do something else. All we need is to write the write the proper <code>draw</code>.</p>
<p>Here's the animated “bouncing” text typing:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/js-animation/text/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/ZRwXZdsRUTev6UsmIdop?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/js-animation/text/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>textarea {
  display: block;
  border: 1px solid #BBB;
  color: #444;
  font-size: 110%;
}

button {
  margin-top: 10px;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
  &lt;script src="https://js.cx/libs/animate.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;


  &lt;textarea id="textExample" rows="5" cols="60"&gt;He took his vorpal sword in hand:
Long time the manxome foe he sought—
So rested he by the Tumtum tree,
And stood awhile in thought.
  &lt;/textarea&gt;

  &lt;button onclick="animateText(textExample)"&gt;Run the animated typing!&lt;/button&gt;

  &lt;script&gt;
    function animateText(textArea) {
      let text = textArea.value;
      let to = text.length,
        from = 0;

      animate({
        duration: 5000,
        timing: bounce,
        draw: function(progress) {
          let result = (to - from) * progress + from;
          textArea.value = text.substr(0, Math.ceil(result))
        }
      });
    }


    function bounce(timeFraction) {
      for (let a = 0, b = 1, result; 1; a += b, b /= 2) {
        if (timeFraction &gt;= (7 - 4 * a) / 11) {
          return -Math.pow((11 - 6 * a - 11 * timeFraction) / 4, 2) + Math.pow(b, 2)
        }
      }
    }
  &lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</code></pre></div></div></div><h2 id="chapter-825">
Summary</h2>
<p>JavaScript animation should be implemented via <code>requestAnimationFrame</code>. That built-in method allows to setup a callback function to run when the browser will be preparing a repaint. Usually that's very soon, but the exact time depends on the browser.</p>
<p>When a page is in the background, there are no repaints at all, so the callback won't run: the animation will be suspended and won't consume resources. That's great.</p>
<p>Here's the helper <code>animate</code> function to setup most animations:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function animate({timing, draw, duration}) {

  let start = performance.now();

  requestAnimationFrame(function animate(time) {
    // timeFraction goes from 0 to 1
    let timeFraction = (time - start) / duration;
    if (timeFraction &gt; 1) timeFraction = 1;

    // calculate the current animation state
    let progress = timing(timeFraction);

    draw(progress); // draw it

    if (timeFraction &lt; 1) {
      requestAnimationFrame(animate);
    }

  });
}</code></pre>
        </div>
      </div>
      
      </div><p>Options:</p>
<ul>
<li><code>duration</code> – the total animation time in ms.</li>
<li><code>timing</code> – the function to calculate animation progress. Gets a time fraction from 0 to 1, returns the animation progress, usually from 0 to 1.</li>
<li><code>draw</code> – the function to draw the animation.</li>
</ul>
<p>Surely we could improve it, add more bells and whistles, but JavaScript animations are not applied on a daily basis. They are used to do something interesting and non-standard. So you'd want to add the features that you need when you need them.</p>
<p>JavaScript animations can use any timing function. We covered a lot of examples and transformations to make them even more versatile. Unlike CSS, we are not limited to Bezier curves here.</p>
<p>The same is about <code>draw</code>: we can animate anything, not just CSS properties.</p>
<div class="tasks"><h2 id="chapter-826" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#animate-the-bouncing-ball" name="animate-the-bouncing-ball" class="main__anchor">Animate the bouncing ball</a></h3>
<a href="http://javascript.info/task/animate-ball" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Make a bouncing ball. Click to see how it should look:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://en.js.cx/task/animate-ball/solution/"></iframe>
  </div><p>
<a href="http://plnkr.co/edit/FJDfepvCOFAlsZsc15yr?p=preview" target="_blank" data-plunk-id="FJDfepvCOFAlsZsc15yr">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>To bounce we can use CSS property <code>top</code> and <code>position:absolute</code> for the ball inside the field with <code>position:relative</code>.</p>
<p>The bottom coordinate of the field is <code>field.clientHeight</code>. But the <code>top</code> property gives coordinates for the top of the ball, the edge position is <code>field.clientHeight - ball.clientHeight</code>.</p>
<p>So we animate the <code>top</code> from <code>0</code> to <code>field.clientHeight - ball.clientHeight</code>.</p>
<p>Now to get the “bouncing” effect we can use the timing function <code>bounce</code> in <code>easeOut</code> mode.</p>
<p>Here's the final code for the animation:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let to = field.clientHeight - ball.clientHeight;

animate({
  duration: 2000,
  timing: makeEaseOut(bounce),
  draw(progress) {
    ball.style.top = to * progress + 'px'
  }
});</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/KY5XWCmFb6Jc8HjGt1zh?p=preview" target="_blank" data-plunk-id="KY5XWCmFb6Jc8HjGt1zh">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#animate-the-ball-bouncing-to-the-left" name="animate-the-ball-bouncing-to-the-left" class="main__anchor">Animate the ball bouncing to the left</a></h3>
<a href="http://javascript.info/task/animate-ball-hops" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Make the ball bounce to the left. Like this:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://en.js.cx/task/animate-ball-hops/solution/"></iframe>
  </div><p>Write the animation code. The distance to the right is <code>100px</code>.</p>
<p>Take the solution of the previous task 
<a href="http://javascript.info/task/animate-ball">Animate the bouncing ball</a> as the source.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>In the task 
<a href="http://javascript.info/task/animate-ball">Animate the bouncing ball</a> we had only one property to animate. Now we need one more: <code>elem.style.left</code>.</p>
<p>The horizontal coordinate changes by another law: it does not “bounce”, but gradually increases shifting the ball to the right.</p>
<p>We can write one more <code>animate</code> for it.</p>
<p>As the time function we could use <code>linear</code>, but something like <code>makeEaseOut(quad)</code> looks much better.</p>
<p>The code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let height = field.clientHeight - ball.clientHeight;
let width = 100;

// animate top (bouncing)
animate({
  duration: 2000,
  timing: makeEaseOut(bounce),
  draw: function(progress) {
    ball.style.top = height * progress + 'px'
  }
});

// animate left (moving to the right)
animate({
  duration: 2000,
  timing: makeEaseOut(quad),
  draw: function(progress) {
    ball.style.left = width * progress + "px"
  }
});</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/7JpscYeZeC4mqigLPbx5?p=preview" target="_blank" data-plunk-id="7JpscYeZeC4mqigLPbx5">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/popup-windows" class="lessons-list__link">Popups and window methods</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/cross-window-communication" class="lessons-list__link">Cross-window communication</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/clickjacking" class="lessons-list__link">The clickjacking attack</a></li></ol></div>

<h6 id="chapter-827"></h6>
<h1 class="main__header-title" id="chapter-828">Popups and window methods</h1>
<p>A popup window is one of the oldest methods to show additional document to user.</p>
<p>Basically, you just run:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.open('http://javascript.info/')</code></pre>
        </div>
      </div>
      
      </div><p>… And it will open a new window with given URL. Most modern browsers are configured to open new tabs instead of separate windows.</p>


<h2 id="chapter-829">
Popup blocking</h2>
<p>Popups exist from really ancient times. The initial idea was to show another content without closing the main window. As of now, there are other ways to do that: JavaScript is able to send requests for server, so popups are rarely used. But sometimes they are still handy.</p>
<p>In the past evil sites abused popups a lot. A bad page could open tons of popup windows with ads. So now most browsers try to block popups and protect the user.</p>
<p><strong>Most browsers block popups if they are called outside of user-triggered event handlers like <code>onclick</code>.</strong></p>
<p>If you think about it, that's a bit tricky. If the code is directly in an <code>onclick</code> handler, then that's easy. But what is the popup opens in <code>setTimeout</code>?</p>
<p>Try this code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// open after 3 seconds
setTimeout(() =&gt; window.open('http://google.com'), 3000);</code></pre>
        </div>
      </div>
      
      </div><p>The popup opens in Chrome, but gets blocked in Firefox.</p>
<p>…And this works in Firefox too:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// open after 1 seconds
setTimeout(() =&gt; window.open('http://google.com'), 1000);</code></pre>
        </div>
      </div>
      
      </div><p>The difference is that Firefox treats a timeout of 2000ms or less are acceptable, but after it – removes the “trust”, assuming that now it's “outside of the user action”. So the first one is blocked, and the second one is not.</p>
<h2 id="chapter-830">
Modern usage</h2>
<p>As of now, we have many methods to load and show data on-page with JavaScript. But there are still situations when a popup works best.</p>
<p>For instance, many shops use online chats for consulting people. A visitor clicks on the button, it runs <code>window.open</code> and opens the popup with the chat.</p>
<p>Why a popup is good here, why not in-page?</p>
<ol>
<li>A popup is a separate window with its own independent JavaScript environment. So a chat service doesn't need to integrate with scripts of the main shop site.</li>
<li>A popup is very simple to attach to a site, little to no overhead. It's only a small button, without additional scripts.</li>
<li>A popup may persist even if the user left the page. For example, a consult advices the user to visit the page of a new “Super-Cooler” goodie. The user goes there in the main window without leaving the chat.</li>
</ol>
<h2 id="chapter-831">
window.open</h2>
<p>The syntax to open a popup is: <code>window.open(url, name, params)</code>:</p>
<dl>
<dt>url</dt>
<dd>An URL to load into the new window.</dd>
<dt>name</dt>
<dd>A name of the new window. Each window has a <code>window.name</code>, and here we can specify which window to use for the popup. If there's already a window with such name – the given URL opens in it, otherwise a new window is opened.</dd>
<dt>params</dt>
<dd>The configuration string for the new window. It contains settings, delimited by a comma. There must be no spaces in params, for instance: <code>width:200,height=100</code>.</dd>
</dl>
<p>Settings for <code>params</code>:</p>
<ul>
<li>Position:
<ul>
<li><code>left/top</code> (numeric) – coordinates of the window top-left corner on the screen. There is a limitation: a new window cannot be positioned offscreen.</li>
<li><code>width/height</code> (numeric) – width and height of a new window. There is a limit on minimal width/height, so it's impossible to create an invisible window.</li>
</ul>
</li>
<li>Window features:
<ul>
<li><code>menubar</code> (yes/no) – shows or hides the browser menu on the new window.</li>
<li><code>toolbar</code> (yes/no) – shows or hides the browser navigation bar (back, forward, reload etc) on the new window.</li>
<li><code>location</code> (yes/no) – shows or hides the URL field in the new window. FF and IE don't allow to hide it by default.</li>
<li><code>status</code> (yes/no) – shows or hides the status bar. Again, most browsers force it to show.</li>
<li><code>resizable</code> (yes/no) – allows to disable the resize for the new window. Not recommended.</li>
<li><code>scrollbars</code> (yes/no) – allows to disable the scrollbars for the new window. Not recommended.</li>
</ul>
</li>
</ul>
<p>There is also a number of less supported browser-specific features, which are usually not used. Check 
<a href="https://developer.mozilla.org/en/DOM/window.open">window.open in MDN</a> for examples.</p>
<h2 id="chapter-832">
Example: a minimalistic window</h2>
<p>Let's open a window with minimal set of features just to see which of them browser allows to disable:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let params = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,
width=0,height=0,left=-1000,top=-1000`;

open('/', 'test', params);</code></pre>
        </div>
      </div>
      
      </div><p>Here most “window features” are disabled and window is positioned offscreen. Run it and see what really happens. Most browsers “fix” odd things like zero <code>width/height</code> and offscreen <code>left/top</code>. For instance, Chrome open such a window with full width/height, so that it occupies the full screen.</p>
<p>Let's add normal positioning options and reasonable <code>width</code>, <code>height</code>, <code>left</code>, <code>top</code> coordinates:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let params = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,
width=600,height=300,left=100,top=100`;

open('/', 'test', params);</code></pre>
        </div>
      </div>
      
      </div><p>Most browsers show the example above as required.</p>
<p>Rules for omitted settings:</p>
<ul>
<li>If there is no 3rd argument in the <code>open</code> call, or it is empty, then the default window parameters are used.</li>
<li>If there is a string of params, but some yes/no features are omitted, then the omitted features are disabled, if the browser allows that. So if you specify params, make sure you explicitly set all required features to yes.</li>
<li>If there is no <code>left/top</code> in params, then the browser tries to open a new window near the last opened window.</li>
<li>If there is no <code>width/height</code>, then the new window will be the same size as the last opened.</li>
</ul>
<h2 id="chapter-833">
Accessing a popup</h2>
<p>The <code>open</code> call returns a reference to the new window. It can be used to manipulate it's properties, change location and even more.</p>
<p>In the example below, the contents of the new window is modified after loading.</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let newWindow = open('/', 'example', 'width=300,height=300')
newWindow.focus();

newWindow.onload = function() {
  let html = `&lt;div style="font-size:30px"&gt;Welcome!&lt;/div&gt;`;
  newWindow.document.body.insertAdjacentHTML('afterbegin', html);
};</code></pre>
        </div>
      </div>
      
      </div><p>Please note that external <code>document</code> content is only accessible for windows from the same origin (the same protocol://domain:port).</p>
<p>For windows with URLs from another sites, we are able to change the location by assigning <code>newWindow.location=...</code>, but we can't read the location or access the content. That's for user safety, so that an evil page can't open a popup with <code>http://gmail.com</code> and read the data. We'll talk more about it later.</p>
<h2 id="chapter-834">
Accessing the opener window</h2>
<p>A popup may access the “opener” window as well. A JavaScript in it may use <code>window.opener</code> to access the window that opened it. It is <code>null</code> for all windows except popups.</p>
<p>So both the main window and the popup have a reference to each other. They may modify each other freely assuming that they come from the same origin. If that's not so, then there are still means to communicate, to be covered in the next chapter 
<a href="http://javascript.info/cross-window-communication">Cross-window communication</a>.</p>
<h2 id="chapter-835">
Closing a popup</h2>
<p>If we don't need a popup any more, we can call <code>newWindow.close()</code> on it.</p>
<p>Technically, the <code>close()</code> method is available for any <code>window</code>, but <code>window.close()</code> is ignored by most browsers if <code>window</code> is not created with <code>window.open()</code>.</p>
<p>The <code>newWindow.closed</code> is <code>true</code> if the window is closed. That's useful to check if the popup (or the main window) is still open or not. A user could close it, and our code should take that possibility into account.</p>
<p>This code loads and then closes the window:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let newWindow = open('/', 'example', 'width=300,height=300')
newWindow.onload = function() {
  newWindow.close();
  alert(newWindow.closed); // true
};</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-836">
Focus/blur on a popup</h2>
<p>Theoretically, there are <code>window.focus()</code> and <code>window.blur()</code> methods to focus/unfocus on a window.  Also there are <code>focus/blur</code> events that allow to focus a window and catch the moment when the visitor switches elsewhere.</p>
<p>In the past evil pages abused those. For instance, look at this code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.onblur = () =&gt; window.focus();</code></pre>
        </div>
      </div>
      
      </div><p>When a user attempts to switch out of the window (<code>blur</code>), it brings it back to focus. The intention is to “lock” the user within the <code>window</code>.</p>
<p>So, there are limitations that forbid the code like that. There are many limitations to protect the user from ads and evils pages. They depend on the browser.</p>
<p>For instance, a mobile browser usually ignores that call completely. Also focusing doesn't work when a popup opens in a separate tab rather than a new window.</p>
<p>Still, there are some things that can be done.</p>
<p>For instance:</p>
<ul>
<li>When we open a popup, it's might be a good idea to run a <code>newWindow.focus()</code> on it. Just in case, for some OS/browser combinations it ensures that the user is in the new window now.</li>
<li>If we want to track when a visitor actually uses our web-app, we can track <code>window.onfocus/onblur</code>. That allows us to suspend/resume in-page activities, animations etc. But please note that the <code>blur</code> event means that the visitor switched out from the window, but he still may observe it. The window is in the background, but still may be visible.</li>
</ul>
<h2 id="chapter-837">
Summary</h2>
<ul>
<li>A popup can be opened by the <code>open(url, name, params)</code> call. It returns the reference to the newly opened window.</li>
<li>By default, browsers block <code>open</code> calls from the code outside of user actions. Usually a notification appears, so that a user may allow them.</li>
<li>The popup may access the opener window using the <code>window.opener</code> property, so the two are connected.</li>
<li>If the main window and the popup come from the same origin, they can freely read and modify each other. Otherwise, they can change location of each other and communicate using messages (to be covered).</li>
<li>To close the popup: use <code>close()</code> call. Also the user may close them (just like any other windows). The <code>window.closed</code> is <code>true</code> after that.</li>
<li>Methods <code>focus()</code> and <code>blur()</code> allow to focus/unfocus a window. Sometimes.</li>
<li>Events <code>focus</code> and <code>blur</code> allow to track switching in and out of the window. But please note that a  window may still be visible even in the background state, after <code>blur</code>.</li>
</ul>
<p>Also if we open a popup, a good practice is to notify the user about it. An icon with the opening window can help the visitor to survive the focus shift and keep both windows in mind.</p>
<h6 id="chapter-838"></h6>
<h1 class="main__header-title" id="chapter-839">Cross-window communication</h1>
<p>The “Same Origin” (same site) policy limits access of windows and frame to each other.</p>
<p>The idea is that if we have two windows open: one from <code>john-smith.com</code>, and another one is <code>gmail.com</code>, then we wouldn't want a script from <code>john-smith.com</code> to read our mail.</p>


<h2 id="chapter-840">
Same Origin</h2>
<p>Two URLs are said to have the “same origin” if they have the same protocol, domain and port.</p>
<p>These URLs all share the same origin:</p>
<ul>
<li><code>http://site.com</code></li>
<li><code>http://site.com/</code></li>
<li><code>http://site.com/my/page.html</code></li>
</ul>
<p>These ones do not:</p>
<ul>
<li><code>http://<b>www.</b>site.com</code> (another domain: <code>www.</code> matters)</li>
<li><code>http://<b>site.org</b></code> (another domain: <code>.org</code> matters)</li>
<li><code><b>https://</b>site.com</code> (another protocol: <code>https</code>)</li>
<li><code>http://site.com:<b>8080</b></code> (another port: <code>8080</code>)</li>
</ul>
<p>If we have a reference to another window (a popup or iframe), and that window comes from the same origin, then we can do everything with it.</p>
<p>If it comes from another origin, then we can only change its location. Please note: not <em>read</em> the location, but <em>modify</em> it, redirect it to another place. That's safe, because the URL may contain sensitive parameters, so reading it from another origin is prohibited, but changing is not.</p>
<p>Also such windows may exchange messages. Soon about that later.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Exclusion: subdomains may be same-origin</span></div>
            <div class="important__content"><p>There's an important exclusion in the same-origin policy.</p>
<p>If windows share the same second-level domain, for instance <code>john.site.com</code>, <code>peter.site.com</code> and <code>site.com</code>, we can use JavaScript to assign to <code>document.domain</code> their common second-level domain <code>site.com</code>. Then these windows are treated as having the same origin.</p>
<p>In other words, all such documents (including the one from <code>site.com</code>) should have the code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.domain = 'site.com';</code></pre>
        </div>
      </div>
      
      </div><p>Then they can interact without limitations.</p>
<p>That's only possible for pages with the same second-level domain.</p>
</div></div>
<h2 id="chapter-841">
Accessing an iframe contents</h2>
<p>An <code>&lt;iframe&gt;</code> is a two-faced beast. From one side it's a tag, just like <code>&lt;script&gt;</code> or <code>&lt;img&gt;</code>. From the other side it's a window-in-window.</p>
<p>The embedded window has a separate <code>document</code> and <code>window</code> objects.</p>
<p>We can access them like using the properties:</p>
<ul>
<li><code>iframe.contentWindow</code> is a reference to the window inside the <code>&lt;iframe&gt;</code>.</li>
<li><code>iframe.contentDocument</code> is a reference to the document inside the <code>&lt;iframe&gt;</code>.</li>
</ul>
<p>When we access an embedded window, the browser checks if the iframe has the same origin. If that's not so then the access is denied (with exclusions noted above).</p>
<p>For instance, here's an <code>&lt;iframe&gt;</code> from another origin:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="https://example.com" id="iframe"&gt;&lt;/iframe&gt;

&lt;script&gt;
  iframe.onload = function() {
    // we can get the reference to the inner window
    let iframeWindow = iframe.contentWindow;

    try {
      // ...but not to the document inside it
      let doc = iframe.contentDocument;
    } catch(e) {
      alert(e); // Security Error (another origin)
    }

    // also we can't read the URL of the page in it
    try {
      alert(iframe.contentWindow.location);
    } catch(e) {
      alert(e); // Security Error
    }

    // ...but we can change it (and thus load something else into the iframe)!
    iframe.contentWindow.location = '/'; // works

    iframe.onload = null; // clear the handler, to run this code only once
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The code above shows errors for any operations except:</p>
<ul>
<li>Getting the reference to the inner window <code>iframe.contentWindow</code></li>
<li>Changing its <code>location</code>.</li>
</ul>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>iframe.onload</code> vs <code>iframe.contentWindow.onload</code></span></div>
            <div class="important__content"><p>The <code>iframe.onload</code> event is actually the same as <code>iframe.contentWindow.onload</code>. It triggers when the embedded window fully loads with all resources.</p>
<p>…But <code>iframe.onload</code> is always available, while <code>iframe.contentWindow.onload</code> needs the same origin.</p>
</div></div>
<p>And now an example with the same origin. We can do anything with the embedded window:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="/" id="iframe"&gt;&lt;/iframe&gt;

&lt;script&gt;
  iframe.onload = function() {
    // just do anything
    iframe.contentDocument.body.prepend("Hello, world!");
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h3>
Please wait until the iframe loads</a></h3><p>When an iframe is created, it immediately has a document. But that document is different from the one that finally loads into it!</p>
<p>Here, look:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="/" id="iframe"&gt;&lt;/iframe&gt;

&lt;script&gt;
  let oldDoc = iframe.contentDocument;
  iframe.onload = function() {
    let newDoc = iframe.contentDocument;
    // the loaded document is not the same as initial!
    alert(oldDoc == newDoc); // false
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>That's actually a well-known pitfall for novice developers. We shouldn't work with the document immediately, because that's the <em>wrong document</em>. If we set any event handlers on it, they will be ignored.</p>
<p>…But the <code>onload</code> event triggers when the whole iframe with all resources is loaded. What if we want to act sooner, on <code>DOMContentLoaded</code> of the embedded document?</p>
<p>That's not possible if the iframe comes from another origin. But for the same origin we can try to catch the moment when a new document appears, and then setup necessary handlers, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="/" id="iframe"&gt;&lt;/iframe&gt;

&lt;script&gt;
  let oldDoc = iframe.contentDocument;

  // every 100 ms check if the document is the new one
  let timer = setInterval(() =&gt; {
    if (iframe.contentDocument == oldDoc) return;

    // new document, let's set handlers
    iframe.contentDocument.addEventListener('DOMContentLoaded', () =&gt; {
      iframe.contentDocument.body.prepend('Hello, world!');
    });

    clearInterval(timer); // cancel setInterval, don't need it any more
  }, 100);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Let me know in comments if you know a better solution here.</p>
<h2 id="chapter-842">
window.frames</h2>
<p>An alternative way to get a window object for <code>&lt;iframe&gt;</code> – is to get it from the named collection  <code>window.frames</code>:</p>
<ul>
<li>By number: <code>window.frames[0]</code> – the window object for the first frame in the document.</li>
<li>By name: <code>window.frames.iframeName</code> – the window object for the frame with  <code>name="iframeName"</code>.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="/" style="height:80px" name="win" id="iframe"&gt;&lt;/iframe&gt;

&lt;script&gt;
  alert(iframe.contentWindow == frames[0]); // true
  alert(iframe.contentWindow == frames.win); // true
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>An iframe may have other iframes inside. The corresponding <code>window</code> objects form a hierarchy.</p>
<p>Navigation links are:</p>
<ul>
<li><code>window.frames</code> – the collection of “children” windows (for nested frames).</li>
<li><code>window.parent</code> – the reference to the “parent” (outer) window.</li>
<li><code>window.top</code> – the reference to the topmost parent window.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.frames[0].parent === window; // true</code></pre>
        </div>
      </div>
      
      </div><p>We can use the <code>top</code> property to check if the current document is open inside a frame or not:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (window == top) { // current window == window.top?
  alert('The script is in the topmost window, not in a frame');
} else {
  alert('The script runs in a frame!');
}</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-843">
The sandbox attribute</h2>
<p>The <code>sandbox</code> attribute allows to forbid certain actions inside an <code>&lt;iframe&gt;</code>, to run an untrusted code. It “sandboxes” the iframe by treating it as coming from another origin and/or applying other limitations.</p>
<p>By default, for <code>&lt;iframe sandbox src="..."&gt;</code> the “default set” of restrictions is applied to the iframe. But we can provide a space-separated list of “excluded” limitations as a value of the attribute, like this: <code>&lt;iframe sandbox="allow-forms allow-popups"&gt;</code>. The listed limitations are not applied.</p>
<p>In other words, an empty <code>"sandbox"</code> attribute puts the strictest limitations possible, but we can put a space-delimited list of those that we want to lift.</p>
<p>Here's a list of limitations:</p>
<dl>
<dt><code>allow-same-origin</code></dt>
<dd>By default <code>"sandbox"</code> forces the “different origin” policy for the iframe. In other words, it makes the browser to treat the <code>iframe</code> as coming from another origin, even if its <code>src</code> points to the same site. With all implied restrictions for scripts. This option removes that feature.</dd>
<dt><code>allow-top-navigation</code></dt>
<dd>Allows the <code>iframe</code> to change <code>parent.location</code>.</dd>
<dt><code>allow-forms</code></dt>
<dd>Allows to submit forms from <code>iframe</code>.</dd>
<dt><code>allow-scripts</code></dt>
<dd>Allows to run scripts from the <code>iframe</code>.</dd>
<dt><code>allow-popups</code></dt>
<dd>Allows to <code>window.open</code> popups from the <code>iframe</code></dd>
</dl>
<p>See 
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe">the manual</a> for more.</p>
<p>The example below demonstrates a sandboxed iframe with the default set of restrictions: <code>&lt;iframe sandbox src="..."&gt;</code>. It has some JavaScript and a form.</p>
<p>Please note that nothing works. So the default set is really harsh:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">index.html</div><div class="code-tabs__switch">sandboxed.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/cross-window-communication/sandbox/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/XIJudeLJohgI4MGWgiV1?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:140px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/cross-window-communication/sandbox/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;div&gt;The iframe below is has &lt;code&gt;sandbox&lt;/code&gt; attribute.&lt;/div&gt;

  &lt;iframe sandbox src="sandboxed.html" style="height:60px;width:90%"&gt;&lt;/iframe&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;button onclick="alert(123)"&gt;Click to run a script (doesn't work)&lt;/button&gt;

  &lt;form action="http://google.com"&gt;
    &lt;input type="text"&gt;
    &lt;input type="submit" value="Submit (doesn't work)"&gt;
  &lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Please note:</span></div>
            <div class="important__content"><p>The purpose of the <code>"sandbox"</code> attribute is only to <em>add more</em> restrictions. It cannot remove them. In particular, it can't relax same-origin restrictions if the iframe comes from another origin.</p>
</div></div>
<h2 id="chapter-844">
Cross-window messaging</h2>
<p>The <code>postMessage</code> interface allows windows to talk to each other no matter which origin they are from.</p>
<p>It has two parts.</p>
<h3>
postMessage</a></h3><p>The window that wants to send a message calls 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage">postMessage</a> method of the receiving window. In other words, if we want to send the message to <code>win</code>, we should call  <code>win.postMessage(data, targetOrigin)</code>.</p>
<p>Arguments:</p>
<dl>
<dt><code>data</code></dt>
<dd>The data to send. Can be any object, the data is cloned using the “structured cloning algorithm”. IE supports only strings, so we should <code>JSON.stringify</code> complex objects to support that browser.</dd>
<dt><code>targetOrigin</code></dt>
<dd>Specifies the origin for the target window, so that only a window from the given origin will get the message.</dd>
</dl>
<p>The <code>targetOrigin</code> is a safety measure. Remember, if the target window comes from another origin, we can't read it's <code>location</code>. So we can't be sure which site is open in the intended window right now: the user could navigate away.</p>
<p>Specifying <code>targetOrigin</code> ensures that the window only receives the data if it's still at that site. Good when the data is sensitive.</p>
<p>For instance, here <code>win</code> will only receive the message if it has a document from the origin <code>http://example.com</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="http://example.com" name="example"&gt;

&lt;script&gt;
  let win = window.frames.example;

  win.postMessage("message", "http://example.com");
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>If we don't want that check, we can set <code>targetOrigin</code> to <code>*</code>.</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="http://example.com" name="example"&gt;

&lt;script&gt;
  let win = window.frames.example;

  win.postMessage("message", "*");
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h3>
onmessage</a></h3><p>To receive a message, the target window should have a handler on the <code>message</code> event. It triggers when <code>postMessage</code> is called (and <code>targetOrigin</code> check is successful).</p>
<p>The event object has special properties:</p>
<dl>
<dt><code>data</code></dt>
<dd>The data from <code>postMessage</code>.</dd>
<dt><code>origin</code></dt>
<dd>The origin of the sender, for instance <code>http://javascript.info</code>.</dd>
<dt><code>source</code></dt>
<dd>The reference to the sender window. We can immediately <code>postMessage</code> back if we want.</dd>
</dl>
<p>To assign that handler, we should use <code>addEventListener</code>, a short syntax <code>window.onmessage</code> does not work.</p>
<p>Here's an example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.addEventListener("message", function(event) {
  if (event.origin != 'http://javascript.info') {
    // something from an unknown domain, let's ignore it
    return;
  }

  alert( "received: " + event.data );
});</code></pre>
        </div>
      </div>
      
      </div><p>The full example:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">index.html</div><div class="code-tabs__switch">iframe.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/cross-window-communication/postmessage/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/Xwr9pji8O1EazbKu0HEL?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:120px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/cross-window-communication/postmessage/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;form id="form"&gt;
    &lt;input type="text" placeholder="Enter message" name="message"&gt;
    &lt;input type="submit" value="Click to send"&gt;
  &lt;/form&gt;

  &lt;iframe src="iframe.html" id="iframe" style="display:block;height:60px"&gt;&lt;/iframe&gt;

  &lt;script&gt;
    form.onsubmit = function() {
      iframe.contentWindow.postMessage(this.message.value, '*');
      return false;
    };
  &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;

&lt;body&gt;

  Receiving iframe.
  &lt;script&gt;
    window.addEventListener('message', function(event) {
      alert(`Received ${event.data} from ${event.origin}`);
    });
  &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><div class="important important_smart">
            <div class="important__header"><span class="important__type">There's no delay</span></div>
            <div class="important__content"><p>There's totally no delay between <code>postMessage</code> and the <code>message</code> event. That happens synchronously, even faster than <code>setTimeout(...,0)</code>.</p>
</div></div>
<h2 id="chapter-845">
Summary</h2>
<p>To call methods and access the content of another window, we should first have a reference to it.</p>
<p>For popups we have two properties:</p>
<ul>
<li><code>window.open</code> – opens a new window and returns a reference to it,</li>
<li><code>window.opener</code> – a reference to the opener window from a popup</li>
</ul>
<p>For iframes, we can access parent/children windows using:</p>
<ul>
<li><code>window.frames</code> – a collection of nested window objects,</li>
<li><code>window.parent</code>, <code>window.top</code> are the references to parent and top windows,</li>
<li><code>iframe.contentWindow</code> is the window inside an <code>&lt;iframe&gt;</code> tag.</li>
</ul>
<p>If windows share the same origin (host, port, protocol), then windows can do whatever they want with each other.</p>
<p>Otherwise, only possible actions are:</p>
<ul>
<li>Change the location of another window (write-only access).</li>
<li>Post a message to it.</li>
</ul>
<p>Exclusions are:</p>
<ul>
<li>Windows that share the same second-level domain: <code>a.site.com</code> and <code>b.site.com</code>. Then setting <code>document.domain='site.com'</code> in both of them puts them into the “same origin” state.</li>
<li>If an iframe has a <code>sandbox</code> attribute, it is forcefully put into the “different origin” state, unless the <code>allow-same-origin</code> is specified in the attribute value. That can be used to run untrusted code in iframes from the same site.</li>
</ul>
<p>The <code>postMessage</code> interface allows two windows to talk with security checks:</p>
<ol>
<li>
<p>The sender calls <code>targetWin.postMessage(data, targetOrigin)</code>.</p>
</li>
<li>
<p>If <code>targetOrigin</code> is not <code>'*'</code>, then the browser checks if window <code>targetWin</code> has the URL from  <code>targetWin</code> site.</p>
</li>
<li>
<p>If it is so, then <code>targetWin</code> triggers the <code>message</code> event with special properties:</p>
<ul>
<li><code>origin</code> – the origin of the sender window (like <code>http://my.site.com</code>)</li>
<li><code>source</code> – the reference to the sender window.</li>
<li><code>data</code> – the data, any object in everywhere except IE that supports only strings.</li>
</ul>
<p>We should use <code>addEventListener</code> to set the handler for this event inside the target window.</p>
</li>
</ol>
<h6 id="chapter-846"></h6>
<h1 class="main__header-title" id="chapter-847">The clickjacking attack</h1>
<p>The “clickjacking” attack allows an evil page to click on a “victim site” <em>on behalf of the visitor</em>.</p>
<p>Many sites were hacked this way, including Twitter, Facebook, Paypal and other sites. They are all fixed, of course.</p>


<h2 id="chapter-848">
The idea</h2>
<p>The idea is very simple.</p>
<p>Here's how clickjacking was done with Facebook:</p>
<ol>
<li>A visitor is lured to the evil page. No matter how.</li>
<li>The page has a harmlessly-looking link on it (like “get rich now” or “click here, very funny” and so on).</li>
<li>Over that link the evil page positions a transparent <code>&lt;iframe&gt;</code> with <code>src</code> from facebook.com, in such a way that the “Like” button is right above that link. Usually that's done with <code>z-index</code>.</li>
<li>Clicking on that link, the visitor in fact presses that button.</li>
</ol>
<h2 id="chapter-849">
The demo</h2>
<p>Here's how the evil page looks like. To make things clear, the <code>&lt;iframe&gt;</code> is half-transparent (in real evil pages it's fully transparent):</p>
<div data-trusted="1" class="code-example" data-demo-height="120" data-highlight-block="6-6,14-16">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
iframe { /* iframe from the victim site */
  width: 400px;
  height: 100px;
  position: absolute;
  top:0; left:-20px;
  opacity: 0.5; /* in real opacity:0 */
  z-index: 1;
}
&lt;/style&gt;

&lt;div&gt;Click to get rich now:&lt;/div&gt;

&lt;!-- The url from the victim site --&gt;
&lt;iframe src="/clickjacking/facebook.html"&gt;&lt;/iframe&gt;

&lt;button&gt;Click here!&lt;/button&gt;

&lt;div&gt;...And you're cool (I'm a cool hacker actually)!&lt;/div&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The full demo of the attack:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">facebook.html</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/clickjacking/clickjacking-visible/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/xAVfbdDQyLdamz14rl3a?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:160px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/clickjacking/clickjacking-visible/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;body style="margin:10px;padding:10px"&gt;

  &lt;input type="button" onclick="alert('Like pressed on facebook.html!')" value="I LIKE IT !"&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;style&gt;
    iframe {
      width: 400px;
      height: 100px;
      position: absolute;
      top: 5px;
      left: -14px;
      opacity: 0.5;
      z-index: 1;
    }
  &lt;/style&gt;

  &lt;div&gt;Click to get rich now:&lt;/div&gt;

  &lt;!-- The url from the victim site --&gt;
  &lt;iframe src="facebook.html"&gt;&lt;/iframe&gt;

  &lt;button&gt;Click here!&lt;/button&gt;

  &lt;div&gt;...And you're cool (I'm a cool hacker actually)!&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p>Here we have a half-transparent <code>&lt;iframe src="facebook.html"&gt;</code>, and in the example we can see it hovering over the button. A click on the button actually clicks on the iframe, but that's not visible to the user, because the iframe is transparent.</p>
<p>As a result if the visitor is authorized on facebook (“remember me” is usually turned on), then it adds a “Like”. On Twitter that would be a “Follow” button.</p>
<p>Here's the same example, but closer to reality, with <code>opacity:0</code> for <code>&lt;iframe&gt;</code>:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">facebook.html</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/clickjacking/clickjacking/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/GoL8ogCqZmnfZjGSEQUe?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:160px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/clickjacking/clickjacking/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;body style="margin:10px;padding:10px"&gt;

  &lt;input type="button" onclick="alert('Like pressed on facebook.html!')" value="I LIKE IT !"&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;style&gt;
    iframe {
      width: 400px;
      height: 100px;
      position: absolute;
      top: 5px;
      left: -14px;
      opacity: 0;
      z-index: 1;
    }
  &lt;/style&gt;

  &lt;div&gt;Click to get rich now:&lt;/div&gt;

  &lt;!-- The url from the victim site --&gt;
  &lt;iframe src="facebook.html"&gt;&lt;/iframe&gt;

  &lt;button&gt;Click here!&lt;/button&gt;

  &lt;div&gt;...And you're cool (I'm a cool hacker actually)!&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p>All we need to attack – is to position the <code>&lt;iframe&gt;</code> on the evil page in such a way that the button is right over the link. That's usually possible with CSS.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Clickjacking is for clicks, not for keyboard</span></div>
            <div class="important__content"><p>The attack only affects mouse actions.</p>
<p>Technically, if we have a text field to hack, then we can position an iframe in such a way that text fields overlap each other. So when a visitor tries to focus on the input he sees on the page, he actually focuses on the input inside the iframe.</p>
<p>But then there's a problem. Everything that the visitor types will be hidden, because the iframe is not visible.</p>
<p>So that would look really odd to the user, and he will stop.</p>
</div></div>
<h2 id="chapter-850">
Old-school defences (weak)</h2>
<p>The oldest defence method is the piece of JavaScript that forbids to open the page in a frame (so-called “framebusting”).</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (top != window) {
  top.location = window.location;
}</code></pre>
        </div>
      </div>
      
      </div><p>That is: if the window finds out that it's not on the top, then it automatically makes itself the top.</p>
<p>As of now, that's not reliable, because there are many ways to hack around it. Let's cover a few.</p>
<h3>
Blocking top-navigation</a></h3><p>We can block the transition caused by changing <code>top.location</code> in the 
<a href="http://javascript.info/onload-ondomcontentloaded#window.onbeforeunload">beforeunload</a> event.</p>
<p>The top page (that belongs to the hacker) sets a handler to it, and when the <code>iframe</code> tries to change <code>top.location</code> the visitor gets a message asking him whether he wants to leave.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.onbeforeunload = function() {
  window.onbeforeunload = null;
  return "Want to leave without learning all the secrets (he-he)?";
};</code></pre>
        </div>
      </div>
      
      </div><p>In most cases the visitor would answer negatively, because he doesn't know about the iframe, all he can see is the top page, there's no reason to leave. And so the <code>top.location</code> won't change!</p>
<p>In action:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">iframe.html</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/clickjacking/top-location/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/9lscqFXg22sQoNcg12nB?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/clickjacking/top-location/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;div&gt;Changes top.location to javascript.info&lt;/div&gt;

  &lt;script&gt;
    top.location = 'https://javascript.info';
  &lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;

  &lt;style&gt;
    iframe {
      width: 400px;
      height: 100px;
      position: absolute;
      top: 0;
      left: -20px;
      opacity: 0;
      z-index: 1;
    }
  &lt;/style&gt;

  &lt;script&gt;
    function attack() {

      window.onbeforeunload = function() {
        window.onbeforeunload = null;
        return "Want to leave without learning all the secrets (he-he)?";
      };

      document.body.insertAdjacentHTML('beforeend', '&lt;iframe src="iframe.html"&gt;');
    }
  &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;p&gt;After a click on the button the visitor gets a "strange" question about whether he wants to leave.&lt;/p&gt;

  &lt;p&gt;Probably he would respond "No", and the iframe protection is hacked.&lt;/p&gt;

  &lt;button onclick="attack()"&gt;Add a "protected" iframe&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><h3>
Sandbox attribute</a></h3><p>One of the things restricted by the <code>sandbox</code> attribute is navigation. A sandboxed iframe may not change <code>top.location</code>.</p>
<p>So we can add the iframe with <code>sandbox="allow-scripts allow-forms"</code>. That would relax the restrictions allowing scripts and forms. But we don't put <code>allow-top-navigation</code> in the value so that the navigation is still forbidden. And the change of <code>top.location</code> won't work.</p>
<p>Here's the code:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:8-43">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe sandbox="allow-scripts allow-forms" src="facebook.html"&gt;&lt;/iframe&gt;</code></pre>
        </div>
      </div>
      
      </div><p>There are other ways to work around that simple protection too.</p>
<h2 id="chapter-851">
X-Frame-Options</h2>
<p>Server-side header <code>X-Frame-Options</code> can allow or forbid showing the page inside a frame.</p>
<p>It must be sent by the server: browser ignore it if found in <code>&lt;meta&gt;</code> tags. So <code>&lt;meta http-equiv="X-Frame-Options"...&gt;</code> won't do anything.</p>
<p>The header may have 3 values:</p>
<dl>
<dt><code>DENY</code></dt>
<dd>Never ever show the page inside an iframe.</dd>
<dt><code>SAMEORIGIN</code></dt>
<dd>Allow to show inside an iframe if the parent document comes from the same origin.</dd>
<dt><code>ALLOW-FROM domain</code></dt>
<dd>Allows to show inside an iframe if the parent document is from the given domain.</dd>
</dl>
<p>For instance, Twitter uses <code>X-Frame-Options: SAMEORIGIN</code>. Here's the result:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src="https://twitter.com"&gt;&lt;/iframe&gt;</code></pre>
        </div>
      </div>
      
      </div><iframe src="https://twitter.com"></iframe>
<p>Depending on the browser, <code>iframe</code> above is either empty or it has a message telling that “the browser can't show it”.</p>
<h2 id="chapter-852">
Showing with disabled functionality</h2>
<p>The protecting <code>X-Frame-Options</code> header has a side-effect. Other sites can't show our page in an <code>iframe</code>, even if they have “legal” reasons to do so.</p>
<p>So there are other solutions. For instance, we can “cover” the page with a <code>&lt;div&gt;</code> with <code>height:100%;width:100%</code>, so that it handles all clicks. That <code>&lt;div&gt;</code> should disappear if <code>window == top</code> or we figure out that we don't need protection.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  #protector {
    height: 100%;
    width: 100%;
    position: absolute;
    left: 0;
    top: 0;
    z-index: 99999999;
  }
&lt;/style&gt;

&lt;div id="protector"&gt;
  &lt;a href="/" target="_blank"&gt;Go to the site&lt;/a&gt;
&lt;/div&gt;

&lt;script&gt;
  // there will be an error if top window is from the different origin
  // but that's ok here
  if (top.document.domain == document.domain) {
    protector.remove();
  }
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The demo:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left="" class="code-tabs__scroll-button code-tabs__scroll-button_left"></button>
</div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches="" class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">iframe.html</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right="" class="code-tabs__scroll-button code-tabs__scroll-button_right"></button>
</div><div class="code-tabs__buttons"><a target="_blank" title="undefined: No translation for [markit.codeTabs.open_new_window]" href="http://javascript.info/article/clickjacking/protector/" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/bpxSCMy0UUyk3Arw9INo?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content="" style="height:200px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="http://javascript.info/article/clickjacking/protector/" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;

  &lt;style&gt;
    #protector {
      height: 100%;
      width: 100%;
      position: absolute;
      left: 0;
      top: 0;
      z-index: 99999999;
    }
  &lt;/style&gt;

&lt;/head&gt;

&lt;body&gt;

&lt;div id="protector"&gt;
  &lt;a href="/" target="_blank"&gt;Go to the site&lt;/a&gt;
&lt;/div&gt;

&lt;script&gt;

  if (top.document.domain == document.domain) {
    protector.remove();
  }

&lt;/script&gt;

  This text is always visible.

  But if the page was open inside a document from another domain, the div over it would prevent any actions.

  &lt;button onclick="alert(1)"&gt;Click wouldn't work in that case&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;iframe src="iframe.html"&gt;&lt;/iframe&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><h2 id="chapter-853">
Summary</h2>
<p>Clickjacking is a way to “trick” users into a clicking on a victim site without even knowing what happens. That's dangerous if there are important click-activated actions.</p>
<p>A hacker can post a link to his evil page in a message or lure visitors to his page by other means. There are many variants.</p>
<p>From one side – the attack is “not deep”: all a hacker can do is one click. But from another side, if the hacker knows that after the click another control appears, then it may use cunning messages to make the user to click on it as well.</p>
<p>The attack is quite dangerous, because when we engineer the UI we usually don't think that a hacker can click on behalf of the visitor. So vulnerabilities can be found in totally unexpected places.</p>
<ul>
<li>It's recommended to use <code>X-Frame-Options: SAMEORIGIN</code> on pages that are totally not meant to be shown inside iframes (or just for the whole site).</li>
<li>Use a covering <code>&lt;div&gt;</code> if we want to allow our pages to be shown in iframes, and still stay safe.</li>
</ul>
<p>Regular expressions is a powerful way of doing search and replace in strings.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-introduction" class="lessons-list__link">Patterns and flags</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-methods" class="lessons-list__link">Methods of RegExp and String</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-character-classes" class="lessons-list__link">Character classes</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-escaping" class="lessons-list__link">Escaping, special characters</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-character-sets-and-ranges" class="lessons-list__link">Sets and ranges [...]</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-unicode" class="lessons-list__link">The unicode flag</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-quantifiers" class="lessons-list__link">Quantifiers +, *, ? and {n}</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-greedy-and-lazy" class="lessons-list__link">Greedy and lazy quantifiers</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-groups" class="lessons-list__link">Capturing groups</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-backreferences" class="lessons-list__link">Backreferences: \n and $n</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-alternation" class="lessons-list__link">Alternation (OR) |</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-anchors" class="lessons-list__link">String start ^ and finish $</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-multiline-mode" class="lessons-list__link">Multiline mode, flag "m"</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-lookahead" class="lessons-list__link">Lookahead (in progress)</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/regexp-infinite-backtracking-problem" class="lessons-list__link">Infinite backtracking problem</a></li></ol></div>

<h6 id="chapter-854"></h6>
<h1 class="main__header-title" id="chapter-855">Patterns and flags</h1>
<p>Regular expressions is a powerful way of searching and replacing inside a string.</p>
<p>In JavaScript regular expressions are implemented using objects of a built-in <code>RegExp</code> class and integrated with strings.</p>
<p>Please note that regular expressions vary between programming languages. In this tutorial we concentrate on JavaScript. Of course there's a lot in common, but they are a somewhat different in Perl, Ruby, PHP etc.</p>


<h2 id="chapter-856">
Regular expressions</h2>
<p>A regular expression (also “regexp”, or just “reg”) consists of a <em>pattern</em> and optional <em>flags</em>.</p>
<p>There are two syntaxes to create a regular expression object.</p>
<p>The long syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">regexp = new RegExp("pattern", "flags");</code></pre>
        </div>
      </div>
      
      </div><p>…And the short one, using slashes <code>"/"</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">regexp = /pattern/; // no flags
regexp = /pattern/gmi; // with flags g,m and i (to be covered soon)</code></pre>
        </div>
      </div>
      
      </div><p>Slashes <code>"/"</code> tell JavaScript that we are creating a regular expression. They play the same role as quotes for strings.</p>
<h2 id="chapter-857">
Usage</h2>
<p>To search inside a string, we can use method 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/search">search</a>.</p>
<p>Here's an example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "I love JavaScript!"; // will search here

let regexp = /love/;
alert( str.search(regexp) ); // 2</code></pre>
        </div>
      </div>
      
      </div><p>The <code>str.search</code> method looks for the pattern <code class="pattern">/love/</code> and returns the position inside the string. As we might guess, <code class="pattern">/love/</code> is the simplest possible pattern. What it does is a simple substring search.</p>
<p>The code above is the same as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "I love JavaScript!"; // will search here

let substr = 'love';
alert( str.search(substr) ); // 2</code></pre>
        </div>
      </div>
      
      </div><p>So searching for <code class="pattern">/love/</code> is the same as searching for <code>"love"</code>.</p>
<p>But that's only for now. Soon we'll create more complex regular expressions with much searching more power.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Colors</span></div>
            <div class="important__content"><p>From here on the color scheme is:</p>
<ul>
<li>regexp – <code class="pattern">red</code></li>
<li>string (where we search) – <code class="subject">blue</code></li>
<li>result – <code class="match">green</code></li>
</ul>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">When to use <code>new RegExp</code>?</span></div>
            <div class="important__content"><p>Normally we use the short syntax <code>/.../</code>. But it does not allow any variables insertions, so we must know the exact regexp at the time of writing the code.</p>
<p>From the other hand, <code>new RegExp</code> allows to construct a pattern dynamically from a string.</p>
<p>So we can figure out what we need to search and create <code>new RegExp</code> from it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let search = prompt("What you want to search?", "love");
let regexp = new RegExp(search);

// find whatever the user wants
alert( "I love JavaScript".search(regexp));</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-858">
Flags</h2>
<p>Regular expressions may have flags that affect the search.</p>
<p>There are only 5 of them in JavaScript:</p>
<dl>
<dt><code>i</code></dt>
<dd>With this flag the search is case-insensitive: no difference between <code>A</code> and <code>a</code> (see the example below).</dd>
<dt><code>g</code></dt>
<dd>With this flag the search looks for all matches, without it – only the first one (we'll see uses in the next chapter).</dd>
<dt><code>m</code></dt>
<dd>Multiline mode (covered in the chapter <span class="markdown-error">Article "regexp-multiline" not found</span>).</dd>
<dt><code>u</code></dt>
<dd>Enables full unicode support. The flag enables correct processing of surrogate pairs. More about that in the chapter 
<a href="http://javascript.info/regexp-unicode">The unicode flag</a>.</dd>
<dt><code>y</code></dt>
<dd>Sticky mode (covered in the 
<a href="http://javascript.info/regexp-methods#y-flag">next chapter</a>)</dd>
</dl>
<h2 id="chapter-859">
The “i” flag</h2>
<p>The simplest flag is <code>i</code>.</p>
<p>An example with it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "I love JavaScript!";

alert( str.search(/LOVE/) ); // -1 (not found)
alert( str.search(/LOVE/i) ); // 2</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>The first search returns <code>-1</code> (not found), because the search is case-sensitive by default.</li>
<li>With the flag <code class="pattern">/LOVE/i</code> the search found <code class="match">love</code> at position 2.</li>
</ol>
<p>So the <code>i</code> flag already makes regular expressions more powerful than a simple substring search. But there's so much more. We'll cover other flags and features in the next chapters.</p>
<h2 id="chapter-860">
Summary</h2>
<ul>
<li>A regular expression consists of a pattern and optional flags: <code>g</code>, <code>i</code>, <code>m</code>, <code>u</code>, <code>y</code>.</li>
<li>Without flags and special symbols that we'll study later, the search by a regexp is the same as a  substring search.</li>
<li>The method <code>str.search(regexp)</code> returns the index where the match is found or <code>-1</code> if there's no match.</li>
</ul>
<h6 id="chapter-861"></h6>
<h1 class="main__header-title" id="chapter-862">Methods of RegExp and String</h1>
<p>There are two sets of methods to deal with regular expressions.</p>
<ol>
<li>First, regular expressions are objects of the built-in 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp">RegExp</a> class, it provides many methods.</li>
<li>Besides that, there are methods in regular strings can work with regexps.</li>
</ol>
<p>The structure is a bit messed up, so we'll first consider methods separately, and then – practical recipes for common tasks.</p>


<h2 id="chapter-863">
str.search(reg)</h2>
<p>We've seen this method already. It returns the position of the first match or <code>-1</code> if none found:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:19-23">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "A drop of ink may make a million think";

alert( str.search( /a/i ) ); // 0 (the first position)</code></pre>
        </div>
      </div>
      
      </div><p><strong>The important limitation: <code>search</code> always looks for the first match.</strong></p>
<p>We can't find next positions using <code>search</code>, there's just no syntax for that. But there are other methods that can.</p>
<h2 id="chapter-864">
str.match(reg), no “g” flag</h2>
<p>The method <code>str.match</code> behavior varies depending on the <code>g</code> flag. First let's see the case without it.</p>
<p>Then <code>str.match(reg)</code> looks for the first match only.</p>
<p>The result is an array with that match and additional properties:</p>
<ul>
<li><code>index</code> – the position of the match inside the string,</li>
<li><code>input</code> – the subject string.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:24-31">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Fame is the thirst of youth";

let result = str.match( /fame/i );

alert( result[0] );    // Fame (the match)
alert( result.index ); // 0 (at the zero position)
alert( result.input ); // "Fame is the thirst of youth" (the string)</code></pre>
        </div>
      </div>
      
      </div><p>The array may have more than one element.</p>
<p><strong>If a part of the pattern is delimited by parentheses <code>(...)</code>, then it becomes a separate element of the array.</strong></p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:24-39">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "JavaScript is a programming language";

let result = str.match( /JAVA(SCRIPT)/i );

alert( result[0] ); // JavaScript (the whole match)
alert( result[1] ); // script (the part of the match that corresponds to the parentheses)
alert( result.index ); // 0
alert( result.input ); // JavaScript is a programming language</code></pre>
        </div>
      </div>
      
      </div><p>Due to the <code>i</code> flag the search is case-insensitive, so it finds <code class="match">JavaScript</code>. The part of the match that corresponds to <code class="pattern">SCRIPT</code> becomes a separate array item.</p>
<p>We'll be back to parentheses later in the chapter 
<a href="http://javascript.info/regexp-groups">Capturing groups</a>. They are great for search-and-replace.</p>
<h2 id="chapter-865">
str.match(reg) with “g” flag</h2>
<p>When there's a <code>"g"</code> flag, then <code>str.match</code> returns an array of all matches. There are no additional properties in that array, and parentheses do not create any elements.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:24-30">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "HO-Ho-ho!";

let result = str.match( /ho/ig );

alert( result ); // HO, Ho, ho (all matches, case-insensitive)</code></pre>
        </div>
      </div>
      
      </div><p>With parentheses nothing changes, here we go:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:24-32">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "HO-Ho-ho!";

let result = str.match( /h(o)/ig );

alert( result ); // HO, Ho, ho</code></pre>
        </div>
      </div>
      
      </div><p>So, with <code>g</code> flag the <code>result</code> is a simple array of matches. No additional properties.</p>
<p>If we want to get information about match positions and use parentheses then we should use  
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec">RegExp#exec</a> method that we'll cover below.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">If there are no matches, the call to <code>match</code> returns <code>null</code></span></div>
            <div class="important__content"><p>Please note, that's important. If there were no matches, the result is not an empty array, but <code>null</code>.</p>
<p>Keep that in mind to evade pitfalls like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Hey-hey-hey!";

alert( str.match(/ho/gi).length ); // error! there's no length of null</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-866">
str.split(regexp|substr, limit)</h2>
<p>Splits the string using the regexp (or a substring) as a delimiter.</p>
<p>We already used <code>split</code> with strings, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('12-34-56'.split('-')) // [12, 34, 56]</code></pre>
        </div>
      </div>
      
      </div><p>But we can also pass a regular expression:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('12-34-56'.split(/-/)) // [12, 34, 56]</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-867">
str.replace(str|reg, str|func)</h2>
<p>The swiss army knife for search and replace in strings.</p>
<p>The simplest use – search and replace a substring, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// replace a dash by a colon
alert('12-34-56'.replace("-", ":")) // 12:34-56</code></pre>
        </div>
      </div>
      
      </div><p>When the first argument of <code>replace</code> is a string, it only looks for the first match.</p>
<p>To find all dashes, we need to use not the string <code>"-"</code>, but a regexp <code class="pattern">/-/g</code>, with an obligatory <code>g</code> flag:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:27-31">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// replace all dashes by a colon
alert( '12-34-56'.replace( /-/g, ":" ) )  // 12:34:56</code></pre>
        </div>
      </div>
      
      </div><p>The second argument is a replacement string.</p>
<p>We can use special characters in it:</p>
<table>
<thead>
<tr>
<th>Symbol</th>
<th>Inserts</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$$</code></td>
<td><code>"$"</code></td>
</tr>
<tr>
<td><code>$&amp;</code></td>
<td>the whole match</td>
</tr>
<tr>
<td><code>$`</code></td>
<td>a part of the string before the match</td>
</tr>
<tr>
<td><code>$'</code></td>
<td>a part of the string after the match</td>
</tr>
<tr>
<td><code>$n</code></td>
<td>if <code>n</code> is a 1-2 digit number, then it means the contents of n-th parentheses counting from left to right</td>
</tr>
</tbody>
</table>
<p>For instance let's use <code>$&amp;</code> to replace all entries of <code>"John"</code> by <code>"Mr.John"</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "John Doe, John Smith and John Bull.";

// for each John - replace it with Mr. and then John
alert(str.replace(/John/g, 'Mr.$&amp;'));
// "Mr.John Doe, Mr.John Smith and Mr.John Bull.";</code></pre>
        </div>
      </div>
      
      </div><p>Parentheses are very often used together with <code>$1</code>, <code>$2</code>, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "John Smith";

alert(str.replace(/(John) (Smith)/, '$2, $1')) // Smith, John</code></pre>
        </div>
      </div>
      
      </div><p><strong>For situations that require “smart” replacements, the second argument can be a function.</strong></p>
<p>It will be called for each match, and its result will be inserted as a replacement.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let i = 0;

// replace each "ho" by the result of the function
alert("HO-Ho-ho".replace(/ho/gi, function() {
  return ++i;
})); // 1-2-3</code></pre>
        </div>
      </div>
      
      </div><p>In the example above the function just returns the next number every time, but usually the result is based on the match.</p>
<p>The function is called with arguments <code>func(str, p1, p2, ..., pn, offset, s)</code>:</p>
<ol>
<li><code>str</code> – the match,</li>
<li><code>p1, p2, ..., pn</code> – contents of parentheses (if there are any),</li>
<li><code>offset</code> – position of the match,</li>
<li><code>s</code> – the source string.</li>
</ol>
<p>If there are no parentheses in the regexp, then the function always has 3 arguments: <code>func(str, offset, s)</code>.</p>
<p>Let's use it to show full information about matches:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// show and replace all matches
function replacer(str, offset, s) {
  alert(`Found ${str} at position ${offset} in string ${s}`);
  return str.toLowerCase();
}

let result = "HO-Ho-ho".replace(/ho/gi, replacer);
alert( 'Result: ' + result ); // Result: ho-ho-ho

// shows each match:
// Found HO at position 0 in string HO-Ho-ho
// Found Ho at position 3 in string HO-Ho-ho
// Found ho at position 6 in string HO-Ho-ho</code></pre>
        </div>
      </div>
      
      </div><p>In the example below there are two parentheses, so <code>replacer</code> is called with 5 arguments: <code>str</code> is the full match, then parentheses, and then <code>offset</code> and <code>s</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function replacer(str, name, surname, offset, s) {
  // name is the first parentheses, surname is the second one
  return surname + ", " + name;
}

let str = "John Smith";

alert(str.replace(/(John) (Smith)/, replacer)) // Smith, John</code></pre>
        </div>
      </div>
      
      </div><p>Using a function gives us the ultimate replacement power, because it gets all the information about the match, has access to outer variables and can do everything.</p>
<h2 id="chapter-868">
regexp.test(str)</h2>
<p>Let's move on to the methods of <code>RegExp</code> class, that are callable on regexps themselves.</p>
<p>The <code>test</code> method looks for any match and returns <code>true/false</code> whether he found it.</p>
<p>So it's basically the same as <code>str.search(reg) != -1</code>, for instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="3:7-14,4:18-25">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "I love JavaScript";

// these two tests do the same
alert( /love/i.test(str) ); // true
alert( str.search(/love/i) != -1 ); // true</code></pre>
        </div>
      </div>
      
      </div><p>An example with the negative answer:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:7-14,3:18-25">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Bla-bla-bla";

alert( /love/i.test(str) ); // false
alert( str.search(/love/i) != -1 ); // false</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-869">
regexp.exec(str)</h2>
<p>We've already seen these searching methods:</p>
<ul>
<li><code>search</code> – looks for the position of the match,</li>
<li><code>match</code> – if there's no <code>g</code> flag, returns the first match with parentheses,</li>
<li><code>match</code> – if there's a <code>g</code> flag – returns all matches, without separating parentheses.</li>
</ul>
<p>The <code>regexp.exec</code> method is a bit harder to use, but it allows to search all matches with parentheses and positions.</p>
<p>It behaves differently depending on whether the regexp has the <code>g</code> flag.</p>
<ul>
<li>If there's no <code>g</code>, then <code>regexp.exec(str)</code> returns the first match, exactly as <code>str.match(reg)</code>.</li>
<li>If there's <code>g</code>, then <code>regexp.exec(str)</code> returns the first match and <em>remembers</em> the position after it in <code>regexp.lastIndex</code> property. The next call starts to search from <code>regexp.lastIndex</code> and returns the next match. If there are no more matches then <code>regexp.exec</code> returns <code>null</code> and <code>regexp.lastIndex</code> is set to <code>0</code>.</li>
</ul>
<p>As we can see, the method gives us nothing new if we use it without the <code>g</code> flag, because <code>str.match</code> does exactly the same.</p>
<p>But the <code>g</code> flag allows to get all matches with their positions and parentheses groups.</p>
<p>Here's the example how subsequent <code>regexp.exec</code> calls return matches one by one:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4,13-13,22-22">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "A lot about JavaScript at https://javascript.info";

let regexp = /JAVA(SCRIPT)/ig;

// Look for the first match
let matchOne = regexp.exec(str);
alert( matchOne[0] ); // JavaScript
alert( matchOne[1] ); // script
alert( matchOne.index ); // 12 (the position of the match)
alert( matchOne.input ); // the same as str

alert( regexp.lastIndex ); // 22 (the position after the match)

// Look for the second match
let matchTwo = regexp.exec(str); // continue searching from regexp.lastIndex
alert( matchTwo[0] ); // javascript
alert( matchTwo[1] ); // script
alert( matchTwo.index ); // 34 (the position of the match)
alert( matchTwo.input ); // the same as str

alert( regexp.lastIndex ); // 44 (the position after the match)

// Look for the third match
let matchThree = regexp.exec(str); // continue searching from regexp.lastIndex
alert( matchThree ); // null (no match)

alert( regexp.lastIndex ); // 0 (reset)</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, each <code>regexp.exec</code> call returns the match in a “full format”: as an array with parentheses, <code>index</code> and <code>input</code> properties.</p>
<p>The main use case for <code>regexp.exec</code> is to find all matches in a loop:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = 'A lot about JavaScript at https://javascript.info';

let regexp = /javascript/ig;

let result;

while (result = regexp.exec(str)) {
  alert( `Found ${result[0]} at ${result.index}` );
}</code></pre>
        </div>
      </div>
      
      </div><p>The loop continues until <code>regexp.exec</code> returns <code>null</code> that means “no more matches”.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Search from the given position</span></div>
            <div class="important__content"><p>We can force <code>regexp.exec</code> to start searching from the given position by setting <code>lastIndex</code> manually:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = 'A lot about JavaScript at https://javascript.info';

let regexp = /javascript/ig;
regexp.lastIndex = 30;

alert( regexp.exec(str).index ); // 34, the search starts from the 30th position</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2 id="chapter-870">
The "y" flag</h2>
<p>The <code>y</code> flag means that the search should find a match exactly at the position specified by the property <code>regexp.lastIndex</code> and only there.</p>
<p>In other words, normally the search is made in the whole string: <code class="pattern">/javascript/</code> looks for “javascript” everywhere in the string.</p>
<p>But when a regexp has the <code>y</code> flag, then it only looks for the match at the position specified in <code>regexp.lastIndex</code> (<code>0</code> by default).</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "I love JavaScript!";

let reg = /javascript/iy;

alert( reg.lastIndex ); // 0 (default)
alert( str.match(reg) ); // null, not found at position 0

reg.lastIndex = 7;
alert( str.match(reg) ); // JavaScript (right, that word starts at position 7)

// for any other reg.lastIndex the result is null</code></pre>
        </div>
      </div>
      
      </div><p>The regexp <code class="pattern">/javascript/iy</code> can only be found if we set <code>reg.lastIndex=7</code>, because due to <code>y</code> flag the engine only tries to find it in the single place within a string – from the <code>reg.lastIndex</code> position.</p>
<p>So, what's the point? Where do we apply that?</p>
<p>The reason is performance.</p>
<p>The <code>y</code> flag works great for parsers – programs that need to “read” the text and build in-memory syntax structure or perform actions from it. For that we move along the text and apply regular expressions to see what we have next: a string? A number? Something else?</p>
<p>The <code>y</code> flag allows to apply a regular expression (or many of them one-by-one) exactly at the given position and when we understand what's there, we can move on – step by step examining the text.</p>
<p>Without the flag the regexp engine always searches till the end of the text, that takes time, especially if the text is large. So our parser would be very slow. The <code>y</code> flag is exactly the right thing here.</p>
<h2 id="chapter-871">
Summary, recipes</h2>
<p>Methods become much easier to understand if we separate them by their use in real-life tasks.</p>
<dl>
<dt>To search for the first match only:</dt>
<dd>
<ul>
<li>Find the position of the first match – <code>str.search(reg)</code>.</li>
</ul>
</dd>
</dl>
<ul>
<li>Find the full match – <code>str.match(reg)</code>.</li>
<li>Check if there's a match – <code>regexp.test(str)</code>.</li>
<li>Find the match from the given position – <code>regexp.exec(str)</code>, set <code>regexp.lastIndex</code> to position.</li>
</ul>
<dl>
<dt>To search for all matches:</dt>
<dd>
<ul>
<li>An array of matches – <code>str.match(reg)</code>, the regexp with <code>g</code> flag.</li>
</ul>
</dd>
</dl>
<ul>
<li>Get all matches with full information about each one – <code>regexp.exec(str)</code> with <code>g</code> flag in the loop.</li>
</ul>
<dl>
<dt>To search and replace:</dt>
<dd>
<ul>
<li>Replace with another string or a function result – <code>str.replace(reg, str|func)</code></li>
</ul>
</dd>
<dt>To split the string:</dt>
<dd>
<ul>
<li><code>str.split(str|reg)</code></li>
</ul>
</dd>
</dl>
<p>We also covered two flags:</p>
<ul>
<li>The <code>g</code> flag to find all matches (global search),</li>
<li>The <code>y</code> flag to search at exactly the given position inside the text.</li>
</ul>
<p>Now we know the methods and can use regular expressions. But we need to learn their syntax, so let's move on.</p>
<h6 id="chapter-872"></h6>
<h1 class="main__header-title" id="chapter-873">Character classes</h1>
<p>Consider a practical task – we have a phone number <code>"+7(903)-123-45-67"</code>, and we need to find all digits in that string. Other characters do not interest us.</p>
<p>A character class is a special notation that matches any symbol from the set.</p>


<p>For instance, there's a “digit” class. It's written as <code>\d</code>. We put it in the pattern, and during the search any digit matches it.</p>
<p>For instance, the regexp <code class="pattern">/\d/</code> looks for a single digit:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "+7(903)-123-45-67";

let reg = /\d/;

alert( str.match(reg) ); // 7</code></pre>
        </div>
      </div>
      
      </div><p>The regexp is not global in the example above, so it only looks for the first match.</p>
<p>Let's add the <code>g</code> flag to look for all digits:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "+7(903)-123-45-67";

let reg = /\d/g;

alert( str.match(reg) ); // array of matches: 7,9,0,3,1,2,3,4,5,6,7</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-874">
Most used classes: \d \s \w</h2>
<p>That was a character class for digits. There are other character classes as well.</p>
<p>Most used are:</p>
<dl>
<dt><code>\d</code> (“d” is from “digit”)</dt>
<dd>A digit: a character from <code>0</code> to <code>9</code>.</dd>
<dt><code>\s</code> (“s” is from “space”)</dt>
<dd>A space symbol: that includes spaces, tabs, newlines.</dd>
<dt><code>\w</code> (“w” is from “word”)</dt>
<dd>A “wordly” character: either a letter of English alphabet or a digit or an underscore. Non-english letters (like cyrillic or hindi) do not belong to <code>\w</code>.</dd>
</dl>
<p>For instance, <code class="pattern">\d\s\w</code> means a digit followed by a space character followed by a wordly character, like <code>"1 Z"</code>.</p>
<p>A regexp may contain both regular symbols and character classes.</p>
<p>For instance, <code class="pattern">CSS\d</code> matches a string <code class="match">CSS</code> with a digit after it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "CSS4 is cool";
let reg = /CSS\d/

alert( str.match(reg) ); // CSS4</code></pre>
        </div>
      </div>
      
      </div><p>Also we can use many character classes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "I love HTML5!".match(/\s\w\w\w\w\d/) ); // 'HTML5'</code></pre>
        </div>
      </div>
      
      </div><p>The match (each character class corresponds to one result character):</p>
      <img src="http://javascript.info/article/regexp-character-classes/love-html5-classes.png">
<h2 id="chapter-875">
Word boundary: \b</h2>
<p>The word boundary <code class="pattern">\b</code> – is a special character class.</p>
<p>It does not denote a character, but rather a boundary between characters.</p>
<p>For instance, <code class="pattern">\bJava\b</code> matches <code class="match">Java</code> in the string <code class="subject">Hello, Java!</code>, but not in the script <code class="subject">Hello, JavaScript!</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Hello, Java!".match(/\bJava\b/) ); // Java
alert( "Hello, JavaScript!".match(/\bJava\b/) ); // null</code></pre>
        </div>
      </div>
      
      </div><p>The boundary has “zero width” in a sense that usually a character class means a character in the result (like a wordly or a digit), but not in this case.</p>
<p>The boundary is a test.</p>
<p>When regular expression engine is doing the search, it's moving along the string in an attempt to find the match. At each string position it tries to find the pattern.</p>
<p>When the pattern contains <code class="pattern">\b</code>, it tests that the position in string fits one of the conditions:</p>
<ul>
<li>String start, and the first string character is <code>\w</code>.</li>
<li>String end, and the last string character is <code>\w</code>.</li>
<li>Inside the string: from one side is <code>\w</code>, from the other side – not <code>\w</code>.</li>
</ul>
<p>For instance, in the string <code class="subject">Hello, Java!</code> the following positions match <code>\b</code>:</p>
      <img src="http://javascript.info/article/regexp-character-classes/hello-java-boundaries.png">
<p>So it matches <code class="pattern">\bHello\b</code> and <code class="pattern">\bJava\b</code>, but not <code class="pattern">\bHell\b</code> (because there's no word boundary after <code>l</code>) and not <code>Java!\b</code> (because the exclamation sign is not a wordly character, so there's no word boundary after it).</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Hello, Java!".match(/\bHello\b/) ); // Hello
alert( "Hello, Java!".match(/\bJava\b/) );  // Java
alert( "Hello, Java!".match(/\bHell\b/) );  // null
alert( "Hello, Java!".match(/\bJava!\b/) ); // null</code></pre>
        </div>
      </div>
      
      </div><p>Once again let's note that <code class="pattern">\b</code> makes the searching engine to test for the boundary, so that <code class="pattern">Java\b</code> finds <code class="match">Java</code> only when followed by a word boundary, but it does not add a letter to the result.</p>
<p>Usually we use <code>\b</code> to find standalone English words. So that if we want <code>"Java"</code> language then <code class="pattern">\bJava\b</code> finds exactly a standalone word and ignores it when it's a part of <code>"JavaScript"</code>.</p>
<p>Another example: a regexp <code class="pattern">\b\d\d\b</code> looks for standalone two-digit numbers. In other words, it requires that before and after <code class="pattern">\d\d</code> must be a symbol different from <code>\w</code> (or beginning/end of the string).</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "1 23 456 78".match(/\b\d\d\b/g) ); // 23,78</code></pre>
        </div>
      </div>
      
      </div><div class="important important_warn">
            <div class="important__header"><span class="important__type">Word boundary doesn't work for non-English alphabets</span></div>
            <div class="important__content"><p>The word boundary check <code>\b</code> tests for a boundary between <code>\w</code> and something else. But <code>\w</code> means an English letter (or a digit or an underscore), so the test won't work for other characters (like cyrillic or hieroglyphs).</p>
</div></div>
<h2 id="chapter-876">
Reverse classes</h2>
<p>For every character class there exists a “reverse class”, denoted with the same letter, but uppercased.</p>
<p>The “reverse” means that it matches all other characters, for instance:</p>
<dl>
<dt><code>\D</code></dt>
<dd>Non-digit: any character except <code>\d</code>, for instance a letter.</dd>
<dt><code>\S</code></dt>
<dd>Non-space: any character except <code>\s</code>, for instance a letter.</dd>
<dt><code>\W</code></dt>
<dd>Non-wordly character: anything but <code>\w</code>.</dd>
<dt><code>\B</code></dt>
<dd>Non-boundary: a test reverse to <code>\b</code>.</dd>
</dl>
<p>In the beginning of the chapter we saw how to get all digits from the phone <code class="subject">+7(903)-123-45-67</code>. Let's get a “pure” phone number from the string:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "+7(903)-123-45-67";

alert( str.match(/\d/g).join('') ); // 79031234567</code></pre>
        </div>
      </div>
      
      </div><p>An alternative way would be to find non-digits and remove them from the string:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "+7(903)-123-45-67";

alert( str.replace(/\D/g, "") ); // 79031234567</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-877">
Spaces are regular characters</h2>
<p>Please note that regular expressions may include spaces. They are treated like regular characters.</p>
<p>Usually we pay little attention to spaces. For us strings <code class="subject">1-5</code> and <code class="subject">1 - 5</code> are nearly identical.</p>
<p>But if a regexp does not take spaces into account, it won' work.</p>
<p>Let's try to find digits separated by a dash:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "1 - 5".match(/\d-\d/) ); // null, no match!</code></pre>
        </div>
      </div>
      
      </div><p>Here we fix it by adding spaces into the regexp:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "1 - 5".match(/\d - \d/) ); // 1 - 5, now it works</code></pre>
        </div>
      </div>
      
      </div><p>Of course, spaces are needed only if we look for them. Extra spaces (just like any other extra characters) may prevent a match:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "1-5".match(/\d - \d/) ); // null, because the string 1-5 has no spaces</code></pre>
        </div>
      </div>
      
      </div><p>In other words, in a regular expression all characters matter. Spaces too.</p>
<h2 id="chapter-878">
A dot is any character</h2>
<p>The dot <code>"."</code> is a special character class that matches <em>any character except a newline</em>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Z".match(/./) ); // Z</code></pre>
        </div>
      </div>
      
      </div><p>Or in the middle of a regexp:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /CS.4/;

alert( "CSS4".match(reg) ); // CSS4
alert( "CS-4".match(reg) ); // CS-4
alert( "CS 4".match(reg) ); // CS 4 (space is also a character)</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the dot means “any character”, but not the “absense of a character”. There must be a character to match it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "CS4".match(/CS.4/) ); // null, no match because there's no character for the dot</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-879">
Summary</h2>
<p>We covered character classes:</p>
<ul>
<li><code>\d</code> – digits.</li>
<li><code>\D</code> – non-digits.</li>
<li><code>\s</code> – space symbols, tabs, newlines.</li>
<li><code>\S</code> – all but <code>\s</code>.</li>
<li><code>\w</code> – English letters, digits, underscore <code>'_'</code>.</li>
<li><code>\W</code> – all but <code>\w</code>.</li>
<li><code>'.'</code> – any character except a newline.</li>
</ul>
<p>If we want to search for a character that has a special meaning like a backslash or a dot, then we should escape it with a backslash: <code class="pattern">\.</code></p>
<p>Please note that a regexp may also contain string special characters such as a newline <code>\n</code>. There's no conflict with character classes, because other letters are used for them.</p>
<div class="tasks"><h2 id="chapter-880" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-the-time" name="find-the-time" class="main__anchor">Find the time</a></h3>
<a href="http://javascript.info/task/find-time-hh-mm" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>The time has a format: <code>hours:minutes</code>. Both hours and minutes has two digits, like <code>09:00</code>.</p>
<p>Make a regexp to find time in the string: <code class="subject">Breakfast at 09:00 in the room 123:456.</code></p>
<p>P.S. In this task there's no need to check time correctness yet, so <code>25:99</code> can also be a valid result.
P.P.S. The regexp shouldn't match <code>123:456</code>.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer: <code class="pattern">\b\d\d:\d\d\b</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Breakfast at 09:00 in the room 123:456.".match( /\b\d\d:\d\d\b/ ) ); // 09:00</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-881"></h6>
<h1 class="main__header-title" id="chapter-882">Escaping, special characters</h1>
<p>As we've seen, a backslash <code>"\"</code> is used to denote character classes. So it's a special character.</p>
<p>There are other special characters as well, that have special meaning in a regexp. They are used to do more powerful searches.</p>
<p>Here's a full list of them: <code class="pattern">[ \ ^ $ . | ? * + ( )</code>.</p>
<p>Don't try to remember it – when we deal with each of them separately, you'll know it by heart automatically.</p>
<h2 id="chapter-883">
Escaping</h2>
<p>To use a special character as a regular one, prepend it with a backslash.</p>
<p>That's also called “escaping a character”.</p>
<p>For instance, we need to find a dot <code class="pattern">'.'</code>. In a regular expression a dot means “any character except a newline”, so if we really mean “a dot”, let's put a backslash before it: <code class="pattern">\.</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Chapter 5.1".match(/\d\.\d/) ); // 5.1</code></pre>
        </div>
      </div>
      
      </div><p>Parentheses are also special characters, so if we want them, we should use <code class="pattern">\(</code>. The example below looks for a string <code>"g()"</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "function g()".match(/g\(\)/) ); // "g()"</code></pre>
        </div>
      </div>
      
      </div><p>If we're looking for a backslash <code>\</code>, then we should double it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "1\\2".match(/\\/) ); // '\'</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-884">
A slash</h2>
<p>The slash symbol <code>'/'</code> is not a special character, but in JavaScript it is used to open and close the regexp: <code class="pattern">/...pattern.../</code>, so we should escape it too.</p>
<p>Here's what a search for a slash <code>'/'</code> looks like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "/".match(/\//) ); // '/'</code></pre>
        </div>
      </div>
      
      </div><p>From the other hand, the alternative <code>new RegExp</code> syntaxes does not require escaping it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "/".match(new RegExp("/")) ); // '/'</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-885">
new RegExp</h2>
<p>If we are creating a regular expression with <code>new RegExp</code>, then we need to do some more escaping.</p>
<p>For instance, consider this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = new RegExp("\d\.\d");

alert( "Chapter 5.1".match(reg) ); // null</code></pre>
        </div>
      </div>
      
      </div><p>It doesn't work, but why?</p>
<p>The reason is string escaping rules. Look here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert("\d\.\d"); // d.d</code></pre>
        </div>
      </div>
      
      </div><p>Backslashes are used for escaping inside a string and string-specific special characters like <code>\n</code>. The quotes “consume” and interpret them, for instance:</p>
<ul>
<li><code>\n</code> – becomes a newline character,</li>
<li><code>\u1234</code> – becomes the Unicode character with such code,</li>
<li>…And when there's no special meaning: like <code>\d</code> or <code>\z</code>, then the backslash is simply removed.</li>
</ul>
<p>So the call to <code>new RegExp</code> gets a string without backslashes.</p>
<p>To fix it, we need to double backslashes, because quotes turn <code>\\</code> into <code>\</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let regStr = "\\d\\.\\d";
alert(regStr); // \d\.\d (correct now)

let reg = new RegExp(regStr);

alert( "Chapter 5.1".match(reg) ); // 5.1</code></pre>
        </div>
      </div>
      
      </div>="main__header-title"&gt;Sets and ranges [...]
<p>Several characters or character classes inside square brackets <code>[…]</code> mean to “search for any character among given”.</p>


<h2 id="chapter-886">
Sets</h2>
<p>For instance, <code class="pattern">[eao]</code> means any of the 3 characters: <code>'a'</code>, <code>'e'</code>, or <code>'o'</code>.</p>
<p>That's called a <em>set</em>. Sets can be used in a regexp along with regular characters:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// find [t or m], and then "op"
alert( "Mop top".match(/[tm]op/gi) ); // "Mop", "top"</code></pre>
        </div>
      </div>
      
      </div><p>Please note that although there are multiple characters in the set, they correspond to exactly one character in the match.</p>
<p>So the example above gives no matches:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// find "V", then [o or i], then "la"
alert( "Voila".match(/V[oi]la/) ); // null, no matches</code></pre>
        </div>
      </div>
      
      </div><p>The pattern assumes:</p>
<ul>
<li><code class="pattern">V</code>,</li>
<li>then <em>one</em> of the letters <code class="pattern">[oi]</code>,</li>
<li>then <code class="pattern">la</code>.</li>
</ul>
<p>So there would be a match for <code class="match">Vola</code> or <code class="match">Vila</code>.</p>
<h2 id="chapter-887">
Ranges</h2>
<p>Square brackets may also contain <em>character ranges</em>.</p>
<p>For instance, <code class="pattern">[a-z]</code> is a character in range from <code>a</code> to <code>z</code>, and <code class="pattern">[0-5]</code> is a digit from <code>0</code> to <code>5</code>.</p>
<p>In the example below we're searching for <code>"x"</code> followed by two digits or letters from <code>A</code> to <code>F</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Exception 0xAF".match(/x[0-9A-F][0-9A-F]/g) ); // xAF</code></pre>
        </div>
      </div>
      
      </div><p>Please note that in the word <code class="subject">Exception</code> there's a substring <code class="subject">xce</code>. It didn't match the pattern, because the letters are lowercase, while in the set <code class="pattern">[0-9A-F]</code> they are uppercase.</p>
<p>If we want to find it too, then we can add a range <code>a-f</code>: <code class="pattern">[0-9A-Fa-f]</code>. The <code>i</code> flag would allow lowercase too.</p>
<p><strong>Character classes are shorthands for certain character sets.</strong></p>
<p>For instance:</p>
<ul>
<li><strong>\d</strong> – is the same as <code class="pattern">[0-9]</code>,</li>
<li><strong>\w</strong> – is the same as <code class="pattern">[a-zA-Z0-9_]</code>,</li>
<li><strong>\s</strong> – is the same as <code class="pattern">[\t\n\v\f\r ]</code> plus few other unicode space characters.</li>
</ul>
<p>We can use character classes inside <code>[…]</code> as well.</p>
<p>For instance, we want to match all wordly characters or a dash, for words like “twenty-third”. We can't do it with <code class="pattern">\w+</code>, because <code class="pattern">\w</code> class does not include a dash. But we can use <code class="pattern">[\w-]</code>.</p>
<p>We also can use a combination of classes to cover every possible character, like <code class="pattern">[\s\S]</code>. That matches spaces or non-spaces – any character. That's wider than a dot <code>"."</code>, because the dot matches any character except a newline.</p>
<h2 id="chapter-888">
Excluding ranges</h2>
<p>Besides normal ranges, there are “excluding” ranges that look like <code class="pattern">[^…]</code>.</p>
<p>They are denoted by a caret character <code>^</code> at the start and match any character <em>except the given ones</em>.</p>
<p>For instance:</p>
<ul>
<li><code class="pattern">[^aeyo]</code> – any character except  <code>'a'</code>, <code>'e'</code>, <code>'y'</code> or <code>'o'</code>.</li>
<li><code class="pattern">[^0-9]</code> – any character except a digit, the same as <code>\D</code>.</li>
<li><code class="pattern">[^\s]</code> – any non-space character, same as <code>\S</code>.</li>
</ul>
<p>The example below looks for any characters except letters, digits and spaces:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "alice15@gmail.com".match(/[^\d\sA-Z]/gi) ); // @ and .</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-889">
No escaping in […]</h2>
<p>Usually when we want to find exactly the dot character, we need to escape it like <code class="pattern">\.</code>. And if we need a backslash, then we use <code class="pattern">\\</code>.</p>
<p>In square brackets the vast majority of special characters can be used without escaping:</p>
<ul>
<li>A dot <code class="pattern">'.'</code>.</li>
<li>A plus <code class="pattern">'+'</code>.</li>
<li>Parentheses <code class="pattern">'( )'</code>.</li>
<li>Dash <code class="pattern">'-'</code> in the beginning or the end (where it does not define a range).</li>
<li>A caret <code class="pattern">'^'</code> if not in the beginning (where it means exclusion).</li>
<li>And the opening square bracket <code class="pattern">'['</code>.</li>
</ul>
<p>In other words, all special characters are allowed except where they mean something for square brackets.</p>
<p>A dot <code>"."</code> inside square brackets means just a dot. The pattern <code class="pattern">[.,]</code> would look for one of characters: either a dot or a comma.</p>
<p>In the example below the regexp <code class="pattern">[-().^+]</code> looks for one of the characters <code>-().^+</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// No need to escape
let reg = /[-().^+]/g;

alert( "1 + 2 - 3".match(reg) ); // Matches +, -</code></pre>
        </div>
      </div>
      
      </div><p>…But if you decide to escape them “just in case”, then there would be no harm:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Escaped everything
let reg = /[\-\(\)\.\^\+]/g;

alert( "1 + 2 - 3".match(reg) ); // also works: +, -</code></pre>
        </div>
      </div>
      
      </div><div class="tasks"><h2 id="chapter-890" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#java-script" name="java-script" class="main__anchor">Java[^script]</a></h3>
<a href="http://javascript.info/task/find-range-1" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>We have a regexp <code class="pattern">/Java[^script]/</code>.</p>
<p>Does it match anything in the string <code class="subject">Java</code>? In the string <code class="subject">JavaScript</code>?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Answers: <strong>no, yes</strong>.</p>
<ul>
<li>
<p>In the script <code class="subject">Java</code> it doesn't match anything, because <code class="pattern">[^script]</code> means “any character except given ones”. So the regexp looks for <code>"Java"</code> followed by one such symbol, but there's a string end, no symbols after it.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "Java".match(/Java[^script]/) ); // null</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Yes, because the regexp is case-insensitive, the <code class="pattern">[^script]</code> part matches the character <code>"S"</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "JavaScript".match(/Java[^script]/) ); // "JavaS"</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-the-time-as-hh-mm-or-hh-mm" name="find-the-time-as-hh-mm-or-hh-mm" class="main__anchor">Find the time as hh:mm or hh-mm</a></h3>
<a href="http://javascript.info/task/find-time-2-formats" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>The time can be in the format <code>hours:minutes</code> or <code>hours-minutes</code>. Both hours and minutes have 2 digits:  <code>09:00</code> or <code>21-30</code>.</p>
<p>Write a regexp to find time:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;
alert( "Breakfast at 09:00. Dinner at 21-30".match(reg) ); // 09:00, 21-30</code></pre>
        </div>
      </div>
      
      </div><p>P.S. In this task we assume that the time is always correct, there's no need to filter out bad strings like “45:67”. Later we'll deal with that too.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Answer: <code class="pattern">\d\d[-:]\d\d</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /\d\d[-:]\d\d/g;
alert( "Breakfast at 09:00. Dinner at 21-30".match(reg) ); // 09:00, 21-30</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the dash <code class="pattern">'-'</code> has a special meaning in square brackets, but only between other characters, not when it's in the beginning or at the end, so we don't need to escape it.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-891"></h6>
<h1 class="main__header-title" id="chapter-892">The unicode flag</h1>
<p>The unicode flag <code>/.../u</code> enables the correct support of surrogate pairs.</p>
<p>Surrogate pairs are explained in the chapter 
<a href="http://javascript.info/string">Strings</a>.</p>
<p>Let's briefly remind them here. In short, normally characters are encoded with 2 bytes. That gives us 65536 characters maximum. But there are more characters in the world.</p>
<p>So certain rare characters are encoded with 4 bytes, like <code>𝒳</code> (mathematical X) or <code>😄</code> (a smile).</p>
<p>Here are the unicode values to compare:</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>Unicode</th>
<th>Bytes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>a</code></td>
<td>0x0061</td>
<td>2</td>
</tr>
<tr>
<td><code>≈</code></td>
<td>0x2248</td>
<td>2</td>
</tr>
<tr>
<td><code>𝒳</code></td>
<td>0x1d4b3</td>
<td>4</td>
</tr>
<tr>
<td><code>𝒴</code></td>
<td>0x1d4b4</td>
<td>4</td>
</tr>
<tr>
<td><code>😄</code></td>
<td>0x1f604</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>So characters like <code>a</code> and <code>≈</code> occupy 2 bytes, and those rare ones take 4.</p>
<p>The unicode is made in such a way that the 4-byte characters only have a meaning as a whole.</p>
<p>In the past JavaScript did not know about that, and many string methods still have problems. For instance, <code>length</code> thinks that here are two characters:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert('😄'.length); // 2
alert('𝒳'.length); // 2</code></pre>
        </div>
      </div>
      
      </div><p>…But we can see that there's only one, right? The point is that <code>length</code> treats 4 bytes as two 2-byte characters. That's incorrect, because they must be considered only together (so-called “surrogate pair”).</p>
<p>Normally, regular expressions also treat “long characters” as two 2-byte ones.</p>
<p>That leads to odd results, for instance let's try to find <code class="pattern">[𝒳𝒴]</code> in the string <code class="subject">𝒳</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '𝒳'.match(/[𝒳𝒴]/) ); // odd result</code></pre>
        </div>
      </div>
      
      </div><p>The result would be wrong, because by default the regexp engine does not understand surrogate pairs. It thinks that <code>[𝒳𝒴]</code> are not two, but four characters: the left half of <code>𝒳</code> <code>(1)</code>, the right half of <code>𝒳</code> <code>(2)</code>, the left half of <code>𝒴</code> <code>(3)</code>, the right half of <code>𝒴</code> <code>(4)</code>.</p>
<p>So it finds the left half of <code>𝒳</code> in the string <code>𝒳</code>, not the whole symbol.</p>
<p>In other words, the search works like <code>'12'.match(/[1234]/)</code> – the <code>1</code> is returned (left half of <code>𝒳</code>).</p>
<p>The <code>/.../u</code> flag fixes that. It enables surrogate pairs in the regexp engine, so the result is correct:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '𝒳'.match(/[𝒳𝒴]/u) ); // 𝒳</code></pre>
        </div>
      </div>
      
      </div><p>There's an error that may happen if we forget the flag:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">'𝒳'.match(/[𝒳-𝒴]/); // SyntaxError: invalid range in character class</code></pre>
        </div>
      </div>
      
      </div><p>Here the regexp <code>[𝒳-𝒴]</code> is treated as <code>[12-34]</code> (where <code>2</code> is the right part of <code>𝒳</code> and <code>3</code> is the left part of <code>𝒴</code>), and the range between two halves <code>2</code> and <code>3</code> is unacceptable.</p>
<p>Using the flag would make it work right:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '𝒴'.match(/[𝒳-𝒵]/u) ); // 𝒴</code></pre>
        </div>
      </div>
      
      </div><p>To finalize, let's note that if we do not deal with surrogate pairs, then the flag does nothing for us. But in the modern world we often meet them.</p>
<h6 id="chapter-893"></h6>
<h1 class="main__header-title" id="chapter-894">Quantifiers +, *, ? and {n}</h1>
<p>Let's say we have a string like <code>+7(903)-123-45-67</code> and want to find all numbers in it. But unlike before, we are interested in not digits, but full numbers: <code>7, 903, 123, 45, 67</code>.</p>
<p>A number is a sequence of 1 or more digits <code>\d</code>. The instrument to say how many we need is called <em>quantifiers</em>.</p>
<h2 id="chapter-895">
Quantity {n}</h2>
<p>The most obvious quantifier is a number in figure quotes: <code class="pattern">{n}</code>. A quantifier is put after a character (or a character class and so on) and specifies exactly how many we need.</p>
<p>It also has advanced forms, here we go with examples:</p>
<dl>
<dt>Exact count: <code>{5}</code></dt>
<dd>
<p><code class="pattern">\d{5}</code> denotes exactly 5 digits, the same as <code class="pattern">\d\d\d\d\d</code>.</p>
<p>The example below looks for a 5-digit number:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "I'm 12345 years old".match(/\d{5}/) ); //  "12345"</code></pre>
        </div>
      </div>
      
      </div><p>We can add <code>\b</code> to exclude longer numbers: <code class="pattern">\b\d{5}\b</code>.</p>
</dd>
<dt>The count from-to: <code>{3,5}</code></dt>
<dd>
<p>To find numbers from 3 to 5 digits we can put the limits into figure brackets: <code class="pattern">\d{3,5}</code></p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "I'm not 12, but 1234 years old".match(/\d{3,5}/) ); // "1234"</code></pre>
        </div>
      </div>
      
      </div><p>We can omit the upper limit. Then a regexp <code class="pattern">\d{3,}</code> looks for numbers of <code>3</code> and more digits:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "I'm not 12, but 345678 years old".match(/\d{3,}/) ); // "345678"</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<p>In case with the string <code>+7(903)-123-45-67</code> we need numbers: one or more digits in a row. That is  <code class="pattern">\d{1,}</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "+7(903)-123-45-67";

let numbers = str.match(/\d{1,}/g);

alert(numbers); // 7,903,123,45,67</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-896">
Shorthands</h2>
<p>Most often needed quantifiers have shorthands:</p>
<dl>
<dt><code>+</code></dt>
<dd>
<p>Means “one or more”, the same as <code>{1,}</code>.</p>
<p>For instance, <code class="pattern">\d+</code> looks for numbers:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "+7(903)-123-45-67";

alert( str.match(/\d+/g) ); // 7,903,123,45,67</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>?</code></dt>
<dd>
<p>Means “zero or one”, the same as <code>{0,1}</code>. In other words, it makes the symbol optional.</p>
<p>For instance, the pattern <code class="pattern">ou?r</code> looks for <code class="match">o</code> followed by zero or one <code class="match">u</code>, and then <code class="match">r</code>.</p>
<p>So it can find <code class="match">or</code> in the word <code class="subject">color</code> and <code class="match">our</code> in <code class="subject">colour</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Should I write color or colour?";

alert( str.match(/colou?r/g) ); // color, colour</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt><code>*</code></dt>
<dd>
<p>Means “zero or more”, the same as <code>{0,}</code>. That is, the character may repeat any times or be absent.</p>
<p>The example below looks for a digit followed by any number of zeroes:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "100 10 1".match(/\d0*/g) ); // 100, 10, 1</code></pre>
        </div>
      </div>
      
      </div><p>Compare it with <code>'+'</code> (one or more):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "100 10 1".match(/\d0+/g) ); // 100, 10</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<h2 id="chapter-897">
More examples</h2>
<p>Quantifiers are used very often. They are one of the main “building blocks” for complex regular expressions, so let's see more examples.</p>
<dl>
<dt>Regexp “decimal fraction” (a number with a floating point): <code class="pattern">\d+\.\d+</code></dt>
<dd>
<p>In action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "0 1 12.345 7890".match(/\d+\.\d+/g) ); // 12.345</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt>Regexp “open HTML-tag without attributes”, like <code>&lt;span&gt;</code> or <code>&lt;p&gt;</code>: <code class="pattern">/&lt;[a-z]+&gt;/i</code></dt>
<dd>
<p>In action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "&lt;body&gt; ... &lt;/body&gt;".match(/&lt;[a-z]+&gt;/gi) ); // &lt;body&gt;</code></pre>
        </div>
      </div>
      
      </div><p>We look for character <code class="pattern">'&lt;'</code> followed by one or more English letters, and then  <code class="pattern">'&gt;'</code>.</p>
</dd>
<dt>Regexp “open HTML-tag without attributes” (improved): <code class="pattern">/&lt;[a-z][a-z0-9]*&gt;/i</code></dt>
<dd>
<p>Better regexp: according to the standard, HTML tag name may have a digit at any position except the first one, like <code>&lt;h1&gt;</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "&lt;h1&gt;Hi!&lt;/h1&gt;".match(/&lt;[a-z][a-z0-9]*&gt;/gi) ); // &lt;h1&gt;</code></pre>
        </div>
      </div>
      
      </div></dd>
<dt>Regexp “opening or closing HTML-tag without attributes”: <code class="pattern">/&lt;\/?[a-z][a-z0-9]*&gt;/i</code></dt>
<dd>
<p>We added an optional slash <code class="pattern">/?</code> before the tag. Had to escape it with a backslash, otherwise JavaScript would think it is the pattern end.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "&lt;h1&gt;Hi!&lt;/h1&gt;".match(/&lt;\/?[a-z][a-z0-9]*&gt;/gi) ); // &lt;h1&gt;, &lt;/h1&gt;</code></pre>
        </div>
      </div>
      
      </div></dd>
</dl>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">More precise means more complex</span></div>
            <div class="important__content"><p>We can see one common rule in these examples: the more precise is the regular expression – the longer and more complex it is.</p>
<p>For instance, HTML tags could use a simpler regexp: <code class="pattern">&lt;\w+&gt;</code>.</p>
<p>Because <code class="pattern">\w</code> means any English letter or a digit or <code>'_'</code>, the regexp also matches non-tags, for instance <code class="match">&lt;_&gt;</code>. But it's much simpler than <code class="pattern">&lt;[a-z][a-z0-9]*&gt;</code>.</p>
<p>Are we ok with <code class="pattern">&lt;\w+&gt;</code> or we need <code class="pattern">&lt;[a-z][a-z0-9]*&gt;</code>?</p>
<p>In real life both variants are acceptable. Depends on how tolerant we can be to “extra” matches and whether it's difficult or not to filter them out by other means.</p>
</div></div>
<div class="tasks"><h2 id="chapter-898" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#how-to-find-an-ellipsis" name="how-to-find-an-ellipsis" class="main__anchor">How to find an ellipsis "..." ?</a></h3>
<a href="http://javascript.info/task/find-text-manydots" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a regexp to find ellipsis: 3 (or more?) dots in a row.</p>
<p>Check it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;
alert( "Hello!... How goes?.....".match(reg) ); // ..., .....</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Solution:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /\.{3,}/g;
alert( "Hello!... How goes?.....".match(reg) ); // ..., .....</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the dot is a special character, so we have to escape it and insert as <code>\.</code>.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#regexp-for-html-colors" name="regexp-for-html-colors" class="main__anchor">Regexp for HTML colors</a></h3>
<a href="http://javascript.info/task/find-html-colors-6hex" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Create a regexp to search HTML-colors written as <code>#ABCDEF</code>: first <code>#</code> and then 6 hexadimal characters.</p>
<p>An example of use:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /...your regexp.../

let str = "color:#121212; background-color:#AA00ef bad-colors:f#fddee #fd2 #12345678";

alert( str.match(reg) )  // #121212,#AA00ef</code></pre>
        </div>
      </div>
      
      </div><p>P.S. In this task we do not need other color formats like <code>#123</code> or <code>rgb(1,2,3)</code> etc.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We need to look for <code>#</code> followed by 6 hexadimal characters.</p>
<p>A hexadimal character can be described as <code class="pattern">[0-9a-fA-F]</code>. Or if we use the <code>i</code> flag, then just  <code class="pattern">[0-9a-f]</code>.</p>
<p>Then we can look for 6 of them using the quantifier <code class="pattern">{6}</code>.</p>
<p>As a result, we have the regexp: <code class="pattern">/#[a-f0-9]{6}/gi</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /#[a-f0-9]{6}/gi;

let str = "color:#121212; background-color:#AA00ef bad-colors:f#fddee #fd2"

alert( str.match(reg) );  // #121212,#AA00ef</code></pre>
        </div>
      </div>
      
      </div><p>The problem is that it finds the color in longer sequences:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "#12345678".match( /#[a-f0-9]{6}/gi ) ) // #12345678</code></pre>
        </div>
      </div>
      
      </div><p>To fix that, we can add <code class="pattern">\b</code> to the end:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// color
alert( "#123456".match( /#[a-f0-9]{6}\b/gi ) ); // #123456

// not a color
alert( "#12345678".match( /#[a-f0-9]{6}\b/gi ) ); // null</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-899"></h6>
<h1 class="main__header-title" id="chapter-900">Greedy and lazy quantifiers</h1>
<p>Quantifiers are very simple from the first sight, but in fact they can be tricky.</p>
<p>We should understand how the search works very well if we plan to look for something more complex than <code class="pattern">/\d+/</code>.</p>


<p>Let's take the following task as an example.</p>
<p>We have a text and need to replace all quotes <code>"..."</code> with guillemet marks: <code>«...»</code>. They are preferred for typography in many countries.</p>
<p>For instance: <code>"Hello, world"</code> should become <code>«Hello, world»</code>.</p>
<p>Some countries prefer <code>„Witam, świat!”</code> (Polish) or even <code>「你好，世界」</code> (Chinese) quotes. For different locales we can choose different replacements, but that all works the same, so let's start with <code>«...»</code>.</p>
<p>To make replacements we first need to find all quoted substrings.</p>
<p>The regular expression can look like this: <code class="pattern">/".+"/g</code>. That is: we look for a quote followed by one or more characters, and then another quote.</p>
<p>…But if we try to apply it, even in such a simple case…</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /".+"/g;

let str = 'a "witch" and her "broom" is one';

alert( str.match(reg) ); // "witch" and her "broom"</code></pre>
        </div>
      </div>
      
      </div><p>…We can see that it works not as intended!</p>
<p>Instead of finding two matches <code class="match">"witch"</code> and <code class="match">"broom"</code>, it finds one: <code class="match">"witch" and her "broom"</code>.</p>
<p>That can be described as “greediness is the cause of all evil”.</p>
<h2 id="chapter-901">
Greedy search</h2>
<p>To find a match, the regular expression engine uses the following algorithm:</p>
<ul>
<li>For every position in the string
<ul>
<li>Match the pattern at that position.</li>
<li>If there's no match, go to the next position.</li>
</ul>
</li>
</ul>
<p>These common words do not make it obvious why the regexp fails, so let's elaborate how the search works for the pattern <code class="pattern">".+"</code>.</p>
<ol>
<li>
<p>The first pattern character is a quote <code class="pattern">"</code>.</p>
<p>The regular expression engine tries to find it at the zero position of the source string <code class="subject">a "witch" and her "broom" is one</code>, but there's <code class="subject">a</code> there, so there's immediately no match.</p>
<p>Then it advances: goes to the next positions in the source string and tries to find the first character of the pattern there, and finally finds the quote at the 3rd position:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_greedy1.png">
</li>
<li>
<p>The quote is detected, and then the engine tries to find a match for the rest of the pattern. It tries to see if the rest of the subject string conforms to <code class="pattern">.+"</code>.</p>
<p>In our case the next pattern character is <code class="pattern">.</code> (a dot). It denotes “any character except a newline”, so the next string letter <code class="match">'w'</code> fits:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_greedy2.png">
</li>
<li>
<p>Then the dot repeats because of the quantifier <code class="pattern">.+</code>. The regular expression engine builds the match by taking characters one by one while it is possible.</p>
<p>…When it becomes impossible? All characters match the dot, so it only stops when it reaches the end of the string:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_greedy3.png">
</li>
<li>
<p>Now the engine finished repeating for <code class="pattern">.+</code> and tries to find the next character of the pattern. It's the quote <code class="pattern">"</code>. But there's a problem: the string has finished, there are no more characters!</p>
<p>The regular expression engine understands that it took too many <code class="pattern">.+</code> and starts to <em>backtrack</em>.</p>
<p>In other words, it shortens the match for the quantifier by one character:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_greedy4.png">
<p>Now it assumes that <code class="pattern">.+</code> ends one character before the end and tries to match the rest of the pattern from that position.</p>
<p>If there were a quote there, then that would be the end, but the last character is <code class="subject">'e'</code>, so there's no match.</p>
</li>
<li>
<p>…So the engine decreases the number of repetitions of <code class="pattern">.+</code> by one more character:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_greedy5.png">
<p>The quote <code class="pattern">'"'</code> does not match <code class="subject">'n'</code>.</p>
</li>
<li>
<p>The engine keep backtracking: it decreases the count of repetition for <code class="pattern">'.'</code> until the rest of the pattern (in our case <code class="pattern">'"'</code>) matches:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_greedy6.png">
</li>
<li>
<p>The match is complete.</p>
</li>
<li>
<p>So the first match is <code class="match">"witch" and her "broom"</code>. The further search starts where the first match ends, but there are no more quotes in the rest of the string <code class="subject">is one</code>, so no more results.</p>
</li>
</ol>
<p>That's probably not what we expected, but that's how it works.</p>
<p><strong>In the greedy mode (by default) the quantifier is repeated as many times as possible.</strong></p>
<p>The regexp engine tries to fetch as many characters as it can by <code class="pattern">.+</code>, and then shortens that one by one.</p>
<p>For our task we want another thing. That's what the lazy quantifier mode is for.</p>
<h2 id="chapter-902">
Lazy mode</h2>
<p>The lazy mode of quantifier is an opposite to the greedy mode. It means: “repeat minimal number of times”.</p>
<p>We can enable it by putting a question mark <code class="pattern">'?'</code> after the quantifier, so that it becomes  <code class="pattern">*?</code> or <code class="pattern">+?</code> or even <code class="pattern">??</code> for <code class="pattern">'?'</code>.</p>
<p>To make things clear: usually a question mark <code class="pattern">?</code> is a quantifier by itself (zero or one), but if added <em>after another quantifier (or even itself)</em> it gets another meaning – it switches the matching mode from greedy to lazy.</p>
<p>The regexp <code class="pattern">/".+?"/g</code> works as intended: it finds <code class="match">"witch"</code> and <code class="match">"broom"</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /".+?"/g;

let str = 'a "witch" and her "broom" is one';

alert( str.match(reg) ); // witch, broom</code></pre>
        </div>
      </div>
      
      </div><p>To clearly understand the change, let's trace the search step by step.</p>
<ol>
<li>
<p>The first step is the same: it finds the pattern start <code class="pattern">'"'</code> at the 3rd position:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_greedy1.png">
</li>
<li>
<p>The next step is also similar: the engine finds a match for the dot <code class="pattern">'.'</code>:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_greedy2.png">
</li>
<li>
<p>And now the search goes differently. Because we have a lazy mode for <code class="pattern">+?</code>, the engine doesn't try to match a dot one more time, but stops and tries to match the rest of the pattern  <code class="pattern">'"'</code> right now:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_lazy3.png">
<p>If there were a quote there, then the search would end, but there's <code>'i'</code>, so there's no match.</p>
</li>
<li>
<p>Then the regular expression engine increases the number of repetitions for the dot and tries one more time:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_lazy4.png">
<p>Failure again. Then the number of repetitions is increased again and again…</p>
</li>
<li>
<p>…Till the match for the rest of the pattern is found:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_lazy5.png">
</li>
<li>
<p>The next search starts from the end of the current match and yield one more result:</p>
      <img src="http://javascript.info/article/regexp-greedy-and-lazy/witch_lazy6.png">
</li>
</ol>
<p>In this example we saw how the lazy mode works for <code class="pattern">+?</code>. Quantifiers <code class="pattern">+?</code> and <code class="pattern">??</code> work the similar way – the regexp engine increases the number of repetitions only if the rest of the pattern can't match on the given position.</p>
<p><strong>Laziness is only enabled for the quantifier with <code>?</code>.</strong></p>
<p>Other quantifiers remain greedy.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( "123 456".match(/\d+ \d+?/g) ); // 123 4</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>
<p>The pattern <code class="pattern">\d+</code> tries to match as many numbers as it can (greedy mode), so it finds  <code class="match">123</code> and stops, because the next character is a space <code class="pattern">' '</code>.</p>
</li>
<li>
<p>Then there's a space in pattern, it matches.</p>
</li>
<li>
<p>Then there's <code class="pattern">\d+?</code>. The quantifier is in lazy mode, so it finds one digit <code class="match">4</code> and tries to check if the rest of the pattern matches from there.</p>
<p>…But there's nothing in the pattern after <code class="pattern">\d+?</code>.</p>
<p>The lazy mode doesn't repeat anything without a need. The pattern finished, so we're done. We have a match <code class="match">123 4</code>.</p>
</li>
<li>
<p>The next search starts from the character <code>5</code>.</p>
</li>
</ol>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Optimizations</span></div>
            <div class="important__content"><p>Modern regular expression engines can optimize internal algorithms to work faster. So they may work a bit different from the described algorithm.</p>
<p>But to understand how regular expressions work and to build regular expressions, we don't need to know about that. They are only used internally to optimize things.</p>
<p>Complex regular expressions are hard to optimize, so the search may work exactly as described as well.</p>
</div></div>
<h2 id="chapter-903">
Alternative approach</h2>
<p>With regexps, there's often more then one way to do the same thing.</p>
<p>In our case we can find quoted strings without lazy mode using the regexp <code class="pattern">"[^"]+"</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /"[^"]+"/g;

let str = 'a "witch" and her "broom" is one';

alert( str.match(reg) ); // witch, broom</code></pre>
        </div>
      </div>
      
      </div><p>The regexp <code class="pattern">"[^"]+"</code> gives correct results, because it looks for a quote <code class="pattern">'"'</code> followed by one or more non-quotes <code class="pattern">[^"]</code>, and then the closing quote.</p>
<p>When the regexp engine looks for <code class="pattern">[^"]+</code> it stops the repetitions when it meets the closing quote, and we're done.</p>
<p>Please note, that this logic does not replace lazy quantifiers!</p>
<p>It is just different. There are times when we need one or another.</p>
<p>Let's see one more example where lazy quantifiers fail and this variant works right.</p>
<p>For instance, we want to find links of the form <code>&lt;a href="..." class="doc"&gt;</code>, with any <code>href</code>.</p>
<p>Which regular expression to use?</p>
<p>The first idea might be: <code class="pattern">/&lt;a href=".*" class="doc"&gt;/g</code>.</p>
<p>Let's check it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '...&lt;a href="link" class="doc"&gt;...';
let reg = /&lt;a href=".*" class="doc"&gt;/g;

// Works!
alert( str.match(reg) ); // &lt;a href="link" class="doc"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>…But what if there are many links in the text?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '...&lt;a href="link1" class="doc"&gt;... &lt;a href="link2" class="doc"&gt;...';
let reg = /&lt;a href=".*" class="doc"&gt;/g;

// Whoops! Two links in one match!
alert( str.match(reg) ); // &lt;a href="link1" class="doc"&gt;... &lt;a href="link2" class="doc"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Now the result is wrong for the same reason as our “witches” example. The quantifier <code class="pattern">.*</code> took too many characters.</p>
<p>The match looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;a href="....................................." class="doc"&gt;
&lt;a href="link1" class="doc"&gt;... &lt;a href="link2" class="doc"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Let's modify the pattern by making the quantifier <code class="pattern">.*?</code> lazy:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '...&lt;a href="link1" class="doc"&gt;... &lt;a href="link2" class="doc"&gt;...';
let reg = /&lt;a href=".*?" class="doc"&gt;/g;

// Works!
alert( str.match(reg) ); // &lt;a href="link1" class="doc"&gt;, &lt;a href="link2" class="doc"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Now it works, there are two matches:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;a href="....." class="doc"&gt;    &lt;a href="....." class="doc"&gt;
&lt;a href="link1" class="doc"&gt;... &lt;a href="link2" class="doc"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Why it works – should be obvious after all explanations above. So let's not stop on the details, but try one more text:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '...&lt;a href="link1" class="wrong"&gt;... &lt;p style="" class="doc"&gt;...';
let reg = /&lt;a href=".*?" class="doc"&gt;/g;

// Wrong match!
alert( str.match(reg) ); // &lt;a href="link1" class="wrong"&gt;... &lt;p style="" class="doc"&gt;</code></pre>
        </div>
      </div>
      
      </div><p>We can see that the regexp matched not just a link, but also a lot of text after it, including <code>&lt;p...&gt;</code>.</p>
<p>Why it happens?</p>
<ol>
<li>
<p>First the regexp finds a link start <code class="match">&lt;a href="</code>.</p>
</li>
<li>
<p>Then it looks for <code class="pattern">.*?</code>, we take one character, then check if there's a match for the rest of the pattern, then take another one…</p>
<p>The quantifier <code class="pattern">.*?</code> consumes characters until it meets <code class="match">class="doc"&gt;</code>.</p>
<p>…And where can it find it? If we look at the text, then we can see that the only <code class="match">class="doc"&gt;</code> is beyond the link, in the tag <code>&lt;p&gt;</code>.</p>
</li>
<li>
<p>So we have match:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;a href="..................................." class="doc"&gt;
&lt;a href="link1" class="wrong"&gt;... &lt;p style="" class="doc"&gt;</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>So the laziness did not work for us here.</p>
<p>We need the pattern to look for <code>&lt;a href="...something..." class="doc"&gt;</code>, but both greedy and lazy variants have problems.</p>
<p>The correct variant would be: <code class="pattern">href="[^"]*"</code>. It will take all characters inside the <code>href</code> attribute till the nearest quote, just what we need.</p>
<p>A working example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str1 = '...&lt;a href="link1" class="wrong"&gt;... &lt;p style="" class="doc"&gt;...';
let str2 = '...&lt;a href="link1" class="doc"&gt;... &lt;a href="link2" class="doc"&gt;...';
let reg = /&lt;a href="[^"]*" class="doc"&gt;/g;

// Works!
alert( str1.match(reg) ); // null, no matches, that's correct
alert( str2.match(reg) ); // &lt;a href="link1" class="doc"&gt;, &lt;a href="link2" class="doc"&gt;</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-904">
Summary</h2>
<p>Quantifiers have two modes of work:</p>
<dl>
<dt>Greedy</dt>
<dd>By default the regular expression engine tries to repeat the quantifier as many times as possible. For instance, <code class="pattern">\d+</code> consumes all possible digits. When it becomes impossible to consume more (no more digits or string end), then it continues to match the rest of the pattern. If there's no match then it decreases the number of repetitions (backtracks) and tries again.</dd>
<dt>Lazy</dt>
<dd>Enabled by the question mark <code class="pattern">?</code> after the quantifier. The regexp engine tries to match the rest of the pattern before each repetition of the quantifier.</dd>
</dl>
<p>As we've seen, the lazy mode is not a “panacea” from the greedy search. An alternative is a “fine-tuned” greedy search, with exclusions. Soon we'll see more examples of it.</p>
<div class="tasks"><h2 id="chapter-905" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#a-match-for-d-d" name="a-match-for-d-d" class="main__anchor">A match for /d+? d+?/</a></h3>
<a href="http://javascript.info/task/lazy-greedy" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>What's the match here?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">"123 456".match(/\d+? \d+?/g) ); // ?</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The result is: <code class="match">123 4</code>.</p>
<p>First the lazy <code class="pattern">\d+?</code> tries to take as little digits as it can, but it has to reach the space, so it takes  <code class="match">123</code>.</p>
<p>Then the second <code>\d+?</code> takes only one digit, because that's enough.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-html-comments" name="find-html-comments" class="main__anchor">Find HTML comments</a></h3>
<a href="http://javascript.info/task/find-html-comments" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Find all HTML comments in the text:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

let str = `... &lt;!-- My -- comment
 test --&gt; ..  &lt;!----&gt; ..
`;

alert( str.match(reg) ); // '&lt;!-- My -- comment \n test --&gt;', '&lt;!----&gt;'</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>We need to find the beginning of the comment <code class="match">&lt;!--</code>, then everything till the end of <code class="match">--&gt;</code>.</p>
<p>The first idea could be <code class="pattern">&lt;!--.*?--&gt;</code> – the lazy quantifier makes the dot stop right before  <code class="match">--&gt;</code>.</p>
<p>But a dot in Javascript means “any symbol except the newline”. So multiline comments won't be found.</p>
<p>We can use <code class="pattern">[\s\S]</code> instead of the dot to match “anything”:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /&lt;!--[\s\S]*?--&gt;/g;

let str = `... &lt;!-- My -- comment
 test --&gt; ..  &lt;!----&gt; ..
`;

alert( str.match(reg) ); // '&lt;!-- My -- comment \n test --&gt;', '&lt;!----&gt;'</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-html-tags" name="find-html-tags" class="main__anchor">Find HTML tags</a></h3>
<a href="http://javascript.info/task/find-html-tags-greedy-lazy" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Create a regular expression to find all (opening and closing) HTML tags with their attributes.</p>
<p>An example of use:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

let str = '&lt;&gt; &lt;a href="/"&gt; &lt;input type="radio" checked&gt; &lt;b&gt;';

alert( str.match(reg) ); // '&lt;a href="/"&gt;', '&lt;input type="radio" checked&gt;', '&lt;b&gt;'</code></pre>
        </div>
      </div>
      
      </div><p>Let's assume that may not contain <code>&lt;</code> and <code>&gt;</code> inside (in quotes too), that simplifies things a bit.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution is <code class="pattern">&lt;[^&lt;&gt;]+&gt;</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /&lt;[^&lt;&gt;]+&gt;/g;

let str = '&lt;&gt; &lt;a href="/"&gt; &lt;input type="radio" checked&gt; &lt;b&gt;';

alert( str.match(reg) ); // '&lt;a href="/"&gt;', '&lt;input type="radio" checked&gt;', '&lt;b&gt;'</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-906"></h6>
<h1 class="main__header-title" id="chapter-907">Capturing groups</h1>
<p>A part of the pattern can be enclosed in parentheses <code class="pattern">(...)</code>. That's called a “capturing group”.</p>
<p>That has two effects:</p>
<ol>
<li>It allows to place a part of the match into a separate array item when using  
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match">String#match</a> or 
<a href="https://developer.mozilla.org/en-US/docs/Web/RegExp/exec">RegExp#exec</a> methods.</li>
<li>If we put a quantifier after the parentheses, it applies to the parentheses as a whole, not the last character.</li>
</ol>


<h2 id="chapter-908">
Example</h2>
<p>In the example below the pattern <code class="pattern">(go)+</code> finds one or more <code class="match">'go'</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( 'Gogogo now!'.match(/(go)+/i) ); // "Gogogo"</code></pre>
        </div>
      </div>
      
      </div><p>Without parentheses, the pattern <code class="pattern">/go+/</code> means <code class="subject">g</code>, followed by <code class="subject">o</code> repeated one or more times. For instance, <code class="match">goooo</code> or <code class="match">gooooooooo</code>.</p>
<p>Parentheses group the word <code class="pattern">(go)</code> together.</p>
<p>Let's make something more complex – a regexp to match an email.</p>
<p>Examples of emails:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">my@mail.com
john.smith@site.com.uk</code></pre>
        </div>
      </div>
      
      </div><p>The pattern: <code class="pattern">[-.\w]+@([\w-]+\.)+[\w-]{2,20}</code>.</p>
<ul>
<li>
<p>The first part before <code>@</code> may include wordly characters, a dot and a dash <code class="pattern">[-.\w]+</code>, like <code class="match">john.smith</code>.</p>
</li>
<li>
<p>Then <code class="pattern">@</code></p>
</li>
<li>
<p>And then the domain. May be a second-level domain <code>site.com</code> or with subdomains like <code>host.site.com.uk</code>. We can match it as “a word followed by a dot” repeated one or more times for subdomains: <code class="match">mail.</code> or <code class="match">site.com.</code>, and then “a word” for the last part: <code class="match">.com</code> or <code class="match">.uk</code>.</p>
<p>The word followed by a dot is <code class="pattern">(\w+\.)+</code> (repeated). The last word should not have a dot at the end, so it's just <code>\w{2,20}</code>. The quantifier <code class="pattern">{2,20}</code> limits the length, because domain zones are like <code>.uk</code> or <code>.com</code> or <code>.museum</code>, but can't be longer than 20 characters.</p>
<p>So the domain pattern is <code class="pattern">(\w+\.)+\w{2,20}</code>. Now we replace <code>\w</code> with <code>[\w-]</code>, because dashes are also allowed in domains, and we get the final result.</p>
</li>
</ul>
<p>That regexp is not perfect, but usually works. It's short and good enough to fix errors or occasional mistypes.</p>
<p>For instance, here we can find all emails in the string:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /[-.\w]+@([\w-]+\.)+[\w-]{2,20}/g;

alert("my@mail.com @ his@site.com.uk".match(reg)); // my@mail.com,his@site.com.uk</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-909">
Contents of parentheses</h2>
<p>Parentheses are numbered from left to right. The search engine remembers the content of each and allows to reference it in the pattern or in the replacement string.</p>
<p>For instance, we can find an HTML-tag using a (simplified) pattern <code class="pattern">&lt;.*?&gt;</code>. Usually we'd want to do something with the result after it.</p>
<p>If we enclose the inner contents of <code>&lt;...&gt;</code> into parentheses, then we can access it like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '&lt;h1&gt;Hello, world!&lt;/h1&gt;';
let reg = /&lt;(.*?)&gt;/;

alert( str.match(reg) ); // Array: ["&lt;h1&gt;", "h1"]</code></pre>
        </div>
      </div>
      
      </div><p>The call to 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match">String#match</a> returns groups only if the regexp has no <code class="pattern">/.../g</code> flag.</p>
<p>If we need all matches with their groups then we can use 
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec">RegExp#exec</a> method as described in 
<a href="http://javascript.info/regexp-methods">Methods of RegExp and String</a>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '&lt;h1&gt;Hello, world!&lt;/h1&gt;';

// two matches: opening &lt;h1&gt; and closing &lt;/h1&gt; tags
let reg = /&lt;(.*?)&gt;/g;

let match;

while (match = reg.exec(str)) {
  // first shows the match: &lt;h1&gt;,h1
  // then shows the match: &lt;/h1&gt;,/h1
  alert(match);
}</code></pre>
        </div>
      </div>
      
      </div><p>Here we have two matches for <code class="pattern">&lt;(.*?)&gt;</code>, each of them is an array with the full match and groups.</p>
<h2 id="chapter-910">
Nested groups</h2>
<p>Parentheses can be nested. In this case the numbering also goes from left to right.</p>
<p>For instance, when searching a tag in <code class="subject">&lt;span class="my"&gt;</code> we may be interested in:</p>
<ol>
<li>The tag content as a whole: <code class="match">span class="my"</code>.</li>
<li>The tag name: <code class="match">span</code>.</li>
<li>The tag attributes: <code class="match">class="my"</code>.</li>
</ol>
<p>Let's add parentheses for them:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = '&lt;span class="my"&gt;';

let reg = /&lt;(([a-z]+)\s*([^&gt;]*))&gt;/;

let result = str.match(reg);
alert(result); // &lt;span class="my"&gt;, span class="my", span, class="my"</code></pre>
        </div>
      </div>
      
      </div><p>Here's how groups look:</p>
      <img src="http://javascript.info/article/regexp-groups/regexp-nested-groups.png">
<p>At the zero index of the <code>result</code> is always the full match.</p>
<p>Then groups, numbered from left to right. Whichever opens first gives the first group <code>result[1]</code>. Here it encloses the whole tag content.</p>
<p>Then in <code>result[2]</code> goes the group from the second opening <code class="pattern">(</code> till the corresponding <code class="pattern">)</code> – tag name, then we don't group spaces, but group attributes for <code>result[3]</code>.</p>
<p><strong>If a group is optional and doesn't exist in the match, the corresponding <code>result</code> index is present (and equals <code>undefined</code>).</strong></p>
<p>For instance, let's consider the regexp <code class="pattern">a(z)?(c)?</code>. It looks for <code>"a"</code> optionally followed by <code>"z"</code> optionally followed by <code>"c"</code>.</p>
<p>If we run it on the string with a single letter <code class="subject">a</code>, then the result is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let match = 'a'.match(/a(z)?(c)?/);

alert( match.length ); // 3
alert( match[0] ); // a (whole match)
alert( match[1] ); // undefined
alert( match[2] ); // undefined</code></pre>
        </div>
      </div>
      
      </div><p>The array has the length of <code>3</code>, but all groups are empty.</p>
<p>And here's a more complex match for the string <code class="subject">ack</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let match = 'ack'.match(/a(z)?(c)?/)

alert( match.length ); // 3
alert( match[0] ); // ac (whole match)
alert( match[1] ); // undefined, because there's nothing for (z)?
alert( match[2] ); // c</code></pre>
        </div>
      </div>
      
      </div><p>The array length is permanent: <code>3</code>. But there's nothing for the group <code class="pattern">(z)?</code>, so the result is <code>["ac", undefined, "c"]</code>.</p>
<h2 id="chapter-911">
Non-capturing groups with ?:</h2>
<p>Sometimes we need parentheses to correctly apply a quantifier, but we don't want their contents in the array.</p>
<p>A group may be excluded by adding <code class="pattern">?:</code> in the beginning.</p>
<p>For instance, if we want to find <code class="pattern">(go)+</code>, but don't want to put remember the contents (<code>go</code>) in a separate array item, we can write: <code class="pattern">(?:go)+</code>.</p>
<p>In the example below we only get the name “John” as a separate member of the <code>results</code> array:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Gogo John!";
// exclude Gogo from capturing
let reg = /(?:go)+ (\w+)/i;

let result = str.match(reg);

alert( result.length ); // 2
alert( result[1] ); // John</code></pre>
        </div>
      </div>
      
      </div><div class="tasks"><h2 id="chapter-912" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-color-in-the-format-abc-or-abcdef" name="find-color-in-the-format-abc-or-abcdef" class="main__anchor">Find color in the format #abc or #abcdef</a></h3>
<a href="http://javascript.info/task/find-webcolor-3-or-6" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Write a regexp that matches colors in the format <code>#abc</code> or <code>#abcdef</code>. That is: <code>#</code> followed by 3 or 6 hexadimal digits.</p>
<p>Usage example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

let str = "color: #3f3; background-color: #AA00ef; and: #abcd";

alert( str.match(reg) ); // #3f3 #AA0ef</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Should be exactly 3 or 6 hex digits: values like <code>#abcd</code> should not match.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>A regexp to search 3-digit color <code>#abc</code>: <code class="pattern">/#[a-f0-9]{3}/i</code>.</p>
<p>We can add exactly 3 more optional hex digits. We don't need more or less. Either we have them or we don't.</p>
<p>The simplest way to add them – is to append to the regexp: <code class="pattern">/#[a-f0-9]{3}([a-f0-9]{3})?/i</code></p>
<p>We can do it in a smarter way though: <code class="pattern">/#([a-f0-9]{3}){1,2}/i</code>.</p>
<p>Here the regexp <code class="pattern">[a-f0-9]{3}</code> is in parentheses to apply the quantifier  <code class="pattern">{1,2}</code> to it as a whole.</p>
<p>In action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /#([a-f0-9]{3}){1,2}/gi;

let str = "color: #3f3; background-color: #AA00ef; and: #abcd";

alert( str.match(reg) ); // #3f3 #AA0ef #abc</code></pre>
        </div>
      </div>
      
      </div><p>There's minor problem here: the pattern found <code class="match">#abc</code> in  <code class="subject">#abcd</code>. To prevent that we can add <code class="pattern">\b</code> to the end:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /#([a-f0-9]{3}){1,2}\b/gi;

let str = "color: #3f3; background-color: #AA00ef; and: #abcd";

alert( str.match(reg) ); // #3f3 #AA0ef</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-positive-numbers" name="find-positive-numbers" class="main__anchor">Find positive numbers</a></h3>
<a href="http://javascript.info/task/find-decimal-positive-numbers" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Create a regexp that looks for positive numbers, including those without a decimal point.</p>
<p>An example of use:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

let str = "1.5 0 12. 123.4.";

alert( str.match(reg) );   // 1.5, 0, 12, 123.4</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>An integer number is <code class="pattern">\d+</code>.</p>
<p>A decimal part is: <code class="pattern">\.\d+</code>.</p>
<p>Because the decimal part is optional, let's put it in parentheses with quantifier <code class="pattern">'?'</code>.</p>
<p>Finally we have the regexp: <code class="pattern">\d+(\.\d+)?</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /\d+(\.\d+)?/g;

let str = "1.5 0 12. 123.4.";

alert( str.match(re) );   // 1.5, 0, 12, 123.4</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-all-numbers" name="find-all-numbers" class="main__anchor">Find all numbers</a></h3>
<a href="http://javascript.info/task/find-decimal-numbers" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Write a regexp that looks for all decimal numbers including integer ones, with the floating point and negative ones.</p>
<p>An example of use:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

let str = "-1.5 0 2 -123.4.";

alert( str.match(re) ); // -1.5, 0, 2, -123.4</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>A positive number with an optional decimal part is (per previous task): <code class="pattern">\d+(\.\d+)?</code>.</p>
<p>Let's add an optional <code>-</code> in the beginning:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /-?\d+(\.\d+)?/g;

let str = "-1.5 0 2 -123.4.";

alert( str.match(reg) );   // -1.5, 0, 2, -123.4</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#parse-an-expression" name="parse-an-expression" class="main__anchor">Parse an expression</a></h3>
<a href="http://javascript.info/task/parse-expression" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>An arithmetical expression consists of 2 numbers and an operator between them, for instance:</p>
<ul>
<li><code>1 + 2</code></li>
<li><code>1.2 * 3.4</code></li>
<li><code>-3 / -6</code></li>
<li><code>-2 - 2</code></li>
</ul>
<p>The operator is one of: <code>"+"</code>, <code>"-"</code>, <code>"*"</code> or <code>"/"</code>.</p>
<p>There may be extra spaces at the beginning, at the end or between the parts.</p>
<p>Create a function <code>parse(expr)</code> that takes an expression and returns an array of 3 items:</p>
<ol>
<li>The first number.</li>
<li>The operator.</li>
<li>The second number.</li>
</ol>
<p>For example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let [a, op, b] = parse("1.2 * 3.4");

alert(a); // 1.2
alert(op); // *
alert(b); // 3.4</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>A regexp for a number is: <code class="pattern">-?\d+(\.\d+)?</code>. We created it in previous tasks.</p>
<p>An operator is <code class="pattern">[-+*/]</code>. We put a dash <code class="pattern">-</code> the first, because in the middle it would mean a character range, we don't need that.</p>
<p>Note that a slash should be escaped inside a JavaScript regexp <code class="pattern">/.../</code>.</p>
<p>We need a number, an operator, and then another number. And optional spaces between them.</p>
<p>The full regular expression: <code class="pattern">-?\d+(\.\d+)?\s*[-+*/]\s*-?\d+(\.\d+)?</code>.</p>
<p>To get a result as an array let's put parentheses around the data that we need: numbers and the operator: <code class="pattern">(-?\d+(\.\d+)?)\s*([-+*/])\s*(-?\d+(\.\d+)?)</code>.</p>
<p>In action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /(-?\d+(\.\d+)?)\s*([-+*\/])\s*(-?\d+(\.\d+)?)/;

alert( "1.2 + 12".match(reg) );</code></pre>
        </div>
      </div>
      
      </div><p>The result includes:</p>
<ul>
<li><code>result[0] == "1.2 + 12"</code> (full match)</li>
<li><code>result[1] == "1"</code> (first parentheses)</li>
<li><code>result[2] == "2"</code> (second parentheses – the decimal part <code>(\.\d+)?</code>)</li>
<li><code>result[3] == "+"</code> (…)</li>
<li><code>result[4] == "12"</code> (…)</li>
<li><code>result[5] == undefined</code> (the last decimal part is absent, so it's undefined)</li>
</ul>
<p>We need only numbers and the operator. We don't need decimal parts.</p>
<p>So let's remove extra groups from capturing by added <code class="pattern">?:</code>, for instance: <code class="pattern">(?:\.\d+)?</code>.</p>
<p>The final solution:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function parse(expr) {
  let reg = /(-?\d+(?:\.\d+)?)\s*([-+*\/])\s*(-?\d+(?:\.\d+)?)/;

  let result = expr.match(reg);

  if (!result) return;
  result.shift();

  return result;
}

alert( parse("-1.23 * 3.45") );  // -1.23, *, 3.45</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-913"></h6>
<h1 class="main__header-title" id="chapter-914">Backreferences: \n and $n</h1>
<p>Capturing groups may be accessed not only in the result, but in the replacement string, and in the pattern too.</p>


<h2 id="chapter-915">
Group in replacement: $n</h2>
<p>When we are using <code>replace</code> method, we can access n-th group in the replacement string using <code>$n</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:36-44">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let name = "John Smith";

name = name.replace(/(\w+) (\w+)/i, "$2, $1");
alert( name ); // Smith, John</code></pre>
        </div>
      </div>
      
      </div><p>Here <code class="pattern">$1</code> in the replacement string means “substitute the content of the first group here”, and <code class="pattern">$2</code> means “substitute the second group here”.</p>
<p>Referencing a group in the replacement string allows us to reuse the existing text during the replacement.</p>
<h2 id="chapter-916">
Group in pattern: \n</h2>
<p>A group can be referenced in the pattern using <code>\n</code>.</p>
<p>To make things clear let's consider a task. We need to find a quoted string: either a single-quoted  <code class="subject">'...'</code> or a double-quoted <code class="subject">"..."</code> – both variants need to match.</p>
<p>How to look for them?</p>
<p>We can put two kinds of quotes in the pattern: <code class="pattern">['"](.*?)['"]</code>. That finds strings like  <code class="match">"..."</code> and <code class="match">'...'</code>, but it gives incorrect matches when one quote appears inside another one, like the string <code class="subject">"She's the one!"</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "He said: \"She's the one!\".";

let reg = /['"](.*?)['"]/g;

// The result is not what we expect
alert( str.match(reg) ); // "She'</code></pre>
        </div>
      </div>
      
      </div><p>As we can see, the pattern found an opening quote <code class="match">"</code>, then the text is consumed lazily till the other quote <code class="match">'</code>, that closes the match.</p>
<p>To make sure that the pattern looks for the closing quote exactly the same as the opening one, let's make a group of it and use the backreference:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "He said: \"She's the one!\".";

let reg = /(['"])(.*?)\1/g;

alert( str.match(reg) ); // "She's the one!"</code></pre>
        </div>
      </div>
      
      </div><p>Now everything's correct! The regular expression engine finds the first quote <code class="pattern">(['"])</code> and remembers the content of <code class="pattern">(...)</code>, that's the first capturing group.</p>
<p>Further in the pattern <code class="pattern">\1</code> means “find the same text as in the first group”.</p>
<p>Please note:</p>
<ul>
<li>To reference a group inside a replacement string – we use <code>$1</code>, while in the pattern – a backslash <code>\1</code>.</li>
<li>If we use <code>?:</code> in the group, then we can't reference it. Groups that are excluded from capturing <code>(?:...)</code> are not remembered by the engine.</li>
</ul>
<h6 id="chapter-917"></h6>
<h1 class="main__header-title" id="chapter-918">Alternation (OR) |</h1>
<p>Alternation is the term in regular expression that is actually a simple “OR”.</p>
<p>In a regular expression it is denoted with a vertical line character <code class="pattern">|</code>.</p>


<p>For instance, we need to find programming languages: HTML, PHP, Java or JavaScript.</p>
<p>The corresponding regexp: <code class="pattern">html|php|java(script)?</code>.</p>
<p>A usage example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /html|php|css|java(script)?/gi;

let str = "First HTML appeared, then CSS, then JavaScript";

alert( str.match(reg) ); // 'HTML', 'CSS', 'JavaScript'</code></pre>
        </div>
      </div>
      
      </div><p>We already know a similar thing – square brackets. They allow to choose between multiple character, for instance <code class="pattern">gr[ae]y</code> matches <code class="match">gray</code> or <code class="match">grey</code>.</p>
<p>Alternation works not on a character level, but on expression level. A regexp <code class="pattern">A|B|C</code> means one of expressions <code>A</code>, <code>B</code> or <code>C</code>.</p>
<p>For instance:</p>
<ul>
<li><code class="pattern">gr(a|e)y</code> means exactly the same as <code class="pattern">gr[ae]y</code>.</li>
<li><code class="pattern">gra|ey</code> means “gra” or “ey”.</li>
</ul>
<p>To separate a part of the pattern for alternation we usually enclose it in parentheses, like this: <code class="pattern">before(XXX|YYY)after</code>.</p>
<h2 id="chapter-919">
Regexp for time</h2>
<p>In previous chapters there was a task to build a regexp for searching time in the form <code>hh:mm</code>, for instance <code>12:00</code>. But a simple <code class="pattern">\d\d:\d\d</code> is too vague. It accepts <code>25:99</code> as the time.</p>
<p>How can we make a better one?</p>
<p>We can apply more careful matching:</p>
<ul>
<li>The first digit must be <code>0</code> or <code>1</code> followed by any digit.</li>
<li>Or <code>2</code> followed by <code class="pattern">[0-3]</code></li>
</ul>
<p>As a regexp: <code class="pattern">[01]\d|2[0-3]</code>.</p>
<p>Then we can add a colon and the minutes part.</p>
<p>The minutes must be from <code>0</code> to <code>59</code>, in the regexp language that means the first digit  <code class="pattern">[0-5]</code> followed by any other digit <code>\d</code>.</p>
<p>Let's glue them together into the pattern: <code class="pattern">[01]\d|2[0-3]:[0-5]\d</code>.</p>
<p>We're almost done, but there's a problem. The alternation <code>|</code> is between the <code class="pattern">[01]\d</code> and <code class="pattern">2[0-3]:[0-5]\d</code>. That's wrong, because it will match either the left or the right pattern:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /[01]\d|2[0-3]:[0-5]\d/g;

alert("12".match(reg)); // 12 (matched [01]\d)</code></pre>
        </div>
      </div>
      
      </div><p>That's rather obvious, but still an often mistake when starting to work with regular expressions.</p>
<p>We need to add parentheses to apply alternation exactly to hours: <code>[01]\d</code> OR <code>2[0-3]</code>.</p>
<p>The correct variant:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /([01]\d|2[0-3]):[0-5]\d/g;

alert("00:00 10:10 23:59 25:99 1:2".match(reg)); // 00:00,10:10,23:59</code></pre>
        </div>
      </div>
      
      </div><div class="tasks"><h2 id="chapter-920" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-programming-languages" name="find-programming-languages" class="main__anchor">Find programming languages</a></h3>
<a href="http://javascript.info/task/find-programming-language" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>There are many programming languages, for instance Java, JavaScript, PHP, C, C++.</p>
<p>Create a regexp that finds them in the string <code class="subject">Java JavaScript PHP C++ C</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

alert("Java JavaScript PHP C++ C".match(reg)); // Java JavaScript PHP C++ C</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The first idea can be to list the languages with <code>|</code> in-between.</p>
<p>But that doesn't work right:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /Java|JavaScript|PHP|C|C\+\+/g;

let str = "Java, JavaScript, PHP, C, C++";

alert( str.match(reg) ); // Java,Java,PHP,C,C</code></pre>
        </div>
      </div>
      
      </div><p>The regular expression engine looks for alternations one-by-one. That is: first it checks if we have  <code class="match">Java</code>, otherwise – looks for <code class="match">JavaScript</code> and so on.</p>
<p>As a result, <code class="match">JavaScript</code> can never be found, just because <code class="match">Java</code> is checked first.</p>
<p>The same with <code class="match">C</code> and <code class="match">C++</code>.</p>
<p>There are two solutions for that problem:</p>
<ol>
<li>Change the order to check the longer match first: <code class="pattern">JavaScript|Java|C\+\+|C|PHP</code>.</li>
<li>Merge variants with the same start: <code class="pattern">Java(Script)?|C(\+\+)?|PHP</code>.</li>
</ol>
<p>In action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /Java(Script)?|C(\+\+)?|PHP/g;

let str = "Java, JavaScript, PHP, C, C++";

alert( str.match(reg) ); // Java,JavaScript,PHP,C,C++</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-bbtag-pairs" name="find-bbtag-pairs" class="main__anchor">Find bbtag pairs</a></h3>
<a href="http://javascript.info/task/find-matching-bbtags" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>A “bb-tag” looks like <code>[tag]...[/tag]</code>, where <code>tag</code> is one of: <code>b</code>, <code>url</code> or <code>quote</code>.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">[b]text[/b]
[url]http://google.com[/url]</code></pre>
        </div>
      </div>
      
      </div><p>BB-tags can be nested. But a tag can't be nested into itself, for instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">Normal:
[url] [b]http://google.com[/b] [/url]
[quote] [b]text[/b] [/quote]

Impossible:
[b][b]text[/b][/b]</code></pre>
        </div>
      </div>
      
      </div><p>Tags can contain line breaks, that's normal:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">[quote]
  [b]text[/b]
[/quote]</code></pre>
        </div>
      </div>
      
      </div><p>Create a regexp to find all BB-tags with their contents.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

let str = "..[url]http://google.com[/url]..";
alert( str.match(reg) ); // [url]http://google.com[/url]</code></pre>
        </div>
      </div>
      
      </div><p>If tags are nested, then we need the outer tag (if we want we can continue the search in its content):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

let str = "..[url][b]http://google.com[/b][/url]..";
alert( str.match(reg) ); // [url][b]http://google.com[/b][/url]</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>Opening tag is <code class="pattern">\[(b|url|quote)\]</code>.</p>
<p>Then to find everything till the closing tag – let's the pattern <code class="pattern">[\s\S]*?</code> to match any character including the newline and then a backreference to the closing tag.</p>
<p>The full pattern: <code class="pattern">\[(b|url|quote)\][\s\S]*?\[/\1\]</code>.</p>
<p>In action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /\[(b|url|quote)\][\s\S]*?\[\/\1\]/g;

let str = `
  [b]hello![/b]
  [quote]
    [url]http://google.com[/url]
  [/quote]
`;

alert( str.match(reg) ); // [b]hello![/b],[quote][url]http://google.com[/url][/quote]</code></pre>
        </div>
      </div>
      
      </div><p>Please note that we had to escape a slash for the closing tag <code class="pattern">[/\1]</code>, because normally the slash closes the pattern.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-quoted-strings" name="find-quoted-strings" class="main__anchor">Find quoted strings</a></h3>
<a href="http://javascript.info/task/match-quoted-string" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Create a regexp to find strings in double quotes <code class="subject">"..."</code>.</p>
<p>The important part is that strings should support escaping, in the same way as JavaScript strings do. For instance, quotes can be inserted as <code class="subject">\"</code> a newline as <code class="subject">\n</code>, and the slash itself as <code class="subject">\\</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "Just like \"here\".";</code></pre>
        </div>
      </div>
      
      </div><p>For us it's important that an escaped quote <code class="subject">\"</code> does not end a string.</p>
<p>So we should look from one quote to the other ignoring escaped quotes on the way.</p>
<p>That's the essential part of the task, otherwise it would be trivial.</p>
<p>Examples of strings to match:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="0:3-12,1:3-19,2:3-7,3:3-10">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">.. "test me" ..
.. "Say \"Hello\"!" ... (escaped quotes inside)
.. "\\" ..  (double slash inside)
.. "\\ \"" ..  (double slash and an escaped quote inside)</code></pre>
        </div>
      </div>
      
      </div><p>In JavaScript we need to double the slashes to pass them right into the string, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = ' .. "test me" .. "Say \\"Hello\\"!" .. "\\\\ \\"" .. ';

// the in-memory string
alert(str); //  .. "test me" .. "Say \"Hello\"!" .. "\\ \"" ..</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution: <code class="pattern">/"(\\.|[^"\\])*"/g</code>.</p>
<p>Step by step:</p>
<ul>
<li>First we look for an opening quote <code class="pattern">"</code></li>
<li>Then if we have a backslash <code class="pattern">\\</code> (we technically have to double it in the pattern, because it is a special character, so that's a single backslash in fact), then any character is fine after it (a dot).</li>
<li>Otherwise we take any character except a quote (that would mean the end of the string) and a backslash (to prevent lonely backslashes, the backslash is only used with some other symbol after it): <code class="pattern">[^"\\]</code></li>
<li>…And so on till the closing quote.</li>
</ul>
<p>In action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /"(\\.|[^"\\])*"/g;
let str = ' .. "test me" .. "Say \\"Hello\\"!" .. "\\\\ \\"" .. ';

alert( str.match(reg) ); // "test me","Say \"Hello\"!","\\ \""</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#find-the-full-tag" name="find-the-full-tag" class="main__anchor">Find the full tag</a></h3>
<a href="http://javascript.info/task/match-exact-tag" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Write a regexp to find the tag <code>&lt;style...&gt;</code>. It should match the full tag: it may have no attributes  <code>&lt;style&gt;</code> or have several of them <code>&lt;style type="..." id="..."&gt;</code>.</p>
<p>…But the regexp should not match <code>&lt;styler&gt;</code>!</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/g;

alert( '&lt;style&gt; &lt;styler&gt; &lt;style test="..."&gt;'.match(reg) ); // &lt;style&gt;, &lt;style test="..."&gt;</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The pattern start is obvious: <code class="pattern">&lt;style</code>.</p>
<p>…But then we can't simply write <code class="pattern">&lt;style.*?&gt;</code>, because <code class="match">&lt;styler&gt;</code> would match it.</p>
<p>We need either a space after <code class="match">&lt;style</code> and then optionally something else or the ending <code class="match">&gt;</code>.</p>
<p>In the regexp language: <code class="pattern">&lt;style(&gt;|\s.*?&gt;)</code>.</p>
<p>In action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /&lt;style(&gt;|\s.*?&gt;)/g;

alert( '&lt;style&gt; &lt;styler&gt; &lt;style test="..."&gt;'.match(reg) ); // &lt;style&gt;, &lt;style test="..."&gt;</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-921"></h6>
<h1 class="main__header-title" id="chapter-922">String start ^ and finish $</h1>
<p>The caret <code class="pattern">'^'</code> and dollar <code class="pattern">'$'</code> characters have special meaning in a regexp. They are called “anchors”.</p>


<p>The caret <code class="pattern">^</code> matches at the beginning of the text, and the dollar <code class="pattern">$</code> – in the end.</p>
<p>For instance, let's test if the text starts with <code>Mary</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str1 = "Mary had a little lamb, it's fleece was white as snow";
let str2 = 'Everywhere Mary went, the lamp was sure to go';

alert( /^Mary/.test(str1) ); // true
alert( /^Mary/.test(str2) ); // false</code></pre>
        </div>
      </div>
      
      </div><p>The pattern <code class="pattern">^Mary</code> means: “the string start and then Mary”.</p>
<p>Now let's test whether the text ends with an email.</p>
<p>To match an email, we can use a regexp <code class="pattern">[-.\w]+@([\w-]+\.)+[\w-]{2,20}</code>. It's not perfect, but mostly works.</p>
<p>To test whether the string ends with the email, let's add <code class="pattern">$</code> to the pattern:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /[-.\w]+@([\w-]+\.)+[\w-]{2,20}$/g;

let str1 = 'My email is mail@site.com';
let str2 = 'Everywhere Mary went, the lamp was sure to go';

alert( reg.test(str1) ); // true
alert( reg.test(str2) ); // false</code></pre>
        </div>
      </div>
      
      </div><p>We can use both anchors together to check whether the string exactly follows the pattern. That's often used for validation.</p>
<p>For instance we want to check that <code>str</code> is exactly a color in the form <code>#</code> plus 6 hex digits. The pattern for the color is <code class="pattern">#[0-9a-f]{6}</code>.</p>
<p>To check that the <em>whole string</em> exactly matches it, we add <code class="pattern">^...$</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = "#abcdef";

alert( /^#[0-9a-f]{6}$/i.test(str) ); // true</code></pre>
        </div>
      </div>
      
      </div><p>The regexp engine looks for the text start, then the color, and then immediately the text end. Just what we need.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Anchors have zero length</span></div>
            <div class="important__content"><p>Anchors just like <code>\b</code> are tests. They have zero-width.</p>
<p>In other words, they do not match a character, but rather force the regexp engine to check the condition (text start/end).</p>
</div></div>
<p>The behavior of anchors changes if there's a flag <code class="pattern">m</code> (multiline mode). We'll explore it in the next chapter.</p>
<div class="tasks"><h2 id="chapter-923" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#regexp" name="regexp" class="main__anchor">Regexp ^$</a></h3>
<a href="http://javascript.info/task/start-end" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Which string matches the pattern <code class="pattern">^$</code>?</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The empty string is the only match: it starts and immediately finishes.</p>
<p>The task once again demonstrates that anchors are not characters, but tests.</p>
<p>The string is empty <code>""</code>. The engine first matches the <code class="pattern">^</code> (input start), yes it's there, and then immediately the end <code class="pattern">$</code>, it's here too. So there's a match.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#check-mac-address" name="check-mac-address" class="main__anchor">Check MAC-address</a></h3>
<a href="http://javascript.info/task/test-mac" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>
<a href="https://en.wikipedia.org/wiki/MAC_address">MAC-address</a> of a network interface consists of 6 two-digit hex numbers separated by a colon.</p>
<p>For instance: <code class="subject">'01:32:54:67:89:AB'</code>.</p>
<p>Write a regexp that checks whether a string is MAC-address.</p>
<p>Usage:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /your regexp/;

alert( reg.test('01:32:54:67:89:AB') ); // true

alert( reg.test('0132546789AB') ); // false (no colons)

alert( reg.test('01:32:54:67:89') ); // false (5 numbers, must be 6)

alert( reg.test('01:32:54:67:89:ZZ') ) // false (ZZ ad the end)</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>A two-digit hex number is <code class="pattern">[0-9a-f]{2}</code> (assuming the <code class="pattern">i</code> flag is enabled).</p>
<p>We need that number <code>NN</code>, and then <code>:NN</code> repeated 5 times (more numbers);</p>
<p>The regexp is: <code class="pattern">[0-9a-f]{2}(:[0-9a-f]{2}){5}</code></p>
<p>Now let's show that the match should capture all the text: start at the beginning and end at the end. That's done by wrapping the pattern in <code class="pattern">^...$</code>.</p>
<p>Finally:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /^[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}){5}$/i;

alert( reg.test('01:32:54:67:89:AB') ); // true

alert( reg.test('0132546789AB') ); // false (no colons)

alert( reg.test('01:32:54:67:89') ); // false (5 numbers, need 6)

alert( reg.test('01:32:54:67:89:ZZ') ) // false (ZZ in the end)</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-924"></h6>
<h1 class="main__header-title" id="chapter-925">Multiline mode, flag "m"</h1>
<p>The multiline mode is enabled by the flag <code class="pattern">/.../m</code>.</p>


<p>It only affects the behavior of <code class="pattern">^</code> and <code class="pattern">$</code>.</p>
<p>In the multiline mode they match not only at the beginning and end of the string, but also at start/end of line.</p>
<h2 id="chapter-926">
Line start ^</h2>
<p>In the example below the text has multiple lines. The pattern <code class="pattern">/^\d+/gm</code> takes a number from the beginning of each one:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = `1st place: Winnie
2nd place: Piglet
33rd place: Eeyore`;

alert( str.match(/^\d+/gm) ); // 1, 2, 33</code></pre>
        </div>
      </div>
      
      </div><p>Without the flag  <code class="pattern">/.../m</code> only the first number is matched:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = `1st place: Winnie
2nd place: Piglet
33rd place: Eeyore`;

alert( str.match(/^\d+/g) ); // 1</code></pre>
        </div>
      </div>
      
      </div><p>That's because by default a caret <code class="pattern">^</code> only matches at the beginning of the text, and in the multiline mode – at the start of a line.</p>
<p>The regular expression engine moves along the text and looks for a string start <code class="pattern">^</code>, when finds – continues to match the rest of the pattern <code class="pattern">\d+</code>.</p>
<h2 id="chapter-927">
Line end $</h2>
<p>The dollar sign <code class="pattern">$</code> behaves similarly.</p>
<p>The regular expression <code class="pattern">\w+$</code> finds the last word in every line</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = `1st place: Winnie
2nd place: Piglet
33rd place: Eeyore`;

alert( str.match(/\w+$/gim) ); // Winnie,Piglet,Eeyore</code></pre>
        </div>
      </div>
      
      </div><p>Without the <code class="pattern">/.../m</code> flag the dollar <code class="pattern">$</code> would only match the end of the whole string, so only the very last word would be found.</p>
<h2 id="chapter-928">
Anchors ^$ versus \n</h2>
<p>To find a newline, we can use not only <code class="pattern">^</code> and <code class="pattern">$</code>, but also the newline character <code>\n</code>.</p>
<p>The first difference is that unlike anchors, the character <code>\n</code> “consumes” the newline character and adds it to the result.</p>
<p>For instance, here we use it instead of <code class="pattern">$</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let str = `1st place: Winnie
2nd place: Piglet
33rd place: Eeyore`;

alert( str.match(/\w+\n/gim) ); // Winnie\n,Piglet\n</code></pre>
        </div>
      </div>
      
      </div><p>Here every match is a word plus a newline character.</p>
<p>And one more difference – the newline <code>\n</code> does not match at the string end. That's why <code>Eeyore</code> is not found in the example above.</p>
<p>So, anchors are usually better, they are closer to what we want to get.</p>
<h6 id="chapter-929"></h6>
<h1 class="main__header-title" id="chapter-930">Lookahead (in progress)</h1>
<p>The article is under development, will be here when it's ready.</p>
<h6 id="chapter-931"></h6>
<h1 class="main__header-title" id="chapter-932">Infinite backtracking problem</h1>
<p>Some regular expressions are looking simple, but can execute veeeeeery long time, and even “hang” the JavaScript engine.</p>
<p>Sooner or later most developers occasionally face such behavior.</p>
<p>The typical situation – a regular expression works fine sometimes, but for certain strings it “hangs”  consuming 100% of CPU.</p>
<p>That may even be a vulnerability. For instance, if JavaScript is on the server, and it uses regular expressions to process user data, then such an input may cause denial of service. The author personally saw and reported such vulnerabilities even for well-known and widely used programs.</p>
<p>So the problem is definitely worth to deal with.</p>


<h2 id="chapter-933">
Example</h2>
<p>The plan will be like this:</p>
<ol>
<li>First we see the problem how it may occur.</li>
<li>Then we simplify the situation and see why it occurs.</li>
<li>Then we fix it.</li>
</ol>
<p>For instance let's consider searching tags in HTML.</p>
<p>We want to find all tags, with or without attributes – like <code class="subject">&lt;a href="..." class="doc" ...&gt;</code>. We need the regexp to work reliably, because HTML comes from the internet and can be messy.</p>
<p>In particular, we need it to match tags like <code>&lt;a test="&lt;&gt;" href="#"&gt;</code> – with <code>&lt;</code> and <code>&gt;</code> in attributes. That's allowed by 
<a href="https://html.spec.whatwg.org/multipage/syntax.html#syntax-attributes">HTML standard</a>.</p>
<p>Now we can see that a simple regexp like <code class="pattern">&lt;[^&gt;]+&gt;</code> doesn't work, because it stops at the first <code>&gt;</code>, and we need to ignore <code>&lt;&gt;</code> inside an attribute.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// the match doesn't reach the end of the tag - wrong!
alert( '&lt;a test="&lt;&gt;" href="#"&gt;'.match(/&lt;[^&gt;]+&gt;/) ); // &lt;a test="&lt;&gt;</code></pre>
        </div>
      </div>
      
      </div><p>We need the whole tag.</p>
<p>To correctly handle such situations we need a more complex regular expression. It will have the form  <code class="pattern">&lt;tag (key=value)*&gt;</code>.</p>
<p>In the regexp language that is: <code class="pattern">&lt;\w+(\s*\w+=(\w+|"[^"]*")\s*)*&gt;</code>:</p>
<ol>
<li><code class="pattern">&lt;\w+</code> – is the tag start,</li>
<li><code class="pattern">(\s*\w+=(\w+|"[^"]*")\s*)*</code> – is an arbitrary number of pairs <code>word=value</code>, where the value can be either a word <code class="pattern">\w+</code> or a quoted string <code class="pattern">"[^"]*"</code>.</li>
</ol>
<p>That doesn't yet support few details of HTML grammar, for instance strings in ‘single' quotes, but they can be added later, so that's somewhat close to real life. For now we want the regexp to be simple.</p>
<p>Let's try it in action:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /&lt;\w+(\s*\w+=(\w+|"[^"]*")\s*)*&gt;/g;

let str='...&lt;a test="&lt;&gt;" href="#"&gt;... &lt;b&gt;...';

alert( str.match(reg) ); // &lt;a test="&lt;&gt;" href="#"&gt;, &lt;b&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Great, it works! It found both the long tag <code class="match">&lt;a test="&lt;&gt;" href="#"&gt;</code> and the short one <code class="match">&lt;b&gt;</code>.</p>
<p>Now let's see the problem.</p>
<p>If you run the example below, it may hang the browser (or whatever JavaScript engine runs):</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let reg = /&lt;\w+(\s*\w+=(\w+|"[^"]*")\s*)*&gt;/g;

let str = `&lt;tag a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b
  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b`;

// The search will take a long long time
alert( str.match(reg) );</code></pre>
        </div>
      </div>
      
      </div><p>Some regexp engines can handle that search, but most of them don't.</p>
<p>What's the matter? Why a simple regular expression on such a small string “hangs”?</p>
<p>Let's simplify the situation by removing the tag and quoted strings.</p>
<p>Here we look only for attributes:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// only search for space-delimited attributes
let reg = /&lt;(\s*\w+=\w+\s*)*&gt;/g;

let str = `&lt;a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b
  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b`;

// the search will take a long, long time
alert( str.match(reg) );</code></pre>
        </div>
      </div>
      
      </div><p>The same problem persists.</p>
<p>Here we end the demo of the problem and start looking into what's going on and why it hangs.</p>
<h2 id="chapter-934">
Backtracking</h2>
<p>To make an example even simpler, let's consider <code class="pattern">(\d+)*$</code>.</p>
<p>This regular expression also has the same problem. In most regexp engines that search takes a very long time (careful – can hang):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( '12345678901234567890123456789123456789z'.match(/(\d+)*$/) );</code></pre>
        </div>
      </div>
      
      </div><p>So what's wrong with the regexp?</p>
<p>First, one may notice that the regexp is a little bit strange. The quantifier <code class="pattern">*</code> looks extraneous. If we want a number, we can use <code class="pattern">\d+$</code>.</p>
<p>Indeed, the regexp is artificial. But the reason why it is slow is the same as those we saw above. So let's understand it, and then return to the real-life examples.</p>
<p>What happen during the search of <code class="pattern">(\d+)*$</code> in the line <code class="subject">123456789z</code>?</p>
<ol>
<li>
<p>First, the regexp engine tries to find a number <code class="pattern">\d+</code>. The plus <code class="pattern">+</code> is greedy by default, so it consumes all digits:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">\d+.......
(123456789)z</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Then it tries to apply the star around the parentheses <code class="pattern">(\d+)*</code>, but there are no more digits, so it the star doesn't give anything.</p>
<p>Then the pattern has the string end anchor <code class="pattern">$</code>, and in the text we have <code class="subject">z</code>.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">           X
\d+........$
(123456789)z</code></pre>
        </div>
      </div>
      
      </div><p>No match!</p>
</li>
<li>
<p>There's no match, so the greedy quantifier <code class="pattern">+</code> decreases the count of repetitions (backtracks).</p>
<p>Now <code>\d+</code> is not all digits, but all except the last one:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">\d+.......
(12345678)9z</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Now the engine tries to continue the search from the new position (<code>9</code>).</p>
<p>The start <code class="pattern">(\d+)*</code> can now be applied – it gives the number <code class="match">9</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">\d+.......\d+
(12345678)(9)z</code></pre>
        </div>
      </div>
      
      </div><p>The engine tries to match <code>$</code> again, but fails, because meets <code class="subject">z</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">             X
\d+.......\d+
(12345678)(9)z</code></pre>
        </div>
      </div>
      
      </div><p>There's no match, so the engine will continue backtracking.</p>
</li>
<li>
<p>Now the first number <code class="pattern">\d+</code> will have 7 digits, and the rest of the string <code class="subject">89</code> becomes the second <code class="pattern">\d+</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">             X
\d+......\d+
(1234567)(89)z</code></pre>
        </div>
      </div>
      
      </div><p>…Still no match for <code class="pattern">$</code>.</p>
<p>The search engine backtracks again. Backtracking generally works like this: the last greedy quantifier decreases the number of repetitions until it can. Then the previous greedy quantifier decreases, and so on. In our case the last greedy quantifier is the second <code class="pattern">\d+</code>, from <code class="subject">89</code> to <code class="subject">8</code>, and then the star takes <code class="subject">9</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">               X
\d+......\d+\d+
(1234567)(8)(9)z</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>…Fail again. The second and third <code class="pattern">\d+</code> backtracked to the end, so the first quantifier shortens the match to <code class="subject">123456</code>, and the star takes the rest:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">             X
\d+.......\d+
(123456)(789)z</code></pre>
        </div>
      </div>
      
      </div><p>Again no match. The process repeats: the last greedy quantifier releases one character (<code>9</code>):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">               X
\d+.....\d+ \d+
(123456)(78)(9)z</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>…And so on.</p>
</li>
</ol>
<p>The regular expression engine goes through all combinations of <code>123456789</code> and their subsequences. There are a lot of them, that's why it takes so long.</p>
<p>A smart guy can say here: “Backtracking? Let's turn on the lazy mode – and no more backtracking!”.</p>
<p>Let's replace <code class="pattern">\d+</code> with <code class="pattern">\d+?</code> and see if it works (careful, can hang the browser)</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// sloooooowwwwww
alert( '12345678901234567890123456789123456789z'.match(/(\d+?)*$/) );</code></pre>
        </div>
      </div>
      
      </div><p>No, it doesn't.</p>
<p>Lazy quantifiers actually do the same, but in the reverse order. Just think about how the search engine would work in this case.</p>
<p>Some regular expression engines have tricky built-in checks to detect infinite backtracking or other means to work around them, but there's no universal solution.</p>
<p>In the example above, when we search <code class="pattern">&lt;(\s*\w+=\w+\s*)*&gt;</code> in the string <code class="subject">&lt;a=b a=b a=b a=b</code> – the similar thing happens.</p>
<p>The string has no <code>&gt;</code> at the end, so the match is impossible, but the regexp engine does not know about it. The search backtracks trying different combinations of <code class="pattern">(\s*\w+=\w+\s*)</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">(a=b a=b a=b) (a=b)
(a=b a=b) (a=b a=b)
...</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-935">
How to fix?</h2>
<p>The problem – too many variants in backtracking even if we don't need them.</p>
<p>For instance, in the pattern <code class="pattern">(\d+)*$</code> we (people) can easily see that <code class="pattern">(\d+)</code> does not need to backtrack.</p>
<p>Decreasing the count of <code class="pattern">\d+</code> can not help to find a match, there's no matter between these two:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code class="language-none">\d+........
(123456789)z

\d+...\d+....
(1234)(56789)z</code></pre>
        </div>
      </div>
      
      </div><p>Let's get back to more real-life example: <code class="pattern">&lt;(\s*\w+=\w+\s*)*&gt;</code>. We want it to find pairs <code>name=value</code> (as many as it can). There's no need in backtracking here.</p>
<p>In other words, if it found many <code>name=value</code> pairs and then can't find <code>&gt;</code>, then there's no need to decrease the count of repetitions. Even if we match one pair less, it won't give us the closing <code>&gt;</code>:</p>
<p>Modern regexp engines support so-called “possessive” quantifiers for that. They are like greedy, but don't backtrack at all. Pretty simple, they capture whatever they can, and the search continues. There's also another tool called “atomic groups” that forbid backtracking inside parentheses.</p>
<p>Unfortunately, but both these features are not supported by JavaScript.</p>
<p>Although we can get a similar affect using lookahead. There's more about the relation between possessive quantifiers and lookahead in articles 
<a href="http://instanceof.me/post/52245507631/regex-emulate-atomic-grouping-with-lookahead">Regex: Emulate Atomic Grouping (and Possessive Quantifiers) with LookAhead</a> and 
<a href="http://blog.stevenlevithan.com/archives/mimic-atomic-groups">Mimicking Atomic Groups</a>.</p>
<p>The pattern to take as much repetitions as possible without backtracking is: <code class="pattern">(?=(a+))\1</code>.</p>
<p>In other words, the lookahead <code class="pattern">?=</code> looks for the maximal count <code class="pattern">a+</code> from the current position. And then they are “consumed into the result” by the backreference <code class="pattern">\1</code>.</p>
<p>There will be no backtracking, because lookahead does not backtrack. If it found like 5 times of <code class="pattern">a+</code> and the further match failed, then it doesn't go back to 4.</p>
<p>Let's fix the regexp for a tag with attributes from the beginning of the chapter<code class="pattern">&lt;\w+(\s*\w+=(\w+|"[^"]*")\s*)*&gt;</code>. We'll use lookahead to prevent backtracking of <code>name=value</code> pairs:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// regexp to search name=value
let attrReg = /(\s*\w+=(\w+|"[^"]*")\s*)/

// use it inside the regexp for tag
let reg = new RegExp('&lt;\\w+(?=(' + attrReg.source + '*))\\1&gt;', 'g');

let good = '...&lt;a test="&lt;&gt;" href="#"&gt;... &lt;b&gt;...';

let bad = `&lt;tag a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b
  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b  a=b`;

alert( good.match(reg) ); // &lt;a test="&lt;&gt;" href="#"&gt;, &lt;b&gt;
alert( bad.match(reg) ); // null (no results, fast!)</code></pre>
        </div>
      </div>
      
      </div><p>Great, it works! We found a long tag  <code class="match">&lt;a test="&lt;&gt;" href="#"&gt;</code> and a small one <code class="match">&lt;b&gt;</code> and didn't hang the engine.</p>
<p>Please note the <code>attrReg.source</code> property. <code>RegExp</code> objects provide access to their source string in it. That's convenient when we want to insert one regexp into another.</p>
<div class="lessons-list"><ol class="lessons-list__lessons"><!-- folders in plain courses--><li class="lessons-list__lesson">
<a href="http://javascript.info/callbacks" class="lessons-list__link">Introduction: callbacks</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/promise-basics" class="lessons-list__link">Promise</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/promise-chaining" class="lessons-list__link">Promises chaining</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/promise-api" class="lessons-list__link">Promise API</a></li><li class="lessons-list__lesson">
<a href="http://javascript.info/async-await" class="lessons-list__link">Async/await</a></li></ol></div>

<h6 id="chapter-936"></h6>
<h1 class="main__header-title" id="chapter-937">Introduction: callbacks</h1>
<p>Many actions in Javascript are <em>asynchronous</em>.</p>
<p>For instance, take a look at the function <code>loadScript(src)</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadScript(src) {
  let script = document.createElement('script');
  script.src = src;
  document.head.append(script);
}</code></pre>
        </div>
      </div>
      
      </div><p>The purpose of the function is to load a new script. When it adds the <code>&lt;script src="…"&gt;</code> to the document, the browser loads and executes it.</p>
<p>We can use it like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// loads and executes the script
loadScript('/my/script.js');</code></pre>
        </div>
      </div>
      
      </div><p>The function is called “asynchronous”, because the action (script loading) finishes not now, but later.</p>
<p>The call initiates the script loading, then the execution continues. While the script is loading, the code below may finish executing, and if the loading takes time, other scripts may run meanwhile too.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript('/my/script.js');
// the code below loadScript doesn't wait for the script loading to finish
// ...</code></pre>
        </div>
      </div>
      
      </div><p>Now let's say we want to use the new script when it loads. It probably declares new functions, so we'd like to run them.</p>
<p>…But if we do that immediately after the <code>loadScript(…)</code> call, that wouldn't work:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript('/my/script.js'); // the script has "function newFunction() {…}"

newFunction(); // no such function!</code></pre>
        </div>
      </div>
      
      </div><p>Naturally, the browser probably didn't have time to load the script. So the immediate call to the new function fails. As of now, <code>loadScript</code> function doesn't provide a way to track the load completion. The script loads and eventually runs, that's all. But we'd like to know when happens, to use new functions and variables from that script.</p>
<p>Let's add a <code>callback</code> function as a second argument to <code>loadScript</code> that should execute when the script loads:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4" data-highlight-inline="0:25-33">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;

  script.onload = () =&gt; callback(script);

  document.head.append(script);
}</code></pre>
        </div>
      </div>
      
      </div><p>Now if we want to call new functions from the script, we should write that in the callback:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript('/my/script.js', function() {
  // the callback runs after the script is loaded
  newFunction(); // so now it works
  ...
});</code></pre>
        </div>
      </div>
      
      </div><p>That's the idea: the second argument is a function (usually anonymous) that runs when the action is completed.</p>
<p>Here's a runnable example with a real script:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;
  script.onload = () =&gt; callback(script);
  document.head.append(script);
}

loadScript('https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js', script =&gt; {
  alert(`Cool, the ${script.src} is loaded`);
  alert( _ ); // function declared in the loaded script
});</code></pre>
        </div>
      </div>
      
      </div><p>That's called a “callback-based” style of asynchronous programming. A function that does something asynchronously should provide a <code>callback</code> argument where we put the function to run after it's complete.</p>
<p>Here we did it in <code>loadScript</code>, but of course it's a general approach.</p>
<h2 id="chapter-938">
Callback in callback</h2>
<p>How to load two scripts sequentially: the first one, and then the second one after it?</p>
<p>The natural solution would be to put the second <code>loadScript</code> call inside the callback, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript('/my/script.js', function(script) {

  alert(`Cool, the ${script.src} is loaded, let's load one more`);

  loadScript('/my/script2.js', function(script) {
    alert(`Cool, the second script is loaded`);
  });

});</code></pre>
        </div>
      </div>
      
      </div><p>After the outer <code>loadScript</code> is complete, the callback initiates the inner one.</p>
<p>…What if we want one more script?</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-6">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript('/my/script.js', function(script) {

  loadScript('/my/script2.js', function(script) {

    loadScript('/my/script3.js', function(script) {
      // ...continue after all scripts are loaded
    });

  })

});</code></pre>
        </div>
      </div>
      
      </div><p>So, every new action is inside a callback. That's fine for few actions, but not good for many, so we'll see other variants soon.</p>
<h2 id="chapter-939">
Handling errors</h2>
<p>In examples above we didn't consider errors. What if the script loading fails? Our callback should be able to react on that.</p>
<p>Here's an improved version of <code>loadScript</code> that tracks loading errors:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;

  script.onload = () =&gt; callback(null, script);
  script.onerror = () =&gt; callback(new Error(`Script load error for ${src}`));

  document.head.append(script);
}</code></pre>
        </div>
      </div>
      
      </div><p>It calls <code>callback(null, script)</code> for successful load and <code>callback(error)</code> otherwise.</p>
<p>The usage:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript('/my/script.js', function(error, script) {
  if (error) {
    // handle error
  } else {
    // script loaded successfully
  }
});</code></pre>
        </div>
      </div>
      
      </div><p>Once again, the recipe that we used for <code>loadScript</code> is actually quite common. It's called the “error-first callback” style.</p>
<p>The convention is:</p>
<ol>
<li>The first argument of <code>callback</code> is reserved for an error if it occurs. Then <code>callback(err)</code> is called.</li>
<li>The second argument (and the next ones if needed) are for the successful result. Then <code>callback(null, result1, result2…)</code> is called.</li>
</ol>
<p>So the single <code>callback</code> function is used both for reporting errors and passing back results.</p>
<h2 id="chapter-940">
Pyramid of doom</h2>
<p>From the first look it's a viable way of asynchronous coding. And indeed it is. For one or maybe two nested calls it looks fine.</p>
<p>But for multiple asynchronous actions that follow one after another we'll have a code like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="15-15">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript('1.js', function(error, script) {

  if (error) {
    handleError(error);
  } else {
    // ...
    loadScript('2.js', function(error, script) {
      if (error) {
        handleError(error);
      } else {
        // ...
        loadScript('3.js', function(error, script) {
          if (error) {
            handleError(error);
          } else {
            // ...continue after all scripts are loaded (*)
          }
        });

      }
    })
  }
});</code></pre>
        </div>
      </div>
      
      </div><p>In the code above:</p>
<ol>
<li>We load <code>1.js</code>, then if there's no error.</li>
<li>We load <code>2.js</code>, then if there's no error.</li>
<li>We load <code>3.js</code>, then if there's no error – do something else <code>(*)</code>.</li>
</ol>
<p>As calls become more nested, the code becomes deeper and increasingly more difficult to manage, especially if we have a real code instead of <code>...</code>, that may include more loops, conditional statements and so on.</p>
<p>That's sometimes called “callback hell” or “pyramid of doom”.</p>
      <img src="http://javascript.info/article/callbacks/callback-hell.png">
<p>The “pyramid” of nested calls grows to the right with every asynchronous action. Soon it spirals out of control.</p>
<p>So this way of coding isn't very good.</p>
<p>We can try to alleviate the problem by making every action a standalone function, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript('1.js', step1);

function step1(error, script) {
  if (error) {
    handleError(error);
  } else {
    // ...
    loadScript('2.js', step2);
  }
}

function step2(error, script) {
  if (error) {
    handleError(error);
  } else {
    // ...
    loadScript('3.js', step3);
  }
}

function step3(error, script) {
  if (error) {
    handleError(error);
  } else {
    // ...continue after all scripts are loaded (*)
  }
};</code></pre>
        </div>
      </div>
      
      </div><p>See? It does the same, and there's no deep nesting now, because we made every action a separate top-level function.</p>
<p>It works, but the code looks like a torn apart spreadsheet. It's difficult to read, you probably noticed that. One needs to eye-jump between pieces while reading it. That's inconvenient, especially the reader is not familiar with the code and doesn't know where to eye-jump.</p>
<p>Also the functions named <code>step*</code> are all of a single use, they are created only to evade the “pyramid of doom”. No one is going to reuse them outside of the action chain. So there's a bit of a namespace cluttering here.</p>
<p>We'd like to have a something better.</p>
<p>Luckily, there are other ways to evade such pyramids. One of the best ways is to use “promises”, described in the next chapter.</p>
<div class="tasks"><h2 id="chapter-941" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#animated-circle-with-callback" name="animated-circle-with-callback" class="main__anchor">Animated circle with callback</a></h3>
<a href="http://javascript.info/task/animate-circle-callback" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>In the task 
<a href="http://javascript.info/task/animate-circle">Animated circle</a> an animated growing circle is shown.</p>
<p>Now let's say we need not just a circle, but to show a message inside it. The message should appear <em>after</em> the animation is complete (the circle is fully grown), otherwise it would look ugly.</p>
<p>In the solution of the task, the function <code>showCircle(cx, cy, radius)</code> draws the circle, but gives no way to track when it's ready.</p>
<p>Add a callback argument: <code>showCircle(cx, cy, radius, callback)</code> to be called when the animation is complete. The <code>callback</code> should receive the circle <code>&lt;div&gt;</code> as an argument.</p>
<p>Here's the example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">showCircle(150, 150, 100, div =&gt; {
  div.classList.add('message-ball');
  div.append("Hello, world!");
});</code></pre>
        </div>
      </div>
      
      </div><p>Demo:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:260px" src="https://en.js.cx/task/animate-circle-callback/solution/"></iframe>
  </div><p>Take the solution of the task 
<a href="http://javascript.info/task/animate-circle">Animated circle</a> as the base.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/AClTwb4Jh6fVXotPgNjb?p=preview" target="_blank" data-plunk-id="AClTwb4Jh6fVXotPgNjb">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

    let script = document.createElement('script');
    script.src = src;

    script.onload = () =&gt; resolve(script);
    script.onerror = () =&gt; reject(new Error("Script load error: " + src));

    document.head.append(script);
  });
}



<h6 id="chapter-942"></h6>
<h1 class="main__header-title" id="chapter-943">Promise</h1>
<p>Imagine that you're a top singer, and fans ask for your next upcoming single day and night.</p>
<p>To get a relief, you promise to send it to them when it's published. You give your fans a list. They can fill in their coordinates, so that when the song becomes available, all subscribed parties instantly get it. And if something goes very wrong, so that the song won't be published ever, then they are also to be notified.</p>
<p>Everyone is happy: you, because the people don't crowd you any more, and fans, because they won't miss the single.</p>
<p>That was a real-life analogy for things we often have in programming:</p>
<ol>
<li>A “producing code” that does something and needs time. For instance, it loads a remote script. That's a “singer”.</li>
<li>A “consuming code” wants the result when it's ready. Many functions may need that result. These are  “fans”.</li>
<li>A <em>promise</em> is a special JavaScript object that links them together. That's a “list”. The producing code creates it and gives to everyone, so that they can subscribe for the result.</li>
</ol>
<p>The analogy isn't very accurate, because JavaScript promises are more complex than a simple list: they have additional features and limitations. But still they are alike.</p>
<p>The constructor syntax for a promise object is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  // executor (the producing code, "singer")
});</code></pre>
        </div>
      </div>
      
      </div><p>The function passed to <code>new Promise</code> is called <em>executor</em>. When the promise is created, it's called automatically. It contains the producing code, that should eventually finish with a result. In terms of the analogy above, the executor is a “singer”.</p>
<p>The resulting <code>promise</code> object has internal properties:</p>
<ul>
<li><code>state</code> – initially is “pending”, then changes to “fulfilled” or “rejected”,</li>
<li><code>result</code> – an arbitrary value, initially <code>undefined</code>.</li>
</ul>
<p>When the executor finishes the job, it should call one of:</p>
<ul>
<li><code>resolve(value)</code> – to indicate that the job finished successfully:
<ul>
<li>sets <code>state</code> to <code>"fulfilled"</code>,</li>
<li>sets <code>result</code> to <code>value</code>.</li>
</ul>
</li>
<li><code>reject(error)</code> – to indicate that an error occurred:
<ul>
<li>sets <code>state</code> to <code>"rejected"</code>,</li>
<li>sets <code>result</code> to <code>error</code>.</li>
</ul>
</li>
</ul>
      <img src="http://javascript.info/article/promise-basics/promise-resolve-reject.png">
<p>Here's a simple executor, to gather that all together:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="7:19-35">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  // the function is executed automatically when the promise is constructed

  alert(resolve); // function () { [native code] }
  alert(reject);  // function () { [native code] }

  // after 1 second signal that the job is done with the result "done!"
  setTimeout(() =&gt; resolve("done!"), 1000);
});</code></pre>
        </div>
      </div>
      
      </div><p>We can see two things by running the code above:</p>
<ol>
<li>The executor is called automatically and immediately (by <code>new Promise</code>).</li>
<li>The executor receives two arguments: <code>resolve</code> and <code>reject</code> – these functions come from JavaScript engine. We don't need to create them. Instead the executor should call them when ready.</li>
</ol>
<p>After one second of thinking the executor calls <code>resolve("done")</code> to produce the result:</p>
      <img src="http://javascript.info/article/promise-basics/promise-resolve-1.png">
<p>That was an example of the “successful job completion”.</p>
<p>And now an example where the executor rejects promise with an error:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:19-47">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  // after 1 second signal that the job is finished with an error
  setTimeout(() =&gt; reject(new Error("Whoops!")), 1000);
});</code></pre>
        </div>
      </div>
      
      </div>rc="http://javascript.info/article/promise-basics/promise-reject-1.png"&gt;
<p>To summarize, the executor should do a job (something that takes time usually) and then call <code>resolve</code> or <code>reject</code> to change the state of the corresponding promise object.</p>
<p>The promise that is either resolved or rejected is called “settled”, as opposed to a “pending” promise.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">There can be only one result or an error</span></div>
            <div class="important__content"><p>The executor should call only one <code>resolve</code> or <code>reject</code>. The promise state change is final.</p>
<p>All further calls of <code>resolve</code> and <code>reject</code> are ignored:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  resolve("done");

  reject(new Error("…")); // ignored
  setTimeout(() =&gt; resolve("…")); // ignored
});</code></pre>
        </div>
      </div>
      
      </div><p>The idea is that a job done by the executor may have only one result or an error. In programming, there exist other data structures that allow many “flowing” results, for instance streams and queues. They have their own advantages and disadvantages versus promises. They are not supported by JavaScript core and lack certain language features that promises provide, we don't cover them here to concentrate on promises.</p>
<p>Also if we call <code>resolve/reject</code> with more then one argument – only the first argument is used, the next ones are ignored.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Reject with <code>Error</code> objects</span></div>
            <div class="important__content"><p>Technically we can call <code>reject</code> (just like <code>resolve</code>) with any type of argument. But it's recommended to use <code>Error</code> objects in <code>reject</code> (or inherit from them). The reasoning for that will become obvious soon.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Resolve/reject can be immediate</span></div>
            <div class="important__content"><p>In practice an executor usually does something asynchronously and calls <code>resolve/reject</code> after some time, but it doesn't have to. We can call <code>resolve</code> or <code>reject</code> immediately, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  resolve(123); // immediately give the result: 123
});</code></pre>
        </div>
      </div>
      
      </div><p>For instance, it happens when we start to do a job and then see that everything has already been done. Technically that's fine: we have a resolved promise right now.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The <code>state</code> and <code>result</code> are internal</span></div>
            <div class="important__content"><p>Properties <code>state</code> and <code>result</code> of a promise object are internal. We can't directly access them from our code, but we can use methods <code>.then/catch</code> for that, they are described below.</p>
</div></div>
<h2 id="chapter-944">
Consumers: “.then” and “.catch”</h2>
<p>A promise object serves as a link between the producing code (executor) and the consuming functions – those that want to receive the result/error. Consuming functions can be registered using methods <code>promise.then</code> and <code>promise.catch</code>.</p>
<p>The syntax of <code>.then</code> is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">promise.then(
  function(result) { /* handle a successful result */ },
  function(error) { /* handle an error */ }
);</code></pre>
        </div>
      </div>
      
      </div><p>The first function argument runs when the promise is resolved and gets the result, and the second one – when it's rejected and gets the error.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  setTimeout(() =&gt; resolve("done!"), 1000);
});

// resolve runs the first function in .then
promise.then(
  result =&gt; alert(result), // shows "done!" after 1 second
  error =&gt; alert(error) // doesn't run
);</code></pre>
        </div>
      </div>
      
      </div><p>In case of a rejection:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  setTimeout(() =&gt; reject(new Error("Whoops!")), 1000);
});

// reject runs the second function in .then
promise.then(
  result =&gt; alert(result), // doesn't run
  error =&gt; alert(error) // shows "Error: Whoops!" after 1 second
);</code></pre>
        </div>
      </div>
      
      </div><p>If we're interested only in successful completions, then we can provide only one argument to <code>.then</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(resolve =&gt; {
  setTimeout(() =&gt; resolve("done!"), 1000);
});

promise.then(alert); // shows "done!" after 1 second</code></pre>
        </div>
      </div>
      
      </div><p>If we're interested only in errors, then we can use <code>.then(null, function)</code> or an “alias” to it: <code>.catch(function)</code></p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; reject(new Error("Whoops!")), 1000);
});

// .catch(f) is the same as promise.then(null, f)
promise.catch(alert); // shows "Error: Whoops!" after 1 second</code></pre>
        </div>
      </div>
      
      </div><p>The call <code>.catch(f)</code> is a complete analog of <code>.then(null, f)</code>, it's just a shorthand.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">On settled promises <code>then</code> runs immediately</span></div>
            <div class="important__content"><p>If a promise is pending, <code>.then/catch</code> handlers wait for the result. Otherwise, if a promise has already settled, they execute immediately:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// an immediately resolved promise
let promise = new Promise(resolve =&gt; resolve("done!"));

promise.then(alert); // done! (shows up right now)</code></pre>
        </div>
      </div>
      
      </div><p>That's handy for jobs that may sometimes require time and sometimes finish immediately. The handler is guaranteed to run in both cases.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Handlers of <code>.then/catch</code> are always asynchronous</span></div>
            <div class="important__content"><p>To be even more precise, when <code>.then/catch</code> handler should execute, it first gets into an internal queue. The JavaScript engine takes handlers from the queue and executes when the current code finishes, similar to <code>setTimeout(..., 0)</code>.</p>
<p>In other words, when <code>.then(handler)</code> is going to trigger, it does something like <code>setTimeout(handler, 0)</code> instead.</p>
<p>In the example below the promise is immediately resolved, so <code>.then(alert)</code> triggers right now: the <code>alert</code> call is queued and runs immediately after the code finishes.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// an immediately resolved promise
let promise = new Promise(resolve =&gt; resolve("done!"));

promise.then(alert); // done! (right after the current code finishes)

alert("code finished"); // this alert shows first</code></pre>
        </div>
      </div>
      
      </div><p>So the code after <code>.then</code> always executes before the handler (even in the case of a pre-resolved promise). Usually that's unimportant, in some scenarios may matter.</p>
</div></div>
<p>Now let's see more practical examples how promises can help us in writing asynchronous code.</p>
<h2 id="chapter-945">
Example: loadScript</h2>
<p>We've got the <code>loadScript</code> function for loading a script from the previous chapter.</p>
<p>Here's the callback-based variant, just to remind it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;

  script.onload = () =&gt; callback(null, script);
  script.onerror = () =&gt; callback(new Error(`Script load error ` + src));

  document.head.append(script);
}</code></pre>
        </div>
      </div>
      
      </div><p>Let's rewrite it using promises.</p>
<p>The new function <code>loadScript</code> will not require a callback. Instead it will create and return a promise object that settles when the loading is complete. The outer code can add handlers to it using <code>.then</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadScript(src) {
  return new Promise(function(resolve, reject) {
    let script = document.createElement('script');
    script.src = src;

    script.onload = () =&gt; resolve(script);
    script.onerror = () =&gt; reject(new Error("Script load error: " + src));

    document.head.append(script);
  });
}</code></pre>
        </div>
      </div>
      
      </div><p>Usage:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = loadScript("https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js");

promise.then(
  script =&gt; alert(`${script.src} is loaded!`),
  error =&gt; alert(`Error: ${error.message}`)
);

promise.then(script =&gt; alert('One more handler to do something else!'));</code></pre>
        </div>
      </div>
      
      </div><p>We can immediately see few benefits over the callback-based syntax:</p>
<div class="balance"><div class="balance__minuses">
      <div class="balance__content">
      <div class="balance__title">Callbacks</div><ul class="balance__list"><li>We must have a ready <code>callback</code> function when calling <code>loadScript</code>. In other words, we must know what to do with the result <em>before</em> <code>loadScript</code> is called.</li>
<li>There can be only one callback.</li>
</ul></div></div><div class="balance__pluses">
      <div class="balance__content">
      <div class="balance__title">Promises</div><ul class="balance__list"><li>Promises allow us to code things in the natural order. First we run <code>loadScript</code>, and <code>.then</code> write what to do with the result.</li>
<li>We can call <code>.then</code> on a promise as many times as we want, at any time later.</li>
</ul></div></div></div><p>So promises already give us better code flow and flexibility. But there's more. We'll see that in the next chapters.</p>
<div class="tasks"><h2 id="chapter-946" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#re-resolve-a-promise" name="re-resolve-a-promise" class="main__anchor">Re-resolve a promise?</a></h3>
<a href="http://javascript.info/task/re-resolve" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>What's the output of the code below?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  resolve(1);

  setTimeout(() =&gt; resolve(2), 1000);
});

promise.then(alert);</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The output is: <code>1</code>.</p>
<p>The second call to <code>resolve</code> is ignored, because only the first call of <code>reject/resolve</code> is taken into account. Further calls are ignored.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#delay-with-a-promise" name="delay-with-a-promise" class="main__anchor">Delay with a promise</a></h3>
<a href="http://javascript.info/task/delay-promise" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>The built-in function <code>setTimeout</code> uses callbacks. Create a promise-based alternative.</p>
<p>The function <code>delay(ms)</code> should return a promise. That promise should resolve after <code>ms</code> milliseconds, so that we can add <code>.then</code> to it, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function delay(ms) {
  // your code
}

delay(3000).then(() =&gt; alert('runs after 3 seconds'));</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function delay(ms) {
  return new Promise(resolve =&gt; setTimeout(resolve, ms));
}

delay(3000).then(() =&gt; alert('runs after 3 seconds'));</code></pre>
        </div>
      </div>
      
      </div><p>Please note that in this task <code>resolve</code> is called without arguments. We don't return any value from <code>delay</code>, just ensure the delay.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#animated-circle-with-promise" name="animated-circle-with-promise" class="main__anchor">Animated circle with promise</a></h3>
<a href="http://javascript.info/task/animate-circle-promise" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Rewrite the <code>showCircle</code> function in the solution of the task 
<a href="http://javascript.info/task/animate-circle-callback">Animated circle with callback</a> so that it returns a promise instead of accepting a callback.</p>
<p>The new usage:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">showCircle(150, 150, 100).then(div =&gt; {
  div.classList.add('message-ball');
  div.append("Hello, world!");
});</code></pre>
        </div>
      </div>
      
      </div><p>Take the solution of the task 
<a href="http://javascript.info/task/animate-circle-callback">Animated circle with callback</a> as the base.</p>

<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/cVyV23alKuniDUlqAGO5?p=preview" target="_blank" data-plunk-id="cVyV23alKuniDUlqAGO5">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

    let script = document.createElement('script');
    script.src = src;

    script.onload = () =&gt; resolve(script);
    script.onerror = () =&gt; reject(new Error("Script load error: " + src));

    document.head.append(script);
  });
}

class HttpError extends Error {
  constructor(response) {
    super(`${response.status} for ${response.url}`);
    this.name = 'HttpError';
    this.response = response;
  }
}

function loadJson(url) {
  return fetch(url)
    .then(response =&gt; {
      if (response.status == 200) {
        return response.json();
      } else {
        throw new HttpError(response);
      }
    })
}


<style>
.promise-avatar-example {
  border-radius: 50%;
  position: fixed;
  left: 10px;
  top: 10px;
}
</style>


<h6 id="chapter-947"></h6>
<h1 class="main__header-title" id="chapter-948">Promises chaining</h1>
<p>Let's return to the problem mentioned in the chapter 
<a href="http://javascript.info/callbacks">Introduction: callbacks</a>.</p>
<ul>
<li>We have a sequence of asynchronous tasks to be done one after another. For instance, loading scripts.</li>
<li>How to code it well?</li>
</ul>
<p>Promises provide a couple of recipes to do that.</p>


<p>In this chapter we cover promise chaining.</p>
<p>It looks like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {

  setTimeout(() =&gt; resolve(1), 1000); // (*)

}).then(function(result) { // (**)

  alert(result); // 1
  return result * 2;

}).then(function(result) { // (***)

  alert(result); // 2
  return result * 2;

}).then(function(result) {

  alert(result); // 4
  return result * 2;

});</code></pre>
        </div>
      </div>
      
      </div><p>The idea is that the result is passed through the chain of <code>.then</code> handlers.</p>
<p>Here the flow is:</p>
<ol>
<li>The initial promise resolves in 1 second <code>(*)</code>,</li>
<li>Then the <code>.then</code> handler is called <code>(**)</code>.</li>
<li>The value that it returns is passed to the next <code>.then</code> handler <code>(***)</code></li>
<li>…and so on.</li>
</ol>
<p>As the result is passed along the chain of handlers, we can see a sequence of <code>alert</code> calls: <code>1</code> → <code>2</code> → <code>4</code>.</p>
      <img src="http://javascript.info/article/promise-chaining/promise-then-chain.png">
<p>The whole thing works, because a call to <code>promise.then</code> returns a promise, so that we can call the next <code>.then</code> on it.</p>
<p>When a handler returns a value, it becomes the result of that promise, so the next <code>.then</code> is called with it.</p>
<p>To make these words more clear, here's the start of the chain:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {

  setTimeout(() =&gt; resolve(1), 1000);

}).then(function(result) {

  alert(result);
  return result * 2; // &lt;-- (1)

}) // &lt;-- (2)
// .then…</code></pre>
        </div>
      </div>
      
      </div><p>The value returned by <code>.then</code> is a promise, that's why we are able to add another <code>.then</code> at <code>(2)</code>. When the value is returned in <code>(1)</code>, that promise becomes resolved, so the next handler runs with the value.</p>
<p>Unlike the chaining, technically we can also add many <code>.then</code> to a single promise, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  setTimeout(() =&gt; resolve(1), 1000);
});

promise.then(function(result) {
  alert(result); // 1
  return result * 2;
});

promise.then(function(result) {
  alert(result); // 1
  return result * 2;
});

promise.then(function(result) {
  alert(result); // 1
  return result * 2;
});</code></pre>
        </div>
      </div>
      
      </div><p>…But that's a totally different thing. Here's the picture (compare it with the chaining above):</p>
      <img src="http://javascript.info/article/promise-chaining/promise-then-many.png">
<p>All <code>.then</code> on the same promise get the same result – the result of that promise. So in the code above all <code>alert</code> show the same: <code>1</code>. There is no result-passing between them.</p>
<p>In practice we rarely need multiple handlers for one promise. Chaining is used much more often.</p>
<h2 id="chapter-949">
Returning promises</h2>
<p>Normally, a value returned by a <code>.then</code> handler is immediately passed to the next handler. But there's an exception.</p>
<p>If the returned value is a promise, then the further execution is suspended until it settles. After that, the result of that promise is given to the next <code>.then</code> handler.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-10">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {

  setTimeout(() =&gt; resolve(1), 1000);

}).then(function(result) {

  alert(result); // 1

  return new Promise((resolve, reject) =&gt; { // (*)
    setTimeout(() =&gt; resolve(result * 2), 1000);
  });

}).then(function(result) { // (**)

  alert(result); // 2

  return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; resolve(result * 2), 1000);
  });

}).then(function(result) {

  alert(result); // 4

});</code></pre>
        </div>
      </div>
      
      </div><p>Here the first <code>.then</code> shows <code>1</code> returns <code>new Promise(…)</code> in the line <code>(*)</code>. After one second it resolves, and the result (the argument of <code>resolve</code>, here it's <code>result*2</code>) is passed on to handler of the second <code>.then</code> in the line <code>(**)</code>. It shows <code>2</code> and does the same thing.</p>
<p>So the output is again 1 → 2 &gt; 4, but now with 1 second delay between <code>alert</code> calls.</p>
<p>Returning promises allows us to build chains of asynchronous actions.</p>
<h2 id="chapter-950">
Example: loadScript</h2>
<p>Let's use this feature with <code>loadScript</code> to load scripts one by one, in sequence:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript("/article/promise-chaining/one.js")
  .then(function(script) {
    return loadScript("/article/promise-chaining/two.js");
  })
  .then(function(script) {
    return loadScript("/article/promise-chaining/three.js");
  })
  .then(function(script) {
    // use functions declared in scripts
    // to show that they indeed loaded
    one();
    two();
    three();
  });</code></pre>
        </div>
      </div>
      
      </div><p>Here each <code>loadScript</code> call returns a promise, and the next <code>.then</code> runs when it resolves. Then it initiates the loading of the next script. So scripts are loaded one after another.</p>
<p>We can add more asynchronous actions to the chain. Please note that code is still “flat”, it grows down, not to the right. There are no signs of “pyramid of doom”.</p>
<p>Please note that technically it is also possible to write <code>.then</code> directly after each promise, without returning them, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">loadScript("/article/promise-chaining/one.js").then(function(script1) {
  loadScript("/article/promise-chaining/two.js").then(function(script2) {
    loadScript("/article/promise-chaining/three.js").then(function(script3) {
      // this function has access to variables script1, script2 and script3
      one();
      two();
      three();
    });
  });
});</code></pre>
        </div>
      </div>
      
      </div><p>This code does the same: loads 3 scripts in sequence. But it “grows to the right”. So we have the same problem as with callbacks. Use chaining (return promises from <code>.then</code>) to evade it.</p>
<p>Sometimes it's ok to write <code>.then</code> directly, because the nested function has access to the outer scope (here the most nested callback has access to all variables <code>scriptX</code>), but that's an exception rather than a rule.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Thenables</span></div>
            <div class="important__content"><p>To be precise, <code>.then</code> may return an arbitrary “thenable” object, and it will be treated the same way as a promise.</p>
<p>A “thenable” object is any object with a method <code>.then</code>.</p>
<p>The idea is that 3rd-party libraries may implement “promise-compatible” objects of their own. They can have extended set of methods, but also be compatible with native promises, because they implement <code>.then</code>.</p>
<p>Here's an example of a thenable object:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Thenable {
  constructor(num) {
    this.num = num;
  }
  then(resolve, reject) {
    alert(resolve); // function() { native code }
    // resolve with this.num*2 after the 1 second
    setTimeout(() =&gt; resolve(this.num * 2), 1000); // (**)
  }
}

new Promise(resolve =&gt; resolve(1))
  .then(result =&gt; {
    return new Thenable(result); // (*)
  })
  .then(alert); // shows 2 after 1000ms</code></pre>
        </div>
      </div>
      
      </div><p>JavaScript checks the object returned by <code>.then</code> handler in the line <code>(*)</code>: if it has a callable method named <code>then</code>, then it calls that method providing native functions <code>resolve</code>, <code>reject</code> as arguments (similar to executor) and waits until one of them is called. In the example above <code>resolve(2)</code> is called after 1 second <code>(**)</code>. Then the result is passed further down the chain.</p>
<p>This feature allows to integrate custom objects with promise chains without having to inherit from <code>Promise</code>.</p>
</div></div>
<h2 id="chapter-951">
Bigger example: fetch</h2>
<p>In frontend programming promises are often used for network requests. So let's see an extended example of that.</p>
<p>We'll use the 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch">fetch</a> method to load the information about the user from the remote server. The method is quite complex, it has many optional parameters, but the basic usage is quite simple:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = fetch(url);</code></pre>
        </div>
      </div>
      
      </div><p>This makes a network request to the <code>url</code> and returns a promise. The promise resolves with a <code>response</code> object when the remote server responds with headers, but <em>before the full response is downloaded</em>.</p>
<p>To read the full response, we should call a method <code>response.text()</code>: it returns a promise that resolves  when the full text downloaded from the remote server, with that text as a result.</p>
<p>The code below makes a request to <code>user.json</code> and loads its text from the server:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fetch('/article/promise-chaining/user.json')
  // .then below runs when the remote server responds
  .then(function(response) {
    // response.text() returns a new promise that resolves with the full response text
    // when we finish downloading it
    return response.text();
  })
  .then(function(text) {
    // ...and here's the content of the remote file
    alert(text); // {"name": "iliakan", isAdmin: true}
  });</code></pre>
        </div>
      </div>
      
      </div><p>There is also a method <code>response.json()</code> that reads the remote data and parses it as JSON. In our case that's even more convenient, so let's switch to it.</p>
<p>We'll also use arrow functions for brevity:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// same as above, but response.json() parses the remote content as JSON
fetch('/article/promise-chaining/user.json')
  .then(response =&gt; response.json())
  .then(user =&gt; alert(user.name)); // iliakan</code></pre>
        </div>
      </div>
      
      </div><p>Now let's do something with the loaded user.</p>
<p>For instance, we can make one more request to github, load the user profile and show the avatar:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// Make a request for user.json
fetch('/article/promise-chaining/user.json')
  // Load it as json
  .then(response =&gt; response.json())
  // Make a request to github
  .then(user =&gt; fetch(`https://api.github.com/users/${user.name}`))
  // Load the response as json
  .then(response =&gt; response.json())
  // Show the avatar image (githubUser.avatar_url) for 3 seconds (maybe animate it)
  .then(githubUser =&gt; {
    let img = document.createElement('img');
    img.src = githubUser.avatar_url;
    img.className = "promise-avatar-example";
    document.body.append(img);

    setTimeout(() =&gt; img.remove(), 3000); // (*)
  });</code></pre>
        </div>
      </div>
      
      </div><p>The code works, see comments about the details, but it should be quite self-descriptive. Although, there's a potential problem in it, a typical error of those who begin to use promises.</p>
<p>Look at the line <code>(*)</code>: how can we do something <em>after</em> the avatar has finished showing and gets removed? For instance, we'd like to show a form for editing that user or something else. As of now, there's no way.</p>
<p>To make the chain extendable, we need to return a promise that resolves when the avatar finishes showing.</p>
<p>Like this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4,12-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fetch('/article/promise-chaining/user.json')
  .then(response =&gt; response.json())
  .then(user =&gt; fetch(`https://api.github.com/users/${user.name}`))
  .then(response =&gt; response.json())
  .then(githubUser =&gt; new Promise(function(resolve, reject) {
    let img = document.createElement('img');
    img.src = githubUser.avatar_url;
    img.className = "promise-avatar-example";
    document.body.append(img);

    setTimeout(() =&gt; {
      img.remove();
      resolve(githubUser);
    }, 3000);
  }))
  // triggers after 3 seconds
  .then(githubUser =&gt; alert(`Finished showing ${githubUser.name}`));</code></pre>
        </div>
      </div>
      
      </div><p>Now right after <code>setTimeout</code> runs <code>img.remove()</code>, it calls <code>resolve(githubUser)</code>, thus passing the control to the next <code>.then</code> in the chain and passing forward the user data.</p>
<p>As a rule, an asynchronous action should always return a promise.</p>
<p>That makes possible to plan actions after it. Even if we don't plan to extend the chain now, we may need it later.</p>
<p>Finally, we can split the code into reusable functions:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadJson(url) {
  return fetch(url)
    .then(response =&gt; response.json());
}

function loadGithubUser(name) {
  return fetch(`https://api.github.com/users/${name}`)
    .then(response =&gt; response.json());
}

function showAvatar(githubUser) {
  return new Promise(function(resolve, reject) {
    let img = document.createElement('img');
    img.src = githubUser.avatar_url;
    img.className = "promise-avatar-example";
    document.body.append(img);

    setTimeout(() =&gt; {
      img.remove();
      resolve(githubUser);
    }, 3000);
  });
}

// Use them:
loadJson('/article/promise-chaining/user.json')
  .then(user =&gt; loadGithubUser(user.name))
  .then(showAvatar)
  .then(githubUser =&gt; alert(`Finished showing ${githubUser.name}`));
  // ...</code></pre>
        </div>
      </div>
      
      </div><h2 id="chapter-952">
Error handling</h2>
<p>Asynchronous actions may sometimes fail: in case of an error the corresponding promise becomes rejected. For instance, <code>fetch</code> fails if the remote server is not available. We can use <code>.catch</code> to handle errors (rejections).</p>
<p>Promise chaining is great at that aspect. When a promise rejects, the control jumps to the closest rejection handler down the chain. That's very convenient in practice.</p>
<p>For instance, in the code below the URL is wrong (no such server) and <code>.catch</code> handles the error:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-0">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fetch('https://no-such-server.blabla') // rejects
  .then(response =&gt; response.json())
  .catch(err =&gt; alert(err)) // TypeError: failed to fetch (the text may vary)</code></pre>
        </div>
      </div>
      
      </div><p>Or, maybe, everything is all right with the server, but the response is not a valid JSON:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fetch('/') // fetch works fine now, the server responds successfully
  .then(response =&gt; response.json()) // rejects: the page is HTML, not a valid json
  .catch(err =&gt; alert(err)) // SyntaxError: Unexpected token &lt; in JSON at position 0</code></pre>
        </div>
      </div>
      
      </div><p>In the example below we append <code>.catch</code> to handle all errors in the avatar-loading-and-showing chain:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fetch('/article/promise-chaining/user.json')
  .then(response =&gt; response.json())
  .then(user =&gt; fetch(`https://api.github.com/users/${user.name}`))
  .then(response =&gt; response.json())
  .then(githubUser =&gt; new Promise(function(resolve, reject) {
    let img = document.createElement('img');
    img.src = githubUser.avatar_url;
    img.className = "promise-avatar-example";
    document.body.append(img);

    setTimeout(() =&gt; {
      img.remove();
      resolve(githubUser);
    }, 3000);
  }))
  .catch(error =&gt; alert(error.message));</code></pre>
        </div>
      </div>
      
      </div><p>Here <code>.catch</code> doesn't trigger at all, because there are no errors. But if any of the promises above rejects, then it would execute.</p>
<h2 id="chapter-953">
Implicit try…catch</h2>
<p>The code of the executor and promise handlers has an "invisible <code>try..catch</code>" around it. If an error happens, it gets caught and treated as a rejection.</p>
<p>For instance, this code:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {
  throw new Error("Whoops!");
}).catch(alert); // Error: Whoops!</code></pre>
        </div>
      </div>
      
      </div><p>…Works the same way as this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {
  reject(new Error("Whoops!"));
}).catch(alert); // Error: Whoops!</code></pre>
        </div>
      </div>
      
      </div><p>The "invisible <code>try..catch</code>" around the executor automatically catches the error and treats it as a rejection.</p>
<p>That's so not only in the executor, but in handlers as well. If we <code>throw</code> inside <code>.then</code> handler, that means a rejected promise, so the control jumps to the nearest error handler.</p>
<p>Here's an example:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {
  resolve("ok");
}).then(function(result) {
  throw new Error("Whoops!"); // rejects the promise
}).catch(alert); // Error: Whoops!</code></pre>
        </div>
      </div>
      
      </div><p>That's so not only for <code>throw</code>, but for any errors, including programming errors as well:</p>
<div data-trusted="1" class="code-example" data-highlight-block="3-3">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {
  resolve("ok");
}).then(function(result) {
  blabla(); // no such function
}).catch(alert); // ReferenceError: blabla is not defined</code></pre>
        </div>
      </div>
      
      </div><p>As a side effect, the final <code>.catch</code> not only catches explicit rejections, but also occasional errors in the handlers above.</p>
<h2 id="chapter-954">
Rethrowing</h2>
<p>As we already noticed, <code>.catch</code> behaves like <code>try..catch</code>. We may have as many <code>.then</code> as we want, and then use a single <code>.catch</code> at the end to handle errors in all of them.</p>
<p>In a regular <code>try..catch</code> we can analyze the error and maybe rethrow it if can't handle. The same thing is possible for promises. If we <code>throw</code> inside <code>.catch</code>, then the control goes to the next closest error handler. And if we handle the error and finish normally, then it continues to the closest successful <code>.then</code> handler.</p>
<p>In the example below the <code>.catch</code> successfully handles the error:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// the execution: catch -&gt; then
new Promise(function(resolve, reject) {

  throw new Error("Whoops!");

}).catch(function(error) {

  alert("The error is handled, continue normally");

}).then(() =&gt; alert("Next successful handler runs"));</code></pre>
        </div>
      </div>
      
      </div><p>Here the <code>.catch</code> block finishes normally. So the next successful handler is called. Or it could return something, that would be the same.</p>
<p>…And here the <code>.catch</code> block analyzes the error and throws it again:</p>
<div data-trusted="1" class="code-example" data-highlight-block="12-12">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// the execution: catch -&gt; catch -&gt; then
new Promise(function(resolve, reject) {

  throw new Error("Whoops!");

}).catch(function(error) { // (*)

  if (error instanceof URIError) {
    // handle it
  } else {
    alert("Can't handle such error");

    throw error; // throwing this or another error jumps to the next catch
  }

}).then(function() {
  /* never runs here */
}).catch(error =&gt; { // (**)

  alert(`The unknown error has occurred: ${error}`);
  // don't return anything =&gt; execution goes the normal way

});</code></pre>
        </div>
      </div>
      
      </div><p>The handler <code>(*)</code> catches the error and just can't handle it, because it's not <code>URIError</code>, so it throws it again. Then the execution jumps to the next <code>.catch</code> down the chain <code>(**)</code>.</p>
<p>In the section below we'll see a practical example of rethrowing.</p>
<h2 id="chapter-955">
Fetch error handling example</h2>
<p>Let's improve error handling for the user-loading example.</p>
<p>The promise returned by 
<a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch">fetch</a> rejects when it's impossible to make a request. For instance, a remote server is not available, or the URL is malformed. But if the remote server responds with error 404, or even error 500, then it's considered a valid response.</p>
<p>What if the server returns a non-JSON page with error 500 in the line <code>(*)</code>? What if there's no such user, and github returns a page with error 404 at <code>(**)</code>?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">fetch('no-such-user.json') // (*)
  .then(response =&gt; response.json())
  .then(user =&gt; fetch(`https://api.github.com/users/${user.name}`)) // (**)
  .then(response =&gt; response.json())
  .catch(alert); // SyntaxError: Unexpected token &lt; in JSON at position 0
  // ...</code></pre>
        </div>
      </div>
      
      </div><p>As of now, the code tries to load the response as JSON no matter what and dies with a syntax error. You can see that by running the example above, as the file <code>no-such-user.json</code> doesn't exist.</p>
<p>That's not good, because the error just falls through the chain, without details: what failed and where.</p>
<p>So let's add one more step: we should check the <code>response.status</code> property that has HTTP status, and if it's not 200, then throw an error.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class HttpError extends Error { // (1)
  constructor(response) {
    super(`${response.status} for ${response.url}`);
    this.name = 'HttpError';
    this.response = response;
  }
}

function loadJson(url) { // (2)
  return fetch(url)
    .then(response =&gt; {
      if (response.status == 200) {
        return response.json();
      } else {
        throw new HttpError(response);
      }
    })
}

loadJson('no-such-user.json') // (3)
  .catch(alert); // HttpError: 404 for .../no-such-user.json</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>We make a custom class for HTTP Errors to distinguish them from other types of errors. Besides, the new class has a constructor that accepts the <code>response</code> object and saves it in the error. So error-handling code will be able to access it.</li>
<li>Then we put together the requesting and error-handling code into a function that fetches the <code>url</code> <em>and</em> treats any non-200 status as an error. That's convenient, because we often need such logic.</li>
<li>Now <code>alert</code> shows better message.</li>
</ol>
<p>The great thing about having our own class for errors is that we can easily check for it in error-handling code.</p>
<p>For instance, we can make a request, and then if we get 404 – ask the user to modify the information.</p>
<p>The code below loads a user with the given name from github. If there's no such user, then it asks for the correct name:</p>
<div data-trusted="1" class="code-example" data-highlight-block="9-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function demoGithubUser() {
  let name = prompt("Enter a name?", "iliakan");

  return loadJson(`https://api.github.com/users/${name}`)
    .then(user =&gt; {
      alert(`Full name: ${user.name}.`); // (1)
      return user;
    })
    .catch(err =&gt; {
      if (err instanceof HttpError &amp;&amp; err.response.status == 404) { // (2)
        alert("No such user, please reenter.");
        return demoGithubUser();
      } else {
        throw err;
      }
    });
}

demoGithubUser();</code></pre>
        </div>
      </div>
      
      </div><p>Here:</p>
<ol>
<li>If <code>loadJson</code> returns a valid user object, then the name is shown <code>(1)</code>, and the user is returned, so that we can add more user-related actions to the chain. In that case the <code>.catch</code> below is ignored, everything's very simple and fine.</li>
<li>Otherwise, in case of an error, we check it in the line <code>(2)</code>. Only if it's indeed the HTTP error, and the status is 404 (Not found), we ask the user to reenter. For other errors – we don't know how to handle, so we just rethrow them.</li>
</ol>
<h2 id="chapter-956">
Unhandled rejections</h2>
<p>What happens when an error is not handled? For instance, after the rethrow as in the example above. Or if we forget to append an error handler to the end of the chain, like here:</p>
<div data-trusted="0" class="code-example" data-refresh="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function() {
  noSuchFunction(); // Error here (no such function)
}); // no .catch attached</code></pre>
        </div>
      </div>
      
      </div><p>Or here:</p>
<div data-trusted="0" class="code-example" data-refresh="1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// a chain of promises without .catch at the end
new Promise(function() {
  throw new Error("Whoops!");
}).then(function() {
  // ...something...
}).then(function() {
  // ...something else...
}).then(function() {
  // ...but no catch after it!
});</code></pre>
        </div>
      </div>
      
      </div><p>In case of an error, the promise state becomes “rejected”, and the execution should jump to the closest rejection handler. But there is no such handler in the examples above. So the error gets “stuck”.</p>
<p>In practice, that's usually because of the bad code. Indeed, how come that there's no error handling?</p>
<p>Most JavaScript engines track such situations and generate a global error in that case. We can see it in the console.</p>
<p>In the browser we can catch it using the event <code>unhandledrejection</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="0-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.addEventListener('unhandledrejection', function(event) {
  // the event object has two special properties:
  alert(event.promise); // [object Promise] - the promise that generated the error
  alert(event.reason); // Error: Whoops! - the unhandled error object
});

new Promise(function() {
  throw new Error("Whoops!");
}); // no catch to handle the error</code></pre>
        </div>
      </div>
      
      </div><p>The event is the part of the 
<a href="https://html.spec.whatwg.org/multipage/webappapis.html#unhandled-promise-rejections">HTML standard</a>. Now if an error occurs, and there's no <code>.catch</code>, the <code>unhandledrejection</code> handler triggers: the <code>event</code> object has the information about the error, so we can do something with it.</p>
<p>Usually such errors are unrecoverable, so our best way out is to inform the user about the problem and probably report about the incident to the server.</p>
<p>In non-browser environments like Node.JS there are other similar ways to track unhandled errors.</p>
<h2 id="chapter-957">
Summary</h2>
<p>To summarize, <code>.then/catch(handler)</code> returns a new promise that changes depending on what handler does:</p>
<ol>
<li>If it returns a value or finishes without a <code>return</code> (same as <code>return undefined</code>), then the new promise becomes resolved, and the closest resolve handler (the first argument of <code>.then</code>) is called with that value.</li>
<li>If it throws an error, then the new promise becomes rejected, and the closest rejection handler (second argument of <code>.then</code> or <code>.catch</code>) is called with it.</li>
<li>If it returns a promise, then JavaScript waits until it settles and then acts on its outcome the same way.</li>
</ol>
<p>The picture of how the promise returned by <code>.then/catch</code> changes:</p>
      <img src="http://javascript.info/article/promise-chaining/promise-handler-variants.png">
<p>The smaller picture of how handlers are called:</p>
      <img src="http://javascript.info/article/promise-chaining/promise-handler-variants-2.png">
<p>In the examples of error handling above the <code>.catch</code> was always the last in the chain. In practice though, not every promise chain has a <code>.catch</code>. Just like regular code is not always wrapped in <code>try..catch</code>.</p>
<p>We should place <code>.catch</code> exactly in the places where we want to handle errors and know how to handle them. Using custom error classes can help to analyze errors and rethrow those that we can't handle.</p>
<p>For errors that fall outside of our scope we should have the <code>unhandledrejection</code> event handler (for browsers, and analogs for other environments). Such unknown errors are usually unrecoverable, so all we should do is to inform the user and probably report to our server about the incident.</p>
<div class="tasks"><h2 id="chapter-958" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#promise-then-versus-catch" name="promise-then-versus-catch" class="main__anchor">Promise: then versus catch</a></h3>
<a href="http://javascript.info/task/then-vs-catch" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Are these code fragments equal? In other words, do they behave the same way in any circumstances, for any handler functions?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">promise.then(f1, f2);</code></pre>
        </div>
      </div>
      
      </div><p>Versus;</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">promise.then(f1).catch(f2);</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The short answer is: <strong>no, they are not the equal</strong>:</p>
<p>The difference is that if an error happens in <code>f1</code>, then it is handled by <code>.catch</code> here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">promise
  .then(f1)
  .catch(f2);</code></pre>
        </div>
      </div>
      
      </div><p>…But not here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">promise
  .then(f1, f2);</code></pre>
        </div>
      </div>
      
      </div><p>That's because an error is passed down the chain, and in the second code piece there's no chain below <code>f1</code>.</p>
<p>In other words, <code>.then</code> passes results/errors to the next <code>.then/catch</code>. So in the first example, there's a <code>catch</code> below, and in the second one – there isn't, so the error is unhandled.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#error-in-settimeout" name="error-in-settimeout" class="main__anchor">Error in setTimeout</a></h3>
<a href="http://javascript.info/task/error-async" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>How do you think, does the <code>.catch</code> trigger? Explain your answer?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {
  setTimeout(() =&gt; {
    throw new Error("Whoops!");
  }, 1000);
}).catch(alert);</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The answer is: <strong>no, it won't</strong>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">new Promise(function(resolve, reject) {
  setTimeout(() =&gt; {
    throw new Error("Whoops!");
  }, 1000);
}).catch(alert);</code></pre>
        </div>
      </div>
      
      </div><p>As said in the chapter, there's an "implicit <code>try..catch</code>" around the function code. So all synchronous errors are handled.</p>
<p>But here the error is generated not while the executor is running, but later. So the promise can't handle it.</p>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>



<h6 id="chapter-959"></h6>
<h1 class="main__header-title" id="chapter-960">Promise API</h1>
<p>There are 4 static methods in the <code>Promise</code> class. We'll quickly cover their use cases here.</p>
<h2 id="chapter-961">
Promise.resolve</h2>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = Promise.resolve(value);</code></pre>
        </div>
      </div>
      
      </div><p>Returns a resolved promise with the given <code>value</code>.</p>
<p>Same as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(resolve =&gt; resolve(value));</code></pre>
        </div>
      </div>
      
      </div><p>The method is used when we already have a value, but would like to have it “wrapped” into a promise.</p>
<p>For instance, the <code>loadCached</code> function below fetches the <code>url</code> and remembers the result, so that future calls on the same URL return it immediately:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadCached(url) {
  let cache = loadCached.cache || (loadCached.cache = new Map());

  if (cache.has(url)) {
    return Promise.resolve(cache.get(url)); // (*)
  }

  return fetch(url)
    .then(response =&gt; response.text())
    .then(text =&gt; {
      cache[url] = text;
      return text;
    });
}</code></pre>
        </div>
      </div>
      
      </div><p>We can use <code>loadCached(url).then(…)</code>, because the function is guaranteed to return a promise. That's the purpose <code>Promise.resolve</code> in the line <code>(*)</code>: it makes sure the interface unified. We can always use <code>.then</code> after <code>loadCached</code>.</p>
<h2 id="chapter-962">
Promise.reject</h2>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = Promise.reject(error);</code></pre>
        </div>
      </div>
      
      </div><p>Create a rejected promise with the <code>error</code>.</p>
<p>Same as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise((resolve, reject) =&gt; reject(error));</code></pre>
        </div>
      </div>
      
      </div><p>We cover it here for completeness, rarely used in real code.</p>
<h2 id="chapter-963">
Promise.all</h2>
<p>The method to run many promises in parallel and wait till all of them are ready.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = Promise.all(iterable);</code></pre>
        </div>
      </div>
      
      </div><p>It takes an <code>iterable</code> object with promises, technically it can be any iterable, but usually it's an array, and returns a new promise. The new promise resolves with when all of them are settled and has an array of their results.</p>
<p>For instance, the <code>Promise.all</code> below settles after 3 seconds, and then its result is an array <code>[1, 2, 3]</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Promise.all([
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; resolve(1), 3000)), // 1
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; resolve(2), 2000)), // 2
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; resolve(3), 1000))  // 3
]).then(alert); // 1,2,3 when promises are ready: each promise contributes an array member</code></pre>
        </div>
      </div>
      
      </div><p>Please note that the relative order is the same. Even though the first promise takes the longest time to resolve, it is still first in the array of results.</p>
<p>A common trick is to map an array of job data into an array of promises, and then wrap that into <code>Promise.all</code>.</p>
<p>For instance, if we have an array of URLs, we can fetch them all like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let urls = [
  'https://api.github.com/users/iliakan',
  'https://api.github.com/users/remy',
  'https://api.github.com/users/jeresig'
];

// map every url to the promise fetch(github url)
let requests = urls.map(url =&gt; fetch(url));

// Promise.all waits until all jobs are resolved
Promise.all(requests)
  .then(responses =&gt; responses.forEach(
    response =&gt; alert(`${response.url}: ${response.status}`)
  ));</code></pre>
        </div>
      </div>
      
      </div><p>A more real-life example with fetching user information for an array of github users by their names (or we could fetch an array of goods by their ids, the logic is same):</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let names = ['iliakan', 'remy', 'jeresig'];

let requests = names.map(name =&gt; fetch(`https://api.github.com/users/${name}`));

Promise.all(requests)
  .then(responses =&gt; {
    // all responses are ready, we can show HTTP status codes
    for(let response of responses) {
      alert(`${response.url}: ${response.status}`); // shows 200 for every url
    }

    return responses;
  })
  // map array of responses into array of response.json() to read their content
  .then(responses =&gt; Promise.all(responses.map(r =&gt; r.json())))
  // all JSON answers are parsed: "users" is the array of them
  .then(users =&gt; users.forEach(user =&gt; alert(user.name)));</code></pre>
        </div>
      </div>
      
      </div><p>If any of the promises is rejected, <code>Promise.all</code> immediately rejects with that error.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Promise.all([
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; resolve(1), 1000)),
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; reject(new Error("Whoops!")), 2000)),
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; resolve(3), 3000))
]).catch(alert); // Error: Whoops!</code></pre>
        </div>
      </div>
      
      </div><p>Here the second promise rejects in two seconds. That leads to immediate rejection of <code>Promise.all</code>, so <code>.catch</code> executes: the rejection error becomes the outcome of the whole <code>Promise.all</code>.</p>
<p>The important detail is that promises provide no way to “cancel” or “abort” their execution. So other promises continue to execute, and the eventually settle, but all their results are ignored.</p>
<p>There are ways to avoid this: we can either write additional code to <code>clearTimeout</code> (or otherwise cancel) the promises in case of an error, or we can make errors show up as members in the resulting array (see the task below this chapter about it).</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>Promise.all(iterable)</code> allows non-promise items in <code>iterable</code></span></div>
            <div class="important__content"><p>Normally, <code>Promise.all(iterable)</code> accepts an iterable (in most cases an array) of promises. But if any of those objects is not a promise, it's wrapped in <code>Promise.resolve</code>.</p>
<p>For instance, here the results are <code>[1, 2, 3]</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Promise.all([
  new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; resolve(1), 1000)
  }),
  2, // treated as Promise.resolve(2)
  3  // treated as Promise.resolve(3)
]).then(alert); // 1, 2, 3</code></pre>
        </div>
      </div>
      
      </div><p>So we are able to pass non-promise values to <code>Promise.all</code> where convenient.</p>
</div></div>
<h2 id="chapter-964">
Promise.race</h2>
<p>Similar to <code>Promise.all</code> takes an iterable of promises, but instead of waiting for all of them to finish – waits for the first result (or error), and goes on with it.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = Promise.race(iterable);</code></pre>
        </div>
      </div>
      
      </div><p>For instance, here the result will be <code>1</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Promise.race([
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; resolve(1), 1000)),
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; reject(new Error("Whoops!")), 2000)),
  new Promise((resolve, reject) =&gt; setTimeout(() =&gt; resolve(3), 3000))
]).then(alert); // 1</code></pre>
        </div>
      </div>
      
      </div><p>So, the first result/error becomes the result of the whole <code>Promise.race</code>. After the first settled promise “wins the race”, all further results/errors are ignored.</p>
<h2 id="chapter-965">
Summary</h2>
<p>There are 4 static methods of <code>Promise</code> class:</p>
<ol>
<li><code>Promise.resolve(value)</code> – makes a resolved promise with the given value,</li>
<li><code>Promise.reject(error)</code> – makes a rejected promise with the given error,</li>
<li><code>Promise.all(promises)</code> – waits for all promises to resolve and returns an array of their results. If any of the given promises rejects, then it becomes the error of <code>Promise.all</code>, and all other results are ignored.</li>
<li><code>Promise.race(promises)</code> – waits for the first promise to settle, and its result/error becomes the outcome.</li>
</ol>
<p>Of these four, <code>Promise.all</code> is the most common in practice.</p>
<div class="tasks"><h2 id="chapter-966" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#fault-tolerant-promise-all" name="fault-tolerant-promise-all" class="main__anchor">Fault-tolerant Promise.all</a></h3>
<a href="http://javascript.info/task/promise-errors-as-results" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>We'd like to fetch multiple URLs in parallel.</p>
<p>Here's the code to do that:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let urls = [
  'https://api.github.com/users/iliakan',
  'https://api.github.com/users/remy',
  'https://api.github.com/users/jeresig'
];

Promise.all(urls.map(url =&gt; fetch(url)))
  // for each response show its status
  .then(responses =&gt; { // (*)
    for(let response of responses) {
      alert(`${response.url}: ${response.status}`);
    }
  ));</code></pre>
        </div>
      </div>
      
      </div><p>The problem is that if any of requests fails, then <code>Promise.all</code> rejects with the error, and we loose results of all the other requests.</p>
<p>That's not good.</p>
<p>Modify the code so that the array <code>responses</code> in the line <code>(*)</code> would include the response objects for successful fetches and error objects for failed ones.</p>
<p>For instance, if one of URLs is bad, then it should be like:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let urls = [
  'https://api.github.com/users/iliakan',
  'https://api.github.com/users/remy',
  'http://no-such-url'
];

Promise.all(...) // your code to fetch URLs...
  // ...and pass fetch errors as members of the resulting array...
  .then(responses =&gt; {
    // 3 urls =&gt; 3 array members
    alert(responses[0].status); // 200
    alert(responses[1].status); // 200
    alert(responses[2]); // TypeError: failed to fetch (text may vary)
  });</code></pre>
        </div>
      </div>
      
      </div><p>P.S. In this task you don't have to load the full response using <code>response.text()</code> or <code>response.json()</code>. Just handle fetch errors the right way.</p>
<p>
<a href="http://plnkr.co/edit/laAmxL0woc6K5AShUtHJ?p=preview" target="_blank" data-plunk-id="laAmxL0woc6K5AShUtHJ">Open the sandbox for the task.</a></p>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The solution is actually pretty simple.</p>
<p>Take a look at this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Promise.all(
  fetch('https://api.github.com/users/iliakan'),
  fetch('https://api.github.com/users/remy'),
  fetch('http://no-such-url')
)</code></pre>
        </div>
      </div>
      
      </div><p>Here we have an array of <code>fetch(...)</code> promises that goes to <code>Promise.all</code>.</p>
<p>We can't change the way <code>Promise.all</code> works: if it detects an error, then it rejects with it. So we need to prevent any error from occuring. Instead, if a <code>fetch</code> error happens, we need to treat it as a “normal” result.</p>
<p>Here's how:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Promise.all(
  fetch('https://api.github.com/users/iliakan').catch(err =&gt; err),
  fetch('https://api.github.com/users/remy').catch(err =&gt; err),
  fetch('http://no-such-url').catch(err =&gt; err)
)</code></pre>
        </div>
      </div>
      
      </div><p>In other words, the <code>.catch</code> takes an error for all of the promises and returns it normally. By the rules of how promises work, if a <code>.then/catch</code> handler returns a value (doesn't matter if it's an error object or something else), then the execution continues the “normal” flow.</p>
<p>So the <code>.catch</code> returns the error as a “normal” result into the outer <code>Promise.all</code>.</p>
<p>This code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Promise.all(
  urls.map(url =&gt; fetch(url))
)</code></pre>
        </div>
      </div>
      
      </div><p>Can be rewritten as:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">Promise.all(
  urls.map(url =&gt; fetch(url).catch(err =&gt; err))
)</code></pre>
        </div>
      </div>
      
      </div><p>
<a href="http://plnkr.co/edit/LXZe80niZ2uq9SriexSC?p=preview" target="_blank" data-plunk-id="LXZe80niZ2uq9SriexSC">Open the solution in the sandbox.</a></p></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#fault-tolerant-fetch-with-json" name="fault-tolerant-fetch-with-json" class="main__anchor">Fault-tolerant fetch with JSON</a></h3>
<a href="http://javascript.info/task/promise-errors-as-results-2" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Improve the solution of the previous task 
<a href="http://javascript.info/task/promise-errors-as-results">Fault-tolerant Promise.all</a>. Now we need not just to call <code>fetch</code>, but to load the JSON objects from given URLs.</p>
<p>Here's the example code to do that:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let urls = [
  'https://api.github.com/users/iliakan',
  'https://api.github.com/users/remy',
  'https://api.github.com/users/jeresig'
];

// make fetch requests
Promise.all(urls.map(url =&gt; fetch(url)))
  // map each response to response.json()
  .then(responses =&gt; Promise.all(
    responses.map(r =&gt; r.json())
  ))
  // show name of each user
  .then(users =&gt; {  // (*)
    for(let user of users) {
      alert(user.name);
    }
  });</code></pre>
        </div>
      </div>
      
      </div><p>The problem is that if any of requests fails, then <code>Promise.all</code> rejects with the error, and we loose results of all the other requests. So the code above is not fault-tolerant, just like the one in the previous task.</p>
<p>Modify the code so that the array in the line <code>(*)</code> would include parsed JSON for successful requests and error for errored ones.</p>
<p>Please note that the error may occur both in <code>fetch</code> (if the network request fails) and in <code>response.json()</code> (if the response is invalid JSON). In both cases the error should become a member of the results object.</p>
<p>The sandbox has both of these cases.</p>
<p>
<a href="http://plnkr.co/edit/kFD92Ahqa6vyhGfkxfgT?p=preview" target="_blank" data-plunk-id="kFD92Ahqa6vyhGfkxfgT">Open the sandbox for the task.</a></p>

<button type="button" class="task__solution">solution</button>


<div class="task__answer"><div class="task__answer-content"><p>
<a href="http://plnkr.co/edit/keHJ1rigDtUgpNDDlUJe?p=preview" target="_blank" data-plunk-id="keHJ1rigDtUgpNDDlUJe">Open the solution in the sandbox.</a></p></div>

<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<h6 id="chapter-967"></h6>
<h1 class="main__header-title" id="chapter-968">Async/await</h1>
<p>There's a special syntax to work with promises in a more comfort fashion, called “async/await”. It's surprisingly easy to understand and use.</p>
<h2 id="chapter-969">
Async functions</h2>
<p>Let's start with the <code>async</code> keyword. It can be placed before function, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {
  return 1;
}</code></pre>
        </div>
      </div>
      
      </div><p>The word “async” before a function means one simple thing: a function always returns a promise. If the code has <code>return &lt;non-promise&gt;</code> in it, then JavaScript automatically wraps it into a resolved promise with that value.</p>
<p>For instance, the code above returns a resolved promise with the result of <code>1</code>, let's test it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {
  return 1;
}

f().then(alert); // 1</code></pre>
        </div>
      </div>
      
      </div><p>…We could explicitly return a promise, that would be the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {
  return Promise.resolve(1);
}

f().then(alert); // 1</code></pre>
        </div>
      </div>
      
      </div><p>So, <code>async</code> ensures that the function returns a promise, wraps non-promises in it. Simple enough, right? But not only that. There's another keyword <code>await</code> that works only inside <code>async</code> functions, and it's pretty cool.</p>
<h2 id="chapter-970">
Await</h2>
<p>The syntax:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// works only inside async functions
let value = await promise;</code></pre>
        </div>
      </div>
      
      </div><p>The keyword <code>await</code> makes JavaScript wait until that promise settles and returns its result.</p>
<p>Here's example with a promise that resolves in 1 second:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {

  let promise = new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; resolve("done!"), 1000)
  });

  let result = await promise; // wait till the promise resolves (*)

  alert(result); // "done!"
}

f();</code></pre>
        </div>
      </div>
      
      </div><p>The function execution “pauses” at the line <code>(*)</code> and resumes when the promise settles, with <code>result</code> becoming its result. So the code above shows “done!” in one second.</p>
<p>Let's emphasize: <code>await</code> literally makes JavaScript wait until the promise settles, and then go on with the result. That doesn't cost any CPU resources, because the engine can do other jobs meanwhile: execute other scripts, handle events etc.</p>
<p>It's just a more elegant syntax of getting the promise result than <code>promise.then</code>, easier to read and write.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Can't use <code>await</code> in regular functions</span></div>
            <div class="important__content"><p>If we try to use <code>await</code> in non-async function, that would be a syntax error:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-2">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  let promise = Promise.resolve(1);
  let result = await promise; // Syntax error
}</code></pre>
        </div>
      </div>
      
      </div><p>We can get such error in case if we forget to put <code>async</code> before a function. As said, <code>await</code> only works inside <code>async function</code>.</p>
</div></div>
<p>Let's take <code>showAvatar()</code> example from the chapter 
<a href="http://javascript.info/promise-chaining">Promises chaining</a> and rewrite it using <code>async/await</code>:</p>
<ol>
<li>We'll need to replace <code>.then</code> calls by <code>await</code>.</li>
<li>Also we should make the function <code>async</code> for them to work.</li>
</ol>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function showAvatar() {

  // read our JSON
  let response = await fetch('/article/promise-chaining/user.json');
  let user = await response.json();

  // read github user
  let githubResponse = await fetch(`https://api.github.com/users/${user.name}`);
  let githubUser = await githubResponse.json();

  // show the avatar
  let img = document.createElement('img');
  img.src = githubUser.avatar_url;
  img.className = "promise-avatar-example";
  document.body.append(img);

  // wait 3 seconds
  await new Promise((resolve, reject) =&gt; setTimeout(resolve, 3000));

  img.remove();

  return githubUser;
}

showAvatar();</code></pre>
        </div>
      </div>
      
      </div><p>Pretty clean and easy to read, right? Much better than before.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>await</code> won't work in the top-level code</span></div>
            <div class="important__content"><p>People who are just starting to use <code>await</code> tend to forget that, but we can't write <code>await</code> in the top-level code. That wouldn't work:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// syntax error in top-level code
let response = await fetch('/article/promise-chaining/user.json');
let user = await response.json();</code></pre>
        </div>
      </div>
      
      </div><p>So we need to have a wrapping async function for the code that awaits. Just as in the example above.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>await</code> accepts thenables</span></div>
            <div class="important__content"><p>Like <code>promise.then</code>, <code>await</code> allows to use thenable objects (those with a callable <code>then</code> method). Again, the idea is that a 3rd-party object may be not a promise, but promise-compatible: if it supports <code>.then</code>, that's enough to use with <code>await</code>.</p>
<p>For instance, here <code>await</code> accepts <code>new Thenable(1)</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Thenable {
  constructor(num) {
    this.num = num;
  }
  then(resolve, reject) {
    alert(resolve); // function() { native code }
    // resolve with this.num*2 after 1000ms
    setTimeout(() =&gt; resolve(this.num * 2), 1000); // (*)
  }
};

async function f() {
  // waits for 1 second, then result becomes 2
  let result = await new Thenable(1);
  alert(result);
}

f();</code></pre>
        </div>
      </div>
      
      </div><p>If <code>await</code> gets a non-promise object with <code>.then</code>, it calls that method providing native functions <code>resolve</code>, <code>reject</code> as arguments. Then <code>await</code> waits until one of them is called (in the example above it happens in the line <code>(*)</code>) and then proceeds with the result.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Async methods</span></div>
            <div class="important__content"><p>A class method can also be async, just put <code>async</code> before it.</p>
<p>Like here:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class Waiter {
  async wait() {
    return await Promise.resolve(1);
  }
}

new Waiter()
  .wait()
  .then(alert); // 1</code></pre>
        </div>
      </div>
      
      </div><p>The meaning is the same: it ensures that the returned value is a promise and enables <code>await</code>.</p>
</div></div>
<h2 id="chapter-971">
Error handling</h2>
<p>If a promise resolves normally, then <code>await promise</code> returns the result. But in case of a rejection it throws the error, just if there were a <code>throw</code> statement at that line.</p>
<p>This code:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {
  await Promise.reject(new Error("Whoops!"));
}</code></pre>
        </div>
      </div>
      
      </div><p>…Is the same as this:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {
  throw new Error("Whoops!");
}</code></pre>
        </div>
      </div>
      
      </div><p>In real situations the promise may take some time before it rejects. So <code>await</code> will wait, and then throw an error.</p>
<p>We can catch that error using <code>try..catch</code>, the same way as a regular <code>throw</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {

  try {
    let response = await fetch('http://no-such-url');
  } catch(err) {
    alert(err); // TypeError: failed to fetch
  }
}

f();</code></pre>
        </div>
      </div>
      
      </div><p>In case of an error, the control jumps to the <code>catch</code> block. We can also wrap multiple lines:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {

  try {
    let response = await fetch('/no-user-here');
    let user = await response.json();
  } catch(err) {
    // catches errors both in fetch and response.json
    alert(err);
  }
}

f();</code></pre>
        </div>
      </div>
      
      </div><p>If we don't have <code>try..catch</code>, then the promise generated by the call of the async function <code>f()</code> becomes rejected. We can append <code>.catch</code> to handle it:</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function f() {
  let response = await fetch('http://no-such-url');
}

// f() becomes a rejected promise
f().catch(alert); // TypeError: failed to fetch // (*)</code></pre>
        </div>
      </div>
      
      </div><p>If we forget to add <code>.catch</code> there, then we get an unhandled promise error (and can see it in the console). We can catch such errors using a global event handler as described in the chapter 
<a href="http://javascript.info/promise-chaining">Promises chaining</a>.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>async/await</code> and <code>promise.then/catch</code></span></div>
            <div class="important__content"><p>When we use <code>async/await</code>, we rarely need <code>.then</code>, because <code>await</code> handles the waiting for us. And we can use a regular <code>try..catch</code> instead of <code>.catch</code>. That's usually (not always) more convenient.</p>
<p>But at the top level of the code, when we're outside of any <code>async</code> function, we're syntactically unable to use <code>await</code>, so it's a normal practice to add <code>.then/catch</code> to handle the final result or falling-through errors.</p>
<p>Like in the line <code>(*)</code> of the example above.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>async/await</code> works well with <code>Promise.all</code></span></div>
            <div class="important__content"><p>When we need to wait for multiple promises, we can wrap them in <code>Promise.all</code> and then <code>await</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// wait for the array of results
let results = await Promise.all([
  fetch(url1),
  fetch(url2),
  ...
]);</code></pre>
        </div>
      </div>
      
      </div><p>In case of an error, it propagates as usual: from the failed promise to <code>Promise.all</code>, and then becomes an exception that we can catch using <code>try..catch</code> around the call.</p>
</div></div>
<h2 id="chapter-972">
Summary</h2>
<p>The <code>async</code> keyword before a function has two effects:</p>
<ol>
<li>Makes it always return a promise.</li>
<li>Allows to use <code>await</code> in it.</li>
</ol>
<p>The <code>await</code> keyword before a promise makes JavaScript wait until that promise settles, and then:</p>
<ol>
<li>If it's an error, the exception is generated, same as if <code>throw error</code> were called at that very place.</li>
<li>Otherwise, it returns the result, so we can assign it to a value.</li>
</ol>
<p>Together they provide a great framework to write asynchronous code that is easy both to read and write.</p>
<p>With <code>async/await</code> we rarely need to write <code>promise.then/catch</code>, but we still shouldn't forget that they are based on promises, because sometimes (e.g. in the outermost scope) we have to use these methods. Also <code>Promise.all</code> is a nice thing to wait for many tasks simultaneously.</p>
<div class="tasks"><h2 id="chapter-973" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</h2>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-using-async-await" name="rewrite-using-async-await" class="main__anchor">Rewrite using async/await</a></h3>
<a href="http://javascript.info/task/rewrite-async" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Rewrite the one of examples from the chapter 
<a href="http://javascript.info/promise-chaining">Promises chaining</a> using <code>async/await</code> instead of <code>.then/catch</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadJson(url) {
  return fetch(url)
    .then(response =&gt; {
      if (response.status == 200) {
        return response.json();
      } else {
        throw new Error(response.status);
      }
    })
}

loadJson('no-such-user.json') // (3)
  .catch(alert); // Error: 404</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>The notes are below the code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">async function loadJson(url) { // (1)
  let response = await fetch(url); // (2)

  if (response.status == 200) {
    let json = await response.json(); // (3)
    return json;
  }

  throw new Error(response.status);
}

loadJson('no-such-user.json')
  .catch(alert); // Error: 404 (4)</code></pre>
        </div>
      </div>
      
      </div><p>Notes:</p>
<ol>
<li>
<p>The function <code>loadUrl</code> becomes <code>async</code>.</p>
</li>
<li>
<p>All <code>.then</code> inside are replaced with <code>await</code>.</p>
</li>
<li>
<p>We can <code>return response.json()</code> instead of awaiting for it, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (response.status == 200) {
  return response.json(); // (3)
}</code></pre>
        </div>
      </div>
      
      </div><p>Then the outer code would have to <code>await</code> for that promise to resolve. In our case it doesn't matter.</p>
</li>
<li>
<p>The error thrown from <code>loadJson</code> is handled by <code>.catch</code>. We can't use <code>await loadJson(…)</code> there, because we're not in an <code>async</code> function.</p>
</li>
</ol>
</div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div>
<div class="task tasks__task"><div class="task__header"><div class="task__title-wrap">

<h3 class="task__title"><a href="#rewrite-rethrow-async-await" name="rewrite-rethrow-async-await" class="main__anchor">Rewrite "rethrow" async/await</a></h3>
<a href="http://javascript.info/task/rewrite-async-2" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content">
<p>Below you can find the “rethrow” example from the chapter 
<a href="http://javascript.info/promise-chaining">Promises chaining</a>. Rewrite it using <code>async/await</code> instead of <code>.then/catch</code>.</p>
<p>And get rid of the recursion in favour of a loop in <code>demoGithubUser</code>: with <code>async/await</code> that becomes easy to do.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class HttpError extends Error {
  constructor(response) {
    super(`${response.status} for ${response.url}`);
    this.name = 'HttpError';
    this.response = response;
  }
}

function loadJson(url) {
  return fetch(url)
    .then(response =&gt; {
      if (response.status == 200) {
        return response.json();
      } else {
        throw new HttpError(response);
      }
    })
}

// Ask for a user name until github returns a valid user
function demoGithubUser() {
  let name = prompt("Enter a name?", "iliakan");

  return loadJson(`https://api.github.com/users/${name}`)
    .then(user =&gt; {
      alert(`Full name: ${user.name}.`);
      return user;
    })
    .catch(err =&gt; {
      if (err instanceof HttpError &amp;&amp; err.response.status == 404) {
        alert("No such user, please reenter.");
        return demoGithubUser();
      } else {
        throw err;
      }
    });
}

demoGithubUser();</code></pre>
        </div>
      </div>
      
      </div>
<button type="button" class="task__solution">solution</button>

<div class="task__answer"><div class="task__answer-content"><p>There are no tricks here. Just replace <code>.catch</code> with <code>try...catch</code> inside <code>demoGithubUser</code> and add <code>async/await</code> where needed:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">class HttpError extends Error {
  constructor(response) {
    super(`${response.status} for ${response.url}`);
    this.name = 'HttpError';
    this.response = response;
  }
}

async function loadJson(url) {
  let response = await fetch(url);
  if (response.status == 200) {
    return response.json();
  } else {
    throw new HttpError(response);
  }
}

// Ask for a user name until github returns a valid user
async function demoGithubUser() {

  let user;
  while(true) {
    let name = prompt("Enter a name?", "iliakan");

    try {
      user = await loadJson(`https://api.github.com/users/${name}`);
      break; // no error, exit loop
    } catch(err) {
      if (err instanceof HttpError &amp;&amp; err.response.status == 404) {
        // loop continues after the alert
        alert("No such user, please reenter.");
      } else {
        // unknown error, rethrow
        throw err;
      }
    }
  }


  alert(`Full name: ${user.name}.`);
  return user;
}

demoGithubUser();</code></pre>
        </div>
      </div>
      
      </div></div>
<button type="button" title="close" class="close-button task__answer-close"></button>
</div></div></div></div></div>

<br>
<br><br><br><br><br>

</body></html>