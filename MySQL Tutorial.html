<base target="_blank"><html><head><title>MySQL by Examples</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script src="https://williamkpchan.github.io/lazyload.min.js"></script>
<script src='https://williamkpchan.github.io/mainscript.js'></script>
<script src="https://williamkpchan.github.io/commonfunctions.js"></script>
<script>
var showTopicNumber = false;
var topicEnd = "<br>";
var bookid = "MySQL by Examples"
var markerName = "h2, h3"
</script>
<style>
body{width:80%;margin-left: 10%; font-size:24px;}
h1, h2 {color: gold;}
strong {color: orange;}
img {width:90%; display: inline-block; margin-top: 2%;margin-bottom: 1%;-radius:3px;}
k {color: #205080;}
</style></head><body onkeypress="chkKey()"><center>
<h1>MySQL by Examples for Beginners</h1>

<div id="toc"></div></center>
<pre>

&lt;base href=https://www.ntu.edu.sg/home/ehchua/programming/sql/>

https://www.ntu.edu.sg/home/ehchua/programming/sql/MySQL_Beginner.html

<h5>TABLE OF CONTENTS</h5>

Read "<a href="MySQL_HowTo.html">How to Install MySQL and Get Started</a>" on how to install, customize, and get started with MySQL.

<h2>Summary of MySQL Commands Used in this Tutorial</h2>

For detailed syntax, check MySQL manual "SQL Statement Syntax" @ <a href="http://dev.mysql.com/doc/refman/5.5/en/sql-syntax.html">http://dev.mysql.com/doc/refman/5.5/en/sql-syntax.html</a>.

-- Database-Level
DROP DATABASE databaseName                 -- Delete the database (irrecoverable!)
DROP DATABASE IF EXISTS databaseName       -- Delete if it exists
CREATE DATABASE databaseName               -- Create a new database
CREATE DATABASE IF NOT EXISTS databaseName -- Create only if it does not exists
SHOW DATABASES                             -- Show all the databases in this server
USE databaseName                           -- Set the default (current) database
SELECT DATABASE()                          -- Show the default database
SHOW CREATE DATABASE databaseName          -- Show the CREATE DATABASE statement
 
-- Table-Level
DROP TABLE [IF EXISTS] tableName, ...
CREATE TABLE [IF NOT EXISTS] tableName (
   columnName columnType columnAttribute, ...
   PRIMARY KEY(columnName),
   FOREIGN KEY (columnNmae) REFERENCES tableName (columnNmae)
)
SHOW TABLES                -- Show all the tables in the default database
DESCRIBE|DESC tableName    -- Describe the details for a table
ALTER TABLE tableName ...  -- Modify a table, e.g., ADD COLUMN and DROP COLUMN
ALTER TABLE tableName ADD columnDefinition
ALTER TABLE tableName DROP columnName
ALTER TABLE tableName ADD FOREIGN KEY (columnNmae) REFERENCES tableName (columnNmae)
ALTER TABLE tableName DROP FOREIGN KEY constraintName
SHOW CREATE TABLE tableName        -- Show the CREATE TABLE statement for this tableName
 
-- Row-Level
INSERT INTO tableName 
   VALUES (column1Value, column2Value,...)               -- Insert on all Columns
INSERT INTO tableName 
   VALUES (column1Value, column2Value,...), ...          -- Insert multiple rows
INSERT INTO tableName (column1Name, ..., columnNName)
   VALUES (column1Value, ..., columnNValue)              -- Insert on selected Columns
DELETE FROM tableName WHERE criteria
UPDATE tableName SET columnName = expr, ... WHERE criteria
SELECT * | column1Name AS alias1, ..., columnNName AS aliasN 
   FROM tableName
   WHERE criteria
   GROUP BY columnName
   ORDER BY columnName ASC|DESC, ...
   HAVING groupConstraints
   LIMIT count | offset count
 
-- Others
SHOW WARNINGS;   -- Show the warnings of the previous statement

<h2>An Example for the Beginners (But NOT for the dummies)</h2>
A MySQL database server  contains many databases (or schemas). Each database consists of one or more tables.
A table is made up of columns (or fields) and rows (records).

The SQL keywords and commands are NOT case-sensitive.
For clarity, they are shown in uppercase.
The names or identifiers (database names, table names, column names, etc.) are case-sensitive in some systems, but not in other systems.
Hence, it is best to treat identifiers as case-sensitive.

<h5>SHOW DATABASES</h5>
You can use <mk>SHOW DATABASES</mk> to list all the existing databases in the server.

mysql> <k>SHOW DATABASES;</k>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
........

The databases "<mk>mysql</mk>", "<mk>information_schema</mk>" and  "<mk>performance_schema</mk>" are system databases used internally by MySQL.
A "<mk>test</mk>" database is  provided during installation for your  testing.

Let us begin with a simple example - a product sales database.
A product sales database typically consists of many tables, e.g., products, customers, suppliers, orders, payments, employees, among others.
Let's call our database "<mk>southwind</mk>" (inspired from Microsoft's Northwind  Trader sample database). We shall begin with the first table called "<mk>products</mk>" with the following columns (having data types as indicated) and rows:

<table class="table-zebra font-code" style="width:60%">
<tr><th colspan="5" style="text-align:left">Database: southwind<br />Table: products</th></tr>
<tr><th>productID<br />INT</th><th>productCode<br />CHAR(3)</th><th>name<br />VARCHAR(30)</th><th>quantity<br />INT</th><th>price<br />DECIMAL(10,2)</th></tr>
<tr><td>1001</td><td>PEN</td><td>Pen Red</td><td>5000</td><td>1.23</td></tr>
<tr class="tr-alt"><td>1002</td><td>PEN</td><td>Pen Blue</td><td>8000</td><td>1.25</td></tr>
<tr><td>1003</td><td>PEN</td><td>Pen Black</td><td>2000</td><td>1.25</td></tr>
<tr class="tr-alt"><td>1004</td><td>PEC</td><td>Pencil 2B</td><td>10000</td><td>0.48</td></tr>
<tr>  <td>1005</td><td>PEC</td><td>Pencil 2H</td><td>8000</td><td>0.49</td></tr>
</table>

<h3>&emsp;Creating and Deleting a Database - CREATE DATABASE and DROP DATABASE</h3>

You can create a new database using SQL command "<mk>CREATE DATABASE databaseName</mk>"; and delete a database using "<mk>DROP DATABASE databaseName</mk>". You could optionally apply condition "<mk>IF EXISTS</mk>" or "<mk>IF NOT EXISTS</mk>" to these commands.
For example,

mysql> <k>CREATE DATABASE southwind;</k>
Query OK, 1 row affected (0.03 sec)
   
mysql> <k>DROP DATABASE southwind;</k>
Query OK, 0 rows affected (0.11 sec)
   
mysql> <k>CREATE DATABASE IF NOT EXISTS southwind;</k>
Query OK, 1 row affected (0.01 sec)
   
mysql> <k>DROP DATABASE IF EXISTS southwind;</k>
Query OK, 0 rows affected (0.00 sec)

<k>IMPORTANT</k>: Use SQL <mk>DROP</mk> (and <mk>DELETE</mk>) commands with extreme care, as the deleted entities are irrecoverable. <k>THERE IS NO UNDO!!!</k>

<h5>SHOW CREATE DATABASE</h5>

The <mk>CREATE DATABASE</mk> commands uses some defaults.
You can issue a "<mk>SHOW CREATE DATABASE databaseName</mk>" to display the full command and check these default values.
We use <mk>\G</mk> (instead of <mk>';'</mk>) to display the results vertically. (Try comparing the outputs produced by <mk>';'</mk> and <mk>\G</mk>.)

mysql> <k>CREATE DATABASE IF NOT EXISTS southwind;</k>
   
mysql> <k>SHOW CREATE DATABASE southwind \G</k>
*************************** 1. row ***************************
       Database: southwind
Create Database: CREATE DATABASE `southwind` /*!40100 DEFAULT CHARACTER SET latin1 */

<h5>Back-Quoted Identifiers (`name`)</h5>

Unquoted names or identifiers (such as database name, table name and column name) cannot contain blank and special characters, or crash with MySQL keywords (such as <mk>ORDER</mk> and  <mk>DESC</mk>). You can include blanks and special characters or use MySQL keyword as identifier by enclosing it with a pair of back-quote, in the form of <mk>`name`</mk>.
For robustness, the <mk>SHOW </mk>command back-quotes all the identifiers, as illustrated in the above example.

<h5>Comments and Version Comments</h5>
 MySQL multi-line comments are enclosed within <mk>/*</mk> and <mk>*/</mk>; end-of-line comments begins with <mk>--</mk> (followed by a space) or <mk>#</mk>.
The <mk>/*!40100 ...... */</mk> is known as version comment, which will only be run if the server is at or above this version number <mk>4.01.00</mk>. To check the version of your MySQL server, issue query "<mk>SELECT version()</mk>".

<h3>&emsp;Setting the Default Database - USE</h3>
The command "<mk>USE databaseName</mk>" sets a particular database as the default (or current) database.
You can reference a table in the default database using <mk>tableName</mk> directly.
But you need to use the fully-qualified <mk>databaseName.tableName</mk> to reference a table NOT in the default database.
In our example, we have a database named "<mk>southwind</mk>" with a table named "<mk>products</mk>". If we issue "<mk>USE southwind</mk>" to set <mk>southwind</mk> as the default database, we can simply call the table as "<mk>products</mk>". Otherwise, we need to reference the table as "<mk>southwind.products</mk>".
To display the current default database, issue command "<mk>SELECT DATABASE()</mk>".

<h3>&emsp;Creating and Deleting a Table - CREATE TABLE and DROP TABLE</h3>
You can create a new table in the default database using command "<mk>CREATE TABLE tableName</mk>" and "<mk>DROP TABLE tableName</mk>". You can also apply condition "<mk>IF EXISTS</mk>" or "<mk>IF NOT EXISTS</mk>". To create a table, you need to define all its columns, by providing the columns' name, type, and attributes. 
 Let's create a table "<mk>products</mk>" in our database "<mk>southwind</mk>".

-- Remove the database "southwind", if it exists.
-- Beware that DROP (and DELETE) actions are irreversible and not recoverable!
mysql> <k>DROP DATABASE IF EXISTS southwind;</k>
Query OK, 1 rows affected (0.31 sec)
 
-- Create the database "southwind"
mysql> <k>CREATE DATABASE southwind;</k>
Query OK, 1 row affected (0.01 sec)
 
-- Show all the databases in the server
--   to confirm that "southwind" database has been created.
mysql> <k>SHOW DATABASES;</k>
+--------------------+
| Database           |
+--------------------+
| southwind          |
| ......             |
 
-- Set "southwind" as the default database so as to reference its table directly.
mysql> <k>USE southwind;</k>
Database changed
 
-- Show the current (default) database
mysql> <k>SELECT DATABASE();</k>
+------------+
| DATABASE() |
+------------+
| southwind  |
+------------+
 
-- Show all the tables in the current database.
-- "southwind" has no table (empty set).
mysql> <k>SHOW TABLES;</k>
Empty set (0.00 sec)
 
-- Create the table "products". Read "explanations" below for the column defintions
mysql> <k>CREATE TABLE IF NOT EXISTS products (
         productID    INT UNSIGNED  NOT NULL AUTO_INCREMENT,
         productCode  CHAR(3)       NOT NULL DEFAULT '',
         name         VARCHAR(30)   NOT NULL DEFAULT '',
         quantity     INT UNSIGNED  NOT NULL DEFAULT 0,
         price        DECIMAL(7,2)  NOT NULL DEFAULT 99999.99,
         PRIMARY KEY  (productID)
       );</k>
Query OK, 0 rows affected (0.08 sec)
 
-- Show all the tables to confirm that the "products" table has been created
mysql> <k>SHOW TABLES;</k>
+---------------------+
| Tables_in_southwind |
+---------------------+
| products            |
+---------------------+
 
-- Describe the fields (columns) of the "products" table
mysql> <k>DESCRIBE products;</k>
+-------------+------------------+------+-----+------------+----------------+
| Field       | Type             | Null | Key | Default    | Extra          |
+-------------+------------------+------+-----+------------+----------------+
| productID   | int(10) unsigned | NO   | PRI | NULL       | auto_increment |
| productCode | char(3)          | NO   |     |            |                |
| name        | varchar(30)      | NO   |     |            |                |
| quantity    | int(10) unsigned | NO   |     | 0          |                |
| price       | decimal(7,2)     | NO   |     | 99999.99   |                |
+-------------+------------------+------+-----+------------+----------------+
 
-- Show the complete CREATE TABLE statement used by MySQL to create this table
mysql> <k>SHOW CREATE TABLE products \G</k>
*************************** 1. row ***************************
       Table: products
Create Table: 
CREATE TABLE `products` (
  `productID`    int(10) unsigned  NOT NULL AUTO_INCREMENT,
  `productCode`  char(3)           NOT NULL DEFAULT '',
  `name`         varchar(30)       NOT NULL DEFAULT '',
  `quantity`     int(10) unsigned  NOT NULL DEFAULT '0',
  `price`        decimal(7,2)      NOT NULL DEFAULT '99999.99',
  PRIMARY KEY (`productID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1

<h5>Explanations</h5>

We define 5 columns in the table <mk>products</mk>: <mk>productID</mk>, <mk>productCode</mk>, <mk>name</mk>, <mk>quantity</mk> and <mk>price</mk>. The  types are:

<mk>productID</mk> is<mk> INT UNSIGNED  </mk> - non-negative integers.
<mk>productCode</mk> is <mk>CHAR(3)</mk> - a fixed-length alphanumeric string of 3 characters.
<mk>name</mk> is <mk>VARCHAR(30)</mk> - a variable-length string of up to 30 characters.<br />
We use fixed-length string for <mk>productCode</mk>, as we assume that the <mk>productCode</mk> contains exactly 3 characters.
On the other hand, we use variable-length string for <mk>name</mk>, as its length varies - <mk>VARCHAR</mk> is more efficient than <mk>CHAR</mk>.
<mk>quantity</mk> is also <mk>INT UNSIGNED</mk> (non-negative integers).
<mk>price</mk> is<mk> DECIMAL(10,2) </mk>- a decimal number with 2 decimal places.<br />
<mk>DECIMAL</mk> is precise (represented as integer with a fix decimal point). On the other hand, <mk>FLOAT</mk> and <mk>DOUBLE</mk> (real numbers) are not precise and are approximated. <mk>DECIMAL</mk> type is recommended for currency.

The attribute "<mk>NOT NULL</mk>" specifies that the column cannot contain the <mk>NULL</mk> value. <mk>NULL</mk> is a special value indicating "no value", "unknown value" or "missing value". In our case, these columns shall have a proper value.
We also set the default value of the columns.
The column will take on its default value, if no value is specified during the record creation.

We set the column <mk>productID</mk> as the so-called primary key.
Values of the primary-key column must be unique.
Every table shall contain a primary key.
This ensures that every row can be distinguished from other rows.
You can specify a single column or a set of columns (e.g., <mk>firstName</mk> and <mk>lastName</mk>) as the primary key.
An index is build automatically on the primary-key column to facilitate fast search.
Primary key is also used as reference by other tables.

We set the column <mk>productID</mk> to <mk>AUTO_INCREMENT</mk>.
with default starting value of 1. When you insert a row with <mk>NULL</mk> (recommended) (or 0, or a missing value) for the <mk>AUTO_INCREMENT</mk> column, the maximum value of that column plus 1 would be inserted.
You can also insert a valid value to an <mk>AUTO_INCREMENT</mk> column, bypassing the auto-increment.

<h3>&emsp;Inserting Rows - INSERT INTO</h3>
Let's fill up our "<mk>products</mk>" table with rows.
We set the <mk>productID</mk> of the first record to 1001, and use <mk>AUTO_INCREMENT</mk> for the rest of records by inserting a <mk>NULL</mk>, or with a missing column value.
Take note that strings must be enclosed with a pair of single quotes (or double quotes).

-- Insert a row with all the column values
mysql> <k>INSERT INTO products VALUES (1001, 'PEN', 'Pen Red', 5000, 1.23);</k>
Query OK, 1 row affected (0.04 sec)
 
-- Insert multiple rows in one command
-- Inserting NULL to the auto_increment column results in max_value + 1
mysql> <k>INSERT INTO products VALUES
         (NULL, 'PEN', 'Pen Blue',  8000, 1.25),
         (NULL, 'PEN', 'Pen Black', 2000, 1.25);</k>
Query OK, 2 rows affected (0.03 sec)
Records: 2  Duplicates: 0  Warnings: 0
 
-- Insert value to selected columns
-- Missing value for the auto_increment column also results in max_value + 1
mysql> <k>INSERT INTO products (productCode, name, quantity, price) VALUES
         ('PEC', 'Pencil 2B', 10000, 0.48),
         ('PEC', 'Pencil 2H', 8000, 0.49);</k>
Query OK, 2 row affected (0.03 sec)
 
-- Missing columns get their default values
mysql> <k>INSERT INTO products (productCode, name) VALUES ('PEC', 'Pencil HB');</k>
Query OK, 1 row affected (0.04 sec)

-- 2nd column (productCode) is defined to be NOT NULL
mysql> <k>INSERT INTO products values (NULL, NULL, NULL, NULL, NULL);</k>
ERROR 1048 (23000): Column 'productCode' cannot be null
 
-- Query the table
mysql> <k>SELECT * FROM products;</k>
+-----------+-------------+-----------+----------+------------+
| productID | productCode | name      | quantity | price      |
+-----------+-------------+-----------+----------+------------+
|      1001 | PEN         | Pen Red   |     5000 |       1.23 |
|      1002 | PEN         | Pen Blue  |     8000 |       1.25 |
|      1003 | PEN         | Pen Black |     2000 |       1.25 |
|      1004 | PEC         | Pencil 2B |    10000 |       0.48 |
|      1005 | PEC         | Pencil 2H |     8000 |       0.49 |
|      1006 | PEC         | Pencil HB |        0 | 9999999.99 |
+-----------+-------------+-----------+----------+------------+
6 rows in set (0.02 sec)
 
-- Remove the last row
mysql> <k>DELETE FROM products WHERE productID = 1006;</k>

<h5>INSERT INTO Syntax</h5>

We can use the <mk>INSERT INTO</mk> statement to insert a new row with all the column values, using the following syntax:

INSERT INTO tableName VALUES (firstColumnValue, ..., lastColumnValue)  -- All columns

You need to list the values in the same order in which the columns are defined in the <mk>CREATE TABLE</mk>, separated by commas.
For columns of string data type (<mk>CHAR</mk>, <mk>VARCHAR</mk>), enclosed the value with a pair of single quotes (or double quotes). For columns of numeric data type (<mk>INT</mk>, <mk>DECIMAL</mk>, <mk>FLOAT</mk>, <mk>DOUBLE</mk>), simply place the number.

You can also insert multiple rows in one <mk>INSERT INTO</mk> statement:

INSERT INTO tableName VALUES 
   (row1FirstColumnValue, ..., row1lastColumnValue),
   (row2FirstColumnValue, ..., row2lastColumnValue), 
   ...

To insert a row with values on selected columns only, use:

-- Insert single record with selected columns
INSERT INTO tableName (column1Name, ..., columnNName) VALUES (column1Value, ..., columnNValue)
-- Alternately, use SET to set the values
INSERT INTO tableName SET column1=value1, column2=value2, ...
 
-- Insert multiple records
INSERT INTO tableName 
   (column1Name, ..., columnNName)
VALUES 
   (row1column1Value, ..., row2ColumnNValue),
   (row2column1Value, ..., row2ColumnNValue),
   ...
The remaining columns will receive their default value, such as <mk>AUTO_INCREMENT</mk>, default, or <mk>NULL</mk>.

<h3>&emsp;Querying the Database - SELECT</h3>
The most common, important and complex task is to query a database for a subset of data that meets your needs - with the <mk>SELECT</mk> command.
The <mk>SELECT</mk> command has the following syntax:

-- List all the rows of the specified columns
SELECT column1Name, column2Name, ... FROM tableName
   
-- List all the rows of ALL columns, * is a wildcard denoting all columns
SELECT * FROM tableName
  
-- List rows that meet the specified criteria in WHERE clause
SELECT column1Name, column2Name,... FROM tableName WHERE criteria
SELECT * FROM tableName WHERE criteria

For examples,

-- List all rows for the specified columns
mysql> <k>SELECT name, price FROM products;</k>
+-----------+-------+
| name      | price |
+-----------+-------+
| Pen Red   |  1.23 |
| Pen Blue  |  1.25 |
| Pen Black |  1.25 |
| Pencil 2B |  0.48 |
| Pencil 2H |  0.49 |
+-----------+-------+
5 rows in set (0.00 sec)
    
-- List all rows of ALL the columns.
The wildcard * denotes ALL columns
mysql> <k>SELECT * FROM products;</k>
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1001 | PEN         | Pen Red   |     5000 |  1.23 |
|      1002 | PEN         | Pen Blue  |     8000 |  1.25 |
|      1003 | PEN         | Pen Black |     2000 |  1.25 |
|      1004 | PEC         | Pencil 2B |    10000 |  0.48 |
|      1005 | PEC         | Pencil 2H |     8000 |  0.49 |
+-----------+-------------+-----------+----------+-------+
5 rows in set (0.00 sec)

<h5>SELECT without Table</h5>
You can also issue <mk>SELECT</mk> without a table.
For example, you can <mk>SELECT</mk> an expression or evaluate a built-in function.

mysql> <k>SELECT 1+1;</k>
+-----+
| 1+1 |
+-----+
|   2 |
+-----+
1 row in set (0.00 sec)
 
mysql> <k>SELECT NOW();</k>
+---------------------+
| NOW()               |
+---------------------+
| 2012-10-24 22:13:29 |
+---------------------+
1 row in set (0.00 sec)

// Multiple columns
mysql> <k>SELECT 1+1, NOW();</k>
+-----+---------------------+
| 1+1 | NOW()               |
+-----+---------------------+
|   2 | 2012-10-24 22:16:34 |
+-----+---------------------+
1 row in set (0.00 sec)

<h5>Comparison Operators</h5>
   
For numbers (<mk>INT</mk>, <mk>DECIMAL</mk>, <mk>FLOAT</mk>), you could use comparison operators: <mk>'='</mk> (equal to), <mk>'&lt;>'</mk> or <mk>'!='</mk> (not equal to), <mk>'>'</mk> (greater than), <mk>'&lt;'</mk> (less than), <mk>'>='</mk> (greater than or equal to), <mk>'&lt;='</mk> (less than or equal to), to compare two numbers.  For example, <mk>price > 1.0</mk>, <mk>quantity &lt;= 500</mk>.

mysql> SELECT name, price FROM products <k>WHERE price &lt; 1.0</k>;
+-----------+-------+
| name      | price |
+-----------+-------+
| Pencil 2B |  0.48 |
| Pencil 2H |  0.49 |
+-----------+-------+
2 rows in set (0.00 sec)
   
mysql> SELECT name, quantity FROM products <k>WHERE quantity &lt;= 2000</k>;
+-----------+----------+
| name      | quantity |
+-----------+----------+
| Pen Black |     2000 |
+-----------+----------+
1 row in set (0.00 sec)

CAUTION: Do not compare <mk>FLOAT</mk>s (real numbers) for equality (<mk>'='</mk> or <mk>'&lt;>'</mk>), as they are not precise.
On the other hand, <mk>DECIMAL</mk> are precise.

For strings, you could also use <mk>'='</mk>, <mk>'&lt;>'</mk>, <mk>'>'</mk>, <mk>'&lt;'</mk>, <mk>'>='</mk>, <mk>'&lt;='</mk> to compare two strings (e.g., <mk>productCode = 'PEC').</mk> The ordering of string depends on the so-called collation chosen.
For example,

mysql> SELECT name, price FROM products <k>WHERE productCode = 'PEN'</k>;
                                      -- String values are quoted
+-----------+-------+
| name      | price |
+-----------+-------+
| Pen Red   |  1.23 |
| Pen Blue  |  1.25 |
| Pen Black |  1.25 |
+-----------+-------+
3 rows in set (0.00 sec)

<h5>String Pattern Matching - LIKE and NOT LIKE</h5>

For strings, in addition to full matching using operators like <mk>'='</mk> and <mk>'&lt;>'</mk>, we can perform pattern matching using operator <mk>LIKE</mk> (or <mk>NOT LIKE</mk>) with wildcard characters.
The wildcard <mk>'_'</mk> matches any single character; <mk>'%'</mk> matches any number of characters (including zero). For example,

<ul>
<mk>'abc%'</mk> matches strings beginning with <mk>'abc'</mk>;
<mk>'%xyz'</mk> matches strings ending with <mk>'xyz'</mk>;
<mk>'%aaa%'</mk> matches strings containing <mk>'aaa'</mk>;
<mk>'___'</mk> matches strings containing exactly three characters; and
<mk>'a_b%'</mk> matches strings beginning with <mk>'a'</mk>, followed by any single character, followed by <mk>'b'</mk>, followed by zero or more characters.
</ul>

-- "name" begins with 'PENCIL'
mysql> SELECT name, price FROM products <k>WHERE name LIKE 'PENCIL%'</k>;
+-----------+-------+
| name      | price |
+-----------+-------+
| Pencil 2B |  0.48 |
| Pencil 2H |  0.49 |
+-----------+-------+
 
-- "name" begins with 'P', followed by any two characters, 
--   followed by space, followed by zero or more characters
mysql> SELECT name, price FROM products <k>WHERE name LIKE 'P__ %'</k>;
+-----------+-------+
| name      | price |
+-----------+-------+
| Pen Red   |  1.23 |
| Pen Blue  |  1.25 |
| Pen Black |  1.25 |
+-----------+-------+

MySQL also support regular expression matching via the <mk>REGEXE</mk> operator.

<h5>Arithmetic Operators</h5>
You can perform arithmetic operations on numeric fields using arithmetic operators, as tabulated below:
<table class="table-zebra" style="width:40%">
<tr><th>Operator</th><th>Description</th></tr>
<tr><td class="text-center font-code">+</td><td>Addition</td></tr>
<tr><td class="text-center font-code">-</td><td>Subtraction</td></tr>
<tr><td class="text-center font-code">*</td><td>Multiplication</td></tr>
<tr><td class="text-center font-code">/</td><td>Division</td></tr>
<tr><td class="text-center font-code">DIV</td><td>Integer Division</td></tr>
<tr><td class="text-center font-code">%</td><td>Modulus (Remainder)</td></tr>
</table>

<h5>Logical Operators - AND, OR, NOT, XOR</h5>

You can combine multiple conditions with boolean operators <mk>AND</mk>, <mk>OR</mk>, <mk>XOR</mk>. You can also invert a condition using operator <mk>NOT</mk>. For examples,

mysql> SELECT * FROM products <k>WHERE quantity >= 5000 AND name LIKE 'Pen %'</k>;
+-----------+-------------+----------+----------+-------+
| productID | productCode | name     | quantity | price |
+-----------+-------------+----------+----------+-------+
|      1001 | PEN         | Pen Red  |     5000 |  1.23 |
|      1002 | PEN         | Pen Blue |     8000 |  1.25 |
+-----------+-------------+----------+----------+-------+
 
mysql> SELECT * FROM products <k>WHERE quantity >= 5000 AND price &lt; 1.24 AND name LIKE 'Pen %'</k>;
+-----------+-------------+---------+----------+-------+
| productID | productCode | name    | quantity | price |
+-----------+-------------+---------+----------+-------+
|      1001 | PEN         | Pen Red |     5000 |  1.23 |
+-----------+-------------+---------+----------+-------+
   
mysql> SELECT * FROM products <k>WHERE NOT (quantity >= 5000 AND name LIKE 'Pen %')</k>;
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1003 | PEN         | Pen Black |     2000 |  1.25 |
|      1004 | PEC         | Pencil 2B |    10000 |  0.48 |
|      1005 | PEC         | Pencil 2H |     8000 |  0.49 |
+-----------+-------------+-----------+----------+-------+

<h5>IN, NOT IN</h5>
   
You can select from members of a set with <mk>IN</mk> (or <mk>NOT IN</mk>) operator.
This is easier and clearer than the equivalent <mk>AND-OR</mk> expression.

mysql> SELECT * FROM products <k>WHERE name IN ('Pen Red', 'Pen Black')</k>;
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1001 | PEN         | Pen Red   |     5000 |  1.23 |
|      1003 | PEN         | Pen Black |     2000 |  1.25 |
+-----------+-------------+-----------+----------+-------+

<h5>BETWEEN, NOT BETWEEN</h5>

To check if the value is within a range, you could use <mk>BETWEEN ... AND ...</mk> operator.
Again, this is easier and clearer than the equivalent <mk>AND-OR</mk> expression.

mysql> SELECT * FROM products 
       <k>WHERE (price BETWEEN 1.0 AND 2.0) AND (quantity BETWEEN 1000 AND 2000)</k>;
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1003 | PEN         | Pen Black |     2000 |  1.25 |
+-----------+-------------+-----------+----------+-------+

<h5>IS NULL, IS NOT NULL</h5>

<mk>NULL</mk> is a special value, which represent "no value", "missing value" or "unknown value". You can checking if a column contains <mk>NULL</mk> by <mk>IS NULL</mk> or <mk>IS NOT NULL</mk>. For example,

mysql> <k>SELECT * FROM products WHERE productCode IS NULL</k>;
Empty set (0.00 sec)

Using comparison operator (such as <mk>=</mk> or <mk>&lt;></mk>) to check for <mk>NULL</mk> is a mistake - a very common mistake.
For example,

SELECT * FROM products WHERE productCode = NULL;
-- This is a common mistake.
NULL cannot be compared.

<h5>ORDER BY Clause</h5>
You can order the rows selected using <mk>ORDER BY</mk> clause, with the following syntax:

SELECT ... FROM tableName
WHERE criteria
<k>ORDER BY columnA ASC|DESC, columnB ASC|DESC, ...</k>

The selected row will be ordered according to the values in <mk>columnA</mk>, in either ascending (<mk>ASC</mk>) (default) or descending (<mk>DESC</mk>) order.
If several rows have the same value in <mk>columnA</mk>, it will be ordered according to <mk>columnB</mk>, and so on.
For strings, the ordering could be case-sensitive or case-insensitive, depending on the so-called character collating sequence used.
For examples,

-- Order the results by price in descending order
mysql> SELECT * FROM products WHERE name LIKE 'Pen %' <k>ORDER BY price DESC</k>;
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1002 | PEN         | Pen Blue  |     8000 |  1.25 |
|      1003 | PEN         | Pen Black |     2000 |  1.25 |
|      1001 | PEN         | Pen Red   |     5000 |  1.23 |
+-----------+-------------+-----------+----------+-------+
 
-- Order by price in descending order, followed by quantity in ascending (default) order
mysql> SELECT * FROM products WHERE name LIKE 'Pen %' <k>ORDER BY price DESC, quantity</k>;
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1003 | PEN         | Pen Black |     2000 |  1.25 |
|      1002 | PEN         | Pen Blue  |     8000 |  1.25 |
|      1001 | PEN         | Pen Red   |     5000 |  1.23 |
+-----------+-------------+-----------+----------+-------+

You can randomize the returned records via function <mk>RAND()</mk>, e.g.,

mysql> SELECT * FROM products <k>ORDER BY RAND();</k>

<h5>LIMIT Clause</h5>
A <mk>SELECT</mk> query on a large database may produce many rows.
You could use the <mk>LIMIT</mk> clause to limit the number of rows displayed, e.g.,

-- Display the first two rows
mysql> SELECT * FROM products ORDER BY price <k>LIMIT 2</k>;
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1004 | PEC         | Pencil 2B |    10000 |  0.48 |
|      1005 | PEC         | Pencil 2H |     8000 |  0.49 |
+-----------+-------------+-----------+----------+-------+ 

To continue to the following records , you could specify the number of rows to be skipped, followed by the number of rows to be displayed in the <mk>LIMIT</mk> clause, as follows:

-- Skip the first two rows and display the next 1 row
mysql> SELECT * FROM products ORDER BY price <k>LIMIT 2, 1</k>;
+-----------+-------------+---------+----------+-------+
| productID | productCode | name    | quantity | price |
+-----------+-------------+---------+----------+-------+
|      1001 | PEN         | Pen Red |     5000 |  1.23 |
+-----------+-------------+---------+----------+-------+

<h5>AS - Alias</h5>
You could use the keyword <mk>AS</mk> to define an alias for an identifier (such as column name, table name). The alias will be used in displaying the name.
It can also be used as reference.
For example,

mysql> SELECT <k>productID AS ID</k>, <k>productCode AS Code</k>,
              <k>name AS Description</k>, <k>price AS `Unit Price`</k>  -- Define aliases to be used as display names
       FROM products
       <k>ORDER BY ID</k>;  -- Use alias ID as reference
+------+------+-------------+------------+
| ID   | Code | Description | Unit Price |
+------+------+-------------+------------+
| 1001 | PEN  | Pen Red     |       1.23 |
| 1002 | PEN  | Pen Blue    |       1.25 |
| 1003 | PEN  | Pen Black   |       1.25 |
| 1004 | PEC  | Pencil 2B   |       0.48 |
| 1005 | PEC  | Pencil 2H   |       0.49 |
+------+------+-------------+------------+

Take note that the identifier "<mk>Unit Price</mk>" contains a blank and must be back-quoted.

<h5>Function CONCAT()</h5>

You can also concatenate a few columns as one (e.g., joining the last name and first name) using function <mk>CONCAT()</mk>. For example,

mysql> SELECT <k>CONCAT(productCode, ' - ', name) AS `Product Description`</k>, price FROM products;
+---------------------+-------+
| Product Description | price |
+---------------------+-------+
| PEN - Pen Red       |  1.23 |
| PEN - Pen Blue      |  1.25 |
| PEN - Pen Black     |  1.25 |
| PEC - Pencil 2B     |  0.48 |
| PEC - Pencil 2H     |  0.49 |
+---------------------+-------+

<h3>&emsp;Producing Summary Reports</h3>
To produce a summary report, we often need to aggregate related rows.

<h5>DISTINCT</h5>
A column may have duplicate values, we could use keyword <mk>DISTINCT</mk> to select only distinct values.
We can also apply <mk>DISTINCT</mk> to several columns to select distinct combinations of these columns.
For examples,

-- Without DISTINCT
mysql> <k>SELECT price FROM products;</k>
+-------+
| price |
+-------+
|  1.23 |
|  1.25 |
|  1.25 |
|  0.48 |
|  0.49 |
+-------+
   
-- With DISTINCT on price
mysql> SELECT <k>DISTINCT price</k> AS `Distinct Price` FROM products<k>;</k>
+----------------+
| Distinct Price |
+----------------+
|           1.23 |
|           1.25 |
|           0.48 |
|           0.49 |
+----------------+
 
-- DISTINCT combination of price and name
mysql> SELECT <k>DISTINCT price, name</k> FROM products<k>;</k>
+-------+-----------+
| price | name      |
+-------+-----------+
|  1.23 | Pen Red   |
|  1.25 | Pen Blue  |
|  1.25 | Pen Black |
|  0.48 | Pencil 2B |
|  0.49 | Pencil 2H |
+-------+-----------+

<h5>GROUP BY Clause</h5>

The <mk>GROUP BY</mk> clause allows you to collapse multiple records with a common value into groups.
For example,

mysql> <k>SELECT * FROM products ORDER BY productCode, productID;</k>
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1004 | PEC         | Pencil 2B |    10000 |  0.48 |
|      1005 | PEC         | Pencil 2H |     8000 |  0.49 |
|      1001 | PEN         | Pen Red   |     5000 |  1.23 |
|      1002 | PEN         | Pen Blue  |     8000 |  1.25 |
|      1003 | PEN         | Pen Black |     2000 |  1.25 |
+-----------+-------------+-----------+----------+-------+
 
mysql> <k>SELECT * FROM products GROUP BY productCode;</k>
       -- Only first record in each group is shown
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1004 | PEC         | Pencil 2B |    10000 |  0.48 |
|      1001 | PEN         | Pen Red   |     5000 |  1.23 |
+-----------+-------------+-----------+----------+-------+

<mk>GROUP BY</mk> by itself is not meaningful.
It is used together with <mk>GROUP BY</mk> aggregate functions (such as <mk>COUNT()</mk>, <mk>AVG()</mk>, <mk>SUM()</mk>) to produce group summary.

<h5>GROUP BY Aggregate Functions: COUNT, MAX, MIN, AVG, SUM, STD, GROUP_CONCAT</h5>

We can apply <mk>GROUP BY</mk> Aggregate functions to each group to produce group summary report.
The function <mk>COUNT(*)</mk> returns the rows selected; <mk>COUNT(columnName)</mk> counts only the non-<mk>NULL</mk> values of the given column.
For example,

-- Function COUNT(*) returns the number of rows selected
mysql> SELECT COUNT(*) AS `Count` FROM products<k>;</k>
       -- All rows without GROUP BY clause
+-------+<br />| Count |<br />+-------+<br />|     5 |<br />+-------+
   
mysql> SELECT productCode, COUNT(*) FROM products GROUP BY productCode;
+-------------+----------+
| productCode | COUNT(*) |
+-------------+----------+
| PEC         |        2 |
| PEN         |        3 |
+-------------+----------+
 
-- Order by COUNT - need to define an alias to be used as reference
mysql> SELECT productCode, COUNT(*) AS count 
       FROM products 
       GROUP BY productCode
       ORDER BY count DESC;
+-------------+-------+
| productCode | count |
+-------------+-------+
| PEN         |     3 |
| PEC         |     2 |
+-------------+-------+

Besides <mk>COUNT()</mk>, there are many other <mk>GROUP BY</mk> aggregate functions such as <mk>AVG()</mk>, <mk>MAX()</mk>, <mk>MIN()</mk> and <mk>SUM()</mk>. For example,

mysql> SELECT MAX(price), MIN(price), AVG(price), STD(price), SUM(quantity)
       FROM products;
       -- Without GROUP BY - All rows
+------------+------------+------------+------------+---------------+
| MAX(price) | MIN(price) | AVG(price) | STD(price) | SUM(quantity) |
+------------+------------+------------+------------+---------------+
|       1.25 |       0.48 |   0.940000 |   0.371591 |         33000 |
+------------+------------+------------+------------+---------------+
 
mysql> SELECT productCode, MAX(price) AS `Highest Price`, MIN(price) AS `Lowest Price`
       FROM products
       GROUP BY productCode;
+-------------+---------------+--------------+
| productCode | Highest Price | Lowest Price |
+-------------+---------------+--------------+
| PEC         |          0.49 |         0.48 |
| PEN         |          1.25 |         1.23 |
+-------------+---------------+--------------+
 
mysql> SELECT productCode, MAX(price), MIN(price),
              CAST(AVG(price) AS DECIMAL(7,2)) AS `Average`,
              CAST(STD(price) AS DECIMAL(7,2)) AS `Std Dev`,
              SUM(quantity)
       FROM products
       GROUP BY productCode;
       -- Use CAST(... AS ...) function to format floating-point numbers
+-------------+------------+------------+---------+---------+---------------+
| productCode | MAX(price) | MIN(price) | Average | Std Dev | SUM(quantity) |
+-------------+------------+------------+---------+---------+---------------+
| PEC         |       0.49 |       0.48 |    0.49 |    0.01 |         18000 |
| PEN         |       1.25 |       1.23 |    1.24 |    0.01 |         15000 |
+-------------+------------+------------+---------+---------+---------------+

<h5>HAVING clause</h5>

<mk>HAVING</mk> is similar to <mk>WHERE</mk>, but it can operate on the <mk>GROUP BY</mk> aggregate functions; whereas <mk>WHERE</mk> operates only on columns.

mysql> SELECT
          productCode AS `Product Code`,
          COUNT(*) AS `Count`,
          CAST(AVG(price) AS DECIMAL(7,2)) AS `Average`
       FROM products 
       GROUP BY productCode
       HAVING Count >=3;
          -- CANNOT use WHERE count >= 3
+--------------+-------+---------+
| Product Code | Count | Average |
+--------------+-------+---------+
| PEN          |     3 |    1.24 |
+--------------+-------+---------+

<h5>WITH ROLLUP</h5>

The <mk>WITH ROLLUP</mk> clause shows the summary of group summary, e.g.,

mysql> SELECT 
          productCode, 
          MAX(price), 
          MIN(price), 
          CAST(AVG(price) AS DECIMAL(7,2)) AS `Average`,
          SUM(quantity)
       FROM products
       GROUP BY productCode
       WITH ROLLUP;        -- Apply aggregate functions to all groups
+-------------+------------+------------+---------+---------------+
| productCode | MAX(price) | MIN(price) | Average | SUM(quantity) |
+-------------+------------+------------+---------+---------------+
| PEC         |       0.49 |       0.48 |    0.49 |         18000 |
| PEN         |       1.25 |       1.23 |    1.24 |         15000 |
| NULL        |       1.25 |       0.48 |    0.94 |         33000 |
+-------------+------------+------------+---------+---------------+

<h3>&emsp;Modifying Data - UPDATE</h3>
To modify existing data, use <mk>UPDATE ... SET </mk> command, with the following syntax:

UPDATE tableName SET columnName = {value|NULL|DEFAULT}, ... WHERE criteria

For example,

-- Increase the price by 10% for all products
mysql> <k>UPDATE products SET price = price * 1.1;</k>
   
mysql> <k>SELECT * FROM products;</k>
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1001 | PEN         | Pen Red   |     5000 |  1.35 |
|      1002 | PEN         | Pen Blue  |     8000 |  1.38 |
|      1003 | PEN         | Pen Black |     2000 |  1.38 |
|      1004 | PEC         | Pencil 2B |    10000 |  0.53 |
|      1005 | PEC         | Pencil 2H |     8000 |  0.54 |
+-----------+-------------+-----------+----------+-------+
   
-- Modify selected rows
mysql> <k>UPDATE products SET quantity = quantity - 100 WHERE name = 'Pen Red';</k>
   
mysql> <k>SELECT * FROM products WHERE name = 'Pen Red';</k>
+-----------+-------------+---------+----------+-------+
| productID | productCode | name    | quantity | price |
+-----------+-------------+---------+----------+-------+
|      1001 | PEN         | Pen Red |     4900 |  1.35 |
+-----------+-------------+---------+----------+-------+
   
-- You can modify more than one values
mysql> <k>UPDATE products SET quantity = quantity + 50, price = 1.23 WHERE name = 'Pen Red';</k>
   
mysql> <k>SELECT * FROM products WHERE name = 'Pen Red';</k>
+-----------+-------------+---------+----------+-------+
| productID | productCode | name    | quantity | price |
+-----------+-------------+---------+----------+-------+
|      1001 | PEN         | Pen Red |     4950 |  1.23 |
+-----------+-------------+---------+----------+-------+

<k>CAUTION</k>: If the <mk>WHERE</mk> clause is omitted in the <mk>UPDATE</mk> command, ALL ROWS will be updated.
Hence, it is a good practice to issue a <mk>SELECT</mk> query, using the same criteria, to check the result set before issuing the <mk>UPDATE</mk>. This also applies to the <mk>DELETE</mk> statement in the following section.

<h3>&emsp;Deleting Rows - DELETE FROM</h3>
Use the <mk>DELELE FROM</mk> command to delete row(s) from a table, with the following syntax:

-- Delete all rows from the table.
Use with extreme care! Records are NOT recoverable!!!
DELETE FROM tableName
-- Delete only row(s) that meets the criteria
DELETE FROM tableName WHERE criteria

For example,

mysql> <k>DELETE FROM products WHERE name LIKE 'Pencil%';</k>
Query OK, 2 row affected (0.00 sec)
   
mysql> <k>SELECT * FROM products;</k>
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1001 | PEN         | Pen Red   |     4950 |  1.23 |
|      1002 | PEN         | Pen Blue  |     8000 |  1.38 |
|      1003 | PEN         | Pen Black |     2000 |  1.38 |
+-----------+-------------+-----------+----------+-------+
  
-- Use this with extreme care, as the deleted records are irrecoverable!
mysql> <k>DELETE FROM products;</k>
Query OK, 3 rows affected (0.00 sec)
   
mysql> <k>SELECT * FROM products;</k>
Empty set (0.00 sec)

Beware that <mk>"DELETE FROM tableName</mk>" without a <mk>WHERE</mk> clause deletes ALL records from the table.
Even with a <mk>WHERE</mk> clause, you might have deleted some records unintentionally.
It is always advisable to issue a <mk>SELECT</mk> command with the same <mk>WHERE</mk> clause to check the result set before issuing the <mk>DELETE</mk> (and <mk>UPDATE</mk>).

<h3>&emsp;Loading/Exporting Data from/to a Text File</h3>
There are several ways to add data into the database: (a) manually issue the <mk>INSERT</mk> commands; (b) run the <mk>INSERT</mk> commands from a script; or (c) load raw data from a file using <mk>LOAD DATA</mk> or via <mk>mysqlimport</mk> utility.

<h5>LOAD DATA LOCAL INFILE ... INTO TABLE ...</h5>
Besides using <mk>INSERT </mk> commands to insert rows, you could keep your raw data in a text file, and load them into the table via the <mk>LOAD DATA</mk> command.
For example, use a text editor to CREATE a NEW FILE called "<mk>products_in.csv</mk>", under "<mk>d:\myProject</mk>" (for Windows) or "<mk>Documents</mk>" (for Mac), containing the following records, where the values are separated by <mk>','</mk>. The file extension of "<mk>.csv</mk>" stands for Comma-Separated Values text file.

\N,PEC,Pencil 3B,500,0.52
\N,PEC,Pencil 4B,200,0.62
\N,PEC,Pencil 5B,100,0.73
\N,PEC,Pencil 6B,500,0.47

You can load the raw data into the <mk>products</mk> table as follows:

<k>(For Windows)</k>
-- Need to use forward-slash (instead of back-slash) as directory separator
mysql> <k>LOAD DATA LOCAL INFILE 'd:/myProject/products_in.csv' INTO TABLE products
         COLUMNS TERMINATED BY ','
         LINES TERMINATED BY '\r\n';</k>
 
<k>(For Macs)</k>
mysql> <k>LOAD DATA LOCAL INFILE '~/Documents/products_in.csv' INTO TABLE products
         COLUMNS TERMINATED BY ',';</k>

mysql> <k>SELECT * FROM products;</k>
+-----------+-------------+-----------+----------+-------+
| productID | productCode | name      | quantity | price |
+-----------+-------------+-----------+----------+-------+
|      1007 | PEC         | Pencil 3B |      500 |  0.52 |
|      1008 | PEC         | Pencil 4B |      200 |  0.62 |
|      1009 | PEC         | Pencil 5B |      100 |  0.73 |
|      1010 | PEC         | Pencil 6B |      500 |  0.47 |
+-----------+-------------+-----------+----------+-------+

Notes:
<ul>
You need to provide the path (absolute or relative) and the filename.
Use Unix-style forward-slash <mk>'/'</mk> as the directory separator, instead of Windows-style back-slash <mk>'\'</mk>.
The default line delimiter (or end-of-line) is <mk>'\n'</mk> (Unix-style). If the text file is prepared in Windows, you need to include <mk>LINES TERMINATED BY '\r\n'</mk>.
The default column delimiter is "tab" (in a so-called TSV file - Tab-Separated Values). If you use another delimiter, e.g. <mk>','</mk>, include <mk>COLUMNS TERMINATED BY ','</mk>.
You need to use <mk>\N</mk> for <mk>NULL</mk>.
</ul>

<h5>mysqlimport Utility Program</h5>
You can also use the <mk>mysqlimport</mk> utility program to load data from a text file.

-- SYNTAX
> <k>mysqlimport -u username -p --local databaseName tableName.tsv
</k>   -- The raw data must be kept in a TSV (Tab-Separated Values) file with filename the same as tablename
 
-- EXAMPLES
-- Create a new file called "products.tsv" containing the following record,
--  and saved under "d:\myProject" (for Windows) or "Documents" (for Mac)
-- The values are separated by tab (not spaces).
\N  PEC  Pencil 3B  500  0.52
\N  PEC  Pencil 4B  200  0.62
\N  PEC  Pencil 5B  100  0.73
\N  PEC  Pencil 6B  500  0.47

<k>(For Windows)</k>
> <k>cd path-to-mysql-bin</k>
> <k>mysqlimport -u root -p --local southwind d:/myProject/products.tsv</k>

<k>(For Macs)</k>
$ <k>cd /usr/local/mysql/bin</k>
$ <k>./mysqlimport -u root -p --local southwind ~/Documents/products.tsv</k>

<h5>SELECT ... INTO OUTFILE ...</h5>

Complimenting <mk>LOAD DATA</mk> command, you can use <mk>SELECT ... INTO OUTFILE fileName FROM tableName</mk> to export data from a table to a text file.
For example,

<k>(For Windows)</k>
mysql> <k>SELECT * FROM products INTO OUTFILE 'd:/myProject/products_out.csv' 
         COLUMNS TERMINATED BY ','
         LINES TERMINATED BY '\r\n';</k>
 
<k>(For Macs)</k>
mysql> <k>SELECT * FROM products INTO OUTFILE '~/Documents/products_out.csv'
         COLUMNS TERMINATED BY ',';</k>

<h3>&emsp;Running a SQL Script</h3>

Instead of manually entering each of the SQL statements, you can keep many SQL statements in a text file, called SQL script, and run the script.
For example, use a programming text editor to prepare the following script and save as "<mk>load_products.sql</mk>" under "<mk>d:\myProject</mk>" (for Windows) or "<mk>Documents</mk>" (for Mac).

DELETE FROM products;
INSERT INTO products VALUES (2001, 'PEC', 'Pencil 3B', 500, 0.52),
                            (NULL, 'PEC', 'Pencil 4B', 200, 0.62),
                            (NULL, 'PEC', 'Pencil 5B', 100, 0.73),
                            (NULL, 'PEC', 'Pencil 6B', 500, 0.47);
SELECT * FROM products;

You can run the script either:

<ol>
via the "<mk>source</mk>" command in a MySQL client.
For example, to restore the <mk>southwind</mk> backup earlier:

<k>(For Windows)</k>
mysql> <k>source d:/myProject/load_products.sql</k>
   -- Use Unix-style forward slash (/) as directory separator
 
<k>(For Macs)</k>
mysql> <k>source ~/Documents/load_products.sql</k>

via the  "batch mode" of the <mk>mysql</mk> client program, by re-directing the input from the script:

<k>(For Windows)</k>
> <k>cd path-to-mysql-bin</k>
> <k>mysql -u root -p southwind &lt; d:\myProject\load_products.sql</k>
 
<k>(For Macs)</k>
$ <k>cd /usr/local/mysql/bin</k>
$ ./<k>mysql -u root -p southwind &lt; ~\Documents\load_products.sql</k>

<h2>More Than One Tables</h2>

Our example so far involves only one table "<mk>products</mk>". A practical database contains many related tables.
Products have suppliers.
If each product has one supplier, and each supplier supplies only one product (known as one-to-one relationship), we can simply add the supplier's data (name, address, phone number) into the <mk>products</mk> table.
Suppose that each product has one supplier, and a supplier may supply zero or more products (known as one-to-many relationship). Putting the supplier's data into the <mk>products</mk> table results in duplication of data.
This is because one supplier may supply many products, hence, the same supplier's data appear in many rows.
This not only wastes the storage but also easily leads to inconsistency (as all duplicate data must be updated simultaneously). The situation is even more complicated if one product has many suppliers, and each supplier can supply many products, in a many-to-many relationship.

<h3>&emsp;One-To-Many Relationship</h3>
Suppose that each product has one supplier, and each supplier supplies one or more products.
We could create a table called <mk>suppliers</mk> to store suppliers' data (e.g., name, address and phone number). We  create a column with unique value called <mk>supplierID</mk> to identify every suppliers.
We set <mk>supplierID</mk> as the primary key for the table <mk>suppliers</mk> (to ensure uniqueness and facilitate fast search).
 To relate the <mk>suppliers</mk> table to the <mk>products</mk> table, we add a new column into the <mk>products</mk> table - the <mk>supplierID</mk>. We then set the <mk>supplierID</mk> column of the <mk>products</mk> table as a foreign key references the <mk>supplierID</mk> column of the <mk>suppliers</mk> table to ensure the so-called referential integrity.

<table class="table-zebra font-code" style="width:40%">
<tr><th colspan="3" style="text-align:left">Database: southwind<br />Table: suppliers</th></tr>
<tr><th>supplierID<br />INT</th><th>name<br />VARCHAR(3)</th><th>phone<br />CHAR(8)</th></tr>
<tr><td><k>501</k></td><td>ABC Traders</td><td>88881111</td></tr>
<tr  class="tr-alt"><td><k>502</k></td><td>XYZ Company</td><td>88882222</td></tr>
<tr><td><k>503</k></td><td>QQ Corp</td><td>88883333</td></tr>
</table>

<br />

<table class="table-zebra font-code" style="width:70%">
<tr><th colspan="6" style="text-align:left">Database: southwind<br />Table: products</th></tr>
<tr><th>productID<br />INT</th><th>productCode<br />CHAR(3)</th><th>name<br />VARCHAR(30)</th><th>quantity<br />INT</th><th>price<br />DECIMAL(10,2)</th><th>supplierID<br />INT<br />(Foreign Key)</th></tr>
<tr><td>2001</td><td>PEC</td><td>Pencil 3B</td><td>500</td><td>0.52</td><td><k>501</k></td></tr>
<tr class="tr-alt"><td>2002</td><td>PEC</td><td>Pencil 4B</td><td>200</td><td>0.62</td><td><k>501</k></td></tr>
<tr><td>2003</td><td>PEC</td><td>Pencil 5B</td><td>100</td><td>0.73</td><td><k>501</k></td></tr>
<tr class="tr-alt"><td>2004</td><td>PEC</td><td>Pencil 6B</td><td>500</td><td>0.47</td><td><k>502</k></td></tr>
</table>

We need to first create the <mk>suppliers</mk> table, because the <mk>products</mk> table references the <mk>suppliers</mk> table.
The <mk>suppliers</mk> table is known as the parent table; while the <mk>products</mk> table is known as the child table in this relationship.

mysql> <k>USE southwind;</k>
   
mysql> <k>DROP TABLE IF EXISTS suppliers;</k>
   
mysql> <k>CREATE TABLE suppliers (
         supplierID  INT UNSIGNED  NOT NULL AUTO_INCREMENT, 
         name        VARCHAR(30)   NOT NULL DEFAULT '', 
         phone       CHAR(8)       NOT NULL DEFAULT '',
         PRIMARY KEY (supplierID)
       );</k>
   
mysql> <k>DESCRIBE suppliers;</k>
+------------+------------------+------+-----+---------+----------------+
| Field      | Type             | Null | Key | Default | Extra          |
+------------+------------------+------+-----+---------+----------------+
| supplierID | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| name       | varchar(30)      | NO   |     |         |                |
| phone      | char(8)          | NO   |     |         |                |
+------------+------------------+------+-----+---------+----------------+
   
mysql> <k>INSERT INTO suppliers VALUE
          (501, 'ABC Traders', '88881111'), 
          (502, 'XYZ Company', '88882222'), 
          (503, 'QQ Corp', '88883333');</k>
   
mysql> <k>SELECT * FROM suppliers;</k>
+------------+-------------+----------+
| supplierID | name        | phone    |
+------------+-------------+----------+
|        501 | ABC Traders | 88881111 |
|        502 | XYZ Company | 88882222 |
|        503 | QQ Corp     | 88883333 |
+------------+-------------+----------+

<h5>ALTER TABLE</h5>

Instead of deleting and re-creating the <mk>products</mk> table, we shall use  "<mk>ALTER TABLE</mk>" to add a new column <mk>supplierID</mk> into the <mk>products</mk> table.

mysql> <k>ALTER TABLE products
       ADD COLUMN supplierID INT UNSIGNED NOT NULL;</k>
Query OK, 4 rows affected (0.13 sec)
Records: 4  Duplicates: 0  Warnings: 0
   
mysql> <k>DESCRIBE products;</k>
+-------------+------------------+------+-----+------------+----------------+
| Field       | Type             | Null | Key | Default    | Extra          |
+-------------+------------------+------+-----+------------+----------------+
| productID   | int(10) unsigned | NO   | PRI | NULL       | auto_increment |
| productCode | char(3)          | NO   |     |            |                |
| name        | varchar(30)      | NO   |     |            |                |
| quantity    | int(10) unsigned | NO   |     | 0          |                |
| price       | decimal(10,2)    | NO   |     | 9999999.99 |                |
| supplierID  | int(10) unsigned | NO   |     | NULL       |                |
+-------------+------------------+------+-----+------------+----------------+

Next, we shall add a foreign key constraint on the <mk>supplierID</mk> columns of the <mk>products</mk> child table 

to the <mk>suppliers</mk> parent table, to ensure that every <mk>supplierID</mk> in the <mk>products</mk> table always refers to a valid <mk>supplierID</mk> in the <mk>suppliers</mk> table - this is called referential integrity.
Before we can add the foreign key, we need to set the <mk>supplierID</mk> of the existing records in the <mk>products</mk> table to a valid <mk>supplierID</mk> in the <mk>suppliers</mk> table (say <mk>supplierID=501</mk>).

-- Set the supplierID of the existing records in "products" table to a VALID supplierID
--   of "suppliers" table
mysql> <k>UPDATE products SET supplierID = 501;</k>
 
-- Add a foreign key constrain
mysql> <k>ALTER TABLE products
       ADD FOREIGN KEY (supplierID) REFERENCES suppliers (supplierID);</k>
 
mysql> <k>DESCRIBE products;</k>
+-------------+------------------+------+-----+------------+----------------+
| Field       | Type             | Null | Key | Default    | Extra          |
+-------------+------------------+------+-----+------------+----------------+
  ......
| supplierID  | int(10) unsigned | NO   | MUL |            |                |
+-------------+------------------+------+-----+------------+----------------+
 
mysql> <k>UPDATE products SET supplierID = 502 WHERE productID  = 2004;</k>
  -- Choose a valid productID
   
mysql> <k>SELECT * FROM products;</k>
+-----------+-------------+-----------+----------+-------+------------+
| productID | productCode | name      | quantity | price | supplierID |
+-----------+-------------+-----------+----------+-------+------------+
|      2001 | PEC         | Pencil 3B |      500 |  0.52 |        501 |
|      2002 | PEC         | Pencil 4B |      200 |  0.62 |        501 |
|      2003 | PEC         | Pencil 5B |      100 |  0.73 |        501 |
|      2004 | PEC         | Pencil 6B |      500 |  0.47 |        502 |
+-----------+-------------+-----------+----------+-------+------------+

<h5>SELECT with JOIN</h5>

<mk>SELECT</mk> command can be used to query and join data from two related tables.
For example, to list the product's <mk>name</mk> (in <mk>products</mk> table) and supplier's <mk>name</mk> (in <mk>suppliers</mk> table), we could join the two table via the two common <mk>supplierID</mk> columns:

-- ANSI style: JOIN ... ON ...
mysql> <k>SELECT products.name, price, suppliers.name 
       FROM products 
          JOIN suppliers ON products.supplierID = suppliers.supplierID
       WHERE price &lt; 0.6;</k>
+-----------+-------+-------------+
| name      | price | name        |
+-----------+-------+-------------+
| Pencil 3B |  0.52 | ABC Traders |
| Pencil 6B |  0.47 | XYZ Company |
+-----------+-------+-------------+
    -- Need to use products.name and suppliers.name to differentiate the two "names"
 
-- Join via WHERE clause (lagacy and not recommended)
mysql> <k>SELECT products.name, price, suppliers.name 
       FROM products, suppliers 
       WHERE products.supplierID = suppliers.supplierID
          AND price &lt; 0.6;</k>
+-----------+-------+-------------+
| name      | price | name        |
+-----------+-------+-------------+
| Pencil 3B |  0.52 | ABC Traders |
| Pencil 6B |  0.47 | XYZ Company |
+-----------+-------+-------------+

In the above query result, two of the columns have the same heading "<mk>name</mk>". We could create aliases for heading<mk></mk>s.

-- Use aliases for column names for display
mysql> <k>SELECT products.name AS `Product Name`, price, suppliers.name AS `Supplier Name` 
       FROM products 
          JOIN suppliers ON products.supplierID = suppliers.supplierID
       WHERE price &lt; 0.6;</k>
+--------------+-------+---------------+
| Product Name | price | Supplier Name |
+--------------+-------+---------------+
| Pencil 3B    |  0.52 | ABC Traders   |
| Pencil 6B    |  0.47 | XYZ Company   |
+--------------+-------+---------------+
 
-- Use aliases for table names too
mysql> <k>SELECT p.name AS `Product Name`, p.price, s.name AS `Supplier Name` 
       FROM products AS p 
          JOIN suppliers AS s ON p.supplierID = s.supplierID
       WHERE p.price &lt; 0.6;</k>

The database diagram is as illustrated.
The link indicates a one-to-many relationship between <mk>products</mk> and <mk>suppliers</mk>.
<img class="image-center image-border" src="images/SouthWind_OneToManyEER.png" alt="Database diagram" />

<h3>&emsp;Many-To-Many Relationship</h3>
Suppose that a product  has many suppliers; and a supplier supplies many products in a so-called many-to-many relationship.
The above solution breaks.
You cannot include the <mk>supplierID</mk> in the <mk>products</mk> table, as you cannot determine the number of suppliers, and hence, the number of columns needed for the <mk>supplierID</mk>s.
Similarly, you cannot include the <mk>productID</mk> in the <mk>suppliers</mk> table, as you cannot determine the number of products.
To resolve this problem, you need to create a new table, known as a junction table (or joint table), to provide the linkage.
Let's call the junction table <mk>products_suppliers</mk>, as illustrated.

<table class="table-zebra font-code" style="width:40%">
<tr><th colspan="3" style="text-align:left">Database: southwind<br />Table: products_suppliers</th></tr>
<tr><th>productID<br />INT<br />(Foreign Key)</th><th>supplierID<br />INT<br />(Foreign Key)</th></tr>

<tr><td>2001</td><td>501</td></tr>

<tr class="tr-alt"><td>2002</td><td>501</td></tr>

<tr><td>2003</td><td>501</td></tr>

<tr class="tr-alt"><td>2004</td><td>502</td></tr>
<tr>  <td>2001</td><td>503</td></tr>
</table>
<br />

<table class="table-zebra font-code" style="width:40%">
<tr><th colspan="3" style="text-align:left">Database: southwind<br />Table: suppliers</th></tr>
<tr>  <th>supplierID<br />INT</th>
  <th>name<br />VARCHAR(30)</th>
  <th>phone<br />CHAR(8)</th></tr>
<tr>  <td><k>501</k></td><td>ABC Traders</td><td>88881111</td></tr>
<tr  class="tr-alt"><td><k>502</k></td><td>XYZ Company</td><td>88882222</td></tr>
<tr>  <td><k>503</k></td><td>QQ Corp</td><td>88883333</td></tr>
</table>
<br />

<table class="table-zebra font-code"  style="width:60%">
<tr>  <th colspan="5" style="text-align:left">Database: southwind<br />Table: products</th></tr>
<tr>  <th>productID<br />INT</th>
  <th>productCode<br />CHAR(3)</th>
  <th>name<br />VARCHAR(30)</th>
  <th>quantity<br />INT</th>
  <th>price<br />DECIMAL(10,2)</th></tr>
<tr>  <td><k>2001</k></td><td>PEC</td><td>Pencil 3B</td><td>500</td><td>0.52</td></tr>
<tr  class="tr-alt"><td><k>2002</k></td><td>PEC</td><td>Pencil 4B</td><td>200</td><td>0.62</td></tr>
<tr>  <td><k>2003</k></td><td>PEC</td><td>Pencil 5B</td><td>100</td><td>0.73</td></tr>
<tr  class="tr-alt"><td><k>2004</k></td><td>PEC</td><td>Pencil 6B</td><td>500</td><td>0.47</td></tr>
</table>

Let's create the <mk>products_suppliers</mk> table.  The primary key of the table consists of two columns: <mk>productID</mk> and <mk>supplierID</mk>, as their combination uniquely identifies each rows.
This primary key is defined to ensure uniqueness.
Two foreign keys are defined to set the constraint to the two parent tables.

mysql> <k>CREATE TABLE products_suppliers (
         productID   INT UNSIGNED  NOT NULL,
         supplierID  INT UNSIGNED  NOT NULL,
                     -- Same data types as the parent tables
         PRIMARY KEY (productID, supplierID),
                     -- uniqueness
         FOREIGN KEY (productID)  REFERENCES products  (productID),
         FOREIGN KEY (supplierID) REFERENCES suppliers (supplierID)
       );</k>
   
mysql> <k>DESCRIBE products_suppliers;</k>
+------------+------------------+------+-----+---------+-------+
| Field      | Type             | Null | Key | Default | Extra |
+------------+------------------+------+-----+---------+-------+
| productID  | int(10) unsigned | NO   | PRI | NULL    |       |
| supplierID | int(10) unsigned | NO   | PRI | NULL    |       |
+------------+------------------+------+-----+---------+-------+
  
mysql> <k>INSERT INTO products_suppliers VALUES (2001, 501), (2002, 501),
       (2003, 501), (2004, 502), (2001, 503);</k>
-- Values in the foreign-key columns (of the child table) must match 
--   valid values in the columns they reference (of the parent table)
   
mysql> <k>SELECT * FROM products_suppliers;</k>
+-----------+------------+
| productID | supplierID |
+-----------+------------+
|      2001 |        501 |
|      2002 |        501 |
|      2003 |        501 |
|      2004 |        502 |
|      2001 |        503 |
+-----------+------------+

Next, remove the <mk>supplierID</mk> column from the <mk>products</mk> table.  (This column was added to establish the one-to-many relationship.
It is no longer needed in the many-to-many relationship.)
Before this column can be removed, you need to remove the foreign key that builds on this column.
To remove a key in MySQL, you need to know its constraint name, which was generated by the system.
To find the constraint name, issue a "<mk>SHOW CREATE TABLE products</mk>" and take note of the foreign key's constraint name in the clause "<mk>CONSTRAINT constraint_name FOREIGN KEY ....</mk>". You can then drop the foreign key using "<mk>ALTER TABLE products DROP FOREIGN KEY constraint_name</mk>"

mysql> <k>SHOW CREATE TABLE products \G</k>
Create Table: CREATE TABLE `products` (
  `productID`   int(10) unsigned  NOT NULL AUTO_INCREMENT,
  `productCode` char(3)           NOT NULL DEFAULT '',
  `name`        varchar(30)       NOT NULL DEFAULT '',
  `quantity`    int(10) unsigned  NOT NULL DEFAULT '0',
  `price`       decimal(7,2)      NOT NULL DEFAULT '99999.99',
  `supplierID`  int(10) unsigned   NOT NULL DEFAULT '501',
  PRIMARY KEY (`productID`),
  KEY `supplierID` (`supplierID`),
  CONSTRAINT <k>`products_ibfk_1`</k> FOREIGN KEY (`supplierID`) 
     REFERENCES `suppliers` (`supplierID`)
) ENGINE=InnoDB AUTO_INCREMENT=1006 DEFAULT CHARSET=latin1
 
mysql> <k>ALTER TABLE products DROP FOREIGN KEY products_ibfk_1;</k>

mysql> <k>SHOW CREATE TABLE products \G</k>

Now, we can remove the column redundant <mk>supplierID</mk> column.

mysql> <k>ALTER TABLE products DROP supplierID;</k>
 
mysql> <k>DESC products;</k>

<h5>Querying</h5>

Similarly, we can use <mk>SELECT</mk> with <mk>JOIN</mk> to query data from the 3 tables, for examples,

mysql> <k>SELECT products.name AS `Product Name`, price, suppliers.name AS `Supplier Name`
       FROM products_suppliers 
          JOIN products  ON products_suppliers.productID = products.productID
          JOIN suppliers ON products_suppliers.supplierID = suppliers.supplierID
       WHERE price &lt; 0.6;</k>
+--------------+-------+---------------+
| Product Name | price | Supplier Name |
+--------------+-------+---------------+
| Pencil 3B    |  0.52 | ABC Traders   |
| Pencil 3B    |  0.52 | QQ Corp       |
| Pencil 6B    |  0.47 | XYZ Company   |
+--------------+-------+---------------+

-- Define aliases for tablenames too 
mysql> <k>SELECT p.name AS `Product Name`, s.name AS `Supplier Name`
       FROM products_suppliers AS ps 
          JOIN products AS p ON ps.productID = p.productID
          JOIN suppliers AS s ON ps.supplierID = s.supplierID
       WHERE p.name = 'Pencil 3B';</k>
+--------------+---------------+
| Product Name | Supplier Name |
+--------------+---------------+
| Pencil 3B    | ABC Traders   |
| Pencil 3B    | QQ Corp       |
+--------------+---------------+
  
-- Using WHERE clause to join (legacy and not recommended)
mysql> <k>SELECT p.name AS `Product Name`, s.name AS `Supplier Name`
       FROM products AS p, products_suppliers AS ps, suppliers AS s
       WHERE p.productID = ps.productID
          AND ps.supplierID = s.supplierID
          AND s.name = 'ABC Traders';</k>
+--------------+---------------+
| Product Name | Supplier Name |
+--------------+---------------+
| Pencil 3B    | ABC Traders   |
| Pencil 4B    | ABC Traders   |
| Pencil 5B    | ABC Traders   |
+--------------+---------------+

The database diagram is as follows.
Both <mk>products</mk> and <mk>suppliers</mk> tables exhibit a one-to-many relationship to the junction table.
The many-to-many relationship is supported via the junction table.

<img class="image-center image-border" src="images/SouthWind_ManyToManyEER.png" alt="Database diagram" />

<h3>&emsp;One-to-one Relationship</h3>
Suppose that some products have optional data (e.g., photo, comment). Instead of keeping these optional data in the <mk>products</mk> table, it is more efficient to create another table called <mk>product_detail</mk>s, and link it to <mk>products</mk> with a one-to-one relationship, as illustrated.

<img class="image-center image-border" src="images/SouthWind_EER.png" alt="Database diagram" />

mysql> <k>CREATE TABLE product_details (
          productID  INT UNSIGNED   NOT NULL,
                     -- same data type as the parent table
          comment    TEXT  NULL,
                     -- up to 64KB
          PRIMARY KEY (productID),
          FOREIGN KEY (productID) REFERENCES products (productID)
       );</k>

mysql> <k>DESCRIBE product_details;</k>
+-----------+------------------+------+-----+---------+-------+
| Field     | Type             | Null | Key | Default | Extra |
+-----------+------------------+------+-----+---------+-------+
| productID | int(10) unsigned | NO   | PRI | NULL    |       |
| comment   | text             | YES  |     | NULL    |       |
+-----------+------------------+------+-----+---------+-------+

mysql> <k>SHOW CREATE TABLE product_details \G</k>
*************************** 1. row ***************************
       Table: product_details
Create Table: CREATE TABLE `product_details` (
  `productID`  int(10) unsigned  NOT NULL,
  `comment`    text,
  PRIMARY KEY (`productID`),
  CONSTRAINT `product_details_ibfk_1` FOREIGN KEY (`productID`) REFERENCES `products` (`productID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1

<h3>&emsp;Backup and Restore</h3>

Backup: Before we conclude this example, let's run the <mk>mysqldump</mk> utility program to dump out (backup) the entire <mk>southwind</mk> database.

<k>(For Windows)</k>
-- Start a NEW "cmd"
> <k>cd path-to-mysql-bin</k>
> <k>mysqldump -u root -p --databases southwind > "d:\myProject\backup_southwind.sql"</k>
 
<k>(For Macs)</k>
-- Start a NEW "terminal"
$ <k>cd /usr/local/mysql/bin</k>
$ <k>./mysqldump -u root -p --databases southwind > ~/Documents/backup_southwind.sql</k>

Study the output file, which contains <mk>CREATE DATABASE</mk>, <mk>CREATE TABLE</mk> and <mk>INSERT</mk> statements to re-create the tables dumped.
The SYNTAX for the <mk>mysqldump</mk> utility program is as follows:

-- Dump selected databases with --databases option
> mysqldump -u username -p --databases database1Name [database2Name ...] > backupFile.sql
-- Dump all databases in the server with --all-databases option, except mysql.user table (for security)
> mysqldump -u root -p --all-databases --ignore-table=mysql.user > backupServer.sql
  
-- Dump all the tables of a particular database
> mysqldump -u username -p databaseName > backupFile.sql
-- Dump selected tables of a particular database
> mysqldump -u username -p databaseName table1Name [table2Name ...] > backupFile.sql

Restore: The utility <mk>mysqldump</mk> produces a SQL script (consisting of <mk>CREATE TABLE</mk> and <mk>INSERT</mk> commands to re-create the tables and loading their data). You can restore from the backup by running the script either:

<ol>
via the "<mk>source</mk>" command in an interactive client.
For example, to restore the <mk>southwind</mk> backup earlier:

<k>(For Windows)</k>
-- Start a MySQL client
mysql> <k>source d:/myProject/backup_southwind.sql</k>
   -- Provide absolute or relative filename of the script
   -- Use Unix-style forward slash (/) as path separator
 
<k>(For Macs)</k>
-- Start a MySQL client
mysql> <k>source ~/Documents/backup_southwind.sql</k>

via the  "batch mode" of the <mk>mysql</mk> client program by re-directing the input from the script:

<k>(For Windows)</k>
-- Start a NEW "cmd"
> <k>cd path-to-mysql-bin</k>
> <k>mysql -u root -p southwind &lt; d:\myProject\backup_southwind.sql</k>
 
<k>(For Macs)</k>
-- Start a NEW "terminal"
$ <k>cd /usr/local/mysql/bin</k>
$ <k>./mysql -u root -p southwind &lt; ~/Documents/backup_southwind.sql</k>

<h2>More on Primary Key, Foreign Key and Index</h2>

<h3>&emsp;Primary Key</h3>

In the relational model, a table shall not contain duplicate rows, because that would create ambiguity in retrieval.
To ensure uniqueness, each table should have a column (or a set of columns), called primary key, that uniquely identifies every record of the table.
For example, an unique number <mk>customerID</mk> can be used as the primary key for the <mk>customers</mk> table; <mk>productCode</mk> for <mk>products</mk> table; <mk>isbn</mk> for <mk>books</mk> table.
A primary key is called a simple key if it is a single column; it is called a composite key if it is made up of several columns.
Most RDBMSs build an index on the primary key to facilitate fast search.
The primary key is often used to relate to other tables.

<h3>&emsp;Foreign Key</h3>
A foreign key of a child table is used to reference the parent table.
Foreign key constraint can be imposed to ensure so-called referential integrity - values in the child table must be valid values in the parent table.

We define the foreign key when defining the child table, which references a parent table, as follows:

-- Child table definition
CREATE TABLE tableName (
   ......
   ......
   CONSTRAINT constraintName FOREIGN KEY (columName) REFERENCES parentTableName (columnName)
     [ON DELETE RESTRICT | CASCADE | SET NULL | NO ACTION]   -- On DELETE reference action
     [ON UPDATE RESTRICT | CASCADE | SET NULL | NO ACTION]   -- On UPDATE reference action
)

You can specify the reference action for <mk>UPDATE</mk> and <mk>DELETE</mk> via the optional <mk>ON UPDATE</mk> and <mk>ON DELETE</mk> clauses:

<ol>
<mk>RESTRICT</mk> (default): disallow <mk>DELETE</mk> or <mk>UPDATE</mk> of the parent's row, if there are matching rows in child table.
<mk>CASCADE</mk>: cascade the <mk>DELETE</mk> or <mk>UPDATE</mk> action to the matching rows in the child table.
<mk>SET NULL</mk>: set the foreign key value in the child table to <mk>NULL</mk> (if <mk>NULL</mk> is allowed).
<mk>NO ACTION</mk>: a SQL term which means no action on the parent's row.
Same as <mk>RESTRICT</mk> in MySQL, which disallows <mk>DELETE</mk> or <mk>UPDATE</mk> (do nothing).

Try deleting a record in the <mk>suppliers</mk> (parent) table that is referenced by <mk>products_suppliers</mk> (child) table, e.g.,

mysql> <k>SELECT * FROM products_suppliers;</k>
+-----------+------------+
| productID | supplierID |
+-----------+------------+
|      2001 |        <k>501</k> |
|      2002 |        <k>501</k> |
|      2003 |        <k>501</k> |
|      2004 |        502 |
|      2001 |        503 |
+-----------+------------+
 
-- Try deleting a row from parent table with matching rows in the child table
mysql> DELETE FROM suppliers WHERE supplierID = 501;
<k>ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails 
(`southwind`.`products_suppliers`, CONSTRAINT `products_suppliers_ibfk_2` 
FOREIGN KEY (`supplierID`) REFERENCES `suppliers` (`supplierID`))</k>

The record cannot be deleted as the default "<mk>ON DELETE RESTRICT</mk>" constraint was imposed.

<h3>&emsp;Indexes (or Keys)</h3>

Indexes (or Keys) can be created on selected column(s) to facilitate fast search.
Without index, a "<mk>SELECT * FROM products WHERE productID=x</mk>" needs to match with the <mk>productID</mk> column of all the records in the <mk>products</mk> table.
If <mk>productID</mk> column is indexed (e.g., using a binary tree), the matching can be greatly improved (via the binary tree search).
You should index columns which are frequently used in the <mk>WHERE</mk> clause; and as <mk>JOIN</mk> columns.
The drawback about indexing is cost and space.
Building and maintaining indexes require computations and memory spaces.
Indexes facilitate fast search but deplete the performance on modifying the table (<mk>INSERT/UPDATE/DELETE</mk>), and need to be justified.
Nevertheless, relational databases are typically optimized for queries and retrievals, but NOT for updates.
In MySQL, the keyword <mk>KEY</mk> is synonym to <mk>INDEX</mk>. 

In MySQL, indexes can be built on:
<ol>
a single column (column-index)
a set of columns (concatenated-index)
on unique-value column (<mk>UNIQUE INDEX</mk> or <mk>UNIQUE KEY</mk>)
on a prefix of a column for strings (<mk>VARCHAR</mk> or <mk>CHAR</mk>), e.g., first 5 characters.
  

There can be more than one indexes in a table.
Index are automatically built on the primary-key column(s).

You can build index via <mk>CREATE TABLE</mk>, <mk>CREATE INDEX</mk> or <mk>ALTER TABLE</mk>.

CREATE TABLE tableName (
   ......
   [UNIQUE] INDEX|KEY indexName (columnName, ...),
      -- The optional keyword UNIQUE ensures that all values in this column are distinct
      -- KEY is synonym to INDEX
   ......
   PRIMAY KEY (columnName, ...)  -- Index automatically built on PRIMARY KEY column
);
 
CREATE [UNIQUE] INDEX indexName ON tableName(columnName, ...);
 
ALTER TABLE tableName ADD UNIQUE|INDEX|PRIMARY KEY indexName (columnName, ...)
 
SHOW INDEX FROM tableName;

<h5>Example</h5>

mysql> <k>CREATE TABLE employees (
          emp_no      INT UNSIGNED   NOT NULL AUTO_INCREMENT,
          name        VARCHAR(50)    NOT NULL,
          gender      ENUM ('M','F') NOT NULL,    
          birth_date  DATE           NOT NULL,
          hire_date   DATE           NOT NULL,
          PRIMARY KEY (emp_no)  -- Index built automatically on primary-key column
       );</k>
 
mysql> <k>DESCRIBE employees;</k>
+------------+------------------+------+-----+---------+----------------+
| Field      | Type             | Null | Key | Default | Extra          |
+------------+------------------+------+-----+---------+----------------+
| emp_no     | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| name       | varchar(50)      | NO   |     | NULL    |                |
| gender     | enum('M','F')    | NO   |     | NULL    |                |
| birth_date | date             | NO   |     | NULL    |                |
| hire_date  | date             | NO   |     | NULL    |                |
+------------+------------------+------+-----+---------+----------------+
 
mysql> <k>SHOW INDEX FROM employees \G</k>
*************************** 1. row ***************************
        Table: employees
   Non_unique: 0
     Key_name: PRIMARY
 Seq_in_index: 1
  Column_name: emp_no
     .......

mysql> <k>CREATE TABLE departments (
         dept_no    CHAR(4)      NOT NULL,
         dept_name  VARCHAR(40)  NOT NULL,
         PRIMARY KEY  (dept_no),   -- Index built automatically on primary-key column
         UNIQUE INDEX (dept_name)  -- Build INDEX on this unique-value column
       );</k>
 
mysql> <k>DESCRIBE departments;</k>
+-----------+-------------+------+-----+---------+-------+
| Field     | Type        | Null | Key | Default | Extra |
+-----------+-------------+------+-----+---------+-------+
| dept_no   | char(4)     | NO   | PRI | NULL    |       |
| dept_name | varchar(40) | NO   | UNI | NULL    |       |
+-----------+-------------+------+-----+---------+-------+

mysql> <k>SHOW INDEX FROM departments \G</k>
*************************** 1. row ***************************
        Table: departments
   Non_unique: 0
     Key_name: PRIMARY
 Seq_in_index: 1
  Column_name: dept_no
      .......
*************************** 2. row ***************************
        Table: departments
   Non_unique: 0
     Key_name: dept_name
 Seq_in_index: 1
  Column_name: dept_name
      .......
 
-- Many-to-many junction table between employees and departments
mysql> <k>CREATE TABLE dept_emp (
         emp_no     INT UNSIGNED  NOT NULL,
         dept_no    CHAR(4)       NOT NULL,
         from_date  DATE          NOT NULL,
         to_date    DATE          NOT NULL,
         INDEX       (emp_no),          -- Build INDEX on this non-unique-value column
         INDEX       (dept_no),         -- Build INDEX on this non-unique-value column
         FOREIGN KEY (emp_no)  REFERENCES employees (emp_no) 
            ON DELETE CASCADE ON UPDATE CASCADE,
         FOREIGN KEY (dept_no) REFERENCES departments (dept_no)
            ON DELETE CASCADE ON UPDATE CASCADE,
         PRIMARY KEY (emp_no, dept_no)  -- Index built automatically
     );</k>
 
mysql> <k>DESCRIBE dept_emp;</k>
+-----------+------------------+------+-----+---------+-------+
| Field     | Type             | Null | Key | Default | Extra |
+-----------+------------------+------+-----+---------+-------+
| emp_no    | int(10) unsigned | NO   | PRI | NULL    |       |
| dept_no   | char(4)          | NO   | PRI | NULL    |       |
| from_date | date             | NO   |     | NULL    |       |
| to_date   | date             | NO   |     | NULL    |       |
+-----------+------------------+------+-----+---------+-------+
 
mysql> <k>SHOW INDEX FROM dept_emp \G</k>
*************************** 1. row ***************************
        Table: dept_emp
   Non_unique: 0
     Key_name: PRIMARY
 Seq_in_index: 1
  Column_name: emp_no
     ........ 
*************************** 2. row ***************************
        Table: dept_emp
   Non_unique: 0
     Key_name: PRIMARY
 Seq_in_index: 2
  Column_name: dept_no
     ........ 
*************************** 3. row ***************************
        Table: dept_emp
   Non_unique: 1
     Key_name: emp_no
 Seq_in_index: 1
  Column_name: emp_no
     ........ 
*************************** 4. row ***************************
        Table: dept_emp
   Non_unique: 1
     Key_name: dept_no
 Seq_in_index: 1
  Column_name: dept_no
     ........

<h2>More SQL</h2>

<h3>&emsp;Sub-Query</h3>
Results of one query can be used in another SQL statement.
Subquery is useful if more than one tables are involved.

<h5>SELECT with Subquery</h5>

In the previous many-to-many product sales example, how to find the suppliers that do not supply any product? You can query for the suppliers that supply at least one product in the <mk>products_suppliers</mk> table, and then query the <mk>suppliers</mk> table for those that are not in the previous result set.

mysql> SELECT suppliers.name from suppliers
       WHERE suppliers.supplierID
          NOT IN (SELECT DISTINCT supplierID from products_suppliers);

Can you do this without sub-query?

A subquery may return a scalar, a single column, a single row, or a table.
You can use comparison operator (e.g., <mk>'='</mk>, <mk>'>'</mk>) on scalar, <mk>IN</mk> or <mk>NOT IN</mk> for single row or column, <mk>EXISTS</mk> or <mk>NOT EXIST</mk> to test for empty set.

<h5>INSERT|UPDATE|DELETE with Subquery</h5>
You can also use a subquery with other SQL statements such as <mk>INSERT</mk>, <mk>DELETE</mk>, or <mk>UPDATE</mk>. For example,

-- Supplier 'QQ Corp' now supplies 'Pencil 6B'
-- You need to put the SELECT subqueies in parentheses
mysql> INSERT INTO products_suppliers VALUES (
          (SELECT productID  FROM products  WHERE name = 'Pencil 6B'),
          (SELECT supplierID FROM suppliers WHERE name = 'QQ Corp'));
 
-- Supplier 'QQ Copr' no longer supplies any item
mysql> DELETE FROM products_suppliers
       WHERE supplierID = (SELECT supplierID FROM suppliers WHERE name = 'QQ Corp');

<h3>&emsp;Working with Date and Time</h3>

Date and time are of particular interest for database applications.
This is because business records often carry date/time information (e.g., <mk>orderDate</mk>, <mk>deliveryDate</mk>, <mk>paymentDate</mk>, <mk>dateOfBirth</mk>), as well as the need to time-stamp the creation and last-update of the records for auditing and security.
With date/time data types, you can sort the results by date, search for a particular date or a range of dates, calculate the difference between dates, compute a new date by adding/subtracting an interval from a given date.

<h5>Date By Example</h5>
Let's begin with Date (without Time) with the following example.
Take note that date value must be written as a string in the format of <mk>'yyyy-mm-dd'</mk>, e.g., <mk>'2012-01-31'</mk>.

-- Create a table 'patients' of a clinic
mysql> <k>CREATE TABLE patients (
          patientID      INT UNSIGNED  NOT NULL AUTO_INCREMENT,
          name           VARCHAR(30)   NOT NULL DEFAULT '',
          dateOfBirth    DATE          NOT NULL,
          lastVisitDate  DATE          NOT NULL,
          nextVisitDate  DATE          NULL,
                         -- The 'Date' type contains a date value in 'yyyy-mm-dd'
          PRIMARY KEY (patientID)
       );</k>
 
mysql> <k>INSERT INTO patients VALUES
          (1001, 'Ah Teck', '1991-12-31', '2012-01-20', NULL),
          (NULL, 'Kumar', '2011-10-29', '2012-09-20', NULL),
          (NULL, 'Ali', '2011-01-30', CURDATE(), NULL);</k>
-- Date must be written as 'yyyy-mm-dd'
-- Function CURDATE() returns today's date
 
mysql> <k>SELECT * FROM patients;</k>
+-----------+---------+-------------+---------------+---------------+
| patientID | name    | dateOfBirth | lastVisitDate | nextVisitDate |
+-----------+---------+-------------+---------------+---------------+
|      1001 | Ah Teck | 1991-12-31  | 2012-01-20    | NULL          |
|      1002 | Kumar   | 2011-10-29  | 2012-09-20    | NULL          |
|      1003 | Ali     | 2011-01-30  | 2012-10-21    | NULL          |
+-----------+---------+-------------+---------------+---------------+

-- Select patients who last visited on a particular range of date
mysql> <k>SELECT * FROM patients
       WHERE lastVisitDate BETWEEN '2012-09-15' AND CURDATE()
       ORDER BY lastVisitDate;</k>
+-----------+-------+-------------+---------------+---------------+
| patientID | name  | dateOfBirth | lastVisitDate | nextVisitDate |
+-----------+-------+-------------+---------------+---------------+
|      1002 | Kumar | 2011-10-29  | 2012-09-20    | NULL          |
|      1003 | Ali   | 2011-01-30  | 2012-10-21    | NULL          |
+-----------+-------+-------------+---------------+---------------+
 
-- Select patients who were born in a particular year and sort by birth-month
-- Function YEAR(date), MONTH(date), DAY(date) returns 
--   the year, month, day part of the given date
mysql> <k>SELECT * FROM patients
       WHERE YEAR(dateOfBirth) = 2011
       ORDER BY MONTH(dateOfBirth), DAY(dateOfBirth);</k>
+-----------+-------+-------------+---------------+---------------+
| patientID | name  | dateOfBirth | lastVisitDate | nextVisitDate |
+-----------+-------+-------------+---------------+---------------+
|      1003 | Ali   | 2011-01-30  | 2012-10-21    | NULL          |
|      1002 | Kumar | 2011-10-29  | 2012-09-20    | NULL          |
+-----------+-------+-------------+---------------+---------------+
 
-- Select patients whose birthday is today
mysql> <k>SELECT * FROM patients
       WHERE MONTH(dateOfBirth) = MONTH(CURDATE()) 
          AND DAY(dateOfBirth) = DAY(CURDATE());</k>
 
-- List the age of patients
-- Function TIMESTAMPDIFF(unit, start, end) returns the difference in the unit specified
mysql> <k>SELECT name, dateOfBirth, TIMESTAMPDIFF(YEAR, dateOfBirth, CURDATE()) AS age 
       FROM patients
       ORDER BY age, dateOfBirth;</k>
+---------+-------------+------+
| name    | dateOfBirth | age  |
+---------+-------------+------+
| Kumar   | 2011-10-29  |    0 |
| Ali     | 2011-01-30  |    1 |
| Ah Teck | 1991-12-31  |   20 |
+---------+-------------+------+
 
-- List patients whose last visited more than 60 days ago
mysql> <k>SELECT name, lastVisitDate FROM patients
       WHERE TIMESTAMPDIFF(DAY, lastVisitDate, CURDATE()) > 60;</k>
-- Functions TO_DAYS(date) converts the date to days
mysql> <k>SELECT name, lastVisitDate FROM patients
       WHERE TO_DAYS(CURDATE()) - TO_DAYS(lastVisitDate) > 60;</k>
 
-- Select patients 18 years old or younger
-- Function DATE_SUB(date, INTERVAL x unit) returns the date 
--   by subtracting the given date by x unit.
mysql> <k>SELECT * FROM patients 
       WHERE dateOfBirth > DATE_SUB(CURDATE(), INTERVAL 18 YEAR);</k>
 
-- Schedule Ali's next visit to be 6 months from now
-- Function DATE_ADD(date, INTERVAL x unit) returns the date
--   by adding the given date by x unit
mysql> <k>UPDATE patients 
       SET nextVisitDate = DATE_ADD(CURDATE(), INTERVAL 6 MONTH)
       WHERE name = 'Ali';</k>

<h5>Date/Time Functions</h5>

MySQL provides these built-in functions for getting the current date, time and datetime:
<ul>
  <mk>NOW()</mk>: returns the current date and time in the format of <mk>'YYYY-MM-DD HH:MM:SS'</mk>.
  <mk>CURDATE()</mk> (or <mk>CURRENT_DATE()</mk>, or <mk>CURRENT_DATE</mk>): returns the current date in the format of <mk>'YYYY-MM-DD'</mk>.
  <mk>CURTIME()</mk> (or <mk>CURRENT_TIME()</mk>, or <mk>CURRENT_TIME</mk>): returns the current time in the format of <mk>'HH:MM:SS'</mk>.
</ul>
For examples,

mysql> <k>select now(), curdate(), curtime();</k>
+---------------------+------------+-----------+
| now()               | curdate()  | curtime() |
+---------------------+------------+-----------+
| 2012-10-19 19:53:20 | 2012-10-19 | 19:53:20  |
+---------------------+------------+-----------+

<h5>SQL Date/Time Types</h5>
MySQL provides these date/time data types:
<ul>
  <k><mk>DATETIME</mk></k>: stores both date and time in the format of <mk>'YYYY-MM-DD HH:MM:SS'</mk>. The valid range is <mk>'1000-01-01 00:00:00'</mk> to <mk>'9999-12-31 23:59:59'</mk>. You can set a value  using the valid format (e.g., <mk>'2011-08-15 00:00:00'</mk>). You could also apply functions <mk>NOW()</mk> or <mk>CURDATE()</mk> (time will be set to <mk>'00:00:00'</mk>), but not <mk>CURTIME()</mk>.
  <mk><k>DATE</k></mk>: stores date only in the format of <mk>'YYYY-MM-DD'</mk>. The range is <mk>'1000-01-01'</mk> to <mk>'9999-12-31'</mk>. You could apply <mk>CURDATE()</mk> or <mk>NOW()</mk> (the time discarded) on this field.
  <mk><k>TIME</k></mk>: stores time only in the format of <mk>'HH:MM:SS'</mk>. You could apply <mk>CURTIME()</mk> or <mk>NOW()</mk> (the date discarded) for this field.
  <mk><k>YEAR(4|2)</k></mk>: in <mk>'YYYY'</mk> or <mk>'YY'</mk>. The range of years is 1901 to 2155. Use <mk>DATE</mk> type for year outside this range.
You could apply <mk>CURDATE()</mk> to this field (month and day discarded).
</ul>
<ul>
  <mk><k>TIMESTAMP</k></mk>: similar to <mk>DATETIME</mk> but stored the number of seconds since January 1, 1970 UTC (Unix-style). The range is <mk>'1970-01-01 00:00:00'</mk> to <mk>'2037-12-31 23:59:59'</mk>.<br />
    The differences between <mk>DATETIME</mk> and <mk>TIMESTAMP</mk> are:
    <ol>
      the range,
      support for time zone,
      <mk>TIMESTAMP</mk> column could be declared with <mk>DEFAULT CURRENT_TIMESTAMP</mk> to set the default value to the current date/time. (All other data types' default, including <mk>DATETIME</mk>, must be a constant and not a function return value). You can also declare a <mk>TIMESTAMP</mk> column with "<mk>ON UPDATE CURRENT_TIMESTAMP</mk>" to capture the timestamp of the last update.
    
  
</ul>
The date/time value can be entered manually as a string literal (e.g., <mk>'2010-12-31 23:59:59'</mk> for <mk>DATAETIME</mk>). MySQL will issue a warning and insert all zeros (e.g., <mk>'0000-00-00 00:00:00'</mk> for <mk>DATAETIME</mk>), if the value of date/time to be inserted is invalid or out-of-range. <mk>'0000-00-00'</mk> is called a "dummy" date.

<h5>More Date/Time Functions</h5>

Reference: MySQL's "Date and Time Functions" @ <a href="http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html">http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html</a>.
There are many date/time functions:

<ul>
Extracting part of a date/time: <mk>YEAR()</mk>, <mk>MONTH()</mk>, <mk>DAY()</mk>, <mk>HOUR()</mk>, <mk>MINUTE()</mk>, <mk>SECOND()</mk>, e.g.,
  
mysql> SELECT YEAR(NOW()), MONTH(NOW()), DAY(NOW()), HOUR(NOW()), MINUTE(NOW()), SECOND(NOW());
+-------------+--------------+------------+-------------+---------------+---------------+
| YEAR(NOW()) | MONTH(NOW()) | DAY(NOW()) | HOUR(NOW()) | MINUTE(NOW()) | SECOND(NOW()) |
+-------------+--------------+------------+-------------+---------------+---------------+
|        2012 |           10 |         24 |          11 |            54 |     45        |
+-------------+--------------+------------+-------------+---------------+---------------+

Extracting information: <mk>DAYNAME()</mk> (e.g., <mk>'Monday'</mk>), <mk>MONTHNAME()</mk> (e.g., <mk>'March'</mk>), <mk>DAYOFWEEK()</mk> (1=Sunday, …, 7=Saturday), <mk>DAYOFYEAR()</mk> (1-366), ...
  
mysql> <k>SELECT DAYNAME(NOW()), MONTHNAME(NOW()), DAYOFWEEK(NOW()), DAYOFYEAR(NOW());</k>
+----------------+------------------+------------------+------------------+
| DAYNAME(NOW()) | MONTHNAME(NOW()) | DAYOFWEEK(NOW()) | DAYOFYEAR(NOW()) |
+----------------+------------------+------------------+------------------+
| Wednesday      | October          |                4 |              298 |
+----------------+------------------+------------------+------------------+

Computing another date/time: <mk>DATE_SUB(date, INTERVAL expr unit)</mk>, <mk>DATE_ADD(date, INTERVAL expr unit)</mk>, <mk>TIMESTAMPADD(unit, interval, timestamp)</mk>, e.g.,

mysql> <k>SELECT DATE_ADD('2012-01-31', INTERVAL 5 DAY);</k>
2012-02-05
 
mysql> <k>SELECT DATE_SUB('2012-01-31', INTERVAL 2 MONTH);</k>
2011-11-30

Computing interval: <mk>DATEDIFF(end_date, start_date)</mk>, <mk>TIMEDIFF(end_time, start_time)</mk>, <mk>TIMESTAMPDIFF(unit, start_timestamp, end_timestamp)</mk>, e.g.,
  
mysql> <k>SELECT DATEDIFF('2012-02-01', '2012-01-28');</k>
4
 
mysql> <k>SELECT TIMESTAMPDIFF(DAY, '2012-02-01', '2012-01-28');</k>
-4

Representation: <mk>TO_DAYS(date)</mk> (days since year 0), <mk>FROM_DAYS(day_number)</mk>, e.g.,

mysql> <k>SELECT TO_DAYS('2012-01-31');</k>
734898
 
mysql> <k>SELECT FROM_DAYS(734899);</k>
2012-02-01

Formatting: <mk>DATE_FORMAT(date, formatSpecifier)</mk>, e.g.,
  
mysql> <k>SELECT DATE_FORMAT('2012-01-01', '%W %D %M %Y');</k>
Sunday 1st January 2012
       -- %W: Weekday name
       -- %D: Day with suffix
       -- %M: Month name
       -- %Y: 4-digit year
       -- The format specifiers are case-sensitive
 
mysql> <k>SELECT DATE_FORMAT('2011-12-31 23:59:30', '%W %D %M %Y %r');</k>
Saturday 31st December 2011 11:59:30 PM
       -- %r: Time in 12-hour format with suffix AM/PM

</ul>

<h5>Example</h5>
<ol>
  Create a table with various date/time columns.
Only the <mk>TIMESTAMP</mk> column can have the <mk>DEFAULT CURRENT_TIMESTAMP</mk> and <mk>ON UPDATE CURRENT_TIMESTAMP</mk>.
    
mysql> <k>CREATE TABLE IF NOT EXISTS `datetime_arena` (</k>
          <k>`description`  VARCHAR(50)  DEFAULT NULL,</k>
         <k> `cDateTime`    DATETIME     DEFAULT '0000-00-00 00:00:00',</k>
         <k> `cDate`        DATE         DEFAULT '0000-00-00',</k>
         <k> `cTime`        TIME         DEFAULT '00:00:00',</k>
         <k> `cYear`        YEAR         DEFAULT '0000',</k>
         <k> `cYear2`       YEAR(2)      DEFAULT '00',</k>
         <k> `cTimeStamp`   TIMESTAMP    DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</k>
       );
 
mysql> <k>DESCRIBE `datetime_arena`;</k>
+-------------+-------------+------+-----+---------------------+-----------------------------+
| Field       | Type        | Null | Key | Default             | Extra                       |
+-------------+-------------+------+-----+---------------------+-----------------------------+
| description | varchar(50) | YES  |     | NULL                |                             |
| cDateTime   | datetime    | YES  |     | 0000-00-00 00:00:00 |                             |
| cDate       | date        | YES  |     | 0000-00-00          |                             |
| cTime       | time        | YES  |     | 00:00:00            |                             |
| cYear       | year(4)     | YES  |     | 0000                |                             |
| cYear2      | year(2)     | YES  |     | 00                  |                             |
| cTimeStamp  | timestamp   | NO   |     | CURRENT_TIMESTAMP   | on update CURRENT_TIMESTAMP |
+-------------+-------------+------+-----+---------------------+-----------------------------+

Insert values manually using string literals.
  
mysql> <k>INSERT INTO `datetime_arena` 
          (`description`, `cDateTime`, `cDate`, `cTime`, `cYear`, `cYear2`)</k>
       <k>VALUES 
          ('Manual Entry', '2001-01-01 23:59:59', '2002-02-02', '12:30:30', '2004', '05');</k>
   
mysql> <k>SELECT * FROM `datetime_arena` WHERE description='Manual Entry';</k>
+--------------+---------------------+------------+----------+-------+--------+---------------------+
| description  | cDateTime           | cDate      | cTime    | cYear | cYear2 | cTimeStamp          |
+--------------+---------------------+------------+----------+-------+--------+---------------------+
| Manual Entry | 2001-01-01 23:59:59 | 2002-02-02 | 12:30:30 |  2004 |     05 | 2010-04-08 14:44:37 |
+--------------+---------------------+------------+----------+-------+--------+---------------------+

  Checking the on-update for <mk>TIMSTAMP</mk>.
  
mysql> <k>UPDATE `datetime_arena` SET `cYear2`='99' WHERE description='Manual Entry';</k>
   
mysql> <k>SELECT * FROM `datetime_arena` WHERE description='Manual Entry';</k>
+--------------+---------------------+------------+----------+-------+--------+---------------------+
| description  | cDateTime           | cDate      | cTime    | cYear | cYear2 | cTimeStamp          |
+--------------+---------------------+------------+----------+-------+--------+---------------------+
| Manual Entry | 2001-01-01 23:59:59 | 2002-02-02 | 12:30:30 |  2004 |     99 | 2010-04-08 14:44:48 |
+--------------+---------------------+------------+----------+-------+--------+---------------------+

  Insert values using MySQL built-in functions <mk>now()</mk>, <mk>curdate()</mk>, <mk>curtime()</mk>.
  
mysql> <k>INSERT INTO `datetime_arena` 
          (`description`, `cDateTime`, `cDate`, `cTime`, `cYear`, `cYear2`)</k>
       <k>VALUES 
          ('Built-in Functions', now(), curdate(), curtime(), now(), now());</k>
   
mysql> <k>SELECT * FROM `datetime_arena` WHERE description='Built-in Functions';</k>
+--------------------+---------------------+------------+----------+-------+--------+---------------------+
| description        | cDateTime           | cDate      | cTime    | cYear | cYear2 | cTimeStamp          |
+--------------------+---------------------+------------+----------+-------+--------+---------------------+
| Built-in Functions | 2010-04-08 14:45:48 | 2010-04-08 | 14:45:48 |  2010 |     10 | 2010-04-08 14:45:48 |
+--------------------+---------------------+------------+----------+-------+--------+---------------------+

  Insert invalid or out-of-range values.
MySQL replaces with all zeros.
  
mysql> <k>INSERT INTO `datetime_arena`
          (`description`, `cDateTime`, `cDate`, `cTime`, `cYear`, `cYear2`)</k>
       <k>VALUES 
          ('Error Input', '2001-13-31 23:59:59', '2002-13-31', '12:61:61', '99999', '999');</k>
   
mysql> <k>SELECT * FROM `datetime_arena` WHERE description='Error Input';</k>
+-------------+---------------------+------------+----------+-------+--------+---------------------+
| description | cDateTime           | cDate      | cTime    | cYear | cYear2 | cTimeStamp          |
+-------------+---------------------+------------+----------+-------+--------+---------------------+
| Error Input | 0000-00-00 00:00:00 | 0000-00-00 | 00:00:00 |  0000 |     00 | 2010-04-08 14:46:10 |
+-------------+---------------------+------------+----------+-------+--------+---------------------+

  An useful built-in function <mk>INTERVAL</mk> can be used to compute a future date, e.g.,
  
mysql> <k>SELECT `cDate`, `cDate` + INTERVAL 30 DAY, `cDate` + INTERVAL 1 MONTH FROM `datetime_arena`;</k>
+------------+---------------------------+----------------------------+
| cDate      | `cDate` + INTERVAL 30 DAY | `cDate` + INTERVAL 1 MONTH |
+------------+---------------------------+----------------------------+
| 2002-02-02 | 2002-03-04                | 2002-03-02                 |
| 2010-04-08 | 2010-05-08                | 2010-05-08                 |
| 0000-00-00 | NULL                      | NULL                       |
+------------+---------------------------+----------------------------+

<h3>&emsp;View</h3>
A view is a virtual table that contains no physical data.
It provide an alternative way to look at the data.

<h5>Example</h5>

-- Define a VIEW called supplier_view from products, suppliers and products_suppliers tables
mysql> <k>CREATE VIEW supplier_view
       AS
       SELECT suppliers.name as `Supplier Name`, products.name as `Product Name`
       FROM products 
          JOIN suppliers ON products.productID = products_suppliers.productID
          JOIN products_suppliers ON suppliers.supplierID = products_suppliers.supplierID;</k>
 
-- You can treat the VIEW defined like a normal table
mysql> SELECT * FROM supplier_view;
+---------------+--------------+
| Supplier Name | Product Name |
+---------------+--------------+
| ABC Traders   | Pencil 3B    |
| ABC Traders   | Pencil 4B    |
| ABC Traders   | Pencil 5B    |
| XYZ Company   | Pencil 6B    |
+---------------+--------------+
 
mysql> <k>SELECT * FROM supplier_view WHERE `Supplier Name` LIKE 'ABC%';</k>
+---------------+--------------+
| Supplier Name | Product Name |
+---------------+--------------+
| ABC Traders   | Pencil 3B    |
| ABC Traders   | Pencil 4B    |
| ABC Traders   | Pencil 5B    |
+---------------+--------------+

<h5>Example</h5>

mysql> <k>DROP VIEW IF EXISTS patient_view;</k>
  
mysql> <k>CREATE VIEW patient_view
       AS
       SELECT 
          patientID AS ID, 
          name AS Name, 
          dateOfBirth AS DOB,
          TIMESTAMPDIFF(YEAR, dateOfBirth, NOW()) AS Age
       FROM patients
       ORDER BY Age, DOB;</k>
 
mysql> <k>SELECT * FROM patient_view WHERE Name LIKE 'A%';</k>
+------+---------+------------+------+
| ID   | Name    | DOB        | Age  |
+------+---------+------------+------+
| 1003 | Ali     | 2011-01-30 |    1 |
| 1001 | Ah Teck | 1991-12-31 |   20 |
+------+---------+------------+------+
  
mysql> <k>SELECT * FROM patient_view WHERE age >= 18;</k>
+------+---------+------------+------+
| ID   | Name    | DOB        | Age  |
+------+---------+------------+------+
| 1001 | Ah Teck | 1991-12-31 |   20 |
+------+---------+------------+------+

<h3>&emsp;Transactions</h3>
A atomic transaction is a set of SQL statements that either ALL succeed or ALL fail.
Transaction is important to ensure that there is no partial update to the database, given an atomic of SQL statements.
Transactions are carried out via <mk>COMMIT</mk> and <mk>ROLLBACK</mk>.

<h5>Example</h5>

mysql> CREATE TABLE accounts (
          name     VARCHAR(30),
          balance  DECIMAL(10,2)
       );
 
mysql> INSERT INTO accounts VALUES ('Paul', 1000), ('Peter', 2000);
mysql> SELECT * FROM accounts;
+-------+---------+
| name  | balance |
+-------+---------+
| Paul  | 1000.00 |
| Peter | 2000.00 |
+-------+---------+
 
-- Transfer money from one account to another account
mysql> START TRANSACTION;
mysql> UPDATE accounts SET balance = balance - 100 WHERE name = 'Paul';
mysql> UPDATE accounts SET balance = balance + 100 WHERE name = 'Peter';
mysql> COMMIT;     -- Commit the transaction and end transaction
mysql> SELECT * FROM accounts;
+-------+---------+
| name  | balance |
+-------+---------+
| Paul  |  900.00 |
| Peter | 2100.00 |
+-------+---------+
 
mysql> START TRANSACTION;
mysql> UPDATE accounts SET balance = balance - 100 WHERE name = 'Paul';
mysql> UPDATE accounts SET balance = balance + 100 WHERE name = 'Peter';
mysql> ROLLBACK;    -- Discard all changes of this transaction and end Transaction
mysql> SELECT * FROM accounts;
+-------+---------+
| name  | balance |
+-------+---------+
| Paul  |  900.00 |
| Peter | 2100.00 |
+-------+---------+

If you start another <mk>mysql</mk> client and do a <mk>SELECT</mk> during the transaction (before the commit or rollback), you will not see the changes.

Alternatively, you can also disable the so-called <mk>autocommit</mk> mode, which is set by default and commit every single SQL statement.

-- Disable autocommit by setting it to false (0)
mysql> SET autocommit = 0;
mysql> UPDATE accounts SET balance = balance - 100 WHERE name = 'Paul';
mysql> UPDATE accounts SET balance = balance + 100 WHERE name = 'Peter';
mysql> COMMIT;
mysql> SELECT * FROM accounts;
+-------+---------+
| name  | balance |
+-------+---------+
| Paul  |  800.00 |
| Peter | 2200.00 |
+-------+---------+
 
mysql> UPDATE accounts SET balance = balance - 100 WHERE name = 'Paul';
mysql> UPDATE accounts SET balance = balance + 100 WHERE name = 'Peter';
mysql> ROLLBACK;
mysql> SELECT * FROM accounts;
+-------+---------+
| name  | balance |
+-------+---------+
| Paul  |  800.00 |
| Peter | 2200.00 |
+-------+---------+
 
mysql> SET autocommit = 1;   -- Enable autocommit

A transaction groups a set of operations into a unit that meets the ACID test:
<ol>
Atomicity: If all the operations succeed, changes are committed to the database.
If any of the operations fails, the entire transaction is rolled back, and no change is made to the database.
In other words, there is no partial update.
Consistency: A transaction transform the database from one consistent state to another consistent state.
Isolation: Changes to a transaction are not visible to another transaction until they are committed.
Durability: Committed changes are durable and never lost.

<h3>&emsp;User Variables</h3>

In MySQL, you can define user variables via:
<ol>
<mk>@varname :=value</mk> in a <mk>SELECT</mk> command, or
<mk>SET @varname := value</mk> or <mk>SET @varname = value</mk> command.

For examples,

mysql> SELECT <k>@ali_dob := dateOfBirth</k> FROM patients WHERE name = 'Ali';
mysql> SELECT name WHERE dateOfBirth &lt; <k>@ali_dob</k>;
 
mysql> <k>SET @today := CURDATE()</k>;
mysql> SELECT name FROM patients WHERE nextVisitDate = <k>@today</k>;

<h2>More on JOIN</h2>

<h3>&emsp;INNER JOIN</h3>
In an  inner join of two tables, each row of the first table is combined (joined) with every row of second table.
Suppose that there are n1 rows in the first table and n2 rows in the second table, <mk>INNER JOIN</mk> produces all combinations of n1&times;n2 rows - it is known as Cartesian Product or Cross Product.

<h5>Example</h5>

mysql> <k>DROP TABLE IF EXISTS t1, t2;</k>
 
mysql> <k>CREATE TABLE t1 (
          id      INT PRIMARY KEY,
          `desc`  VARCHAR(30)
       );</k>
-- `desc` is a reserved word - must be back-quoted
 
mysql> <k>CREATE TABLE t2 (
          id      INT PRIMARY KEY,
          `desc`  VARCHAR(30)
       );</k>
 
mysql> <k>INSERT INTO t1 VALUES
         (1, 'ID 1 in t1'),
         (2, 'ID 2 in t1'),
         (3, 'ID 3 in t1');</k>

mysql> <k>INSERT INTO t2 VALUES
         (2, 'ID 2 in t2'),
         (3, 'ID 3 in t2'),
         (4, 'ID 4 in t2');</k>
 
mysql> <k>SELECT * FROM t1;</k>
+----+------------+
| id | desc       |
+----+------------+
|  1 | ID 1 in t1 |
|  2 | ID 2 in t1 |
|  3 | ID 3 in t1 |
+----+------------+
 
mysql> <k>SELECT * FROM t2;</k>
+----+------------+
| id | desc       |
+----+------------+
|  2 | ID 2 in t2 |
|  3 | ID 3 in t2 |
|  4 | ID 4 in t2 |
+----+------------+
 
mysql> <k>SELECT * 
       FROM t1 INNER JOIN t2;</k>
+----+------------+----+------------+
| id | desc       | id | desc       |
+----+------------+----+------------+
|  1 | ID 1 in t1 |  2 | ID 2 in t2 |
|  2 | ID 2 in t1 |  2 | ID 2 in t2 |
|  3 | ID 3 in t1 |  2 | ID 2 in t2 |
|  1 | ID 1 in t1 |  3 | ID 3 in t2 |
|  2 | ID 2 in t1 |  3 | ID 3 in t2 |
|  3 | ID 3 in t1 |  3 | ID 3 in t2 |
|  1 | ID 1 in t1 |  4 | ID 4 in t2 |
|  2 | ID 2 in t1 |  4 | ID 4 in t2 |
|  3 | ID 3 in t1 |  4 | ID 4 in t2 |
+----+------------+----+------------+
-- SELECT all columns in t1 and t2 (*)
-- INNER JOIN produces ALL combinations of rows in t1 and t2

You can impose constrain by using the <mk>ON</mk> clause, for example,

mysql> <k>SELECT *
       FROM t1 INNER JOIN t2 ON t1.id = t2.id;</k>
+----+------------+----+------------+
| id | desc       | id | desc       |
+----+------------+----+------------+
|  2 | ID 2 in t1 |  2 | ID 2 in t2 |
|  3 | ID 3 in t1 |  3 | ID 3 in t2 |
+----+------------+----+------------+

Take note that the following are equivalent:

mysql> <k>SELECT *
       FROM t1 INNER JOIN t2 ON t1.id = t2.id;</k>
mysql> <k>SELECT *
       FROM t1 JOIN t2 ON t1.id = t2.id;</k>        -- default JOIN is INNER JOIN
mysql> <k>SELECT *
       FROM t1 CROSS JOIN t2 ON t1.id = t2.id;</k>  -- Also called CROSS JOIN
 
-- You can use USING clause if the join-columns have the same name
mysql> <k>SELECT *
       FROM t1 INNER JOIN t2 USING (id);</k>
+----+------------+------------+
| id | desc       | desc       |
+----+------------+------------+
|  2 | ID 2 in t1 | ID 2 in t2 |
|  3 | ID 3 in t1 | ID 3 in t2 |
+----+------------+------------+
   -- Only 3 columns in the result set, instead of 4 columns with ON clause
 
mysql> <k>SELECT *
       FROM t1 INNER JOIN t2 WHERE t1.id = t2.id;</k>  -- Use WHERE instead of ON
mysql> <k>SELECT *
       FROM t1, t2 WHERE t1.id = t2.id;</k>            -- Use "commas" operator to join

<h3>&emsp;OUTER JOIN - LEFT JOIN and RIGHT JOIN</h3>

<mk>INNER JOIN</mk> with constrain (<mk>ON</mk> or <mk>USING</mk>) produces rows that are found in both tables.
On the other hand, <mk>OUTER JOIN</mk> can produce rows that are in one table, but not in another table.
There are two kinds of <mk>OUTER JOIN</mk>s: <mk>LEFT JOIN</mk> produces rows that are in the left table, but may not in the right table; whereas <mk>RIGHT JOIN</mk> produces rows that are in the right table but may not in the left table.
In a <mk>LEFT JOIN</mk>, when a row in the left table does not match with the right table, it is still selected but by combining with a "fake" record of all <mk>NULL</mk>s for the right table.

mysql> <k>SELECT *
       FROM t1 LEFT JOIN t2 ON t1.id = t2.id;</k>
+----+------------+------+------------+
| id | desc       | id   | desc       |
+----+------------+------+------------+
|  1 | ID 1 in t1 | NULL | NULL       |
|  2 | ID 2 in t1 |    2 | ID 2 in t2 |
|  3 | ID 3 in t1 |    3 | ID 3 in t2 |
+----+------------+------+------------+
 
mysql> <k>SELECT *
       FROM t1 LEFT JOIN t2 USING (id);</k>
+----+------------+------------+
| id | desc       | desc       |
+----+------------+------------+
|  1 | ID 1 in t1 | NULL       |
|  2 | ID 2 in t1 | ID 2 in t2 |
|  3 | ID 3 in t1 | ID 3 in t2 |
+----+------------+------------+
 
mysql> <k>SELECT *
       FROM t1 RIGHT JOIN t2 ON t1.id = t2.id;</k>
+------+------------+----+------------+
| id   | desc       | id | desc       |
+------+------------+----+------------+
|    2 | ID 2 in t1 |  2 | ID 2 in t2 |
|    3 | ID 3 in t1 |  3 | ID 3 in t2 |
| NULL | NULL       |  4 | ID 4 in t2 |
+------+------------+----+------------+
 
mysql> <k>SELECT *
       FROM t1 RIGHT JOIN t2 USING (id);</k>
+----+------------+------------+
| id | desc       | desc       |
+----+------------+------------+
|  2 | ID 2 in t2 | ID 2 in t1 |
|  3 | ID 3 in t2 | ID 3 in t1 |
|  4 | ID 4 in t2 | NULL       |
+----+------------+------------+

As the result, <mk>LEFT JOIN</mk> ensures that the result set contains every row on the left table.
This is important, as in some queries, you are interested to have result on every row on the left table, with no match in the right table, e.g., searching for items without supplier.
For example,

mysql> <k>SELECT t1.id, t1.desc
       FROM t1 LEFT JOIN t2 USING (id)
       WHERE t2.id IS NULL;</k>
+----+------------+
| id | desc       |
+----+------------+
|  1 | ID 1 in t1 |
+----+------------+

Take note that the followings are equivalent:
mysql> <k>SELECT *
       FROM t1 LEFT JOIN t2 ON t1.id = t2.id;</k>
mysql> <k>SELECT *
       FROM t1 LEFT OUTER JOIN t2 ON t1.id = t2.id;</k>
 
mysql> <k>SELECT *
       FROM t1 LEFT JOIN t2 USING (id);</k>  -- join-columns have same name
+----+------------+------------+
| id | desc       | desc       |
+----+------------+------------+
|  1 | ID 1 in t1 | NULL       |
|  2 | ID 2 in t1 | ID 2 in t2 |
|  3 | ID 3 in t1 | ID 3 in t2 |
+----+------------+------------+
 
-- WHERE clause CANNOT be used on OUTER JOIN
mysql> <k>SELECT *
       FROM t1 LEFT JOIN t2 WHERE t1.id = t2.id;</k>
ERROR 1064 (42000): You have an error in your SQL syntax;

<h2>Exercises</h2>

<h3>&emsp;Rental System</h3>

Peter runs a small car rental company with 10 cars and 5 trucks.
He engages you to design a web portal to put his operation online.
For the initial phase, the web portal shall provide these basic functions:
<ol>
Maintaining the records of the vehicles and customers.
Inquiring about the availability of vehicle, and
Reserving a vehicle for rental.

A customer record contains his/her name, address and phone number.
A vehicle, identified by the vehicle registration number, can be rented on a daily basis.
The  rental rate is different for different vehicles.  There is a discount of 20% for rental of 7 days or more.
A customer can rental a vehicle from a start date to an end date.
A special customer discount, ranging from 0-50%, can be given to preferred customers.
<h5>Database</h5>
The initial database contains 3 tables: <mk>vehicles</mk>, <mk>customers</mk>, and <mk>rental_records</mk>. The <mk>rental_records</mk> is a junction table supporting many-to-many relationship between <mk>vehicles</mk> and <mk>customers</mk>.

DROP DATABASE IF EXISTS `rental_db`;
CREATE DATABASE `rental_db`;
USE `rental_db`;
 
-- Create `vehicles` table
DROP TABLE IF EXISTS `vehicles`;
CREATE TABLE `vehicles` (
   `veh_reg_no`  VARCHAR(8)    NOT NULL,
   `category`    ENUM('car', 'truck')  NOT NULL DEFAULT 'car',  
                 -- Enumeration of one of the items in the list
   `brand`       VARCHAR(30)   NOT NULL DEFAULT '',
   `desc`        VARCHAR(256)  NOT NULL DEFAULT '',
                 -- desc is a keyword (for descending) and must be back-quoted
   `photo`       BLOB          NULL,   -- binary large object of up to 64KB
                 -- to be implemented later
   `daily_rate`  DECIMAL(6,2)  NOT NULL DEFAULT 9999.99,
                 -- set default to max value
   PRIMARY KEY (`veh_reg_no`),
   INDEX (`category`)  -- Build index on this column for fast search
) ENGINE=InnoDB;
   -- MySQL provides a few ENGINEs.
   -- The InnoDB Engine supports foreign keys and transactions
DESC `vehicles`;
SHOW CREATE TABLE `vehicles` \G
SHOW INDEX FROM `vehicles` \G
 
-- Create `customers` table
DROP TABLE IF EXISTS `customers`;
CREATE TABLE `customers` (
   `customer_id`  INT UNSIGNED  NOT NULL AUTO_INCREMENT,
                  -- Always use INT for AUTO_INCREMENT column to avoid run-over
   `name`         VARCHAR(30)   NOT NULL DEFAULT '',
   `address`      VARCHAR(80)   NOT NULL DEFAULT '',
   `phone`        VARCHAR(15)   NOT NULL DEFAULT '',
   `discount`     DOUBLE        NOT NULL DEFAULT 0.0,
   PRIMARY KEY (`customer_id`),
   UNIQUE INDEX (`phone`),  -- Build index on this unique-value column
   INDEX (`name`)           -- Build index on this column
) ENGINE=InnoDB;
DESC `customers`;
SHOW CREATE TABLE `customers` \G
SHOW INDEX FROM `customers` \G
 
-- Create `rental_records` table
DROP TABLE IF EXISTS `rental_records`;
CREATE TABLE `rental_records` (
   `rental_id`    INT UNSIGNED  NOT NULL AUTO_INCREMENT,
   `veh_reg_no`   VARCHAR(8)    NOT NULL, 
   `customer_id`  INT UNSIGNED  NOT NULL,
   `start_date`   DATE          NOT NULL DEFAULT '0000-00-00',
   `end_date`     DATE          NOT NULL DEFAULT '0000-00-00',
   `lastUpdated`  TIMESTAMP     NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
      -- Keep the created and last updated timestamp for auditing and security
   PRIMARY KEY (`rental_id`),
   FOREIGN KEY (`customer_id`) REFERENCES `customers` (`customer_id`)
      ON DELETE RESTRICT ON UPDATE CASCADE,
      -- Disallow deletion of parent record if there are matching records here
      -- If parent record (customer_id) changes, update the matching records here
   FOREIGN KEY (`veh_reg_no`) REFERENCES `vehicles` (`veh_reg_no`)
      ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB;
DESC `rental_records`;
SHOW CREATE TABLE `rental_records` \G
SHOW INDEX FROM `rental_records` \G
 
-- Inserting test records
INSERT INTO `vehicles` VALUES
   ('SBA1111A', 'car', 'NISSAN SUNNY 1.6L', '4 Door Saloon, Automatic', NULL, 99.99),
   ('SBB2222B', 'car', 'TOYOTA ALTIS 1.6L', '4 Door Saloon, Automatic', NULL, 99.99),
   ('SBC3333C', 'car', 'HONDA CIVIC 1.8L',  '4 Door Saloon, Automatic', NULL, 119.99),
   ('GA5555E', 'truck', 'NISSAN CABSTAR 3.0L',  'Lorry, Manual ', NULL, 89.99),
   ('GA6666F', 'truck', 'OPEL COMBO 1.6L',  'Van, Manual', NULL, 69.99);
   -- No photo yet, set to NULL
SELECT * FROM `vehicles`;
 
INSERT INTO `customers` VALUES
   (1001, 'Tan Ah Teck', '8 Happy Ave', '88888888', 0.1),
   (NULL, 'Mohammed Ali', '1 Kg Java', '99999999', 0.15),
   (NULL, 'Kumar', '5 Serangoon Road', '55555555', 0),
   (NULL, 'Kevin Jones', '2 Sunset boulevard', '22222222', 0.2);
SELECT * FROM `customers`;
 
INSERT INTO `rental_records` VALUES
  (NULL, 'SBA1111A', 1001, '2012-01-01', '2012-01-21', NULL),
  (NULL, 'SBA1111A', 1001, '2012-02-01', '2012-02-05', NULL),
  (NULL, 'GA5555E',  1003, '2012-01-05', '2012-01-31', NULL),
  (NULL, 'GA6666F',  1004, '2012-01-20', '2012-02-20', NULL);
SELECT * FROM `rental_records`;

<h5>Exercises</h5>

<ol>
Customer <mk>'Tan Ah Teck'</mk> has rented <mk>'SBA1111A'</mk> from today for 10 days. (Hint: You need to insert a rental record.
Use a <mk>SELECT</mk> subquery to get the <mk>customer_id</mk>. Use <mk>CURDATE()</mk> (or <mk>NOW()</mk>) for today; and <mk>DATE_ADD(CURDATE(), INTERVAL x unit)</mk> to compute a future date.)
  
INSERT INTO rental_records VALUES
   (NULL,
    'SBA1111A', 
    (SELECT customer_id FROM customers WHERE name='Tan Ah Teck'),
    CURDATE(),
    DATE_ADD(CURDATE(), INTERVAL 10 DAY),
    NULL);

Customer <mk>'Kumar'</mk> has rented <mk>'GA5555E'</mk> from tomorrow for 3 months.
<!--
INSERT INTO rental_records VALUES
   (NULL,
    'GA5555E', 
    (SELECT customer_id FROM customers WHERE name='Kumar'),
    DATE_ADD(CURDATE(), INTERVAL 1 DAY),
    DATE_ADD(CURDATE(), INTERVAL 31 DAY),
    NULL); 
-->

List all rental records (start date, end date) with vehicle's registration number, brand, and customer name, sorted by vehicle's categories followed by start date.

SELECT
   r.start_date  AS `Start Date`,
   r.end_date    AS `End Date`,
   r.veh_reg_no  AS `Vehicle No`,
   v.brand       AS `Vehicle Brand`,
   c.name        AS `Customer Name`
FROM rental_records AS r
   INNER JOIN vehicles  AS v USING (veh_reg_no)
   INNER JOIN customers AS c USING (customer_id)
ORDER BY v.category, start_date;

List all the expired rental records (end_date before <mk>CURDATE()</mk>).
<!--
SELECT * FROM rental_records WHERE end_date < CURDATE();
SELECT * FROM rental_records WHERE end_date < NOW();
-->

List the vehicles rented out on <mk>'2012-01-10'</mk> (not available for rental), in columns of vehicle registration no, customer name, start date and end date. (Hint: the given date is in between the <mk>start_date</mk> and <mk>end_date</mk>.)
<!--
SELECT
   r.veh_reg_no AS `Vehicle No`,
   c.name AS `Customer Name`,
   r.start_date AS `Start Date`,
   r.end_date AS `End Date`
FROM rental_records AS r
   INNER JOIN vehicles AS v USING (veh_reg_no)
   INNER JOIN customers AS c USING (customer_id)
WHERE '2012-01-10' BETWEEN start_date AND end_date;
-->

List all vehicles rented out today, in columns registration number, customer name, start date, end date.
<!--
SELECT
   veh_reg_no AS `Vehicle No`,
   name AS `Customer Name`,
   start_date AS `Start Date`,
   end_date AS `End Date`
FROM rental_records
   INNER JOIN customers USING (customer_id)
WHERE
   CURDATE() BETWEEN start_date AND end_date;
-->

 Similarly, list the vehicles rented out (not available for rental) for the period from <mk>'2012-01-03'</mk> to <mk>'2012-01-18'</mk>. (Hint: <mk>start_date</mk> is inside the range; or <mk>end_date</mk> is inside the range; or <mk>start_date</mk> is before the range and <mk>end_date</mk> is beyond the range.)
<!--
SELECT
   r.veh_reg_no AS `Vehicle No`,
   c.name AS `Customer Name`,
   r.start_date AS `Start Date`,
   r.end_date AS `End Date`
FROM rental_records AS r
   INNER JOIN vehicles AS v USING (veh_reg_no)
   INNER JOIN customers AS c USING (customer_id)
WHERE start_date BETWEEN '2012-01-03' AND '2012-01-18'
   OR end_date BETWEEN '2012-01-03' AND '2012-01-18'
   OR (start_date < '2012-01-03' AND end_date > '2012-01-18');
-->

List the vehicles (registration number, brand and description) available for rental (not rented out) on <mk>'2012-01-10'</mk> (Hint: You could use a subquery based on a earlier query<mk></mk>).

<!--
Using Subquery
SELECT
   veh_reg_no AS `Vehicle No`,
   brand AS `Brand`,
   `desc` AS `Description`
FROM vehicles
WHERE
   veh_reg_no NOT IN
      (SELECT DISTINCT veh_reg_no FROM rental_records
       WHERE '2012-01-10' BETWEEN start_date AND end_date);

Can we use LEFT JOIN? The following don't work because of one-to-many
SELECT
   veh_reg_no AS `Vehicle No`,
   brand AS `Brand`,
   `desc` AS `Description`
FROM vehicles
   LEFT JOIN rental_records USING (veh_reg_no)
WHERE start_date IS NULL
   OR '2012-01-10' NOT BETWEEN start_date AND end_date;
-->

Similarly, list the vehicles available for rental for the period from <mk>'2012-01-03'</mk> to <mk>'2012-01-18'</mk>.

Similarly, list the vehicles available for rental from today for 10 days.

Foreign Key Test:
<ol>
Try deleting a parent row with matching row(s) in child table(s), e.g., delete <mk>'GA6666F'</mk> from <mk>vehicles</mk> table (<mk>ON DELETE RESTRICT</mk>).
Try updating a parent row with matching row(s) in child table(s), e.g., rename <mk>'GA6666F'</mk> to <mk>'GA9999F'</mk> in <mk>vehicles</mk> table.
Check the effects on the child table <mk>rental_records</mk>  (<mk>ON UPDATE CASCADE</mk>).
Remove <mk>'GA6666F'</mk> from the database (Hints: Remove it from child table <mk>rental_records</mk>; then parent table <mk>vehicles</mk>.)

Payments: A rental could be paid over a number of payments (e.g., deposit, installments, full payment). Each payment is for one rental.
Create a new table called <mk>payments</mk>. Need to create columns to facilitate proper audit check (such as <mk>create_date</mk>, <mk>create_by</mk>, <mk>last_update_date</mk>, <mk>last_update_by</mk>, etc.)
  
DROP TABLE IF EXISTS `payments`;
CREATE TABLE payments (
   `payment_id`  INT UNSIGNED  NOT NULL AUTO_INCREMENT,
   `rental_id`   INT UNSIGNED  NOT NULL,
   `amount`      DECIMAL(8,2)  NOT NULL DEFAULT 0,
   `mode`        ENUM('cash', 'credit card', 'check'),
   `type`        ENUM('deposit', 'partial', 'full') NOT NULL DEFAULT 'full',
   `remark`      VARCHAR(255),
   `created_date`       DATETIME      NOT NULL,
   `created_by`         INT UNSIGNED  NOT NULL,  -- staff_id
                       -- Use a trigger to update create_date and create_by automatically
   `last_updated_date`  TIMESTAMP     DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
                       -- Updated by the system automatically
   `last_updated_by`    INT UNSIGNED  NOT NULL,
                       -- Use a trigger to update created_by
   PRIMARY KEY (`payment_id`),
   INDEX       (`rental_id`),
   FOREIGN KEY (`rental_id`) REFERENCES rental_records (`rental_id`)
) ENGINE=InnoDB;
DESC `payments`;
SHOW CREATE TABLE `payments` \G
SHOW INDEX FROM `payments` \G

Staff: Keeping track of staff serving the customers.
Create a new <mk>staff</mk> table.
Assume that each transaction is handled by one staff, we can add a new column called <mk>staff_id</mk> in the <mk>rental_records</mk> table,

DROP TABLE IF EXISTS `staff`;
CREATE TABLE `staff` (
   `staff_id`   INT UNSIGNED  NOT NULL AUTO_INCREMENT, 
                -- Always use INT for AUTO_INCREMENT column to prvent run-over
   `name`       VARCHAR(30)   NOT NULL DEFAULT '',
   `title`      VARCHAR(30)   NOT NULL DEFAULT '',
   `address`    VARCHAR(80)   NOT NULL DEFAULT '',
   `phone`      VARCHAR(15)   NOT NULL DEFAULT '',
   `report_to`  INT UNSIGNED  NOT NULL,
                -- Reports to manager staff_id.
Boss reports to himself
   PRIMARY KEY  (`staff_id`),
   UNIQUE INDEX (`phone`),  -- Build index on this unique-value column
   INDEX        (`name`),   -- Build index on this column
   FOREIGN KEY  (`report_to`) REFERENCES `staff` (`staff_id`)
      -- Reference itself
) ENGINE=InnoDB;
DESC `staff`;
SHOW INDEX FROM `staff` \G
 
INSERT INTO staff VALUE (8001, 'Peter Johns', 'Managing Director', '1 Happy Ave', '12345678', 8001);
SELECT * FROM staff;
 
-- Add a new column to rental_records table
ALTER TABLE `rental_records` ADD COLUMN `staff_id`  INT UNSIGNED  NOT NULL;
-- Need to set to a valid value, before adding the foreign key
UPDATE `rental_records` SET `staff_id` = 8001;
ALTER TABLE `rental_records` ADD FOREIGN KEY (`staff_id`) REFERENCES staff (`staff_id`) 
   ON DELETE RESTRICT ON UPDATE CASCADE;
 
SHOW CREATE TABLE `rental_records` \G
SHOW INDEX FROM `rental_records` \G

-- Also Add a new column to payments table
ALTER TABLE `payments` ADD COLUMN `staff_id`  INT UNSIGNED  NOT NULL;
-- Need to set to a valid value, before adding the foreign key
UPDATE `payments` SET `staff_id` = 8001;
ALTER TABLE `payments` ADD FOREIGN KEY (`staff_id`) REFERENCES staff (`staff_id`) 
   ON DELETE RESTRICT ON UPDATE CASCADE;
 
SHOW CREATE TABLE `payments` \G
SHOW INDEX FROM `payments` \G

<h5>Advanced Exercises</h5>
<ol>

Adding Photo: We could store photo in MySQL using data type of <mk>BLOB</mk> (Binary Large Object) (up to 64KB), <mk>MEDIUMBLOB</mk> (up to 16MBytes), <mk>LONGBOLB</mk> (up to 4GBytes). For example,
  
-- Use function LOAD_FILE to load a picture file into a BLOB field
UPDATE vehicles SET photo=LOAD_FILE('d:/temp/car.jpg') WHERE veh_reg_no = 'SBA1111A';
SELECT * FROM vehicles WHERE veh_reg_no = 'SBA1111A' \G

You can conveniently load and view the photo via graphical tools such as MySQL Workbench.
To load a image in MySQL Workbench &rArr; right-click on the cell &rArr; Load Value From File &rArr; Select the image file.
To view the image &rArr; right-click on the BLOB cell &rArr; Open Value in Editor &rArr; choose "Image" pane.<br />

I also include a Java program for reading and writing image BLOB from/to the database, based on this example: "<a href="codes/TestImageBLOB.java.txt"><mk>TestImageBLOB.java</mk></a>".

<mk>VIEW</mk>: Create a <mk>VIEW</mk> called <mk>rental_prices</mk> on the <mk>rental_records</mk> with an additional column called <mk>price</mk>. Show all the records of the <mk>VIEW</mk>.
  
DROP VIEW IF EXISTS rental_prices;
CREATE VIEW <k>rental_prices</k>
AS
SELECT
   v.veh_reg_no    AS `Vehicle No`,
   v.daily_rate    AS `Daily Rate`,
   c.name          AS `Customer Name`,
   c.discount*100  AS `Customer Discount (%)`,
   r.start_date    AS `Start Date`,
   r.end_date      AS `End Date`,
   DATEDIFF(r.end_date, r.start_date) AS `Duration`,
   -- Compute the rental price
   -- Preferred customer has discount, 20% discount for 7 or more days
   -- CAST the result from DOUBLE to DECIMAL(8,2)
   CAST(
      IF (DATEDIFF(r.end_date, r.start_date) &lt; 7,
          DATEDIFF(r.end_date, r.start_date)*daily_rate*(1-discount),
          DATEDIFF(r.end_date, r.start_date)*daily_rate*(1-discount)*0.8)
      AS DECIMAL(8,2)) AS price
FROM rental_records AS r
   INNER JOIN vehicles  AS v USING (veh_reg_no)
   INNER JOIN customers AS c USING (customer_id);
 
DESC `rental_prices`;
SHOW CREATE VIEW `rental_prices` \G
 
-- Try selecting all rows
SELECT * FROM `rental_prices`;

It is probably easier to compute the price using a program/procedure, instead of inside the view.

From the <mk>payments</mk> table, create a view to show the outstanding balance.

Define more views.

<mk>FUNCTION</mk>: Write a function to compute the rental price.

Define more procedures and functions.

<mk>TRIGGER</mk>: Write a trigger for the <mk>created_date<mk></mk></mk> and <mk>created_by</mk> columns of the <mk>payments</mk> table.

Define more triggers.

Implement discount on weekday (Monday to Friday, except public holiday): Need to set up a new table called <mk>public_hoilday</mk> with columns <mk>date</mk> and <mk>description</mk>. Use function <mk>DAYOFWEEK</mk> (1=Sunday, …, 7=Saturday) to check for weekday or weekend.
  
-- pseudocode for calculating rental price
price = 0;
for each date from start_date to end_date {
   if date is weekend or public_holiday, price += daily_rate;
   else price += daily_rate*(1-discount);
}
if (duration >= 7) price *= (1 - long_duration_discount);
price *= (1 - perferred_customer_discount);

<h3>&emsp;Product Sales Database</h3>

<img class="image-center" src="images/ProductSalesSampleDatabase.png" alt="Database diagram" />

[TODO] Explanation

<a class="references" href="../howto/References.html#mysql">Link to MySQL References &amp; Resources</a>

<h2>MySQL Create User and Grant Permissions</h2>
<a href="https://www.strongdm.com/blog/mysql-create-user-manage-access-privileges-how-to" class="whitebut ">MySQL Create User and Grant Permissions</a>
Create a new MySQL user account
mysql> CREATE USER 'local_user'@'localhost' IDENTIFIED BY 'password';

Alternatively use a wildcard character (%) in the host definition to grant access to the MySQL instance for a user:
mysql> CREATE USER ‘subnet_user’@'10.0.%' IDENTIFIED BY ‘password’;

In the above example, the `10.0.%` specifies that the user can access the MySQL instance from any client that has an IP address beginning with `10.0.`.
You may use the wild card at any level of the IP address in the host definition.

To view all users in your MySQL instance, use the SELECT command:
mysql> SELECT * FROM mysql.user;

Grant permissions to a MySQL user account
The GRANT statement allows you to set MySQL access permissions using the following syntax:

mysql> GRANT privilege ON privilege_level TO account_name;
Type the following to grant `SELECT` and `INSERT` privileges to a local user on the `strongdm` database:

mysql> GRANT SELECT, INSERT ON strongdm.* TO ‘local_user’@’localhost’;
To create a user with the same privileges as the root user, use the following command, which grants global privileges to the user Janet connecting via localhost:

mysql> GRANT ALL ON *.* TO 'janet'@'localhost' WITH GRANT OPTION;
The WITH GRANT OPTION clause allows users to grant their privileges to other users.

<script src='https://williamkpchan.github.io/LibDocs/readbook.js'></script>
<script>
var lazyLoadInstance = new LazyLoad({
 elements_selector: ".lazy"
});
</script>

</body></html>
