<base target="_blank">
<base href=https://css-tricks.com>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">


<style type="text/css">
a {	text-decoration: none;}
A:hover {	color: yellow;}
A:focus {	color: red;}
#newtype { color: pink}
#redpink { color: #cc0099}
#redword { color: red}
#yellowword { color: yellow}
#greenword { color: green}
#orangeword { color: orange}
#whiteword { color: white}
#grayword { color: gray}
#brownword { color: #ff8000}
#yellowgreen { color: #bfff00}
#palered { color: #ffcccc}
#goldword { color: GoldenRod}

.highlight { 
    color: gray;
    background-color: #002030
  }

.idl-code { 
	white-space: pre; 
	color: orange;
	background-color: #002020; 
}
.java-code { 
	white-space: pre; 
	color: orange;
	background-color: #002020; 
}
.code-block { 
	white-space: pre; 
	color: orange;
	background-color: #002020; 
}
.ecma-block { 
	color: orange;
	background-color: #002020; 
}

.interface-name {
        font-weight: bold
}


.attribute-name {  
        color: orange;
        background-color: #002030;
}

.method-name {  
        color: orange;
        background-color: #002030;
}

.parameter-name {
	margin-top: 1%;
        background-color: #002030; 
        color: orange;
}

</STYLE>

</head>
<body bgcolor="#000000" text="#109030" leftmargin="10" topmargin="10" marginwidth="150" link="#08C8A8" vlink="#389898" alink="#28B8B8">
<FONT size=3>

<style type='text/css'>img#wpstats{display:none}</style>
<link rel="amphtml" href="https://css-tricks.com/php-for-beginners-building-your-first-simple-cms/amp/" />  
</head>

<body class="single single-post postid-1907 single-format-standard">
<h1 class="p-name">PHP for Beginners: Building Your First Simple CMS</h1>
<h3 id="orangeword">The Magic of PHP + MySQL<br>
Building the Class<br>
The Variables<br>
Build the Database<br>
Connect to the Database<br>
Build the Form<br>
Saving the Data to the Database<br>
Displaying the Information from the Database<br>
Using the Class<br>
</h3>
<h3 id="orangeword">The Magic of PHP + MySQL</h3>
<p>It's safe to say that nearly every website that's up-to-date these days is using some form of content management system (CMS). While there are a ton of great free options that provide us with a CMS to power a website (WordPress, Drupal, etc.), it doesn't hurt to peek under the hood and get a feel for how these systems work.</p>
<p>To get our feet wet as back-end developers, we'll be creating a simple PHP class that will:</p>
<ul>
<li>Create a database</li>
<li>Connect to a database</li>
<li>Display a form with two fields</li>
<li>Save the form data in the database</li>
<li>Display the saved data from the database</li>
</ul>
<p><a href="http://css-tricks.com/examples/SimpleCMS.zip" class="button">Download Files</a></p>
<p><span id="more-1907"></span></p>
<p>This class is intended to give you a feel for how PHP and MySQL interact together, and to show the basics of a CMS. I'll be skipping explanations of some of the very basic programming stuff, so if at any point you feel lost, checkout the course <a href="http://net.tutsplus.com/articles/news/diving-into-php/">Diving into PHP</a> and give yourself a crash-course in PHP. I'll try not to lose anyone, though, I promise.</p>
<h3 id="orangeword">Building the Class</h3>
<p>Our first step is to simply lay out the class in a file named 'simpleCMS.php' so we have a road map to work with.</p>
<pre rel="PHP" class="lang-php"><code>&lt;?php

class simpleCMS {
  var $host;
  var $username;
  var $password;
  var $table;

  public function display_public() {
    
  }

  public function display_admin() {
    
  }

  public function write() {
    
  }

  public function connect() {
    
  }

  private function buildDB() {
    
  }
}

?&gt;</code></pre>
<p>As you can see, we're creating one class with four variables and five methods. I've opted to use PHP's <a href="http://en.wikipedia.org/wiki/Object_oriented">object-oriented approach</a> because it makes for cleaner code in large projects, and, in my opinion, it's just good practice.</p>
<h3 id="orangeword">The Variables</h3>
<p>In this case, all four variables are for connecting to the database: <code>$host</code>, <code>$username</code>, <code>$password</code>, and <code>$table</code> provide a path and access to our database on the server. For now, we'll leave those empty and move on to our database, which is constructed by the method <code>buildDB()</code>.</p>
<h3 id="orangeword">Build the Database</h3>
<pre rel="PHP" class="lang-php"><code>private function buildDB() {
    $sql = &lt;&lt;&lt;MySQL_QUERY
        CREATE TABLE IF NOT EXISTS testDB (
            title	VARCHAR(150),
            bodytext	TEXT,
            created	VARCHAR(100)
    )
    MySQL_QUERY;

    return mysql_query($sql);
}</code></pre>
<p>This function runs a MySQL command that checks the database to see if <tt>testDB</tt> exists. If so, it simply passes along a notification of success; if not, it creates our table and assigns three columns to hold data.</p>
<h3 id="orangeword">Connect to the Database</h3>
<p>Now that we have a function to build our table, let's create the function that will connect to our database.</p>
<pre rel="PHP" class="lang-php"><code>public function connect() {
    mysql_connect($this-&gt;host,$this-&gt;username,$this-&gt;password) or die("Could not connect. " . mysql_error());
    mysql_select_db($this-&gt;table) or die("Could not select database. " . mysql_error());

    return $this-&gt;buildDB();
}</code></pre>
<p>We call <a href="http://us2.php.net/manual/en/function.mysql-connect.php">mysql_connect()</a> to hook into our database, and then <a href="http://us2.php.net/manual/en/function.mysql-select-db.php">mysql_select_db()</a> to make sure we save our data in the right place. Both of these functions are accompanied by the <code>die()</code> command, which essentially says, "in the event that this function fails, stop execution of this script and display a message."</p>
<p>Our <code>connect()</code> function connects to the database and gets us pointed in the right direction, then runs our <code>buildDB()</code> function. Remember the grammatically awkward "IF NOT EXISTS" part of our MySQL command? Because we're going to run this function every time the page is loaded, we have to make sure we're not overwriting our database with every function call, and that's exactly what that phrase requires.</p>
<h3 id="orangeword">Build the Form</h3>
<p>So, we've got a database. Now we just need to put stuff in it!</p>
<pre rel="PHP" class="lang-php"><code>public function display_admin() {
    return &lt;&lt;&lt;ADMIN_FORM

    &lt;form action="{$_SERVER['PHP_SELF']}" method="post"&gt;
      &lt;label for="title"&gt;Title:&lt;/label&gt;
      &lt;input name="title" id="title" type="text" maxlength="150" /&gt;
      &lt;label for="bodytext"&gt;Body Text:&lt;/label&gt;
      &lt;textarea name="bodytext" id="bodytext"&gt;&lt;/textarea&gt;
      &lt;input type="submit" value="Create This Entry!" /&gt;
    &lt;/form&gt;

ADMIN_FORM;
}</code></pre>
<p>Again, this is a very simple function. When called, it simply returns the HTML markup to create our form. You'll notice, however, in the <code>action</code> attribute of the <code>form</code> element, that I've used the variable <code>$_SERVER['PHP_SELF']</code>. This is, essentially, a shortcut that references the file you're currently using (in our case, it's <code>display.php</code>). This is useful if you'll be reusing your code across a site and don't necessarily want to rewrite this function for each page.</p>
<p>I'm also going to take a second right now to talk about the method I'm using to return the HTML. It's a format used in PHP called HEREDOC syntax, and I <strong>love</strong> it.</p>
<p>The primary advantage of HEREDOC is that it allows you to include <em>formatting</em> in your output. This is extraordinarily useful for folks like me who take issue with cluttered source code. You can read more about HEREDOC syntax and its ilk in the <a href="http://us2.php.net/manual/en/language.types.string.php#language.types.string.syntax.heredoc">PHP manual</a>.</p>
<h3 id="orangeword">Saving the Data to the Database</h3>
<p>Our form will allow us to input information, so how do we save it? That's where our <tt>write()</tt> method comes in.</p>
<pre rel="PHP" class="lang-php"><code>public function write($p) {
    if ( $p['title'] )
      $title = mysql_real_escape_string($p['title']);
    if ( $p['bodytext'])
      $bodytext = mysql_real_escape_string($p['bodytext']);
    if ( $title &amp;&amp; $bodytext ) {
      $created = time();
      $sql = "INSERT INTO testDB VALUES('$title','$bodytext','$created')";
      return mysql_query($sql);
    } else {
      return false;
    }
}</code></pre>
<p>Let's start with the function call itself &mdash; we're passing a variable to this one, which we haven't done so far. Our variable <code>$p</code> is going to hold the information sent from our form via the <a href="http://www.html-form-guide.com/php-form/php-form-post.html">post method</a>.</p>
<p>Once inside the function, we start with a <a href="http://us2.php.net/manual/en/control-structures.if.php">conditional statement</a> that's checking to see if the the <code>title</code> value was set in the form before it was submitted, and if so, we're setting our <code>$title</code> variable to the <code>$_POST['title']</code> value (<strong>NOTE:</strong> we're using the function <a href="http://us2.php.net/manual/en/function.mysql-real-escape-string.php">mysql_real_escape_string()</a> as a precaution against potentially dangerous input, which is important to keep in mind when you're building <em>anything</em> that will allow users to input information). If <code>$_POST['title']</code> wasn't set, we skip this line, leaving the <code>$title</code> variable unset.</p>
<p>This process is repeated for our second input, and then both variables are checked to make sure nothing is blank before saving to the database. If both variables are set, we then set the <code>$created</code> variable with the current <a href="http://en.wikipedia.org/wiki/Unix_time">Unix timestamp</a>, which we'll use to sort our entries chronologically when we view them in the future.</p>
<p>We now have three variables, and because we've run checks, we know that all three variables are not empty. Now we can write our MySQL query that will save the entry in the database!</p>
<h3 id="orangeword">Displaying the Information from the Database</h3>
<p>Now that we have the means to put information <em>into</em> our database, we need to create a way to get that information back <em>out.</em> This is where <code>display_public()</code> comes in. This is by far the most complex of our methods, so let's really take our time and figure out what's going on inside.</p>
<pre rel="PHP" class="lang-php"><code>public function display_public() {
    $q = "SELECT * FROM testDB ORDER BY created DESC LIMIT 3";
    $r = mysql_query($q);

    if ( $r !== false &amp;&amp; mysql_num_rows($r) &gt; 0 ) {
      while ( $a = mysql_fetch_assoc($r) ) {
        $title = stripslashes($a['title']);
        $bodytext = stripslashes($a['bodytext']);

        $entry_display .= &lt;&lt;&lt;ENTRY_DISPLAY

    &lt;h2&gt;$title&lt;/h2&gt;
    &lt;p&gt;
      $bodytext
    &lt;/p&gt;

ENTRY_DISPLAY;
      }
    } else {
      $entry_display = &lt;&lt;&lt;ENTRY_DISPLAY

    &lt;h2&gt;This Page Is Under Construction&lt;/h2&gt;
    &lt;p&gt;
      No entries have been made on this page. 
      Please check back soon, or click the
      link below to add an entry!
    &lt;/p&gt;

ENTRY_DISPLAY;
    }
    $entry_display .= &lt;&lt;&lt;ADMIN_OPTION

    &lt;p class="admin_link"&gt;
      &lt;a href="{$_SERVER['PHP_SELF']}?admin=1"&gt;Add a New Entry&lt;/a&gt;
    &lt;/p&gt;

ADMIN_OPTION;

    return $entry_display;
  }</code></pre>
<p>The first thing to note when reading from a database is the way PHP and MySQL interact with each other. First, we ask the database a question (query), to which it replies with a result (resource). However, this result isn't really useful until we've decoded it using one of several methods that "fetch," or organize, the information that's contained inside into a usable form (array).</p>
<p>Our very first action in the above function is to set up our query in the variable <code>$q</code>. The asterisk (*) operator in MySQL means "everything," so our query is asking the database to select <em>everything</em> from entries in the table <code>testDB</code> in reverse chronological order, limited to the first three entries returned.</p>
<p>Now that the query is defined, we send it to the database using the function <a href="http://us2.php.net/manual/en/function.mysql-query.php">mysql_query()</a>. The resulting resource is stored in the variable <code>$r</code>. This is where it gets a bit tricky.</p>
<p>We now run a conditional statement that says, "IF <code>mysql_query()</code> didn't fail, AND IF the number of entries returned was greater than zero, process the result, OR ELSE display a default message."</p>
<p>If <code>$r</code> contains entries from the database, we now have to "fetch" that data. Information from the database is returned as an <a href="http://us2.php.net/manual/en/language.types.array.php">array</a>, which is organized similarly to the database table itself. The function <a href="http://us2.php.net/manual/en/function.mysql-fetch-assoc.php">mysql_fetch_assoc()</a> will take the resource and break each entry into an associative array (this means that when we save the result of <code>mysql_fetch_assoc()</code> into the variable <code>$a</code>, the data from the entry will be accessible by the column names in the database, i.e. <code>$a['title']</code>).</p>
<p>However, <code>mysql_fetch_assoc()</code> only gives us one entry at a time. To get <em>all</em> of the returned entries, we have to use a <a href="http://us2.php.net/while">while loop</a>. Essentially, we're saying, "WHILE <code>$r</code> has values we haven't used yet, get the next entry in line and do the following actions with it."</p>
<p>In this case, we're going to check the entry to make sure that data was returned, then remove the slashes that were added when we saved the information to the database using <a href="http://us2.php.net/manual/en/function.stripslashes.php">stripslashes()</a>. After that, we simply wrap the variables in some HTML and, <em>voila!</em> we've got screen-ready content!</p>
<p>As a final step, the code adds a link to the bottom that allows users to add an entry. It's worth noting the use of the ".=" operator used in the <code>while</code> loop and when creating the "Add a New Entry" link; a function can only return one variable, so we need to <em>append</em> the new information to the existing variable. If we just used the equals sign ("="), we would overwrite existing data and end up with just a link to the form and no content.</p>
<p>So, you've now written your first CMS class! You can easily write and retrieve data to and from a database. All that's left to do is to try it out!</p>
<h3 id="orangeword">Using the Class</h3>
<p>To use our class, we need to create a separate file. I'm going to call it "display.php", which I'll save in the main web folder, with our class saved as "simpleCMS.php" in a folder called "_class" within the main folder. To start, we just set up a document with plain ol' HTML.</p>
<pre rel="HTML" class="lang-html"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

  &lt;head&gt;
    &lt;title&gt;SimpleCMS&lt;/title&gt;
  &lt;/head&gt;

  &lt;body&gt;

  &lt;/body&gt;

&lt;/html&gt;</code></pre>
<p>To use our class, we just have to insert a little PHP between the body tags:</p>
<pre rel="PHP" class="lang-php"><code>&lt;?php

  include_once('_class/simpleCMS.php');
  $obj = new simpleCMS();
  $obj-&gt;host = 'database.host.net';
  $obj-&gt;username = 'DB1234567';
  $obj-&gt;password = 'DBpassword';
  $obj-&gt;table = 'DB1234567';
  $obj-&gt;connect();

  if ( $_POST )
    $obj-&gt;write($_POST);

  echo ( $_GET['admin'] == 1 ) ? $obj-&gt;display_admin() : $obj-&gt;display_public();

?&gt;</code></pre>
<p>First and foremost, we have to include the class using the <a href="http://us2.php.net/manual/en/function.include-once.php">include_once()</a> function. Then, we have to instantiate our object so that our code knows what's going on. Third, we set all of those variables we talked about toward the beginning of this tutorial. You'll have to replace all of those values with the information you get from your own server or hosting company. And fourth, we connect to our database using the <code>connect()</code> method.</p>
<p>After we've connected to the database, we check to see if any <code>$_POST</code> information exists. This is because we're using the same file for input, processing, and display of information. If anything was passed via <code>$_POST</code>, we run the <code>write()</code> function to validate it and save it to the database. Then, we use some shorthand trickery to run a conditional statement. In essence, we're saying, "IF <code>$_GET['admin']</code> is set to 1, then show the form using <code>display_admin()</code>, OR ELSE show me the stored entries using <code>display_public()</code>."</p>
<p>And that's it! Once you get a feel for it, this sort of basic programming will allow you to start exercising <em>total control</em> over websites you build, whether you decide to really dig in and build your own CMS framework or just improve an existing CMS by, say, <a href="http://codex.wordpress.org/Writing_a_Plugin">writing a WordPress plugin</a>.</p>
<p>Really, when it comes to modern web design, you should have at least <em>some</em> understanding of how things are working behind the curtain&mdash;understanding <em>how</em> a site works will better enable you to design sites that have a more fluid integration of form and function. And besides, adding PHP and MySQL to your <em>curriculum vitae</em> definitely won't hurt your credibility...</p>
<p><a href="http://css-tricks.com/examples/SimpleCMS.zip" class="button">Download Files</a></p>
