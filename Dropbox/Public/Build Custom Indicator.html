
<base target="_blank">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">


<style type="text/css">
a {	text-decoration: none;}
A:hover {	color: yellow;}
A:focus {	color: red;}
#newtype { color: pink}
#redpink { color: #cc0099}
#redword { color: red}
#yellowword { color: yellow}
#greenword { color: green}
#limeword { color: #00ff00}
#orangeword { color: orange}
#cyanword { color: cyan}
#whiteword { color: white}
#grayword { color: gray}
#brownword { color: #ff8000}
#yellowgreen { color: #bfff00}
#palered { color: #ffcccc}
#blueword { color: dodgerblue}
#purpleword { color: darkorchid}
#goldword { color: GoldenRod}
#silverword { color: silver}
#blackword { color: black}
.left {
    position: absolute;
    left: 100px;
    color: GoldenRod;
    border: 1px solid GoldenRod;
    padding: 2px;
    font-size: 60%;
}
.bord {
    color: redpink;
    border: 1px solid GoldenRod;
    padding: 1px;
    font-size: 90%;
}
.highlight { 
    color: white;
    background-color: #002030
  }
</STYLE>

</head>
<body bgcolor="#000000" text="#109030" leftmargin="10" topmargin="10" marginwidth="100" link="#08C8A8" vlink="#389898" alink="#28B8B8">
<FONT size=3>

<h1 >Building and Plotting a Custom Indicator in&nbsp;R</h1>

<h2 align="right">Learning R For Finance &#8211; Post 21</h2>
<p>One of the most interesting features offered by the <em>quantmod</em> package is the possibility to build custom made indicators.</p>
<p>As in the previous post, we use the custom function <em>read.prices</em> that we introduced <a href="https://finbloggers.wordpress.com/2015/12/02/first-things-first-the-data-an-aside-on-r-functions/" target="_blank">here</a>. By default, this function reads the data in the &#8220;<em>c:\\My Programs\\R\\Finance\\stocks\\</em>&#8221; <br>
The contents of the folder are included in <a href="https://finbloggers.files.wordpress.com/2016/01/stocks-zip.doc">this zipped file</a> (just remember to remove the fake *.doc extension before unzipping).</p>
<pre class="brush: r; title: ; notranslate" title="">
library(quantmod)

# read prices
source(&quot;c:\\My Programs\\R\\Finance\\read.prices_function.r&quot;)
data = read.prices()

# show the tickers
names(data)

## [1] &quot;G.MI&quot;   &quot;IBE.MC&quot; &quot;BNP.PA&quot; &quot;ENI.MI&quot; &quot;BAYN.DE&quot; &quot;REP.MC&quot; &quot;BMW.DE&quot;
## [8] &quot;UG.PA&quot;

# we choose BMW.DE for this example. Let'use only the adjusted prices since the
# beginning of 2012. The instruction &quot;Ad&quot; chooses the adjusted price only.

BMW = Ad(data$BMW.DE)[&quot;2012::&quot;]

# Let's create a custom technical indicator that is the average of three simple
# moving averages and let's call it Av.TripleSMA. First we define a R custom 
# function that computes our indicator. We use simple moving averages (SMA)
# computed on 21, 42 and 63 days (roughly 1, 2 and 3 months):

Av.TripleSMA = function(x) {
ATS = (SMA(x, 21) + SMA(x, 42) + SMA(x, 63))/3
return(ATS)
}

# Then, we use the &quot;newTA&quot; instruction in order to make our indicator recognizable
# by quantmod. The &quot;on = 1&quot; argument tells quantmod to draw the indicator on the
# main plotting area of the chart (the same where the price is plotted).

custom.indicator = newTA(FUN = Av.TripleSMA, legend.name = &quot;Av. Triple SMA&quot;, on = 1)

# Finally, we chart the price and the custom indicator with the following two
# instructions:

chartSeries(BMW, name = &quot;BMW - Adj Prices&quot;, theme = chartTheme(&quot;white&quot;))
custom.indicator()
</pre>
<p><a href="https://finbloggers.files.wordpress.com/2016/01/21-1.png" rel="attachment wp-att-727"><img class="aligncenter size-full wp-image-727" src="https://finbloggers.files.wordpress.com/2016/01/21-1.png?w=809" alt="21-1"   /></a></p>
<p>The key instruction here is <strong>newTA</strong> that accepts custom built functions as arguments, and returns a function that can be called in <strong>chartSeries</strong> in the same way as the R built-in technical indicators. See <em>?newTA</em> for further information.</p>
<hr size="2" width="33%" />


<h1 class="entry-title">Testing the Performance of a Custom Indicator in&nbsp;R</h1>

<h2 align="right">Learning R For Finance – Post 22</h2>
<p>In the <a href="https://finbloggers.wordpress.com/2016/01/30/building-and-plotting-a-custom-indicator-in-r/" target="_blank">previous post</a> we used the <em>quantmod</em> and the <em>PerformanceAnalytics</em> packages to build and plot an indicator on the BMW stock.</p>

<p>Once again we use the custom function <em>read.prices</em>.</p>

<div><div id="highlighter_743471" class="syntaxhighlighter  r"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="r functions">library</code><code class="r plain">(quantmod)</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="r functions">library</code><code class="r plain">(PerformanceAnalytics)</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="r comments"># read prices</code></div><div class="line number6 index5 alt1"><code class="r functions">source</code><code class="r plain">(</code><code class="r string">"c:\\My Programs\\R\\Finance\\read.prices_function.r"</code><code class="r plain">)</code></div><div class="line number7 index6 alt2"><code class="r plain">data = </code><code class="r functions">read.prices</code><code class="r plain">()</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="r comments"># show the tickers</code></div><div class="line number10 index9 alt1"><code class="r functions">names</code><code class="r plain">(data)</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="r comments">## [1] "G.MI"&nbsp;&nbsp; "IBE.MC" "BNP.PA" "ENI.MI" "BAYN.DE" "REP.MC" "BMW.DE"</code></div><div class="line number13 index12 alt2"><code class="r comments">## [8] "UG.PA"</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="r comments"># we choose BMW.DE for this example. Let'use only the adjusted prices since the beginning</code></div><div class="line number16 index15 alt1"><code class="r comments"># of 2012. The instruction "Ad" chooses the adjusted price only.</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="r plain">BMW = </code><code class="r functions">Ad</code><code class="r plain">(data$BMW.DE)[</code><code class="r string">"2012::"</code><code class="r plain">]</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="r comments"># let's compute the daily returns of BMW and of an hypothetical cash asset assuming that</code></div><div class="line number21 index20 alt2"><code class="r comments"># the latter always yields zero:</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="r plain">rets = </code><code class="r functions">na.omit</code><code class="r plain">(</code><code class="r functions">Return.calculate</code><code class="r plain">(BMW, method=</code><code class="r string">"discrete"</code><code class="r plain">))</code></div><div class="line number24 index23 alt1"><code class="r plain">rets$cash = 0</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="r comments"># Let's create a custom technical indicator that is the average of three simple moving</code></div><div class="line number28 index27 alt1"><code class="r comments"># averages. First we define a new function that computes our indicator.</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="r plain">Av.TripleSMA = </code><code class="r functions">function</code><code class="r plain">(x) {</code></div><div class="line number31 index30 alt2"><code class="r plain">ATS = (</code><code class="r functions">SMA</code><code class="r plain">(x, 21) + </code><code class="r functions">SMA</code><code class="r plain">(x, 42) + </code><code class="r functions">SMA</code><code class="r plain">(x, 63))/3</code></div><div class="line number32 index31 alt1"><code class="r functions">return</code><code class="r plain">(ATS)</code></div><div class="line number33 index32 alt2"><code class="r plain">}</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="r comments"># Let's apply the function to BMW prices:</code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="r plain">AvTSMA = </code><code class="r functions">Av.TripleSMA</code><code class="r plain">(BMW)</code></div><div class="line number38 index37 alt1">&nbsp;</div><div class="line number39 index38 alt2"><code class="r comments"># define a xts object called "weight" with the same class and dimension as &nbsp;"BMW" </code></div><div class="line number40 index39 alt1"><code class="r comments"># and fill it all with NA:</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="r plain">weight = </code><code class="r keyword">NA</code><code class="r plain">*BMW</code></div><div class="line number43 index42 alt2">&nbsp;</div><div class="line number44 index43 alt1"><code class="r comments"># the investment rule is to buy when the price crosses the indicator upward and to</code></div><div class="line number45 index44 alt2"><code class="r comments"># stop the position going all cash when the price crosses the indicator downward</code></div><div class="line number46 index45 alt1">&nbsp;</div><div class="line number47 index46 alt2"><code class="r comments"># these two instructions return TRUE when their condition is met:</code></div><div class="line number48 index47 alt1"><code class="r plain">weight.long = weight[((BMW &gt; AvTSMA) &amp; (</code><code class="r functions">lag</code><code class="r plain">(BMW,1) &lt; </code><code class="r functions">lag</code><code class="r plain">(AvTSMA,1)))]</code></div><div class="line number49 index48 alt2"><code class="r plain">weight.stop.long = weight[((BMW &lt; AvTSMA) &amp; (</code><code class="r functions">lag</code><code class="r plain">(BMW,1) &gt; </code><code class="r functions">lag</code><code class="r plain">(AvTSMA,1)))]</code></div><div class="line number50 index49 alt1">&nbsp;</div><div class="line number51 index50 alt2"><code class="r comments"># these two instructions convert TRUE respectively to 1 (=100% weight) and 0</code></div><div class="line number52 index51 alt1"><code class="r plain">weight.long$BMW[</code><code class="r functions">is.na</code><code class="r plain">(weight.long$BMW)] = 1</code></div><div class="line number53 index52 alt2"><code class="r plain">weight.stop.long$BMW[</code><code class="r functions">is.na</code><code class="r plain">(weight.stop.long$BMW)] = 0</code></div><div class="line number54 index53 alt1">&nbsp;</div><div class="line number55 index54 alt2"><code class="r comments"># these two instructions create a "weight" xts object that shows 100% weight in BMW</code></div><div class="line number56 index55 alt1"><code class="r comments"># or 100% weight in cash:</code></div><div class="line number57 index56 alt2"><code class="r plain">weight = </code><code class="r functions">rbind</code><code class="r plain">(weight.long$BMW, weight.stop.long$BMW)</code></div><div class="line number58 index57 alt1"><code class="r plain">weight$cash = 1 - weight$BMW</code></div><div class="line number59 index58 alt2">&nbsp;</div><div class="line number60 index59 alt1"><code class="r comments"># we now backtest and plot the portfolio using the weights just calculated</code></div><div class="line number61 index60 alt2">&nbsp;</div><div class="line number62 index61 alt1"><code class="r plain">rets.p = </code><code class="r functions">Return.portfolio</code><code class="r plain">(rets,weights = weight, geometric = </code><code class="r keyword">TRUE</code><code class="r plain">, verbose = </code><code class="r keyword">TRUE</code><code class="r plain">)</code></div><div class="line number63 index62 alt2"><code class="r functions">charts.PerformanceSummary</code><code class="r plain">(rets.p$returns, main = </code><code class="r string">"Performance"</code><code class="r plain">)</code></div></div></td></tr></tbody></table></div></div>
<p>
<img  src="https://finbloggers.files.wordpress.com/2016/01/22-1.png"></a></p>
<div><div id="highlighter_926315" class="syntaxhighlighter  r"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="r comments"># the following is an utility function to compute some portfolio statistics</code></div><div class="line number2 index1 alt1"><code class="r plain">showStats = </code><code class="r keyword">function</code><code class="r plain">(rets,rf = 0,prob = 0.95) {</code></div><div class="line number3 index2 alt2"><code class="r plain">stats = </code><code class="r functions">rbind</code><code class="r plain">(</code><code class="r functions">table.AnnualizedReturns</code><code class="r plain">(rets,scale = 252,Rf = rf),</code></div><div class="line number4 index3 alt1"><code class="r spaces">&nbsp;</code><code class="r plain">+ </code><code class="r functions">maxDrawdown</code><code class="r plain">(rets), </code><code class="r functions">CalmarRatio</code><code class="r plain">(rets, scale = 252),</code><code class="r functions">AdjustedSharpeRatio</code><code class="r plain">(rets, Rf = rf),</code></div><div class="line number5 index4 alt2"><code class="r spaces">&nbsp;</code><code class="r plain">+ </code><code class="r functions">VaR</code><code class="r plain">(rets, p = prob, method = </code><code class="r string">"historical"</code><code class="r plain">), </code><code class="r functions">ETL</code><code class="r plain">(rets, p = prob,&nbsp;&nbsp; method = </code><code class="r string">"historical"</code><code class="r plain">),</code></div><div class="line number6 index5 alt1"><code class="r spaces">&nbsp;</code><code class="r plain">+ </code><code class="r functions">VaR</code><code class="r plain">(rets, p = prob, method = </code><code class="r string">"modified"</code><code class="r plain">), </code><code class="r functions">ETL</code><code class="r plain">(rets,&nbsp;&nbsp; p=prob, method = </code><code class="r string">"modified"</code><code class="r plain">))</code></div><div class="line number7 index6 alt2"><code class="r functions">row.names</code><code class="r plain">(stats)[4] = </code><code class="r string">"Max Drawdown"</code></div><div class="line number8 index7 alt1"><code class="r functions">row.names</code><code class="r plain">(stats)[5] = </code><code class="r string">"Calmar Ratio"</code></div><div class="line number9 index8 alt2"><code class="r functions">row.names</code><code class="r plain">(stats)[6] = </code><code class="r string">"Adjusted Sharpe"</code></div><div class="line number10 index9 alt1"><code class="r functions">row.names</code><code class="r plain">(stats)[7] = </code><code class="r functions">paste</code><code class="r plain">(</code><code class="r string">"VaR (historical) "</code><code class="r plain">,</code><code class="r string">"p="</code><code class="r plain">,prob,sep=</code><code class="r string">""</code><code class="r plain">)</code></div><div class="line number11 index10 alt2"><code class="r functions">row.names</code><code class="r plain">(stats)[8] = </code><code class="r functions">paste</code><code class="r plain">(</code><code class="r string">"Exp. Shortfall (historical) "</code><code class="r plain">,</code><code class="r string">"p="</code><code class="r plain">,prob,sep=</code><code class="r string">""</code><code class="r plain">)</code></div><div class="line number12 index11 alt1"><code class="r functions">row.names</code><code class="r plain">(stats)[9] = </code><code class="r functions">paste</code><code class="r plain">(</code><code class="r string">"VaR (modified) "</code><code class="r plain">,</code><code class="r string">"p="</code><code class="r plain">,prob,sep=</code><code class="r string">""</code><code class="r plain">)</code></div><div class="line number13 index12 alt2"><code class="r functions">row.names</code><code class="r plain">(stats)[10] = </code><code class="r functions">paste</code><code class="r plain">(</code><code class="r string">"Exp. Shortfall (modified) "</code><code class="r plain">,</code><code class="r string">"p="</code><code class="r plain">,prob,sep=</code><code class="r string">""</code><code class="r plain">)</code></div><div class="line number14 index13 alt1"><code class="r functions">return</code><code class="r plain">(</code><code class="r functions">round</code><code class="r plain">(stats, 3))</code></div><div class="line number15 index14 alt2"><code class="r plain">}</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="r comments"># display some portfolio performance (return and risk) indices:</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="r functions">showStats</code><code class="r plain">(rets.p$returns)</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="r comments">##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; portfolio.returns</code></div><div class="line number22 index21 alt1"><code class="r comments">## Annualized Return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.075</code></div><div class="line number23 index22 alt2"><code class="r comments">## Annualized Std Dev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.169</code></div><div class="line number24 index23 alt1"><code class="r comments">## Annualized Sharpe (Rf=0%)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.444</code></div><div class="line number25 index24 alt2"><code class="r comments">## Max Drawdown&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;0.179</code></div><div class="line number26 index25 alt1"><code class="r comments">## Calmar Ratio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.418</code></div><div class="line number27 index26 alt2"><code class="r comments">## Adjusted Sharpe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.488</code></div><div class="line number28 index27 alt1"><code class="r comments">## VaR (historical) p=0.95&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.015</code></div><div class="line number29 index28 alt2"><code class="r comments">## Exp. Shortfall (historical) p=0.95&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.027</code></div><div class="line number30 index29 alt1"><code class="r comments">## VaR (modified) p=0.95&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.016</code></div><div class="line number31 index30 alt2"><code class="r comments">## Exp. Shortfall (modified) p=0.95&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.023</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="r comments"># and the five worst drawdowns:</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="r functions">table.Drawdowns</code><code class="r plain">(rets.p$returns, top=5, digits=4)</code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="r comments">##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; From&nbsp;&nbsp;&nbsp;&nbsp; Trough&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; To&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Depth&nbsp;&nbsp; Length&nbsp; To Trough Recovery</code></div><div class="line number38 index37 alt1"><code class="r comments">## 1&nbsp;&nbsp; 2012-04-18 2012-10-10&nbsp;&nbsp; 2012-12-21&nbsp; -0.1794&nbsp;&nbsp; 178&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 126&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 52</code></div><div class="line number39 index38 alt2"><code class="r comments">## 2&nbsp;&nbsp; 2013-12-03 2015-01-09&nbsp;&nbsp; 2015-01-23&nbsp; -0.1398&nbsp;&nbsp; 299&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 289&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10</code></div><div class="line number40 index39 alt1"><code class="r comments">## 3&nbsp;&nbsp; 2015-03-17 2015-09-18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;NA&gt;&nbsp;&nbsp;&nbsp; -0.1390&nbsp;&nbsp; 159&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 134&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NA</code></div><div class="line number41 index40 alt2"><code class="r comments">## 4&nbsp;&nbsp; 2013-01-03 2013-04-26&nbsp;&nbsp; 2013-05-20&nbsp; -0.0831&nbsp;&nbsp;&nbsp; 98&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 82&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 16</code></div><div class="line number42 index41 alt1"><code class="r comments">## 5&nbsp;&nbsp; 2013-05-21 2013-07-10&nbsp;&nbsp; 2013-09-10&nbsp; -0.0750&nbsp;&nbsp;&nbsp; 81&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 44</code></div></div></td></tr></tbody></table></div></div>
<p>The only relative difficulty in the listing above is the construction of the portfolio weights that depend on the investment rule that has been chosen . It should be noted that the weights in the <em>PerformanceAnalytics</em> package can only be positive. This means that the package cannot be used to directly backtest an investment rule that also requires short sales. We will see how to use R to test short sales in the future.</p>
<p>As a final note, it is also important to observe that&nbsp; the price we have used for the analysis has been the adjusted close price. This means that risk indicators such as the <a href="https://finbloggers.wordpress.com/2016/01/04/three-important-rs-r-return-and-risk/" target="_blank">maximum drawdown</a> (MDD) may be slightly underestimated because this analysis does not take into account possible unfavourable infraday price movements (i.e. the adjusted low price would have been in most cases lower than the adjusted close price and therefore the infraday drawdown may have exceeded the end of day drawdown).</p>
