<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width"/>
<link rel="stylesheet" href="..\maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, .apply, div.title').click(function(){
    parent.history.back();
    return false;
    });
});
</script>
<style>
body{font-size: x-large;width:80%;margin-left: 10%}
h1, h2 {color: gold;}
</style>
</head><body>
<center><h1>using javascript to monitor stk trends</h1>
<div id="toc"></div></center>
<br>
<br>
<br>

<h2>script features : </h2>
<pre>
give alarms at turning points
monitor only one stk
</pre>

<h2>major functions:</h2>

<h3>Initial setup</h3>
<pre>
read variable to store the stk code from local storage
create a button to change stk code and store to local storage

create a button to change trend period and store to local storage
trend period will be hour and 5 mins options
</pre>

<h3>Collect data</h3>
<pre>
read updated data from source, avoiding the cors

  theHeader = "http://web.ifzq.gtimg.cn/appstock/app/hkfqkline/get?_var=kline_dayqfq&param=hk"
  theTail = ',day,,,1,qfq'
  con = url(paste0(theHeader,onecode,theTail), encoding = "GB2312") # GB2312


let script = document.createElement('script');
script.src = 'http://www.nealyang.cn/login?username=Nealyang&callback=callback';
document.body.appendChild(script);

function callback(res) {
  console.log(res);
}

function jsonCallback(json){
  console.log(json);
}

$.ajax({
  url: "http://run.plnkr.co/plunks/v8xyYN64V4nqCshgjKms/data-2.json",
  type: "application/json"
});
</pre>

<h3>extract data and store in variable</h3>

<h3>calculate trend data</h3>

<h3>comparison</h3>
<pre>
compare with previous trend data to decide alarm status
turning up:
if trend point is going down and data value is above trend point, trigger alarm(time, up, stkcode, value)

turning down:
if trend point is going up and data value is below trend point, trigger alarm(time, down, stkcode, value)
</pre>

<h3>alarm function</h3>
<pre>
&lt;audio id="xyz" src="beep1.mp3" preload="auto"&gt;&lt;/audio&gt;
&lt;b onclick="playAudio()"&gt;test it&lt;/b&gt;

&lt;script&gt;
function playAudio() { 
    document.getElementById('xyz').play();
    alert("time, up or down, stkcode, value!");
    record the time, status and value in local storage
} 
&lt;/script&gt;
</pre>

<br>
<br>
<br>
<br>

<script>
  $(function() {
    var toc = $('#toc');

    function makeLi(text, href) {
      return $('<a href="' + href + '" target="_self">' + text + '</a><br>');
    }

    $('h2,h3').each(function(i) {
      var chapter = $(this), chapterNumber = i + 1;
      toc.append(
        makeLi(chapter.text(), '#chapter-' + chapterNumber)
      );
      chapter.attr('id', 'chapter-' + chapterNumber);
    });

  });
</script>
</body>
</html>
