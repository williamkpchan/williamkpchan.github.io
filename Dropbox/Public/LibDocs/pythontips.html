<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width"/>
<link rel="stylesheet" href="..\maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script>
$(document).ready(function(){
    $('h1, h2, h3, h4, h5, .goldword, .apply, div.title').click(function(){
    parent.history.back();
    return false;
    });
});
</script>
<style>
body{font-size: x-large;}
h1, h2 {color: gold;}
strong{color: line;}
</style>
</head><body>
<center><span class="goldword">Intermediate Python</span>
<br>

<div id="toc"></div></center>
<br>
<br>
<br>

<h1></h1>
<div class="section" id="preface">
<h2>Preface</h2>
<p>Python is an amazing language with a strong and friendly community of programmers. However, there is a lack of documentation on what to learn after getting the basics of Python down your throat. Through this book I aim to solve this problem. I would give you bits of information about some interesting topics which you can further explore.</p>
<p>The topics which are discussed in this book open up your mind towards some nice corners of Python language. This book is an outcome of my desire to have something like this when I was beginning to learn Python.</p>
<p>If you are a beginner, intermediate or even an advanced programmer there is something for you in this book.</p>
<p>Please note that this book is not a tutorial and does not teach you Python. The topics are not explained in depth, instead only the minimum required information is given.</p>
<p>I am sure you are as excited as I am so let’s start!</p>
<p><strong>Note:</strong> This book is a continuous work in progress. If you find anything which you can further improve (I know you will find a lot of stuff) then kindly submit a pull request!</p>
</div>
<div class="section" id="author">
<h2>Author</h2>
<p>I am Muhammad Yasoob Ullah Khalid. I have been programming extensively in Python for over 3 years now. I have been involved in a lot of Open Source projects. I regularly blog about interesting Python topics over at my <a class="reference external" href="http://www.pythontips.com">blog</a> . In 2014 I also spoke at EuroPython which was held in Berlin. It is the biggest Python conference in Europe. If you have an interesting Internship opportunity for me then I would definitely like to hear from you!</p>
</div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>1. *args and **kwargs</h1>
<p>I have come to see that most new python programmers have a hard time
figuring out the *args and **kwargs magic variables. So what are they
? First of all let me tell you that it is not necessary to write *args
or **kwargs. Only the <code class="docutils literal notranslate"><span class="pre">*</span></code> (asterisk) is necessary. You could have
also written *var and **vars. Writing *args and **kwargs is just a
convention. So now lets take a look at *args first.</p>
<div class="section" id="usage-of-args">
<h2>1.1. Usage of *args</h2>
<p>*args and **kwargs are mostly used in function definitions. *args
and **kwargs allow you to pass a variable number of arguments to a
function. What variable means here is that you do not know beforehand
how many arguments can be passed to your function by the user
so in this case you use these two keywords. *args is used to send a
<strong>non-keyworded</strong> variable length argument list to the function. Here’s
an example to help you get a clear idea:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_var_args</span><span class="p">(</span><span class="n">f_arg</span><span class="p">,</span> <span class="o">*</span><span class="n">argv</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first normal arg:&quot;</span><span class="p">,</span> <span class="n">f_arg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">:</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;another arg through *argv:&quot;</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

<span class="n">test_var_args</span><span class="p">(</span><span class="s1">&#39;yasoob&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces the following result:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">first</span> <span class="n">normal</span> <span class="n">arg</span><span class="p">:</span> <span class="n">yasoob</span>
<span class="n">another</span> <span class="n">arg</span> <span class="n">through</span> <span class="o">*</span><span class="n">argv</span><span class="p">:</span> <span class="n">python</span>
<span class="n">another</span> <span class="n">arg</span> <span class="n">through</span> <span class="o">*</span><span class="n">argv</span><span class="p">:</span> <span class="n">eggs</span>
<span class="n">another</span> <span class="n">arg</span> <span class="n">through</span> <span class="o">*</span><span class="n">argv</span><span class="p">:</span> <span class="n">test</span>
</pre></div>
</div>
<p>I hope this cleared away any confusion that you had. So now let’s talk
about **kwargs</p>
</div>
<div class="section" id="usage-of-kwargs">
<h2>1.2. Usage of **kwargs</h2>
<p>**kwargs allows you to pass <strong>keyworded</strong> variable length of arguments
to a function. You should use **kwargs if you want to handle <strong>named
arguments</strong> in a function. Here is an example to get you going with it:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greet_me</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">greet_me</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;yasoob&quot;</span><span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">yasoob</span>
</pre></div>
</div>
<p>So you can see how we handled a keyworded argument list in our function.
This is just the basics of **kwargs and you can see how useful it is.
Now let’s talk about how you can use *args and **kwargs to call a
function with a list or dictionary of arguments.</p>
</div>
<div class="section" id="using-args-and-kwargs-to-call-a-function">
<h2>1.3. Using *args and **kwargs to call a function</h2>
<p>So here we will see how to call a function using *args and **kwargs.
Just consider that you have this little function:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_args_kwargs</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arg1:&quot;</span><span class="p">,</span> <span class="n">arg1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arg2:&quot;</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arg3:&quot;</span><span class="p">,</span> <span class="n">arg3</span><span class="p">)</span>
</pre></div>
</div>
<p>Now you can use *args or **kwargs to pass arguments to this little
function. Here’s how to do it:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># first with *args</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">test_args_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="n">arg1</span><span class="p">:</span> <span class="n">two</span>
<span class="n">arg2</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">arg3</span><span class="p">:</span> <span class="mi">5</span>

<span class="c1"># now with **kwargs:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;arg3&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;arg2&quot;</span><span class="p">:</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;arg1&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">test_args_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">arg1</span><span class="p">:</span> <span class="mi">5</span>
<span class="n">arg2</span><span class="p">:</span> <span class="n">two</span>
<span class="n">arg3</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<p><strong>Order of using *args **kwargs and formal args</strong></p>
<p>So if you want to use all three of these in functions then the order is</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_func</span><span class="p">(</span><span class="n">fargs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="when-to-use-them">
<h2>1.4. When to use them?</h2>
<p>It really depends on what your requirements are. The most common use
case is when making function decorators (discussed in another chapter).
Moreover it can be used in monkey patching as well. Monkey patching
means modifying some code at runtime. Consider that you have a class
with a function called <code class="docutils literal notranslate"><span class="pre">get_info</span></code> which calls an API and returns the
response data. If we want to test it we can replace the API call with
some test data. For instance:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">someclass</span>

<span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Test data&quot;</span>

<span class="n">someclass</span><span class="o">.</span><span class="n">get_info</span> <span class="o">=</span> <span class="n">get_info</span>
</pre></div>
</div>
<p>I am sure that you can think of some other use cases as well.</p>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>2. Debugging</h1>
<p>Debugging is also something which once mastered can greatly enhance your
bug hunting skills. Most of the newcomers neglect the importance of the
Python debugger (<code class="docutils literal notranslate"><span class="pre">pdb</span></code>). In this section I am going to tell you only a
few important commands. You can learn more about it from the official
documentation.</p>
<p><strong>Running from commandline</strong></p>
<p>You can run a script from the commandline using the Python debugger.
Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m pdb my_script.py
</pre></div>
</div>
<p>It would cause the debugger to stop the execution on the first statement
it finds. This is helpful if your script is short. You can then inspect
the variables and continue execution line-by-line.</p>
<p><strong>Running from inside a script</strong></p>
<p>You can set break points in the script itself so that you can inspect
the variables and stuff at particular points. This is possible using the
<code class="docutils literal notranslate"><span class="pre">pdb.set_trace()</span></code> method. Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pdb</span>

<span class="k">def</span> <span class="nf">make_bread</span><span class="p">():</span>
    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
    <span class="k">return</span> <span class="s2">&quot;I don&#39;t have time&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">make_bread</span><span class="p">())</span>
</pre></div>
</div>
<p>Try running the above script after saving it. You would enter the
debugger as soon as you run it. Now it’s time to learn some of the
commands of the debugger.</p>
<p><strong>Commands:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">c</span></code>: continue execution</li>
<li><code class="docutils literal notranslate"><span class="pre">w</span></code>: shows the context of the current line it is executing.</li>
<li><code class="docutils literal notranslate"><span class="pre">a</span></code>: print the argument list of the current function</li>
<li><code class="docutils literal notranslate"><span class="pre">s</span></code>: Execute the current line and stop at the first possible
occasion.</li>
<li><code class="docutils literal notranslate"><span class="pre">n</span></code>: Continue execution until the next line in the current function
is reached or it returns.</li>
</ul>
<p>The difference between <code class="docutils literal notranslate"><span class="pre">n</span></code>ext and <code class="docutils literal notranslate"><span class="pre">s</span></code>tep is that step stops
inside a called function, while next executes called functions at
(nearly) full speed, only stopping at the next line in the current
function.</p>
<p>These are just a few commands. <code class="docutils literal notranslate"><span class="pre">pdb</span></code> also supports post mortem. It is
also a really handy function. I would highly suggest you to look at the
official documentation and learn more about it.</p>
</div>
</div>
</div>

<h1></h1>
<h1>3. Generators</h1>
<p>First lets understand iterators. According to Wikipedia, an iterator is
an object that enables a programmer to traverse a container,
particularly lists. However, an iterator performs traversal and gives
access to data elements in a container, but does not perform iteration.
You might be confused so lets take it a bit slow. There are three parts
namely:</p>
<ul class="simple">
<li>Iterable</li>
<li>Iterator</li>
<li>Iteration</li>
</ul>
<p>All of these parts are linked to each other. We will discuss them one by
one and later talk about generators.</p>
<div class="section" id="iterable">
<h2>3.1. Iterable</h2>
<p>An <code class="docutils literal notranslate"><span class="pre">iterable</span></code> is any object in Python which has an <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> or a
<code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method defined which returns an <strong>iterator</strong> or can take
indexes (You can read more about them <a class="reference external" href="https://stackoverflow.com/a/20551346">here</a>).
In short an <code class="docutils literal notranslate"><span class="pre">iterable</span></code> is any object which can provide us
with an <strong>iterator</strong>. So what is an <strong>iterator</strong>?</p>
</div>
<div class="section" id="iterator">
<h2>3.2. Iterator</h2>
<p>An iterator is any object in Python which has a <code class="docutils literal notranslate"><span class="pre">next</span></code> (Python2) or
<code class="docutils literal notranslate"><span class="pre">__next__</span></code> method defined. That’s it. That’s an iterator. Now let’s
understand <strong>iteration</strong>.</p>
</div>
<div class="section" id="iteration">
<h2>3.3. Iteration</h2>
<p>In simple words it is the process of taking an item from something e.g a
list. When we use a loop to loop over something it is called iteration.
It is the name given to the process itself. Now as we have a basic
understanding of these terms let’s understand <strong>generators</strong>.</p>
</div>
<div class="section" id="id1">
<h2>3.4. Generators</h2>
<p>Generators are iterators, but you can only iterate over them once. It’s
because they do not store all the values in memory, they generate the
values on the fly. You use them by iterating over them, either with a
‘for’ loop or by passing them to any function or construct that
iterates. Most of the time <code class="docutils literal notranslate"><span class="pre">generators</span></code> are implemented as functions.
However, they do not <code class="docutils literal notranslate"><span class="pre">return</span></code> a value, they <code class="docutils literal notranslate"><span class="pre">yield</span></code> it. Here is a
simple example of a <code class="docutils literal notranslate"><span class="pre">generator</span></code> function:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generator_function</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
     <span class="k">yield</span> <span class="n">i</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">generator_function</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

<span class="c1"># Output: 0</span>
<span class="c1"># 1</span>
<span class="c1"># 2</span>
<span class="c1"># 3</span>
<span class="c1"># 4</span>
<span class="c1"># 5</span>
<span class="c1"># 6</span>
<span class="c1"># 7</span>
<span class="c1"># 8</span>
<span class="c1"># 9</span>
</pre></div>
</div>
<p>It is not really useful in this case. Generators are best for
calculating large sets of results (particularly calculations involving
loops themselves) where you don’t want to allocate the memory for all
results at the same time. Many Standard Library functions that return
<code class="docutils literal notranslate"><span class="pre">lists</span></code> in Python 2 have been modified to return <code class="docutils literal notranslate"><span class="pre">generators</span></code> in
Python 3 because <code class="docutils literal notranslate"><span class="pre">generators</span></code> require fewer resources.</p>
<p>Here is an example <code class="docutils literal notranslate"><span class="pre">generator</span></code> which calculates fibonacci numbers:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># generator version</span>
<span class="k">def</span> <span class="nf">fibon</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
     <span class="k">yield</span> <span class="n">a</span>
         <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>Now we can use it like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fibon</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>This way we would not have to worry about it using a lot of resources.
However, if we would have implemented it like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibon</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
     <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
         <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>It would have used up all our resources while calculating a large input.
We have discussed that we can iterate over <code class="docutils literal notranslate"><span class="pre">generators</span></code> only once but
we haven’t tested it. Before testing it you need to know about one more
built-in function of Python, <code class="docutils literal notranslate"><span class="pre">next()</span></code>. It allows us to access the next
element of a sequence. So let’s test out our understanding:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generator_function</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
     <span class="k">yield</span> <span class="n">i</span>

<span class="n">gen</span> <span class="o">=</span> <span class="n">generator_function</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">))</span>
<span class="c1"># Output: 0</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">))</span>
<span class="c1"># Output: 1</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">))</span>
<span class="c1"># Output: 2</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">))</span>
<span class="c1"># Output: Traceback (most recent call last):</span>
<span class="c1">#            File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="c1">#         StopIteration</span>
</pre></div>
</div>
<p>As we can see that after yielding all the values <code class="docutils literal notranslate"><span class="pre">next()</span></code> caused a
<code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> error. Basically this error informs us that all the
values have been yielded. You might be wondering that why don’t we get
this error while using a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop? Well the answer is simple. The
<code class="docutils literal notranslate"><span class="pre">for</span></code> loop automatically catches this error and stops calling
<code class="docutils literal notranslate"><span class="pre">next</span></code>. Do you know that a few built-in data types in Python also
support iteration? Let’s check it out:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_string</span> <span class="o">=</span> <span class="s2">&quot;Yasoob&quot;</span>
<span class="nb">next</span><span class="p">(</span><span class="n">my_string</span><span class="p">)</span>
<span class="c1"># Output: Traceback (most recent call last):</span>
<span class="c1">#      File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="c1">#    TypeError: str object is not an iterator</span>
</pre></div>
</div>
<p>Well that’s not what we expected. The error says that <code class="docutils literal notranslate"><span class="pre">str</span></code> is not an
iterator. Well it’s right! It’s an iterable but not an iterator. This
means that it supports iteration but we can’t iterate over
it directly. So how would we iterate over it? It’s time to learn about one more
built-in function, <code class="docutils literal notranslate"><span class="pre">iter</span></code>. It returns an <code class="docutils literal notranslate"><span class="pre">iterator</span></code> object from an
iterable. While an <code class="docutils literal notranslate"><span class="pre">int</span></code> isn’t an iterable, we can use it on string!</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int_var</span> <span class="o">=</span> <span class="mi">1779</span>
<span class="nb">iter</span><span class="p">(</span><span class="n">int_var</span><span class="p">)</span>
<span class="c1"># Output: Traceback (most recent call last):</span>
<span class="c1">#   File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="c1"># TypeError: &#39;int&#39; object is not iterable</span>
<span class="c1"># This is because int is not iterable</span>

<span class="n">my_string</span> <span class="o">=</span> <span class="s2">&quot;Yasoob&quot;</span>
<span class="n">my_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">my_string</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">my_iter</span><span class="p">))</span>
<span class="c1"># Output: &#39;Y&#39;</span>
</pre></div>
</div>
<p>Now that is much better. I am sure that you loved learning about
generators. Do bear it in mind that you can fully grasp this concept
only when you use it. Make sure that you follow this pattern and use
<code class="docutils literal notranslate"><span class="pre">generators</span></code> whenever they make sense to you. You won’t be
disappointed!</p>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>4. Map, Filter and Reduce</h1>
<p>These are three functions which facilitate a functional approach to
programming. We will discuss them one by one and understand their use
cases.</p>
<div class="section" id="map">
<h2>4.1. Map</h2>
<p><code class="docutils literal notranslate"><span class="pre">Map</span></code> applies a function to all the items in an input_list. Here is
the blueprint:</p>
<p><strong>Blueprint</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="p">(</span><span class="n">function_to_apply</span><span class="p">,</span> <span class="n">list_of_inputs</span><span class="p">)</span>
</pre></div>
</div>
<p>Most of the times we want to pass all the list elements to a function
one-by-one and then collect the output. For instance:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">squared</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
    <span class="n">squared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Map</span></code> allows us to implement this in a much simpler and nicer way.
Here you go:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">squared</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>
</pre></div>
</div>
<p>Most of the times we use lambdas with <code class="docutils literal notranslate"><span class="pre">map</span></code> so I did the same. Instead
of a list of inputs we can even have a list of functions!</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">x</span><span class="p">)</span>

<span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiply</span><span class="p">,</span> <span class="n">add</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">funcs</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="c1"># [0, 0]</span>
<span class="c1"># [1, 2]</span>
<span class="c1"># [4, 4]</span>
<span class="c1"># [9, 6]</span>
<span class="c1"># [16, 8]</span>
</pre></div>
</div>
</div>
<div class="section" id="filter">
<h2>4.2. Filter</h2>
<p>As the name suggests, <code class="docutils literal notranslate"><span class="pre">filter</span></code> creates a list of elements for which a
function returns true. Here is a short and concise example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">less_than_zero</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">number_list</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">less_than_zero</span><span class="p">)</span>

<span class="c1"># Output: [-5, -4, -3, -2, -1]</span>
</pre></div>
</div>
<p>The filter resembles a for loop but it is a builtin function and faster.</p>
<p><strong>Note:</strong> If map &amp; filter do not appear beautiful to you then you can
read about <code class="docutils literal notranslate"><span class="pre">list/dict/tuple</span></code> comprehensions.</p>
</div>
<div class="section" id="reduce">
<h2>4.3. Reduce</h2>
<p><code class="docutils literal notranslate"><span class="pre">Reduce</span></code> is a really useful function for performing some computation on
a list and returning the result. It applies a rolling computation to sequential
pairs of values in a list. For example, if you wanted to compute the product
of a list of integers.</p>
<p>So the normal way you might go about doing this task in python is using
a basic for loop:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">product</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">product</span> <span class="o">*</span> <span class="n">num</span>

<span class="c1"># product = 24</span>
</pre></div>
</div>
<p>Now let’s try it with reduce:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">((</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="c1"># Output: 24</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>5. <code class="docutils literal notranslate"><span class="pre">set</span></code> Data Structure</h1>
<p><code class="docutils literal notranslate"><span class="pre">set</span></code> is a really useful data structure. <code class="docutils literal notranslate"><span class="pre">sets</span></code> behave mostly like
lists with the distinction that they can not contain duplicate values.
It is really useful in a lot of cases. For instance you might want to
check whether there are duplicates in a list or not. You have two
options. The first one involves using a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop. Something like
this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]</span>

<span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">some_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">some_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
     <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
             <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span>
<span class="c1"># Output: [&#39;b&#39;, &#39;n&#39;]</span>
</pre></div>
</div>
<p>But there is a simpler and more elegant solution involving <code class="docutils literal notranslate"><span class="pre">sets</span></code>. You
can simply do something like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]</span>
<span class="n">duplicates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">some_list</span> <span class="k">if</span> <span class="n">some_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span>
<span class="c1"># Output: set([&#39;b&#39;, &#39;n&#39;])</span>
</pre></div>
</div>
<p>Sets also have a few other methods. Below are some of them.</p>
<p><strong>Intersection</strong></p>
<p>You can intersect two sets. For instance:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">valid</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">])</span>
<span class="n">input_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">valid</span><span class="p">))</span>
<span class="c1"># Output: set([&#39;red&#39;])</span>
</pre></div>
</div>
<p><strong>Difference</strong></p>
<p>You can find the invalid values in the above example using the
difference method. For example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">valid</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">])</span>
<span class="n">input_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_set</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">valid</span><span class="p">))</span>
<span class="c1"># Output: set([&#39;brown&#39;])</span>
</pre></div>
</div>
<p>You can also create sets using the new notation:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a_set</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">a_set</span><span class="p">))</span>
<span class="c1"># Output: &lt;type &#39;set&#39;&gt;</span>
</pre></div>
</div>
<p>There are a few other methods as well. I would recommend visiting the
official documentation and giving it a quick read.</p>
</div>
</div>
</div>

<h1></h1>
<h1>6. Ternary Operators</h1>
<p>Ternary operators are more commonly known as conditional expressions in
Python. These operators evaluate something based on a condition being
true or not. They became a part of Python in version 2.4</p>
<p>Here is a blueprint and an example of using these conditional
expressions.</p>
<p><strong>Blueprint:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">condition_is_true</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="n">condition_is_false</span>
</pre></div>
</div>
<p><strong>Example:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">is_fat</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;fat&quot;</span> <span class="k">if</span> <span class="n">is_fat</span> <span class="k">else</span> <span class="s2">&quot;not fat&quot;</span>
</pre></div>
</div>
<p>It allows to quickly test a condition instead of a multiline if
statement. Often times it can be immensely helpful and can make your
code compact but still maintainable.</p>
<p>Another more obscure and not widely used example involves tuples. Here
is some sample code:</p>
<p><strong>Blueprint:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">if_test_is_false</span><span class="p">,</span> <span class="n">if_test_is_true</span><span class="p">)[</span><span class="n">test</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Example:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fat</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">fitness</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;skinny&quot;</span><span class="p">,</span> <span class="s2">&quot;fat&quot;</span><span class="p">)[</span><span class="n">fat</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ali is &quot;</span><span class="p">,</span> <span class="n">fitness</span><span class="p">)</span>
<span class="c1"># Output: Ali is fat</span>
</pre></div>
</div>
<p>This works simply because True == 1 and False == 0, and so can be done
with lists in addition to tuples.</p>
<p>The above example is not widely used and is generally disliked by
Pythonistas for not being Pythonic. It is also easy to confuse where to
put the true value and where to put the false value in the tuple.</p>
<p>Another reason to avoid using a tupled ternery is that it results in
both elements of the tuple being evaluated, whereas the if-else
ternary operator does not.</p>
<p><strong>Example:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">2</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#Output is 2</span>

<span class="nb">print</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="n">condition</span><span class="p">])</span>
<span class="c1">#ZeroDivisionError is raised</span>
</pre></div>
</div>
<p>This happens because with the tupled ternary technique, the tuple is
first built, then an index is found.  For the if-else ternary operator,
it follows the normal if-else logic tree.  Thus, if one case could
raise an exception based on the condition, or if either case is a
computation-heavy method, using tuples is best avoided.</p>
</div>
</div>
</div>

<h1></h1>
<h1>7. Decorators</h1>
<p>Decorators are a significant part of Python. In simple words: they are
functions which modify the functionality of another function. They help
to make our code shorter and more Pythonic. Most of the beginners do not
know where to use them so I am going to share some areas where
decorators can make your code more concise.</p>
<p>First, let’s discuss how to write your own decorator.</p>
<p>It is perhaps one of the most difficult concepts to grasp. We will take
it one step at a time so that you can fully understand it.</p>
<div class="section" id="everything-in-python-is-an-object">
<h2>7.1. Everything in Python is an object:</h2>
<p>First of all let’s understand functions in Python:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hi</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;yasoob&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;hi &quot;</span> <span class="o">+</span> <span class="n">name</span>

<span class="nb">print</span><span class="p">(</span><span class="n">hi</span><span class="p">())</span>
<span class="c1"># output: &#39;hi yasoob&#39;</span>

<span class="c1"># We can even assign a function to a variable like</span>
<span class="n">greet</span> <span class="o">=</span> <span class="n">hi</span>
<span class="c1"># We are not using parentheses here because we are not calling the function hi</span>
<span class="c1"># instead we are just putting it into the greet variable. Let&#39;s try to run this</span>

<span class="nb">print</span><span class="p">(</span><span class="n">greet</span><span class="p">())</span>
<span class="c1"># output: &#39;hi yasoob&#39;</span>

<span class="c1"># Let&#39;s see what happens if we delete the old hi function!</span>
<span class="k">del</span> <span class="n">hi</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hi</span><span class="p">())</span>
<span class="c1">#outputs: NameError</span>

<span class="nb">print</span><span class="p">(</span><span class="n">greet</span><span class="p">())</span>
<span class="c1">#outputs: &#39;hi yasoob&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-functions-within-functions">
<h2>7.2. Defining functions within functions:</h2>
<p>So those are the basics when it comes to functions. Let’s take your
knowledge one step further. In Python we can define functions inside
other functions:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hi</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;yasoob&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now you are inside the hi() function&quot;</span><span class="p">)</span>
      <span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
       <span class="k">return</span> <span class="s2">&quot;now you are in the greet() function&quot;</span>
           <span class="k">def</span> <span class="nf">welcome</span><span class="p">():</span>
           <span class="k">return</span> <span class="s2">&quot;now you are in the welcome() function&quot;</span>
           <span class="nb">print</span><span class="p">(</span><span class="n">greet</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">welcome</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now you are back in the hi() function&quot;</span><span class="p">)</span>

<span class="n">hi</span><span class="p">()</span>
<span class="c1">#output:now you are inside the hi() function</span>
<span class="c1">#       now you are in the greet() function</span>
<span class="c1">#       now you are in the welcome() function</span>
<span class="c1">#       now you are back in the hi() function</span>

<span class="c1"># This shows that whenever you call hi(), greet() and welcome()</span>
<span class="c1"># are also called. However the greet() and welcome() functions</span>
<span class="c1"># are not available outside the hi() function e.g:</span>

<span class="n">greet</span><span class="p">()</span>
<span class="c1">#outputs: NameError: name &#39;greet&#39; is not defined</span>
</pre></div>
</div>
<p>So now we know that we can define functions in other functions. In
other words: we can make nested functions. Now you need to learn one
more thing, that functions can return functions too.</p>
</div>
<div class="section" id="returning-functions-from-within-functions">
<h2>7.3. Returning functions from within functions:</h2>
<p>It is not necessary to execute a function within another function, we
can return it as an output as well:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hi</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;yasoob&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
     <span class="k">return</span> <span class="s2">&quot;now you are in the greet() function&quot;</span>
           <span class="k">def</span> <span class="nf">welcome</span><span class="p">():</span>
           <span class="k">return</span> <span class="s2">&quot;now you are in the welcome() function&quot;</span>
           <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;yasoob&quot;</span><span class="p">:</span>
           <span class="k">return</span> <span class="n">greet</span>
    <span class="k">else</span><span class="p">:</span>
     <span class="k">return</span> <span class="n">welcome</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">hi</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1">#outputs: &lt;function greet at 0x7f2143c01500&gt;</span>

<span class="c1">#This clearly shows that `a` now points to the greet() function in hi()</span>
<span class="c1">#Now try this</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">())</span>
<span class="c1">#outputs: now you are in the greet() function</span>
</pre></div>
</div>
<p>Just take a look at the code again. In the <code class="docutils literal notranslate"><span class="pre">if/else</span></code> clause we are
returning <code class="docutils literal notranslate"><span class="pre">greet</span></code> and <code class="docutils literal notranslate"><span class="pre">welcome</span></code>, not <code class="docutils literal notranslate"><span class="pre">greet()</span></code> and <code class="docutils literal notranslate"><span class="pre">welcome()</span></code>.
Why is that? It’s because when you put a pair of parentheses after it, the
function gets executed; whereas if you don’t put parenthesis after it,
then it can be passed around and can be assigned to other variables
without executing it. Did you get it? Let me explain it in a little bit
more detail. When we write <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">hi()</span></code>, <code class="docutils literal notranslate"><span class="pre">hi()</span></code> gets executed and
because the name is yasoob by default, the function <code class="docutils literal notranslate"><span class="pre">greet</span></code> is returned.
If we change the statement to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">hi(name</span> <span class="pre">=</span> <span class="pre">&quot;ali&quot;)</span></code> then the <code class="docutils literal notranslate"><span class="pre">welcome</span></code>
function will be returned. We can also do print <code class="docutils literal notranslate"><span class="pre">hi()()</span></code> which outputs
<em>now you are in the greet() function</em>.</p>
</div>
<div class="section" id="giving-a-function-as-an-argument-to-another-function">
<h2>7.4. Giving a function as an argument to another function:</h2>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hi</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;hi yasoob!&quot;</span>

<span class="k">def</span> <span class="nf">doSomethingBeforeHi</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am doing some boring work before executing hi()&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">())</span>

<span class="n">doSomethingBeforeHi</span><span class="p">(</span><span class="n">hi</span><span class="p">)</span>
<span class="c1">#outputs:I am doing some boring work before executing hi()</span>
<span class="c1">#        hi yasoob!</span>
</pre></div>
</div>
<p>Now you have all the required knowledge to learn what decorators really
are. Decorators let you execute code before and after a function.</p>
</div>
<div class="section" id="writing-your-first-decorator">
<h2>7.5. Writing your first decorator:</h2>
<p>In the last example we actually made a decorator! Let’s modify the
previous decorator and make a little bit more usable program:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">a_new_decorator</span><span class="p">(</span><span class="n">a_func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapTheFunction</span><span class="p">():</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am doing some boring work before executing a_func()&quot;</span><span class="p">)</span>
               <span class="n">a_func</span><span class="p">()</span>
                     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am doing some boring work after executing a_func()&quot;</span><span class="p">)</span>
                 <span class="k">return</span> <span class="n">wrapTheFunction</span>

<span class="k">def</span> <span class="nf">a_function_requiring_decoration</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am the function which needs some decoration to remove my foul smell&quot;</span><span class="p">)</span>

<span class="n">a_function_requiring_decoration</span><span class="p">()</span>
<span class="c1">#outputs: &quot;I am the function which needs some decoration to remove my foul smell&quot;</span>

<span class="n">a_function_requiring_decoration</span> <span class="o">=</span> <span class="n">a_new_decorator</span><span class="p">(</span><span class="n">a_function_requiring_decoration</span><span class="p">)</span>
<span class="c1">#now a_function_requiring_decoration is wrapped by wrapTheFunction()</span>

<span class="n">a_function_requiring_decoration</span><span class="p">()</span>
<span class="c1">#outputs:I am doing some boring work before executing a_func()</span>
<span class="c1">#        I am the function which needs some decoration to remove my foul smell</span>
<span class="c1">#        I am doing some boring work after executing a_func()</span>
</pre></div>
</div>
<p>Did you get it? We just applied the previously learned principles. This
is exactly what the decorators do in Python! They wrap a function and
modify its behaviour in one way or the another. Now you might be
wondering that we did not use the &#64; anywhere in our code? That is just a
short way of making up a decorated function. Here is how we could have
run the previous code sample using &#64;.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@a_new_decorator</span>
<span class="k">def</span> <span class="nf">a_function_requiring_decoration</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Hey you! Decorate me!&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am the function which needs some decoration to &quot;</span>
       <span class="s2">&quot;remove my foul smell&quot;</span><span class="p">)</span>

<span class="n">a_function_requiring_decoration</span><span class="p">()</span>
<span class="c1">#outputs: I am doing some boring work before executing a_func()</span>
<span class="c1">#         I am the function which needs some decoration to remove my foul smell</span>
<span class="c1">#         I am doing some boring work after executing a_func()</span>

<span class="c1">#the @a_new_decorator is just a short way of saying:</span>
<span class="n">a_function_requiring_decoration</span> <span class="o">=</span> <span class="n">a_new_decorator</span><span class="p">(</span><span class="n">a_function_requiring_decoration</span><span class="p">)</span>
</pre></div>
</div>
<p>I hope you now have a basic understanding of how decorators work in
Python. Now there is one problem with our code. If we run:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">a_function_requiring_decoration</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="c1"># Output: wrapTheFunction</span>
</pre></div>
</div>
<p>That’s not what we expected! Its name is
“a_function_requiring_decoration”. Well our function was replaced by
wrapTheFunction. It overrode the name and docstring of our function.
Luckily Python provides us a simple function to solve this problem and
that is <code class="docutils literal notranslate"><span class="pre">functools.wraps</span></code>. Let’s modify our previous example to use
<code class="docutils literal notranslate"><span class="pre">functools.wraps</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">a_new_decorator</span><span class="p">(</span><span class="n">a_func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">a_func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapTheFunction</span><span class="p">():</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am doing some boring work before executing a_func()&quot;</span><span class="p">)</span>
         <span class="n">a_func</span><span class="p">()</span>
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am doing some boring work after executing a_func()&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapTheFunction</span>

<span class="nd">@a_new_decorator</span>
<span class="k">def</span> <span class="nf">a_function_requiring_decoration</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Hey yo! Decorate me!&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am the function which needs some decoration to &quot;</span>
       <span class="s2">&quot;remove my foul smell&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a_function_requiring_decoration</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="c1"># Output: a_function_requiring_decoration</span>
</pre></div>
</div>
<p>Now that is much better. Let’s move on and learn some use-cases of
decorators.</p>
<p><strong>Blueprint:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="k">def</span> <span class="nf">decorator_name</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">can_run</span><span class="p">:</span>
             <span class="k">return</span> <span class="s2">&quot;Function will not run&quot;</span>
             <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span>

<span class="nd">@decorator_name</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">return</span><span class="p">(</span><span class="s2">&quot;Function is running&quot;</span><span class="p">)</span>

<span class="n">can_run</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">())</span>
<span class="c1"># Output: Function is running</span>

<span class="n">can_run</span> <span class="o">=</span> <span class="kc">False</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">())</span>
<span class="c1"># Output: Function will not run</span>
</pre></div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">&#64;wraps</span></code> takes a function to be decorated and adds the
functionality of copying over the function name, docstring, arguments
list, etc. This allows to access the pre-decorated function’s properties
in the decorator.</p>
<div class="section" id="use-cases">
<h3>7.5.1. Use-cases:</h3>
<p>Now let’s take a look at the areas where decorators really shine and
their usage makes something really easy to manage.</p>
</div>
<div class="section" id="authorization">
<h3>7.5.2. Authorization</h3>
<p>Decorators can help to check whether someone is authorized to use an
endpoint in a web application. They are extensively used in Flask web
framework and Django. Here is an example to employ decorator based
authentication:</p>
<p><strong>Example :</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">requires_auth</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
     <span class="n">auth</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">authorization</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="n">auth</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">check_auth</span><span class="p">(</span><span class="n">auth</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">auth</span><span class="o">.</span><span class="n">password</span><span class="p">):</span>
             <span class="n">authenticate</span><span class="p">()</span>
             <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span>
</pre></div>
</div>
</div>
<div class="section" id="logging">
<h3>7.5.3. Logging</h3>
<p>Logging is another area where the decorators shine. Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">logit</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">with_logging</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; was called&quot;</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">with_logging</span>

<span class="nd">@logit</span>
<span class="k">def</span> <span class="nf">addition_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Do some math.&quot;&quot;&quot;</span>
   <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>


<span class="n">result</span> <span class="o">=</span> <span class="n">addition_func</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># Output: addition_func was called</span>
</pre></div>
</div>
<p>I am sure you are already thinking about some clever uses of decorators.</p>
</div>
</div>
<div class="section" id="decorators-with-arguments">
<h2>7.6. Decorators with Arguments</h2>
<p>Come to think of it, isn’t <code class="docutils literal notranslate"><span class="pre">&#64;wraps</span></code> also a decorator?  But, it takes an
argument like any normal function can do.  So, why can’t we do that too?</p>
<p>This is because when you use the <code class="docutils literal notranslate"><span class="pre">&#64;my_decorator</span></code> syntax, you are
applying a wrapper function with a single function as a parameter
Remember, everything in Python is an object, and this includes
functions!  With that in mind, we can write a function that returns
a wrapper function.</p>
<div class="section" id="nesting-a-decorator-within-a-function">
<h3>7.6.1. Nesting a Decorator Within a Function</h3>
<p>Let’s go back to our logging example, and create a wrapper which lets
us specify a logfile to output to.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">logit</span><span class="p">(</span><span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;out.log&#39;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">logging_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
     <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
         <span class="k">def</span> <span class="nf">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
             <span class="n">log_string</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; was called&quot;</span>
                 <span class="nb">print</span><span class="p">(</span><span class="n">log_string</span><span class="p">)</span>
                 <span class="c1"># Open the logfile and append</span>
                 <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened_file</span><span class="p">:</span>
                     <span class="c1"># Now we log to the specified logfile</span>
                         <span class="n">opened_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log_string</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                 <span class="k">return</span> <span class="n">wrapped_function</span>
    <span class="k">return</span> <span class="n">logging_decorator</span>

<span class="nd">@logit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">myfunc1</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="n">myfunc1</span><span class="p">()</span>
<span class="c1"># Output: myfunc1 was called</span>
<span class="c1"># A file called out.log now exists, with the above string</span>

<span class="nd">@logit</span><span class="p">(</span><span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;func2.log&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myfunc2</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="n">myfunc2</span><span class="p">()</span>
<span class="c1"># Output: myfunc2 was called</span>
<span class="c1"># A file called func2.log now exists, with the above string</span>
</pre></div>
</div>
</div>
<div class="section" id="decorator-classes">
<h3>7.6.2. Decorator Classes</h3>
<p>Now we have our logit decorator in production, but when some parts
of our application are considered critical, failure might be
something that needs more immediate attention.  Let’s say sometimes
you want to just log to a file.  Other times you want an email sent,
so the problem is brought to your attention, and still keep a log
for your own records.  This is a case for using inheritence, but
so far we’ve only seen functions being used to build decorators.</p>
<p>Luckily, classes can also be used to build decorators.  So, let’s
rebuild logit as a class instead of a function.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">logit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;out.log&#39;</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
           <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
           <span class="n">log_string</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; was called&quot;</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">log_string</span><span class="p">)</span>
         <span class="c1"># Open the logfile and append</span>
         <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened_file</span><span class="p">:</span>
             <span class="c1"># Now we log to the specified logfile</span>
                 <span class="n">opened_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log_string</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
             <span class="c1"># Now, send a notification</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>
           <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
           <span class="c1"># logit only logs, no more</span>
         <span class="k">pass</span>
</pre></div>
</div>
<p>This implementation has an additional advantage of being much cleaner than
the nested function approach, and wrapping a function still will use
the same syntax as before:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@logit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">myfunc1</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Now, let’s subclass logit to add email functionality (though this topic
will not be covered here).</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">email_logit</span><span class="p">(</span><span class="n">logit</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A logit implementation for sending emails to admins</span>
<span class="sd">    when the function is called.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s1">&#39;admin@myproject.com&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
         <span class="nb">super</span><span class="p">(</span><span class="n">email_logit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
           <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
           <span class="c1"># Send an email to self.email</span>
         <span class="c1"># Will not be implemented here</span>
         <span class="k">pass</span>
</pre></div>
</div>
<p>From here, <code class="docutils literal notranslate"><span class="pre">&#64;email_logit</span></code> works just like <code class="docutils literal notranslate"><span class="pre">&#64;logit</span></code> but sends an email
to the admin in addition to logging.</p>
</div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>8. Global &amp; Return</h1>
<p>You might have encountered some functions written in python which have a
<code class="docutils literal notranslate"><span class="pre">return</span></code> keyword in the end of the function. Do you know what it does? It
is similar to return in other languages. Lets examine this little
function:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># Output: 8</span>
</pre></div>
</div>
<p>The function above takes two values as input and then output their
addition. We could have also done:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span><span class="n">value2</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span>

<span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># Output: 8</span>
</pre></div>
</div>
<p>So first lets talk about the first bit of code which involves the
<code class="docutils literal notranslate"><span class="pre">return</span></code> keyword. What that function is doing is that it is assigning
the value to the variable which is calling that function which in our
case is <code class="docutils literal notranslate"><span class="pre">result</span></code>. In most cases and you won’t need to use the
<code class="docutils literal notranslate"><span class="pre">global</span></code> keyword. However lets examine the other bit of code as well
which includes the <code class="docutils literal notranslate"><span class="pre">global</span></code> keyword. So what that function is doing is
that it is making a global variable <code class="docutils literal notranslate"><span class="pre">result</span></code>. What does global mean
here? Global variable means that we can access that variable outside the
scope of the function as well. Let me demonstrate it with an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># first without the global variable</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span>

<span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># Oh crap, we encountered an exception. Why is it so?</span>
<span class="c1"># the python interpreter is telling us that we do not</span>
<span class="c1"># have any variable with the name of result. It is so</span>
<span class="c1"># because the result variable is only accessible inside</span>
<span class="c1"># the function in which it is created if it is not global.</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span>
    <span class="n">result</span>
<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;result&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>

<span class="c1"># Now lets run the same code but after making the result</span>
<span class="c1"># variable global</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span>

<span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">result</span>
<span class="mi">6</span>
</pre></div>
</div>
<p>So hopefully there are no errors in the second run as expected. In
practical programming you should try to stay away from <code class="docutils literal notranslate"><span class="pre">global</span></code>
keyword as it only makes life difficult by introducing unwanted variables
to the global scope.</p>
<div class="section" id="multiple-return-values">
<h2>8.1. Multiple return values</h2>
<p>So what if you want to return two variables from a function instead of one? There are a couple of approaches which new programmers take. The most famous approach is to use <code class="docutils literal notranslate"><span class="pre">global</span></code> keyword. Let’s take a look at a useless example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">profile</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">name</span>
    <span class="k">global</span> <span class="n">age</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Danny&quot;</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">profile</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># Output: Danny</span>

<span class="nb">print</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
<span class="c1"># Output: 30</span>
</pre></div>
</div>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>Note:<a href="#id3"><span class="problematic" id="id4">**</span></a>Don’t try to use the above mentioned method. I repeat, don’t try to use the above mentioned method!</p>
<p>Some try to solve this problem by <em>returning</em> a <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, <code class="docutils literal notranslate"><span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">dict</span></code> with the required values after the function terminates. It is one way to do it and works like a charm:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">profile</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Danny&quot;</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>

<span class="n">profile_data</span> <span class="o">=</span> <span class="n">profile</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">profile_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Output: Danny</span>

<span class="nb">print</span><span class="p">(</span><span class="n">profile_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Output: 30</span>
</pre></div>
</div>
<p>Or by more common convention:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">profile</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Danny&quot;</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span>

<span class="n">profile_name</span><span class="p">,</span> <span class="n">profile_age</span> <span class="o">=</span> <span class="n">profile</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">profile_name</span><span class="p">)</span>
<span class="c1"># Output: Danny</span>
<span class="nb">print</span><span class="p">(</span><span class="n">profile_age</span><span class="p">)</span>
<span class="c1"># Output: 30</span>
</pre></div>
</div>
<p>Keep in mind that even in the above example we are returning a tuple (despite the lack of paranthesis) and not separate multiple values. If you want to take it one step further, you can also make use of <a class="reference external" href="https://docs.python.org/3/library/collections.html#collections.namedtuple">namedtuple</a>. Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="k">def</span> <span class="nf">profile</span><span class="p">():</span>
    <span class="n">Person</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="s1">&#39;name age&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Danny&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>

<span class="c1"># Use as namedtuple</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">profile</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="c1"># Person(name=&#39;Danny&#39;, age=31) &lt;class &#39;__main__.Person&#39;&gt;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># Danny</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="c1">#31</span>

<span class="c1"># Use as plain tuple</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">profile</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Danny</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#31</span>

<span class="c1"># Unpack it immediatly</span>
<span class="n">name</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="n">profile</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># Danny</span>
<span class="nb">print</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
<span class="c1">#31</span>
</pre></div>
</div>
<p>This is a better way to do it along with returning <code class="docutils literal notranslate"><span class="pre">lists</span></code> and <code class="docutils literal notranslate"><span class="pre">dicts</span></code>. Don’t use <code class="docutils literal notranslate"><span class="pre">global</span></code> keyword unless you know what you are doing. <code class="docutils literal notranslate"><span class="pre">global</span></code> might be a better option in a few cases but is not in most of them.</p>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>9. Mutation</h1>
<p>The mutable and immutable datatypes in Python cause a lot of headache
for new programmers. In simple words, mutable means ‘able to be changed’
and immutable means ‘constant’. Want your head to spin? Consider this
example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hi&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="c1"># Output: [&#39;hi&#39;]</span>

<span class="n">bar</span> <span class="o">=</span> <span class="n">foo</span>
<span class="n">bar</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;bye&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="c1"># Output: [&#39;hi&#39;, &#39;bye&#39;]</span>
</pre></div>
</div>
<p>What just happened? We were not expecting that! We were expecting
something like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hi&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="c1"># Output: [&#39;hi&#39;]</span>

<span class="n">bar</span> <span class="o">=</span> <span class="n">foo</span>
<span class="n">bar</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;bye&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="c1"># Expected Output: [&#39;hi&#39;]</span>
<span class="c1"># Output: [&#39;hi&#39;, &#39;bye&#39;]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
<span class="c1"># Output: [&#39;hi&#39;, &#39;bye&#39;]</span>
</pre></div>
</div>
<p>It’s not a bug. It’s mutability in action. Whenever you assign a
variable to another variable of mutable datatype, any changes to the
data are reflected by both variables. The new variable is just an alias
for the old variable. This is only true for mutable datatypes. Here is a
gotcha involving functions and mutable data types:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_to</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">target</span>

<span class="n">add_to</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Output: [1]</span>

<span class="n">add_to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Output: [1, 2]</span>

<span class="n">add_to</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Output: [1, 2, 3]</span>
</pre></div>
</div>
<p>You might have expected it to behave differently. You might be expecting
that a fresh list would be created when you call <code class="docutils literal notranslate"><span class="pre">add_to</span></code> like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_to</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">target</span>

<span class="n">add_to</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Output: [1]</span>

<span class="n">add_to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Output: [2]</span>

<span class="n">add_to</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Output: [3]</span>
</pre></div>
</div>
<p>Well again it is the mutability of lists which causes this pain. In
Python the default arguments are evaluated once when the function is
defined, not each time the function is called. You should never define
default arguments of mutable type unless you know what you are doing.
You should do something like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_to</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
     <span class="n">target</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">target</span>
</pre></div>
</div>
<p>Now whenever you call the function without the <code class="docutils literal notranslate"><span class="pre">target</span></code> argument, a
new list is created. For instance:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add_to</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># Output: [42]</span>

<span class="n">add_to</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># Output: [42]</span>

<span class="n">add_to</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># Output: [42]</span>
</pre></div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>10. __slots__ Magic</h1>
<p>In Python every class can have instance attributes. By default Python
uses a dict to store an object’s instance attributes. This is really
helpful as it allows setting arbitrary new attributes at runtime.</p>
<p>However, for small classes with known attributes it might be a
bottleneck. The <code class="docutils literal notranslate"><span class="pre">dict</span></code> wastes a lot of RAM. Python can’t just allocate
a static amount of memory at object creation to store all the
attributes. Therefore it sucks a lot of RAM if you create a lot of
objects (I am talking in thousands and millions). Still there is a way
to circumvent this issue. It involves the usage of <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> to
tell Python not to use a dict, and only allocate space for a fixed set
of attributes. Here is an example with and without <code class="docutils literal notranslate"><span class="pre">__slots__</span></code>:</p>
<p><strong>Without</strong> <code class="docutils literal notranslate"><span class="pre">__slots__</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">set_up</span><span class="p">()</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p><strong>With</strong> <code class="docutils literal notranslate"><span class="pre">__slots__</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;identifier&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">set_up</span><span class="p">()</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>The second piece of code will reduce the burden on your RAM. Some people
have seen almost 40 to 50% reduction in RAM usage by using this
technique.</p>
<p>On a sidenote, you might want to give PyPy a try. It does all of these
optimizations by default.</p>
<p>Below you can see an example showing exact memory usage with and without <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> done in IPython thanks to <a class="reference external" href="https://github.com/ianozsvald/ipython_memory_usage">https://github.com/ianozsvald/ipython_memory_usage</a></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>Python 3.4.3 (default, Jun  6 2015, 13:32:34)
Type &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.

IPython 4.0.0 -- An enhanced Interactive Python.
?         -&gt; Introduction and overview of IPython&#39;s features.
%quickref -&gt; Quick reference.
help      -&gt; Python&#39;s own help system.
object?   -&gt; Details about &#39;object&#39;, use &#39;object??&#39; for extra details.

In [1]: import ipython_memory_usage.ipython_memory_usage as imu

In [2]: imu.start_watching_memory()
In [2] used 0.0000 MiB RAM in 5.31s, peaked 0.00 MiB above current, total RAM usage 15.57 MiB

In [3]: %cat slots.py
class MyClass(object):
 __slots__ = [&#39;name&#39;, &#39;identifier&#39;]
         def __init__(self, name, identifier):
                 self.name = name
                         self.identifier = identifier

num = 1024*256
x = [MyClass(1,1) for i in range(num)]
In [3] used 0.2305 MiB RAM in 0.12s, peaked 0.00 MiB above current, total RAM usage 15.80 MiB

In [4]: from slots import *
In [4] used 9.3008 MiB RAM in 0.72s, peaked 0.00 MiB above current, total RAM usage 25.10 MiB

In [5]: %cat noslots.py
class MyClass(object):
 def __init__(self, name, identifier):
                 self.name = name
                         self.identifier = identifier

num = 1024*256
x = [MyClass(1,1) for i in range(num)]
In [5] used 0.1758 MiB RAM in 0.12s, peaked 0.00 MiB above current, total RAM usage 25.28 MiB

In [6]: from noslots import *
In [6] used 22.6680 MiB RAM in 0.80s, peaked 0.00 MiB above current, total RAM usage 47.95 MiB
</pre></div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>11. Virtual Environment</h1>
<p>Have you ever heard of <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>? If you are a beginner,
then you might not have heard about it but if you are a
seasoned programmer then it may well be a vital part of your toolset.</p>
<p>So what is <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>? <code class="docutils literal notranslate"><span class="pre">Virtualenv</span></code> is a tool which allows us to
make isolated python environments. Imagine you have an application that
needs version 2 of a library, but another application requires
version 3. How can you use and develop both these applications?</p>
<p>If you install everything into <code class="docutils literal notranslate"><span class="pre">/usr/lib/python2.7/site-packages</span></code> (or
whatever your platform’s standard location is), it’s easy to end up in a
situation where you unintentionally upgrade a package.</p>
<p>In another case, imagine that you have an application which is fully
developed and you do not want to make any change to the libraries it is
using but at the same time you start developing another application
which requires the updated versions of those libraries.</p>
<p>What will you do? Use <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>! It creates isolated environments
for your python application and allows you to install Python libraries
in that isolated environment instead of installing them globally.</p>
<p>To install it, just type this command in the shell:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install virtualenv
</pre></div>
</div>
<p>The most important commands are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">virtualenv</span> <span class="pre">myproject</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">source</span> <span class="pre">myproject/bin/activate</span></code></li>
</ul>
<p>This first one makes an isolated virtualenv environment in the
<code class="docutils literal notranslate"><span class="pre">myproject</span></code> folder and the second command activates that isolated
environment.</p>
<p>While creating the virtualenv you have to make a decision. Do you
want this virtualenv to use packages from your system <code class="docutils literal notranslate"><span class="pre">site-packages</span></code>
or install them in the virtualenv’s site-packages? By default,
virtualenv will not give access to the global <code class="docutils literal notranslate"><span class="pre">site-packages</span></code>.</p>
<p>If you want your <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code> to have access to your systems
<code class="docutils literal notranslate"><span class="pre">site-packages</span></code>, use the <code class="docutils literal notranslate"><span class="pre">--system-site-packages</span></code> switch when creating
your virtualenv like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ virtualenv --system-site-packages mycoolproject
</pre></div>
</div>
<p>You can turn off the <code class="docutils literal notranslate"><span class="pre">env</span></code> by typing:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ deactivate
</pre></div>
</div>
<p>Running <cite>python</cite> after deactivating will use your system installation
of Python again.</p>
<p><strong>Bonus</strong></p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">smartcd</span></code> which is a library for bash and zsh and allows
you to alter your bash (or zsh) environment as you cd. It can be really
helpful to activate and deactivate a <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code> when you change
directories. I have used it quite a lot and love it. You can read more
about it on <a class="reference external" href="https://github.com/cxreg/smartcd">GitHub</a></p>
<p>This was just a short intro to virtualenv. There’s a lot more to it; <a class="reference external" href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">this
link</a> has more
information.</p>
</div>
</div>
</div>

<h1></h1>
<h1>12. Collections</h1>
<p>Python ships with a module that contains a number of container data
types called Collections. We will talk about a few of them and discuss
their usefulness.</p>
<p>The ones which we will talk about are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">defaultdict</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">counter</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">deque</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">namedtuple</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">enum.Enum</span></code> (outside of the module; Python 3.4+)</li>
</ul>
<div class="section" id="defaultdict">
<h2>12.1. <code class="docutils literal notranslate"><span class="pre">defaultdict</span></code></h2>
<p>I personally use defaultdict quite a bit. Unlike <code class="docutils literal notranslate"><span class="pre">dict</span></code>, with
<code class="docutils literal notranslate"><span class="pre">defaultdict</span></code> you do not need to check whether a key is present or
not. So we can do:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>

<span class="n">colours</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;Yasoob&#39;</span><span class="p">,</span> <span class="s1">&#39;Yellow&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Ali&#39;</span><span class="p">,</span> <span class="s1">&#39;Blue&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Arham&#39;</span><span class="p">,</span> <span class="s1">&#39;Green&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Ali&#39;</span><span class="p">,</span> <span class="s1">&#39;Black&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Yasoob&#39;</span><span class="p">,</span> <span class="s1">&#39;Red&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Ahmed&#39;</span><span class="p">,</span> <span class="s1">&#39;Silver&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">favourite_colours</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">colour</span> <span class="ow">in</span> <span class="n">colours</span><span class="p">:</span>
    <span class="n">favourite_colours</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colour</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">favourite_colours</span><span class="p">)</span>

<span class="c1"># output</span>
<span class="c1"># defaultdict(&lt;type &#39;list&#39;&gt;,</span>
<span class="c1">#    {&#39;Arham&#39;: [&#39;Green&#39;],</span>
<span class="c1">#     &#39;Yasoob&#39;: [&#39;Yellow&#39;, &#39;Red&#39;],</span>
<span class="c1">#     &#39;Ahmed&#39;: [&#39;Silver&#39;],</span>
<span class="c1">#     &#39;Ali&#39;: [&#39;Blue&#39;, &#39;Black&#39;]</span>
<span class="c1"># })</span>
</pre></div>
</div>
<p>One other very important use case is when you are appending to nested
lists inside a dictionary. If a <code class="docutils literal notranslate"><span class="pre">key</span></code> is not already present in the
dictionary then you are greeted with a <code class="docutils literal notranslate"><span class="pre">KeyError</span></code>. <code class="docutils literal notranslate"><span class="pre">defaultdict</span></code>
allows us to circumvent this issue in a clever way. First let me share
an example using <code class="docutils literal notranslate"><span class="pre">dict</span></code> which raises <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> and then I will
share a solution using <code class="docutils literal notranslate"><span class="pre">defaultdict</span></code>.</p>
<p><strong>Problem:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">some_dict</span><span class="p">[</span><span class="s1">&#39;colours&#39;</span><span class="p">][</span><span class="s1">&#39;favourite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>
<span class="c1"># Raises KeyError: &#39;colours&#39;</span>
</pre></div>
</div>
<p><strong>Solution:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">collections</span>
<span class="n">tree</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">some_dict</span> <span class="o">=</span> <span class="n">tree</span><span class="p">()</span>
<span class="n">some_dict</span><span class="p">[</span><span class="s1">&#39;colours&#39;</span><span class="p">][</span><span class="s1">&#39;favourite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>
<span class="c1"># Works fine</span>
</pre></div>
</div>
<p>You can print <code class="docutils literal notranslate"><span class="pre">some_dict</span></code> using <code class="docutils literal notranslate"><span class="pre">json.dumps</span></code>. Here is some
sample code:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">some_dict</span><span class="p">))</span>
<span class="c1"># Output: {&quot;colours&quot;: {&quot;favourite&quot;: &quot;yellow&quot;}}</span>
</pre></div>
</div>
</div>
<div class="section" id="ordereddict">
<h2>12.2. <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code></h2>
<p><code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code> keeps its entries sorted as they are initially inserted.
Overwriting a value of an existing key doesn’t change the position of
that key. However, deleting and reinserting an entry moves the key to
the end of the dictionary.</p>
<p><strong>Problem:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">colours</span> <span class="o">=</span>  <span class="p">{</span><span class="s2">&quot;Red&quot;</span> <span class="p">:</span> <span class="mi">198</span><span class="p">,</span> <span class="s2">&quot;Green&quot;</span> <span class="p">:</span> <span class="mi">170</span><span class="p">,</span> <span class="s2">&quot;Blue&quot;</span> <span class="p">:</span> <span class="mi">160</span><span class="p">}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">colours</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="c1"># Output:</span>
<span class="c1">#   Green 170</span>
<span class="c1">#   Blue 160</span>
<span class="c1">#   Red 198</span>
<span class="c1"># Entries are retrieved in an unpredictable order</span>
</pre></div>
</div>
<p><strong>Solution:</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>

<span class="n">colours</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span> <span class="mi">198</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Green&quot;</span><span class="p">,</span> <span class="mi">170</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Blue&quot;</span><span class="p">,</span> <span class="mi">160</span><span class="p">)])</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">colours</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="c1"># Output:</span>
<span class="c1">#   Red 198</span>
<span class="c1">#   Green 170</span>
<span class="c1">#   Blue 160</span>
<span class="c1"># Insertion order is preserved</span>
</pre></div>
</div>
</div>
<div class="section" id="counter">
<h2>12.3. <code class="docutils literal notranslate"><span class="pre">counter</span></code></h2>
<p>Counter allows us to count the occurrences of a particular item. For
instance it can be used to count the number of individual favourite
colours:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>

<span class="n">colours</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;Yasoob&#39;</span><span class="p">,</span> <span class="s1">&#39;Yellow&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Ali&#39;</span><span class="p">,</span> <span class="s1">&#39;Blue&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Arham&#39;</span><span class="p">,</span> <span class="s1">&#39;Green&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Ali&#39;</span><span class="p">,</span> <span class="s1">&#39;Black&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Yasoob&#39;</span><span class="p">,</span> <span class="s1">&#39;Red&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Ahmed&#39;</span><span class="p">,</span> <span class="s1">&#39;Silver&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">favs</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">colour</span> <span class="ow">in</span> <span class="n">colours</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">favs</span><span class="p">)</span>
<span class="c1"># Output: Counter({</span>
<span class="c1">#    &#39;Yasoob&#39;: 2,</span>
<span class="c1">#    &#39;Ali&#39;: 2,</span>
<span class="c1">#    &#39;Arham&#39;: 1,</span>
<span class="c1">#    &#39;Ahmed&#39;: 1</span>
<span class="c1"># })</span>
</pre></div>
</div>
<p>We can also count the most common lines in a file using it. For example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">line_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">line_count</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="deque">
<h2>12.4. <code class="docutils literal notranslate"><span class="pre">deque</span></code></h2>
<p><code class="docutils literal notranslate"><span class="pre">deque</span></code> provides you with a double ended queue which means that you
can append and delete elements from either side of the queue. First of
all you have to import the deque module from the collections library:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">deque</span>
</pre></div>
</div>
<p>Now we can instantiate a deque object.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</pre></div>
</div>
<p>It works like python lists and provides you with somewhat similar
methods as well. For example you can do:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="c1"># Output: 3</span>

<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Output: &#39;1&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Output: &#39;3&#39;</span>
</pre></div>
</div>
<p>You can pop values from both sides of the deque:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="c1"># Output: 5</span>

<span class="n">d</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
<span class="c1"># Output: 0</span>

<span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="c1"># Output: 4</span>

<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="c1"># Output: deque([1, 2, 3])</span>
</pre></div>
</div>
<p>We can also limit the amount of items a deque can hold. By doing this
when we achieve the maximum limit of our deque it will simply pop out
the items from the opposite end. It is better to explain it using an
example so here you go:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<p>Now whenever you insert values after 30, the leftmost value will be
popped from the list. You can also expand the list in any direction with
new values:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">deque</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">extendleft</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="c1"># Output: deque([0, 1, 2, 3, 4, 5, 6, 7, 8])</span>
</pre></div>
</div>
</div>
<div class="section" id="namedtuple">
<h2>12.5. <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code></h2>
<p>You might already be acquainted with tuples. A tuple is basically
a immutable list which&nbsp;allows you to store a sequence of values
separated by commas. They are just like lists but have a few key
differences. The major one is&nbsp;that unlike lists, <strong>you can not
reassign an item in a tuple</strong>. In order to access the value in a
tuple you use integer indexes like:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">man</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Ali&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">man</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Output: Ali</span>
</pre></div>
</div>
<p>Well, so now what are <code class="docutils literal notranslate"><span class="pre">namedtuples</span></code>? They turn tuples into convenient
containers for simple tasks. With namedtuples you don’t have to use
integer indexes for accessing members of a tuple. You can think of
namedtuples like dictionaries but unlike dictionaries they are
immutable.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>

<span class="n">Animal</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="s1">&#39;name age type&#39;</span><span class="p">)</span>
<span class="n">perry</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;perry&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">perry</span><span class="p">)</span>
<span class="c1"># Output: Animal(name=&#39;perry&#39;, age=31, type=&#39;cat&#39;)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">perry</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># Output: &#39;perry&#39;</span>
</pre></div>
</div>
<p>You can now see that we can access members of a tuple just by their
name using a <code class="docutils literal notranslate"><span class="pre">.</span></code>. Let’s dissect it a little more. A named tuple has two
required arguments. They are the tuple name and the tuple field_names.
In the above example our tuple name was ‘Animal’ and the tuple
field_names were ‘name’, ‘age’ and ‘type’. Namedtuple makes your tuples
<strong>self-document</strong>. You can easily understand what is going on by having
a quick glance at your code. And as you are not bound to use integer
indexes to access members of a tuple, it makes it more easy to maintain
your code. Moreover, as <strong>`namedtuple` instances do not have
per-instance dictionaries</strong>, they are lightweight and require no more
memory than regular tuples. This makes them faster than dictionaries.
However, do remember that as with tuples, <strong>attributes in namedtuples
are immutable</strong>. It means that this would not work:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>

<span class="n">Animal</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="s1">&#39;name age type&#39;</span><span class="p">)</span>
<span class="n">perry</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;perry&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="n">perry</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">42</span>

<span class="c1"># Output: Traceback (most recent call last):</span>
<span class="c1">#            File &quot;&quot;, line 1, in</span>
<span class="c1">#         AttributeError: can&#39;t set attribute</span>
</pre></div>
</div>
<p>You should use named tuples to make your code self-documenting. <strong>They
are backwards compatible with normal tuples</strong>. It means that you can use
integer indexes with namedtuples as well:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>

<span class="n">Animal</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="s1">&#39;name age type&#39;</span><span class="p">)</span>
<span class="n">perry</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;perry&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">perry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Output: perry</span>
</pre></div>
</div>
<p>Last but not the least, you can convert a namedtuple to a dictionary.
Like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>

<span class="n">Animal</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="s1">&#39;name age type&#39;</span><span class="p">)</span>
<span class="n">perry</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Perry&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">perry</span><span class="o">.</span><span class="n">_asdict</span><span class="p">())</span>
<span class="c1"># Output: OrderedDict([(&#39;name&#39;, &#39;Perry&#39;), (&#39;age&#39;, 31), ...</span>
</pre></div>
</div>
</div>
<div class="section" id="enum-enum-python-3-4">
<h2>12.6. <code class="docutils literal notranslate"><span class="pre">enum.Enum</span></code> (Python 3.4+)</h2>
<p>Another useful collection is the enum object. It is available in the <code class="docutils literal notranslate"><span class="pre">enum</span></code>
module, in Python 3.4 and up (also available as a backport in PyPI named <code class="docutils literal notranslate"><span class="pre">enum34</span></code>.)
Enums (<a class="reference external" href="https://en.wikipedia.org/wiki/Enumerated_type">enumerated type</a>) are
basically a way to organize various things.</p>
<p>Let’s consider the Animal namedtuple from the last example.  It had a <code class="docutils literal notranslate"><span class="pre">type</span></code>
field.  The problem is, the type was a string.  This poses some problems for
us. What if the user types in <code class="docutils literal notranslate"><span class="pre">Cat</span></code> because they held the Shift key?  Or
<code class="docutils literal notranslate"><span class="pre">CAT</span></code>?  Or <code class="docutils literal notranslate"><span class="pre">kitten</span></code>?</p>
<p>Enumerations can help us avoid this problem, by not using strings.  Consider
this example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">Species</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">cat</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">dog</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">horse</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">aardvark</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">butterfly</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">owl</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">platypus</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">dragon</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">unicorn</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="c1"># The list goes on and on...</span>
      <span class="c1"># But we don&#39;t really care about age, so we can use an alias.</span>
    <span class="n">kitten</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">puppy</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">Animal</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Animal&#39;</span><span class="p">,</span> <span class="s1">&#39;name age type&#39;</span><span class="p">)</span>
<span class="n">perry</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Perry&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Species</span><span class="o">.</span><span class="n">cat</span><span class="p">)</span>
<span class="n">drogon</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Drogon&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Species</span><span class="o">.</span><span class="n">dragon</span><span class="p">)</span>
<span class="n">tom</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Tom&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Species</span><span class="o">.</span><span class="n">cat</span><span class="p">)</span>
<span class="n">charlie</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Charlie&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Species</span><span class="o">.</span><span class="n">kitten</span><span class="p">)</span>

<span class="c1"># And now, some tests.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">charlie</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tom</span><span class="o">.</span><span class="n">type</span>
<span class="kc">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">charlie</span><span class="o">.</span><span class="n">type</span>
<span class="o">&lt;</span><span class="n">Species</span><span class="o">.</span><span class="n">cat</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This is much less error-prone.  We have to be specific, and we should use only
the enumeration to name types.</p>
<p>There are three ways to access enumeration members.  For example, all three
methods will get you the value for <code class="docutils literal notranslate"><span class="pre">cat</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Species</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Species</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span>
<span class="n">Species</span><span class="o">.</span><span class="n">cat</span>
</pre></div>
</div>
<p>This was just a quick drive through the <code class="docutils literal notranslate"><span class="pre">collections</span></code> module. Make
sure you read the official documentation after reading this.</p>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>13. Enumerate</h1>
<p>Enumerate is a built-in function of Python. It’s usefulness can not be
summarized in a single line. Yet most of the newcomers and even some
advanced programmers are unaware of it. It allows us to loop over
something and have an automatic counter. Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">counter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">some_list</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>And there is more! <code class="docutils literal notranslate"><span class="pre">enumerate</span></code> also accepts an optional argument which
makes it even more useful.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;grapes&#39;</span><span class="p">,</span> <span class="s1">&#39;pear&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">my_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="c1"># 1 apple</span>
<span class="c1"># 2 banana</span>
<span class="c1"># 3 grapes</span>
<span class="c1"># 4 pear</span>
</pre></div>
</div>
<p>The optional argument allows us to tell <code class="docutils literal notranslate"><span class="pre">enumerate</span></code> from where to
start the index. You can also create tuples containing the index and
list item using a list. Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;grapes&#39;</span><span class="p">,</span> <span class="s1">&#39;pear&#39;</span><span class="p">]</span>
<span class="n">counter_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">my_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">counter_list</span><span class="p">)</span>
<span class="c1"># Output: [(1, &#39;apple&#39;), (2, &#39;banana&#39;), (3, &#39;grapes&#39;), (4, &#39;pear&#39;)]</span>
</pre></div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>14. Object introspection</h1>
<p>In computer programming, introspection is the ability to determine the
type of an object at runtime. It is one of Python’s strengths.
Everything in Python is an object and we can examine those objects.
Python ships with a few built-in functions and modules to help us.</p>
<div class="section" id="dir">
<h2>14.1. <code class="docutils literal notranslate"><span class="pre">dir</span></code></h2>
<p>In this section we will learn about <code class="docutils literal notranslate"><span class="pre">dir</span></code> and how it facilitates us
in introspection.</p>
<p>It is one of the most important functions for introspection. It returns
a list of attributes and methods belonging to an object. Here is an
example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="nb">dir</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
<span class="c1"># Output: [&#39;__add__&#39;, &#39;__class__&#39;, &#39;__contains__&#39;, &#39;__delattr__&#39;, &#39;__delitem__&#39;,</span>
<span class="c1"># &#39;__delslice__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__getattribute__&#39;,</span>
<span class="c1"># &#39;__getitem__&#39;, &#39;__getslice__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__iadd__&#39;, &#39;__imul__&#39;,</span>
<span class="c1"># &#39;__init__&#39;, &#39;__iter__&#39;, &#39;__le__&#39;, &#39;__len__&#39;, &#39;__lt__&#39;, &#39;__mul__&#39;, &#39;__ne__&#39;,</span>
<span class="c1"># &#39;__new__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__reversed__&#39;, &#39;__rmul__&#39;,</span>
<span class="c1"># &#39;__setattr__&#39;, &#39;__setitem__&#39;, &#39;__setslice__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;,</span>
<span class="c1"># &#39;__subclasshook__&#39;, &#39;append&#39;, &#39;count&#39;, &#39;extend&#39;, &#39;index&#39;, &#39;insert&#39;, &#39;pop&#39;,</span>
<span class="c1"># &#39;remove&#39;, &#39;reverse&#39;, &#39;sort&#39;]</span>
</pre></div>
</div>
<p>Our introspection gave us the names of all the methods of a list. This
can be handy when you are not able to recall a method name. If we run
<code class="docutils literal notranslate"><span class="pre">dir()</span></code> without any argument then it returns all names in the current
scope.</p>
</div>
<div class="section" id="type-and-id">
<h2>14.2. <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">id</span></code></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> function returns the type of an object. For example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
<span class="c1"># Output: &lt;type &#39;str&#39;&gt;</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">([]))</span>
<span class="c1"># Output: &lt;type &#39;list&#39;&gt;</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">({}))</span>
<span class="c1"># Output: &lt;type &#39;dict&#39;&gt;</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="nb">dict</span><span class="p">))</span>
<span class="c1"># Output: &lt;type &#39;type&#39;&gt;</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="c1"># Output: &lt;type &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">id</span></code> returns the unique ids of various objects. For instance:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Yasoob&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<span class="c1"># Output: 139972439030304</span>
</pre></div>
</div>
</div>
<div class="section" id="inspect-module">
<h2>14.3. <code class="docutils literal notranslate"><span class="pre">inspect</span></code> module</h2>
<p>The inspect module also provides several useful functions to get
information about live objects. For example you can check the members of
an object by running:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
<span class="c1"># Output: [(&#39;__add__&#39;, &lt;slot wrapper &#39;__add__&#39; of ... ...</span>
</pre></div>
</div>
<p>There are a couple of other methods as well which help in introspection.
You can explore them if you wish.</p>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>15. Comprehensions</h1>
<p>Comprehensions are a feature of Python which I would really miss if I
ever have to leave it. Comprehensions are constructs that allow
sequences to be built from other sequences. Three types of
comprehensions are supported in both Python 2 and Python 3:</p>
<ul class="simple">
<li>list comprehensions</li>
<li>dictionary comprehensions</li>
<li>set comprehensions</li>
<li>generator comprehensions</li>
</ul>
<p>We will discuss them one by one. Once you get the hang of using <code class="docutils literal notranslate"><span class="pre">list</span></code>
comprehensions then you can use any of them easily.</p>
<div class="section" id="list-comprehensions">
<h2>15.1. <code class="docutils literal notranslate"><span class="pre">list</span></code> comprehensions</h2>
<p>List comprehensions provide a short and concise way to create lists. It
consists of square brackets containing an expression followed by a
<code class="docutils literal notranslate"><span class="pre">for</span></code> clause, then zero or more <code class="docutils literal notranslate"><span class="pre">for</span></code> or <code class="docutils literal notranslate"><span class="pre">if</span></code> clauses. The
expressions can be anything, meaning you can put in all kinds of objects
in lists. The result would be a new list made after the evaluation of
the expression in context of the <code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">for</span></code> clauses.</p>
<p><strong>Blueprint</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="o">=</span> <span class="p">[</span><span class="n">out_exp</span> <span class="k">for</span> <span class="n">out_exp</span> <span class="ow">in</span> <span class="n">input_list</span> <span class="k">if</span> <span class="n">out_exp</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>Here is a short example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">multiples</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">multiples</span><span class="p">)</span>
<span class="c1"># Output: [0, 3, 6, 9, 12, 15, 18, 21, 24, 27]</span>
</pre></div>
</div>
<p>This can be really useful to make lists quickly. It is even preferred by
some instead of the <code class="docutils literal notranslate"><span class="pre">filter</span></code> function. List comprehensions really
shine when you want to supply a list to a method or function to make a
new list by appending to it in each iteration of the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop. For
instance you would usually do something like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">squared</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">squared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>You can simplify it using list comprehensions. For example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">squared</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="dict-comprehensions">
<h2>15.2. <code class="docutils literal notranslate"><span class="pre">dict</span></code> comprehensions</h2>
<p>They are used in a similar way. Here is an example which I found
recently:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mcase</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="n">mcase_frequency</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">mcase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">mcase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mcase</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># mcase_frequency == {&#39;a&#39;: 17, &#39;z&#39;: 3, &#39;b&#39;: 34}</span>
</pre></div>
</div>
<p>In the above example we are combining the values of keys which are same
but in different typecase. I personally do not use <code class="docutils literal notranslate"><span class="pre">dict</span></code>
comprehensions a lot. You can also quickly switch keys and values of a dictionary:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">some_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</div>
<div class="section" id="set-comprehensions">
<h2>15.3. <code class="docutils literal notranslate"><span class="pre">set</span></code> comprehensions</h2>
<p>They are also similar to list comprehensions. The only difference is
that they use braces <code class="docutils literal notranslate"><span class="pre">{}</span></code>. Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">squared</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">squared</span><span class="p">)</span>
<span class="c1"># Output: {1, 4}</span>
</pre></div>
</div>
</div>
<div class="section" id="generator-comprehensions">
<h2>15.4. <code class="docutils literal notranslate"><span class="pre">generator</span></code> comprehensions</h2>
<p>They are also similar to list comprehensions. The only difference is that they don’t allocate memory for the whole list but generate one item at a time, thus more memory effecient.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">multiples_gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">multiples_gen</span><span class="p">)</span>
<span class="c1"># Output: &lt;generator object &lt;genexpr&gt; at 0x7fdaa8e407d8&gt;</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">multiples_gen</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="c1"># Outputs numbers</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>16. Exceptions</h1>
<p>Exception handling is an art which once you master grants you immense
powers. I am going to show you some of the ways in which we can handle
exceptions.</p>
<p>In basic terminology we are aware of <code class="docutils literal notranslate"><span class="pre">try/except</span></code> clause. The code
which can cause an exception to occur is put in the <code class="docutils literal notranslate"><span class="pre">try</span></code> block and
the handling of the exception is implemented in the <code class="docutils literal notranslate"><span class="pre">except</span></code> block.
Here is a simple example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An IOError occurred. </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>In the above example we are handling only the IOError exception. What
most beginners do not know is that we can handle multiple exceptions.</p>
<div class="section" id="handling-multiple-exceptions">
<h2>16.1. Handling multiple exceptions:</h2>
<p>We can use three methods to handle multiple exceptions. The first one
involves putting all the exceptions which are likely to occur in a
tuple. Like so:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An error occurred. </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>Another method is to handle individual exceptions in separate <code class="docutils literal notranslate"><span class="pre">except</span></code>
blocks. We can have as many <code class="docutils literal notranslate"><span class="pre">except</span></code> blocks as we want. Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">EOFError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An EOF error occurred.&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">e</span>
<span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An error occurred.&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
<p>This way if the exception is not handled by the first <code class="docutils literal notranslate"><span class="pre">except</span></code> block then
it may be handled by a following block, or none at all. Now the last method involves
trapping ALL exceptions:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="c1"># Some logging if you want</span>
    <span class="k">raise</span>
</pre></div>
</div>
<p>This can be helpful when you have no idea about the exceptions which may
be thrown by your program.</p>
<div class="section" id="finally-clause">
<h3>16.1.1. <code class="docutils literal notranslate"><span class="pre">finally</span></code> clause</h3>
<p>We wrap our main code in the <code class="docutils literal notranslate"><span class="pre">try</span></code> clause. After that we wrap some code in
an <code class="docutils literal notranslate"><span class="pre">except</span></code> clause which gets executed if an exception occurs in the code
wrapped in the <code class="docutils literal notranslate"><span class="pre">try</span></code> clause. In this example we will use a third clause as
well which is the <code class="docutils literal notranslate"><span class="pre">finally</span></code> clause. The code which is wrapped in the
<code class="docutils literal notranslate"><span class="pre">finally</span></code> clause will run whether or not an exception occurred. It might be used
to perform clean-up after a script. Here is a simple example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An IOError occurred. </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This would be printed whether or not an exception occurred!&quot;</span><span class="p">)</span>

<span class="c1"># Output: An IOError occurred. No such file or directory</span>
<span class="c1"># This would be printed whether or not an exception occurred!</span>
</pre></div>
</div>
</div>
<div class="section" id="try-else-clause">
<h3>16.1.2. <code class="docutils literal notranslate"><span class="pre">try/else</span></code> clause</h3>
<p>Often times we might want some code to run if <strong>no</strong> exception occurs. This
can easily be achieved by using an <code class="docutils literal notranslate"><span class="pre">else</span></code> clause. One might ask: why, if
you only want some code to run if no exception occurs, wouldn’t you simply
put that code inside the <code class="docutils literal notranslate"><span class="pre">try</span></code>? The answer is that then any exceptions in
that code will be caught by the <code class="docutils literal notranslate"><span class="pre">try</span></code>, and you might not want that. Most
people don’t use it and honestly I have myself not used it widely. Here is an
example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I am sure no exception is going to occur!&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># any code that should only run if no exception occurs in the try,</span>
    <span class="c1"># but for which exceptions should NOT be caught</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This would only run if no exception occurs. And an error here &#39;</span>
       <span class="s1">&#39;would NOT be caught.&#39;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This would be printed in every case.&#39;</span><span class="p">)</span>

<span class="c1"># Output: I am sure no exception is going to occur!</span>
<span class="c1"># This would only run if no exception occurs. And an error here would NOT be caught</span>
<span class="c1"># This would be printed in every case.</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">else</span></code> clause would only run if no exception occurs and it would run
before the <code class="docutils literal notranslate"><span class="pre">finally</span></code> clause.</p>
</div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>17. Classes</h1>
<p>Classes are the core of Python. They give us a lot of power but it is
really easy to misuse this power. In this section I will share some
obscure tricks and caveats related to <code class="docutils literal notranslate"><span class="pre">classes</span></code> in Python. Let’s get
going!</p>
<div class="section" id="instance-class-variables">
<h2>17.1. 1. Instance &amp; Class variables</h2>
<p>Most beginners and even some advanced Python programmers do not
understand the distinction between instance and class variables. Their
lack of understanding forces them to use these different types of
variables incorrectly. Let’s understand them.</p>
<p>The basic difference is:</p>
<ul class="simple">
<li>Instance variables are for data which is unique to every object</li>
<li>Class variables are for data shared between different instances of a
class</li>
</ul>
<p>Let’s take a look at an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Cal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># pi is a class variable</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.142</span>
      <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
       <span class="c1"># self.radius is an instance variable</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
           <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
           <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Cal</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
<span class="c1"># Output: 3217.408</span>
<span class="n">a</span><span class="o">.</span><span class="n">pi</span>
<span class="c1"># Output: 3.142</span>
<span class="n">a</span><span class="o">.</span><span class="n">pi</span> <span class="o">=</span> <span class="mi">43</span>
<span class="n">a</span><span class="o">.</span><span class="n">pi</span>
<span class="c1"># Output: 43</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">Cal</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
<span class="c1"># Output: 6082.912</span>
<span class="n">b</span><span class="o">.</span><span class="n">pi</span>
<span class="c1"># Output: 3.142</span>
<span class="n">b</span><span class="o">.</span><span class="n">pi</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">b</span><span class="o">.</span><span class="n">pi</span>
<span class="c1"># Output: 50</span>
</pre></div>
</div>
<p>There are not many issues while using mutable class variables. This is
the major reason due to which beginners do not try to learn more about
this subject because everything works! If you also believe that instance
and class variables can not cause any problem if used incorrectly then
check the next example.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuperClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">superpowers</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
           <span class="k">def</span> <span class="nf">add_superpower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">superpowers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">SuperClass</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">bar</span> <span class="o">=</span> <span class="n">SuperClass</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">foo</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># Output: &#39;foo&#39;</span>

<span class="n">bar</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># Output: &#39;bar&#39;</span>

<span class="n">foo</span><span class="o">.</span><span class="n">add_superpower</span><span class="p">(</span><span class="s1">&#39;fly&#39;</span><span class="p">)</span>
<span class="n">bar</span><span class="o">.</span><span class="n">superpowers</span>
<span class="c1"># Output: [&#39;fly&#39;]</span>

<span class="n">foo</span><span class="o">.</span><span class="n">superpowers</span>
<span class="c1"># Output: [&#39;fly&#39;]</span>
</pre></div>
</div>
<p>That is the beauty of the wrong usage of mutable class variables. To
make your code safe against this kind of surprise attacks then make sure
that you do not use mutable class variables. You may use them only if
you know what you are doing.</p>
</div>
<div class="section" id="new-style-classes">
<h2>17.2. 2. New style classes</h2>
<p>New style classes were introduced in Python 2.1 but a lot of people do
not know about them even now! It is so because Python also supports old
style classes just to maintain backward compatibility. I have said a lot
about new and old but I have not told you about the difference. Well the
major difference is that:</p>
<ul class="simple">
<li>Old base classes do not inherit from anything</li>
<li>New style base classes inherit from <code class="docutils literal notranslate"><span class="pre">object</span></code></li>
</ul>
<p>A very basic example is:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OldClass</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I am an old class&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">NewClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I am a jazzy new class&#39;</span><span class="p">)</span>

<span class="n">old</span> <span class="o">=</span> <span class="n">OldClass</span><span class="p">()</span>
<span class="c1"># Output: I am an old class</span>

<span class="n">new</span> <span class="o">=</span> <span class="n">NewClass</span><span class="p">()</span>
<span class="c1"># Output: I am a jazzy new class</span>
</pre></div>
</div>
<p>This inheritance from <code class="docutils literal notranslate"><span class="pre">object</span></code> allows new style classes to utilize
some <em>magic</em>. A major advantage is that you can employ some useful
optimizations like <code class="docutils literal notranslate"><span class="pre">__slots__</span></code>. You can use <code class="docutils literal notranslate"><span class="pre">super()</span></code> and
descriptors and the likes. Bottom line? Always try to use new-style
classes.</p>
<p><strong>Note:</strong> Python 3 only has new-style classes. It does not matter
whether you subclass from <code class="docutils literal notranslate"><span class="pre">object</span></code> or not. However it is recommended
that you still subclass from <code class="docutils literal notranslate"><span class="pre">object</span></code>.</p>
</div>
<div class="section" id="magic-methods">
<h2>17.3. 3. Magic Methods</h2>
<p>Python’s classes are famous for their magic methods, commonly called
<strong>dunder</strong> (double underscore) methods. I am going to discuss a few of
them.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">__init__</span></code></li>
</ul>
<p>It is a class initializer. Whenever an instance of a class is created
its <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method is called. For example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GetTest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Greetings!!&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">another_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I am another method which is not&#39;</span>
               <span class="s1">&#39; automatically called&#39;</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">GetTest</span><span class="p">()</span>
<span class="c1"># Output: Greetings!!</span>

<span class="n">a</span><span class="o">.</span><span class="n">another_method</span><span class="p">()</span>
<span class="c1"># Output: I am another method which is not automatically</span>
<span class="c1"># called</span>
</pre></div>
</div>
<p>You can see that <code class="docutils literal notranslate"><span class="pre">__init__</span></code> is called immediately after an instance is
created. You can also pass arguments to the class during it’s
initialization. Like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GetTest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Greetings!! </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">another_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I am another method which is not&#39;</span>
               <span class="s1">&#39; automatically called&#39;</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">GetTest</span><span class="p">(</span><span class="s1">&#39;yasoob&#39;</span><span class="p">)</span>
<span class="c1"># Output: Greetings!! yasoob</span>

<span class="c1"># Try creating an instance without the name arguments</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">GetTest</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="fm">__init__</span><span class="p">()</span> <span class="n">takes</span> <span class="n">exactly</span> <span class="mi">2</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">1</span> <span class="n">given</span><span class="p">)</span>
</pre></div>
</div>
<p>I am sure that now you understand the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">__getitem__</span></code></li>
</ul>
<p>Implementing <strong>getitem</strong> in a class allows its instances to use the []
(indexer) operator. Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GetTest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
             <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Yasoob&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;country&#39;</span><span class="p">:</span><span class="s1">&#39;Pakistan&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;number&#39;</span><span class="p">:</span><span class="mi">12345812</span>
             <span class="p">}</span>
           <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
           <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">OldClass</span><span class="p">()</span>
<span class="n">foo</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
<span class="c1"># Output: &#39;Yasoob&#39;</span>

<span class="n">foo</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
<span class="c1"># Output: 36845124</span>
</pre></div>
</div>
<p>Without the <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method we would have got this error:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>

<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">&#39;GetTest&#39; object has no attribute &#39;__getitem__&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>18. Lambdas</h1>
<p>Lambdas are one line functions. They are also known as anonymous
functions in some other languages. You might want to use lambdas when
you don’t want to use a function twice in a program. They are just like
normal functions and even behave like them.</p>
<p><strong>Blueprint</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">argument</span><span class="p">:</span> <span class="n">manipulate</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Example</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nb">print</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1"># Output: 8</span>
</pre></div>
</div>
<p>Here are a few useful use cases for lambdas and just a few ways in which
they are used in the wild:</p>
<p><strong>List sorting</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">a</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># Output: [(13, -3), (4, 1), (1, 2), (9, 10)]</span>
</pre></div>
</div>
<p><strong>Parallel sorting of lists</strong></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">list1</span><span class="p">,</span> <span class="n">list2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>19. One-Liners</h1>
<p>In this chapter I will show you some one-liner Python commands which can
be really helpful.</p>
<p><strong>Simple Web Server</strong></p>
<p>Ever wanted to quickly share a file over a network? Well you are in
luck. Python has a feature just for you. Go to the directory
which you want to serve over the network and write the following code in
your terminal:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python 2</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">SimpleHTTPServer</span>

<span class="c1"># Python 3</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span>
</pre></div>
</div>
<p><strong>Pretty Printing</strong></p>
<p>You can print a list and dictionary in a beautiful format in the Python
repl. Here is the relevant code:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>

<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Yasoob&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="s1">&#39;undefined&#39;</span><span class="p">,</span> <span class="s1">&#39;personality&#39;</span><span class="p">:</span> <span class="s1">&#39;awesome&#39;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">my_dict</span><span class="p">))</span>
<span class="c1"># [&#39;__add__&#39;, &#39;__class__&#39;, &#39;__contains__&#39;, &#39;__delattr__&#39;, &#39;__delitem__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__getattribute__&#39;, &#39;__getitem__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__iadd__&#39;, &#39;__imul__&#39;, &#39;__init__&#39;, &#39;__init_subclass__&#39;, &#39;__iter__&#39;, &#39;__le__&#39;, &#39;__len__&#39;, &#39;__lt__&#39;, &#39;__mul__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__reversed__&#39;, &#39;__rmul__&#39;, &#39;__setattr__&#39;, &#39;__setitem__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;, &#39;append&#39;, &#39;clear&#39;, &#39;copy&#39;, &#39;count&#39;, &#39;extend&#39;, &#39;index&#39;, &#39;insert&#39;, &#39;pop&#39;, &#39;remove&#39;, &#39;reverse&#39;, &#39;sort&#39;]</span>

<span class="n">pprint</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">my_dict</span><span class="p">))</span>
<span class="c1"># [&#39;__add__&#39;,</span>
<span class="c1">#  &#39;__class__&#39;,</span>
<span class="c1">#  &#39;__contains__&#39;,</span>
<span class="c1">#  &#39;__delattr__&#39;,</span>
<span class="c1">#  &#39;__delitem__&#39;,</span>
<span class="c1">#  &#39;__dir__&#39;,</span>
<span class="c1">#  &#39;__doc__&#39;,</span>
<span class="c1">#  &#39;__eq__&#39;,</span>
<span class="c1">#  &#39;__format__&#39;,</span>
<span class="c1">#  &#39;__ge__&#39;,</span>
<span class="c1">#  &#39;__getattribute__&#39;,</span>
<span class="c1">#  &#39;__getitem__&#39;,</span>
<span class="c1">#  &#39;__gt__&#39;,</span>
<span class="c1">#  &#39;__hash__&#39;,</span>
<span class="c1">#  &#39;__iadd__&#39;,</span>
<span class="c1">#  &#39;__imul__&#39;,</span>
<span class="c1">#  &#39;__init__&#39;,</span>
<span class="c1">#  &#39;__init_subclass__&#39;,</span>
<span class="c1">#  &#39;__iter__&#39;,</span>
<span class="c1">#  &#39;__le__&#39;,</span>
<span class="c1">#  &#39;__len__&#39;,</span>
<span class="c1">#  &#39;__lt__&#39;,</span>
<span class="c1">#  &#39;__mul__&#39;,</span>
<span class="c1">#  &#39;__ne__&#39;,</span>
<span class="c1">#  &#39;__new__&#39;,</span>
<span class="c1">#  &#39;__reduce__&#39;,</span>
<span class="c1">#  &#39;__reduce_ex__&#39;,</span>
<span class="c1">#  &#39;__repr__&#39;,</span>
<span class="c1">#  &#39;__reversed__&#39;,</span>
<span class="c1">#  &#39;__rmul__&#39;,</span>
<span class="c1">#  &#39;__setattr__&#39;,</span>
<span class="c1">#  &#39;__setitem__&#39;,</span>
<span class="c1">#  &#39;__sizeof__&#39;,</span>
<span class="c1">#  &#39;__str__&#39;,</span>
<span class="c1">#  &#39;__subclasshook__&#39;,</span>
<span class="c1">#  &#39;append&#39;,</span>
<span class="c1">#  &#39;clear&#39;,</span>
<span class="c1">#  &#39;copy&#39;,</span>
<span class="c1">#  &#39;count&#39;,</span>
<span class="c1">#  &#39;extend&#39;,</span>
<span class="c1">#  &#39;index&#39;,</span>
<span class="c1">#  &#39;insert&#39;,</span>
<span class="c1">#  &#39;pop&#39;,</span>
<span class="c1">#  &#39;remove&#39;,</span>
<span class="c1">#  &#39;reverse&#39;,</span>
<span class="c1">#  &#39;sort&#39;]</span>
</pre></div>
</div>
<p>This is more effective on nested <code class="docutils literal notranslate"><span class="pre">dict</span></code> s. Moreover, if you want to pretty print
json quickly from a file then you can simply do:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">file</span><span class="o">.</span><span class="n">json</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">json</span><span class="o">.</span><span class="n">tool</span>
</pre></div>
</div>
<p><strong>Profiling a script</strong></p>
<p>This can be extremely helpful in pinpointing the bottlenecks in your
scripts:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">cProfile</span> <span class="n">my_script</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">cProfile</span></code> is a faster implementation of <code class="docutils literal notranslate"><span class="pre">profile</span></code> as it is
written in c</p>
<p><strong>CSV to json</strong></p>
<p>Run this in the terminal:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import csv,json;print json.dumps(list(csv.reader(open(&#39;csv_file.csv&#39;))))&quot;</span>
</pre></div>
</div>
<p>Make sure that you replace <code class="docutils literal notranslate"><span class="pre">csv_file.csv</span></code> to the relevant file name.</p>
<p><strong>List Flattening</strong></p>
<p>You can quickly and easily flatten a list using
<code class="docutils literal notranslate"><span class="pre">itertools.chain.from_iterable</span></code> from the <code class="docutils literal notranslate"><span class="pre">itertools</span></code> package. Here
is a simple example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">a_list</span><span class="p">)))</span>
<span class="c1"># Output: [1, 2, 3, 4, 5, 6]</span>

<span class="c1"># or</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">a_list</span><span class="p">)))</span>
<span class="c1"># Output: [1, 2, 3, 4, 5, 6]</span>
</pre></div>
</div>
<p><strong>One-Line Constructors</strong></p>
<p>Avoid a lot of boilerplate assignments when initializing a class</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;self&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Additional one-liners can be found on the <a class="reference external" href="https://wiki.python.org/moin/Powerful%20Python%20One-Liners">Python
website</a>.</p>
</div>
</div>
</div>

<h1></h1>
<h1>20. <code class="docutils literal notranslate"><span class="pre">for/else</span></code></h1>
<p>Loops are an integral part of any language. Likewise <code class="docutils literal notranslate"><span class="pre">for</span></code> loops are
an important part of Python. However there are a few things which most
beginners do not know about them. We will discuss a few of them one-by-one.</p>
<p>Let’s first start off with what we know. We know that we can use <code class="docutils literal notranslate"><span class="pre">for</span></code> loops
like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;mango&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">fruit</span> <span class="ow">in</span> <span class="n">fruits</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fruit</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>

<span class="c1"># Output: Apple</span>
<span class="c1">#         Banana</span>
<span class="c1">#         Mango</span>
</pre></div>
</div>
<p>That is the very basic structure of a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop. Now let’s move on to
some of the lesser known features of <code class="docutils literal notranslate"><span class="pre">for</span></code> loops in Python.</p>
<div class="section" id="else-clause">
<h2>20.1. <code class="docutils literal notranslate"><span class="pre">else</span></code> Clause</h2>
<p><code class="docutils literal notranslate"><span class="pre">for</span></code> loops also have an <code class="docutils literal notranslate"><span class="pre">else</span></code> clause which most of us are unfamiliar
with. The <code class="docutils literal notranslate"><span class="pre">else</span></code> clause executes after the loop completes normally.
This means that the loop did not encounter a <code class="docutils literal notranslate"><span class="pre">break</span></code> statement. They are
really useful once you understand where to use them. I, myself, came to
know about them a lot later.</p>
<p>The common construct is to run a loop and search for an item. If the
item is found, we break out of the loop using the <code class="docutils literal notranslate"><span class="pre">break</span></code> statement. There are two
scenarios in which the loop may end. The first one is when the item is
found and <code class="docutils literal notranslate"><span class="pre">break</span></code> is encountered. The second scenario is that the loop
ends without encountering a <code class="docutils literal notranslate"><span class="pre">break</span></code> statement. Now we may want to know which one of these is the reason for a
loop’s completion. One method is to set a flag and then check it once the
loop ends. Another is to use the <code class="docutils literal notranslate"><span class="pre">else</span></code> clause.</p>
<p>This is the basic structure of a <code class="docutils literal notranslate"><span class="pre">for/else</span></code> loop:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">container</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">search_something</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
     <span class="c1"># Found it!</span>
         <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
         <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Didn&#39;t find anything..</span>
    <span class="n">not_found_in_container</span><span class="p">()</span>
</pre></div>
</div>
<p>Consider this simple example which I took from the official
documentation:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
     <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
             <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;equals&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">/</span><span class="n">x</span><span class="p">)</span>
                 <span class="k">break</span>
</pre></div>
</div>
<p>It finds factors for numbers between 2 to 10. Now for the fun part. We
can add an additional <code class="docutils literal notranslate"><span class="pre">else</span></code> block which catches the numbers which have no factors and are therefore prime numbers:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
     <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
             <span class="nb">print</span><span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;equals&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">/</span><span class="n">x</span><span class="p">)</span>
                 <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
     <span class="c1"># loop fell through without finding a factor</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;is a prime number&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>21. Python C extensions</h1>
<p>An interesting feature offered to developers by the CPython
implementation is the ease of interfacing C code to Python.</p>
<p>There are three key methods developers use to call C functions from
their python code - <code class="docutils literal notranslate"><span class="pre">ctypes</span></code>, <code class="docutils literal notranslate"><span class="pre">SWIG</span></code> and <code class="docutils literal notranslate"><span class="pre">Python/C</span> <span class="pre">API</span></code>. Each
method comes with it’s own merits and demerits.</p>
<p>Firstly, why would you want to interface C with Python?</p>
<p>A few common reasons are :</p>
<ul class="simple">
<li>You want speed and you know C is about 50x faster than Python.</li>
<li>Certain legacy C libraries work just as well as you want them to, so you don’t want to rewrite them in python.</li>
<li>Certain low level resource access - from memory to file interfaces.</li>
<li>Just because you want to.</li>
</ul>
<div class="section" id="ctypes">
<h2>21.1. CTypes</h2>
<p>The Python <a class="reference external" href="https://docs.python.org/2/library/ctypes.html">ctypes
module</a> is probably
the easiest way to call C functions from Python. The ctypes module
provides C compatible data types and functions to load DLLs so that
calls can be made to C shared libraries without having to modify them.
The fact that the C side needn’t be touched adds to the simplicity of
this method.</p>
<p><strong>Example</strong></p>
<p>Simple C code to add two numbers, save it as <code class="docutils literal notranslate"><span class="pre">add.c</span></code></p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">sample</span> <span class="n">C</span> <span class="n">file</span> <span class="n">to</span> <span class="n">add</span> <span class="mi">2</span> <span class="n">numbers</span> <span class="o">-</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">floats</span>

<span class="c1">#include &lt;stdio.h&gt;</span>

<span class="nb">int</span> <span class="n">add_int</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">);</span>
<span class="nb">float</span> <span class="n">add_float</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">);</span>

<span class="nb">int</span> <span class="n">add_int</span><span class="p">(</span><span class="nb">int</span> <span class="n">num1</span><span class="p">,</span> <span class="nb">int</span> <span class="n">num2</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">float</span> <span class="n">add_float</span><span class="p">(</span><span class="nb">float</span> <span class="n">num1</span><span class="p">,</span> <span class="nb">float</span> <span class="n">num2</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next compile the C file to a <code class="docutils literal notranslate"><span class="pre">.so</span></code> file (DLL in windows) This will
generate an adder.so file.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>#For Linux
$  gcc -shared -Wl,-soname,adder -o adder.so -fPIC add.c

#For Mac
$ gcc -shared -Wl,-install_name,adder.so -o adder.so -fPIC add.c
</pre></div>
</div>
<p>Now in your python code -</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ctypes</span> <span class="k">import</span> <span class="o">*</span>

<span class="c1">#load the shared object file</span>
<span class="n">adder</span> <span class="o">=</span> <span class="n">CDLL</span><span class="p">(</span><span class="s1">&#39;./adder.so&#39;</span><span class="p">)</span>

<span class="c1">#Find sum of integers</span>
<span class="n">res_int</span> <span class="o">=</span> <span class="n">adder</span><span class="o">.</span><span class="n">add_int</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Sum of 4 and 5 = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res_int</span><span class="p">)</span>

<span class="c1">#Find sum of floats</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">c_float</span><span class="p">(</span><span class="mf">5.5</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">c_float</span><span class="p">(</span><span class="mf">4.1</span><span class="p">)</span>

<span class="n">add_float</span> <span class="o">=</span> <span class="n">adder</span><span class="o">.</span><span class="n">add_float</span>
<span class="n">add_float</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_float</span>
<span class="nb">print</span> <span class="s2">&quot;Sum of 5.5 and 4.1 = &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">add_float</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
<p>And the output is as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sum</span> <span class="n">of</span> <span class="mi">4</span> <span class="ow">and</span> <span class="mi">5</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">Sum</span> <span class="n">of</span> <span class="mf">5.5</span> <span class="ow">and</span> <span class="mf">4.1</span> <span class="o">=</span>  <span class="mf">9.60000038147</span>
</pre></div>
</div>
<p>In this example the C file is self explanatory - it contains two
functions, one to add two integers and another to add two floats.</p>
<p>In the python file, first the ctypes module is imported. Then the CDLL
function of the ctypes module is used to load the shared lib file we
created. The functions defined in the C lib are now available to us via
the <code class="docutils literal notranslate"><span class="pre">adder</span></code> variable. When <code class="docutils literal notranslate"><span class="pre">adder.add_int()</span></code> is called, internally a
call is made to the <code class="docutils literal notranslate"><span class="pre">add_int</span></code> C function. The ctypes interface allows
us to use native python integers and strings by default while calling
the C functions.</p>
<p>For other types such as boolean or float, we have to use the correct
ctypes. This is seen while passing parameters to the
<code class="docutils literal notranslate"><span class="pre">adder.add_float()</span></code>. We first create the required c_float types from
python decimal values, and then use them as arguments to the C code.
This method is simple and clean, but limited. For example it’s not
possible to manipulate objects on the C side.</p>
</div>
<div class="section" id="swig">
<h2>21.2. SWIG</h2>
<p>Simplified Wrapper and Interface Generator, or SWIG for short is another
way to interface C code to Python. In this method, the developer must
develop an extra interface file which is an input to SWIG (the command
line utility).</p>
<p>Python developers generally don’t use this method, because it is in most
cases unnecessarily complex. This is a great method when you have a
C/C++ code base, and you want to interface it to many different
languages.</p>
<p><strong>Example</strong> (from the <a class="reference external" href="http://www.swig.org/tutorial.html">SWIG website</a> )</p>
<p>The C code, <code class="docutils literal notranslate"><span class="pre">example.c</span></code> that has a variety of functions and variables</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;time.h&gt;</span>
<span class="n">double</span> <span class="n">My_variable</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span>

<span class="nb">int</span> <span class="n">fact</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">return</span> <span class="n">n</span><span class="o">*</span><span class="n">fact</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">my_mod</span><span class="p">(</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">char</span> <span class="o">*</span><span class="n">get_time</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">time_t</span> <span class="n">ltime</span><span class="p">;</span>
    <span class="n">time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ltime</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ltime</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The interface file - this will remain the same irrespective of the
language you want to port your C code to :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">example</span><span class="o">.</span><span class="n">i</span> <span class="o">*/</span>
 <span class="o">%</span><span class="n">module</span> <span class="n">example</span>
 <span class="o">%</span><span class="p">{</span>
 <span class="o">/*</span> <span class="n">Put</span> <span class="n">header</span> <span class="n">files</span> <span class="n">here</span> <span class="ow">or</span> <span class="n">function</span> <span class="n">declarations</span> <span class="n">like</span> <span class="n">below</span> <span class="o">*/</span>
 <span class="n">extern</span> <span class="n">double</span> <span class="n">My_variable</span><span class="p">;</span>
 <span class="n">extern</span> <span class="nb">int</span> <span class="n">fact</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">);</span>
 <span class="n">extern</span> <span class="nb">int</span> <span class="n">my_mod</span><span class="p">(</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">);</span>
 <span class="n">extern</span> <span class="n">char</span> <span class="o">*</span><span class="n">get_time</span><span class="p">();</span>
 <span class="o">%</span><span class="p">}</span>

 <span class="n">extern</span> <span class="n">double</span> <span class="n">My_variable</span><span class="p">;</span>
 <span class="n">extern</span> <span class="nb">int</span> <span class="n">fact</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">);</span>
 <span class="n">extern</span> <span class="nb">int</span> <span class="n">my_mod</span><span class="p">(</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">);</span>
 <span class="n">extern</span> <span class="n">char</span> <span class="o">*</span><span class="n">get_time</span><span class="p">();</span>
</pre></div>
</div>
<p>And now to compile it</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unix</span> <span class="o">%</span> <span class="n">swig</span> <span class="o">-</span><span class="n">python</span> <span class="n">example</span><span class="o">.</span><span class="n">i</span>
<span class="n">unix</span> <span class="o">%</span> <span class="n">gcc</span> <span class="o">-</span><span class="n">c</span> <span class="n">example</span><span class="o">.</span><span class="n">c</span> <span class="n">example_wrap</span><span class="o">.</span><span class="n">c</span> \
 <span class="o">-</span><span class="n">I</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">1</span>
<span class="n">unix</span> <span class="o">%</span> <span class="n">ld</span> <span class="o">-</span><span class="n">shared</span> <span class="n">example</span><span class="o">.</span><span class="n">o</span> <span class="n">example_wrap</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span><span class="n">o</span> <span class="n">_example</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p>Finally, the Python output</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">example</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">fact</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">120</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">my_mod</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">example</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
<span class="go">&#39;Sun Feb 11 23:01:07 1996&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>As we can see, SWIG achieves the same result, but requires a slightly
more involved effort. But it’s worth it if you are targeting multiple
languages.</p>
</div>
<div class="section" id="python-c-api">
<h2>21.3. Python/C API</h2>
<p>The <a class="reference external" href="https://docs.python.org/2/c-api/">C/Python API</a> is probably the
most widely used method - not for it’s simplicity but for the fact that
you can manipulate python objects in your C code.</p>
<p>This method requires your C code to be specifically written for
interfacing with Python code. All Python objects are represented as a
PyObject struct and the <code class="docutils literal notranslate"><span class="pre">Python.h</span></code> header file provides various
functions to manipulate it. For example if the PyObject is also a
PyListType (basically a list), then we can use the <code class="docutils literal notranslate"><span class="pre">PyList_Size()</span></code>
function on the struct to get the length of the list. This is equivalent
to calling <code class="docutils literal notranslate"><span class="pre">len(list)</span></code> in python. Most of the basic
functions/opertions that are there for native Python objects are made
available in C via the <code class="docutils literal notranslate"><span class="pre">Python.h</span></code> header.</p>
<p><strong>Example</strong></p>
<p>To write a C extension that adds all the elements in a python list. (all elements are numbers)</p>
<p>Let’s start with the final interface we’d like to have, here is the
python file that uses the C extension :</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Though it looks like an ordinary python import, the addList module is implemented in C</span>
<span class="kn">import</span> <span class="nn">addList</span>

<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="nb">print</span> <span class="s2">&quot;Sum of List - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">addList</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
</pre></div>
</div>
<p>The above looks like any ordinary python file, which imports and uses
another python module called <code class="docutils literal notranslate"><span class="pre">addList</span></code>. The only difference is that
the addList module is not written in Python at all, but rather in C.</p>
<p>Next we’ll have a look at the C code that get’s built into the
<code class="docutils literal notranslate"><span class="pre">addList</span></code> Python module. This may seem a bit daunting at first, but
once you understand the various components that go into writing the C
file, it’s pretty straight forward.</p>
<p><em>adder.c</em></p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span>//Python.h has all the required function definitions to manipulate the Python objects
#include &lt;Python.h&gt;

 //This is the function that is called from your python code
static PyObject* addList_add(PyObject* self, PyObject* args){
PyObject * listObj;
//The input arguments come as a tuple, we parse the args to get the various variables
  //In this case it&#39;s only one list variable, which will now be referenced by listObj
  if (! PyArg_ParseTuple( args, &quot;O&quot;, &amp;listObj))
    return NULL;
    //length of the list
  long length = PyList_Size(listObj);
  //iterate over all the elements
  long i, sum =0;
  for(i = 0; i &lt; length; i++){
    //get an element out of the list - the element is also a python objects
    PyObject* temp = PyList_GetItem(listObj, i);
    //we know that object represents an integer - so convert it into C long
    long elem = PyInt_AsLong(temp);
    sum += elem;
  }
  //value returned back to python code - another python object
  //build value here converts the C long to a python integer
  return Py_BuildValue(&quot;i&quot;, sum);
}

//This is the docstring that corresponds to our &#39;add&#39; function.
static char addList_docs[] =
    &quot;add( ): add all elements of the list\n&quot;;

/* This table contains the relavent info mapping -
  &lt;function-name in python module&gt;, &lt;actual-function&gt;,
  &lt;type-of-args the function expects&gt;, &lt;docstring associated with the function&gt;
*/
static PyMethodDef addList_funcs[] = {
    {&quot;add&quot;, (PyCFunction)addList_add, METH_VARARGS, addList_docs},
    {NULL, NULL, 0, NULL}
};

/*
addList is the module name, and this is the initialization block of the module.
&lt;desired module name&gt;, &lt;the-info-table&gt;, &lt;module&#39;s-docstring&gt;
*/
PyMODINIT_FUNC initaddList(void){
    Py_InitModule3(&quot;addList&quot;, addList_funcs,
                &quot;Add all ze lists&quot;);
}
</pre></div>
</div>
<p>A step by step explanation :</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">&lt;Python.h&gt;</span></code> file consists of all the required types (to represent Python object types) and function definitions (to operate on the python objects).</li>
<li>Next we write the function which we plan to call from python. Conventionally the function names are {module-name}_{function-name}, which in this case is <code class="docutils literal notranslate"><span class="pre">addList_add</span></code>. More about the function later.</li>
<li>Then fill in the info table - which contains all the relevant info of the functions we desire to have in the module. Every row corresponds to a function, with the last one being a sentinel value (row of null elements).</li>
<li>Finally the module initialization block which is of the signature <code class="docutils literal notranslate"><span class="pre">PyMODINIT_FUNC</span> <span class="pre">init{module-name}</span></code>.</li>
</ul>
<p>The function <code class="docutils literal notranslate"><span class="pre">addList_add</span></code> accepts arguments as a PyObject type struct
(args is also a tuple type - but since everything in python is an
object, we use the generic PyObject notion). The incoming arguments is
parsed (basically split the tuple into individual elements) by
<code class="docutils literal notranslate"><span class="pre">PyArg_ParseTuple()</span></code>. The first parameter is the argument variable to
be parsed. The second argument is a string that tells us how to parse
each element in the args tuple. The character in the Nth position of the
string tells us the type of the Nth element in the args tuple, example -
‘i’ would mean integer, ‘s’ would mean string and ‘O’ would mean a
Python object. Next multiple arguments follow, these are where you would
like the <code class="docutils literal notranslate"><span class="pre">PyArg_ParseTuple()</span></code> function to store all the elements that
it has parsed. The number of such arguments is equal to the number of
arguments which the module function expects to receive, and positional
integrity is maintained. For example if we expected a string, integer
and a python list in that order, the function signature would be</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">n</span><span class="p">;</span>
<span class="n">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>
<span class="n">PyObject</span><span class="o">*</span> <span class="nb">list</span><span class="p">;</span>
<span class="n">PyArg_ParseTuple</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;siO&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="nb">list</span><span class="p">);</span>
</pre></div>
</div>
<p>In this case we only have to extract a list object, and store it in the
variable <code class="docutils literal notranslate"><span class="pre">listObj</span></code>. We then use the <code class="docutils literal notranslate"><span class="pre">PyList_Size()</span></code> function on our
list object and get the length. This is similar to how you would call
<code class="docutils literal notranslate"><span class="pre">len(list)</span></code> in python.</p>
<p>Now we loop through the list, get each element using the
<code class="docutils literal notranslate"><span class="pre">PyList_GetItem(list,</span> <span class="pre">index)</span></code> function. This returns a PyObject*. But
since we know that the Python objects are also <code class="docutils literal notranslate"><span class="pre">PyIntType</span></code>, we just
use the <code class="docutils literal notranslate"><span class="pre">PyInt_AsLong(PyObj</span> <span class="pre">*)</span></code> function to get the required value. We
do this for every element and finally get the sum.</p>
<p>The sum is converted to a python object and is returned to the Python
code with the help of <code class="docutils literal notranslate"><span class="pre">Py_BuildValue()</span></code>. Here the “i” indicates that
the value we want to build is a python integer object.</p>
<p>Now we build the C module. Save the following code as <code class="docutils literal notranslate"><span class="pre">setup.py</span></code></p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#build the modules</span>

<span class="kn">from</span> <span class="nn">distutils.core</span> <span class="k">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">Extension</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;addList&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span><span class="p">,</span>  \
      <span class="n">ext_modules</span><span class="o">=</span><span class="p">[</span><span class="n">Extension</span><span class="p">(</span><span class="s1">&#39;addList&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;adder.c&#39;</span><span class="p">])])</span>
</pre></div>
</div>
<p>and run</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<p>This should now build and install the C file into the python module we
desire.</p>
<p>After all this hard work, we’ll now test if the module works -</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#module that talks to the C code</span>
<span class="kn">import</span> <span class="nn">addList</span>

<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="nb">print</span> <span class="s2">&quot;Sum of List - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">addList</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
</pre></div>
</div>
<p>And here is the output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sum</span> <span class="n">of</span> <span class="n">List</span> <span class="o">-</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
</pre></div>
</div>
<p>So as you can see, we have developed our first successful C Python
extension using the Python.h API. This method does seem complex at
first, but once you get used to it it can prove to be quite useful.</p>
<p>Other ways to interface C code to Python is to use an alternative and
faster build of python - <a class="reference external" href="http://cython.org/">Cython</a>. But Cython is
a slightly different language than the main stream python we see. Hence
that method is not covered here.</p>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>22. <code class="docutils literal notranslate"><span class="pre">open</span></code> Function</h1>
<p><a class="reference external" href="http://docs.python.org/dev/library/functions.html#open">open</a> opens
a file. Pretty simple, eh? Most of the time, we see it being used like
this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span>
<span class="n">jpgdata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The reason I am writing this article is that most of the time, I see
open used like this. There are <strong>three</strong> errors in the above code. Can
you spot them all? If not, read on. By the end of this article, you’ll
know what’s wrong in the above code, and, more importantly, be able to
avoid these mistakes in your own code. Let’s start with the basics:</p>
<p>The return value from <code class="docutils literal notranslate"><span class="pre">open</span></code> is a file handle, given out from the operating system
to your Python application. You will want to return this file handle
once you’re finished with the file, if only so that your application
won’t reach the limit of the number of open file handles it can have at
once.</p>
<p>Explicitly calling <code class="docutils literal notranslate"><span class="pre">close</span></code> closes the file handle, but only if the
read was successful. If there is any error just after <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">open(...)</span></code>,
<code class="docutils literal notranslate"><span class="pre">f.close()</span></code> will not be called (depending on the Python interpreter,
the file handle may still be returned, but that’s another story). To
make sure that the file gets closed whether an exception occurs or not,
pack it into a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">jpgdata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>The first argument of <code class="docutils literal notranslate"><span class="pre">open</span></code> is the filename. The second one (the
<em>mode</em>) determines <em>how</em> the file gets opened.</p>
<ul class="simple">
<li>If you want to read the file, pass in <code class="docutils literal notranslate"><span class="pre">r</span></code></li>
<li>If you want to read and write the file, pass in <code class="docutils literal notranslate"><span class="pre">r+</span></code></li>
<li>If you want to overwrite the file, pass in <code class="docutils literal notranslate"><span class="pre">w</span></code></li>
<li>If you want to append to the file, pass in <code class="docutils literal notranslate"><span class="pre">a</span></code></li>
</ul>
<p>While there are a couple of other valid mode strings, chances are you
won’t ever use them. The mode matters not only because it changes the
behavior, but also because it may result in permission errors. For
example, if we were to open a jpg-file in a write-protected directory,
<code class="docutils literal notranslate"><span class="pre">open(..,</span> <span class="pre">'r+')</span></code> would fail. The mode can contain one further
character; we can open the file in binary (you’ll get a string of bytes)
or text mode (a string of characters).</p>
<p>In general, if the format is written by humans, it tends to be text
mode. <code class="docutils literal notranslate"><span class="pre">jpg</span></code> image files are not generally written by humans (and are
indeed not readable by humans), and you should therefore open them in
binary mode by adding a <code class="docutils literal notranslate"><span class="pre">b</span></code> to the mode string (if you’re following
the opening example, the correct mode would be <code class="docutils literal notranslate"><span class="pre">rb</span></code>). If you open
something in text mode (i.e. add a <code class="docutils literal notranslate"><span class="pre">t</span></code>, or nothing apart from
<code class="docutils literal notranslate"><span class="pre">r/r+/w/a</span></code>), you must also know which encoding to use. For a
computer, all files are just bytes, not characters.</p>
<p>Unfortunately, <code class="docutils literal notranslate"><span class="pre">open</span></code> does not allow explicit encoding specification
in Python 2.x. However, the function
<a class="reference external" href="http://docs.python.org/2/library/io.html#io.open">io.open</a> is
available in both Python 2.x and 3.x (where it is an alias of <code class="docutils literal notranslate"><span class="pre">open</span></code>),
and does the right thing. You can pass in the encoding with the
<code class="docutils literal notranslate"><span class="pre">encoding</span></code> keyword. If you don’t pass in any encoding, a system – and
Python – specific default will be picked. You may be tempted to rely on
these defaults, but the defaults are often wrong, or the default
encoding cannot actually express all characters in the file (this will happen often on
Python 2.x and/or Windows). So go ahead and pick an encoding. Encoding is the way to instruct computers about how the numbers should be stored as bytes in memory. <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>
is a terrific one and is supported by major browsers and programming languages. When you write a file, you can just pick the encoding
to your liking (or the liking of the program that will eventually read
your file).</p>
<p>How do you find out which encoding a file you’re reading was written in? Well,
unfortunately, there is no foolproof way to detect the encoding - the
same bytes can represent different, but equally valid characters in
different encodings. Therefore, you must rely on metadata (for example,
in HTTP headers) to know the encoding. Increasingly, formats just define
the encoding to be UTF-8.</p>
<p>Armed with this knowledge, let’s write a program that reads a file,
determines whether it’s JPG (hint: These files start with the bytes
<code class="docutils literal notranslate"><span class="pre">FF</span> <span class="pre">D8</span></code>), and writes a text file that describe the input file.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
    <span class="n">jpgdata</span> <span class="o">=</span> <span class="n">inf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">if</span> <span class="n">jpgdata</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff\xd8</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;This is a JPEG file (</span><span class="si">%d</span><span class="s1"> bytes long)</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;This is a random file (</span><span class="si">%d</span><span class="s1"> bytes long)</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;summary.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
    <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">jpgdata</span><span class="p">))</span>
</pre></div>
</div>
<p>I am sure that now you will use <code class="docutils literal notranslate"><span class="pre">open</span></code> correctly!</p>
</div>
</div>
</div>

<h1></h1>
<h1>23. Targeting Python 2+3</h1>
<p>In a lot of cases you might want to develop programs which can be run in
both Python 2+ and 3+.</p>
<p>Just imagine that you have a very popular Python module which is used by
hundreds of people but not all of them have Python 2 or 3. In that case
you have two choices. The first one is to distribute 2 modules, one for
Python 2 and the other for Python 3. The other choice is to modify your
current code and make it compatible with both Python 2 and 3.</p>
<p>In this section I am going to highlight some of the tricks which you can
employ to make a script compatible with both of them.</p>
<p><strong>Future imports</strong></p>
<p>The first and most important method is to use <code class="docutils literal notranslate"><span class="pre">__future__</span></code> imports. It
allows you to import Python 3 functionality in Python 2. Here are a couple
examples:</p>
<p>Context managers were new in Python 2.6+. For using them in Python 2.5 you can use:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">with_statement</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">print</span></code> was changed to a function in Python 3. If you want to use it
in Python 2 you can import it from <code class="docutils literal notranslate"><span class="pre">__future__</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span>
<span class="c1"># Output:</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
<span class="c1"># Output: &lt;built-in function print&gt;</span>
</pre></div>
</div>
<p><strong>Dealing with module renaming</strong></p>
<p>First, tell me how you import packages in your script ? Most of us do
this :</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">foo</span>
<span class="c1"># or</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="k">import</span> <span class="n">bar</span>
</pre></div>
</div>
<p>Do you know that you can do something like this as well?</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">foo</span> <span class="k">as</span> <span class="nn">foo</span>
</pre></div>
</div>
<p>I know its function is the same as the above listed code but it is vital
for making your script compatible with Python 2 and 3. Now examine the
code below :</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">urllib.request</span> <span class="k">as</span> <span class="nn">urllib_request</span>  <span class="c1"># for Python 3</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">urllib2</span> <span class="k">as</span> <span class="nn">urllib_request</span>  <span class="c1"># for Python 2</span>
</pre></div>
</div>
<p>So let me explain the above code a little. We are wrapping our importing
code in a <code class="docutils literal notranslate"><span class="pre">try/except</span></code> clause. We are doing it because in Python 2 there is
no <code class="docutils literal notranslate"><span class="pre">urllib.request</span></code> module so this would result in an <code class="docutils literal notranslate"><span class="pre">ImportError</span></code>. The
functionality of <code class="docutils literal notranslate"><span class="pre">urllib.request</span></code> is provided by the <code class="docutils literal notranslate"><span class="pre">urllib2</span></code> module in
Python 2. So, when using Python 2, we try to import <code class="docutils literal notranslate"><span class="pre">urllib.request</span></code> and
if we get an <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> then we tell Python to import <code class="docutils literal notranslate"><span class="pre">urllib2</span></code> instead.</p>
<p>The final thing you need to know about is the <code class="docutils literal notranslate"><span class="pre">as</span></code> keyword. It is
mapping the imported module to <code class="docutils literal notranslate"><span class="pre">urllib_request</span></code>. So that all of
the classes and methods within <code class="docutils literal notranslate"><span class="pre">urllib2</span></code> are available to us via the alias
<code class="docutils literal notranslate"><span class="pre">urllib_request</span></code>.</p>
<p><strong>Obsolete Python 2 builtins</strong></p>
<p>Another thing to keep in mind is that there are 12 Python 2 builtins
which have been removed from Python 3. Make sure that you don’t use them
in Python 2 in order to make your code compatible with Python 3.
Here is a way to enforce that you abandon these 12 builtins in Python 2 as
well:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">future.builtins.disabled</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Now whenever you try to use the modules which are abandoned in Python 3,
it raises a <code class="docutils literal notranslate"><span class="pre">NameError</span></code> like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">future.builtins.disabled</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">apply</span><span class="p">()</span>
<span class="c1"># Output: NameError: obsolete Python 2 builtin apply is disabled</span>
</pre></div>
</div>
<p><strong>External standard-library backports</strong></p>
<p>There are a few packages in the wild which provide Python 3
functionality in Python 2. For instance, we have:</p>
<ul class="simple">
<li>enum <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">enum34</span></code></li>
<li>singledispatch <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">singledispatch</span></code></li>
<li>pathlib <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pathlib</span></code></li>
</ul>
<p>For further reading, the Python documentation has a <a class="reference external" href="https://docs.python.org/3/howto/pyporting.html">comprehensive guide</a> of steps you need to
take to make your code compatible with both Python 2 and 3.</p>
</div>
</div>
</div>

<h1></h1>
<h1>24. Coroutines</h1>
<p>Coroutines are similar to generators with a few differences. The main
differences are:</p>
<ul class="simple">
<li>generators are data producers</li>
<li>coroutines are data consumers</li>
</ul>
<p>First of all let’s review the generator creation process. We can make
generators like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fib</span><span class="p">():</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
     <span class="k">yield</span> <span class="n">a</span>
         <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
</pre></div>
</div>
<p>We then commonly use it in a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fib</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>It is fast and does not put a lot of pressure on memory because it
<strong>generates</strong> the values on the fly rather than storing them in a list.
Now, if we use <code class="docutils literal notranslate"><span class="pre">yield</span></code> in the above example, more generally, we get a
coroutine. Coroutines consume values which are sent to it. A very basic
example would be a <code class="docutils literal notranslate"><span class="pre">grep</span></code> alternative in Python:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">grep</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Searching for&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
     <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
             <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Wait! What does <code class="docutils literal notranslate"><span class="pre">yield</span></code> return? Well we have turned it into a
coroutine. It does not contain any value initially, instead we supply it
values externally. We supply values by using the <code class="docutils literal notranslate"><span class="pre">.send()</span></code> method.
Here is an example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">grep</span><span class="p">(</span><span class="s1">&#39;coroutine&#39;</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
<span class="c1"># Output: Searching for coroutine</span>
<span class="n">search</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;I love you&quot;</span><span class="p">)</span>
<span class="n">search</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Don&#39;t you love me?&quot;</span><span class="p">)</span>
<span class="n">search</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;I love coroutines instead!&quot;</span><span class="p">)</span>
<span class="c1"># Output: I love coroutines instead!</span>
</pre></div>
</div>
<p>The sent values are accessed by <code class="docutils literal notranslate"><span class="pre">yield</span></code>. Why did we run <code class="docutils literal notranslate"><span class="pre">next()</span></code>? It is
required in order to start the coroutine. Just like <code class="docutils literal notranslate"><span class="pre">generators</span></code>, coroutines do not
start the function immediately. Instead they run it in response to the
<code class="docutils literal notranslate"><span class="pre">__next__()</span></code> and <code class="docutils literal notranslate"><span class="pre">.send()</span></code> methods. Therefore, you have to run
<code class="docutils literal notranslate"><span class="pre">next()</span></code> so that the execution advances to the <code class="docutils literal notranslate"><span class="pre">yield</span></code> expression.</p>
<p>We can close a coroutine by calling the <code class="docutils literal notranslate"><span class="pre">.close()</span></code> method:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">grep</span><span class="p">(</span><span class="s1">&#39;coroutine&#39;</span><span class="p">)</span>
<span class="c1"># ...</span>
<span class="n">search</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>There is a lot more to <code class="docutils literal notranslate"><span class="pre">coroutines</span></code>. I suggest you check out <a class="reference external" href="http://www.dabeaz.com/coroutines/Coroutines.pdf">this
awesome
presentation</a> by
David Beazley.</p>
</div>
</div>
</div>

<h1></h1>
<h1>25. Function caching</h1>
<p>Function caching allows us to cache the return values of a function
depending on the arguments. It can save time when an I/O bound function
is periodically called with the same arguments. Before Python 3.2 we had
to write a custom implementation. In Python 3.2+ there is an
<code class="docutils literal notranslate"><span class="pre">lru_cache</span></code> decorator which allows us to quickly cache and uncache the
return values of a function.</p>
<p>Let’s see how we can use it in Python 3.2+ and the versions before it.</p>
<div class="section" id="python-3-2">
<h2>25.1. Python 3.2+</h2>
<p>Let’s implement a Fibonacci calculator and use <code class="docutils literal notranslate"><span class="pre">lru_cache</span></code>.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
     <span class="k">return</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">([</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
<span class="c1"># Output: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">maxsize</span></code> argument tells <code class="docutils literal notranslate"><span class="pre">lru_cache</span></code> about how many recent
return values to cache.</p>
<p>We can easily uncache the return values as well by using:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fib</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="python-2">
<h2>25.2. Python 2+</h2>
<p>There are a couple of ways to achieve the same effect. You can create
any type of caching mechanism. It entirely depends upon your needs. Here
is a generic cache:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">memoize</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="n">memo</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
     <span class="k">if</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
             <span class="k">return</span> <span class="n">memo</span><span class="p">[</span><span class="n">args</span><span class="p">]</span>
             <span class="k">else</span><span class="p">:</span>
             <span class="n">rv</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
                 <span class="n">memo</span><span class="p">[</span><span class="n">args</span><span class="p">]</span> <span class="o">=</span> <span class="n">rv</span>
                 <span class="k">return</span> <span class="n">rv</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@memoize</span>
<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">fibonacci</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Note:</strong> memoize won’t cache unhashable types (dict, lists, etc…) but only the immutable types. Keep that in mind when using it.</p>
<p><a class="reference external" href="https://www.caktusgroup.com/blog/2015/06/08/testing-client-side-applications-django-post-mortem/">Here</a>
is a fine article by Caktus Group in which they caught a bug in Django
which occurred due to <code class="docutils literal notranslate"><span class="pre">lru_cache</span></code>. It’s an interesting read. Do check it out.</p>
</div>
</div>
</div>
</div>

<h1></h1>
<h1>26. Context Managers</h1>
<p>Context managers allow you to allocate and release resources precisely
when you want to. The most widely used example of context managers is
the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement. Suppose you have two related operations which
you’d like to execute as a pair, with a block of code in between.
Context managers allow you to do specifically that. For example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;some_file&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened_file</span><span class="p">:</span>
    <span class="n">opened_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Hola!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code opens the file, writes some data to it and then closes
it. If an error occurs while writing the data to the file, it tries to
close it. The above code is equivalent to:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;some_file&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Hola!&#39;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>While comparing it to the first example we can see that a lot of
boilerplate code is eliminated just by using <code class="docutils literal notranslate"><span class="pre">with</span></code>. The main
advantage of using a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement is that it makes sure our file
is closed without paying attention to how the nested block exits.</p>
<p>A common use case of context managers is locking and unlocking resources
and closing opened files (as I have already shown you).</p>
<p>Let’s see how we can implement our own Context Manager. This should allow
us to understand exactly what’s going on behind the scenes.</p>
<div class="section" id="implementing-a-context-manager-as-a-class">
<h2>26.1. Implementing a Context Manager as a Class:</h2>
<p>At the very least a context manager has an <code class="docutils literal notranslate"><span class="pre">__enter__</span></code> and
<code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method defined. Let’s make our own file-opening Context
Manager and learn the basics.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Just by defining <code class="docutils literal notranslate"><span class="pre">__enter__</span></code> and <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> methods we can use our new class in
a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement. Let’s try:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;demo.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened_file</span><span class="p">:</span>
    <span class="n">opened_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Hola!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method accepts three arguments. They are required by
every <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method which is a part of a Context Manager class.
Let’s talk about what happens under-the-hood.</p>
<ol class="arabic simple">
<li>The <code class="docutils literal notranslate"><span class="pre">with</span></code> statement stores the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method of the <code class="docutils literal notranslate"><span class="pre">File</span></code>
class.</li>
<li>It calls the <code class="docutils literal notranslate"><span class="pre">__enter__</span></code> method of the <code class="docutils literal notranslate"><span class="pre">File</span></code> class.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">__enter__</span></code> method opens the file and returns it.</li>
<li>The opened file handle is passed to <code class="docutils literal notranslate"><span class="pre">opened_file</span></code>.</li>
<li>We write to the file using <code class="docutils literal notranslate"><span class="pre">.write()</span></code>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">with</span></code> statement calls the stored <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method closes the file.</li>
</ol>
</div>
<div class="section" id="handling-exceptions">
<h2>26.2. Handling Exceptions</h2>
<p>We did not talk about the <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">traceback</span></code>
arguments of the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method. Between the 4th and 6th step, if
an exception occurs, Python passes the type, value and traceback of the
exception to the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method. It allows the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method
to decide how to close the file and if any further steps are required.
In our case we are not paying any attention to them.</p>
<p>What if our file object raises an exception? We might be trying to
access a method on the file object which it does not supports. For
instance:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;demo.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened_file</span><span class="p">:</span>
    <span class="n">opened_file</span><span class="o">.</span><span class="n">undefined_function</span><span class="p">(</span><span class="s1">&#39;Hola!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s list the steps which are taken by the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement when
an error is encountered:</p>
<ol class="arabic simple">
<li>It passes the type, value and traceback of the error to the
<code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method.</li>
<li>It allows the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method to handle the exception.</li>
<li>If <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> returns <code class="docutils literal notranslate"><span class="pre">True</span></code> then the exception was gracefully
handled.</li>
<li>If anything other than <code class="docutils literal notranslate"><span class="pre">True</span></code> is returned by the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method then
the exception is raised by the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement.</li>
</ol>
<p>In our case the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method returns <code class="docutils literal notranslate"><span class="pre">None</span></code> (when no return
statement is encountered then the method returns <code class="docutils literal notranslate"><span class="pre">None</span></code>). Therefore,
the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement raises the exception:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;file&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;undefined_function&#39;</span>
</pre></div>
</div>
<p>Let’s try handling the exception in the <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception has been handled&quot;</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">file_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
         <span class="k">return</span> <span class="kc">True</span>

<span class="k">with</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;demo.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened_file</span><span class="p">:</span>
    <span class="n">opened_file</span><span class="o">.</span><span class="n">undefined_function</span><span class="p">()</span>

<span class="c1"># Output: Exception has been handled</span>
</pre></div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> method returned <code class="docutils literal notranslate"><span class="pre">True</span></code>, therefore no exception was raised
by the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement.</p>
<p>This is not the only way to implement Context Managers. There is another
way and we will be looking at it in the next section.</p>
</div>
<div class="section" id="implementing-a-context-manager-as-a-generator">
<h2>26.3. Implementing a Context Manager as a Generator</h2>
<p>We can also implement Context Managers using decorators and generators.
Python has a contextlib module for this very purpose. Instead of a
class, we can implement a Context Manager using a generator function.
Let’s see a basic, useless example:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">f</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Okay! This way of implementing Context Managers appear to be more
intuitive and easy. However, this method requires some knowledge about
generators, yield and decorators. In this example we have not caught any
exceptions which might occur. It works in mostly the same way as the
previous method.</p>
<p>Let’s dissect this method a little.</p>
<ol class="arabic simple">
<li>Python encounters the <code class="docutils literal notranslate"><span class="pre">yield</span></code> keyword. Due to this it creates a
generator instead of a normal function.</li>
<li>Due to the decoration, contextmanager is called with the function
name (<code class="docutils literal notranslate"><span class="pre">open\_file</span></code>) as it’s argument.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">contextmanager</span></code> decorator returns the generator wrapped by the
<code class="docutils literal notranslate"><span class="pre">GeneratorContextManager</span></code> object.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">GeneratorContextManager</span></code> is assigned to the <code class="docutils literal notranslate"><span class="pre">open_file</span></code>
function. Therefore, when we later call the <code class="docutils literal notranslate"><span class="pre">open_file</span></code> function, we
are actually calling the <code class="docutils literal notranslate"><span class="pre">GeneratorContextManager</span></code> object.</li>
</ol>
<p>So now that we know all this, we can use the newly generated Context
Manager like this:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">open_file</span><span class="p">(</span><span class="s1">&#39;some_file&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;hola!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<br>
<br>
<br>
<br>

<script>
  $(function() {
    var toc = $('#toc');
      function makeLi(text, href) {
      return $('<a href="' + href + '" target="_self">' + text + '</a><br>');
    }
      $('h1,h2,h3').each(function(i) {
      var chapter = $(this), chapterNumber = i + 1;
      toc.append(
       makeLi(chapter.text(), '#chapter-' + chapterNumber)
      );
      chapter.attr('id', 'chapter-' + chapterNumber);
    });
    });
</script>
</body>
</html>
