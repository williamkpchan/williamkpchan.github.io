<base target="_blank"><html><head><title>Lodash</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://williamkpchan.github.io/maincss.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.js"></script>
<script src="https://williamkpchan.github.io/lazyload.min.js"></script>
<script src='https://williamkpchan.github.io/mainscript.js'></script>
<script src="https://williamkpchan.github.io/commonfunctions.js"></script>
<script>
  var showTopicNumber = true;
  var bookid = "Lodash"
  var markerName = "h2, h3"
</script>
<style>
body{width:80%;margin-left: 10%; font-size:24px;}
h1, h2 {color: gold;}
strong {color: orange;}
img {max-width:90%; display: inline-block; margin-top: 2%;margin-bottom: 1%; border-radius:3px;}
</style></head><body onkeypress="chkKey()"><center>
<h1>Lodash</h1>
<a href="#mustWatch" class="red goldbs" target="_self">Must Watch!</a><br><br>
<div id="toc"></div></center><br><br>
<div id="mustWatch"><center><span class="red">MustWatch</span></center><br></div>
<pre><br><br>

<h2><span class="orange">Introduction</span></h2>
This book is about popular JavaScript utilities library <a href="http://lodash.com/">lodash</a>. 
Before we discuss lodash, we need to understand why we need a JavaScript utilities library. 
With the prevalence of <a href="http://en.wikipedia.org/wiki/Web_2.0">Web 2.0</a>, <a href="http://en.wikipedia.org/wiki/Ajax_(programming)">Ajax</a> and <a href="http://nodejs.org">NodeJS</a>, JavaScript has become a very important programming language in both browser and server side. 
Besides of the bad parts<sup><a href="#fn-fn1" rel="footnote">1</a></sup> of JavaScript language, JavaScript itself doesn’t have a rich set of high-level API for developers to use, which makes common programming tasks hard to complete.
For example, it’s a very common task to iterate an array and process items in this array in sequence. 
In some old browsers, JavaScript <code>Array</code> object doesn’t have the method <code>forEach</code>. 
To iterate an array, <code>for</code> loop is required as in Listing 1.1.
Listing 1.1: Traditional approach to iterate an array
<code>for (var i = 0, n = array.length; i &lt; n; i++) {</code>
  <code>process(array[i]);</code>
<code>}</code>

When using <code>forEach</code> method, Listing 1.1 can be simplified as in Listing 1.2.
  Listing 1.2: Use <code>forEach</code> to iterate an array
<code>array.forEach(process);</code>

Comparing code snippets in Listing 1.1 and Listing 1.2, it’s very obvious that Listing 1.2 is much simpler to understand and easier to write and maintain. 
That’s why developers want more high-level APIs. 
JavaScript itself is evolving to add more language features and APIs, but the process is not fast enough. 
<a href="http://en.wikipedia.org/wiki/ECMAScript">ECMAScript</a>, the specification behind JavaScript, includes nine new methods for searching and manipulating array contents in <a href="http://www.ecma-international.org/ecma-262/5.1/">5th edition</a>. 
This means developers can use <code>forEach</code> method when JavaScript engine supports ECMAScript 5. 
But some old browsers, like IE 8, don’t support ECMAScript 5, which means developers need to consider about cross-platform compatibility issues if supporting old browsers is required. 
<a href="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript 6</a> specification is published in June 2015 with a lot of new features and enhancements.
Developers rely on JavaScript libraries to make daily development easier. 
The goal of libraries is to become the bridge between JavaScript runtime and developers. 
Developers can enjoy the high-level APIs provided by libraries. 
Libraries handle underlying implementation details about how to use low-level JavaScript APIs efficiently.
You may have heard about or even used another JavaScript utilities library <a href="http://underscorejs.org/">Underscore</a>. 
Underscore provides a rich set of common APIs in namespace <code>_</code>. 
Lodash also uses namespace <code>_</code> and it’s a drop-in replacement of Underscore with more features and performance improvements. 
If you already use Underscore, you can replace the Underscore with lodash, everything should just work.
This book contains content for lodash version 3.10.1 and 4.17.4. 
Lodash v4 introduced some breaking changes which have compatibility issues with v3. 
Those changes will be documented clearly in this book. 
Since most of the users of lodash are still using v3, the main content of this book is based on v3.
<h3>1.1 Installation</h3>
Lodash is just a plain old JavaScript library, so it’s very easy to install and use.
<h4>
1.1.1 Web</h4>
In a web application, just download lodash release JavaScript file and include in the HTML page, then use <code>_</code> in the JavaScript code.
  Listing 1.3: Install lodash in HTML page
<code>&lt;script src="lodash.js"&gt;&lt;/script&gt;</code>

You can also use links provided by CDN servers to load lodash. 
CDN servers usually have different versions of lodash to choose. 
Listing 1.4 shows how to use <a href="https://cdnjs.com/libraries/lodash.js">cdnjs</a> to load lodash.
  Listing 1.4. 
Load lodash from cdnjs
<code>&lt;script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/4.3.0/lodash.js"&gt;</code>
<code>&lt;/script&gt;</code>

<a href="http://bower.io">Bower</a> can be used to install lodash.
  Listing 1.5: Install lodash using Bower
$ bower install lodash --save
<h4>
1.1.2 NodeJS</h4>
In NodeJS, install lodash using <a href="http://npmjs.org">npm</a>,
  Listing 1.6: Install lodash using npm
$ npm install --save lodash
$ npm install --save lodash@3.10.1

Then use <code>require</code> to import lodash package,
  Listing 1.7: Use lodash in NodeJS
<code>var _ = require('lodash'); // Require the whole lodash package</code>
<code>var forEach = require('lodash/forEach'); // Require only forEach (v4)</code>
<code>var forEach = require('lodash/collection/forEach'); // Require only forEach (v3)</code>
It’s recommended to only install NodeJS modules of actually used modules. 
For example, if the code only uses <code>_.forEach</code> method, then install the <code>lodash.foreach</code> module only.
  Listing 1.8: Use lodash modules
<code>$ npm install --save lodash.foreach</code>
<code>var forEach = require('lodash.foreach');</code>

<h3>1.2 Lodash features</h3>
Lodash focuses on providing core features that are frequently used for JavaScript built-in objects, including:
Arrays
Objects
Functions
Strings

Some of those features may have been included in latest version of ECMAScript specification. 
Some platforms may have also implemented extra features. 
If the underlying platform already supports a certain feature, lodash just uses the native feature to improve performance.
<h3>1.3 Code sample convention</h3>
All code samples in this book are written in plain old ECMAScript 5 JavaScript syntax. 
For each statement, the result of execution is provided below the actual code line as a comment.
  Listing 1.9: Code sample convention
<code>_.min([1, 2, 3]);</code>
<code>// -&gt; 1</code>

As in the Listing 1.9 above, <code>_.min([1, 2, 3]);</code> is the actual code, <code>1</code> after <code>// -&gt;</code> is the execution result.
<h3>1.4 About this book</h3>
Lodash is a well-documented JavaScript library with comprehensive <a href="https://lodash.com/docs">official documentation</a>. 
This book is a simple and concise guide on how to use lodash in practice. 
It covers core features and most frequently used functions.
<h2><span class="orange">Common concepts</span></h2>
Before diving into details of lodash’s functions, let’s introduce some common concepts in lodash first.
<h3>2.1 Truthy and falsy</h3>
Truthy and falsy values are very important when using lodash predicates. 
<code>false</code>, <code>0</code>, <code>""</code>(empty string), <code>null</code>, <code>undefined</code> and <code>NaN</code> are falsy values in JavaScript. 
All other values are truthy values.
<h3>2.2 SameValueZero</h3>
<em><a href="http://www.ecma-international.org/ecma-262/6.0/#sec-samevaluezero">SameValueZero</a></em> is the algorithm of how to compare two values in lodash. 
It’s similar with JavaScript “strict equality comparison” (<code>===</code>), except the handling of <code>NaN</code>. 
Because <code>NaN === NaN</code> returns false, it causes confusion to developers. 
<em>SameValueZero</em> removes that confusion, so <code>NaN</code> is same to <code>NaN</code> in <em>SameValueZero</em> algorithm.
<h3>2.3 Predicates</h3>
Predicate functions only return truthy or falsy values. 
They are used frequently in lodash. 
For example, when filtering a collection, a predicate function is required to determine what kind of elements should be filtered.
Predicate functions can be written directly by developers as plain old JavaScript functions. 
Lodash provides some helper functions to generate predicate functions for common use cases.
<h4>
2.3.1 <code>_.matches</code>
</h4>
<code>_.matches(source)</code> takes a source object and creates a new function which performs a deep comparison between given object and the source object. 
<code>_.matches</code> supports comparison of different types of data, including booleans, numbers, string, <code>Date</code> objects, <code>RegExp</code> objects, <code>Object</code> objects and arrays.
  Listing 2.1: Match by object comparison
<code>var f = _.matches('hello');</code>
<code>f('world');</code>
<code>// -&gt; false</code>
<code>f('hello');</code>
<code>// -&gt; true</code>
<code>f = _.matches([{a: 1}, {b: 2}]);</code>
<code>f([{a: 1}, {b: 3}]);</code>
<code>// -&gt; false</code>

<h4>
2.3.2 <code>_.matchesProperty</code>
</h4>
<code>_.matchesProperty(path, value)</code> takes a property path and expected value of this property path to create a new function which checks if given object’s value of the same property path matches the expected value.
  Listing 2.2: Match by comparing property value
<code>var f = _.matchesProperty('name', 'Alex');</code>
<code>f({name: 'Alex'});</code>
<code>// -&gt; true</code>
<code>f = _.matchesProperty('length', 5);</code>
<code>f('hello');</code>
<code>// -&gt; true</code>
<code>var f = _.matchesProperty('user.name', 'Alex');</code>
<code>f({user: {name: 'Alex'}});</code>
<code>// -&gt; true</code>

<h4>
2.3.3 <code>_.property</code>
</h4>
<code>_.property(path)</code> takes a property path and creates a new function which returns the value of this property path in given object. 
<code>_.property</code> can be used to create predicate functions with property value converted to truthy or falsy value.
  Listing 2.3: Match by property’s own value
<code>var f = _.property('name');</code>
<code>f({name: 'Alex'});</code>
<code>// -&gt; 'Alex'</code>

For lodash functions which accept predicates, e.g. 
<code>_.find</code>, <code>_.filter</code>, predicates can be specified using functions, strings, and objects.
<ul>
If a function is provided, it’s used directly.
If only a string is provided, it’s used to create a function using <code>_.property</code> as the predicate.
If a string and a value are provided, they are used to create a function using <code>_matchesProperty</code> as the predicate.
If an object is provided, it’s used to create a function using <code>_.matches</code> as the predicate.
</ul>
For example, given an array as in Listing 2.4:
  Listing 2.4: Example input array
<code>var users = [</code>
  <code>{</code>
    <code>name: 'Alex',</code>
    <code>age: 30,</code>
    <code>is_premium: false</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'Bob',</code>
    <code>age: 20,</code>
    <code>is_premium: true</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'Mary',</code>
    <code>age: 25,</code>
    <code>is_premium: false</code>
  <code>}</code>
<code>];</code>

A JavaScript function can be used as the predicate to <code>_.find</code>. 
Listing 2.5 returns objects in <code>users</code> array with <code>age</code> greater than <code>18</code>.
  Listing 2.5: Find using a function
<code>_.find(users, function(user) {</code>
  <code>return user.age &gt; 18;</code>
<code>});</code>

If a string is passed as the predicate, it’s treated as a property name of objects in the array. 
Listing 2.6 returns objects in the array with truthy value of property <code>is_premium</code>. 
The actual used predicate is <code>_.property('is_premium')</code>.
  Listing 2.6: Find using a property value
<code>_.find(users, 'is_premium');</code>

If an object is passed as the predicate, it’s treated as a search example. 
Objects in returned results must have exactly the same value for the same property provided in the search example. 
Listing 2.7 returns objects in the array with the value of <code>name</code> property equals to <code>Alex</code>. 
The actual used predicate is <code>_.matches({ name: 'Alex' })</code>.
  Listing 2.7: Find using an object
<code>_.find(users, { name: 'Alex' });</code>
<h3>2.4 Iteratees</h3>
Iteratees are used by lodash functions which require iterating through a collection. 
Iteratee is invoked for each element in the collection and the result is used instead of the element. 
Iteratees are used to transform collections. 
A typical usage of iteratee is in lodash <code>_.map</code> function. 
The second argument of <code>_.map</code> is the iteratee. 
The result of applying iteratee to each element in the collection is collected and returned.
  Listing 2.8: <code>map</code> using an iterate function
<code>_.map([1, 2, 3], function(n) {</code>
  <code>return n * 3;</code>
<code>})</code>
<code>// -&gt; [3, 6, 9]</code>
<h4>
2.4.1 <strong>[v4]</strong> Iteratee shorthand</h4>
In v4, when iteratee functions are required, we can also use the similar syntax as predicate functions to quickly create them. 
These iteratee shorthands use <code>_.matches</code>, <code>_.matchesProperty</code> or <code>_.property</code> methods behind the scene.
In the second line of using <code>_.map</code> of Listing 2.9, the second argument of <code>_.map</code> must be an array to indicate that it uses <code>_.matchesProperty</code>.
  Listing 2.9. 
<code>map</code> using an iteratee shorthand
<code>_.map(users, {name: 'Alex'}); // Use _.matches</code>
<code>// -&gt; [true, false, false]</code>
<code>_.map(users, ['name', 'Alex']); // Use _.matchesProperty</code>
<code>// -&gt; [true, false, false]</code>
<code>_.map(users, 'name'); // Use _.property</code>
<code>// -&gt; ["Alex", "Bob", "Mary"]</code>

<h3>2.5 <strong>[v3]</strong> <code>this</code> binding</h3>
When using predicates and iteratees, an optional object can be passed as the bound value of <code>this</code> keyword when invoked. 
This is very handy when predicates and iteratees reside in other objects and need to access properties in those objects.
  Listing 2.10: <code>map</code> with <code>this</code> binding
<code>var obj = {</code>
  <code>val: 10,</code>
  <code>add: function(n) {</code>
    <code>return this.val + n;</code>
  <code>}</code>
<code>};</code>
<code>_.map([1, 2, 3], obj.add, obj);</code>
<code>// -&gt; [11, 12, 13]</code>
<h3>2.6 <strong>[v4]</strong> <code>this</code> binding</h3>
In v4, <code>thisArg</code> argument in most methods have been removed. 
To specify the binding object, <code>_.bind</code> should be used explicitly.
  Listing 2.11: <code>map</code> with <code>this</code> binding using <code>_.bind</code>
<code>var obj = {</code>
  <code>val: 10,</code>
  <code>add: function(n) {</code>
    <code>return this.val + n;</code>
  <code>}</code>
<code>};</code>
<code>_.map([1, 2, 3], _.bind(obj.add, obj));</code>
<code>// -&gt; [11, 12, 13]</code>

Listing 2.11 works in both v3 and v4, but Listing 2.10 only works in v3.
<h2><span class="orange">Collections</span></h2>
A collection is an object which contains iterable elements. 
In lodash, collections can be arrays, objects, and strings. 
Lodash has a rich set of functions to work with collections.
<h3>3.1 Every and some</h3>
<code>_.every(collection, [predicate=_.identity], [thisArg])</code> checks if <strong>all</strong> elements in the collection satisfy given condition. 
The condition is specified using predicate.
  Listing 3.1: Check if all elements match certain condition
<code>_.every([1, 2, 3, 4], function(n) {</code>
  <code>return n % 2 === 0;</code>
<code>});</code>
<code>// -&gt; false</code>
<code>var fruits = [</code>
  <code>{</code>
    <code>name: 'apple',</code>
    <code>price: 1.99,</code>
    <code>onSale: true</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'orange',</code>
    <code>price: 0.99,</code>
    <code>onSale: true</code>
  <code>}</code>
<code>];</code>
<code>_.every(fruits, 'onSale', true);</code>
<code>// -&gt; true</code>
<code>var obj = {</code>
  <code>a: 1,</code>
  <code>b: 2,</code>
  <code>c: 3</code>
<code>};</code>
<code>_.every(obj, function(n) {</code>
  <code>return n % 2 === 0;</code>
<code>});</code>
<code>// -&gt; false</code>
<code>_.some(collection, [predicate=_.identity], [thisArg])</code> is the opposite of <code>_.every</code> which checks if <strong>any</strong> element in the collection satisfies given condition. 
The condition is also specified using a predicate. 
<code>_.some</code> doesn’t need to iterate the entire collection and the iteration exits as soon as a matching element is found.
  Listing 3.2: Check if any element matches certain condition
<code>_.some([1, 2, 3, 4], function(n) {</code>
  <code>return n % 2 === 0;</code>
<code>});</code>
<code>// -&gt; true</code>
<code>_.some('hello', function(c) {</code>
  <code>return c === 'h';</code>
<code>});</code>
<code>// -&gt; true</code>
<h3>3.2 Filter and reject</h3>
<code>_.filter(collection, [predicate=_.identity], [thisArg])</code> filters a collection by returning elements matching given predicate. 
<code>_.reject(collection, [predicate=_.identity], [thisArg])</code> is the opposite of <code>_.filter</code>, which returns elements <strong>not</strong> matching given predicate. 
When <code>_.filter</code> is used to filter objects, only values of matching properties are returned. 
If you want to keep the original object structure, use <code>_.pick</code> and <code>_.omit</code> instead. 
When <code>_.filter</code> is used on strings, matching characters are returned in array.
  Listing 3.3: Filter a collection
<code>_.filter(['a', 'b', 'c'], function(char) {</code>
  <code>return char &gt; 'b';</code>
<code>});</code>
<code>// -&gt; ['c']</code>
<code>var obj = {</code>
  <code>a: 1,</code>
  <code>b: 2,</code>
  <code>c: 3</code>
<code>};</code>
<code>_.filter(obj, function(n) {</code>
  <code>return n &gt; 1;</code>
<code>});</code>
<code>// -&gt; [2, 3]</code>
<code>_.filter('hello', function(c) {</code>
  <code>return c !== 'l';</code>
<code>});</code>
<code>// -&gt; ['h', 'e', 'o']</code>
<code>_.reject(['a', 'b', 'c'], function(char) {</code>
  <code>return char &gt; 'b';</code>
<code>});</code>
<code>// -&gt; ['a', 'b']</code>

<h3>3.3 <strong>[v3]</strong> Where</h3>
<code>_.where(collection, source)</code> filters a collection by performing a deep comparison between each element and the given object. 
The actual filtering predicate is generated using <code>_.matches</code>.
  Listing 3.4: Filter a collection by comparing objects
<code>var users = [</code>
  <code>{</code>
    <code>name: 'Alex',</code>
    <code>email: 'alex@example.org'</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'Bob',</code>
    <code>email: 'bob@example.org'</code>
  <code>}</code>
<code>];</code>
<code>_.where(users, {</code>
  <code>name: 'Alex'</code>
<code>});</code>
<code>// -&gt; [{name: 'Alex', email: 'alex@example.org'}]</code>
  <code>_.where</code> is removed in v4, we can use <code>_.filter</code> with iteratee shorthand. 
So all <code>_.where</code> methods in Listing 3.6 can be replaced with <code>_.filter</code>.
</aside>
<h3>3.4 Size</h3>
<code>_.size(collection)</code> gets the size of a collection. 
For arrays, the size is the array’s length, same as the array’s <code>length</code> property. 
For objects, the size is the number of own enumerable properties, i.e. 
the length of the array returned by <code>_.keys</code>. 
For strings, the size is the string’s length.
  Listing 3.5: Get the size of a collection
<code>_.size([1, 2]);</code>
<code>// -&gt; 2</code>
<code>_.size({</code>
  <code>a: 1,</code>
  <code>b: 2,</code>
  <code>c: 3</code>
<code>});</code>
<code>// -&gt; 3</code>
<code>_.size('hello');</code>
<code>// -&gt; 5</code>

<h3>3.5 <strong>[v3]</strong> Pluck</h3>
<code>_.pluck(collection, key)</code> gets all values of the same property key from all elements in the collection. 
The values are returned in a new array.
  Listing 3.6: Get all values of the same property key
<code>var fruits = [</code>
  <code>{</code>
    <code>name: 'apple',</code>
    <code>price: 1.99,</code>
    <code>onSale: true</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'orange',</code>
    <code>price: 0.99,</code>
    <code>onSale: true</code>
  <code>}</code>
<code>];</code>
<code>_.pluck(fruits, 'name');</code>
<code>// -&gt; ['apple', 'orange']</code>
<code>_.pluck(fruits, 'prop');</code>
<code>// -&gt; [undefined, undefined]</code>
<code>var obj = {</code>
  <code>a: {</code>
    <code>value: 0</code>
  <code>},</code>
  <code>b: {</code>
    <code>value: 1</code>
  <code>}</code>
<code>};</code>
<code>_.pluck(obj, 'value');</code>
<code>// -&gt; [0, 1]</code>
<code>_.pluck('hello', 'length');</code>
<code>// -&gt; [1, 1, 1, 1, 1]</code>
<h5><code>_.pluck</code> removed in v4</h5>
<code>_.pluck</code> is removed in v4, we can use <code>_.map</code> with iteratee shorthand. 
So all <code>_.pluck</code> methods in Listing 3.6 can be replaced with <code>_.map</code>.
<h3>3.6 At</h3>
<code>_.at(collection, [props])</code> gets values from a collection by given property keys or array indexes.
  Listing 3.7: Get values from a collection by keys or indexes
<code>_.at({</code>
  <code>a: 1,</code>
  <code>b: 2,</code>
  <code>c: 3</code>
<code>}, ['a', 'c']);</code>
<code>// -&gt; [1, 3]</code>
<code>_.at('hello', [1, 2]);</code>
<code>// -&gt; ['e', 'l']</code>

<h3>3.7 Includes</h3>
<code>_.includes(collection, target, [fromIndex=0])</code> checks if a collection contains given value. 
An optional index can be provided as the starting position to search. 
If the collection is an object, values of this object’s properties, i.e. 
result of <code>_.values</code>, are searched instead. 
<code>_.includes</code> uses <code>SameAsZero</code> algorithm to check equality.
  Listing 3.8: Check if a collection contains given value
<code>_.includes(['a', 'b', 'c'], 'a');</code>
<code>// -&gt; true</code>
<code>_.includes(['a', 'b', 'c'], 'a', 1);</code>
<code>// -&gt; false</code>
<code>_.includes({</code>
  <code>a: 1,</code>
  <code>b: 2,</code>
  <code>c: 3</code>
<code>}, 1);</code>
<code>// -&gt; true</code>
<code>_.includes('hello', 'h');</code>
<code>// -&gt; true</code>
<h3>3.8 Sample</h3>
In v3, <code>_.sample(collection, [n])</code> gets random elements from a collection. 
By default, it only returns one random element. 
A number of random elements can be provided. 
For objects, random properties’ values are returned. 
For strings, random characters are returned.
In v4, <code>_.sample</code>’s functionality is split into two methods, <code>_.sample</code> and <code>_.sampleSize</code>. 
<code>_.sample</code> only gets a single random element from a collection. 
<code>_.sampleSize</code> allows specifying the number of elements to get.
  Listing 3.9: Get random elements from a collection
<code>_.sample(['a', 'b', 'c']); // v3</code>
<code>// -&gt; 'a'</code>
<code>_.sample(['a', 'b', 'c'], 2); // v3</code>
<code>// -&gt; ['a', 'b']</code>
<code>_.sample({ // v3</code>
  <code>a: 1,</code>
  <code>b: 2,</code>
  <code>c: 3</code>
<code>});</code>
<code>// -&gt; 1</code>
<code>_.sample('hello', 2); // v3</code>
<code>// -&gt; ['h', 'l']</code>
<code>_.sampleSize('hello', 2) // v4</code>
<code>// -&gt; ['h', 'l']</code>

<h3>3.9 Shuffle</h3>
<code>_.shuffle(collection)</code> shuffles a collection by generating a random permutation. 
<a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle">Fisher-Yates shuffle</a> is the algorithm used in lodash.
  Listing 3.10: Shuffle a collection
<code>_.shuffle(['a', 'b', 'c']);</code>
<code>// -&gt; ['b', 'c', 'a']</code>
<code>_.shuffle({</code>
  <code>a: 1,</code>
  <code>b: 2,</code>
  <code>c: 3</code>
<code>});</code>
<code>// -&gt; [1, 2, 3]</code>
<code>_.shuffle('hello');</code>
<code>// -&gt; ['l', 'l', 'o', 'h', 'e']</code>

<aside>
    Due to the random nature of <code>_.sample</code> and <code>_.shuffle</code>, most likely the result will be different when running Listing 3.10 on your local machine.
</aside>
<h3>3.10 Partition</h3>
<code>_.partition(collection, [predicate=_.identity], [thisArg])</code> splits a collection into two groups based on the result of invoking a predicate on each element. 
The first group contains elements for which the predicate returns truthy value, while the second group contains elements for which predicate returns falsy value.
  Listing 3.11: Split a collection into two groups
<code>_.partition(['a', 'b', 'c'], function(char) {</code>
    <code>return char &gt; 'a';</code>
<code>});</code>
<code>// -&gt; [['b', 'c'], ['a']]</code>
<code>_.partition(fruits, 'onSale');</code>
<code>// -&gt; [[{ name: 'apple', price: 1.99, onSale: true },</code>
<code>//      { name: 'orange', price: 0.99, onSale: true }],</code>
<code>//     []]</code>
<code>_.partition('hello', function(char) {</code>
  <code>return char &gt; 'l';</code>
<code>});</code>
<code>// -&gt; [['o'], ['h', 'e', 'l', 'l']]</code>

<h3>3.11 Count by</h3>
<code>_.countBy(collection, [iteratee=_.identity], [thisArg])</code> applies a function to each element in the collection and counts the number of occurrences of each result. 
Counting result is returned as an object.
  Listing 3.12: Count the number of occurrences of function invocation results
<code>_.countBy([1, 2, 3], function(n) {</code>
    <code>return n &gt; 1;</code>
<code>});</code>
<code>// -&gt; {false: 1, true: 2}</code>
<code>_.countBy({</code>
  <code>a: 1,</code>
  <code>b: 1,</code>
  <code>c: 2</code>
<code>}, function(val) {</code>
  <code>return val / 2;</code>
<code>});</code>
<code>// -&gt; {1: 1, 0.5: 2}</code>
<code>_.countBy('hello', function(char) {</code>
  <code>return char === 'l';</code>
<code>});</code>
<code>// -&gt; {false: 3, true: 2}</code>

<h3>3.12 Group by and index by</h3>
<code>_.groupBy(collection, [iteratee=_.identity], [thisArg])</code> applies a function to each element in the collection and groups the elements by the result. 
Elements have the same result will be in the same group. 
The grouping result is returned as an object. 
The keys in the object are the results, the values are arrays of elements which generate the corresponding result.
  Listing 3.13: Group elements by function invocation results
<code>_.groupBy([1, 2, 3], function(n) {</code>
    <code>return n &gt; 1;</code>
<code>});</code>
<code>// -&gt; {false: [1], true: [2, 3]}</code>
<code>_.groupBy({</code>
  <code>a: 1,</code>
  <code>b: 1,</code>
  <code>c: 2</code>
<code>}, function(val) {</code>
  <code>return val / 2;</code>
<code>});</code>
<code>// -&gt; {0.5: [1, 1], 1: [2]}</code>
<code>_.groupBy('hello', function(char) {</code>
  <code>return char === 'l';</code>
<code>});</code>
<code>// -&gt; {fasle: ['h', 'e', o], true: ['l', 'l']}</code>

The difference between <code>_.countBy</code> and <code>_.groupBy</code> is that <code>_.countBy</code> only returns the number of grouped elements.
In v3, <code>_.indexBy(collection, [iteratee=_.identity], [thisArg])</code>’s behavior is similar with <code>_.groupBy</code>, but <code>_.indexBy</code> only keeps last element for each result.
  Listing 3.14: Get last element of function invocation results
<code>_.indexBy([1, 2, 3], function(n) {</code>
    <code>return n &gt; 1;</code>
<code>});</code>
<code>// -&gt; {false: 1, true: 3}</code>
<code>_.indexBy('hello', function(char) {</code>
  <code>return char === 'l';</code>
<code>});</code>
<code>// -&gt; {false: 'o', true: 'l'}</code>

<aside>
    <h5>
<code>_.indexBy</code> renamed to <code>_.keyBy</code> in v4</h5>
  In v4, <code>_.indexBy</code> is renamed to <code>_.keyBy</code> with the same functionality.
</aside>
<h3>3.13 <strong>[v3]</strong> Invoke</h3>
In v3, <code>_.invoke(collection, methodName, [args])</code> invokes a method on each element in the collection and returns results in an array. 
The method to invoke is provided by name, so only element’s own or inherited methods are allowed. 
Additional arguments can also be provided as arguments for method invocation.
  Listing 3.15: Invoke a method on each element in the collection
<code>_.invoke(['a', 'b', 'c'], 'toUpperCase');</code>
<code>// -&gt; ['A', 'B', 'C']</code>
<code>_.invoke([['a', 'b'], ['c', 'd']], 'join', '');</code>
<code>// -&gt; ['ab', 'cd']</code>

<aside>
    <h5>
<code>_.invoke</code> renamed to <code>_.invokeMap</code> in v4</h5>
  In v4, <code>_.invoke</code> from v3 is renamed to <code>_.invokeMap</code>. 
<code>_.invoke</code> in v4 is a different method working on objects, which will be covered in Chapter 5.
</aside>
<h3>3.14 Map and reduce</h3>
Map and reduce are common operations when processing collections. 
<code>map</code> transforms a collection into another collection by applying an operation to each element in the collection. 
<code>reduce</code> transforms a collection into a single value by accumulating result of applying an operation to each element. 
The result of the last operation is used as the input of the current operation.
<h4>
3.14.1 Map</h4>
<code>_.map(collection, [iteratee=_.identity], [thisArg])</code> is the generic map function provided by lodash.
Listing 3.15 uses a function to transform input array.
  Listing 3.16: Generic map function
<code>_.map([1, 2, 3], function(value) {</code>
    <code>return value * 2;</code>
<code>});</code>
<code>// -&gt; [2, 4, 6]</code>

If <code>_.map</code> is used on collections of objects, property name and value can also be passed. 
This is the same syntax as using predicates in other lodash functions.
  Listing 3.17: Map by property name and value
<code>var users = [</code>
  <code>{</code>
    <code>name: 'Alex'</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'Bob'</code>
  <code>}</code>
<code>];</code>
<code>_.map(users, 'name');</code>
<code>// -&gt; ['Alex', 'Bob']</code>
<code>_.map(users, 'name', 'Alex'); // Only works in v3</code>
<code>// -&gt; [true, false]</code>
<code>_.map(users, {name: 'Alex'});</code>
<code>// -&gt; [true, false]</code>

<h4>
3.14.2 Reduce</h4>
<code>_.reduce(collection, [iteratee=_.identity], [accumulator], [thisArg])</code> has similar arguments list with <code>_.map</code>,  except it accepts a value as the initial input of the first reduce operation. 
If the initial value is not provided, the first element in the collection is used. 
The provided iteratee function will be invoked with four arguments, <code>accumulator</code>, <code>value</code>, <code>index</code>/<code>key</code> and <code>collection</code>. 
<code>accumulator</code> is the current reduced value. 
Returned result of iteratee function invocation is passed as the <code>accumulator</code> value of next invocation.
Below is a simple example shows how to use <code>_.reduce</code> to sum the values in an array.
  Listing 3.18: Use <code>_.reduce</code> to sum the values in an array
<code>_.reduce([1, 2, 3], function(accumulator, value) {</code>
    <code>return accumulator + value;</code>
<code>});</code>
<code>// -&gt; 6</code>

Following example is similar to example above, but initial value <code>100</code> is provided.
  Listing 3.19: Reduce with initial value
<code>_.reduce([1, 2, 3], function(accumulator, value) {</code>
    <code>return accumulator + value;</code>
<code>}, 100);</code>
<code>// -&gt; 106</code>

<code>_.reduceRight(collection, [iteratee=_.identity], [accumulator], [thisArg])</code> is similar with <code>_.reduce</code> except <code>_.reduceRight</code> iterates elements from right to left.
  Listing 3.20: Reduce elements from right to left
<code>_.reduceRight('hello', function(accumulator, value) {</code>
  <code>return accumulator.toUpperCase() + value;</code>
<code>})</code>
<code>// -&gt; 'OLLEh'</code>
<code>_.reduce('hello', function(accumulator, value) {</code>
  <code>return accumulator.toUpperCase() + value;</code>
<code>})</code>
<code>// -&gt; 'HELLo'</code>

<aside>
    In v3, <code>_.collect</code> is an alias of <code>_.map</code>, <code>_.inject</code> and <code>_.foldl</code> are aliases of <code>_.reduce</code>. 
<code>_.foldr</code> is an alias of <code>_.reduceRight</code>. 
In v4, <code>_.collect</code>, <code>_.inject</code>, <code>_.foldl</code> and <code>_.foldr</code> are removed.
</aside>
<h3>3.15 Search</h3>
Search is a very common task in programming. 
Search is performed on iterable target collections with given conditions. 
The return result is the first element in the collection matching the condition or <code>undefined</code> is no matching element is found. 
Below is the input array used in following Listing.
  Listing 3.21: Example input array
<code>var fruits = [</code>
  <code>{</code>
    <code>name: 'apple',</code>
    <code>price: 0.99,</code>
    <code>onSale: true</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'orange',</code>
    <code>price: 1.99,</code>
    <code>onSale: false</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'passion fruit',</code>
    <code>price: 4.99,</code>
    <code>onSale: false</code>
  <code>}</code>
<code>];</code>

<h4>
3.15.1 Generic search</h4>
<h5>
3.15.1.1 <code>_.find</code>
</h5>
<code>_.find(collection, [predicate=_.identity], [thisArg])</code> is the generic function to search in collections. 
When invoking <code>_.find</code>, the collection itself and search condition should be provided. 
<code>_.find</code> supports different types of arguments combinations. 
The first argument is always the collection to search in, i.e. 
arrays, objects or strings. 
If the second argument is a function, the function is invoked for each element in the array until this function returns truthy value. 
This function is invoked with three arguments: currently iterated element, index or key of this element and the collection itself.
  Listing 3.22: Find using a predicate function
<code>_.find(fruits, function(fruit) {</code>
  <code>return fruit.price &lt;= 2;</code>
<code>});</code>
<code>// -&gt; {name: 'apple', price: 0.99, onSale: true}</code>

<code>_.find</code> can use the same predicate syntax as other lodash functions.
  Listing 3.23: Find using different predicate syntax
<code>_.find(fruits, 'onSale');</code>
<code>// -&gt; {name: 'apple', price: 0.99, onSale: true}</code>
<code>_.find(fruits, 'name', 'apple');</code>
<code>// -&gt; {name: 'apple', price: 0.99, onSale: true}</code>
<code>_.find(fruits, {</code>
  <code>name: 'apple',</code>
  <code>onSale: true</code>
<code>});</code>
<code>// -&gt; {name: 'apple', price: 0.99, onSale: true}</code>

When invoking <code>_.find</code>, an object can always be added as the last argument for the <code>this</code> binding of invoking predicate.
<aside>
    <code>_.detect</code> is an alias of <code>_.find</code> in v3. 
<code>_.detect</code> is removed in v4.
</aside>
<h5>
3.15.1.2 <code>_.findLast</code>
</h5>
<code>_.findLast</code> is similar with <code>_.find</code>, but <code>_.findLast</code> iterates over elements of collection in reverse order. 
For arrays, it searches from the last element. 
For strings, it searches from the last character. 
For objects, it searches from the last element of an array of property names returned by <code>_.keys</code>.
  Listing 3.24: Find in reverse order
<code>_.findLast('hello', function(char){</code>
  <code>return char &lt; 'f';</code>
<code>});</code>
<code>// -&gt; 'e'</code>

<h5>
3.15.1.3 <strong>[v3]</strong> <code>_.findWhere</code>
</h5>
<code>_.findWhere</code> is a simpler format of passing an object as the second argument of <code>_.find</code> function.
  Listing 3.25: Find by comparing objects
<code>_.findWhere(fruits, {</code>
  <code>name: 'apple',</code>
  <code>onSale: true</code>
<code>});</code>
<code>// -&gt; {name: 'apple', price: 0.99, onSale: true}</code>

<code>_.findWhere</code> doesn’t allow providing <code>this</code> binding for invoking predicates.
<aside>
    <h5>
<code>_.findWhere</code> removed in v3</h5>
  <code>_.findWhere</code> is removed in v4, <code>_.find</code> should be used instead.
</aside>
<h4>
3.15.2 Sort</h4>
<code>_.sortBy(collection, [iteratee=_.identity], [thisArg])</code> sorts a collection in ascending order with results after applying iteratee function to each element in the collection. 
The sort is stable, which means it preserves original order for equal elements.
  Listing 3.26: Sort a collection
<code>_.sortBy([3, 2, 1]);</code>
<code>// -&gt; [1, 2, 3]</code>
<code>_.sortBy([-3, 2, 1], function(val) {</code>
  <code>return Math.abs(val);</code>
<code>});</code>
<code>// -&gt; [1, 2, -3]</code>

In v3, <code>_.sortByAll(collection, props)</code> is similar with <code>_.sort</code>, except <code>_.sortByAll</code> sorts collection by multiple property names. 
Multiple property names can be provided as sort conditions. 
If multiple elements in the collection have the same value for the first property name, those elements are sorted using second property name, and so on.
  Listing 3.27: Sort a collection by multiple property names
<code>var users = [</code>
  <code>{</code>
    <code>name: 'David',</code>
    <code>age: 28</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'Alex',</code>
    <code>age: 30</code>
  <code>},</code>
  <code>{</code>
    <code>name: 'Bob',</code>
    <code>age: 28</code>
  <code>}</code>
<code>];</code>
<code>_.sortByAll(users, 'name');</code>
<code>// -&gt; [{name: 'Alex', age: 30}, {name: 'Bob', age: 28}, {name: 'David', age: 28}]</code>
<code>_.sortByAll(users, ['age', 'name'])</code>
<code>// -&gt; [{name: 'Bob', age: 30, {name: 'David', age: 28}, {name: 'Alex', age: 30}}]</code>

In v4, functionality of original <code>_.sortByAll</code> in v3 is integrated into <code>_.sortBy</code> method, so <code>_.sortByAll</code> can be replaced with <code>_.sortBy</code> in v4.
In v3, <code>_.sortByOrder(collection, props, orders)</code> is similar with <code>_.sortByAll</code>, except that <code>_.sortByOrder</code> allows to specify the sort order for each sort condition, ascending or descending. 
The order is specified using the third argument, truthy value means ascending order and falsy value means descending order. 
For multiple property names, use an array with values for corresponding sort order.
  Listing 3.28: Sort by multiple property names in different orders
<code>_.sortByOrder(users, 'name', false);</code>
<code>// -&gt; [{name: 'David', age: 28}, {name: 'Bob', age: 28}, {name: 'Alex', age: 30}]</code>
<code>_.sortByOrder(users, ['age', 'name'], [true, true]);</code>
<code>// -&gt; [{name: 'Alex', age: 30}, {name: 'Bob', age: 28}, {name: 'David', age: 28}]</code>

In v4, <code>_.sortByOrder</code> is renamed to <code>_.orderBy</code>.
<h3>3.16 <strong>[v4]</strong> Flat map</h3>
<code>_.flatMap(collection, [iteratee=_.identity])</code> invokes an iteratee function to each element in a collection. 
The result of each iteratee function invocation is an array. 
All result arrays are concatenated and flattened into a single array as the final result.
  Listing 3.29: Example of <code>_.flatMap</code>
<code>function map(value) {</code>
  <code>return [value + 1, value - 1];</code>
<code>}</code>
<code>_.flatMap([1, 2], map);</code>
<code>// -&gt; [2, 0, 3, 1]</code>

<code>_.flatMapDeep(collection, [iteratee=_.identity])</code> is similar with <code>_.flatMap</code> except that <code>_.flatMapDeep</code> recursively flattens the result array until it’s completely flattened. 
<code>_.flatMapDepth(collection, [iteratee=_.identity], [depth=1])</code> is similar with <code>_.flatMapDeep</code> except that it only flattens the result given times. 
The default value of <code>depth</code> is <code>1</code>, so <code>_.flatMapDepth(array, iteratee)</code> is the same as <code>_.flatMap(array, iteratee)</code>.
<h2><span class="orange">String templates</span></h2>
If you want to generate strings from a template, <code>_.template([string=''], [options])</code> is a simple yet powerful function to do that. 
It can be used by libraries and applications to avoid long string concatenations. 
Grunt uses <code>_.template</code> to allow using templates in <a href="http://gruntjs.com/api/grunt.template">configuration file</a>. 
It can also be used in applications to generate HTML markups, messages, emails and more.
  Listing 10.1: Basic usage of string template
<code>var tpl = _.template('Hello, &lt;%= name %&gt;. 
Current time is &lt;%= new Date() %&gt;.');</code>
<code>tpl({</code>
  <code>name: 'Alex'</code>
<code>});</code>
<code>// -&gt; 'Hello, Alex. 
Current time is Sat Jun 27 2015 20:28:05 GMT+1200 (NZST).'</code>

In Listing 10.1, the input argument of <code>_.template</code> method is the template itself. 
In the template, <code>&lt;%=</code> and <code>%&gt;</code> are the delimiters to wrap variables to be evaluated at runtime. 
<code>_.template</code> method returns a new function. 
After invoking the returned function with a context object contains actual values of template variables, it returns the actual generated string. 
If no value is assigned to a variable, an empty string will be used.
<code>_.template</code> supports three types of delimiters, <em>interpolate</em>, <em>escape</em> and <em>evaluate</em>.
<h3>4.1 interpolate</h3>
<em>interpolate</em> delimiters allow to interpolate variables. 
The default regular expression pattern to declare interpolated variables is <code>/&lt;%=([\s\S]+?)%&gt;/g</code>. 
Simple variables and complex expressions can both be used. 
The regular expression pattern of <em>interpolate</em> delimiters can be customized by <code>interpolate</code> of options object.
  Listing 10.2: Use interpolate delimiters
<code>var tpl = _.template('Hello, &lt;%= name %&gt;, the total amount is &lt;%= order.amount +\</code>
<code> 10 %&gt;.');</code>
<code>tpl({</code>
  <code>name: 'Alex',</code>
  <code>order: {</code>
    <code>amount: 100</code>
  <code>}</code>
<code>});</code>
<code>// -&gt; 'Hello, Alex, the total amount is 110.'</code>

<h3>4.2 escape</h3>
It’s common to use <code>_.template</code> to generate HTML markups. 
<em>escape</em> delimiters allow to interpolate variables and escape result value. 
The default regular expression pattern to declare escaped variables is <code>/&lt;%-([\s\S]+?)%&gt;/g</code>. 
The pattern can be customized by <code>escape</code> of options object.
  Listing 10.3: Use escape delimiters
<code>var tpl = _.template('&lt;div&gt;&lt;%- markup %&gt;&lt;/div&gt;');</code>
<code>tpl({</code>
  <code>markup: '&lt;span&gt;Hello&lt;/span&gt;'</code>
<code>});</code>
<code>// -&gt; '&lt;div&gt;&amp;lt;span&amp;gt;Hello&amp;lt;/span&amp;gt;&lt;/div&gt;'</code>

<h3>4.3 evaluate</h3>
<em>evaluate</em> delimiters allow to execute JavaScript code. 
This kind of delimiters is useful when adding logic to templates, e.g. 
adding condition checks or loops to the template. 
The default regular expression pattern to declare JavaScript code is <code>/&lt;%([\s\S]+?)%&gt;/g</code>. 
The pattern can be customized by <code>evaluate</code> of options object.
  Listing 10.4: Use evaluate delimiters
<code>var tpl = _.template('&lt;% if (a &gt; 0) { %&gt; Good! &lt;% } else { %&gt; Bad! &lt;% } %&gt;');</code>
<code>tpl({</code>
  <code>a: 1</code>
<code>});</code>
<code>// -&gt; ' Good! '</code>
<code>tpl({</code>
  <code>a: -1</code>
<code>});</code>
<code>// -&gt; ' Bad! '</code>

<h3>4.4 imports</h3>
Besides from the context object passed to the function created by <code>_.template</code> method, a default object can also to passed to <code>_.template</code> as an additional source when evaluating variables. 
The object is specified using <code>imports</code> of options object.
  Listing 10.5: Use extra imports
<code>var tpl = _.template('Hi, &lt;%= user %&gt;, you should pay &lt;%= amount * discount %&gt;.',</code>
  <code>{</code>
    <code>imports: {</code>
      <code>discount: 0.8</code>
  <code>}</code>
<code>});</code>
<code>tpl({</code>
  <code>user: 'Alex',</code>
  <code>amount: 100</code>
<code>});</code>
<code>// -&gt; 'Hi, Alex, you should pay 80.'</code>
<code>tpl({</code>
  <code>user: 'Bob',</code>
  <code>amount: 100,</code>
  <code>discount: 0.9</code>
<code>});</code>
<code>// -&gt; 'Hi, Bob, you should pay 90.'</code>

The default imports object contains only lodash object itself with key <code>_</code>, so lodash methods can be used directly in the expressions.
<h3>4.5 Data object name</h3>
By default, when evaluating variables in the template, the variables use the same name as in the context object. 
<code>variable</code> of <code>_.template</code>’s options object can be used to set a name to the context object, then variable names should be changed accordingly.
  Listing 10.6: Use different variable object name
<code>var tpl = _.template('Hello, &lt;%= user.name %&gt;.', {</code>
  <code>variable: 'user'</code>
<code>});</code>
<code>tpl({</code>
  <code>name: 'Alex'</code>
<code>});</code>
<code>// -&gt; 'Hello, Alex.'</code>

In Listing 10.6, the context object’s name is set to <code>user</code>, so <code>user.name</code> accesses <code>name</code> property of the argument object.
<h2><span class="orange">Recipes</span></h2>
<h3>5.1 <strong>[v3]</strong> Filter an object’s properties</h3>
<h4>
5.1.1 Scenario</h4>
Filter a given object by removing certain properties.
<h4>
5.1.2 Solution</h4>
Although <code>_.filter</code> and <code>_.reject</code> can be applied to objects, they cannot be used for this scenario, because <code>_.filter</code> and <code>_.reject</code> return an array of property values after filtering. 
<code>_.pick</code> and <code>_.omit</code> should be used instead.
  Listing 11.1: Filter a given object by removing certain properties
<code>var fruits = {</code>
  <code>apple: {</code>
    <code>name: 'Apple',</code>
    <code>price: 2.99</code>
  <code>},</code>
  <code>orange: {</code>
    <code>name: 'Orange',</code>
    <code>price: 1.99</code>
  <code>},</code>
  <code>banana: {</code>
    <code>name: 'Banana',</code>
    <code>price: 0.5</code>
  <code>}</code>
<code>};</code>
<code>_.pick(fruits, function(fruit) {</code>
  <code>return fruit.price &gt; 2;</code>
<code>});</code>
<code>// -&gt; { apple: { name: 'Apple', price: 2.99 } }</code>
<code>_.pick(fruits, function(fruit, key) {</code>
  <code>return key != 'apple';</code>
<code>});</code>
<code>// -&gt; { orange: { name: 'Orange', price: 1.99 }, banana: { name: 'Banana', price\</code>
<code>: 0.5 } }</code>
<code>_.pick(fruits, 'apple');</code>
<code>// -&gt; { apple: { name: 'Apple', price: 2.99 } }</code>

When a predicate function is passed to <code>_.pick</code> or <code>_.omit</code>, it’s invoked with three arguments: property value, property name and the object itself.
<h3>5.2 <strong>[v3]</strong> Push an array of elements into an array</h3>
<h4>
5.2.1 Scenario</h4>
Given an array of elements, push those elements into another array.
<h4>
5.2.2 Solution</h4>
If using <code>Array</code>’s <code>push</code> method, the whole array will be pushed as a single element.
  Listing 11.2: Use <code>Array</code>’s <code>push</code> method
<code>var array = [1, 2, 3];</code>
<code>array.push([4, 5, 6]);</code>
<code>console.log(array);</code>
<code>// -&gt; [1, 2, 3, [4, 5, 6]]</code>

The first solution is to use <code>_.spread</code> to wrap <code>push</code> method to accept arrays as arguments.
  Listing 11.3: Use <code>_.spread</code> to wrap <code>push</code> method
<code>var array = [1, 2, 3];</code>
<code>var push = _.bind(_.spread(Array.prototype.push), array);</code>
<code>push([4, 5, 6]);</code>
<code>console.log(array);</code>
<code>// -&gt; [1, 2, 3, 4, 5, 6]</code>

The second solution is to push the array first, then use <code>_.flatten</code> to flatten the array.
  Listing 11.4: Use <code>_.flatten</code> to flatten the array
<code>var array = [1, 2, 3];</code>
<code>array.push([4, 5, 6]);</code>
<code>_.flatten(array);</code>
<code>// -&gt; [1, 2, 3, 4, 5, 6]</code>

<h3>5.3 <strong>[v3]</strong> Process data for C3.js pie chart</h3>
<h4>
5.3.1 Scenario</h4>
<a href="http://c3js.org/">C3.js</a> is a popular chart library based on <a href="http://d3js.org/">d3.js</a>. 
C3.js can create <a href="http://c3js.org/samples/chart_pie.html">pie chart</a> based on data input. 
But when there are many items in the data set, the pie chart itself becomes very hard to read.
Listing 11.5 is the basic code to create a pie chart with <code>100</code> items.
  Listing 11.5: Basic code of create a pie chart
<code>function generateData(num) {</code>
    <code>var data = [];</code>
    <code>for (var i = 0; i &lt; num; i++) {</code>
        <code>data.push(['data' + i, (i &lt;= 20 ? 1000 : 0) +</code>  <code>Math.random() * 10]);</code>
    <code>}</code>
    <code>return data;</code>
<code>}</code>
<code>var chart = c3.generate({</code>
    <code>bindto: '#chart',</code>
    <code>data: {</code>
      <code>columns: generateData(100),</code>
      <code>type: 'pie'</code>
    <code>}</code>
<code>});</code>

Below is how this chart looks like.
  <img src="/site_images/lodashcookbook/original_pie_chart.png" alt="Unreadable pie chart with 100 items">
  Unreadable pie chart with 100 items
<h4>
5.3.2 Solution</h4>
One solution is to process the data set first by limiting the number of items. 
For example, we can only get top <code>20</code> items from the data set and all the rest items are summed into a new item called <code>Others</code>. 
By doing this, the created chart will be more readable.
In Listing 11.6, use <code>_.sortByOrder</code> to sort the <code>data</code> array first based on the second element of the item array. 
Items in the <code>data</code> array are all arrays, <code>[1]</code> can be used to access the second element in the item array. 
After the <code>data</code> array is sorted, use <code>_.take</code> to find the top <code>20</code> items in the sorted array, then use <code>_.last</code> to find the last one. 
This last item is used as the threshold to partition the <code>data</code> array. 
Then use <code>partition</code> to divide the <code>data</code> array into two groups. 
The first group <code>groups[0]</code> contains items we want to keep, the second group <code>groups[1]</code> contains items we want to merge. 
For the second group, use <code>_.sum</code> to calculate the sum of all the items to merge. 
The merged item is pushed to the result data array with name <code>Others</code> and sum.
  Listing 11.6: Use lodash to process data
<code>function processData(data) {</code>
    <code>var threshold = _(data).sortByOrder('[1]', false).take(20).last();</code>
    <code>if (threshold) {</code>
        <code>var groups = _.partition(data, function(item) {</code>
            <code>return item[1] &gt;= threshold[1];</code>
        <code>});</code>
        <code>if (_.size(groups[1]) &gt; 0) {</code>
            <code>groups[0].push(['Others', _.sum(groups[1], '[1]')]);</code>
        <code>}</code>
        <code>return groups[0];</code>
    <code>}</code>
    <code>return data;</code>
<code>}</code>

After using Listing 11.6 code to process the data first, the chart is much easier to read, see below.
  <img src="/site_images/lodashcookbook/merged_pie_chart.png" alt="Pie chart with items merged">
  Pie chart with items merged
<h3>5.4 <strong>[v3]</strong> Create a unique array of objects</h3>
<h4>
5.4.1 Scenario</h4>
Given an array of objects in Listing 11.7, remove duplicate values from the array.
  Listing 11.7: An array of objects with duplicate values
<code>[</code>
  <code>{</code>
    <code>"name": "Alex",</code>
    <code>"age": 30</code>
  <code>},</code>
  <code>{</code>
    <code>"name": "Bob",</code>
    <code>"age": 28</code>
  <code>},</code>
  <code>{</code>
    <code>"name": "Alex",</code>
    <code>"age": 30</code>
  <code>}</code>
<code>]</code>

<h4>
5.4.2 Solution</h4>
<code>_.uniq</code> function can be used to remove duplicate values from an array, but it only uses <em>SameAsZero</em> algorithm to compare values. 
To perform the deep comparison for elements in the array of Listing 11.7, we need to convert each element into a single value. 
For example, if <code>name</code> property is the unique key for each element, use <code>_.uniq(array, 'name')</code>. 
If there is no unique key, you can convert the element into a JSON string.
  Listing 11.8: Compare array elements as JSON strings
<code>_.uniq(array, function(element) {</code>
  <code>return JSON.stringify(element);</code>
<code>});</code>

JSON serialization may generate different results for objects with the same value due to undermined property enumeration order. 
For a more consistent result, create your own object serialization format. 
Listing 11.9 concatenates <code>name</code> and <code>age</code> properties as the serialization format to determine uniqueness.
  Listing 11.9: Compare array elements using custom serialization format
<code>_.uniq(array, function(element) {</code>
  <code>return element.name + element.age;</code>
<code>});</code>

<h3>5.5 Convert an array to an object</h3>
<h4>
5.5.1 Scenario</h4>
Given an array of objects with IDs, convert the array to an object with IDs as the keys and array elements as the values.
For example, given an array in Listing 11.10, convert it to an object shown in Listing 11.11.
  List 11.10: An array of objects with IDs
<code>[</code>
  <code>{</code>
    <code>"id": "user001",</code>
    <code>"name": "Alex"</code>
  <code>},</code>
  <code>{</code>
    <code>"id": "user002",</code>
    <code>"name": "Bob"</code>
  <code>}</code>
<code>]</code>
  List 11.11: Conversion result of Listing 11.10
<code>{</code>
  <code>"user001": {</code>
    <code>"id": "user001",</code>
    <code>"name": "Alex"</code>
  <code>},</code>
  <code>"user002": {</code>
    <code>"id": "user002",</code>
    <code>"name": "Bob"</code>
  <code>}</code>
<code>}</code>

<h4>
5.5.2 Solution</h4>
One solution is to use <code>_.each</code> to iterate the array and set each property in the result object, see Listing 11.12.
  List 11.12: Solution to use <code>_.each</code>
<code>var result = {};</code>
<code>_.each(array, function(obj) {</code>
  <code>result[obj.id] = obj;</code>
<code>});</code>

A better solution is to use <code>_.reduce</code>, see Listing 11.13.
  List 11.13: Solution to use <code>_.reduce</code>
<code>_.reduce(array, function(result, obj) {</code>
  <code>result[obj.id] = obj;</code>
  <code>return result;</code>
<code>}, {});</code>

<script src='https://williamkpchan.github.io/LibDocs/readbook.js'></script>
<script>
var lazyLoadInstance = new LazyLoad({
    elements_selector: ".lazy"
    // ... 
more custom settings?
});
</script>
</pre></body></html>
